2 22
0
1
( | )
2
FDp FD H e 
 
 (2)
式(2)中 0H 為一虛無假設(null hypothesis)在這裏
定義為目前連續二張影像中沒有物體變動的像素
( , )x y , 2 為二張影像相減後所求得變異數且它
相等於二倍的相機雜訊變異數 (camera noise
variance) 2c ，當求得以上各參數後將根據 signi-
ficance level 關係式來求得最佳門檻值如式(3)
所示:
0Pr (| | | )ob FD TH H  (3)
在上述過程門檻值選定最重要關鍵在於如何求得
相機雜訊變異數(camera noise variance) 2c ，而在
計算 2c 前得對影像中沒有物體變動像素 ( , )x y 做
定義(null hypothesis)，首先利用式(1)計算連續二張
影像之間差異值定義為 ( , , )FD x y t ，再根據 FD
影像切割為若干個 15*15 區塊，個別統計個別區塊
mean 值，當 mean 值大於 2 即定義此區塊為有物
體變動區塊，反之為沒有物體變動區塊。
2.2背景初始(更新)
背景初始(更新)在整個移動物體偵測演算法
中佔相當重要的一環，而背景更新的好壞也嚴重影
響後續移動物體判斷的結果，背景初始(更新)在
background subtraction method系統中是最重要且
必須先被完成的部份，所以在這方面的研究也算是
最多最廣泛的，而在系統中為了能夠既時更新背
景，本文採用[8]中提出的既時背景初始演算法，
並對背景更新演算法部份加以改良，整個背景初始
演 算法 觀念是 以連 續二 張影 像相減 (Frame
Difference)預先偵測場景中未變化部份，如式(4)、
(5)所示:
( , , ) | ( , , ) ( , , 1) |FD x y t I x y t I x y t   (4)
1
( , , )
0
if FD TH
FDM x y t
if FD TH
 
(5)
式(4)、(5)為連續二張影像相減後我們得到影像
FD，再對 FD 影像作二值化判斷找出有移動的像
素值定義為 FDM，接下來針對得到的 FDM 影像
統計未變化像素的累加值來對背景影像做即時背
景初始(更新)，如式(6)、(7)、(8):
( , , 1) 1 ( , , ) 0
( , , )
0 ( , , ) 1
SI x y t if FDM x y t
SI x y t
if FDM x y t
   
(6)
( , , ) ( , , )
( , , )
( , , 1)
I x y t if SI x y t Fth
BG x y t
BG x y t else
 
(7)
1 ( , , )
( , , )
( , , 1)
if SI x y t Fth
BI x y t
BI x y t else
 
(8)
在背景更新部份本文要討論的狀況為當一移動物
體離開(加入)初始背景時，要如何得知此移動物體
已離開(加入)背景中，並對此離開(加入)區域作背
景更新，本文的作法是當系統已完成背景初始並利
用多重解析度成長法(MRVT)偵測出移動物體區
塊後，此時的移動物體區塊必包含二部份一為真實
移動物體所造成，另一個為背景未即時更新而造成
錯誤偵測區塊如圖 1 (c) 區塊 1 所示:
(a ) (b )
(c ) (d )
1 2
圖 1 (a)為 frame#45 所建立背景影像 (b)為目前擷
取影像(c)為移動物體偵測區塊 (d)為二張影像相
減後所得 FDM
在圖 1 中可以很明顯看出此時電話已變換位置，而
在(c)圖中因為背景未立即將電話更新入背景中而
產生錯誤偵測，在這我們的解決方法為當我們在
(MRVT)模型下偵測出移動物體後必需再進一步判
斷移動物體區塊是否正確如式(9):
1 2
1
21
1
1 11
1
1
k k
k
label ilabel i
label i
label i true if MRVT FDM
FOM
label i false else


  
 
(9)
式(9)中
1 1
k
label i
MRVT

為對 MRVT 所偵測移動物體區塊
作連通標記(Connected Components Labeling)標籤
符號 1 1 ~i k ，當
1
1 1
k
label i
MRVT

與
2
2 1
k
label i
FDM

的區塊有所
交集時，即判斷 FOM label i1 區塊為正確移動物體
區塊，反之為判斷錯誤區塊，圖(2)為判斷結果。
(a) (b)
圖 2 (a)為 frame#46 所建立背景影像 (b)為移動物
長流程圖，可以明顯地看到每一層的 kB 影像，在
高層有較空洞的現象，經由往低層成長後，空洞的
部分漸漸地被補滿，最後形成一個較為完整的物體
區塊。
4B 4
3
2
M
3B
2B
1B
M
M
1
M
4DB
3DB
2DB
1DB
3DB
4DB
2DB
3RB
2RB
1RB
圖 4 多重解析度成長法示意圖
圖 5 MRVT 結果
2.4陰影偵測
在我們的系統中採用[7]的方法來對陰影作濾
除，整個陰影濾除概念為利用背景和前景之間彩色
與亮度的關係定義出陰影區塊，首先在一個三度空
間顏色RGB 模型，如圖6 所示:
iE
iI
i iE
iCD
G
R
B
0
圖6 立體空間RGB彩色模型
iE 為背景影像中第 i 個像素的像素值、 iI 為目前
截取影像中第 i 個像素的像素值， i和 iCD 分別
是 iE 與 iI 之間亮度和色彩的失真(Distortion)。
亮度失真 i是滿足使得新的顏色向量 iE 與 iI 最
靠近時的一個純量，也就是滿足下式(16)最小值時
的 i。
2( ) ( )i i i iI E   (16)
而 iCD 則是定義 iE 與 iI 之間的垂直距離，可以直
接將經由式(16)求得的 i代入式(17)得之:
i i i iCD I E  (17)
分別對上式以  ( ), ( ), ( )i R G BE BG i BG i BG i 、
 ( ), ( ), ( )i R G BI I i I i I i 作取代得到式(18)、(19):
 2 2 2
( ) ( ) ( ) ( ) ( ) ( )
( ) ( ) ( )
R R G G B B
i
R G B
I i BG i I i BG i I i BG i
BG i BG i BG i
  
 
(18)
     2 2 2() () () () () ()i R i R G i G B i BCD I i BG i I i BG i I i BG i        (19)
藉由這兩個亮度失真和色彩失真值並根據式(20)
來對影像像素進行分類：
: 1
( )
:
i th th iS if CD CD andM i
F otherwise
   

(20)
