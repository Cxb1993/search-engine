2媒體整合儲存系統之實現
計畫主持人：黃慶祥
計畫參與人員：唐英傑 楊建豐
摘要：
媒體整合，能帶給人們新的文化感受，若
能有更好的媒體整合技術或工具，將能更豐富
我們的多元文化，本文描述了如何實現一個媒
體整合儲存系統，可將此系統中儲存的照片、
音樂、影片與文字等媒體，整合為一 KTV 媒
體，本系統除了可提供使用者一個發揮創意的
媒體整合工具之外，也可讓使用者藉由本系統
享受此整合成的新 KTV 媒體。
為了實現媒體整合的機制，我們設計了整
合媒體描述檔與歌詞歌譜的格式，在系統中，
我們也實現了滿足此一格式規範的同步法
則，因此，可以讓文字與音樂達成同步，讓使
用者可以藉此，創造出一個新潁的整合媒體。
關鍵詞:媒體整合、訊號處理、訊號同步
一、簡介：
自古以來，媒體就一直就隨著人類生活的
進步，而不斷的演進，而每一次有了新的媒體
整合方式或工具，都會帶給人們新的文化感
受，就好比遠古的某一個聲音，被規律的以木
棍敲擊的那一刻，音樂就此誕生，後來，語言
加入了音樂，音樂的故事性變得更加的明確，
歌劇等媒體也就此成型，時至今日，現代人應
用科技，將音樂、影像與戲劇整合成了電影，
今天多媒體已是每個人可朗朗上口的名詞，多
媒體整合了互動之後，成了熱門的電動玩具，
互動式教學等新興媒體，現今網路結合多媒體
讓媒體更多元也更易於傳播，多媒體的出現始
於人性，因此有著接受度高的特性，適合作為
各年齡層的溝通輔助媒介，多媒體的應用與開
發，將帶給人們更加人性化的科技應用，因此
本文提出創新的媒體整合機制，期望創造出新
的媒體整合工具，將可讓人們創造更多元的多
媒體。
媒體整合儲存系統提供模組化的操作機
制，讓使用者可以將現存的多種媒體群組化為
一特定的媒體，該系統也因此能成為此特定媒
體的播放器，使用者可自行取捨儲存於此系統
上媒體的部分片斷，搭配相關連的其他媒體，
例如同時播放、穿插播放或只播聲音等等，使
用者可藉由本系統提供的整合機制彈性化的
規範不同媒體的呈現方式，連結各種媒體，藉
由本系統提供的整合機制創造出新媒體，更重
要的是這些程式化的整合方式可透過本系統
重現，因此這一使用者利用本系統操作環境所
創造的新媒體，是可以另行散播發行的新媒
體，可為舊有媒體再造生機。
圖 1、媒體整合系統示意圖
二、媒體整合儲存系統可行方案比較：
媒體整合儲存系統（Media Integration
Storage System ,以下簡稱 MISS），是一部可
模組化的多功能媒體播放器，主要提供下列功
能:
 多媒體資料儲存與管理
 多媒體資料傳輸
 使用者介面
4值為 4，而 SOC 介於兩者之間，且對於同一類
產品有很好的適用性，生產廠商只要投入一次
研發費用就能生產同類產品，因此我們給它的
評比值為 6。
本專案依上述比較的結果，採用 SOC 的架
構其整體評分最高，因此我們將以 SOC IC 來
設計本專案。
註：值愈高愈佳
表1、可行方案比較表
藉由上述的分析，我們選擇 TI 生產的
SOC TMS320DSC25 做為發展平台，該 SOC 核心
是 ARM 加 DSP 的雙核心晶片，該 SOC 還附加了
很多的 I/O 介面，ARM 端能負責中斷與 IO 的
控制與任務指派，DSP(屬於 TI 54X 系列)則可
處理多媒體的解碼，這樣的分工機制正符合本
系統所需要的人機介面控制與多媒體播放功
能，因此我們採用了以 DSC25 完成的嵌入式系
統發展板，發展板上也提供了 AV 端子介面，
讓本系統能將多媒體在電視上播放，其 IO 介
面也提供了使用者介面中，所需要的按鍵功
能，與連接 PC 的 USB 介面，除了我們必須自
行發展軟體來實現我們的新觀念之外，相關的
硬體幾乎都是現成的。
三、媒體整合儲存系統：
媒體整合儲存系統架構如圖 1 所示，我們
以媒體整合再造新媒體為目標，因此，具有多
媒體運算能力的 CPU，將是首要考量的硬體條
件，經過分析所需的週邊設計之後，我們規劃
出媒體儲存子系統、檔案配置表子系統、媒體
傳輸子系統、使用者介面子系統與媒體解碼子
系統，這五個子系統，以滿足成媒體儲存系統
大容量的儲存需求，並且以檔案系統提供人性
化的媒體管理介面，傳輸子系統將作為媒體
擴充用的傳輸媒介，多媒體解碼子系統則處
理媒體的解碼與同步播放，使用者介面子系
統提供人性化的操作環境，讓使用者可以輕
鬆的操作媒體儲存系統與設定編輯其功能。
圖 2、媒體整合儲存系統架構圖
如表 2所示，媒體整合儲存系統各子系統
提供下列功能:
表 2、各子系統功能
ASIC MCU+DSP SoC
重要
性
擴充性 1 10 8 10
研發費用 10 4 6 8
系統整合 1 5 10 7
上市速度 10 5 5 9
彈性 1 8 10 5
維護費用 5 2 10 5
訓練費用 2 4 3 4
整體評分
(重要性為加權) 225 320 355
子系統
名稱
功能
FAT
子系統
管理可程式媒體整合儲存系統中
的多媒體儲存介面以及檔案系統
媒體儲存
子系統
提供 MISS 儲存多媒體的介面
媒體傳輸
子系統
提供MISS與個人電腦連線時的傳
輸介面
媒體解碼
子系統
提供聲音、影像與字幕的解碼與
媒體同步播放機制
使用者
介面
顯示使用者操作提示與操作按鍵
6圖 4、USB 命令資料和狀態傳輸流程
USB 巨量儲存裝置協定的流程，如圖 4所
示，所有的 CBW[3]都是由 HOST 來發出，資料
輸出則是由 HOST 送出，資料輸入則為裝置所
送出，所有的 CSW 都是由裝置來發送，也就是
說每個命令之後可能會有資料的傳輸，但在這
筆資料之後，HOST 會確認由裝置發送的 CSW
封包，以確定 HOST 之前所發送的 CBW 是否執
行完成。
使用者介面(UI)
我們期望 MISS 主選單目錄，能明白的顯
示，當下系統選單所提供的各項功能，包含按
鍵執行的功能，都將以簡單的圖示標示清楚，
因此，增加人性化的設計，本系統將該人性化
設計介面，取名為操作引導介面，圖形化的操
作引導介面，將搭配簡短的文字說明，降低圖
形說明可能產生的誤會，達到圖文相輔的效
果。
身處於廣大的華人世界裡，中文是通用的
文字，因此，本系統需要一套中文系統，作為
系統與使用者間溝通的文字介面，因此，MISS
必須要能支援中文與英文的顯示，而目前，
BIG5 是使用最廣泛的編碼方式，在網頁上與
電子郵件上所使用的編碼方式，也皆以 BIG5
碼做為基礎，所以我們選用 BIG5 碼格式，作
為 UI 的中文編碼格式。
若是一個電子用品得用上數十個按鍵去
控制，將會讓使用者感到產品的操作不便，因
為麻煩，而不想去使用，因此，本系統在按鍵
設計的規劃上，設計只用 8顆按鍵，便能操控
本系統的多媒體播放功能，本系統將透過鍵盤
掃描程式與按鍵作配合，判斷使用者輸入的動
作，讓使用者可以簡易的控制本系統，增加大
眾的接受度。
因應選擇檔名播放媒體的功能需求，本系
統必須能把 MSS 中的媒體檔名顯示在畫面
上，並且，在畫面上顯示指示框，框住檔名，
告知使用者目前所選的檔案，並且可以配合按
鍵操作，在畫面上移動，再藉由選框的位置，
判斷使用者所選取的曲目，本系統將以此三點
考量，構成選檔播放的功能。
由於本系統所提供播放 MP3 音樂、播放
JPEG 圖片、播放影音漫畫與播放 KTV 種媒體
的個播放功能，因此，本系統將設計了六張選
單，告知使用者按鍵操作的設定，以及播放的
多媒體環境。
圖五、UI 選單規劃
媒體解碼子系統(MDCS)
MDCS 主要的目的，在於處理各式多媒體
的解碼，與各式整合系統功能之演算法、以達
成特定整合目標的功能的呈現。
中文字碼結構與解碼
本系統使用 Open Source Linux 中的中
文字型檔案，STDFONT.24 與 ASCFONT.24 作為
中文、英文與符號字型，因此，本系統需判斷
各字碼的編碼範圍，ASCII 碼編碼範圍為
0~FF，BIG5 碼的編碼範圍在 A440~FEBE，系統
8是有在播放上，發生顯示時間的誤差，也可以
在該檔案加入提前或延遲結束的符號，修正字
幕顯示的時間，其規格如表 4 所示:
符號 定義
第 0~4Byte 歌曲速度
< 片頭標題起始符號
> 片頭標題結束符號
; 小節標示符號
( 字幕顯示符號
) 字幕停止顯示符號
+ 字幕提前顯示符號
- 字幕延遲顯示符號
表 4、歌詞歌譜同步定義檔格式
歌詞歌譜同步定義檔中的第0~4Byte，為
歌曲速度的定義，使用者僅需輸入歌譜上的的
歌曲速度，本系統便能將其轉換成相對的時間
長度，其速度轉換的規則將於KTV同步演算法
中說明，在本系統中，符號”<”與”>”，為
歌曲資訊標記起始符號與結束符號，它將供使
用者輸入ＫＴＶ片頭的標題，該標題將在歌曲
播
放前奏時，出現於畫面，符號”；”代表
傳統歌譜中的小節符號，本系統將以該符號計
算，歌曲進行時間，符號”（”與”）”之間
則是供使用者填入歌詞的區域，系統將會在該
段歌詞對應的時間中，顯示使用者輸入的歌
詞，由於字幕實際在畫面上顯示時，可能會有
些許的誤差，所以本系統設計了符號”-”與
”＋”，作為字幕顯示時間的微調符號，供使
用者放在要延遲或提前顯示小節中，其單位為
0.5 秒，若要延時1 秒，則以2 個”-”或”
＋”號標示，表示既可達到增長延時的目的，
當本系統讀取到ＥＯＦ符號，則表示歌曲結
束，關閉歌譜檔‧
KTV同步演算法
在市面上通用的樂譜中，都會在歌譜的開
頭標明歌曲速度，假設該符號為”120”，則
代表該歌曲 1分鐘有 120 拍，相當於每拍 0.5
秒，4/4 符號代表了 4 分音符為一拍，每小節
有 4拍，因此，系統可以換算出每小節為 2秒，
歌譜檔的 0~4BYTE，便是讓使用者輸入歌曲速
度與節拍單位的欄位，在歌曲播放時，本子系
統讀取到歌譜檔中的分號”；”(小節)內有文
字碼，則 KTV 解碼子系統便會把小節數換算成
秒數，製作成詞曲顯示時間表，我們設定
Timer3 每 10ms 中斷一次，中斷 100 次相當於
一秒鐘，當 Timer3 中斷秒數等於詞曲顯示中
斷向量表中的時間值時，便顯示該時間播出的
歌詞。
圖8、KTV歌譜檔範例
四、媒體整合儲存系統操作模式：
在使用媒體整合系統時，不論是媒體的新
增或移除，皆可以 USB 傳輸介面與 PC 連接，
此時 PC 端將會顯示發現先新增磁區的訊息，
使用者可藉由 Windows 的檔案總管，瀏覽媒體
整合儲存系統內的各個檔案與資料夾，藉以管
理更新媒體檔案。
圖 9、多媒體檔案傳輸模式
在單機操作模式下，使用者只須使用媒體
