 2
The digital cameras are becoming more 
and more popular nowadays. The digital SLR 
not only allows photographers to use 
inter-changeable lenses to get different 
ranges of zoom and depth of field, but also 
gives the users more controls, it helps to take 
a better picture. Recently the number of 
digital SLR users is rising steadily as the 
equipments drop in price. However, unlike 
film cameras, current digital SLR suffers 
from a frustrating weakness: sensor dust and 
hot pixels. In this study, we develop an 
automatic spots removal algorithm based on 
the inpainting technique. Several examples 
on real images are given to demonstrate the 
effectiveness of the proposed method. 
 
The images with long exposure time 
usually are affected by serious noise. This 
kind of noise is called hot pixels, which 
comes from the individual sensors on the 
CCD/CMOS with higher than normal rates of 
charge leakage. A two-stage noise reduction 
algorithm for hot pixels is proposed in this 
study. In the first stage, a hybrid vector filter 
for color image is developed to remove the 
impulse noise and Gaussian noise. The goal 
of the second stage is to remove the large hot 
pixels in the R and B channels. We first 
propose a noise detection algorithm to 
identify the hot pixels, it uses the Sobel filter 
and the morphology operations. The 
proposed inpainting algorithm is then used to 
fill holes of hot pixels in images, it achieves 
accurate propagation of linear structures. 
 
Keywords: Image inpainting, Edge structure 
reconstruction, Sensor dust, Hot pixels, 
Vector filter. 
 
二、研究動機與目的 
數位相機的技術在最近這幾年來有了
突破性的進展，由於其省去了傳統相機需
要沖洗底片的麻煩，所以使用數位相機的
人口正快速的增長中。而隨著數位單眼相
機價格下滑，以及喜愛攝影的人口增加，
單眼相機強大且精準的測光性、優異且精
準的對焦功能、高感光度以及高擴充性，
例如其可更換多種鏡頭，包括廣角鏡頭或
長鏡頭，以及可以外接各種閃光燈等等。
另外也可以因應自己需求，調整快門時間
及光圈大小，種種專業的功能，使得使用
單眼相機的人數大為增加。 
 
不過，雖然單眼相機有上述許多優
點，但由於數位單眼相機是透過電力操控
機械設備，容易產生輕微的靜電，因此在
更換鏡頭的時候，若不注意就很容易將小
塵埃吸入 CCD 上，所以在拍攝的時候，
可能在照片上產生小汙點，這就是所謂的
「染塵現象」，如圖 1所示，(a)為一張有
染塵的原始影像；(b)則為(a)的天空局部放
大圖，可以發現在天空中有許多顯而易見
的雜點。 
 
  
(a)                 (b) 
圖 1 (a)有 CCD 染塵現象的影像；(b)為(a)
的天空局部放大圖 
 
一般來說，如果單眼相機出現染塵現
象，大部分都得送往廠商手動清除，不過
通常價格昂貴，而且一不小心就有可能傷
及 CCD，到時候可能更要花一大筆費用來
修理。最近也開始有相機廠商發明出「感
光元件自我清理架構」，其原理是使用壓
電元件產生超音波震動，讓粉塵脫落，但
這樣的機制，可能還是無法對付黏度較高
的粉塵，因此在本研究中，我們利用影像
處理技術來解決此問題。 
 
首先，如果利用一般去雜訊的方法，
例如：中值濾波器(median filter)，雖然對
於一般的脈衝雜訊能夠處理的很好，但是
由於大部份的粉塵所造成的雜點都較大，
所以利用傳統去雜訊的方法將會失敗。如
圖 2(a)所示為一張有脈衝雜訊的影像；(b)
是利用中值濾波器去脈衝雜訊後的結果，
可以發現效果很不錯。而圖 3所示為圖 1 
(a)有 CCD 粉塵雜點的影像經過大小為
33× 的中值濾波器去除雜訊的結果。我們
可以發現，天空中仍然有許多粉塵殘留，
而且影像的細節也被模糊化了。 
 4
熱燥點的產生只要是由於取代傳統底
片的數位感光原件 CCD / CMOS 所造成
的。其本身是一個消耗能量與電力的設
備，而有能源的消耗，自然就會產生熱量，
『熱』導致晶片材質的電子活動加劇，受
熱的電子不斷的運動而產生了電流，形成
所謂的『暗電流』（black level）。理想的
光感測器其暗電流應該是零，但現實世界
裡這樣的理想材質還在研究階段。當然，
還有其他因素同樣會影響暗電流的產生，
然而『熱』卻是最顯著的影響因素。暗電
流的存在，讓即使沒有光進入數位相機之
中，卻因光電二極體自行釋放的電流，彷
彿開了另一道『窗口』感應光線；當暗電
流電壓與低亮度光的電壓相當時，感光原
件的畫素就彷彿『看到了』景物，從而導
致曝光，並將結果呈現在畫面上。當以慢
速快門拍攝時，影像中即會顯示雜訊，它
以隨機分佈的形式出現。而在長時間曝光
(通常 3-10 秒以上)下更會產生嚴重的熱燥
點，產生原因是因為 CCD 等感光元件在長
時間曝光所產生的高熱造成。這些雜訊使
得影像的品質變差，而在這些品質不佳的
影像上做處理往往得不到正確且理想的結
果，為了改善影像的品質，以利於人眼的
辨識或是後續的電腦分析，影像雜訊消除
的技術就變成相當的重要的前處理步驟。 
 
現在許多高階數位相機會設計雜訊抑
制功能(noise reduction)，讓您即使長時間
的曝光後仍可得到最佳的影像品質，這項
功能可以自動消除影像雜訊。但這個方法
有兩個限制：(一)目前通常一般數位相機的
極限在 3~10 秒，超過該感應器的極限，雜
訊會急速大量出現，此時雜訊抑制的效果
就幫不上忙。(二) 由於完成此處理過程需
要一定時間，因此當應用雜訊抑制功能
時，拍攝影像所需的時間將增加約一倍。
有些數位相機可以設定是否使用雜訊抑制
功能，有的數位相機則是快門速度低於預
設的速度時，或在特別的場景模式下就會
自動啟動，因為使用雜訊抑制功能需經過
大量的運算處理，因此對於連拍與拍照間
格上必有影響。通常曝光時間越長，雜訊
抑制運算時間也越長，有時甚至運算時間
會長達 20 秒。許多影像處理軟體也提供雜
訊抑制或雜訊移除的功能，圖 5所示為分
別 以 影 像 處 理 軟 體 Photoshop 與
Photoimpact 去除雜訊的結果，可以發現其
對圖 4中脈衝雜訊有顯著的抑制效果，但是
通常也會造成影像細節的模糊。另一更嚴
重的問題是，其對在紅與藍頻道所產生面
積較大的熱燥點則幾乎完全沒有效用。 
 
 
(a) 
 
(b) 
圖 5 以影像處理軟體去除雜訊的結果。(a) 
以 Photoshop 的 median filter 濾波後的結
果；(b) 以 Photoimpact 的 Reduce noise 去
除雜訊的結果 
 
如前面所提，熱燥點依其特性可以分
為兩種，一種為近似脈衝雜訊的雜點，通
常為 1 pixel 大小；另一種雜訊通常散佈在
紅藍頻道，大小較大，可以達數 pixels。目
前已有許多的線性或非線性的雜訊濾波器
被提出，他們可以有效地去除雜訊，然而
其卻也把影像中重要的細節也模糊化了。
為了有效去除第一種雜訊，本研究提出一
混合式向量濾波器，其結合了以脈衝雜訊
偵測為基礎的向量中值濾波器與適應權重
向量濾波器。此濾波器能有效復原受雜訊
干擾的數位彩色影像，而達成雜訊的移除
和邊緣保存。其主要的優點有： (1)所提改
進之雜訊偵測演算法可以有效的降低在影
像邊緣和細節部分的錯誤偵測，利用反覆
的偵測雜訊而有較高的正確性；(2)所提之
適應權重函數在於邊緣的像素有更為正確
 6
第三，我們使用貝茲曲線（Bezier curves）
來連接相配的邊緣，讓修補出來的曲線跟
原本的邊緣可以銜接的很自然，且可以描
繪出更真實的邊緣。 
 
三、研究方法 
以下將介紹本研究中的影像修補技
術、雜訊偵測演算法及如何使用影像修補
技術移除染塵與熱燥點。 
 
3.1 影像修補技術 
影像修補最大的挑戰就是如何能在大
面積的修補中，又能有效保留影像中的邊
緣結構與紋理特性。我們的研究是以
A.Rares 等人提出的基於邊緣影像修補演
算法（edge-based image restoration）為基
礎，依照其修補方法做延伸。 
圖 6是我們所提出的基於貝茲曲線影
像修補演算法之流程圖，我們將整個影像
修補流程分成四個步驟：(1)邊緣偵測及邊
緣特徵的取得；(2)影像骨架結構的重建；
(3)以像素為單位的邊緣修補；(4)基於範例
的修補。以下我們將依照影像修補流程，
分別敘述每個步驟的作法。 
 
 
圖 6 所提影像修補演算法的流程圖 
 
(1)邊緣偵測及邊緣特徵的取得： 
為了不讓分割時間影響了修補速度，
我們使用有效的迭代臨界值分割法[9]來獲
得分割結果。從相關文獻中，我們可以看
出有效的迭代臨界值分割法在速度上已經
有大幅的改進。在影像分割的這個步驟，
我們必須決定要將影像分成幾個群組，由
於我們的目標是想要找出物件之間的邊界
（即影像邊緣），一般而言分成兩個群組
的分割結果就能達到邊緣偵測的目的了。 
 
決定了群組個數後，我們將遮罩
（mask）影像執行有效的迭代臨界值分割
法，得到分割結果。有了分割結果，我們
根據遮罩（即損壞區域）偵測出目標區域
周圍的邊緣，也一同取得這些邊緣的特
徵，例如：邊緣兩側的亮度及邊緣的梯度
大小。如圖 7所示，(a)為 lena 的原始影像；
(b)是遮罩影像；(c)則是使用有效的迭代臨
界值分割法分成兩個群組所得到的分割結
果圖；(d)為邊緣偵測的結果，使用黑色矩
形將目標區域標記出來，另外目標區域周
圍的黑色線段則是我們根據分割結果圖所
偵測出來的邊緣；(e)則是目標區域周圍的
局部放大圖。 
 
  
(a)               (b) 
  
(c)              (d) 
 
(e) 
圖 7 邊緣偵測 (a)原始影像；(b)遮罩影
像；(c)使用有效的迭代臨界值分割法所得
到的分割結果圖；(d)邊緣偵測的結果，目
標區域周圍的黑色線段是我們所偵測出來
的邊緣；(e)目標區域周圍的局部放大圖 
 8
越平滑。如圖 11所示，(a)為建構二次貝茲
曲線的三個定點 0P 、 1P 、 2P 之示意圖，灰
色實線是邊緣前端和尾端兩個像素之間的
線段，灰色虛線表示邊緣的延伸線；(b)則
是根據二次貝茲曲線所描繪出來的連接曲
線。 
 
(a)                (b) 
圖 11 二次貝茲曲線 (a)建構二次貝茲曲
線的三個定點 0P 、 1P 、 2P 之示意圖；(b)根
據二次貝茲曲線所描繪出來的連接曲線 
 
另外，若相配邊緣找不到圓心時，例
如：相配的兩個邊緣分別是直線且兩者是
平行的；或者相配邊緣延伸線的交點不是
一個點時，我們使用線性貝茲曲線去連接
相配的邊緣。給定兩個定點 1P 、 2P ，然後
根據下面的公式(2)即可將連接相配邊緣的
直線描繪出來。 
 
 ( ) ( ) [ ]1,0        1 21 ∈+−= ttPPttB  (2) 
 
其中 1P 是指相配邊緣裡，其中一個邊緣的
前端之第一個像素位置； 2P 是指相配邊緣
裡，另一個邊緣的前端之第一個像素位
置。如圖 12所示，圖上的藍色點 1P、 2P 即
是我們要的兩個定點，灰色虛線則是根據
線性貝茲曲線所描繪出來的連接線。 
 
圖 12 建構線性貝茲曲線之示意圖 
 
找到最佳的骨架結構且得知目標區域
的曲線位置後，我們使用以像素為單位的
修補方式（即內插的方式）將相配的邊緣
優先修補完成。其概念是越靠近待修補像
素的已知像素，越有可能影響待修補像素
的強度（intensity）。所以待修補像素的強
度由相配邊緣前端的第一個已知像素來決
定，且根據待修補像素與已知像素之間的
距離給予不同之權重值。如圖 13所示，像
素 P 的強度由像素 1P 和像素 2P 決定。其計
算公式如下： 
 
 
21
21
21
ωω
λωλωλ +
+=
PP
P  (3) 
 
其中 1Pλ 、 2Pλ 是指相配邊緣前端的第一個
已知像素 1P、 2P 之強度； { }2,1, ∈iiω 表示像
素P 到像素 iP 之間的距離，其定義如下： 
 
 ( )PPi xxd i ,/1=ω  (4) 
 
其中 iPx 表示像素 iP 的位置；
Px 表示待修
補像素的位置； ( )d 則是計算像素 iP 和像
素P 兩者之間的歐式距離。 
 
 
圖 13 以像素為單位的邊緣修補 
 
(4)基於範例的修補 
為了保持材質的特性，除了邊緣的修
補是使用內插的方式以外，剩下區域的修
補我們是採用Criminisi等人[7]提出的基於
範例影像修補演算法。我們會採用此方法
有兩個因素：1、以區塊來修補目標區域能
夠將材質的特性保存下來；2、有考慮到修
補區域周圍的影像資訊。這個方法在決定
那個區塊要優先修補時，參考了兩個因
素：1、此區塊的已知像素個數比例，其值
越大代表此區塊可信賴的資訊越豐富；2、
此區塊的變化程度，其值越大表示此區塊
越不平滑（smooth）。為了讓目標區域中
已修補曲線的已知像素個數比例提高，我
們則繼續用內插的方式將目標區域中的曲
線加寬，如圖 14所示，(a)為一個像素寬的
邊緣修補結果；(b)為五個像素寬的邊緣修
補結果。 
 10
補滿以利之後移除的動作。如圖 19所示，
(a)是套用Sobel運算子在圖 16(a)將粉塵雜
點邊緣偵測出來的結果；(b)則是在(a)取一
個臨界值做影像二值化的結果，而此張影
像的臨界值我們取 27；(c)則是針對(b)的結
果作擴張運算，將原本結構不完整的粉塵
雜點都填補起來，以利之後將粉塵從影像
中移除。由於在影像上會出現粉塵雜點是
因為在相機裡頭的 CCD 染塵，所以出現在
影像上的粉塵位置都是固定的，因此圖 
19(c)就可以作為我們的遮罩(mask)，針對
所有同一台相機所拍攝的影像，都可以套
用同一張遮罩將影像上頭的粉塵雜點標記
起來，如圖 19(d)所示，其結果即為利用圖 
19(c)所得到的遮罩將圖 16(a)的粉塵雜點
標記起來。因此，我們只需要利用上述方
法做一次粉塵偵測的動作，將影像上粉塵
雜點的位置偵測出來以作為我們的遮罩，
那麼只要是同一台染塵相機所拍攝的影
像，就可以套用同樣的遮罩將其粉塵雜點
標記出來，而不需要每張影像都要再做一
次粉塵偵測的動作。 
 
  
(a)                 (b) 
  
(c)                 (d) 
圖 19 (a)將 Sobel 運算子套用在圖 16(a)所
得到的結果；(b)對(a)取臨界值(threshold = 
27)做影像二值化的結果；(c)對(b)做擴張運
算後的結果；(d)利用(c)所得遮罩將圖 16(a)
的粉塵雜點標記起來 
 
我們觀察圖 1(a)被修補過後的結果，
如圖 20所示，(a)為利用圖 19(c)所得到的
遮罩將圖 1(a)的粉塵雜點標記起來，我們
可以發現粉塵雜點不只落在天空中，也落
在右邊大樓的窗戶結構上以及影像中許多
線性結構的地方；(b)為利用所提影像修補
演算法來作修補的預期結果，我們發現不
但天空變得非常潔淨，而且影像中所有物
體的結構都保持的很好；(c)則為(b)修補過
後的天空局部放大圖，我們可以跟圖 1(b)
做比較，很明顯地，該演算法可以將天空
中的粉塵雜點有效地移除。 
 
  
(a)                (b) 
 
(c) 
圖 20 (a)為圖 1(a)的遮罩影像；(b)利用所
提影像修補演算法來作修補的預期結果；
(c)為(b)的天空局部放大圖 
 
3.3 使用影像修補移除熱燥點 
為了有效偵測並去除熱燥點雜訊，在
本研究中我們提出一個兩階段的雜訊去除
演算法，其能正確偵測出熱燥點雜訊位
置，並且在保留影像細節與邊緣資訊的情
況下將雜訊移除，所提演算法流程圖如圖 
21所示。 
 
Hybrid Vector 
Filter 
Inpainting Based 
Hot Pixels 
Removal 
Input Image 
Output Image 
 
圖 21 所提兩階段的雜訊去除演算法之流
程圖 
首先針對脈衝式雜訊與可能存在的高
斯雜訊，在多種消除雜訊的濾波器中
[10-14]，我們對向量中值濾波器[10]和適應
資料濾波器[14]提出改進的方法，並結合此
 12
再利用形態學中的連通成分法(connected 
components)將過大的雜點去除。 
 
(2)使用影像修補移除熱燥點 
由於前一節所偵測出的熱燥點面積都
相當大，為了能有效維持影像中的材質與
線性結構的完整，我們將利用所提的影像
修補法來移除熱燥點。 
 
四、研究結果與討論 
以下將分別展示影像修補及運用影像
修補來去除染塵、熱燥點的研究成果。 
 
4.1 影像修補研究結果 
 
  
(a)               (b) 
  
(c)                (d) 
  
(e)                (f) 
 
(g) 
圖 24 比較所提方法、基於邊緣影像修補
演算法[8]與基於範例影像修補演算法[7] 
(a)原始影像；(b)遮罩影像；(c)使用貝茲曲
線所描繪出來的連接線；(d)使用局部的圓
形所描繪出來的連接線；(e)基於(c)所得到
的最後修補結果；(f)基於(d)所得到的最後
修補結果；(g)基於範例影像修補演算法之
修補結果 
我們使用兩組真實影像來說明所提的
影像修補演算法確實能達到同時修補結構
與材質的目標。 
第一組實驗目標是將十字架移除，且
能完整的修復曲線結構。如圖 24 所示，(e)
是我們所提方法修補出來的結果，和使用
局部圓形而修補出來的結果(f)比較，可以
看出連接邊緣的曲線描繪的好不好，將會
影響最終結果。而使用基於範例影像修補
演算法修補出來的結果(g)，因為此方法只
適合修補直線結構，所以會有錐狀產生，
無法重建圓弧的曲線。 
 
  
(a)                (b) 
  
(c)                (d) 
  
(e)                (f) 
  
(g) 
圖 25 比較所提方法與基於邊緣影像修補
演算法[8] (a)原始影像；(b)遮罩影像；(c)
一個像素寬的邊緣修補結果；(d)所提的基
於貝茲曲線影像修補演算法之修補結果；
(e)基於邊緣影像修補演算法之修補結果；
(f)為(d)的局部放大圖；(g)為(e)的局部放大
圖 
 
第二組實驗目標是移除其中一隻長頸
鹿，並且能重建線性的影像結構及保留材
質特性。如圖 25所示，(d)是我們所提方法
的修補結果，可以發現使用範例的修補方
法，草原跟天空的材質皆保存的很好；反
之，使用內插方法的修補結果(e)，草原部
份只保留了顏色，草的材質特性不見了。 
 
 14
  
(a) 
 
(b) 
圖 29 所提兩階段熱燥點去除演算法的結
果。(a) 長曝光時間之數位影像 (曝光時間
為 980 秒)；(b) 所提演算法去除熱燥點雜
訊的結果 
 
  
(a) 
 
(b) 
圖 30 所提兩階段熱燥點去除演算法的結
果。(a)長曝光時間之數位影像 (曝光時間
為 649 秒)；(b)所提演算法去除熱燥點雜訊
的結果 
五、結論 
本研究提出一個基於貝茲曲線的影像
修補演算法來處理影像修復的問題。我們
結合了基於邊緣影像修補演算法中的自動
重建影像結構之優點及基於範例影像修補
演算法中的保持材質特性之優點，更重要
的是加入了使用貝茲曲線來描繪相連邊緣
的想法，此概念讓修補後的邊緣更自然、
更符合我們所期待的效果。另外，在影像
分割上，我們利用有效的迭代臨界值分割
法取代分水嶺分割法，其可以解決過度分
割的問題及減少分割的計算時間。 
另外，為解決數位單眼相機 CCD 染塵
與長時間曝光攝影所造成的熱燥點問題。
一開始我們先發展自動的粉塵與熱燥點偵
測演算法，其能自動偵測出數位相片中的
粉塵與熱燥點。接著提出一個兩階段的熱
燥點雜訊去除演算法來消除長曝光數位影
像中的各種雜訊，包含脈衝雜訊、高斯雜
訊，與感光元件過熱所產生的熱燥點。在
第一階段的雜訊去除演算法，我們先對向
量中值濾波器與適應資料濾波器提出改
進，並結合此二種方法而提出一混合式向
量濾波器演算法來解決混合有高斯和脈衝
雜訊的影像雜訊去除問題。在第二階段的
雜訊去除演算法，我們則提出計算所謂的
雜訊地圖(noise map)，並利用 Sobel 濾波器
與形態學的運算來正確偵測雜訊位置。由
於該雜訊面積都相當大，本研究使用所提
的影像修補來把此種雜點去除，如此一來
便能有效維持影像中的材質與線性結構的
完整。 
 
六、參考文獻 
[1]M. Ashikhmin, “Synthesizing natural 
textures,” Proceedings of ACM 
Symposium on Interactive 3D Graphics, 
pp. 217-226, 2001. 
[2]A. Efros and T. Leung, “Texture synthesis 
by nonparametric sampling,” Proceedings 
of International Conference on Computer 
Vision, Kerkyra, Greece, pp. 1033-1038, 
1999. 
[3]A. Efros and W. T. Freeman, “Image 
quilting for texture synthesis and 
transfer,” Proceedings of ACM 
Conference on Computer Graphics 
(SIGGRAPH), pp. 341-346, 2001. 
