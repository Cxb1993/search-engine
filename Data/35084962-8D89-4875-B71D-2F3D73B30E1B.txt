中文摘要 
 
關鍵詞：Mass Storage裝置，Video裝置，USB OTG，嵌入式系統，Linux，Samsung 
S3C2410。 
 
隨著多媒體時代的來臨，新的可攜式或是掌上型的產品，如 PDA或是 Packet PC
等設備不斷地被開發與設計影像與語音的功能，因此，相關的延伸應用也是各個電子
廠商所要切入的研發重點與產品整合的目標。但是原本的 USB產品僅具備從裝置的特
性，也僅能連結至 PC主機而已。這使得具備 USB的電子產品或是週邊設備的應用就
被嚴重地侷限了。 
而新的 USB OTG 規格的提出，使得 USB 週邊設備可以同時具備主/從架構的特
性，並可滿足各種不同的應用需求。在各種的 USB週邊設備中，以Mass Storage群組
與 Video 裝置的應用是最為普及與重要的。因為幾乎各種的 USB OTG 裝置都需要與
Mass Storage群組裝置連結一起，以省去 PC主機直接播放 MP3音樂或是秀出影像的
步驟，或是透過 USB webcam來補抓影像。而若要將 USB webcam影像直接儲存至 USB
硬碟的話，那麼只要是符合這兩種群組的 USB OTG 裝置皆可直接加以應用與連接，
相當地便利與彈性。因此，本計畫特別提出了整合兩種群組的可彈性連結之 USB OTG
嵌入式錄放影系統。而這種架構的錄放影機，也顛覆了傳統類比式或是數位式錄放影
機的設計方式。 
在這個計畫中，為了加速影像的抓取與快速地儲存影像資料，特別以 Samsung 
S3C2410為架構之嵌入式系統來開發設計。此外，在 Linux作業系統中，針對 USB OTG 
Mass Storage群組與 Video群組設計其週邊電路以及設備驅動程式，以增加整體系統的
穩定度。 
 
 
 
 
 
 
 I
報告內容 
一、前言 
隨著 3C 電子產品逐漸地融合了一般傳統的 PC 主機後，家電電腦化，電腦家電化
的趨勢也就越來明顯。因此，我們慢慢地可以發現到現在的家電與電腦之間的區隔也就
越來越模糊。當然，再隨著可攜式產品，如 PDA 或是掌上型電腦等的嵌入式系統逐漸
變成新的消費性電子產品的主流後，而其所具備的便利性，獨立性，可攜性，以及強大
的操作功能，更加速電子產業的相互整合的潮流。 
而目前要跨越一般傳統的家電與PC主機的鴻溝，最簡易與方便，也是唯一的介面即
是USB介面。透過這種USB介面，各種可攜式多媒體儲存裝置，就可以隨心所欲地相互
的存取影像，圖片或是MP3音樂。在個人產品的使用上，如Web Pad，PDA，Smart phone，
或是Audio Applications更是常見其相關的應用。 
隨著多媒體技術的發展，尤其影像以及資料儲存裝置的需求最為迫切，此兩種USB
介面的裝置與多媒體技術有直接的關聯性，所以研究開發相關的技術是十分的重要的。 
 
二、研究目的 
本計畫的目的即是建立可彈性連結之 USB OTG 嵌入式數位錄放影系統，並且設
計其 Linux作業系統的設備驅動程式。而由於在目前所進行的研究計畫”具備 USB OTG 
Mass Storage群組裝置之嵌入式系統設計與實現”（93-2213-E-150-030-）中，預計實現
USB OTG的規格的Mass Storage群組的週邊電路與其驅動程式。因此，本計畫是將原
先在 ARM7 架構下的 ucLinux USB Mass Storage 群組驅動程式移植到以 Samsung 
S3C2410為主的 Linux作業系統下，並且將開發的 USB Video群組驅動程式，加以整
合在一起以實現從 USB靜態影像攝影機裝置將影像補抓至 USB隨身碟中的功能。 
透過本計畫的實施，將可同時開發與取得 USB OTG的核心技術。此外，也可將相
關的技術延伸至 Samsung S3C2410為主的嵌入式平台上。原計畫是採用 Intel Xscale嵌
入式系統，但其不無法與USB OTG整合，加上目前USB OTG晶片組侷限在Mass storage 
bridge的應用上，不符我們所需。因此，本計畫修正採用 USB主晶片組與從晶片組整
合的 Samsung S3C2410。透過具備主與從整合的 Samsung S3C2410來模擬 USB OTG晶
 1
最主要的原因是 USB OTG 是新的規格，相關的半導體廠商近日來才推出相關的晶片
組。而在 ”具備 USB OTG Mass Storage 群組裝置之嵌入式系統設計與實現 ”
（93-2213-E-150-030-）計畫中，已初步建構出模擬 USB OTG的系統。而國外的半導體
廠商雖有設計相關的發展平台，但也僅止於泛用型的應用而已，對於 USB OTG Video
群組裝置驅動較少公佈，如此，實有切入與開發的需求。再者，由於主持人過去的相關
論文與所著的專書中，已具備諸多 USB 介面相關技術的基礎背景與成熟的開發技術，
因此在推動此計畫實經過審慎的評估與考量。換言之，其可行性甚高，也相對地有其研
究與發展的必要性。 
 
四、研究方法 
本系統主要以 Samsung S3C2410 ARM處理器為核心，並以 Linux kernel 2.4為平台 
上主要的作業系統。並以 Qt/Embedded 嵌入式圖形開發工具(2.3.7)設計出能讀取多組
USB Webcam影像之應用程式。讓使用者可自行設定相關拍攝參數、以及設定選擇是否
將拍攝結果儲存於嵌入式系統的儲存裝置中（CF卡、SD卡或是 USB隨身碟或是硬碟，
屬於 USB Mass Storage）。以下就幾個部分來說明整個系統的設計方式： 
4.1  嵌入式錄放影系統 
如圖 1所示，為本系統的影像擷取主要的平台。外部裝置透過單一 USB介面來傳
輸，經由 USB Hub來擴接多組 USB CCD，可以擷取多通道之影像。此部分 USB CCD
的驅動程式部分主要是由 Linux 中的 OV511 及 video 等驅動模組來實現，並由
QT/Embedded所設計的程式中來顯示擷取到的影像。 
 3
 圖 2、無線感測器（磁簧開關） 
4.3 使用者操作介面及儲存管理單元 
除了即時的影像顯示之外，影像資料的儲存管理在錄放影系統中也相當重要，因為
使用者不可能無時無刻來監看系統中的影像，所以本系統必須將各通道所擷取的影像檔
存到儲存媒體之中，如 CF卡、SD卡或 USB隨身碟或硬碟。而因為在嵌入式系統中通
常是在沒有螢幕顯示的情況下來做文字模式的操作，這針對使用者的使用上有所不便，
在此利用觸碰式液晶螢幕的圖形化介面來讓使用者來做整個操作，可以用較簡單的方式
來對系統做設定調整。此外，除了上述所規劃的使用方式之外，也考慮本系統的通訊能
力，在此系統中還建立了Web伺服器，可以讓使用者不用直接對系統的操作下，來取
得系統中的資訊。 
 
五、結果與討論 
    對於各種的嵌入式系統的監視應用領域來說，透過USB主機所建置出來的可彈性連
結之USB OTG嵌入式數位錄放影系統，可以達到了不需繁雜的操作步驟就能建立出一套
功能完備與達到遠端控制與即時監控的功能，並具備儲存拍攝影像之功能，方便日後查
閱之需要。其中，運用USB HUB的擴充以及USB介面隨插即用的特性，將使得整個系統
更具彈性與擴充性，可以輕易地彈性擴充出數十通道影像分割擷取系統。而根據相關規
格與技術，其最高可達127組的控制模組（如圖3所示），當然，這樣的應用場合目前並
無需求，但我們的系統已具備了這樣的功能。實際影像擷取與操作畫面如圖4、圖5、圖
 5
 
圖 4、拍照模式時間日期戳記 
 
 
圖 5、圖形化使用者操作介面 
 
圖 6、4通道分割影像處理畫面 
 
 
圖 4 顯示了拍照時另外設定時間日期戳記，方便日後查循。而圖 5 則是整體圖形化
使用者介面，我們可以設定每次拍攝的時間與間隔，以及是否是自動拍攝等功能提供最
佳的人性化操作介面。使用者亦可設定所拍攝的畫面所要存放的儲存媒體為何？在此，
可以存放在 CF卡、SD卡或是屬於 USB Mass Storage 的 USB隨身碟或是硬碟。方便使
用者根據自己的需求與時間或容量空間來調整。 
而圖 6則是設定成 4分割後的拍攝畫面。使用者可彈性擴充所要連接的 Webcam數
目，來延伸出 4分割，或 9分割等多畫面的監測與數位錄放影功能。 
而如下圖 7 所示，則提供另一種透過遠端 PDA 的 IE 瀏灠器來取得系統中的影像功
能，方便使用者在遠端的 PC server或是可攜式產品上來監測所拍攝的畫面。 
 
 7
[12] Jean J. Labrosse, “MicroC/OS-II, The Real-Time Kernel”, R&D Books, 1998. 
[13] Jean J. Labrosse, “Embedded Systems Building Blocks”, R&D Books, 1999. 
[14] Todd D. Morton, “Embedded Microcontrollers”, Prentice Hall, 2000. 
[15] S.B.Furber, ”ARM System-on-chip Architecture”, Addison Wesley Longmain,  
2000. 
[16] S.B.Furber, ”ARM System Architecture”, Addison Wesley Longmain, 1996. 
[17] Micbael Barr and Andy Oram, “Programming Embedded Systems in c and  
c++”，O’REILLY, 1999. 
[18] Jean J.Labrosse, “Embedded Systems Building Blocks: Complete and  
Read-To-Use Modules in C”, Second Edition, CMP books, 2000 
[19] Kirk Zurell, “C Programming for Embedded Systems”, R&D Books, 2000. 
[20] Alessandro Rubibi, Jonathan Corbet, “Linux Device Driver”, 2nd Edition, 2001. 
[21] John Lombardo, “Embedded Linux”, New Riders, 2000. 
[22] 王若黠，“建置嵌入式系統--使用 Linux Embedded Linux”，碁峰出版社 
[23] 陳清豪，”內嵌式 Linux系統--硬體、軟體與介面”， 碁峰出版社 
 
七、計畫成果自評 
在本計畫執行期間，自我評鑑每一階段技術的開發部分，包含了下列幾點： 
(一)  嵌入式系統的工作平台移轉與測試 
    將在前一個計畫中所修改的 Linux kernel與驅動程式移植到 Samsung S3C2410平台
中，並詳細測試其 USB各群組之驅動程式的相容性與穩定性，並確認其電路中的晶片
組的限制，待完成全部之測試後，重新燒錄新的 kernel到 flash記憶體中。 
(二)  USB OTG Video群組裝置之設備驅動程式的設計與整合 
     完成嵌入式平台的移轉之後，對於 USB群組的驅動程式仍缺乏 Video群組的支
援，此處藉由 open source的驅動程式來做部分修改，並參考一些 Linux下常見的影像擷
取程式來針對本系統的需求做修改，來達成 Video裝置的控制。 
 9
