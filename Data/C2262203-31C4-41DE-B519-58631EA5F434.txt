  
 
乙太被動式光纖網路上動態頻寬配置機制之研究 
計畫編號:    NSC 94-2213-E-027-010- 
計畫主持人:    王永鐘   副教授           國立台北科技大學  電機工程系 
                                計畫共同主持人:    王振興   副教授        國立台北科技大學  電機工程系 
計畫執行期間:    94. 8 ~ 95. 7 
計畫參與人員:  蔡復翔(博士生) 、盧承忠（碩士生）、胡程偉（碩士生）  
國立台北科技大學  電機工程系 
                                                               
摘要—利用乙太被動式光纖網路(EPON;Ethernet Passive 
Optical Network)來解決接入網端最後一哩問題是眾所
期 盼 的 一 個 方 案 ， 本 文 提 出 動 態 頻 寬 保 證
(DABG;Dynamic Allocation with Bandwidth Guaranteed)
排程方法，以固定的時槽時間搭配動態的多餘頻寬分
配，除了能達到不同程度的品質服務外，尚能將系統
平均封包的延遲及變異性達到最小。 
 
一 、前言 
 
全球電信市場的開放，加速寬頻網路時代的來臨，相
對的種種的網路服務相繼問世，增加頻寬的想法由使
用者端往上追溯。使用者想增加頻寬則對於骨幹網路
的能力也一定必須相對提升，然而現在的骨幹網路大
多都是光纖的系統架構，最大的問題反而是所謂的最
後一哩(Last Mile)問題[1-2]，意即位於用戶迴路的資料
匯集至骨幹網路的接取網路，因其佈建成本與困難
度，造成接入網端和用戶端的連接成為最大的瓶頸，
而乙太被動式光纖網路是可以解決這樣的問題的。 
EPON 乃採用點對多點傳輸結構，一套典型的
EPON 系統是由 OLT、ONU、 POS(Passive Optical 
Splitter)所組成。OLT 放在中心機房 (CO，Central 
Office)，可簡單的區分成對內和對外的兩個接口，對
內是與系統內 ONU 單元相連接，對外則是往外接到網
際網路端，它可以是個第二層交換機或是第三層路由
器。將來 10Gbit/s 的乙太網路技術標準制定後，OLT
也將會支援類似的高速接口，並且 OLT 亦可透過 E1
接口來實現傳統的 TDM 語音的接入。ONU 為置放於
用戶端的設備，EPON 中的 ONU 皆採標準乙太網路協
議，實現了成本低廉的第二層交換甚至是第三層路由
的功能，而 ONU 可多個堆疊使用來提高用戶端高速的
頻寬。由於使用乙太網路協議，在通信的過程中，就
不像 ATM 需要做協議的轉換，達到 ONU 對用戶數據
的透明化傳送。 
EPON 系統是採用廣播式的由 OLT 往下傳送封包
給 ONU，而 ONU 在接收端會依照自己 ONU 的獨立編
號來過濾出自己所要截取的封包，這樣的做法和乙太
網路上的傳輸是一模一樣的，其餘的則一律丟棄不予
理會。上行部分則是利用分時多工 TDM 技術，每個
ONU 會有固定的一段時間將封包放置於指定的時槽上
傳送到 OLT 端[6]，除了這段時間之外此 ONU 是不能
任意的將封包上行的，分別如圖一和圖二所示。 
 
圖一  PON 系統的下行傳輸(廣播) 
 
 
圖二  PON 系統的上行傳輸(TDM) 
 
    PON 的優勢不僅在於利用光纖提供高品質與高頻寬
的服務，同時由於 PON 架構僅在局端及用戶端設備使
用到主動元件，在兩端中間的傳輸線路中完全使用被
動式光元件，例如光分歧器。因此避免了主動元件暴
露在一般環境中可能衍生的許多施工或維修問題，且
無須顧慮遠端電力輸送及控制的問題。 
最初考慮使用在 PON 系統上的是 TDMA 排程方
法[4]，它具有簡單、易於實現、計算量小等的優點，
這個方法主要是利用每個 ONU 固定時槽時間的方式，
只有在屬於自己的時槽時間才可以進行上傳的動作，
其餘的時間來自各個使用者或是 LAN 的資料必須先暫
存在 ONU 的佇列中等待傳送。這樣的方式使得每個
ONU 不會發生上傳資料碰撞的情形，乍看之下是解決
了問題，但是當系統負載非常輕時，仍然會有某些時
槽有溢滿的情形發生，這是因為訊務流量都集中在少
數的 ONU 上；當系統負載非常重時，也是會有些時槽
時間沒有使用到，這是因為每個 ONU 的訊務流量並不
一致。 
針對這樣的一個缺乏靜態統計能力的狀況，
IPACT(Interleaved Polling with Adaptive Cycle Time)[5]
主張以一問一答輪詢的機制來交換 OLT 與 ONU 之間
的資訊，OLT 依照 ONU 端的需求量來斟酌給予其許可
 2
  
何的許可命令，這也暗示著將會一有小段頻寬的浪
費，但在後面的模擬分析下將會發現這樣的損失是極
微小的。 
 
圖四 OLT 服務情況二之圖解 
 
步驟五：ONUn收到來自OLT的許可命令或是ONUi+1
的時槽時間抵達 
 
    依照步驟四的判斷會有情況一或是情況二的結果，
若OLT判斷為情況一的情形時將會發出許可訊息給
ONUn，ONUn收到此許可訊息後表示這是一次額外的
上傳機會，可以送出許可大小的資料量並開是上傳資
料，同樣的，第一筆上傳的資料為控制命令。這樣一
來又會面臨到步驟四考慮的兩種狀況：ONUn的上傳資
料量剛好佔據了整個剩餘的時槽時間；ONUn的資料量
過小，無法有效的利用頻寬而剩餘過多的時槽時間，
對於這樣的問題後面章節將會討論。若OLT判斷為情
況二的情形時OLT將不發送任何控制訊息給ONUn，等
待下一個時槽時間的來臨後，上傳資料的權利將交給
了ONUi+1。 
 
步驟六：循環步驟一 
下一個時槽時間抵達，ONUi+1開始自動使用此段
的頻寬，再次循環到步驟一。 
 
三、考量因素 
 
˙服務下一個單元的取擇 
 
當ONUi有空閒的時槽時間可利用時，OLT必須決
定下一個該使用這段空閒的ONU，這樣的決定將會影
響ONU的平均封包延遲、利用率等的結果，依照考量
的優先順序分別有暫存在各個ONU的資料量大小，此
ONU先前是否佔用了整個的時槽時間，RTT的考量，
利用率的問題以及此ONU是否有頻寬保證。之所以將
頻寬保證的考量因素放置最後的原因是因為時槽時間
的安排就是依照其保證頻寬的數值來決定，唯一有可
能出現的情形在前一次的傳輸因為標地時間的佔用，
再加上下一時間點訊務流量的暴增。 
 
˙循環時間與時槽的安排 
 
循環時間的決定將會影響到整個系統的封包平均
延遲時間，若取的數值過大會造成一個循環的時間過
久，雖然 ONU 每次的服務時間都可拉長讓單一次傳輸
的資料量增加，但是會造成每個 ONU 等待服務的時間
拉長，若 ONU 數目增加時這樣的影響將會更嚴重；取
的數值過小則又會讓 OLT 的送收器不停的切換，造成
時間無謂的浪費，並且也會讓暫存在 ONU 的封包切割
成多次傳送。經由考慮現存的網路服務種類，即時性
服務而言最高的延遲容忍範圍落在 25ms~150ms 左
右，像 VoIP 根據 G.131 標準，要不想採用回聲消除器
單向延遲必須小於 25ms；或是根據 ITU-T G.114 對單
向傳輸時間的要求，高品質語音服務單向延遲必須小
於 150ms，並且經由模擬實驗調整後得到本系統的循
環時間定為 10ms，事實上由第五章實驗結果可得莫約
2~3ms 良好的平均延遲時間。 
在優先權部分的安排方面是將上行頻寬切割成 K 
= 10 等份來區分，每一等份為優先權的一個單位，優
先權 0 為最低，優先權 10 為最高，以本實驗例子來看
就是將 1000Mbps 除上 10 得到 100Mbps，若是上行頻
寬有 2000Mbps 則是會得到以 200Mbps 做為優先權的
區分單位。對於沒有頻寬保證的 ONU 來說，它的優先
權大小為 0，在安排時槽時將會將所有沒有頻寬保證
的 ONU 集合起來統一共享剩餘且經過切割的時槽時
間。在前一小節中提到循環時間的安排是 10ms，同樣
的也將它切割成 10 等份，每一等份為 1ms，這就是基
本的時槽單位，對於有頻寬保證的 ONU 來說，每保證
100Mbps 就可分配到一個基本的時槽單位，下圖為時
槽安排的演算法表示。 
 
圖五 時槽安排之演算法 
 
˙臨界值的決定 
 
臨界值 T 的決定是為了要得知此 ONU 在經過服務
之後，是否還能有空閒的時槽時間能讓其他的 ONU 來
使用。這必須先確認 GT 存在的必要性。 標地時間的
組成主要有雷射二極體的切換延遲以及時脈回復問題
兩者，其中又以雷射二極體的切換時間為主因。當
ONU 不進行傳輸時，其雷射二極體必須完全的關閉，
以目前的技術而言這樣的動作所花占的時間莫約
10ns。所以當目前這個 ONU 的傳輸完畢時必須要花一
小段的時間做切換的動作，也就是所謂的標地時間，
 4
  
 
圖八 EPON 模擬架構圖 
 
 接下來在進行實驗結果分析前先探討會影響延遲
的種種因素，一般而言在網路架構中考慮延遲的問題
會以佇列延遲(Queuing Delay)、線路延遲(Propagation 
Delay)、傳輸延遲 (Transmission Delay)三大項作為考
量。佇列延遲：由用戶端上傳的資料會先暫存在其連
接的 ONU，等待時機將資料上傳的這段延遲即為佇列
延遲，這項延遲將會是在這三種延遲中最具影響的單
元。 
線路延遲：指訊號在 ONU 與 OLT 這段線路上的延
遲。線路延遲會隨著不同的傳送媒介而有所不同，在
本系統中影響此延遲最大的因素在於 ONU 與 OLT 端
的距離長短。傳輸延遲：依傳輸速率和資料量大小來
計算，也就是在一定的線路頻寬下傳送資料所需時
間。 
 
圖九 延遲時間考慮因素 
 
a.模擬步驟詳述如下，模擬系統架構描述：從一開始模
擬系統架構就必須要明確，指明網路拓樸的連接、頻
寬大小、佇列行為模式等。 
b.相關參數給定：給定每個節點的操作行為，並指定
訊務流量的產生方式，若有需要可加入錯誤模組來模
擬所需要的情境，最後再建立排程順序便可進行模
擬。 
c.結果分析：可由簡單的追蹤檔紀錄來得知模擬的結
果，可搭配像是 perl、awk 等工具協助將必要的資訊由
紀錄檔中抽出。 
 
    圖十中比較了三種排程方法的平均延遲時間，
TDMA 將 10ms 的時間平均分給 8 個 ONU，每個 ONU
每個間隔時間中將得到 1.25ms 的時間將資料上傳，隨
著負載的加重，各個時槽有可能發生空閒或是溢滿的
情況，最後在負載狀況達到 1.0 的同時，平均延遲時間
大到近約 460ms。 
IPACT 由圖十得知從負載 0.5 開始整體的延遲時
間已逐漸在上升，0.8~0.9 時有急劇拉昇的現象，時間
延長了約 100ms。在 0.9~1.0 負載狀況下更是明顯，最
後的延遲時間大約在 250ms 左右。DABG 在系統輕載
或重載的變化期間，封包的平均延遲都維持在極低的
狀態，直到系統的負載超過 0.8 後才有些微往上拉起的
趨勢。很明顯的，在負載情況相當重的情況下仍然能
有優於其餘兩者的表現，將延遲時間縮到最短。不僅
如此，ONU 擁有越高頻寬的保證，其平均延遲時間將
得到相對比例的縮短。
 
圖十 三種排程方法之平均封包延遲時間比較 
 
另外考慮 ONU 在不同頻寬保證狀況下，利用
DABG 方法是否仍能有封包平均延遲時間保持在相當
低的結果，考慮的情況如下表所示： 
 
表二 各個 ONU 的頻寬保證值 
 ONU1 ONU2 ONU3 ONU4 ONU5 ONU6 ONU7 ONU8
BW 300 200 0 0 0 0 100 100
 
BW 欄位是各個 ONU 頻寬保證的需求，單位是
Mbps。由圖 5.4 各個 ONU 的封包平均延遲可知對於有
頻寬保證的 ONU 而言，會有較小的平均延遲時間。在
系統在達到穩定狀態後，分別對每個 ONU 平均增加其
負載量，由 12.5Mbps 增加至 125Mbps，對系統來說就
必須服務 100Mbps 到 1000Mbps 的流量。由圖示可
知，ONU1、ONU2 這兩個有高頻寬保證 ONU 的平均
延遲都甚低，ONU1 和 ONU2 不管系統負荷的改變都
維持在 2ms~5ms 之間，ONU7 和 ONU8 雖有頻寬保
證，但是其保證的頻寬值 100Mbps 在重載情況下是無
法全部保證的，對於前 100Mbps 的訊務流量確實是有
受到保證，但每秒其累積在佇列中的資料量最多卻有
可能有 25Mbits，雖然可藉由 DABG 方法適當的得到
額外的服務，但卻無法得到完全的保證。由圖中可發
現在系統負載比率超過 0.9 之後有明顯將整個平均封包
的時間延遲往上拉昇的趨勢。剩下無頻寬保證的 ONU
則比 ONU7 和 ONU8 有著更高的延遲時間。整體來
看，系統在交通負載 0.1~0.9 的平均延遲時間都相當的
低，與先前的 TDMA 與 IPACT 相較起來有相當大的改
進。但是在交通負載 0.9 之後，對於沒有頻寬保證的
ONU 來說，平均延遲時間呈指數變化成長，而有頻寬
保證的 ONU 則仍然維持在相當低的延遲時間，這也間
接表示了其擁有較好的服務品質。 
 6
  
時對 ONU1 來說進入的訊務流量仍小於其保證的頻寬
大小，毫無疑問的 ONU1 將獲得 200Mbps 的使用權，
但是對於 ONU3 來說，其本身是沒有受到任何頻寬保
證的，對於進入的訊務流量突然增大確實讓它在分享
空閒頻寬時佔到優勢，但是卻無法影響到有頻寬保證
的 ONU，只是讓 ONU4、ONU5、ONU6 獲得更少的
可使用頻寬。值得一提的是在 ONU3 送出大量的封包
時並不會完全的佔用到其餘沒有頻寬保證 ONU 的頻
寬，這樣的好處可避免惡意破壞者的入侵。 
 
情況五：ONU1 訊務流量 300Mbps，其餘的 ONU 訊務
流量 125Mbps 
 
圖十六 頻寬保證分析 - 情況五 
 
情況五則是讓 ONU3 達到其保證頻寬的上限
300Mbps ， 圖 十 六 顯 然 的 是 讓 ONU1 充 分 享 有
300Mbps 的使用頻寬，並且對於那有頻寬保證的 ONU
來說也正確的維持在保證頻寬的水平。 
 
圖十七~圖二十一分別表示了情況一到情況五
的比較圖，可發現 TDMA 和 IPACT 對於頻寬保證方面
是沒有任何能力處理的，其中選定了 ONU1、ONU3
和 ONU7 三種保證等級來比較，TDMA 是不管輸入的
訊務流量如何，其服務的週期和資料數量皆不會改
變；而 IPACT 在輸入訊務流量暴增的情況下，也只有
一點點的使用頻寬優勢，這樣的服務品質是無法達到
用戶分制度的。 
 
 
圖十七 情況一的比較圖 
 
 
圖十八 情況二的比較圖 
 
 
圖十九 情況三的比較圖 
 
 
圖二十 情況四的比較圖 
 
 
圖二十一 情況五的比較圖 
 
各個 ONU 單元皆有大小 5M Bytes 的佇列，用以
暫存來自各使用者的封包，等待屬於自己的時槽時間
來臨後，再將佇列中的資料上傳至 OLT。在 5.3 小節
可以觀察到不管是 TDMA、IPACT 或是 DABG 方法，
在系統相當重的情形下的封包平均延遲時間都會相當
的大，這也代表著在各個 ONU 的佇列事實上已暫存著
相當數量的資料，使得新進入的封包無法在短時間得
到服務，造成延遲時間增加的劇增。佇列的使用希望
是越小越好，也就是新進入之封包可以迅速的得到服
務，如此一來亦可得到較小的封包平均延遲時間。 
 
圖二十二 DABG 佇列使用情形 
 
 8
