 摘  要 
本研究設計與實現一套以數位信號處理器為基礎之燃料電池發電系統，此系
統具有遠端監控與獨立供電或市電並聯之功能，基本上，本系統係由燃料電池、
充電器、電池組、直流轉換器、換流器、數位信號處理器及通訊介面所組成。其
中，我們設計滑動模式控制法則與模糊控制法則，以分別控制直流轉換器與換流
器，克服燃料電池之非線性特性，使得燃料電池可穩定地輸出最大功率，燃料電
池之輸出功率可提供換流器所需之直流匯流排電壓與蓄電池之充電電源。在換流
器的調變方法方面，我們使用電壓空間向量調變法以減少電流諧波，並且可使換
流器的直流匯流排電壓被有效地利用；而且，利用電壓源換流器，可使燃料電池
所產生的電能直接與市電並聯供電或獨立供電，而達成分散式電源之功能；同時，
我們亦設計一以單晶片為基礎之通訊介面，以傳送訊息至遠端監控系統，此通訊
介面包含 RS-232C 及無線通訊系統，以執行數位信號處理器與監控系統之通訊；
同時，本系統亦包含適當之人機介面，以執行遠端監控之功能。 
最後，我們使用數位信號處理器及個人電腦設計與實現此一具有遠端監控功
能之燃料電池發電系統，以達成低成本、易維修、易擴充及高可靠度之特性。 
 
關鍵詞：燃料電池發電系統、滑動模式控制、模糊控制，數位信號處理器。 
 
 
 
i 
 
 目   錄 
中文摘要 ------------------------------------------------------------------------------------  i 
英文摘要 ------------------------------------------------------------------------------------  ii 
目  錄 ------------------------------------------------------------------------------------  iii  
第一章 緒論 -----------------------------------------------------------------------------  1 
1. 1 研究動機 -----------------------------------------------------------------------  1 
1. 2 相關文獻之回顧 --------------------------------------------------------------  1 
1. 3 研究目的 -----------------------------------------------------------------------  5 
第二章 燃料電池簡介 -----------------------------------------------------------------  6 
2. 1 前言 -----------------------------------------------------------------------------  6 
2. 2 燃料電池 -----------------------------------------------------------------------  6 
 2. 2. 1 燃料電池的基本原理與構造 -----------------------------------------  6 
 2. 2. 2 燃料電池的數學模型 --------------------------------------------------  10 
第三章 直流轉換器與控制法則 -----------------------------------------------------  15 
3. 1 前言 -----------------------------------------------------------------------------  15 
3. 2 直流轉換器之電路架構 -----------------------------------------------------  16 
 3. 2. 1 直流降壓轉換器之電路架構 -----------------------------------------  16 
 3. 2. 2 直流全橋轉換器之電路架構 -----------------------------------------  18 
3. 3 直流全橋轉換器之控制法則 -----------------------------------------------  21 
 3. 3. 1 比例積分微分控制(PID Control) ------------------------------------  21 
 3. 3. 2 滑動模式控制(Sliding Mode Control) -------------------------------  24 
 3. 3. 2. 1 直接滑動模式控制(Direct Sliding Mode Control) -----------  28 
 3. 3. 2. 2 間接滑動模式控制(Indirect Sliding Mode Control) ---------  32 
3. 4 蓄電池之電路架構與控制 --------------------------------------------------  35 
 3. 4. 1 截波器之昇壓連續導通模式 -----------------------------------------  36 
 3. 4. 2 截波器之降壓連續導通模式 -----------------------------------------  37 
 
 
iii 
 
  5. 4. 7 CAN 的同步與時序分析 -----------------------------------------------  97 
5. 5 GSM 簡介 ----------------------------------------------------------------------  99 
5. 6 監控系統之工作原理 --------------------------------------------------------  101 
5. 7 建立監控系統方塊圖 --------------------------------------------------------  102 
5. 8 燃料電池發電系統之監控系統 --------------------------------------------  104 
 5. 8. 1 控制區域網路的簡介燃料電池發電系統之監控系統架構 ------  104 
 5. 8. 2 燃料電池發電系統之監控系統軟體規劃 ---------------------------  106 
 5. 8. 2. 1 燃料電池發電系統 CAN Mailbox ID 規劃 -------------------  106 
 5. 8. 2. 2 CAN Bus 無線通訊監控節點接收程式規劃 ------------------  106 
 5. 8. 2. 3 CAN Bus 各節點傳送程式規劃 --------------------------------  108 
 5. 8. 2. 4 無線監控燃料電池發電系統監控介面規劃 -----------------  109 
5. 9 結語 -----------------------------------------------------------------------------  112 
第六章 實驗結果與討論 --------------------------------------------------------------  113 
6. 1 前言 -----------------------------------------------------------------------------  113 
6. 2 硬體電路 -----------------------------------------------------------------------  113 
 6. 2. 1 燃料電池系統 -----------------------------------------------------------  115 
 6. 2. 2 數位信號處理器之介面電路 -----------------------------------------  115 
 6. 2. 3 輸出整流濾波電路 -----------------------------------------------------  117 
 6. 2. 4 功率晶體驅動電路 -----------------------------------------------------  117 
 6. 2. 5 零點偵測電路 -----------------------------------------------------------  117 
 6. 2. 6 電壓和電流回授電路 --------------------------------------------------  118 
 6. 2. 7 類比數位轉換器(ADC)電路設計 ------------------------------------  119 
 6. 2. 8 控制區域網路模組 -----------------------------------------------------  121 
6. 3 軟體規劃 -----------------------------------------------------------------------  122 
 6. 3. 1 直流轉換器軟體規劃 --------------------------------------------------  123 
 6. 3. 1. 1 直流轉換器主程式規劃 -----------------------------------------  123 
 6. 3. 1. 2 電壓與電流回授信號中斷程式 --------------------------------  126 
 6. 3. 1. 3 全橋式功率轉換器比例積分控制副程式 --------------------  127 
 
 
v 
 
 第一章  緒 論 
1.1 研究動機 
能源是現代人類生活之必需品，亦為經濟發展之原動力。從工業革命以來，
人類對能源的依賴日益提高，相對地，能源的消耗也日益增加，但是石油、煤炭
等石化能源在地球上的貯藏量有限，依據估計，石油剩餘的儲存量僅可供 43 年
使用，天然氣的剩餘儲藏量是 62 年，煤則是 230 年，這些存量都將隨著開採的
日增而漸趨枯竭。此外，傳統能源所排放的二氧化碳更是造成地球暖化的一大主
因。因此不論就能源危機的觀點，抑或是環保的考量，尋求有別於傳統能源的再
生能源，已經成為不可避免的趨勢。同時，隨著全球工業及人口之遽增，地球上
可用的資源則愈形短缺，為保護地球上的生態環境及延續人類的生存，因此尋求
可重複使用、對環境友善以及能源轉換效率佳之新能源技術，已成為各國工業界
及學術界之能源科技研究發展之重要課題與研究目標。其中，燃料電池技術因具
備低污染、高能源轉換效率之特性，成為近年來最受矚目的新穎能源供應技術。 
自 Grove 於 1839 年在英國發展出第一個燃料電池之後，雖有許多的研究結果
被提出，惟直至 1959 年 Bacon 才成功的製造出第一個可用之燃料電池，其後才
有大量的專家學者與廠商投入燃料電池之研究[1-5]。近十年來，燃料電池電動車
也已成為世界各大汽車公司開發競爭的焦點，微型燃料電池也為未來的 3C 電子
產業注入了新活力。 
目前，世界各地已有許多醫院、學校、商場等公共場所皆已安裝了燃料電池
發電系統進行並聯供電或獨立運轉；而主要的汽車製造商也已開發出各種燃料電
池電動車，並進行路測中；在北美和歐洲的許多城市，以燃料電池為動力之公共
汽車亦正投入示範運行；另外，以燃料電池作為攜帶式電子產品電力的發展，亦
正全力展開中[6-10]。 
1.2 相關文獻之回顧 
燃料電池是高效率、低污染、多元化能源的新發電科技，而燃料電池的氫供
 1 
 Bodur 等人[17]提出一新型脈波寬度調變電路之主動式緩衝器，可使升壓式轉
換器之主開關具有零電壓導通與零電流截止之特性，可應用於高頻開關切換與大
範圍之負載變化狀態，並經由容量為 1kw 容量、切換頻率為 100KHz 之升壓式轉
換器實驗，驗證此一新型主動式緩衝器之有效性。 
Cheng 等人[18]針對各種不同類別之燃料電池進行特性分析，並提出諧振式
相位換流器(resonant phase leg inverter)做為直流/交流換流器，另亦使用串列諧振
轉換器(series-resonant converter)提升直流電壓，實驗結果顯示此一結構具有良好
之輸出特性。 
Caponet[19]等人使用一具飽和特性的電感以實現燃料電池的零電壓、零電流
的軟切換 H 橋式直流/直流轉換器，以降低轉換器的複雜性，經由實驗顯示，在各
種負載方面，確實能減少切換損失，並可增加切換頻率，而達到更好的輸出特性。 
Correa 等人[20]針對高度變動性負載，提出一串列諧振換流器，其中，輸入
級為直流/交流串劉諧振轉換器，並使用可變頻率控制法；而輸出級為交流/交流
電力轉換器，並使用模糊邏輯控制器與脈波密度調變策略，經由模擬顯示，此一
換流器對於非線性及大範圍變動的負載，皆有良好的輸出響應。 
Gopinath 等人[21]使用三端推挽式直流/直流轉換器研製低成本之燃料電池換
流器系統，同時利用兩組鉛酸電池以供應突發之負載需求，並以數位信號處理器
TMS320LF2407 作為控制器，經由實驗顯示，其控制策略對於線性與非線性負載
皆有良好的輸出響應。 
在燃料電池之控制器方面，Jiang 等人[22]針對以燃料電池為電力源且使用脈
衝電流充電法之多電池系統，提出協同控制法則以控制降壓轉換器，經由實驗顯
示，協同控制法則對於輸入電壓與轉換器之參數變化皆具有強健性。 
Sakehare 等人[23]針對固態氧化物燃料電池之獨立運轉與併聯運轉，設計一
功率調節單元(power conditioning unit)，可對不同之輸出需求進行適當之處理，並
使用模糊控制法以控制升壓轉換器之輸出電壓與換流器之輸出電流，經由模擬顯
 3 
 有良好之轉矩與速度響應。 
Jiang[30]等人針對以燃料電池提供電源的電池充電站，提出三種充電策略，
以等速率充電法為基準，比較比例充電法及脈衝電流充電法之效率，經模擬及實
驗結果發現，比例充電法之總充電速度較等速率充電法快，而脈衝電流充電法幾
乎可以在同一時間完成所有電池的充電。 
1.3 研究目的 
本研究之目的是設計與實現一套以數位信號處理器為基礎之燃料電池發電系
統，此系統具有遠端監控與多組燃料電池並聯發電之功能，基本上，本系統係由
燃料電池、充電器、電池組、直流轉換器、換流器、數位信號處理器及通訊介面
所組成。其中，我們設計滑動模式控制法則與模糊控制法則，以分別控制直流轉
換器與換流器，克服燃料電池之非線性特性，使得燃料電池可穩定地輸出最大功
率，燃料電池之輸出功率可提供換流器所需之直流匯流排電壓與蓄電池之充電電
源。在換流器的調變方法方面，我們使用電壓空間向量調變法以減少電流諧波，
並且可使換流器的直流匯流排電壓被有效地利用；而且，利用電壓源換流器，可
使燃料電池所產生的電能直接與市電並聯供電或獨立供電，而達成分散式電源之
功能；同時，我們亦設計一以單晶片為基礎之通訊介面，以傳送訊息至遠端監控
系統，此通訊介面包含 RS-232C 及無線通訊系統，以執行數位信號處理器與監控
系統之通訊；同時，本系統亦包含適當之人機介面，以執行遠端監控之功能。 
最後，我們使用數位信號處理器及個人電腦設計與實現此一具有遠端監控功
能之燃料電池發電系統，以達成低成本、易維修、易擴充及高可靠度之特性。 
 
 5 
  
擴散層
陰極陽極
極板
電解質
H2 O2
- +
圖 2.1 燃料電池基本結構圖
基本上，燃料電池具有下列五項特點： 
1. 高效率：燃料電池依據電化學原理直接將化學能轉換為電能，理論上，它的整
體熱電合併(combined heat and power，CHP)效率可達 90%以上。然而由於各種
極化的限制，目前正在工作中的燃料電池實際的電能轉換效率約在 40~60%之
間，惟熱電合併效率則可達 80%。 
2. 低噪音：目前普遍採用的發電技術中，包括火力發電、水力發電、核能發電等，
主要裝置仍以大型渦輪機為主，基本上它是一種結構複雜的高速運轉機械，運
轉過程噪音非常大。相對地，燃料電池結構簡單而且沒有運轉機件，可以安靜
地將燃料轉化為電能。 
3. 低污染：燃料電池以氫氣為主要燃料，以化石燃料來提煉富氫燃料做為燃料電
池之燃料時，在製取過程中，二氧化碳的排放量比熱機過程減少 40%以上，可
以有效的減緩地球溫室效應。其次，由於燃料電池所使用的燃料氣體在反應前
必須脫硫，而且燃料電池發電不經過燃燒，所以它幾乎不排放 SOx 與 NOx，減
輕了對大氣的汙染。同時，當燃料電池以純氫為燃料時，它的產物只有純水。 
4. 多料源：目前，全球正以非常快的速度耗盡幾十億年來大自然所儲存的能源與
資源，基本上，煤炭、石油等化石燃料及天然氣屬乃非再生能源，是無法補充
的，而核能的安全性備受質疑。而對燃料電池而言，只要含有氫原子的物質都
可以做為燃料之進料來源，例如天然氣、石油、煤炭等氣化產物，或是沼氣、
 7 
 100%磷酸。磷酸電解質可容許燃料氣體和空氣中 CO2 的存在，惟 PAFC 目前
的發電效率僅能達到 40~45%(低熱值) 
陽極：   (2.3) −+ +→ e2H2H 2
陰極： OHe2H2O
2
1
22 →++ −+   (2.4) 
3. 質子交換膜燃料電池(PEMFC)：PEMFC 採用固態高分子膜為電解質。PEMFC
內唯一的液體為水，水管理則是影響燃料電池效率的重要因素之一，基本上，
PEMFC 必須在水的產生速率高於其蒸發速率之狀況下操作，以使薄膜保持充
分含水狀態，由於水平衡的因素，燃料電池的操作溫度必須限制在 100℃以
下。以富氫氣體為燃料時，不能含有過量的 CO(容忍度<10ppm)，以避免毒化
陽極觸媒。PEMFC 的操作溫度較低(大約 80℃)，使得 PEMFC 具有啟動時間短
的特性，可以在幾分鐘內達到滿載負荷，此外，PEMFC 的發電效率約在
45~50%(低熱值)。 
陽極：   (2.5) −+ +→ e2H2H 2
陰極： OHe2H2O
2
1
22 →++ −+    (2.6) 
4. 熔融碳酸鹽燃料電池(MCFC)：MCFC 所使用之電解質為分布在多孔陶瓷材料
(LiAlO2)的鹼性碳酸鹽。鹼性碳酸鹽電解質在 600~800℃的操作溫度下呈現熔融
狀態，此時具有極佳的離子傳導度。MCFC 具有內重整能力，CH4 與 CO 均可
直接做為燃料，不但能提高發電效率，而且可簡化系統。MCFC 的優點是操作
溫度較低，可使用價格較低的金屬材料，而且，電極、電解質隔膜、雙極板的
製作技術簡單，密封(seal)和組裝(assembly)的技術難度相對較小，易於大容量
發電機組組裝，而且造價較低。MCFC 的缺點是啟動時間較長，不適合作為備
用電源。 
陽極：   (2.7) −− ++→+ e2COOHCOH 22232
陰極： −− →++ 2322 COe2COO2
1    (2.8) 
 9 
                         (2.11) −+ +→ eHH 222
(2) 陰極： 
氧分子由氣體通道進入電池組，經擴散層到達陰極，與電子及氫離子在觸媒催
化下分解起電化反應，而產生水及約 1.2 伏特之直流電壓和熱能(因受內阻、溫
度影響，所以一般工作電位約只有 0.7 伏特左右)。陰極端之化學反應式為： 
                 heaterOHeHO +→++ −+ 22 222
1   (2.12) 
一個單一的燃料電池電化學模型之輸出電壓為[32] 
                     conohmicactNernstFC VVVEV −−−=   (2.13) 
式中， 為 PEMFC 之輸出電壓， 為可逆電池電壓(燃料電池之熱力電位)，
為活化過電位(電池之陽極和陰極的反應壓降)， 為歐姆過電位(電池質子
穿過交換膜所產生之電阻效應電壓降)， 為濃度過電位(氫氣和氧氣集中時，影
響質料傳輸而減低部分壓力，而使電流減少所造成的電壓降)。 
FCV NernstE
actV ohmicV
conV
在開迴路熱動態平衡之條件下，由修正型 Nernst 方程式求得可逆電池電壓
為 NernstE
             ( ) ( )⎥⎦
⎤⎢⎣
⎡ ++−Δ+Δ= 22 Pln2
1Pln
2
)(
22 OHrefNernst F
RTTT
F
S
F
GE  (2.14) 
其中， 為自由 Gibbs 能量之變化量(J/mol)，GΔ SΔ 為熱焓值之變化量(J/mol)， F
表示 Faraday 常數(96487Coulomb)，R 為氣體一般常數(83.14J/K．mol)， 為氫
氣之部分壓力( atm )， 為氧氣之部分壓力( atm )，T 為燃料電池之工作溫度(°K)，
為參考溫度(25°C＝298.15°K) 。使用標準壓力與溫度值，式(2.14)可化簡為式
(2.15) 所示： 
2PH
2PO
refT
( ) ( ) ( )
                 
Pln
2
1Pln1031.4 15.2981085.0229.1 22
53 ⎥⎦
⎤⎢⎣
⎡ +×+−×−= −− OHNernst TTE  (2.15) 
另一方面，活化過電位 為 actV
 11 
 i
VVR conacta
+=  (2.11) 
而單一燃料電池之電壓與電流密度關係圖則如圖 2.2 所示，而功率與電流密
度關係圖則如圖 2.3 所示： 
 
電
壓
(V
) 
電流密度  )/( 2cmA
圖 2.2 燃料電池之電壓與電流密度關係圖 
 
 
電流密度  )/( 2cmA
圖 2.3 燃料電池之功率與電流密度關係圖 
由圖中曲線可以看出，燃料電池之輸出特性曲線係屬非線性的。由圖 2.2 可
以發現燃料電池堆的工作範圍，無法工作於高電壓，亦無法工作於高電流密度，
50
功
率
密
度
 
0 0.5 1 1.5
0
10
20
30
40
 13 
 第三章 直流轉換器與控制法則 
3.1 前言 
由於燃料電池堆為一低電壓、大電流之化學動力源，且其動態響應較差，故
本研究所研製之燃料電池發電系統架構即如圖 3.1 所示： 
 
DC/DC
轉換器
DC/AC
換流器
電池
DSP
控制單元
通信單元
發射器
系統運轉資訊
通信單元
接收器
燃料
電池堆 負載
資訊顯示
控
制
信
號
功
率
晶
體
回
授
信
號
電
壓
電
流
控
制
信
號
控
制
信
號
功
率
晶
體
圖 3.1 燃料電池發電系統整體結構圖 
本系統係由燃料電池、充電器、電池組、直流轉換器、換流器、數位信號處
理器及通訊介面所組成。基本上，以燃料電池堆為核心所構成的一個燃料電池發
電系統除了必須具備供氣系統、燃料處理器、燃料電池堆、直流轉換器、換流器、
以及冷卻系統之外，最重要的是必須具有燃料電池控制器，如此才能夠進行氣、
水、熱、電之管控，而構成一個自動運轉的發電系統。本章謹先敘述直流轉換器
之電路架構與控制法則。 
 
 
 15 
 因此 
I I O OV I V I=                                            (3.4) 
所以可得 
1O I
I O
I V
I V
= =
D
2 S
                                          (3.5) 
而另一方面，當輸出負載功率逐漸減少時，輸出電流會有降低至零的時候，此時
電路工作在不連續導通模式(DCM)，再利用電感電壓一週期平均值為零的觀念，可
得 
1( )I o S oV V D T V D T− =                                    (3.6) 
因此由式(3.6)，可得輸出與輸入電壓間之關係為 
1
1
o
I
V D
V D D
= + 2                                          (3.7) 
一個轉換器的電路中，負載 LR 與輸入電壓 都會隨著情況而有所改變，此時
操作模式亦有可能產生變化，也就是說在轉換器之規格範圍內，可能分別操作在
CCM 與 DCM，一般來講輕載為 DCM，重載為 CCM。因此對於工作於何種模式亦
是我們設計的一個重點，當然我們希望是工作在 CCM，由式(3.2)可知，輸出電壓
是隨責任週期 而呈線性變化，不會受到電感
Iv
ov
D L 及電容 與負載C LR 之變化而影
響，然而實際電路當然不會如此理想，會有內阻之存在，所以不一定會有如此好
之特性。相對於 DCM 輸出電壓之變化與電感與負載有絕對之關係，以控制的觀點
來講，系統是愈線性化愈好控制，對設計者來說也愈容易設計控制器。 
 
 17 
 當採用 PWM 控制方式時，直流電壓 施加在 四個 MOSFET 開關構成
的兩個橋臂上。當兩個成對角的開關 、 或 、 同時導通時，功率從一次
側通過變壓器向負載傳送；當所有開關均截止時，負載電流將通過整流二極體
續流，同時濾波電容 為負載繼續提供能量。通過控制四個開關的導通順
序及導通時間，在變壓器的一次側將得到按某一責任週期 變化的正負半週對稱
的交流方波電壓。如果變壓器的匝比為 ，則變壓器二次側將產生振幅值為
的交流方波電壓，經過二極體 組成的整流電路和電感 、電容 組成的低
通濾波電路最終就可得到所要求的平滑直流輸出電壓。 
Iv 1 ~Q Q4
8
8
1Q 4Q 2Q 3Q
5 ~D D oC
D
N /Iv N
5 ~D D oL oC
由於全橋轉換器本質上屬於 Buck 轉換器，如果不考慮效率等因素，則輸出電
壓的值與責任週期 成正比。通過控制責任週期 即可方便地控制輸出電壓。 D D
在上述的控制方式中，互為對角的開關導通和截止都是同時進行的，其閘極
信號的時序波形圖如圖 3.5 所示。 
實際上，互為對角的開關的導通或截止不一定要在同一時刻完成。通過改變
開關的導通和截止時刻，可以得到不同的控制策略。本研究將簡述幾種常用之切
換方式[34]。 
 
圖 3.5 全橋轉換器的傳統 PWM 控制方式 
1. 如圖 3.5，兩個對角開關導通、截止同時進行，導通時間長度為 0.5DT（ D
 19 
 導通時間延長（最多可以到 0.5 ）。這就是所謂的“有限雙極性控制＂的
另外一種情況，可能的實現方式也有兩種，如圖 3.6(b)所示。 
T
4. 如圖 3.7，兩個對角開關導通、截止都不同時進行，其中一個先開、先關，
而另一隻則後開、後關。如果每個開關的導通時間都達到 ，就是常
見的“相移控制方式＂。而這也是本研究所採用之切換方式。 
0.5T
 
圖 3.7  相移控制方式 
 
3.3 直流全橋轉換器之控制法則 
3.3.1 比例積分微分控制(PID Control) 
PID 控制器可以用下列數學式表示[35] 
0
1( ) [ ( ) ( ) ]
t
p
i
de tu t K e t e d T
T d
τ τ= + +∫ ( )d t                          (3.8) 
其中u 為控制量， 為誤差量，e pK 為控制器之比例增益， 為積分時間， 為微
分時間，其系統方塊圖如圖 3.8。由式(3.8)可知控制量是與比例項、積分項及微分
項有關。比例控制動作是一個可調增益的元件，藉由增益的改變可調整控制系統
之相對穩定度及穩態誤差，通常增益變大可以降低穩態誤差，但會破壞相對穩定
度；反之，增益變小可以增加相對穩定度，但是會增加穩態誤差。積分項動作的
目的是要消除穩態誤差，有利於雜訊抑制，但亦有可能讓系統不穩定，其系統之
暫態響應性能將變得較差。而微分控制動作有預測誤差走勢的效果，可以改善系
iT dT
 21 
 /iK s
pK
dK s
cu u
e 'e( )R s
( )Y s
 
圖 3.9  PID 之反積分終結器 
現今 PID 控制器之實現皆以微處理器來運算，微處理器需花時間運算控制器
之輸出，無法連續處理訊號，所以訊號需經過取樣。式(3.8)之連續時間 PID 控制器
方程式必須離散化處理[36]，將式(3.8)經拉氏轉換(Laplace transform)成拉氏轉移函
數，再以差分方程式來近似。 
常見差分方程式有前向差分(Forward difference)、反向差分(Backward difference)
及梯形規則(Trapezoidal rule)三種方法。於此採用反向差分公式[37] 
1zs
Tz
−≅                                              (3.9) 
式(3.8)經拉氏轉換可得 
1( ) [1 ] ( )p d
i
u s K T s e s
T s
= + +
                                (3.10) 
再將式(3.10)經反向差分公式，數位化後可得 
1 1( ) [1 ] ( )
1p di
Tz zu k K T e K
T z Tz
−= + +−                           (3.11) 
整理後可得 
2( ) ( 1) [(1 ) ( ) (1 ) ( 1) ( 2)]s d d dp
i s s s
T T T Tu k u k K e k e k e k
T T T T
= − + + + − + − + −
    (3.12) 
其中 為取樣時間，取樣週期大小與控制對象之時間常數有關，取樣週期如太
短，會造成數據的處理過多，需花較多時間與較多硬體資源，若取樣時間太長，
sT T=
 23 
 滑動模式控制基本上是可變結構控制的一種，其定義為「滑動模式控制是先
使受控系統產生兩個以上的子結構，再利用一些刻意加入的切換的條件來產生滑
動模式，以達成控制目標」[38]。對單輸入系統而言，通常切換條件 為 ( )u x
( ) ( ) 0
( ) {
( ) ( ) 0
u x for x
u x
u x for x
σ
σ
+
−
>= <                                  (3.13) 
其中 ( )xσ 為一切換函數(switching function)，而且 ，在此必須注意：( ) ( )u x u x+ −≠ ( )xσ
對時間 t 必須為一次可微分[39-40]。利用此切換函數，明顯地可以將整個狀態空間
分隔成 ( ) 0xσ > 、 ( ) 0xσ < 和 ( ) 0xσ = 三個子空間，重要的是，超空間 ( ) 0xσ = 必須
是連續的而且包含平衡點 x=0。而系統設計的主要目的是 ( ) 0xσ = 的超空間中產生
滑動模式，故通常稱 ( )xσ 為滑動函數(sliding function)。 
一滑動模式之產生，基本上可歸納出兩個程序，首先，當系統在超空間 ( ) 0xσ =
之外時，須確保所有的軌跡在有限的時間內接觸到此超空間，這個過程稱為迫近
(approaching)模式，其次為當系統進入超空間後，應保證不再離開並朝目標點或平
衡點 逼近，此動作行為稱之為滑動模式。圖 3.11 為描述此兩個過程之示意圖，
由時間 開始，系統狀態
0x =
0t = (0)x 即被迫推向超間 ( ) 0xσ = ，並於有限之時間 內到
達，在 時間內，系統不再離開此空間，且朝平衡點
ht
ht t> 0x = 移動，最終到達
之目標。 
( ) 0x ∞ =
軌跡在t=th時接觸
滑動模式
平衡點
( ) 0xσ =
( ) 0x ∞ =
( 0 )x
( )hx t
 
圖 3.11 滑動模式示意圖 
 25 
 0σ =
0σ <
0σ >
 
圖 3.13 滑動條件示意圖 
若以數學式來表示此滑動條件 [41] 
0
( ) 0lim xσ σ σ
•
→
<
                                        (3.14) 
而迫近條件需滿足讓系統在有限時間內接觸滑動模式。最常使用的迫近條件
[42]為 
σ σ ρ• < − σ                                          (3.15) 
其中， 0, 0σ ρ≠ > ，於此我們利用 Lyapunov 原理來保證系統會在有限的時間
內到達滑動模式，選取 Lyapunov 函數為 
2V σ=                                              (3.16) 
由於滑動函數對時間 t 是一次可微的，因此 
2V σ σ• •=                                           (3.17) 
當迫近條件式(3.15)成立時，則 
2 2dVV V
dt
ρ σ ρ• = < − = − < 0
                            (3.18) 
顯然可得 ，故V 確實為一 Lyapunov 函數，呈現遞減收斂的趨勢。將式(3.18)
積分後，可得 
0V
• <
 27 
 切換函數可表示為： 
 e eσ α
•= + ， 0α >                   (3.21) 
其中輸出電壓誤差量 ，其定義為輸入命令電壓( )和輸出電壓( )之間的
差值，
re V v= − o rV ov
α 為一正數之滑動係數，當 ov vc= ，則誤差之變化量( e• )可表示為 
0 oe v
• •= − = − cv
•
o
                                       (3.22) 
根據式(3.20)~ (3.22)，我們可得到 
( )c rv V vσ α
•= − + −  
 
1 1( )L c
L
i v
C CR r
Vα α= − + − +
               (3.23) 
而切換函數的微分則為 
1 1( )L c
L
i v
C CR
σ α• •= − + − •  
1 1 1 1 1( ) iL c
L L L
Vi v
C CR CR CR LC LC
α α⎡ ⎤⎛ ⎞−= − + − + −⎢ ⎥⎜ ⎟⎝ ⎠⎣ ⎦
u
+ −
            (3.24) 
令其控制法則為 
( , ) 0
{
( , ) 0
u x t for
u
u x t for
σ
σ
+
−
>= <
                                 (3.25) 
其中 、 ，且控制信號可分解成兩部分 1u = 0u =
eq nu u u= +                                           (3.26) 
其中 為等效控制量、 為非線性切換控制量，前者可從equ nu 0σ
• = 獲得，則式(3.24)
變為 
2 2 2
1 1
L
eq L c
i L L
LCu i
V C R C C R CR LC
α α 1 v⎡ ⎤⎛ ⎞⎛ ⎞ −= − + + +⎢ ⎥⎜ ⎟⎜ ⎟ ⎜ ⎟⎢ ⎥⎝ ⎠ ⎝ ⎠⎣ ⎦           (3.27) 
 29 
 L
Li
cv LR ov
+ +
− −
C
Ii
iV
ci
rV
+−++σu
 
圖 3.15 直接滑動模式控制架構圖 
接下來，我們探討滑動行為存在的區間，可由滑動條件推導之，我們令式
(3.23) 0σ = ，可得 
1
L c
L
i C v V
CR
α α⎡ ⎤⎛ ⎞= − +⎢ ⎥⎜ ⎟⎝ ⎠⎣ r ⎦                               (3.33) 
將式(3.33)代入式(3.27)，我們得到 
2 1 1 1
eq c r
i L L
LCu v
V CR LC CR
α α α α V⎡ ⎤⎛ ⎞ ⎛= − + − − ⎞⎢ ⎥⎜ ⎟ ⎜⎝ ⎠ ⎝ ⎟⎠⎣ ⎦          (3.34) 
當 0 ，則滑動區間(sliding regions)因此可推導得 1equ< <
,min ,maxc c cv v v< <                    (3.35) 
其中 
,min
2
,max
2
1
1 1
1
1 1
L
c r
L
i
r
L
c
L
CR
v V
CR LC
V V
LC CR
v
CR LC
α α
α α
α α
α α
⎛ ⎞−⎜ ⎟⎝ ⎠= ⎛ ⎞− +⎜ ⎟⎝ ⎠
⎛ ⎞+ −⎜ ⎟⎝ ⎠= ⎛ ⎞− +⎜ ⎟⎝ ⎠                               (3.36) 
 31 
 根據開關切換週期平均法，式(3.38)及式(3.39)和輸出狀態方程式可推導得[45]  
( )
1 1
1 1
L c iL
L L L c
L c L c
L
c L c
L c L c
R r vRi r i v
L R r L R r L
Rv i v
C R r C R r
•
•
⎧ ⎫⎛ ⎞ ⎛ ⎞= − + − +⎪ ⎪⎜ ⎟ ⎜ ⎟+ +⎪ ⎪⎝ ⎠ ⎝ ⎠⎨ ⎬⎪ ⎪= −⎪ ⎪+ +⎩ ⎭
d
                (3.40) 
( )L c Lo LL c L c
R r Rv i
R r R r
= ++ + cv                               (3.41) 
其中 Li 、 cv 、 d 和 ov 各代表為電感電流、電容電壓、切換週期和輸出電壓的平均
值，我們為了使符號簡潔、清楚，我們將變數上之 bar 去除。而以控制的立場，切
換週期(duty cycle，d )才是我們真正要去關切的，基於 IVSC，我們可以假設切換函
數(switching function)為 
( )
0
,
t
e e dσ α τ τ α= + >∫ 0
o
                                (3.42)  
且 
                                           (3.43) re V v= −
其中 e 為輸出電壓的誤差、α 為滑動係數(sliding coefficient)，且當 為一固定非可
調之常數時，由式(3.41)和式(3.43)，可得 
rV
oe v
• •= −  
( )L c LL cL c L c
R r Ri v
R r R r
• •⎛ ⎞= − +⎜ ⎟⎜ ⎟+ +⎝ ⎠                                 (3.44) 
1 2 3L ca i a v a d= + +  
其中 
2 2
1 2
( )
( ) ( )
L LL L c
L c L c
R Cr LR r ra
L R r LC R r
−= ++ +  
 33 
 為了確保 ， 可選擇為 0σ σ• =< nd
 ( ) (3sgn sgnnd a )σ σ= − =                                 (3.50) 
其中式(3.45)之 3 0a < 。圖 3.17 為間接滑動模式控制之架構。 
u L
Li
cv LR ov
+ +
− −
C
Ii
Iv
Lr
cr
驅動電路
rV+
−
+
++ +
+
++ CK
eqd
ndd
LK
rK
α1
s
σ
 
圖 3.17 間接滑動模式控制架構圖 
本研究採用間接滑動模式控制作為直流全橋轉換器之控制法則。 
3.4 蓄電池之電路架構與控制 
本研究採用昇∕降壓型直流截波器作為蓄電池之充放電架構，其電力電路如
圖3.18所示。因應燃料電池電流增大，電壓降低特性，當燃料電池發電功率低於負
載功率時，截波器操作在昇壓模式，開關 截止，開關 切換，蓄電池放電，
以提高負載功率；當燃料電池發電功率大於負載功率時，截波器操作在降壓模式，
開關 切換，開關 截止，蓄電池充電。因為直流鏈電壓與串聯蓄電池堆的電
壓差，當蓄電池充電電流小時，截波器需操作於降壓不連續導通模式。截波器之
操作模式分別如下所述： 
5Q 6Q
5Q 6Q
 35 
 bi
∗
bv
bi
1
ov 6
d ∗
ov
b
BB
L
T
 
圖 3.20 定電流放電連續導通模式控制方塊圖 
3.4.2 截波器之降壓連續導通模式 
在圖3.21中，假設截波器操作於降壓連續導通模式，利用平均週期法可求出電
感電流的微分方程式，如式(3.53)所示。根據式(3.53)將電感電流微分轉化為每週期
上昇的電感電流，可得到式(3.54)，其中 BBT 為截波器開關切換週期，由式(3.54)可
知蓄電池定電流放電的控制下，開關 的導通週期比。根據式(3.54)得到降壓連續
導通模式定電流控制方塊圖，如圖3.22所示。 
6Q
5
bc
B o b
diL d v v
dt
= −  (3.53) 
5
1 [ (Bb bc
o BB
Ld v i i
v T
∗ ∗= + − )]bc  (3.54) 
ov bci
5Q
bL
bv
5d
∗
 
圖 3.21  截波器之降壓模式開關等效電路圖 
 37 
 bci
oL
v
t
t
o bv v−
bv−
ont BBTΔ
BBT
,maxbci
 
圖 3.23  截波器降壓不連續導通模式之電感電壓與電感電流示意圖 
 
bci
∗
bci
+
0.7A
5d
∗
_ piK
iiK
s
+
+
bcu
∗
bciΔ ( )1
2
BB o o b
b b
T v v v
L v
⋅ ⋅ −
 
圖 3.24  定電流充電不連續導通模式控制方塊圖 
3.5  結語 
   本章分析直流全橋轉換器之電路架構，同時，由於燃料電池的輸入電壓隨輸出
電流降低，具非線性特性，因此亦探討比例積分控制與滑動模式控制法則；另外，
亦分析蓄電池之電路架構與控制，並在第六章進行實際驗證。 
 
   
 39 
 ad 、 、 表示為 cd cd
a,b,cx
TT
TT
d
xx
xx
x =⎩⎨
⎧= −+
−+
         
  0
   1
：導通：截止，若
：截止：導通，若  (4.1) 
 
圖 4.2 三相換流器等效開關電路圖 
由圖4.1可得到三相換流器輸出之線電壓與開關命令之關係為 
dcbabaab vddvvv )( −=−=   (4.2a) 
dccbcbbc vddvvv )( −=−=                                (4.2b) 
dcacacca vddvvv )( −=−=                                (4.2c) 
0=++ cba vvv                                        (4.2d) 
若輸出側為三相平衡電源或負載，經由式(4.2)可以將開關端電壓 、 、 以
開關等效狀態 、 、 及直流鏈電壓 表示 
av bv cv
ad cd cd dcv
⎥⎥
⎥
⎦
⎤
⎢⎢
⎢
⎣
⎡
⎥⎥
⎥
⎦
⎤
⎢⎢
⎢
⎣
⎡
−−
−−
−−
=
⎥⎥
⎥
⎦
⎤
⎢⎢
⎢
⎣
⎡
c
b
a
dc
c
b
a
d
d
d
v
v
v
v
211
121
112
3
 (4.3) 
 
 41 
 4.3 電壓空間向量調變[48-50]  
三相三臂式換流器共有三對功率晶體，其切換狀態依表4.1可知，共可組合出
八個不同的電壓向量空間，其中包含六個非零電壓向量空間以及二個零電壓向
量，電壓空間向量可表示如圖4.3，括弧內由左至右依序為開關狀態 、 、 。 ad cd cd
 
圖4.3 電壓向量空間 
將所設定之電壓向量，由U1位置開始，每次增進一小增量，每一個新的電壓
向量可以用該區中相鄰的兩基本非零電壓向量與零電壓向量予以合成，如此即可
得到一個在電壓空間平面上平滑旋轉的電壓空間向量。將每一次新的電壓向量計
算出其所對應之開關狀態命令，控制三相功率轉換器，即可輸出目標之三相弦波
電壓。 
 
圖4.4 電壓空間向量旋轉示意圖 
在三相交流系統中，各相電壓可表示如下 
 43 
 vector ad  bd  cd  sdv  sqv  
U1 1 0 0 32 dcv 0 
U2 1 1 0 3dcv  3dcv  
U3 0 1 0 3dcv− 3dcv  
U4 0 1 1 32 dcv− 0 
U5 0 0 1 3dcv− 3dcv−  
U6 1 0 1 3dcv  3dcv−  
U7 1 1 1 0 0 
U0 0 0 0 0 0 
 
 
圖4.6 靜止座標軸對應至電壓空間向量 
然後以第一區間為例，計算出相鄰二電壓空間向量在一切換週期內，各自的
責任時間以合成命令電壓。 
根據圖4.7，電壓向量可表示為式(4.7)，其中 為 的責任時間， 為 的責
任時間， 為零電壓向量的責任時間，
1T 1U 2T 2U
0T T 為切換週期。 
  ⎪⎩
⎪⎨
⎧
+=
++=
2
2
1
1
021
U
T
TU
T
TU
TTTT
out
 (4.7) 
 45 
 將此步驟依序推衍至六個區間，歸納後可使用三個變數 X 、Y 、 Z ，依不同
的電壓區間，組合出不同的 、 ，歸納結果於表4.3。 1t 2t
⎪⎪
⎪
⎩
⎪⎪
⎪
⎨
⎧
+−=
+=
=
)3(
2
1
)3(
2
1
betaalfa
betaalfa
beta
UUZ
UUY
UX
 (4.12) 
為了判斷命令電壓位於哪個電壓區間，將 、 依式(4.13)，以靜止座標
軸之反矩陣轉換至三相座標軸 、 、 。 
alfaU betaU
1refv 2refv 3refv
⎥⎥
⎥
⎦
⎤
⎢⎢
⎢
⎣
⎡
⎥⎥
⎥⎥
⎦
⎤
⎢⎢
⎢⎢
⎣
⎡
−−
−=
⎥⎥
⎥
⎦
⎤
⎢⎢
⎢
⎣
⎡
012
3
2
1
12
3
2
1
101
3
2
1
alfa
beta
ref
ref
ref
U
U
v
v
v
 (4.13) 
1refv 、 、 之關係見圖4.8。 2refv 3refv
 
圖4.8 合成之命令電壓投影至電壓空間向量 
利用式(4.14)的條件式判斷，可得到一索引值來判斷命令電壓所在區間。 
0a  else  ,1a  ,0 1 ==>refvif  (4.14a) 
0b  else  ,1b  ,0 2 ==>refvif  (4.14b) 
0c  else  ,1c  ,0 3 ==>refvif  (4.14c) 
 47 
  
圖4.9 一週期內對稱三角波與 、 、 之關係 aont bont cont
表4.3 各電壓區間之 、 與1t 2t X 、Y 、 Z 之間的關係 
區間 
1 2 2 3 3 4 4 5 5 6 6 1U ,U  U ,U  U ,U  U ,U  U ,U  U ,U  
index  3 1 5 4 6 2 
2t  X  Y  Y−  Z  Z−  X−  
1t  Z−  Z  X  X−  Y−  Y  
aT  aont  bont  bont  cont  cont  aont  
bT  bont  aont  cont  bont  aont  cont  
cT  cont  cont  aont  aont  bont  bont  
4.4 三相換流器之控制法則 
本節將說明三相換流器控制器的設計。利用前節所介紹之三相換流器的微分
方程式，加以分析並依照不同用途分別設計為電壓控制模式及電流控制模式。電
壓控制模式將三相換流器視為一交流電壓源，控制電壓輸出為三相交流電壓，應
用於燃料電池發電系統獨立供電模式；電流控制模式則將三相換流器視為一交流
電流源，輸出三相電流追隨市電，應用於市電並聯系統。 
 49 
 0
2 2cos cos( ) cos( )
3 3
2 2sin sin( ) sin( )
3 3
1 1 1
2 2 2
e e e
qd e e eT
2
3
π πθ θ θ
π πθ θ θ
⎡ ⎤− +⎢ ⎥⎢ ⎥⎢ ⎥= − +⎢ ⎥⎢ ⎥⎢ ⎥⎢ ⎥⎣ ⎦
 (4.18) 
反轉換矩陣為 
1
0
cos sin 1
2 2cos( ) sin( ) 1
3 3
2 2cos( ) sin( ) 1
3 3
e e
qd e e
e e
T
θ θ
π πθ θ
π πθ θ
−
⎡ ⎤⎢ ⎥⎢ ⎥⎢ ⎥= − −⎢ ⎥⎢ ⎥⎢ ⎥+ +⎢ ⎥⎣ ⎦
 (4.19) 
其中 e edtθ ω= ∫ ， 2e efω π= 為三相電源角頻率， 60=e zf H 為三相電源頻率。 
配合轉換關係式，可將式(4.4)轉換為同步旋轉座標之交軸、直軸電壓與電流方
程式，表示如式(4.20)、式(4.21)所示： 
⎪⎪⎩
⎪⎪⎨
⎧
−=−
+=−
e
uvwqef
e
uvwdf
e
uvwd
e
abcd
e
uvwdef
e
uvwqf
e
uvwq
e
abcq
vCv
dt
dCii
vCv
dt
dCii
____
____
ω
ω
 (4.20) 
⎪⎪⎩
⎪⎪⎨
⎧
−=−
+=−
e
abcqef
e
abcdf
e
uvwd
e
abcd
e
abcdef
e
abcqf
e
uvwq
e
abcq
iLi
dt
dLvv
iLi
dt
dLvv
____
____
ω
ω
 (4.21) 
或以系統狀態變數表示如式(4.22)、式(4.23)所示： 
⎥⎥⎦
⎤
⎢⎢⎣
⎡
⎥⎥
⎥⎥
⎦
⎤
⎢⎢
⎢⎢
⎣
⎡
−
−
+⎥⎥⎦
⎤
⎢⎢⎣
⎡
⎥⎥
⎥⎥
⎦
⎤
⎢⎢
⎢⎢
⎣
⎡
+⎥⎥⎦
⎤
⎢⎢⎣
⎡
⎥⎦
⎤⎢⎣
⎡ −=
⎥⎥
⎥
⎦
⎤
⎢⎢
⎢
⎣
⎡
e
uvwd
e
uvwq
f
f
e
abcd
e
abcq
f
f
e
uvwd
e
uvwq
e
e
e
uvwd
e
uvwq
i
i
C
C
i
i
C
C
v
v
v
dt
d
v
dt
d
_
_
_
_
_
_
_
_
10
01
10
01
0
0
ω
ω
 (4.22) 
 51 
 4.4.2 模糊邏輯控制器[53-55] 
如圖4.11所示，模糊邏輯的輸入控制變數為輸出誤差及輸出誤差的變化量，而
在離散系統下，誤差 定義為系統在第k時刻時的參考輸入量( )e k *x 與受控體輸出量
x 的誤差，在本文中 x 代表為交軸電壓、電流與直軸電壓電流。誤差變化量
定義為系統在第k時刻時的誤差量 與第
( )ce k
( )e k 1k − 時刻之誤差量 時之差，控制
量 為系統在第 時刻時的控制器的輸出增量，GE 、GC 、GU 為各自的標么
值， 、 、 為標么化後的值，我們定義如下: 
( 1e k − )
( )du k k
( )pue k ( )puce k ( )pudu k
*( )e k x x= −  (4.24a) 
( ) ( ) ( 1)ce k e k e k= − −  (4.24b) 
( )( )pu
e ke k
GE
=     (4.24c) 
( )( )pu
ce kce k
G C
=                                    (4.24d) 
( ) ( ) *pudu k du k GU=                                  (4.24e) 
+ −
∑
( )e k
( )ce k
( )pue k
( )puce k
( )pudu k
( )du ku
x
*x
 
        圖4.11 模糊邏輯控制系統方塊圖 
在設計模糊邏輯控制器需要考慮下面幾點: 
 53 
 再各自標么化後，透過圖4.12(a)，誤差 ( )eμ 輸入歸屬函數，及透過圖4.12(b)誤差變
化量之 ( )ceμ 輸入歸屬函數作初步模糊化的動作。一般來說，使用者會對系統輸入
變數可能達到的範圍做切割，定義出歸屬函數的個數與形狀，基本上，歸屬函數
的個數越多，描述非線性化的能力越好，但數量過多，亦會造成法則庫過度膨脹，
影響系統效能，在歸屬函數形狀方面，較常用的形狀為高斯型與三角形，依使用
上來說，高斯型歸屬函數的非線性特性較三角形佳，然而三角形歸屬函數亦有著
容易計算的優勢，且依過去的一些研究顯示，使用三角形與高斯形的歸屬函數來
做控制，得到的控制效能差異並不會太大。 
(2) 知識庫  
知識庫是由資料庫和規則庫兩個主要部分所組成，主要功能是提供推論規則
和控制相關知識，以便提供推論機構作推論之用。經由圖4.12之輸入歸屬函數後，
可透過程式撰寫建立模糊控制知識庫，以做為判斷經模糊化後之控制量位於那一
個區間內。例如:  
If  is NS and  is Z Then  is NS， ( )pue k ( )puce k ( )pudu k
If  is PS and  is NS Then  is Z。 ( )pue k ( )puce k ( )pudu k
如此一來可撰寫(If ….. Then …..)程式來決定輸出控制量區間之判斷。 
1
0 0 11−
(e)μ
Z PS PM PBNSNMNB
 
(a) 
 55 
 2 ( ) 2 ( )du du2μ α μ= ∧                                   (4.28) 
最後將每一條規則所得到的結論部分作聯集，即可獲得所有規則結論之綜合結
果，其歸屬函數為 ( )duμ 可由下式求得。 
1 2( ) ( ) (du du du)μ μ μ= ∨   (4.29) 
 
1 2( ) [ 1 ( )] [ 2 ( )]du du duμ α μ α μ= ∧ ∨ ∧  (4.30) 
其中∧ =min , =max。 ∨
整個模糊推論過程如圖 4.13 表示 
( e )μ
( e )μ
(ce)μ
(ce)μ
(du)μ
(du)μ
(du)μ
∨
Z NSNS
NS ZPS
( )pue k ( )puce k
∧
( )pudu k
1(du)μ
2 (du)μ
( )pue k ( )puce k ( )pudu k
( )pudu k
 
圖 4.13 模糊推論圖 
表4.5 模糊邏輯控制規則表 
( )pue k  
( )puce k  
NB NM NS Z PS PM PB 
NB NVB NVB NVB NB NM NS Z 
NM NVB NVB NB NM NS Z PS 
NS NVB NB NM NS Z PS PM 
 57 
 由於模糊控制法所得到之命令增量為 ，故將此命令增量積分後才是實際上之
控制量如下所示： 
( )du k
( ) ( 1) ( )T Tu k u k du k= − +                                   (4.32) 
因此可以透過模糊邏輯控制的方式很快的就使 及 進入Z的狀態之收斂區
間。 
( )ce k ( )e k
4.4.3 模糊控制器線上與離線模糊計算法 
線上模糊計算法是在模糊邏輯控制過程中，每次輸入都經由模糊推論而及時
計算輸出，因此可以精確計算出推論輸出，但因每次都必須重複做推論計算，所
以也造成計算費時的缺點。而離線模糊計算法則是事先將算出模糊推論的結果設
計成一查詢表(look-up table)，由於記憶體容量的限制而損失一些精確度，但節省整
體計算時間。本研究之模糊邏輯控制器即採用離線模糊算法，並建立一7*7查詢表
與一13*13查詢表。如下所示: 
 
 
表4.6 模糊邏輯規則7*7查詢表 
( )pue k
 
 
( )pu kce  
NB NM NS Z PS   PM PB 
NB    -1   -1      -1 -0.75 -0.5 -0.25  0 
NM    -1      -1 -0.75 -0.5 -0.25  0 0.25 
NS        -1 -0.75 -0.5 0.25  0 0.25 0.5 
Z -0.75 -0.25   0.25   -0.5  0 0.5 0.75 
PS -0.5 -0.25 0 0.25 0.5 0.75    1 
PM -0.25       0 0.25 0.5 0.75    1    1 
PB    0 0.25   0.5 0.75    1    1    1 
 
 59 
 本研究之目標為產生三相線電壓均方根值為220伏特之交流電，以雙迴路控制
電壓輸出。電壓控制迴路使輸出電壓與命令相符，電流控制迴路加快響應。其線
電壓峰值為 3112202 ≅× 伏特，相電壓峰值為 1803311 ≅ 伏特， *mlV 命令本
應為180伏特，但由於使用1：2之電力變壓器與負載及市電相隔離，故實際之 *mlV 命
4.5.
其中“o ＂為運算子， qvG 、 dvG 分別為比例-積分型交、直軸電壓調節
器[52] 
⎪⎩ +−−= e uvwde uvwqefe uvwde uvwddve abcd ivCvvGi _____ )( ωo
 (4.35) 
器輸出電壓之調節量。其中 qiG 、 diG 分別
⎪⎩ +−−= _____ )( e uvwde abcqefe abcde abcddie abcd viLiiGv ωo
 (4.36) 
電壓的大小，使輸出電壓在
負載變動下能維持最小的變化量，提供穩定的電源。 
令為90伏特。 
1 基於比例-積分控制器設計之電壓控制模式 
根據式(4.20)，將回授而得的三相電壓經同步旋轉座標軸轉換，與電壓命令相
減得一誤差，以比例-積分控制器提高響應 度並減少穩態誤差，可得濾波電感的
電流命令。
速
。 
⎪⎨
⎧ ++−= e uvwqe uvwdefe uvwqe uvwqqve abcq ivCvvGi _____
***
***
)( ωo
於式(4.35)得到濾波電感電流命令後，根據式(4.21)，將濾波電感電流命令減去
經同步旋轉座標軸轉換後之實際濾波電感電流值，以比例-積分控制器提高響應速
度並減少穩態誤差，即可得到三相換流
為交、直軸比例-積分型電流調節器。 
⎪⎨
⎧ ++−=
***
***
_____ )(
e
uvwq
e
abcdef
e
abcq
e
abcqqi
e
abcq viLiiGv ωo
由式(4.35)與式(4.36)可得同步旋轉座標系統下電壓控制模式，交、直軸之電壓
及電流控制方程式，作為三相換流器之電壓及電流閉迴路控制之依據。其控制方
塊圖如圖4.15所示，以此方塊圖可有效控制三相負載端
 61 
 * 2 2 *
_ _ _ _ _ _ _for 
e e e e
d abc d abc cmd d abc cmd q abc cmd mi i i i= + i≤  (4.38a) 
* 2 2 *
_ _ _ _ _ _ _ for 
e e e e
q abc q abc cmd d abc cmd q abc cmd mi i i i= + i≤  (4.38b) 
* 2 2
2 2
*
*
_ _ _ _ _
_ _ _ _
for e e emd abc d abc cmd d abc cmd q abc cmd m
e e
d abc cmd q abc cmd
ii i i
i i
= +
+ _ _
ei i>  (4.38c) 
* 2 2
2 2
*
*
_ _ _ _ _
_ _ _ _
for e e emq abc q abc cmd d abc cmd q abc cmd m
e e
d abc cmd q abc cmd
ii i i
i i
= +
+ _ _
ei i>
e
e
 (4.38d) 
於式(4.38)得到濾波電感電流命令後，根據式(4.21)，將濾波電感電流命令減去
經同步旋轉座標軸轉換後之實際濾波電感電流值，得電流誤差值與誤差值變化
量，再配合式(4.24)將其標么化，即可得模糊邏輯控制電流迴路之輸入變數。依據
模糊邏輯控制的原理，將輸入變數經由模糊化、查詢模糊邏輯規則表，如表4.6或
表4.7、解標么化三步驟，可得到經模糊邏輯控制器調節之交、直軸輸出量 、
配合式(4.21) ，即可得到三相換流器輸出電壓之調節量。如下式所示: 
_d abci
u
_q abci
u
*
__ _ _ _d abc
e e
d abc cmd i f e q abc d uvwv u L i vω= − +   (4.39a) 
*
__ _ _ _q abc
e e
q abc cmd i f e d abc q uvwv u L i vω= + +  (4.39b) 
尚須將三相電壓命令經過一限制條件，避免超出系統額定輸出電壓峰值
造成系統硬體損害。由於本系統採用電壓空間向量調變(SVPWM)，額
定輸出電壓為直流側的
maxV
31 倍 
max 3
dcvv =   (4.40) 
故限制條件為 
* 2 2
_ _ _ _ _ _ _  for
e e e e
d abc d abc cmd d abc cmd q abc cmdv v v v v= + max≤  (4.41a) 
* 2 2
_ _ _ _ _ _ _  for
e e e e
q abc q abc cmd d abc cmd q abc cmdv v v v v= + max≤  (4.41b) 
* 2 2
2 2
max
_ _ _ _ _
_ _ _ _
fore e ed abc d abc cmd d abc cmd q abc cmd
e e
d abc cmd q abc cmd
Vv v v v
v v
= +
+ _ _ max
e v>  (4.41c) 
 63 
 4.6 市電並聯運轉之控制器設計 
分散式發電系統與市電並聯可分為兩種模式，電壓源與電壓源並聯或是電流
源與電壓源並聯。若將三相換流器視為一電壓源，市電視為一電壓源，以電壓源
與電壓源並聯，不但響應較慢，且尚須製作一 PLL 鎖相迴路電路與市電同步[56]，
使三相換流器輸出三相電壓與市電電壓同相。本研究將三相換流器視為一電流源
與市電並聯，利用同步偵測電路在偵測到市電電壓零點的同時與市電並聯運轉，
讓三相換流器輸出三相電流與市電相電壓同相，使市電端功率因數接近 1，而傳
送完全實功率給市電系統。電流控制模式藉由迴授電感電流進行控制，其電流波
形接近正弦波，透過控制器設計，加快響應速度。控制較簡單且響應較電壓控制
快，亦無需擔心以電壓控制模式進行並聯時，輸出電壓與市電電壓大小不同，進
而產生電流損壞硬體電路之問題[57]。 
由於市電的線電壓有效值 為己知，因此控制三相換流器之輸出電流的有
效值 及該電流與市電電壓之間的相位角度
llv −
lli − 0θ ，便可提供實功率
0cos3 θlllle ivP −−= 及虛功率 0sin3 θlllle ivQ −−= 給市電系統。如此，在同步旋轉
座標系統控制下，調節直軸電流以控制實功率輸出，調節交軸電流以控制虛功率
輸出，使系統操作在並聯運轉時能使市電端功率因數接近 1[52]。 
若市電電源為三相平衡且為純正弦波，則其三相電源電壓 、 、 表示為 ae be ce
sin
sin( 120 )
sin( 120 )
a e
b ml e
c e
e t
e V t
e t
ω
ω
ω
⎡ ⎤ ⎡ ⎤⎢ ⎥ ⎢ ⎥= −⎢ ⎥ ⎢ ⎥⎢ ⎥ ⎢ ⎥+⎣ ⎦ ⎣ ⎦
o
o
 (4.42) 
其中 eω 為市電並聯下，市電側電源角頻率， 為市電相電壓之峰值。 mlV
輸入負載之實功率(
L
P )與虛功率(
L
Q )的瞬時值在三相座標系統下可表示為 
   (4.43a) 
L a u b v c w
P e i e i e i= + +
  ( ) ( ) ( )
3L
b c u c a v a b we e i e e i e e iQ − + − + −=  (4.43b) 
 65 
   _
3
2
e
e ml qQ V i= − abc  (4.48b) 
因此將功率命令帶入(4-36)，可得交、直軸電流命令分別為 
  
*
_ _
*
_ _
2
3
2
3
e
e
mld abc cmd
e
q abc cmd e
ml
P
Vi
i Q
V
⎡ ⎤⎢ ⎥⎡ ⎤ ⎢ ⎥=⎢ ⎥ ⎢ ⎥⎢ ⎥⎣ ⎦ ⎢ ⎥⎢ ⎥⎣ ⎦
 (4.49) 
由此可知當三相換流器並聯上市電時，因其輸出相電壓峰值固定，調節直軸電流
可以控制實功率，調節交軸電流可以控制虛功率。交、直軸電流命令之設定須依
據系統額定容量進行限制，避免系統發生崩潰。故直、交軸電流命令需以額定輸
出電流峰值 做限制 *mi
2 2
*
*
2 2
_ _ *
_ _ _ _
_ __
*
_ __
_ _
_ __ _ _ _
                                       for 
  for 
e
d abc cmd e e
d abc cmd q abc cmd mee q abc cmdd abc
ee
d abc cmdmq abc
d abc cmee e q abc cmdd abc cmd q abc cmd
i
i i
ii
iii i
ii i
⎡ ⎤
i+ ≤⎢ ⎥⎡ ⎤ ⎢ ⎥⎣ ⎦⎢ ⎥ = ⎡ ⎤⎢ ⎥⎣ ⎦ ⎢ ⎥⎢ ⎥+ ⎣ ⎦
2 2 *
_ _
e e
d q abc cmd mi i
⎧⎪⎪⎪⎨⎪ + >⎪⎪⎩
    (4.50) 
其中 、 為電流控制模式之直、交軸電流命令。 *_e abcdi
*
_
e
abcqi
4.6.1 基於比例-積分控制器之電流控制模式 
根據式(4.21)，將依功率分配計算後所得之濾波電感電流命令式(4.50)，減去經
同步旋轉座標軸轉換後的實際濾波電感電流值，以比例-積分控制器提高響應速度
並減少穩態誤差，即可得到三相換流器輸出電壓之調節量。其中 、 分別為
直、交軸電流比例-積分型調節器[52]。 
diG qiG
* * *
_ _ _ _( )
e e e e
d abc di d abc d abc f e q abc d uvwv G i i L i vω= − − +o _e
_
e
 (4.51a) 
* * *
_ _ _ _( )
e e e e
q abc qi q abc q abc f e d abc q uvwv G i i L i vω= − + +o  (4.51b) 
由式(4.51)可得同步旋轉座標系統下電流控制模式，直、交軸之電流控制方程
式，作為三相換流器之電流閉迴路控制之依據。其控制方塊圖如圖4.17所示，其中
 67 
 之調節量。如下式所示: 
*
__ _ _ _d abc
e e
d abc cmd i f e q abc d uvwv u L i vω= − + e
e
 (4.52a) 
*
__ _ _ _q abc
e e
q abc cmd i f e d abc q uvwv u L i vω= + +  (4.52b) 
尚須將三相電壓命令經過一限制條件，避免超出系統額定輸出電壓峰值 造
成系統硬體損害。由於本系統採用電壓空間向量調變(SVPWM)，額定輸出電壓為
直流側的
maxV
1 3 倍 
max 3
dcvv =   (4.53) 
故限制條件為 
* 2 2
_ _ _ _ _ _ _ for 
e e e e
d abc d abc cmd d abc cmd q abc cmdv v v v v= + max≤  (4.54a) 
* 2 2
_ _ _ _ _ _ _for 
e e e e
q abc q abc cmd d abc cmd q abc cmdv v v v v= + max≤  (4.54b) 
* 2 2
2 2
max
_ _ _ _ _
_ _ _ _
for e e ed abc d abc cmd d abc cmd q abc cmd
e e
d abc cmd q abc cmd
vv v v v
v v
= +
+ _ _ max
e v>   (4.54c) 
* 2 2
2 2
max
_ _ _ _ _
_ _ _ _
for e e eq abc q abc cmd d abc cmd q abc cmd
e e
d abc cmd q abc cmd
vv v v v
v v
= +
+ _ _ max
e v>   (4.54d) 
 
由式(4.52)及式(4.54)可得同步旋轉座標系統下電流控制模式，直、交軸之電流
控制方程式，作為三相換流器之電流閉迴路控制之依據。其控制方塊圖如圖4.18所
示，其中直、交軸電流命令需限制在系統之額定容量，以避免系統崩潰。利用此
方塊圖可以控制傳送至市電之實功率及虛功率大小，使系統不僅可提供實功率至
電力網路，亦具有虛功率補償能力以提升市電側功率因數。 
 69 
 第五章  遠端監控系統 
5.1 前言 
本章係以控制區域網路 (Controller Area Network, CAN)為基礎，並加入
LabVIEW 虛擬儀控技術與無線通訊技術，建構一套具有親和力之人機監控介面之
無線監控燃料電池發電系統。 
5.2 LabVIEW 的簡介 
LabVIEW[58,59]是美國國家儀器（National Instrument）公司（簡稱 NI 公司）
於 1986 年所發展出的套裝軟體及界面，是一種可以用圖形（Graphics）環境來建
立程式的語言，故又可稱之為“G＂語言。其使用圖形程式設計概念，使數位信號
處理、率波、數值、量測的應用和統計分析等工程技術變的平易而簡單。 
對於儀表控制及資料擷取之自動程序方面，若以傳統的程式語言 C、BASIC
等來規劃、執行，其步驟相當複雜且困難，但 LabVIEW 降低了這些複雜的工作。
其歸於 LabVIEW 是屬於高階的圖形程式語言，可利用圖示連結的方式作自動測試
及量測，大大降低在程式設計時的一些複雜步驟。LabVIEW 所設計的圖控儀表，
不論在外觀與操控上都與真實的儀表外觀很相似，因此又被稱為虛擬儀表（Virtual 
Instrument），簡稱 VI。而此種虛擬儀控軟體，以圖形化方式賦予人機介面功能，
因此在編寫程式過程中，較一般傳統編譯軟體工具更為簡單、方便，也更加縮短
程式設計者的設計時間，因此非常適合發展為監測軟體。而在 VI 的設計上主要分
為三個主要的部分[59]： 
1.  前置面版（Front Panel）亦稱人機界面。 
2.  程式方塊流程圖（Block Diagram）。 
3.  圖像和連接器（Icon/Connector）。 
我們以 RS-232 的子 VI 來說明，前置面版，如圖 5.1 所示，是我們設定輸入值
和從程式方塊流程圖觀察輸出值的一種工具，因為前置面版類似一真正的儀表，
所以其輸入稱為控制器（Controls）而輸出則稱為顯示器（Indicators），在此主要
 71
 圖 5.1  RS232 的人機界面 
 
 
圖 5.2  RS232 的程式方塊流程圖 
 
 73
 5.3 通訊網路界面與 LabVIEW 
在一般資料傳輸時，資料輸出入動作一定有一個來源和一個終點，而無論來
源與終點的資料格式為何種形式，都必須透過共同認定的通訊界面或通訊協定才
能進行。在本研究中主要是用到串列埠通訊界面（RS-232）及 TCP/IP 通訊協定的
部分。 
5.3.1 串列埠通訊界面 
電腦的串列埠和週邊設備的連接，市場上已成立了一個標準，其規格是由 EIA
（Electronics Industries Association，電子工業學會）所訂定，叫 EIA RS-232C 標準
（RS 代表 recommended standard）一般稱為 RS-232，其資料組成格式如圖 7.4 所
示。RS-232 規格適用於各類的串列傳輸，所以這規格用 DTE（data terminal 
equipment，資料終端設備）來代表負責處理資料的設備，用 DCE（ data 
communication equipment，數據通訊設備）來代表負責將資料傳送的設備。 
 
圖 5.4  RS-232 資料組成格式 
而要和 DSP 晶片傳輸前，我們必須先對電腦和 DSP 晶片的串列埠界面 RS-232
做初始化，設定以下的通訊參數，如圖 5.4 所示： 
傳輸埠（COM port）    :  COM1 or COM2 
傳輸鮑率（Baud rate）  :  19200 bps 
資料長度（Data bits）   :  8 bits 
停止位元（Stop bit）    :  1 bit 
 75
    Internet Protocol                   IP 協定 
   Transmission Control Protocol        TCP 協定 
   File Transfer Protocol               FTP 協定 
   TELNET Protocol                  TELNET 協定 
在複雜的網路通訊系統中，為了維護各層之間的運作正常及能互相溝通，因
而產生了一些特殊的協定，稱為協定家族（Protocol Family），也稱為通訊協定
（Protocol）。 
為 了 制 定 網 路 通 訊 協 定 的 標 準 ， ISO （ International Standardization 
Organization：國際標準組織）發表了 OSI（Open System Interconnection Model）模
型，以此做為網路設計、連線之標準及準則。 
OSI 模型共分為七層，如圖 5.6 所示，每一層包括不同的網路裝置（Device）
或通訊協定（Protocol）。由上而下分別為：應用層、表現層、會議層、傳輸層、網
路層、資料連結層以及實體層[59,60]。 
(1) 應用層（Application Layer），為 OSI Model 中的最高層，主要功能為支援應用
軟體，如 FTP、Telnet、E-mail 等。 
(2) 表現層（Presentation Layer），本層主要在決定電腦間如何”表現”，也就是定義
其資料格式。另外，表現層負責通訊協定間的轉換、資料加密（Encrypt）、字元轉
換及資料壓縮（Compress）等。 
(3) 會議層（Session Layer），本層主要建立兩個不同應用程式間的通訊連結、處理
訊息及關閉連結等，並處理名稱的辨識。 
(4) 傳輸層（Transportation Layer），本層主要的功能在確保傳遞封包（Packet）的
過程中，能按照先後順序正確無誤地被處理。另外，傳輸層的另一功用是將過長
的資料分成數個小封包或將數個小封包組合在一起，以方便封包在傳遞的過程中
更有效率。而在接收端的傳輸層中，則將收到的封包重新組合成原來的資料，並
且回傳已收到的訊息至傳送端。 
 77
 體層與連結層）定義了網路的實體媒體，透過網路媒體傳送與接收資訊所需遵循
的訊號特性，及要求媒體存取權以進行傳輸的存取方式。第 3、4 運作層（網路層
與傳輸層）將資訊從傳送端移至接收端，並處理所要接收的資料，第 5、6、7 運
作層（會議層、表現層與應用層）負責管理網路上進行中的對話或通訊，負責處
理資料表示與解釋的問題，供應用程式使用或透過網路傳出。 
相對於 OSI 的七層協定，TCP/IP 協定則將之簡化為四層。事實上，不論使用
OSI 或是 TCP/IP 中的哪一種協定，資料傳輸所牽涉的理論都是一樣的。因此 TCP/IP
雖然只訂了四層協定，但是並不表示它省略了 OSI 中某一層的功能，而是將 OSI
中的兩層或三層合併為一層。圖 5.7 是為 OSI 協定與 TCP/IP 協定架構之比較。 
 
應用層
表現層
交談層
網路層
連結層
實體層
應用層
傳輸層
網際層
網路存取層
圖 5.7  OSI 與 TCP/IP 通訊協定架構之比較圖 
如同 OSI 模型一樣，當資料被送去網路時，沿堆疊向下傳送，而當收到網路
來的資料時，沿堆疊向上傳送。堆疊中每一層加入控制資料以確保傳送正常。這
些控制資料稱為「資料頭（Header）」，因為它們被放在傳送資料的前面，而每一層
都把上一層傳來的所有資料視為一般資料，並在那些資料前面加上自己的資料
頭。這種動作稱為「封裝（Encapsulation）」，如圖 5.8 所示。而當收到資料時，則
 79
 5. 執行資料包的分解與重組 
但是 IP 是一個「非連線」協定，這說明 IP 在傳送資料之前，不會交換控制訊息（稱
為「交握」，Handshake）以建立端點對端點的連線。相對而言，連線導向
（Connection-oriented）的協定在發送資料之前，會與遠地系統交換控制訊息，以
確定對方已準備好接收資料。 
(3) 傳輸層（Transport Layer）：網際層上面緊鄰的是主機傳輸層，通常稱為傳輸層。
傳輸層中最重要的兩個協定是傳輸控制協定（TCP）和使用者資料協定（UDP）。
TCP 提供可靠性高，具有端點錯誤偵測和更正功能的資料傳輸服務。TCP 是一個
可靠的、連線導向的、字元流的一種通訊協定。TCP 使用稱為「確認重傳（PAR）」
的機制提供傳輸的可靠性。簡單的說，一個使用 PAR 的系統，除非「聽」到遠方
系統「說」資料安全抵達。否則就重新發送資料。 
(4) 應用層（Application Layer）:TCP/IP 的頂層是應用層。使用運輸層協定傳送資
料的所有程序都在這一層裡。程序都在這一層裡。應用層協定很多，大部分為使
用者提供服務。而最著名的應用層協定有： 
1. TELNET，網路終端機協定，提供網路上的遠程登錄（Login）。 
2. FTP，檔案傳輸協定，可以做互動式檔案傳輸。 
3. SMTP，簡易郵件傳送協定，傳送電子郵件。 
TCP/IP 這個名稱是一套完整的通訊協定。他的名稱則來自於兩個協定：傳輸控制
協定（Transmission Control Protocol）及網際協定（Internet Protocol）。雖然其中還
有需多其他的協定，但是 TCP/IP 無疑地是最重要的兩個協定。在本文中由
LabVIEW 所發展的網路監控，主要是架構只到傳輸層，為使用者提供遠端監控的
服務，而使用的通訊協定為 TCP/IP，讓遠端電腦經由 TCP/IP 通訊協定而接收到資
料。 
而 LabVIEW 面版上的 TCP/IP 函式如圖 5.9 所示。在 TCP/IP 的連接中，伺服
端必須先在確定的連接埠中監聽（LabVIEW 的函式名稱為 Listener），此時伺服端
 81
 6. 關閉連接。 
客戶端部分： 
1. 開啟連接函式。 
2. 對伺服端傳送連接命令。 
3. 接收伺服端回傳連接命令。 
4. 如需必要，則重複 1、2 步驟。 
5. 與伺服端產生雙向的連接。 
6. 關閉連接。當連接已經確定後，我們可以利用 LabVIEW 中 Read 及 Write
等函式，讓資料在伺服端與客戶端之間傳輸。但是在傳送資料前，有一件
事情是使用者所必須知道的。在 TCP/IP 資料的傳送過程中，資料的型態
必須是字串（string），因此在 LabVIEW 中，我們必須在傳送資料前，將
各種型態的資料轉換成字串。 
伺服端
Port
6784
客戶端
TCP/IP
伺服端處於監聽狀態中
等待客戶端開啟連接
Port
6784
客戶端
TCP/IP
伺服端
連接成功後伺服端與
客戶端產生雙向的連接
圖 5.10  客戶端與伺服端連接示意圖 
5.4 控制區域網路 
控制區域網路，是由德國 Bosch 公司在西元 1983 年提出，將 CAN 設計為汽
車環境中微控制器通訊。由於汽車上的電子控制單元日益增加，連結每個電子控
 83
 在訊號傳送出去前會先分為正負兩條線路，到達接收端後，再將訊號相減還原成
原來的訊號，也就是（正＋干擾）-（負＋干擾），如此能有效的防止雜訊干擾。
RS485 為半雙工（Half Duplex）的工作模式，資料的流動是雙向的，但是同一時
間只能一個方向進行。若要使用全雙工（Full Duplex）的工作模式，同時間雙向資
料傳送，則需要四條線傳送資料，接收傳送各兩條。除傳送資料線外，尚需要一
條 Enable 線，決定站台是傳送還是接收狀態。RS485 傳輸的距離較長，因其所供
的訊號能量的不同，最長的傳輸距離可以達到 1200 公尺。RS485 的最大傳輸速率
為 10 Mbits/sec，在最大距離 1200 公尺時降低至 2400 bits/sec。RS485 的連線站台
數目是有限制的，接收和傳送站台最多各 32 個，若需要再增加站台，則需要額外
增加中繼器。因為缺乏過濾信息的裝置，RS485 接收資料時必須完全接收完成後
才能判斷此資料能不能為己用，對於主機而言負擔相當重，而且浪費時間在接收
不相干的資料上。 
乙太網路(Ethernet）是採用 CSMA/CD（Carrier Sense Multiple Access with 
Collision Detection）的存取控制通訊協定。也就是當在傳輸時，收發器會偵測是否
有其他站台同時在傳送信息，若發生衝突，則全部站台都立即停止傳送，各自等
待一段長度隨機決定的時間後再重新傳送。隨機等待時間的目的，是在降低重複
發生碰撞的機會。在網路繁忙的情況下，等待重新傳輸資料 10 次中止後，平均等
待時間會增加。因為缺乏仲裁（Arbitration）的機制，當碰撞發生時，所有站台都
必須停止傳送，等待的時間難以掌握，容易造成重要資料的遺失，無法符合 Real 
time 通訊的要求。多區段的網路架構下，標準的 Ethernet 協定中，最大站台數為
1024 個，纜線最長可到 2500 公尺，最大速度為 10Mbits/sec。而在快速 Ethernet
協定中，最大速度可達 100Mbits/sec，纜線長度則限制在 250 公尺。 
IC 之間的溝通匯流排(I2C)是 Philips 公司在 1980 年代所發展的雙向 2 線式串
列匯流排標準（serial bus）。I2C 是 Inter-Integrated Circuit 的縮寫，顧名思義就是 IC
之間的溝通匯流排。協定簡單，速度不快，通常是用在一些簡單的系統或者晶片
組 IC 間傳遞命令，而非資料傳輸。I2C bus 只需要兩條線傳送資料，一條為 SCL
（Serial Clock），一條為 SDA（Serial Data）。I2C 本身為 Open Collector 構造，因
 85
 圖 5.11 各傳輸協定傳輸速度與傳輸距離的比較圖 
至於在多站台的網路架構下。RS232 各站是以星狀連結，負責協調網路中各
站通信的為一中央控制器，所有通信信息均要經過中央控制器才能交換，需要額
外增加裝置。Ethernet 有單一纜線與多區段兩種方式，單一纜線：各站台經由一收
發器連結到同軸纜線，需要 8 個接點，收發器的功用為偵測碰撞。多區段：每個
區段使用點對點纜線，以及中繼器互相連結的多重節點區段，標準協定
（10Mbits/sec）下，每各站台需要 4 個接點，而快速協定（100Mbits/sec）下，需
要 8 個接點。RS232、RS485 和 Ethernet 都因為缺乏仲裁的機制，當傳送衝突發生
時，資料送達的時間難以掌握，無法達到即時的要求。Profi bus 只需要兩條線傳輸，
但各站台需要提供獨立的電源供應。I2C 與 CAN 一樣只需要兩條線就能進行多站
台的資料傳輸，並且同樣具有仲裁的功能。 
上述的通訊協定除 CAN 之外，皆為定址（Address）的架構。網路上的每個站
台都有專屬的位址，而每筆傳送的信息中都含有接收這筆信息的站台位址，一筆
信息只會有一個站台接收並使用，無法使用信息廣播的模式。因此具有廣播信息
的能力，是本系統規劃必須具備的功能。各協定的優缺點比較如表 5.1 說明: 
 
 
 87
 供設備功能描述方式，執行網路管理功能。 
CAN 通訊協定跟 Ethernet 協定一樣，採用了 CSMA/CD(Carrier Sense Multiple 
Access with Collision Detection)的方法。但 CAN 還加入了 CD(Collision Detection) 
協定的仲裁機構處理優先權問題，說明如下，CS：傳送資料前會先確認匯流排是
否處於 Idle 狀態，亦即匯流排上有無資料的流動。MA：每一個 Node 可為 Master
或 Slave，即 Multi-Master。CD：若兩個 Node 同時傳送資料，則 Collision (碰撞)
發生，並交由 CAN 仲裁機構處理優先權問題。 
CSMA/CD 特性是所有 Node 具有相等的傳輸等級 Multi-Master，具備廣播
(broadcast)與 Node to Node 功能，並可隨時在匯流排上新增或移除 Node。Bus 
Message 透過 Message ID 設定優先權，其機制是各個 Node 傳輸採取 Message 或
稱封包(Package)方式傳輸。依 Remote Message 傳送資料，每個 Node 可由軟體決
定所接收的 Message 是否處理或拋棄。對於 Message Collision 採用非破壞性仲裁解
決，使得重傳的 Message 具有最高優先權。至於非破壞性仲裁是解決資 Collision(碰
撞)的方法之一，當發生碰撞後，可以不破壞並保有原來的 Message，並由優先權
高的 Message，即 ID 數值低者，取得 CAN 匯流排使用權，使得重新傳送 Message
擁有最高優先權，亦即是除重新傳送 Message 外，其他 Message 將喪失優先權。
為達到上述功能必須先定義傳送與接收位元優先權狀態(強勢性(Dominant)位元為
0，弱勢性位元（Dominant）位元為 1)，每個 Node 必須不斷監控 CAN 匯流排，以
即時接收或傳送資料。 
CAN 具有以下特點: 
1. 資料訊息具有優先權(Priority)。 
2. 優先權的仲裁(Arbitration)為非破壞性(Non-destructive)。 
3. 可設定優先權與資料傳輸長度(1-8 個位元組)。 
4. 採用廣播的方式(Multicast)，並藉所傳輸的訊息做時序同步的動作。 
5. 任一節點皆可主動發送訊息(Multimaster)。 
6. 未傳送成功的訊息會自動重新傳送。 
7. 強大的錯誤檢查與錯誤頻繁的排除功能。 
 89
 82C250、TI SN65HVD230。 
(5)CAN-Bus：CAN的電路只有傳送位元值為0(Low)代表強勢性位元（Recessive），
和位元值為1(High)代表弱勢性位元（Dominant）的狀態，所以只需要兩條線分別為
CAN_H 和CAN_L。在ISO-IS 11898 標準中，當CAN_H及CAN_L為2.5伏特時，即兩
者電壓差為0伏特，其位元值為1。當CAN_H上升到3.5伏特而CAN_L下降到1.5伏
特，即兩者電壓差為2伏特，其位元值為0。因此基本的CAN匯流排通訊只要兩條銅
絞線（Twisted Pair）作為匯流排的主線，其他各站台只要搭在主線上即可，使用銅
絞線可以抵抗電磁干擾。 
(6)Terminal 120 Ohm電阻:終端電阻是防止資料傳送出去後回波震盪，會破壞資料。 
CAN bus信息的傳送與接收的流程如圖5.13所示: 
圖5.13 CAN bus信息的傳送與接收的流程圖[70] 
CAN Bus傳送流程說明： 
步驟1: 
Host-Controller 將 要 傳 送 的 資 料 送 到 CAN-Controller 。 CAN-Controller 透 過
Message Controller將資料送到Transmit Buffer所在的暫存器（Register）位址。 
步驟2: 
 91
  
 
圖5.14 CAN匯流排準位仲裁圖 
表5.2 圖5.14的位元優先判斷表 
NODE1 0 1 1 0 0 1 1 1 1 1 1 1 1 
NODE2 0 1 1 0 0 1 0 1 1 0 0 1 0 
NODE3 0 1 1 0 0 1 0 1 1 0 0 1 1 
CAN 
Bus 
0 1 1 0 0 1 0 1 1 0 0 1 0 
5.4.5 CAN 的各欄框介紹 
1. CAN 資料欄框(Data Frame) 
 
CAN匯流排站台傳送信息時，會產生一組具有固定格式的Data Frame，其中又
分為Standard CAN Data Frame和Extended CAN Data Frame 兩種，這兩者主要的差別
在於Identifier bit的長度，前者為11 bit，後者為29 bit， Standard CAN Data Frame Format
的結構如圖5.15所示。 
 93
 Remote Frame跟Data Frame在形式上唯一的不同是Remote Frame沒有Data 
Field，一般使用CAN的Remote Frame主要是想做data的request/response，因為Remote 
Frame 的功用是發一個要求信息，要求別的站台傳送所需要的信息。被要求傳送回
來的信息的識別碼必須要和要求信息Remote Frame 的識別碼相同。 
3. CAN錯誤欄框(Error Frame) 
 
           
圖5.17 Error Frame Format 
錯 誤 欄 框 是 由 兩 個 區 域 所 構 成 : 錯 誤 旗 標 (Error Flag) 與 錯 誤 邊 界 (Error 
Delimiter) 。 
錯誤旗標可分為下列兩種: 
(1)主動式: 由 6 個強勢位元(0)所組成。 
(2)被動式: 由 6 個弱勢位元(1)所組成。 
錯誤邊界不分主動與被動，皆由 8 個弱勢位元(1)所組成。當 CAN 匯流排上資
料有誤時，主動反應錯誤(error-active)的節點便會立即發送出主動式的錯誤旗標;相
對的，被動反應錯誤(error-passive)的節點也會送出被動式的錯誤旗標。主動式的錯
誤旗標違反了位元填充的規則，也有可能破壞 CAN 欄框的固定格式(如:資料欄框
的確認區與欄框終止)所以，所有其他正常的節點都會偵測到此ㄧ筆錯誤訊息，而
接著發出錯誤旗標。當各節點傳送完各自的錯誤旗標之後便開始監測 CAN 匯流排
上的值，當偵測到由強勢位元轉為弱勢位元的過渡(transition)時，表示此時所有的
主動反應錯誤節點都已經送完錯誤旗標，而開始傳送錯誤邊界。在所有節點都監
 95
 取時間處理資料。其欄框格式和錯誤欄框幾乎ㄧ模ㄧ樣。過載旗標為 6 個強勢位
元，而過載邊界為 8 個弱勢位元。協定中規定只有在兩種情況之下節點可以發送
過載欄框: 
(1)接收節點為了延遲下一筆資料欄框或遙控欄框的傳輸。 
(2)當節點在中斷欄框期間偵測到強勢位元。 
在第一種情況中，過載欄框只能由接收節點在中斷欄框中的第一個位元處開
始發出;而在第二種情況下，則是由每一個在中斷欄框期間偵測到強勢位元的節
點，在其所偵測到的強勢位元的下一位元發出。在所有節點都發送完過載旗標後，
便開始傳送過載邊界，如此便完成過載欄框。CAN 的協定中規定，在任兩個資料(遙
控)欄框之間，或是資料欄框與遙控欄框之間，所發送的過載欄框不可以連續發送
兩次。雖然其欄框格式與錯誤欄框幾乎相同，但是被過載欄框所緊接的資料(遙控)
欄框並不會再重新傳輸。 
5.4.6 CAN 的錯誤處理與錯誤種類 
CAN 對於錯誤的處裡功能可分為 1.錯誤偵測與 2.錯誤頻繁的排除。 
CAN 整體的錯誤偵測功能可以說是非常強大，其可以偵測出的錯誤範圍為: 
1. 所有整體的(global)錯誤。 
2. 所有發送節點的區域(local)錯誤。 
3. 在一個欄框中，最多至 5 個隨機分佈位元的錯誤。 
4. 所有長度小於或等於 15 個位元的連續錯誤。 
5. 所有奇數個數的位元錯誤。 
依照規格書所示，經過以上的檢查後，未被偵測出來的錯誤訊息之機率為
。 -11x107.4
協定中列舉了五種錯誤:1.位元錯誤、2.填充錯誤、3.循環多餘碼錯誤、4.格式
錯誤、5.確認錯誤。當節點偵測到任何錯誤時，將會傳出錯誤旗標，以告知其他節
點，最後將傳至整個CAN匯流排。 
5.4.7 CAN 的同步與時序分析 
CAN匯流排的位元時間結構如下圖 5.20 所示，一個位元包含四個區段，分別
 97
 controller 會重新對位元時序作初始化。也就是位元時間重新開始，以達到各站台
的同步。 
所謂Re-Synchronization當欄框在接收時便可運作。利用增長或縮短位元時間的
量，改變取樣點的位置，以達到同步。 
CAN 預期所有的邊緣變化都要在同步段內，如果不在同步段(Sync)內，我們稱
Phase Error。Phase Error 是一個有符號的數值，在同步段前為負，在同步段後為正。
當一個欄框的起始，自動執行硬同步(Hard Synchronization)，當欄框中＂僅能＂作再
同步 (Re-Synchronization)， 硬同步(Hard Synchronization)會自動將邊緣與同步段
(Sync)同時結束，所以不會有 Phase Error。再同步(Re-Synchronization)會增加或減少
相位緩衝段 1(Phase Seg1)、相位緩衝段 2(Phase Seg 2)讓取樣點落在正確的位置，如
果 Phase Error 為正，則減少相位緩衝段 1(Phase Seg1)，若為負，則減少前面的相位
緩衝段 2(Phase Seg 2)，增加或減少的數值由 Phase error 的數值和 SJW 的設定決定，
若 Phase error 小於 SJW，就使用 Phase error 的數值，若大於 SJW 就使用 SJW 的數
值。(SJW：範圍 1-4 TQ，同步調整寬度。) 
5.5 GSM 簡介  
移動通訊特別組(Group Special Mobile,GSM)起源於 1982 年初，當初歐洲各國已
陸續發展各自的行動電話系統，例如英國的 TAGS 系統、北歐所設計的 T450/900
系統，並提供商業化的服務。但問題就出在於這些系統間彼此都不相容，當用戶
從英國移動到其它國家時，就必須另外申請當地的行動電話，因為原來的行動電
話已經不能使用了。為了解決系統間不相容的問題，以提供用戶漫遊全歐洲的服
務，因此歐洲國家想要在歐洲建立統一的通訊標準，當時稱之為 GSM[73]。 
基本的 GSM 系統使用 900MHz 的頻段，DCS-1800(Digital Cellular System-1800)
與 PCS-1900 都是從 GSM 的衍生出來的。使用 1800MHz 的頻段大富提昇了系統的
容量，在人口稠密的地方很受歡迎。不過 1800MHz 的涵蓋範圍比 900MHz 要小，
因此有所謂的雙頻(Dual-band)手機，在兩個頻段範圍內能使用。ETSI 也發展出來
 99
 1. 採用簡訊服務傳輸方式，就算監控端系統異常而不能即時接收資料時，資料在
24 小時之內可在GSM 服務中心代為保存直到監控端接收為止，使得資料不易
遺失。 
2. 現今幾乎人手一隻手機，因此當偵測裝置異常時，也能即時透過簡訊發佈方
式，通知管理人員前往勘查校正。 
3. 在台灣，GSM 涵蓋率極高，基地台廣佈，不管在偏遠山區或空曠地區都有不
錯的通訊效果。 
4. 由於在偏遠地區，外部電源取得不易，GSM的發射功率低，可以解決我們電源
有限的問題。 
5.6 監控系統之工作原理 
監控系統是有系統性的將監視對象的訊息或狀態，傳回到控制中心給操作者
知道，經綜合和判斷後在正確的操控監視對象，所以監控系統工作原理可以大概
區分為取樣、控制及報表製作三大步驟。 
z 取樣 
即所謂監控系統先將被監控的現場設備的工作狀態，如開關的投入/跳
脫、電壓、電流、壓力、溫度…等物理值大小，一取樣工作週期即時取
樣信號，經由通訊傳回監控電腦，並轉換處理後顯示螢幕上如圖 6.1 所
示，供操作人員隨時得知系統運轉狀態。 
z 控制 
當被監控對象的量測值超過或低於設定值時，監控主電腦就一事先規劃
的程序，執行遙控調整監控設備以適切方式調整，使監控對象回到設定
值，並作警示動作，完成遠端控制目的，如圖 5.22 所示。 
圖 5.22 監控系統之取樣與控制 
控制信號
電腦
監控對象
（感測器）
量測資料
 101
 料與警報資料，所選擇的 RAM 需較大，而使用容量大之硬碟及磁碟等
外部記憶裝置，是為了記錄資料。 
z 記錄裝置 
傳統是人工抄表，由值班人員於固定時間抄寫監控數值（電壓、電流、
功率等）。目前已可由記錄裝置來取代完成，量測的訊息或控制處理的
內容從現場傳回控制中心，將訊息稱由記錄裝置記錄儲存後，可供作報
表列印使用。 
z 電源裝置 
監控系統由 CPU 等精密電子之設備所構成，為了維持其穩定性、可靠
性之功能，必須能夠供給持續且穩定電力做為電源是不可或缺的，通常
可加上 UPS（不斷電系統）。 
圖 5.23 監控系統之基本架構 
輸入裝置
硬碟裝置
顯示裝置
記錄與列印
電源裝置
控制流程 演算分析 記憶裝置
中央處理裝置
通訊裝置
DSP控制晶片
及相關電路
末端處理單元
通訊傳送單元
中央監視控制單元
監測目標監測目標
 103
  
 105
 步驟3:設定CAN Mailbox接收旗標。 
步驟4:檢查CAN各個Mailbox接收狀態是否改變。 
步驟5:判斷從CAN匯流排上所接收到的電壓及電流值是否異常，若燃料電池發電系
統的電壓及電流值發生異常，則將CAN Mailbox所接收到的資料透過DSP的SCI串列
埠傳送到無線通訊模板，再由無線通訊模板把系統異常訊息傳送到管理人員手機
上，若燃料電池發電系統電壓及電流值為正常狀態，則將電壓及電流值透過無線
通訊模板傳送到遠端的無線通訊模板上，遠端無線通訊模板再把電壓及電流等資
料傳送到具圖控軟體Labview監控介面的電腦上，並將每一次所擷取的資料繪製成
動態的曲線顯示出來，以便於當系統發生問題時可用來除錯。 
步驟6:回到步驟4作判斷。 
 
 
圖5.25 CAN Bus無線通訊監控節點接收程式流程圖 
 107
 5.8.2.4 無線監控燃料電池發電系統監控介面規劃 
在人機介面的面板最上層(圖 5.27)，有三個頁面的選單，分別是設定頁面、主
頁面和波形圖頁面三個選項，除此之外還有離開監控程式和存檔按鍵，當按下離
開按鍵時整個監控程式會停止動作;當按下存檔按鍵時會出現存檔畫面，使用者可
以依據想儲存的檔案格式輸入其副檔名儲存現今燃料電池發電系統的電壓及電流
值。 
1. 主頁面: 
 
 
圖5.27 無線監控燃料電池發電系統主頁面 
圖 5.27 為無線監控燃料電池發電系統主頁面，此頁面為系統之即時監控畫
面，可讓使用者能夠了解燃料電池發電發電系統整體運作的即時情形，並且每隔
10 秒更新一次數值，而每筆數值都是在 DSP 執行平均運算之後，才傳送過來。 
 
 109
  
 
圖 5.29 無線監控燃料電池發電系統波形圖頁面 
4. 無線通訊模版資訊顯示介面: 
圖 5.30 為無線通訊模版資訊顯示頁面，此頁面顯示無線通訊模版傳來的資料
以及資料來源處，如簡訊資料內容、電話號碼以及實際無線通訊模版內所儲存的
資料值(顯示在 Array1 和 Array2 裡) 。 
 
 
 
 111
 第六章  實驗結果與討論 
6.1 前言 
本章節將依據第三、四章之理論分析及控制方塊圖進行軟體程式之規劃，並
說明相關之硬體設計。本研究採用德州儀器公司所生產之數位信號處理器
(TMS320F2812)作為整體系統之控制核心，而軟體則負責實現複雜之控制流程，
以減少硬體電路成本，並增加系統運作可靠度。本章將說明整個系統控制程式規
劃，並完成實體製作以及從實測結果驗證理論分析。 
6.2 硬體電路 
本節將對燃料電池發電系統之電路作一詳細的介紹，如圖 6.1 所示燃料電池
發電系統之整體架構圖中包含了燃料電池系統、數位信號處理器 TMS320F2812、
電力電路、功率電晶體驅動電路（Base Driver）、串聯之鉛蓄電池(單顆 12V，
24AH)、三相隔離變壓器、零點偵測電路、電壓回授電路和電流回授電路及控制
區域網路模組 (CAN module) ，本系統控制核心採用數位信號處理器
TMS320F2812，配合週邊電路，透過回授電壓、電流的方式，利用程式撰寫其控
制策略，進行三相三線式的直流電源與交流電源轉換控制，使控制策略發展及修
改具有相當的彈性。最後，將程式處理計算所得之開關切換信號，送至功率電晶
體閘極驅動電路，以觸發功率電晶體的導通或截止，達到功率轉換的目的。各個
部份分述如下： 
 
 
 113 
 6.2.1 燃料電池系統 
本研究採用加拿大巴拉德公司(Ballard Power System)所生產之質子交換膜燃
料電池(PEMFC)(機型：NexaTM Power Module)作為系統的供電來源，而此燃料電
池發電系統是由 47 片燃料電池堆堆疊而成，其單電池的結構如圖 6.2 所示。由圖
6.2 可知其動作原理為，供應燃料電池之氫氣及氧氣由質子交換膜(PEM)兩側流
入，並於內部進行電化學反應，燃料電池模組的每個電池堆在開路狀態可產生約
1 伏特之電壓，滿載時約為 0.6 伏特，理論上，此模組之電壓範圍由開路電壓 47
伏特至滿載電壓 28.2 伏特，不過由於，燃料電池有內阻在存及電極極化現象產生，
因此實際只能產生開路電壓 43 伏特及滿載電壓 26 伏特，故此燃料電池模組最大
可輸出之功率約為 1.2kW，另外附有監控軟體( NexaMon OEM 2.0 )以監控燃料電
池的操作情形。 
 
 
質子交換膜 
燃料集流板 
燃料循環流動 
低溫電化學處理 
燃料(氫氣) 
氧化劑集流板 
水蒸汽排出 
散熱 
空氣 
 
圖 6.2 PEMFC 單電池結構圖[76] 
6.2.2 數位信號處理器之介面電路 
本系統採用 32 位元定點式數位信號處理器(TMS320F2812)作為控制核心，此
數位信號處理器主要運用於電力電子及數位控制等方面，具有 150MIPS(million 
instruction per second)的運算速度，其單一指令週期約 6.67ns。內建兩組事件管理
 115 
 6.2.3 輸出整流濾波電路 
全橋升壓型轉換器的輸出整流濾波電路，為了適用於高電壓的輸出，所以必
須採用由 組成的橋式整流電路。並與輸出電感 、輸出電容 組成的低通
濾波電路所構成，如圖6.4所示。 
5 ~D D8 oL oC
 
+
_
oL
oC
5D 6D
7D 8D
ov
LoI
 
圖6.4 輸出整流濾波電路 
6.2.4 功率電晶體驅動電路 
圖6.5為功率電晶體驅動電路，主要功能為將數位信號處理器輸出之脈波寬度
調變信號，經由光耦合器(HCPL-3120)作放大(使得驅動電流得以提升，推動高功率
級的電晶體開關)及隔離(防止前級電路遭到後級故障而損壞之效能)。 
 
圖6.5 功率電晶體驅動電路 
6.2.5 零點偵測電路 
圖6.6為零點偵測電路，利用電源信號為弦波的零點特性以檢測市電電源之零
 117 
  
圖6.7 電壓回授電路 
圖6.8為電流回授電路，將回授之電力電流經由電流型霍爾效應(hall effect)元件
(LA-55P)衰減為1000：1的電流訊號，且於霍爾元件上纏繞10匝，並藉由電阻轉換
為電壓訊號。由於開關切換時會產生高頻雜訊，利用此電流感測器可以提高雜訊
抵抗能力及增加電路穩定性。隨後將電壓訊號透過運算放大器(TL074)組成之電壓
隨耦器做隔離，同樣透過二階低通濾波器濾除高頻雜訊，於輸出接一稽納二極體，
將電壓做一限制，以免過電壓導致電路損壞，最後再傳送至DSP之類比/數位接腳
進行轉換。 
 
圖6.8 電流回授電路 
6.2.7 類比數位轉換器(ADC)電路設計 
圖6.9為類比數位轉換器電路，ADS8364為TI生產之高速(最高轉換頻率為
5MHz)、低功耗、六通道同時取樣和轉换的十六位元類比數位轉换器。採用+5V工
 119 
  
圖6.10 準位調整電路圖 
表6.1 準位調整之電阻選用表 
雙極性輸入 R3 R4 
+/-10V 
+/-5V 
+/-2.5V 
5k 
10k 
20k 
1k 
2k 
4k 
6.2.8 控制區域網路模組 
本研究所採用的CAN收發器是用TI所生產的SN65HVD230，CAN收發器的作用
是將CAN控制器傳來的資料轉換成電子信號，並傳送到CAN匯流排上，同樣的，
也將CAN匯流排上的電子信號轉換給CAN控制器。至於SN65HVD230的CAN_H與
CAN_L的輸出準位，如圖6.11所示。當CAN_H與CAN_L均為2.3V時，表示“1＂，
CAN_H=3V與CAN_L=1V時表示“0＂。(註: SN65HVD230為3.3V電源準位，故CAN_H
和CAN_L準位較一般5V電源準位IC低) 
 
 121 
 6.3.1 直流轉換器軟體規劃 
表6.2是本研究擬進行的實驗，分為燃料電池經由全橋式功率轉換器獨立供電
模式，稱為燃料電池獨立供電模式；與燃料電池經由全橋式功率轉換器後並聯截
波器與蓄電池之充放電模式，稱之燃料電池並聯蓄電池供電模式。實驗過程為比
例積分與滑動模式控制結果比較，以燃料電池為系統電源，控制全橋式功率轉換
器，並聯直流截波器作功率調節。 
表6.2  系統實驗規劃表 
 燃料電池獨立供電模式 燃料電池並聯蓄電池供電模式 
初始負載為300W，增加為
450W ， 然 後 再 降 低 為
300W。 
初始負載為300W，改變為負載300W與對
蓄電池充電150W，然後停止對蓄電池充
電，回復為負載300W。 比例積
分控制 初始負載為450W，降低為
300W ， 然 後 再 增 加 為
450W。 
初始負載為450W，增加為負載720W，其
中包含蓄電池放電270W，然後降低為負
載450W，蓄電池停止放電。 
初始負載為300W，增加為
450W ， 然 後 再 降 低 為
300W。 
初始負載為300W，改變為負載300W與對
蓄電池充電150W，然後停止對蓄電池充
電，回復為負載300W。 
滑動模
式控制 
初始負載為450W，降低為
300W ， 然 後 再 增 加 為
450W。 
初始負載為450W，增加為負載720W，其
中包含蓄電池放電270W，然後降低為負
載450W，蓄電池停止放電。 
本研究之控制軟體以Code Composer Studio(CCS)之C語言撰寫，並透過並列埠
(Parallel Port)進行程式載入與偵錯動作。依據表6.2系統實驗規劃表，規劃程式可分
為主程式、回授信號中斷程式、全橋式功率轉換器比例積分控制、全橋式功率轉
換器滑動模式控制，以下將對各部份程式加以說明。 
6.3.1.1 直流轉換器主程式規劃 
圖6.13為直流轉換器系統主程式流程圖。主程式之啟始工作包含資料記憶體的
 123 
  
 
圖 6.13 直流轉換器系統主程式流程圖 
 125 
 6.3.1.3 全橋式功率轉換器比例積分控制副程式 
圖6.15為比例積分控制之流程圖，將回授之直流鏈電壓 與設定電壓 比較
後之誤差值e經比例積分運算後產生控制量 ，其中設定限制條件以保護硬體
之安全，並輸出PWM。 
ov ov
∗
( )d k
 
讀取A/D迴授值
輸出PWM
( )o kv
( ) ( )o oe k v v k
∗= −
1
2 2
( ) ( )
( ) ( 1) ( )
I
u k Ke k
Ku k u k Te k
T
=
= − +
1 2( ) ( ) ( )
0.07 ( ) 0.4
d k u k u k
d k
= +
< <
開始
結束
計算誤差量
設定限制條件
 
 
圖6.15 全橋功率轉換器比例積分控制副程式流程圖 
6.3.1.4 全橋式功率轉換器滑動模式控制副程式 
圖6.16為滑動模式控制之流程圖，透過將回授之直流鏈電壓 、輸入電壓ov fcv
及輸出電流 計算出 、 、 ，再根據參數值推算出等效控制量 ，並設定限
制條件再以 控制並觀察其控制結果。 
oi 1a 2a 3a eqd
eqd
 127 
 (6) 根據市電並聯旗標狀態決定獨立供電模式或並聯供電模式，計算出電壓
控制命令。 
(7) 以空間向量脈波寬度調變產生各臂開關的責任週期，供數位信號處理器
產生各開關狀態，以驅動各臂開關。 
(8) 計算下個週期所需之參數，加快電壓命令決定流程。 
禁能捕捉器中斷
旗標為1 旗標為0
中斷週期
100μs？
否 是
讀取回授A/D值
市電並聯控制器 獨立供電控制器
旗標為0旗標為1致能捕捉器
中斷副程式
輸出PWM控制信號
控制器旗標？
計算下個中斷
週期所需之參數
控制器旗標＝0
關閉繼電器
DSP初始化及
系統參數設定
同步旋轉座標軸
程式開始
程式結束
電壓及電流
保護?
中止PWM控制信號
輸出
是
否
接收
市電並聯旗標？
經由控制區域網
路傳送電壓、電
流值 、rnv ri
 
圖6.17 換流器系統主程式流程圖 
 129 
 6.3.2.3 換流器獨立供電程式規劃 
依據第四章控制器設計撰寫控制程式流程如圖6.19所示。主程式將回授之實際
電壓、電流值，利用預先建好之弦波表(sine table)，以同步旋轉座標轉換至交、直
軸。 
依照圖4.15比例-積分控制器或圖4.16模糊邏輯控制器設計步驟，計算出電壓命
令量，最後經由電壓空間向量脈波寬度調變技術，計算出各開關之責任週期，供
給功率晶體驅動電路切換開關，得到三相平衡電壓，有效值維持在220伏特且頻率
為60赫茲之三相交流電源，以提供平衡三相負載使用。 
6.3.2.4 換流器並聯供電程式規劃 
依據第四章控制器設計撰寫控制程式流程如圖6.20所示。主程式將回授之實際
電壓、電流值，利用一開始即建好之弦波表(sine table)，以同步旋轉座標轉換至交、
直軸。 
根據功率補償概念計算出命令電流，再依照圖4.17比例-積分控制器或圖4.18
模糊邏輯控制器設計步驟，計算出電壓命令量，最後經由電壓空間向量脈波寬度
調變技術，計算出各開關之責任週期，供給功率晶體驅動電路切換開關，使三相
換流器與市電並聯運轉，以電流方式提供功率於電力網路。 
 
 
 
 
 131 
 讀取A/D值
三相座標軸
↓
同步旋轉座標軸
unv vnv wnv
ai bi riui vi si
、 、
、 、 、 、 、
dcv、
*
*
_ _ _ _
_ _
_ _ _ _
_ _
e e e e
q uvw q uvw d uvw d uvwe
d abc cmd
ml
e e e e
d uvw q uvw q uvw d uvwe
q abc cmd
ml
v i v i
i
v
v i v i
i
v
+=
−= −
PI
並聯供電控制器
副程式開始
* * *
* * *
_ _ _ _ _
_ _ _ _ _
( )
( )
e e e e e
d abc di d abc d abc f e q abc d uvw
e e e e e
q abc qi q abc q abc f e d abc q uvw
v G i i L i v
v G i i L i v
ω
ω
= − − +
= − + +
o
o
PWM信號輸出
空間向量脈波
寬度調變
+
aT  
+
bT
+
cT、 、 −aT −bT −cT、 、 、
結束
同步旋轉座標軸
↓
三相座標軸
* 2 2
* 2 2
* 2 2
2 2
*
_ _ _ _ _ _ _
*
_ _ _ _ _ _ _
*
*
_ _ _ _ _ _ _
_ _ _ _
_
 for 
 for 
for 
e e e e
d abc q abc cmd d abc cmd q abc cmd m
e e e e
q abc q abc cmd d abc cmd q abc cmd m
e e e em
d abc abc cmd d abc cmd q abc cmd m
e e
d abc cmd q abc cmd
q abc
i i i i i
i i i i i
ii i i i i
i i
i
⎧ = + ≤⎪⎨⎪ = + ≤⎩
= + >
+
* 2 2
2 2
*
*
_ _ _ _ _ _
_ _ _ _
for e e e em q abc cmd d abc cmd q abc cmd m
e e
d abc cmd q abc cmd
i i i i i
i i
⎧⎪⎪⎪⎨⎪ = + >⎪ +⎪⎩
讀取A/D值
三相座標軸
↓
同步旋轉座標軸
unv vnv wnv
ai bi riui vi si
、 、
、 、 、 、 、
dcv、
模糊
並聯供電控制器
副程式開始
*
_
*
_
_ _ _ _
_ _ _ _
d abc
q abc
e e e
d abc cmd i f e q abc d uvw
e e e
q abc cmd i f e d abc q uvw
v u L i v
v u L i v
ω
ω
= − +
= + +
* 2 2
* 2 2
* 2 2
2 2
*
_ _ _ _ _ _ _ max
_ _ _ _ _ _ _ max
max
_ _ _ _ _ _
_ _ _ _
_
 for 
for 
for 
e e e e
d abc d abc cmd d abc cmd q abc cmd
e e e e
q abc q abc cmd d abc cmd q abc cmd
e e e e
d abc d abc cmd d abc cmd q abc cmd
e e
d abc cmd q abc cmd
e
q abc
v v v v v
v v v v v
vv v v v
v v
v
= +
= +
= +
+ _ max
v
≤
≤
>
2 2
2 2
max
_ _ _ _ _ _ max
_ _ _ _
for e e eq abc cmd d abc cmd q abc cmd
e e
d abc cmd q abc cmd
v v v v
v v
= +
+
v>
PWM信號輸出
空間向量脈波
寬度調變
+
aT  
+
bT
+
cT、 、 −aT −bT −cT、 、 、
結束
同步旋轉座標軸
↓
三相座標軸
*
*
_ _ _ _
_ _
_ _ _ _
_ _
e e e e
q uvw q uvw d uvw d uvwe
d abc cmd
ml
e e e e
d uvw q uvw q uvw d uvwe
q abc cmd
ml
v i v i
i
v
v i v i
i
v
+=
−= −
* 2 2
* 2 2
* 2 2
2 2
*
_ _ _ _ _ _ _
*
_ _ _ _ _ _ _
*
*
_ _ _ _ _ _ _
_ _ _ _
_
 for 
 
 for 
for 
e e e e
d abc q abc cmd d abc cmd q abc cmd m
e e e e
q abc q abc cmd d abc cmd q abc cmd m
e e e em
d abc abc cmd d abc cmd q abc cmd m
e e
d abc cmd q abc cmd
q abc
i i i i i
i i i i i
ii i i i
i i
i
⎧ = +⎪⎨⎪ = +⎩
= +
+
i
≤
≤
>
* 2 2
2 2
*
*
_ _ _ _ _ _
_ _ _ _
for e e e em q abc cmd d abc cmd q abc cmd m
e e
d abc cmd q abc cmd
i i i i
i i
⎧⎪⎪⎪⎨⎪ i= + >⎪ +⎪⎩
 
圖6.20 三相換流器並聯供電程式流程圖 
 133 
 ,un rv i
, ,un rv i
,un rv i
_Grid Symbol
 
圖6.21 (a)控制區域網路傳送流程圖; (b)控制區域網路接收流程圖 
6.4 實驗結果 
本研究之實驗結果包含直流轉換器與換流器及遠端監控三部分，玆分別說明
如下： 
6.4.1 直流轉換器實驗結果 
圖 6.22 表示初始負載為 300W，增加為 450W，然後再降低為 300W，且使用比
例積分控制之燃料電池獨立供電模式之輸出電壓 及輸入電流ov fci 響應圖，由圖中
 135 
 電池供電模式之輸出電壓 及輸入電流ov fci 響應圖，由圖中可看出蓄電池工作於充
電模式時， 下降為 333V，ov fci 電流欠阻尼式增加 9.0A，且 之回復時間約為 0.25
秒。 
ov
圖 6.29 表示初始負載為 450W，增加為負載 720W，其中包含蓄電池放電 270W，
然後降低為負載 450W，蓄電池停止放電，且使用滑動模式控制之燃料電池並聯蓄
電池供電模式之輸出電壓 及輸入電流ov fci 響應圖，由圖中可看出當負載瞬間增加
時， 下降為 333V，並立刻回復，ov fci 電流瞬間值約增加 7.0A。 
 
 
圖 6.22 使用比例積分控制之燃料電池獨立供電，初始負載為 300W，增加為 450W，
然後再降低為 300W 之響應波形圖：(a)直流鏈輸出電壓 o；(b)燃料電池輸入電流v fci  
 137 
  
圖 6.25 使用比例積分控制之燃料電池並聯蓄電池供電，初始負載為 450W，增加
為負載 720W，其中包含蓄電池放電 270W，然後降低為負載 450W，蓄電池停止放
電之響應波形圖：(a)直流鏈輸出電壓 ；(b)燃料電池輸入電流ov fci  
 
圖 6.26 使用滑動模式控制之燃料電池獨立供電，初始負載為 300W，增加為 450W，
然後再降低為 300W 之響應波形圖：(a)直流鏈輸出電壓 o；(b)燃料電池輸入電流v fci  
 139 
  
圖 6.29 使用滑動模式控制之燃料電池並聯蓄電池供電，初始負載為 450W，增加
為負載 720W，其中包含蓄電池放電 270W，然後降低為負載 450W，蓄電池停止放
電之響應波形圖：(a)直流鏈輸出電壓 ；(b)燃料電池輸入電流ov fci  
6.4.2 換流器實驗結果 
圖6.30為三相換流器效率與輸出功率關係曲線，其基值功率為866W時，由圖
可知此換流器於輕載下的功率轉換效率較低，而在接近滿載時功率轉換效率較
高，適合應用於功率需求較大的場合，可得到約90%的轉換效率。  
圖6.31為三相平衡負載520W，使用比例積分控制器操作於獨立運轉模式下，
量測三相換流器變壓器負載側的輸出線電壓之穩態波形與其諧波失真率頻譜，可
以看出輸出之線電壓有效值約為220V，各差120°電氣角，電壓總諧波失真率為
2.33%，符合IEEE Std. 519之規範。 
圖6.32為三相平衡負載520W，使用 77 × 查詢表之模糊邏輯控制器操作於獨立
運轉模式下，量測三相換流器變壓器負載側的輸出線電壓之穩態波形與其諧波失
真率頻譜，可以看出輸出之線電壓有效值約為212V，各差120°電氣角，電壓總諧波
失真率為2.45%，符合IEEE Std. 519之規範。 
 141 
 圖6.40為獨立運轉模式下，使用比例積分控制器控制三相換流器，三相平衡負
載由866W減少至174W時，電壓、電流及均方根值之暫態波形。可以看出使用比例
積分控制器可穩定輸出電壓，電壓均方根值有小幅過衝量然後穩定電流均方根值
由約2.4A下降為約0.6A。 
圖6.41為獨立運轉模式下，使用 77 × 查詢表之模糊邏輯控制器控制三相換流
器，三相平衡負載由866W減少至174W時，電壓、電流及均方根值之暫態波形。可
以看出使用 查詢表之模糊邏輯控制器可穩定輸出電壓，電壓均方根值僅微幅
升高，隨即穩定，電流均方根值由約2.4A下降為約0.6A。 
77 ×
圖6.42為獨立運轉模式下，使用 1313× 查詢表之模糊邏輯控制器控制三相換流
器，三相平衡負載由866W減少至174W時，電壓、電流及均方根值之暫態波形。可
以看出使用 查詢表之模糊邏輯控制器可穩定輸出電壓，電壓均方根值僅微
幅升高，隨即穩定，電流均方根值由約2.4A下降為約0.6A。 
1313×
圖6.43為市電並聯模式下，使用比例積分控制器控制三相換流器，提供實功率
約255W及虛功率約-221VAR至電力網路時，變壓器負載側輸出電壓、電流之穩態
波形。可以看出線電壓有效值約為226V，相電壓峰值約為184V，相電流峰值約為
1.25A，功率因數約為0.754；其中相電壓落後線電壓約30度，相電流落後相電壓約
41度。 
圖6.44為市電並聯模式下，使用 77 × 查詢表之模糊邏輯控制器控制三相換流
器，提供實功率約360W至電力網路時，變壓器負載側輸出電壓、電流之穩態波形。
可以看出線電壓壓有效值約為216V，相電壓峰值約為180V，相電流峰值約為1.35A。 
圖6.45為獨立運轉模式下，DSP#1將回授之變壓器負載側輸出電壓 、電流
值經由控制區域網路，傳送至DSP#2，並配合DSP軟體顯示其波形。由圖6.45(a)知，
此時DSP#1市電並聯旗標訊號(Grid_Symbol)為0，代表尚未接收到DSP#2之並聯命
令，即系統為獨立運轉模式，並將獨立運轉模式下之電壓 、電流 值傳送至
DSP#2。圖6.45(b)顯示DSP#2接收之獨立運轉模式電壓 、電流 值。 
unv ri
unv ri
unv ri
圖6.46為DSP#1接收到由DSP#2下達之市電並聯命令(keyboard=1)，此時系統將
 143 
 (100 / )stv V div
0
(10 / )ms div( )b
(100 / )rsv V div
0
(10 / )ms div( )a
(100 / )trv V div
0
(10 / )ms div( )c
0
20
40
60
80
100
0 5 10 15 20 25 30
Mag (% of Fundamental)
Harmonic orderFundamental (60Hz) = 326.5 , THD= 2.33%
( )d  
圖6.31 三相平衡負載為520W時，使用比例積分控制器操作於獨立運轉模式下，三
相換流器輸出電壓變壓器負載側之穩態波形：(a)r與s相輸出線電壓 ；(b) s與t相
輸出線電壓
rsv
stv ；(c) t與r相輸出線電壓 ；(d)波形(a)之電壓諧波失真率頻譜。 trv
 
 145 
 (100 / )stv V div
0
(10 / )ms div( )b
(100 / )rsv V div
0
(10 / )ms div( )a
(100 / )trv V div
0
(10 / )ms div( )c
( )d  
圖6.33 三相平衡負載為520W時，使用 1313× 查詢表之模糊邏輯控制器操作於獨立
運轉模式下，三相換流器輸出電壓變壓器負載側之穩態波形：(a)r與s相輸出線電壓
；(b) s與t相輸出線電壓rsv stv ；(c) t與r相輸出線電壓 ；(d)波形(a)之電壓諧波失真
率頻譜。 
trv
 147 
 (50 / )rnv V div
0
(10 / )ms div( )a
(0.5 / )ri A div
0
(10 / )ms div( )b
 
(50 / )dcv V div
0
(10 / )ms div( )c
 
圖6.35 三相平衡負載為520W時，使用 77 × 查詢表之模糊邏輯控制器操作於獨立運
轉模式下，三相換流器變壓器負載側輸出電壓、電流之穩態波形：(a) r相輸出相電
壓 ；(b) r相輸出相電流 ；(c) 直流鏈電壓 。 rnv ri dcv
 149 
 (100 / )rnv V div
0
(20 / )ms div( )a
(1 / )ri A div
0
(20 / )ms div( )b
_rn rmsv
_r rmsi
 
圖6.37 三相平衡負載由174W增加至866W時，系統操作於獨立運轉模式下，使用比
例積分控制器控制三相換流器，變壓器負載側輸出電壓、電流及其均方根值之暫
態波形：(a)r相電壓及均方根值變化量 ；(b) r相電流及均方根值變化量 。 rnv ri
 151 
 (50 / )rnv V div
0
(20 / )ms div( )a
(1 / )ri A div
0
(20 / )ms div( )b
_rn rmsv
_r rmsi
 
圖6.39 三相平衡負載由174W增加至866W時，系統操作於獨立運轉模式下，使用
查詢表之模糊邏輯控制器控制三相換流器，變壓器負載側輸出電壓、電流
及其均方根值之暫態波形：(a)r相電壓及均方根值變化量 ；(b) r相電流及均方根
值變化量 。 
1313×
rnv
ri
 
 
 
 
 
 
 153 
 (100 / )rnv V div
0
(20 / )ms div( )a
(1 / )ri A div
0
(20 / )ms div( )b
_rn rmsv
_r rmsi
 
圖6.41 三相平衡負載由866W減少至174W時，系統操作於獨立運轉模式下，使用
查詢表之模糊邏輯控制器控制三相換流器，變壓器負載側輸出電壓、電流及
其均方根值之暫態波形：(a)r相電壓及均方根值變化量 ；(b) r相電流及均方根值
變化量 。 
77 ×
rnv
ri
 155 
  
(100 / )rsv V div
0
(10 / )ms div( )a
(50 / )rnv V div
0
(10 / )ms div( )b
(50 / )rnv V div
0
(10 / )ms div( )c
(0.5 / )ri A div
rnv
ri
 
圖6.43 系統操作於市電並聯模式下，使用比例積分控制器控制三相換流器，提供
實功率約255W及虛功約-221VAR至電力網路時，變壓器負載側輸出電壓、電流之
穩態波形：(a) r相與s相輸出線電壓 ；(b) r相輸出相電壓 ；(c) 相電流 落後相
電壓 。
rsv rnv ri
rnv
 
 
 157 
 #1DSP
#2DSPriunv
 
( )ri A
( )unv V
(b)
( )time s
 
圖6.45 DSP#1與DSP#2透過控制區域網路之傳送與接收情形：(a)系統(DSP#1)為獨立
運轉模式，並傳送電壓 、電流 r；(b) 於DSP#2由DSP軟體顯示獨立運轉模式之unv i 電
壓 、電流 。 unv ri
 
 
 159 
 6.4.3 遠端監控實驗結果 
在本實驗中，我們先將燃料電池發電系統的燃料電池、直流轉換器和換流器
的電壓及電流等資料經由DSP端的CAN Module每隔10秒傳送到CAN匯流排上，在
CAN匯流排上另一節點的DSP再從CAN匯流排上依據事先所設定的ID接收資料，接
收完成後，再經由DSP的SCI串列埠介面將燃料電池發電系統的燃料電池、直流轉
換器和換流器的電壓及電流等資料傳送到無線通訊模板1(GSM1)，無線通訊模板
1(GSM1)收到資料後，即傳送到遠端的無線通訊模板2(GSM2)，最後，遠端的監控
電腦經由圖控軟體LabVIEW將無線通訊模板2(GSM2)所接收的燃料電池發電系統
的燃料電池、直流轉換器和換流器的電壓及電流等資料顯示出來。實驗結果如圖
6.47無線監控燃料電池發電系統實驗結果主頁面圖與圖6.48無線監控燃料電池發
電系統實驗結果波形圖所示： 
 
圖 6.47 無線監控燃料電池發電系統實驗結果主頁面圖 
 
 161 
 壓 回復時間為0.3秒，顯示滑動模式控制之效果優於比例積分控制。另外，由圖
6.23與圖6.27之比較亦有相似之結果，故可證實當負載改變影響燃料電池輸入電壓
時，使用滑動模式控制會使直流鏈電壓具有較快速的響應及強健性。 
ov
在燃料電池並聯蓄電池供電模式方面，由圖6.24與圖6.28之比較可知：使用比
例積分控制之直流鏈輸出電壓 回復時間為2.0秒，使用滑動模式控制之直流鏈輸
出電壓 回復時間為2.0秒，惟使用滑動模式控制之燃料電池輸入電流
ov
ov fci 增加幅度
大於使用比例積分控制之燃料電池輸入電流 fci 增加幅度，另外，由圖6.24與圖6.28
之比較亦有相似之結果，故可考慮使用適應型滑動模式控制以減小燃料電池輸入
電流 fci 之增加幅度。 
由圖6.37、圖6.38與圖6.39之比較可知：使用 1313× 查詢表之模糊邏輯控制器
之電壓均方根值下降約3V，而使用比例積分控制器之電壓均方根值下降約8V，且
回復時間較長；另外，使用模糊邏輯控制器之電流均方根值到達穩態時間較短，
且不像使用比例積分控制器有較大的過衝量；使用 1313× 查詢表之模糊邏輯控制
器可較快輸出功率至866W，且無過衝量，使用比例積分控制器之響應略慢，且因
輸出電壓不夠穩定，導致在同一電阻負載下，輸出較多功率，穩定時間較長。 
由圖6.40、圖6.41與圖6.42之比較可知：使用模糊邏輯控制器之電壓均方根值
較快回到命令值，使用比例積分控制器的電壓均方根值有相當大的過衝量，且回
復時間較長；另外，使用 查詢表之模糊邏輯控制器電流均方根值到達穩態之
時間比使用比例積分控制器為小；使用模糊邏輯控制器之輸出功率控制較佳，且
無過衝量；而使用比例積分PI控制器之響應，由於電壓、電流控制較不精確，導致
在同一電阻負載下，功率控制較差，穩定時間較長。 
77 ×
在系統整合後，為了達成即時無線監控燃料電池發電系統，太過頻繁且時間
間隔太短的簡訊傳送，會造成傳送端的無線通訊模板之上一筆簡訊尚未完全傳送
就被下一筆簡訊資料覆蓋，而導致傳送錯誤，因此本研究延遲從CAN匯流排上擷
取資料的時間，使DSP的SCI傳輸介面能完全將燃料電池發電系統的燃料電池、直
流轉換器和換流器的電壓及電流等資料傳送到無線通訊模板後，且讓無線通訊模
 163 
 第九章  結論與建議 
7.1 結論 
本研究首先研製一燃料電池發電系統之直流功率轉換器，係將燃料電池之低
壓輸出昇壓為高壓直流輸出電壓，此系統需具備功率補償的能力，故使用蓄電池
作為燃料電池發電系統之功率調節使用。若負載變動時，燃料電池發電系統須具
備快速響應的能力，本系統使用全橋式直流功率轉換器作為燃料電池的功率轉換
器，並使用昇壓/降壓直流截波器作為蓄電池充放電的轉換器。本研究使用滑動
模式控制器作為燃料電池發電系統之定電壓控制器，並使用數位信號處理器 
TMS320F2812 作為控制核心，其控制策略皆由 C 語言程式完成，降低系統硬體
複雜度。 
實驗結果顯示，本研究之全橋式功率轉換器與昇壓/降壓直流截波器並聯供
電時，輸出電壓可達 340V 以上，同時，當燃料電池之輸出電壓因負載而改變時，
本研究所提出之滑動模式控制器能使直流鏈電壓具有較快速的響應及強健性。 
另外，在換流器方面，本研究研製一基於模糊邏輯控制之三相換流器，亦以
數位信號處理器 TMS320F2812 為整體系統之控制核心，其輸出功率可達 866W，
並應用於燃料電池發電系統；分別以比例-積分控制器與模糊邏輯控制器計算出
電壓命令後，經由電壓空間向量脈寬調變技術計算出各臂開關的責任週期(duty 
cycle)，控制三相換流器於獨立運轉時輸出三相線電壓有效值為 220V，頻率為
60Hz 的交流電，三相換流器之運轉效率最高可達 91%，而輸出線電壓之總諧波
失真率為 2.45%，符合 IEEE Std. 519 之規範；並且應用控制區域網路以遠端來達
成獨立運轉與市電並聯運轉模式之切換，同時監測系統之電壓、電流值；並聯運
轉模式下，可提供實功率及虛功率至電力網路。 
經實測結果，以C語言撰寫程式，分別應用 7 7× 查詢表與13 查詢表之模
糊邏輯控制器於三相換流器獨立運轉下，每次由類比/數位轉換開始到計算出開
關切換狀態的時間約分別為86.4
13×
sμ 、87.7 sμ ，而PI控制器所需時間約為 67.7 sμ ；
在市電並聯下，模糊邏輯控制器所需時間為 68 sμ ，而PI控制器所需時間約為
 165
 轉換效率。 
由於電力網路上之負載並非全然平衡及線性，三相三臂式換流器由於其先
天限制，無法控制中性點，對於三相不平衡負載及三相非線性負載力有未逮，
因此建議使用其他種類之三相功率轉換器，如三相四臂式換流器等。 
另外，本研究採用的 GSM 無線通訊模板中央處理模組是以 RS-232 介面存
取控制 GSM 通訊模組來傳送與接收資料，為了達成即時無線監控燃料電池發
電系統，必須不斷的從 CAN 匯流排上擷取燃料電池、直流轉換器和換流器的
電壓及電流等資料與更新，但因 DSP 的 SCI 傳輸介面速率較低，故必須延遲
從 CAN 匯流排上擷取資料的時間，使得 DSP 的 SCI 傳輸介面能完全將燃料電
池、直流轉換器和換流器的電壓及電流等資料傳送到無線通訊模板上，且讓無
線通訊模板有足夠的處理時間將燃料電池、直流轉換器和換流器的電壓及電流
等資料以簡訊的型態傳送出去，才不會造成上一筆簡訊還沒完全傳送出去，就
被下一筆的簡訊資料覆蓋，建議使用非 RS-232 介面存取控制的 GSM 通訊模組
或採用傳輸速率更快的 GSM 通訊模組存取控制介面以改善此問題。 
 
 167
 Automation Approach”, IEEE Trans. on Industrial Electronics, Vol. 51, No. 5, pp. 
1103-1112, 2004.  
[12] W. Choi, P. N. Enjeti  and  J. W. Howze, “Development of an equivalent circuit 
model of a fuel cell to evaluate the effects of inverter ripple current”, IEEE 19th 
APEC, Vol. 1, pp. 355-361, 2004. 
[13] W. Friede, S. Rael and B. Davat, “Mathematical model and characterization of the 
transient behavior of a PEM fuel cell”, IEEE Trans. on Power Electronics, Vol. 19, 
No. 5, pp. 1234-1241, 2004. 
[14] P. T. Krein, R. S. Balog  and  X. Geng, “High-frequency link inverter for fuel 
cells based on multiple-carrier PWM”, IEEE Trans. on Power Electronics, Vol. 19, 
No 5, pp. 1279-1288, 2004. 
[15] H. Li  and  F. Z. Peng, “Modeling of a new ZVS bi-directional dc-dc converter”, 
IEEE Trans. on Aerospace and Electronic Systems, Vol. 40, No. 1, pp. 272-283, 
2004. 
[16] X. Huang,  X. Wang, T. Nergaard, J. Lai, X. Xu  and  L. Zhu, “Parasitic ringing 
and design issues of digitally controlled high power interleaved boost converters”, 
IEEE Trans. on Power Electronics, Vol.19, No. 5, pp. 1341-1352, 2004. 
[17] H. Bodur  and  A. F. Bakan, “ A new ZVT-ZCT-PWM DC-DC converter”,  
IEEE Trans. on Power Electronics, Vol.19, No. 3, pp. 676-684, 2004. 
[18] K. W. E. Cheng, D. Sutanto, Y. L. Ho  and  K. K. Law, “Exploring the Power 
Conditioning System for Fuel Cell”, IEEE 32nd PESC, Vol. 4, pp. 2197-2202, 
2001.       
[19] M. C. Caponet, F. Profumo  and  A. Tenconi, “Cost effective saturable inductor 
for zero voltage switching-zero current switching DC/DC power conditioning 
converter for fuel cells”, 38th IAS Annual Meeting, Vol. 3, pp. 1576-1581, 2003. 
[20] J. M. Correa, E. D. Hutto, F. A. Farret and M. G. Simoes, “A fuzzy- controlled 
pulse density modulation strategy for a series resonant inverter with wide load 
range”, IEEE 34th PESC, Vol. 4, pp. 1650-1655, 2003.    
[21] R. Gopinath, S. Kim, J. Hahn, P. N. Enjeti, M. B. Yeary  and  J. W. Howze, 
“Development of a low cost fuel cell inverter system with DSP control”, IEEE 
Trans. on Power Electronics, Vol. 19, No. 5, pp. 1256-1262, 2004. 
 169
 [35] 沈金鐘，“PID 控制器：理論、調整與實現”，滄海書局，2001。 
[36] C. L. Philips, and H. T. Nagle, Digital control system analysis and design, 
Prentice-Hall, 1995. 
[37] G. F. Franklin, J. D. Powell, and M. Workman, “Digital Control of Dynamic 
Systems”, Third Edition, 1997. 
[38] 陳永平、張浚林，“可變結構控制設計”，全華出版社，2002。 
[39] R. A. Decarlo, S. H. Zak, and G. P. Matthews, “Variable structure control of 
nonlinear multivariable system: A tutorial”, Proceedings of the IEEE, Vol.76, 
pp.212-232, 1988. 
[40] J. Y. Hung, W. Gao and J. C. Hung, “Variable structure control: A survey”, IEEE 
Trans. on Industrial Electronics, Vol.40, pp.2-22, 1993. 
[41] V. I. Utkin, Sliding Modes and their Application in Variable Structure System. 
Moscow: Mir Publishers (English translation), 1978. 
[42] E. Baily and A. Arapostathis, “Simple sliding mode control scheme applied to 
robot manipulator”, Int. J. Control, Vol.45, pp.1197-1209, 1987. 
[43] L. G. Shiau and J. L. Lin, “Direct and Indirect SMC Control Schemes for DC-DC 
Switching Converters”, SICE, pp.1289-1294, 1997. 
[44] T. L. Chern and Y. C. Wu, ”Design of integral variable structure controller and 
application to electrohydraulic velocity servo systems”, IEE proc. D, Control 
Theory and Appl., Vol. 138, NO.5,  pp.439-444, 1991. 
[45] J. G. Kassakian, M. F. Schlecht, and G. C. Verghese, “Principle of Power 
Electronics”, Addison-Wesley publishing company, 1991. 
[46] 張鴻鈞，“不平衡負載之三相不斷電系統研製”， 國立台灣科技大學電機工程
研究所碩士論文，2002。 
[47] 楊久孟，“具虛功率補償功能之三相並聯型不斷電系統之研製”， 國立台灣科
技大學電機工程研究所碩士論文，2005。 
[48] Z. Yu, “Space-Vector PWM With TMS320C24x/F24x Using Hardware and 
Software Determined Switching Patterns,” Texas Instruments, 1999. 
[49] 劉昌煥，“交流電機控制”，東華書局，2003。 
 171
 [66] 徐豪聲，“以 Database 發展之智慧型 Gateway 達成遠端 CAN-Base 輪椅車監控
系統”，交通大學碩士論文，2003。 
[67] 路非遙、許晉睿、鍾崇海、黃繼震、張欽宗、金麟聖，“應用 NI-PXI 建構台
灣輕軌車即時行控系統”，中山科學研究院飛彈火箭研究所，2005。 
[68] J. Rufino, “An Overview of the Controller Area Network”, In Proceedings of the 
CiA Forum CAN for Newcomers, January 1997. 
[69] ISO. Road Vehicles - Controller Area Network (CAN) - part4: Time Triggered 
Communication, 2001. 
[70] A. Oliveira, P. Fonseca, V. Sklyarov and A. Ferrari, “Anobject- Oriented 
Framework for CAN Protocol Modeling and Simulation,” In FET2003: 5th IFAC 
International Conferenceon Fieldbus Systems and their Applications, pp. 243–248, 
July 2003. 
[71] F. Hartwich and A. Bassemir, “The Configuration of the CAN Bit Timing”, 6th 
International CAN Conference, November 1999. 
[72] J. Ferreira, A. Oliveira and P. Fonseca, “An Experiment to Assess Bit Error Rate in 
CAN”, Proceedings of the 2004 International Workshop on Real-Time Networks, 
Vol. 1, pp. 15-18, July 2004. 
[73] Y. A. Abdulla, H. EI-Hennawy and S. Mahrous, “The Effect of Base Stations 
Configurations on the Accuracy of Hyperbolic Position Location in Macrocellular 
and Microcellular GSM Systems,” Proceedings of the Eighteenth National Radio 
Science Conference, Vol. 1, pp. 303-313, 2001. 
[74] R. S. H. Istepanian, “Modeling of GSM-Based Mobile Telemedical System,” 
Proceedings of the 20th International Conference of the IEEE Engineering in 
Medicine and Biology Society, Vol. 20, pp. 1166-1169, 1998. 
[75] C. Drane, M. Macnaughtan and C. Scott, “Positioning GSM Telephone,” IEEE 
Communications Magazine, Vol. 36, pp. 46-54, 1998. 
[76] Nexa User‘s Manual, 2003. 
[77] “Application Report: Interfacing the ADS8364 to the TMS320F2812 DSP, 
SLAA163[R]”. Texas Instruments Inc., Dec. 2002. 
[78] 蘇奎峰、呂強、耿慶鋒、陳聖儉，“TMS320F2812 原理與開發”，電子工業出
版社，2005。 
 173
   計畫成果自評 
 
本計畫完成之項目如下：本計畫首先研製一燃料電池發電系統之直流功率轉換
器，係將燃料電池之低壓輸出昇壓為高壓直流輸出電壓，此系統需具備功率補償的能
力，故使用蓄電池作為燃料電池發電系統之功率調節使用。本系統使用全橋式直流功
率轉換器作為燃料電池的功率轉換器，並使用昇壓/降壓直流截波器作為蓄電池充放電
的轉換器。本計畫使用滑動模式控制器作為燃料電池發電系統之定電壓控制器，並使
用數位信號處理器TMS320F2812作為控制核心，其控制策略皆由C語言程式完成，降
低系統硬體複雜度。經由實驗結果顯示，當燃料電池之輸出電壓因負載而改變時，本
計畫所提出之滑動模式控制器能使直流鏈電壓具有較快速的響應及強健性。 
另外，在換流器方面，本計畫研製一基於模糊邏輯控制之三相換流器，亦以數位
信號處理器TMS320F2812為整體系統之控制核心，分別使用比例-積分控制器與模糊邏
輯控制器計算出電壓命令後，經由電壓空間向量脈寬調變技術計算出各臂開關的責任
週期(duty cycle)，控制三相換流器於獨立運轉時輸出三相線電壓有效值為220V、頻率
為60Hz的交流電，三相換流器之運轉效率最高可達91%，而輸出線電壓之總諧波失真
率為2.45%，符合IEEE Std. 519之規範；並且應用控制區域網路以遠端來達成獨立運轉
與市電並聯運轉模式之切換，同時監測系統之電壓、電流值；並聯運轉模式下，可提
供實功率及虛功率至電力網路。應用模糊邏輯控制之三相換流器在負載改變時，能有
效控制電壓、電流，具有較快速的動態響應。收斂速度不但較使用比例-積分控制器之
換流器快，且因無過衝量，功率輸出穩定較穩定；穩態時，其穩態誤差也較使用比例-
積分控制器之三相功率轉換器小，更適用於分散式發電系統。實驗結果驗證本計畫之
理論分析及控制法則的可行性。 
在遠端監控方面，本計畫研製一套以CAN為基礎的無線監控燃料電池發電系統。
運用CAN所具有之穩定性、即時性、具除錯性以及可整合性等優點，將燃料電池發電
系統的所有資訊正確無誤的傳送到CAN匯流排上，並且結合無線通訊技術與應用
LabVIEW虛擬儀器技術，建立遠端無線監控燃料電池發電系統，驗證了無線通訊技術
結合控制區域網路CAN的可行性。 
再者，由於本計畫研製之燃料電池發電系統控制核心為全數位化結構，不但具有
體積較小、成本較低之特性，而且具有穩定性較高、擴充性較易之性能；因此，依據
 175
 可供推廣之研發成果資料表 
□ 可申請專利  ■ 可技術移轉                          日期：97年7月30日 
國科會補助計畫 
計畫名稱：以數位信號處理器為基礎之燃料電池發電系統之研製
(3/3) 
計畫主持人：王文智         
計畫編號：NSC96-2221-E-434-009   學門領域：電力學門 
技術/創作名稱 基於數位信號處理器之燃料電池發電系統模糊控制技術 
發明人/創作人 王文智 
中文： 
本技術包含兩部分，一為以數位信號處理器為基礎所建構之數位化
燃料電池發電系統控制平台，另一為基於模糊邏輯控制法之燃料電
池輸出功率控制法則，不但可使燃料電池發電系統具有較高之強健
性，而且由於燃料電池發電系統之控制核心為數位化結構，因此具
有穩定性較高、擴充性較易之性能。 
 
技術說明 英文： 
The technique is composed of two parts, one is the DSP-based 
controller, the other is the fuzzy logic control algorithm of the output 
power of the fuel cell generation system. The robustness of the fuel cell 
generation system can be achieved. The fully digital structure of the 
control core of the fuel cell generation system has the benefit of high 
stability and easy expansion. 
可利用之產業 
及 
可開發之產品 
1. 再生能源產業 
2. 數位控制器 
技術特點 
1. 全數位化控制器結構，可提高系統之可程式化能力及穩定性。
2. 基於模糊邏輯控制法之燃料電池輸出功率控制法則，具有可使
燃料電池之輸出功率比較平穩之特性。   
3. 使用 C 語言發展控制程式，具有較佳之移植性。 
 
推廣及運用的價
值 全數位化、小型化、低成本。 
※ 1.每項研發成果請填寫一式二份，一份隨成果報告送繳本會，一份送 貴單位研發
成果推廣單位（如技術移轉中心）。 
※ 2.本項研發成果若尚未申請專利，請勿揭露可申請專利之主要內容。 
※ 3.本表若不敷使用，請自行影印使用。 
 177
