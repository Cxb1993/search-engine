  
目錄 
 
目錄 ............................................................................................................................................................... i 
一、 摘要 ............................................................................................................................................... 1 
二、 緣由與目的 ................................................................................................................................... 1 
三、 研究方法與成果 ........................................................................................................................... 2 
1、 自組態感測網路(Zigbee/802.15.4)優化與規劃方法 .............................................................. 2 
1.1. 相關研究與演算法 ....................................................................................................... 3 
1.2. 模擬結果 ....................................................................................................................... 7 
2、 ECG quality-aware adaptive ECG sample-rate control 節能演算法.................................. 9 
2.1. 繞路協定 ....................................................................................................................... 9 
2.2. 節能演算法 ................................................................................................................. 12 
2.3. 模擬結果 ..................................................................................................................... 16 
3、 軟硬體架構的設計與實現 ..................................................................................................... 17 
3.1. 即時定位 .................................................................................................................... 17 
3.2. 硬體相關 .................................................................................................................... 31 
3.3. 健康監護系統 ............................................................................................................ 37 
四、 成果自評 ..................................................................................................................................... 39 
五、 參考文獻 ..................................................................................................................................... 39 
  
二、 緣由與目的 
 為了能夠減少安養階段的人物力負擔，並進一步提供居家服務，此研究希望結合主動建議
系統、環境舒適控制、層級式救急呼叫來建構互動式智慧型健康監護系統（Smart Healthcare 
surveillance），透過無線感測網路（Wireless Sensor Network）來建置出一可隨時隨地監控與檢
測病人之心電訊號系統，並提供必要之協助與救急服務，以期造福更多老人、行動不便人士，
提升人類生活品質。 
 
 我們以 Zigbee 自組態 mesh 感測網路環境作為 ECG 訊號傳輸的骨幹網路，建立一個長時
間(long‐term)、及時(real‐time)且可靠(Reliable)的家庭或是室內療養伺服器，由於 ECG 訊號標
準格式的取樣頻率為(360 samples/sec)，由圖表 1 我們可以得知辨識出疾病至少需要 5.76kbps
的頻寬，大量的 ECG 資料傳輸下對於能力有限的感測(Zigbee)網路頻寬(250kbps)佔用情形將相
當嚴重，其隱含著網路擁塞(congestion)及熱點(hot spot)的問題。另外，Zigbee 裝置每個節點的
耗電量會因為路由路徑的不同，導致網路環境中每個裝置的剩餘電量會有所差異，如何讓網路
可以有最大的存活時間也是我們面臨到的問題，為克服上述的兩項難題，建置一個長時間(long
‐term)、及時(real‐time)且可靠(Reliable) Zigbee 自組態 mesh 感測網路環境必頇要有完善的事前
規劃。 
解析度(bit) 取樣速率(1/s) 傳輸位元速率(bit/s) 
 
 
16 
200 3200 
300 4800 
360 5760 
400 5600 
500 8000 
圖表 1、zigbee 取樣速率與其傳輸頻寬 
 
因此本計畫第一年的研究目標著重於 
(1).自組態感測網路(Zigbee/802.15.4) 容錯、優化與規劃方法：此研究訴求的目的在於找出感測網
路中最少可用的感測節點來達到全覆蓋及最佳化繞路的環境佈建，這樣的事前規畫不僅可減少感測
點的傳輸以減少能量的損耗還能提升網路效能，因為減少不必要的傳輸可以增加網路頻寬以便提升
感測網路利用率。由於同時考慮全覆蓋及最佳化繞路是 NP complete 的問題[2][3][4]，所以我們採
用基因規劃法找出以能量為考量的最佳路徑來傳輸資料，以減少能量在傳輸過程中消耗能量，分別
最小成本全覆蓋和最佳化路由來延長網路存活時間，規劃出可靠和有效率傳輸的全覆蓋且最佳化繞
路的 Zigbee 自組態感測網路。 
(2).ECG quality-aware adaptive ECG sample-rate control 節能演算法 ：我們實驗出五種方法來分析比
較各種訊號處理演算法的特性和優缺點並分析訊號處理演算法對壓縮 ECG 訊號的可行性，分別有
時間抑制技術 TEEN[17]、向量量化技術(vector quantization technique)VQ[18][19]、叢集式繞路協定 
(Cluster-based Routing Protocol)LEACH[21]、碼簿編碼 ALVQ[21]、預測模型 ARIMA[22]。 
(3).Zigbee 自組態 mesh 感測網路軟硬體架構設計與實現(含救急處理服務、HRV/ECG 致能環境舒
  
等優點來找出問題的整體最佳解。 
下面是將相關的方法整理成表格，在下表中我們可以看到，在解決網路存活問題都只考慮到一
半。 
方法 Full-Coverage Routing 
MLDA[5] × ○ 
PEDAP[6] × ○ 
Greedy 
Algorithm[7] 
× ○ 
GA[8][9] × ○ 
Greedy 
Algorithm[3] 
○ × 
NSGA-II[4] ○ × 
GA[10][11] ○ × 
圖表 2、相關論文整理表格 
 由上面的方法中我們可以發現這些方法都只考慮到一半的狀況，在實際情況中最小成本全
覆蓋與路由路徑其實都是影響網路存活時間的關鍵因素，因此這兩者是必頇一起考慮，這樣才
可以真正的改善整體網路的存活時間，因此我們所要提出的作法是將最小成本全覆蓋與最佳路
由路徑兩個問題一起考慮，並找出整體的最佳解。由於此兩個問題分別都是屬於 NP 問題，當
我們又要將兩個問題一起解決時又會提高它的困難度與挑戰性。 
這次的貢獻與挑戰就是利用演化式演算法，將兩個分別都是屬於 NP 的問題利用演化式演算法
一起來解決。並且針對兩種問題來運用不同的演化式演算法，在全覆蓋的問題上運用基因演算
法，而全覆蓋的問題是以二進制的型態來表示，主要是因為基因演算法是運用於二進制、實數
或整數的問題上；在路由問題上是使用基因規劃法，路由問題為一個樹狀結構，另外路由的路
徑會隨著不同回合有不同的樹狀結構，而基因規劃法是運用於樹狀結構的問題上，並且結構也
可以隨著改變因此在路由問題上是最適合使用基因規劃法。效能部份我們分別最小成本全覆蓋
和最佳化路由來比較網路存活時間，結果顯示我們的方法明顯的延長了網路的存活時間，並且
也平均分散了感測點的附載。 
1.1. 相關研究與演算法 
  
就會停止演化，一般設定的條件都是以“代”為單位，而整個演化到最後每個染色體都會變成一
樣，當出現此狀況時表示已經到達收斂的情況，演化代數也是以此情況當成設定的參考。 
 
圖表 3 、演化流程圖 
基因演算法運用在全覆蓋問題 
在最小成本全覆蓋的問題中主要是關於感測點的開關問題，我們可以將此問題以 1(開)、
0(關)，二進制的方法來表示，在解決二進制的問題就是基因演算法。在此問題中主要是利用基
因演算法來找出網路環境中，最少需要多少個感測點來涵蓋整個網路環境。而函式設計考慮的
內容包含每個染色體涵蓋率、感測點開啟的個數、剩餘能量最少的感測點能量和此染色體可以
走回 BS 的機率。因此當感測點可以以開最少的感測點來涵蓋全部，那就可以減少能量的耗損。 
基因規劃法運用在路由路徑 
最佳化路由部分要解決的是找出環境中走回 Base Station 消耗能量最少的路徑，因此影響路
經的主要關鍵是每個感測點上的剩餘能量值，建立出一條整體消耗最少能量的路徑。在路由路
徑在結構上為一樹狀結構，並且路徑樹會隨著不同情況而有不同的連接方式，因此長度會隨著
改變。基因規劃法就是將原來基因演算法固定長度的字串，擴充成可以變動大小和形狀的樹，
所以基因規劃法適合用來解決路由結構的問題。在路由函式設計中，考慮的內容為能量的標準
差和每個感測點的負載量，由這兩個來決定路由的最佳路徑。主要原因是因為在初始路由時以
最短路徑來路由為最佳，但是當感測點的能量越來越少時，使用最短路徑就會讓那些感測點快
 
  
每個node可走回BS的機率，接著再計算最大存活的Routing路徑，整個結合就是將族群的
Full-Coverage和Routing同時考慮進來，接著也是一樣一直演化到終止條件，然後輸出族群中
染色體的fitness值最大的Tree，這一棵Tree就是Minimum Cost and Maximum LifeTime Routing 
Tree。 
③. Fitness的設計主要分為兩部分，第一部分就是GA，主要解決Full-Coverage的問題，並且要
考慮每一個node開的個數是最少的，另外還需考慮每個node的能量和每個node都是可以走回
BS，所以將這幾個考慮因素轉換成Fitness來計算每個染色體的適應度。第二部分GP，主要
是解決Maximum Routing的問題，設計GP的Fitness Function可分為兩個，一個是Tree中每個
node的剩餘energy的差異稱為標準差；另一個就是node需要幫幾個node轉傳資料，在這裡稱
為node的 loading量。因此將這兩組的Fitness值進行合併就可以找出Minimum Cost and 
Maximum LifeTime Routing Tree。 
 
1.2. 模擬結果 
 實驗模擬環境是在一個 10x10 的地圖，且又區分成有 node 沒有能量和無法全覆蓋兩個情
況。地圖中模擬的感測點個數分別為 10、15、20、25 和 30 個，感測範圍為 5 公尺通訊範圍為
感測範圍兩倍(10 公尺)，感測點資料傳輸以 802.15.4 的最大資料量 127Byte(包函封包資訊與資
料)[16]。每傳輸 1000 回合會從新調整感測點的開關狀態。另外也與最佳化路由[8][9]及最小成
本全覆蓋的方法[10][11]比較 Sensor 數目 (dense or sparse) 對 Network LifeTime 的影響。 
 下面的圖形主要是說明在 10x10 的地圖上 node 數目增加，可以發現 LifeTime 也會隨著延
長，藍色的線是我們所提出的方法，另外三個分別為最小成本得全覆蓋並使用最短路徑來路由
(三角形)、感測點全部開啟加上最佳化路由(正方形)，以及將簡介所介紹的解決兩種問題的最佳
解法合併(打叉)。 
  
的情況下也是一樣，因此可以發現我們所提出的方法有效的改善了網路的存活時間。 
 
2、 ECG quality-aware adaptive ECG sample-rate control 節能演算法 
 由於無線感測節點大多是以電池供電，在有能量限制的條件下，對於緊急安全或需要高可
靠性的無線感測網路(wireless sensor networks, WSNs)應用而言(例如：生理感測、核子監控…)，
網路存活時間(network lifetime)是不可或缺的系統參數。硬式存活時間(hard lifetime) WSNs 是指
所有的感測節點(sensor nodes)都必頇要滿足網路存活時間的限制，否則將引發嚴重的後果，如
性命上的威脅或經濟上的損失；而軟式存活時間(soft lifetime)只要統計上滿足網路存活時間的
限制即可。因此，提供可即時預測網路存活時間的方法是很重要的。 
  
 感測環境中環境現象具有時間及空間的相關性(temporal-spatial correlation)，利用基於門檻
值的冗員抑制技術(threshold-based redundancy suppression technical)在滿足可接受失真度的情況
下降近重複的傳送是普遍的方法之一，藉由設定門檻值來減少感測節點重複傳送相同的資料減
少感測節點的能量消耗可改善網路存活時間，典型基於門檻值的冗員抑制技術可分為三類：時
間抑制(temporal suppression)、空間抑制(spatial suppression)以及時間空間抑制(temporal-spatial 
suppression)。 
 
 我們實驗出五種方法來比較網路存活度(lifetime)，分別有時間抑制技術 TEEN[17]、向量量
化 技 術 (vector quantization technique)VQ 、 叢 集 式 繞 路 協 定  (Cluster-based Routing 
Protocol)LEACH[21]、碼簿編碼 ALVQ、預測模型 ARIMA。 
 
2.1. 繞路協定 
2.1.1 LEACH: 
 LEACH(low-energy adaptive clustering hierarchy) protocol 是一個可以應用於直接傳送或
多重跳躍的 routing protocol。此協定主要是將多個鄰近的 sensor node 組成一個 cluster。每個
cluster 中再以機率 T(n)的方式選出一個 cluster head。Cluster head 則負責接收 cluster 中其它
non-cluster head node 的資料加以整理或進行 data aggregation 後傳送給 base station，架構圖如圖
表 所示。如此可避免每一個 sensor node 皆將資料傳回 base station，因而消耗大量的能源。至
於選擇 cluster head 及如何形成 cluster 的程序主要是以節省能量及分散式的方式進行。其中最重
要的規則是於一定時間內讓每一個 sensor node 的 energy consumption 能夠平均以延長整體網路
的 lifetime (約 15%)。LEACH 的架構非常適合進行資料融合，因此可更進一步節省能量。 
  
( )iC t 表示第 i 個 sensor node 的狀態，1 表示沒當過 cluster head，0 表示當過。由 (1) 式可知，
經過
k
N 個 round 之後，預期所有的 sensor node 都將擔任過一次 cluster-head，透過此方式可以
將 cluster-head 的負擔讓每個 sensor node 平均分攤。 
2.1.3  Steady-state phase：資料傳送 
包括 cluster 裡的 non-cluster-head node 把 data 傳給 cluster-head 和 cluster-head 把 data 整合後傳
送給 base station。錯誤! 找不到參照來源。為 LEACH 的 flow chart 
 
 圖表 2.1.3.1 LEACH 的 flow chart 
 
2.1.4  LEACH 的 radio model 
在無線的環境下，傳輸是感測網路在運作中最消耗能量的一環，如錯誤! 找不到參照來源。
2.1.4.1 所示，我們以下列的方程式來表示： 
  
suppression technical)在滿足可接受失真度的情況下降近重複的傳送是普遍的方法之一，藉由設
定門檻值來減少感測節點重複傳送相同的資料減少感測節點的能量消耗可改善網路存活時間，
典型基於門檻值的冗員抑制技術可分為三類：時間抑制(temporal suppression)、空間抑制(spatial 
suppression)以及時間空間抑制(temporal-spatial suppression)。應用於感測網路的時間抑制技術最
早由 TEEN[17]所提出，將感測節點的感測值視為時間序列資料(time series data)，TEEN 給定了
二個門檻值:硬性門檻值 TH (hard threshold)及軟性門檻值 TS (soft threshold)，硬性門檻值的作用
在於劃分感測值的安全區域及危險區域，因此，感測節點只有在目前感測值超過 TH時會無條件
的將感測值回傳給基地台，軟性門檻值則限制了感測值的變化量，當感測節點的感測值與最後
一次傳送時的感測值相比的變化量小於 TS 時則不會回傳感測資料給基地台，然後在基地台沒收
到感測節點的回傳值時會以該節點最後一次傳送時的感測值來重建該節點的目前感測值。 
 
    2.2.2  VQ: 
 向量量化技術是一種量化技術用於訊號處理，其一般的用途是用於資料壓縮。感測節點長
時間感測的環境資料可視為一時間序列的資料流 )(tx , t = 1,2,…,m，當取樣數 m 足夠大時可保證
資料流 )(tx 的變化是穩定的(stationary)，即每一個感測值所發生的頻率是固定的。給定最大可允
許之失真度 Dmax，我們利用向量量化技術把感測值的集合分成最佳的群組 nisi ,,2,1,  ， is 的
範圍稱為量化區間(stepsize)，每一個群組以質量中心點(centroid point)的值為群組的代表值
 n
ii
q
1
，使得群組中每一個感測值與自己群組代碼間的距離分小於感測值與其他群組代碼間的距
離，即當 )(tx 的值落成群組 is 時，則 
njijiqtxqtx ji ,,2,1,  ,for   )()(                                           (1) 
亦即，當 )(tx 的值落成群組 is ，則以 qi 為其估計值，我們得知 
     nistxqtxEstxp
m
q
m
t
n
i
iiii ,,2,1,)()()(
1
minarg
1 1
2  
 
                        (2) 
最後我們依每個代表值 qi 發生的機率求出其熵值(entropy)，再利用熵編碼(entropy coding)將 qi
映射到一個碼字 ci (codeword)以建立一個碼簿(codebook)，供感測節點及基地台傳送時進行資料
壓縮之用。 
資料壓縮的動作如圖表 7 所示，首先，感測節點感測到環境現象後會利用碼簿對感測值進行編
碼(encode)，找出感測值  tx 所屬的群組，然後將群組碼字傳送出去，基地台收到碼字之後會依
碼字由碼簿中找到群組代表值 qi並以此為環境估計值 )(ˆ tx ，於是我們可得知所得環境估計值  txˆ
與真值  tx 的誤差 D 為 
       istxtxtxED  2ˆ                                                       (3) 
  
大值為止(其最大值與頻寬及暫存區大小有關)，最後將近似的參數傳送至基地台，基地台再藉
由反向操作將時間序列資料還原。 
    碼簿更新接續在感測節點完成編碼動作之後，其動作與碼簿建立相似，不同的地方在於感
測節點由新的時間序列資料中產生的新 CDP 之後會與舊 CDP 進行比較，也就是說，如新 CDP
安插在碼簿中能改善編解碼的精確度，則此新 CDP 將取代碼簿中不常被使用的 CDP，找出新
的 CDP 後，ALVQ 會採用兩階片段線性迴歸為新 CDP 進行編碼以確保碼簿的品質，其動作是
先為新 CDP 進行編碼，再為編碼後所產生的誤差進行第二次的編碼，最後將二次編碼的迴歸參
數傳送給基地台進行還原，如此一來，不僅可減少碼簿更新所產生的頻寬還可減少 CDP 重建的
失真。 
 
2.2.4 ARIMA: 
 以 historical data 當 training set，感測節點利用 time series analysis 來學習 training set 的變化
規則以建立預測模型，建立好預測模型後，將同時儲存於感測節點及基地台，感測節點及基地
台即可以此預測模型為基礎來完成冗員抑制，其抑制準則為當感測節點目前的感測數值(真值)
與預測模型所估計的數值(估計值)的差小於最大允許失真度時便取消傳輸，基地台在未收到感
測節點回傳數值的情況下會以預測模型所估計的數值(估計值)來取代其真值。如此一來，
prediction-based RSCM model 效能的優劣取決於預測模型的預測準確度，常見的方法有類神經
網路、ARIMA 及基因演算法等，我們以 ARIMA 為例子來說明預測模型的建立方法，ARIMA
由三個部份所組成，分別是 AutoRegressive term 自我迴歸項、Integrated term 整合項及 Moving 
Average term 移動平均項，ARIMA(p,d,q)的一般式為 
       
       tLtxL
tLtxLLtx
q
d
p
q
j
j
j
d
p
i
i
i

















 

       
111
11                                      (1) 
其中 L 為延遲係數(即 Lix(t)=x(t-i))，  t 是誤差項， i 和 j 為自我迴歸和移動平均的係數，p 和
q分別為自我迴歸和移動平均的落後項次。在 time series analysis，當 training set為穩定(stationary)
變化時，ARIMA(p,0,q)(又稱為 ARMA(p,q))可有效的分析符合 training set 的函數，而當 training 
set 為不穩定(non-stationary)變化時，ARMA(p,q)會發生假性迴歸的問題，此時如 training set 的 i
階差分呈穩定變化時，則可用 ARIMA(p,d,q)來分析 training set，需要強調的是，由於冗員抑制
的關係，基地台並無法取得每一次感測節點的感測資料，如此一來，基地台無法採用靜態預測
而必頇使用動態預測，即是當冗員抑制條件成立時，基地台則以預測值來取代被抑制的感測值
進行下一次的預測。 
 
當 training set 的變化具有週期性時，可採用 Seasonal ARIMA model 來分析，其一般式為
ARIMA(p,d,q)(P,D,Q)s，並可寫成 
  
 
圖表 9 、能量消耗圖(variance 5) 
 
3、 軟硬體架構的設計與實現 
3.1. 即時定位 
 即時定位系統的應用，隨著全球定位系統(Global Position System，GPS)的普及，已廣泛的
為大眾所接受。但GPS訊號易受建築物遮蔽，無法提供室內的定位服務，且空間較小的室內環
境，GPS的精確度無法符合各種需要。除了GPS我們可以利用無線訊號來達到定位的目的。無
線的即時定位系統要能夠即時的定位每一個目標物所在的位置，目標物要能藉由無線訊號的收
集，傳送到定位伺服器，來計算出目標物的位置。整個系統包括了兩個主要的部分：1.無線網
路：收集無線定位的資訊。2.定位的演算法。 
本章將探討室外、室內定位系統有那些方式及其演算法的相關知識，並針對環境感知系統應具
備的架構及發展相關議題的相關背景及研究。 
3.1.1.室外定位相關理論 
全球衛星定位系統 Global Positioning System, GPS 是美國政府所研發，整個 GPS 系統大約可分
  
    定位接收器目的為追蹤所有的 GPS 衛星，並即時地計算出接收器所在位置的座標、
移動速度及時間，計算原理為 ： 每個太空衛星在運行時，任一時刻都有一個座標值來代
表其位置所在(已知值)，接收器所在的位置座標為未知值，而太空衛星的訊息在傳送過程
中，所需耗費的時間，可經由比對衛星時鐘與接收器內的時鐘計算之，將此時間差值乘以
電波傳送速度(一般定為光速)，就可計算出太空衛星與使用者接收器間的距離，如此就可
依三角向量關係來列出一個相關的方程式。  
    一般使用的接收器就是依上述原理來計算出所在位置的座標資料，每接收到一顆衛星
就可列出一個相關的方程式，因此在至少收到三衛星後，即可計算出平面座標(經緯度)值，
收到四顆則加上高程值，五顆以上更可提高準確度，這就是 GPS 的基本定位原理。 
 
圖表 12、定位接收器示意圖。 
 一般來說，使用者接收器每一秒鐘的座標資料都是最新的，也就是說接收器會自動不斷地
接收衛星訊息，並即時地計算其所在位置的座標資料，如此使用者便不需擔心是否接收機顯示
的資料太舊或是不準確了。  
    由於衛星是處在相當高的運行軌道上，其傳送的訊號是相當的微弱，因此它不像一般通訊
無線電或大哥大等可在室內使用或收到訊號，故有下列缺點： 
   需在室外及天空開闊度較佳之地方才能使用，否則若大部份之衛星信號被建築物、金屬遮蓋
  
   紅外線訊號是大眾普遍聽到的一種訊號來源，屬於電磁波的一種，紅外線在一般使用上是無
法穿過牆壁或障礙物的，且某些室內光源變量(尤其是發熱性質的光源)即可能會對紅外線的準
確度及通訊距離造成影響。所以不像 RF 射頻訊號來得實用，在室內環境的使用上一般通訊距
離約為(通常在 3-7 公尺左右)。 
定位演算法方面 
 本節將介紹幾種不同的定位演算法則。定位演算法一般來說是可以利用與距離是否有關係
來分類，與距離有關係的演算法有抵達時間(Time of Arrival, TOA)法、抵達時間差(Time 
Difference of Arrival, TDOA) 法、抵達角度(Arrival of Angel, AOA) 法和訊號強度測距(Signal 
Strength Ranging, SSR)法，而與距離無關的演算法有基於射頻訊號(RF-Based)演算法，介紹如下： 
訊號抵達時間(Time-of-Arrival: TOA ) 
 抵達時間定位方法是基於測量信號從行動裝置間訊號發送出去並到達量測參考節點（3 個
或更多）的時間來定位的。然後再乘上訊號的傳播速度，就可以知道量測節點與行動裝置間的
距離。 
 主要分為兩種技術：雙向測距 Two Way Ranging(TWR ) 和單向測距 One Way 
Ranging(OWR)。在第一種技術中，測距可利用訊號在兩個非同步的收發器(Transceiver) 往返
(Round-trip)之間的時間(Time-of-Flight: TOF)來量測；若是端點間(Terminals)已被同步至一個共
同的時脈(Common clock)，則可採用第二種技術來完成測距。 
時間發送端
時間
接收端
發送端
距離
時間
射頻訊號
V m/s
Dt
(a)單向測距
距離=V×Dt
時間
接收端
距離
射頻訊號
V m/s
Dt
(b)雙向測距
距離=V×½ ×(Dt-treply)
treply
 
圖表 14、抵達時間測距法錯誤! 找不到參照來源。。 
 
訊號抵達時間差(Time-Difference-of-Arrival: TDOA) 
  
能量與路徑衰減模型在空曠無障礙的空間中，可以利用 Free-space 衰減公式來表示接收天線之
輸出功率與送入傳送天線功率之比率為：  
2)
4
(
d
GG
P
p
TR
T
R



                                               (1) 
其中( RG 、 tG )分別表示接收天線與傳送天線增益值，λ 表示波長(公尺)、d 表示距離(公尺)。一
般而言這裡選用的距離為 1 公尺以上，若選擇相同的天線，則可消除傳送天線與接收天線之增
益值( RG 、 tG )差異，去除天線因素，因此 RP / TP 就是路徑所造成的衰減比率。 
室內定位中，路徑衰減模型的選擇為影響定位精度最大的問題。本計劃使用的路徑衰減模型，
為修正後的 Free-Space 衰減模型，可以表示如下：  



P
p
Q
q
dd pWAFqFAF
d
d
pp
110
)()()log(10
0
                            (2)  
其中γ為路徑衰減比率，FAF(floor attenuation factor)表示樓層的衰減係數，WAF(wall attenuation 
factor)表示牆壁或一般障礙物的衰減係數。這個模型是針對環境中影響衰減大的物體做模型修
正，與 WAF 衰減係數之值會因不同物品、相對位置及使用之 RF 訊號的頻率而改變，因此應用
於室內環境時易受環境變動影響，所以才需要誤差修正及卡爾曼濾波來改善其問題。  
射頻訊號(RF) 
    射頻訊號法是利用訊號強度(SSI)來計算出可能的位置。此類方法是需要接收到多個節點所
發出的射頻訊號強度來達到的。而所接收到的訊號強度會寫入資料庫再進行演算法來取得距
離。但訊號強度在不同的環境中，會因為建材與擺設及阻隔物的不同而形成差異。這也是 RF
的特性之一。 
射頻訊號之定位演算法 
    一般常使用的射頻訊號定位方式可分成兩個主要機制，分別是環境訊號資料收集和定位系
統實測。環境訊號資料收集是要因地制宜，利用實測的方式來收取射頻訊號發射器在實際環境
佈局後的訊號強度值，並作為參考依據；但本計劃不需要以此方式建立訊號強度資料集，而是
可依環境直接自動更新其訊號強度集，而不必一直重新建立資料集。定位系統實測則是利用三
角定位加上卡爾曼演算法將所取得的射頻訊號轉換成實際的位置，並且此機制更增加了預測路
  
三角定位演算法誤差修正 卡爾曼濾波器
RSSI
訊號強度
位置資訊
 
圖表 17、室內定位軟體架構示意圖。 
3.1.3.室內定位系統開發 
 本節就以軟體架構比較重要的三部份來一一描述，分別是三角定位、誤差修正和卡爾曼濾
波器，如圖表 18 所示，整個系統流程圖如下。運作順序是將訊號強度資料經用資料庫放進三
角定位演算法中進行運算，然後將算出來的位置資訊和誤差修正程式進行校正，再將經過修正
的位置資訊放進卡爾曼濾波中進行去除動態雜訊的動作。進而顯示出較精準的位置資訊 
三角定位演算法誤差修正 卡爾曼濾波器 位置資訊
 
圖表 18、定位模組架構。 
三角定位演算法則 
 在探討三角定位演算法前，我們得先了解能量與路徑衰減的比例情形，也就是能量與路徑
衰減模型。 能量與路徑衰減模型 在空曠無障礙的空間中，可以利用 Free-space 衰減公式來表
  
InterSection(ap1, ap2, ap3, tmp11, tmp12)
InterSection(ap3, ap1, ap2, tmp31, tmp32)
InterSection(ap2, ap3, ap1, tmp21, tmp22)
trianglePosition()
tmp11, tmp21, tmp31皆有解
tmp11, tmp21, tmp31任兩項有解
tmp11, tmp21, tmp31任一項有解
target->x=(三項x相加)/3
target->y=(三項y相加)/3
target->x=(兩項x相加)/2
target->y=(兩項y相加)/2
target->x=單項x
target->y=單項y
Yes
Yes
Yes
No
No
target->x, target->y不變
No
 
圖表 19、三角定位演算法一。 
求交點的方式有三：(1)兩圓圓心之距離 d 大於兩圓的半徑相加則兩圓沒有交點(無解) (2)兩圓圓
心之距離 d 等於兩圓的半徑相加時則兩圓相切(恰有一解) (3)兩圓圓心之距離 d 大於兩圓半徑相
減的絕對值大於兩圓的半徑相加時則兩圓交於兩點。 
d > r1+r2 無解：設tmp1, tmp2為無限大
Yes
No
|r1-r2|< d < r1+r2
d = r1+r2 唯一解 → tmp1
Yes
No
ap1, ap2交於兩點：tmp1(近ap3)
tmp2(遠ap3)
interSection
(ap1, ap2, ap3, tmp1, tmp2)
 
圖表 20、三角定位演算法二。 
誤差修正(訊號漂移問題) 
 雖然三角定位即可以得到一般精準度的位置資訊，但三角定位是利用 RSSI 值(接收訊號強
度)來做定位，一定會有些例外產生，當射頻訊號經由一些介質及相關因素導致訊號漂移時，即
會導致如剛好強度所指的對 AP 不是三角型時，這時三角定位即會出問題且其精準度即會大大
  
環境改為室內環境，但使用者並不會固定在同一個地點不動，一定是動態行為模式，故可視為
一動態系統。而由於動態系統在量測時需要考慮到雜訊的問題，所以需要一個可以將雜訊問題
考慮進來並加以消除的方法，卡爾曼濾波器有將動態系統的雜訊(包含動態雜訊與觀測雜訊)考
慮進模型中，由於被設計在有雜訊的情況下工作，一個近似的符合已經可以使濾波的功能達到
非常好的效果，所以本計劃利用卡爾曼濾波器做為在動態室內定位下的修正，下面是 Kalman 
Filter 的簡介[26]。 
 卡爾曼濾波是一種高效率的遞歸濾波器(自回歸濾波器), 它能夠從一系列的不完全及包含
雜訊的測量(英文:measurement)中，估計動態系統的狀態。卡爾曼濾波只要獲知上一時刻狀態的
估計值以及當前狀態的觀測值就可以計算出當前狀態的估計值，因此不需要記錄觀測或者估計
的歷史信息。卡爾曼濾波器與大多數濾波器不同之處，在於它是一種純粹的時域濾波器，它不
需要像低通濾波器等頻域濾波器那樣，需要在頻域設計再轉換到時域實現。 
卡爾曼濾波器的狀態由以下兩個變量表示： 
 
kk
Xˆ ，在時刻 k 的狀態的估計； 
 
kk
P ，誤差相關矩陣，度量估計值的精確程度。 
 卡爾曼濾波器的操作包括兩個階段：預測與更新。在預測階段，濾波器使用上一狀態的估
計，做出對當前狀態的估計。在更新階段，濾波器利用對當前狀態的觀測值優化在預測階段獲
得的預測值，以獲得一個更精確的新估計值。 
預測 
kkkkkkk
uBxFX 
 111
ˆˆ  (預測狀態) 
k
T
kkkkkk
QFPFP 
 111
 (預測估計協方差) 
更新 
1
ˆˆ


kkkkk
xHzY  (測量餘量，measurement residual) 
  
平均值。換言之，我們並不希望估計出現這樣或那樣的偏差。在數學上，人們總希望估計的期
望值應等於狀態的期望值。 其次，我們希望狀態估計與實際狀態之間的偏差儘可能小。也就是
說，不僅希望狀態估計的平均值等於實際狀態的平均值，而且希望預估器的狀態估計與實際狀
態之間的偏差盡可能達到最小。在數學上，人們總希望預估器的誤差方差盡可能最小。  
Linear System 
xk=Fxk-1+Buk-1+wk-1 
zk=Hxk+vk 
wk ~ N(0,Qk) 
vk ~ N(0,Rk) 
{x0, w1, ..., wk, v1 ... vk}  
假設互相獨立 
 
圖表、 22卡爾曼濾波器的模型[26]。 
 
 
圖表 23、Two phases of Kalman filter [26]。 
 
3.2. 硬體相關 
心電圖原理 
心臟可謂是人體中最重要的器官之一，位於人體胸腔的左側，從出生到死亡心臟從不間斷
地工作著，使加壓的血液能夠充分地藉由血管佈滿全身。如圖表 24 所示，心臟可以區分為左
心房、左心室與右心房、右心室，心臟的收縮便是由右心房上竇房結(SA node)產生每分鐘大約
60 次的微小電脈衝訊所控制。 
  
 
圖表 26、心電圖記錄 
心電圖量測 
心臟本身的電位變化會經過心臟周圍的導電組織與體液反映到身體表面，所謂的「心電圖
(Electrocardiogram, ECG)」便是運用微電極技術紀錄心臟微小電脈衝的變化所產生的心肌細胞
內外電位差，由儀器放大電活動訊號描繪下的圖形，藉以瞭解心臟是否正常地運作。 
心電圖訊號屬於低頻範圍(0.05~100HZ)，且振幅微小僅 1~10mV，因此在心電圖訊號的擷
取上便需要訊號放大器與濾波裝置。臨床上用以測量 ECG 訊號的電極通常為銀∕氯化銀電極，
如下圖所示，其電位特性、雜訊以及回復特性等十分適合做為生理訊號使用的電極。 
 
圖表 27、ECG 貼片示意圖 
此外，心臟病患的照護與即時醫療亦需仰賴長期的心電圖紀錄與即時資料傳輸。為達此目
的，通常使用行動式擷取裝置以方便患者的日常生活。 
圖表 28 顯示了傳輸所占頻寬，所以如果我們一秒鐘取樣了 500 次 ( 500 Hz )，那即是說我
們一秒鐘就要花 1KB 的頻寬去傳送，但是在無線的環境之下特別要去考慮到連續不間段的傳送
封包的問題和頻寬的問題，所以要在頻寬和取樣速率中取得一個良好的平衡點。 
 
解析度(bit) 取樣速率(1/s) 傳輸位元速率(bit/s) 
 
 
16 
200 3200 
300 4800 
360 5760 
400 5600 
500 8000 
圖表 28、傳輸所占頻寬 
  
以FT-6200作取樣
( 16 bits，360 Hz )
透過FT-6200的ZigBee
模組傳送至遠端
透過遠端FT-6200接收
儲存至資料庫
使用找的程式由資料
庫讀取並顯示出來
 
圖表 30、取樣流程 
 
圖表 31 是我們的實驗流程，由使用者測量心跳後，把資訊由 End Device 的 AD 取樣之後
再藉由 802.15.4 傳送到 Coordinator 端，Coordinator 把封包的資料藉由 RS-232 的接口傳送到資
料庫，並由電腦讀取資料庫把資訊顯示出來。 
 
 
圖表 31、取樣架構圖 
 
Coordinator與End Device詳細步驟 
圖表 32為Zigbee模組中的Coordinator和End Device建立連線和傳送封包的流程。
Coordinator端建立後會等待End Device的連線，直到End Device建立連線後才會執行接收封包的
  
3.3. 健康監護系統 
 在高齡化的社會中，老人的照顧益形重要，為了能夠減少安養階段的人物力負擔，讓外地
的使用者或醫療院所能夠透過電腦，隨時隨地遠端監控家中病人或老人的生理狀況，並進一步
提供居家服務、必要之協助與救急服務，我們建構一個互動式智慧型健康監護系統（Smart 
Healthcare surveillance），透過無線感測網路（Wireless Sensor Network）監控與檢測病人之心
電訊號生理訊號，並配合ECG Pattern(子計畫二)來進行各式心臟疾病與生理狀況的分析與辨
識，判別此訊號是否透露出異常的警訊，與其可能出現的病況，進一步採取對應的病人健康監
控服務，並且結合Web Camera和定位系統，以便第一時間了解病人目前所處於的情況和環境地
點。 
 智慧型健康監護系統主要在架構一個互動式家庭醫療照護的環境，然後根據需求的不同，
連結各式不同的網路環境，讓各種裝置能夠彼此溝通，提供服務的功能更具彈性。現階段，我
們連結了兩種不同的網路環境，分別是Zigbee無線網路和Ethernet，穿戴在使用者身上的生理監
測硬體和定位標籤，考慮到其便利性與實用性，我們採用Zigbee無線網路來傳輸其所偵測到的
訊號，而遠端的使用者即時監控方面，我們使用傳輸速率和可靠性高的Ethernet來傳送存入
database的資料和Web Camera影像。 
Database
Web Camera
遠端監控
資料存取
影像傳輸
訊號偵測
RS232
健康監護系統
 
圖表 33、系統架構圖 
 
系統展示與說明 
 系統開啟時，使用者依據所處位置是在本地端或是在遠端監控決定訊號來源，選擇直接透
過 RS232 讀取通過 Zigbee 無線網路傳送至硬體上 ECG 訊號或是透過 Ethernet 讀取遠端量測後
  
四、 成果自評 
讓無線感測網路可以有最大的存活時間，及需要保證網路中感測點是可覆蓋整個環境，是無線
感測網路中一個相當重要的課題，本計畫使用演化式演算法找出最小成本全覆蓋和最佳化路由路徑
來延長網路存活時間達到自組態感測網路(Zigbee/802.15.4)優化與規劃。對於 ECG quality-aware 
adaptive ECG sample-rate control 節能演算法，則分別模擬出時間抑制技術 TEEN[17]、向量量化技
術(vector quantization technique)VQ、叢集式繞路協定 (Cluster-based Routing Protocol)LEACH[21]、
碼簿編碼 ALVQ、預測模型 ARIMA 等演算法，分析比較各種訊號處理演算法的特性和優缺點並分
析訊號處理演算法對壓縮 ECG 訊號的可行性。軟硬體設計方面我們實做出了採用源鼎科技的
FT-6200 來取樣，並且透過 Zigbee 無線網路傳送至 Coordinator 端，經由 RS-232 的接口傳送至資料
庫，健康監護系統從資料庫中取出所需的訊號，即時畫出 ECG 訊號圖並提供定位、Web Camera
等服務。 
 
 
 
 
五、 參考文獻 
[1] I. F. Akyildiz, W. Su, Y. Sankarasubramaniam, and E. Cayirci, “Wireless sensor networks: A 
survey,” Computer Networks, vol. 38, no. 4, pp. 393–422, March 2002. 
[2] M. R. Garey, D. S. Johnson, Computers and intractability: A guide to the theory of 
NP-Completeness, Freeman, New York, 1979. 
[3] Chen Wang; Thai, M.T.; Yingshu Li; Feng Wang; Weili Wu;, “Minimum Coverage Breach and 
Maximum Network LifeTime in Wireless Sensor Networks”, Global Telecommunications Conference, 
2007. GLOBECOM '07. IEEE, 26-30 Nov. 2007 Page(s):1118 – 1123 
[4] Jie Jia; Jian Chen; Guiran Chang; Jie Li; Yinghua Jia; “Coverage Optimization based on Improved 
NSGA-II in Wireless Sensor Network”, Integration Technology, 2007. ICIT '07. IEEE International 
Conference on ,20-24 March 2007 Page(s):614 – 618 
[5] Konstantinos Kalpakis, Koustuv Dasgupta, and Parag Namjoshi. “Maximum LifeTime data 
gathering and aggregation in wireless sensor networks”, August 2002, In IEEE International 
Conference on Networking, pages 685-696 
  
[16] T. Ryan Burchfield, S. Venkatesan, Douglas Weiner, “Maximizing Throughput in ZigBee 
Wireless Networks through Analysis, Simulations and Implementations*”, 2007, UTDCS-24-07. 
[17] A. Manjeshwar and D. P. Agrawal, “TEEN : A protocol for enhanced efficiency in wireless sensor 
networks," 1st International Workshop on Parallel and Distributed Computing Issues in Wireless 
Networks and Mobile Computing, April 2001. 
[18] V. Prabhakaran, D. Tse, and K. Ramchandran. “Rate region of the quadratic Gaussian CEO 
problem,” in IEEE ISIT ’04, 2004, p.119. 
[19] I. Koutsopoulos, S. Toumpis and L. Tassiulas, ''On the relation between source and channel coding 
and sensor network deployment", International Workshop on Wireless Ad-hoc networks (IWWAN) 
2005, London UK. 
[20] Song Lin; Kalogeraki, V.; Gunopulos, D.; Lonardi, S,” Online Information Compression in Sensor 
Networks,” Communications, 2006 IEEE International Conference on Volume 7,  June 2006 Page(s):3371 - 
3376 
[21] Wendi B. Heinzelman, Anantha P.Chandrakasan, and HariBalakrishnan, “An application-specific 
protocol architecture for wireless microsensor networks," T-COMM, vol. 1, no. 4, pp. 660-670, Oct. 
2002. 
[22] C. Liu, K. Wu, and M. Tsao, “Energy efficient information collection with the arima model in wireless 
sensor networks,” IEEE Global Telecommunications Conference 2005 (GLOBECOM ’05), vol. 5, pp. 
2470–2474, Dec. 2005. 
[23] 車用影音 GPS 技術發展應用 http://tuitionet.blogspot.com/2007/09/gps_11.html 
[24] 蘇嵩智,以 ZigBee 為基礎之室內定位系統實現,碩士論文,中正大學,2006 
[25] 莊智清, 沈子貴, 林景頎,以可程式系統晶片發展平台實現無線網路室內定位之分析與應。
Proceedings of 2005 CACS Automatic Control  ConferenceTainan, Taiwan, Nov 18-19, 2005 
[26] 卡爾曼濾波-維基百科
http://zh.wikipedia.org/w/index.php?title=%E5%8D%A1%E5%B0%94%E6%9B%BC%E6%BB%A4
%E6%B3%A2&variant=zh-hant 
