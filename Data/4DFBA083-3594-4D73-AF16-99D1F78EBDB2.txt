2 
 
本分析程式將會整合先前所開發的動態程式分析工具，其分析項目有包含靜態可執行檔分析、
檔案文件安全性分析和利用虛擬機器觀測程式行為。惡意程式樣本分析可以持續的開發，有彈
性的掛載在本子系統上，以檢驗雲端的檔案或是使用者欲檢測的檔案之安全性。 
 
二、  研究目的 
本研究執行之目的有三：（一）提供雲端服務平台檔案之安全分析，（二）開發與設計雲
端架構分析平台以提高安全分析產能。以下對此三大目的加以說明： 
（一）提供雲端服務平台檔案之安全分析 
由於雲端計算在應用上提供平台服務（PaaS），不管是客戶或是終端使用者皆有可能放置
檔案到此平台，並藉由此平台進行傳遞、交換、散播等動作，這些方式與傳統網際網路上檔案
交換並無太大不同，造成雲端平台上也有傳統網路攻擊的疑慮。對於雲端提供商與雲端平台客
戶來說，若是在雲端上發生類似傳統網路的蠕蟲攻擊，營運上的損失與對商譽的傷害將是無法
想像的巨大。因此，放置在雲端平台上的檔案安全與否變得格外重要。而如背景所述，傳統靜
態分析對於雲端平台上千變萬化的檔案已經不夠及時，必頇等待特徵碼產生後才能提供為判斷
的依據。 
因此本研究計畫之首要目標為，開發與整合多項檔案安全分析技術，並將其融合至雲端分
析平台以顧及多面向的雲端檔案。首先，分析雲端平台上的目標檔案是否內藏加殼程式來躲避
分析。若目標檔案為可執行檔，則進一步利用全系統層次的動態汙染行為分析技術來詳細分析
該執行檔是否可能對使用者系統造成危害。有了以上的安全分析，可保護雲端服務平台，降低
使用者上傳的未知檔案傷害風險。 
（二）開發與設計雲端架構分析平台以提高安全分析產能 
檔案分析的方式眾多，越來越多不同面向的分析工具大量的產出。但因為分析的方法不
同，而有互補的作用。靜態分析與動態分析各有其優缺點，靜態分析雖然運算負擔較動態分析
小，但卻無法得知執行時期的資訊，所以在分析應用上較適合特徵式偵測。另一方面，動態分
析除了負擔較大的運算開銷以外，分析範圍需要大量的運算時間搭配，故並沒有一種方法是完
美的。如果能夠簡易的整合市面上各種分析工具而達到互補作用，又可有效且平均的分配至多
台電腦，則可以加強分析能力又可縮短分析時間。 
為了增加分析的效率與產出，本研究計畫的第三項大目標，就是開發一個雲端架構式的分
析平台，把目前現有的分析工具模組化，依使用者需求掛載分析模組且動態的去管理。這個平
台必頇具備有：一）可擴充性、二）自動化、三）高容錯性。可擴充性可以讓本分析平台藉著
增加運算節點來達到效能的提升，有效的利用運算資源。然而，管理者需要同時管理多台電腦，
而此系統的眾多繁雜的設定檔，將會是往後維護人員的最大問題，自動化的管理與設定將會使
系統更方便使用。由於在雲端架構中有需多節點會交互溝通，容錯性可以讓系統工作得更久更
穩定。我們將實作與設計一套系統架構，符合雲端架構之精神來實作該分析平台。除了可以提
供分析服務以外，該平台還有自行蒐集網路文件檔案的能力，可以讓資安人員測詴自行開發的
分析工具，提早搜集網路上行為可疑的文件檔案。開發人員可以不用費心去管理其分析模組與
複雜的架設系統，也可以輕鬆快速地擁有客製化的分析結果。 
4 
 
在批次檔案輸入部分，我們撰寫一支程式將一個資料夾下的所有檔案透過分析平台的函式
庫輸入到分析平台上做分析。此程式會搜尋所有資料夾下的檔案，並產生該檔案之工作識別
（UID），並將工作識別放入 Redis，在將工作識別連同檔案內容放入 Cassandra 做保存。檔案
系統輸入這部分是將檔案系統上的資料輸入到我們的系統做分析，例如：單一資料夾、或遠端
掛載的資料…等，這部分主要是應用在批次處理資料，會需要一定的反應時間，應此在系統中
具有高於 Crawler 的優先權。 
 
圖表 1: 系統架構圖 
儲存子系統 
在儲存系統方面，由於此研究已經被探討多年，市面上也有大量的資料庫可以應用於本分
析平台上。為了節省開發時間以及維護方便，經過深入地了解以及搜索之後，我們選擇了兩個
現有的資料庫系統 Cassandra 和 Redis，透過修改程式、設定檔案和內部些許的程式碼，快速地
達到本分析平台所需要的儲存能力。 
Cassandra 是一套分散式的資料庫系統，在分析平台中用來儲存未分析的檔案內容以及分
析完的結果。會選用 Cassandra 的考量在於以下三點。 
1. NoSQL：Cassandra 是採用 Key-Value 的儲存方式，因此在資料庫有大量資料的情況
下，讀寫速度遠快於一般 SQL 的資料庫。此外，Cassandra 在資料庫的欄位也有別於
SQL 資料庫，通常 SQL 資料庫的欄位必頇在一開始就訂定，之後如果有新增或移除，
則必頇重新處理資料庫的內容，而 Cassandra 正好相反，它能動態的新增或移除欄位，
讓整個分析平台在新增分析模組的情況下變得更為簡單。 
2. 系統穩定度高： Cassandra 的分散式是採取 ring 的架構，因此每台 Cassandra 都是相
同的身分，意即非主從式(Master-Slave)的架構，所以當任何一台資料庫毀壞，也不會
造成整個儲存系統停擺。另外，在新增資料庫機器時也不需要將資料庫全部關閉，所
以能使整個分析平台的執行更加穩定，不需要因為新增機器而暫停運作。 
3. 可與 Hadoop 整合：Cassandra 在 0.7 版以後提供與 Hadoop 整合的功能，能將資料庫
的內容直接進行 Map-Reduce ，因此分析平台系統在後期的發展能將分析完的結果做
進一步的處理。 
由於以上考量，本系統將 Cassandra 當作是整個系統的後端，專門儲存所有的檔案以及其結果，
相較於稍後會提及的 Redis，Cassandra 所存放的資料是屬於永久性的。  
6 
 
準確的偵測率。本子系統透過一個統一的設定檔，來記錄不同形式分析器的使用方
式，讓系統可以整合各種不同形式的分析器。 
(四) 執行多個分析器於單一節點，以增進系統產量：由於各種分析器執行時所消耗的系統
資源不一，而單一一台分析器也鮮少用盡系統資源。因此透過同時執行多個不同分
析器於單一節點上，增加系統資源的使用率，並促進系統產量。在此子系統中，我
們可以動態增減執行的分析器，並同時分派任務執行，以達到單一節點執行多分析
器。 
要將分析器運行於本系統中，只需要編寫一個額外的設定檔（config），以 key-value 的形
式將分析器的啟動以及結果位置做設定，如表格 1。 透過設定設定檔中的 command 欄位（如：
COMMAND= ./scanner.sh），可以指定分析器執行的方式，本系統便可自動分配檔案並且執行
分析。log 欄位則用來指定最後的結果存放位置（如：LOG = clamav.out），本系統便會自動保
存分析結果。我們實做 AnalyzerInvoker.rb，搜尋分析器目錄裡的設定檔（config），取得各分
析器的啟動方式以及輸出檔案。接著透過先從 Redis 中的佇列取得要分析的工作識別後，以該
工作識別去查詢 Cassandra 資料庫中抓取相對應的檔案。並利用設定檔中的起動方式將分析器
啟動。分析完畢後，則依據設定檔中的分析結果位置取得分析報告，將最後結果回存到資料庫
中。 
本系統主要的流程可分為兩種(圖表 3)，彼此間連繫的管道是透過儲存子系統，詳細如下： 
1. 由檔案來源子系統至儲存子系統:負責將檔案存入系統中，同時產生後續分析所需的工作
識別。此處的檔案來源目前有三種:使用者上傳、硬碟讀取和Ｃrawler。 
2. 由儲存子系統至分析器管理子系統:負責處理未分析的檔案。首先至儲存子系統中的 Redis
拿取工作識別後，再去向 Cassandra 拿取檔案來進行分析，之後儲存結果。 
 
欄位名稱 欄位說明 範例 
COMMAND 執行分析器時所需的指令 COMMAND= ./scanner.sh 
LOG 分析報告的儲存位置 LOG = clamav.out 
TYPE 分析器的名稱 TYPE=ClamAV 
表格 1 設定檔內容 
 
圖表 3: 系統流程。(左:檔案來源子系統至儲存子系統 ;右: 儲存子系統至分析器管理子系統) 
8 
 
 
圖表 5: 每 50 分鐘分析個數直方圖。 
10 
 
[18] Anubis: Analyzing Unknown Binaries, http://anubis.iseclab.org/ 
99 年度專題研究計畫研究成果彙整表 
計畫主持人：謝續平 計畫編號：99-2218-E-009-018- 
計畫名稱：前瞻性雲端安全儲存、防護、行為分析與觀測平台--子計畫二：基於機器碼之 Windows 惡
意程式行為分析雲端平台(1/2) 
量化 
成果項目 實際已達成
數（被接受
或已發表）
預期總達成
數(含實際已
達成數) 
本計畫實
際貢獻百
分比 
單位 
備 註 （ 質 化 說
明：如數個計畫
共同成果、成果
列 為 該 期 刊 之
封 面 故 事 ...
等） 
期刊論文 0 0 100%  
研究報告/技術報告 0 0 100%  
研討會論文 0 0 100% 
篇 
 
論文著作 
專書 0 0 100%   
申請中件數 0 0 100%  專利 已獲得件數 0 0 100% 件  
件數 0 0 100% 件  
技術移轉 
權利金 0 0 100% 千元  
碩士生 2 2 100%  
博士生 2 2 100%  
博士後研究員 0 0 100%  
國內 
參與計畫人力 
（本國籍） 
專任助理 0 0 100% 
人次 
 
期刊論文 0 0 100%  
研究報告/技術報告 0 0 100%  
研討會論文 0 0 100% 
篇 
 
論文著作 
專書 0 0 100% 章/本  
申請中件數 0 0 100%  專利 已獲得件數 0 0 100% 件  
件數 0 0 100% 件  
技術移轉 
權利金 0 0 100% 千元  
碩士生 0 0 100%  
博士生 0 0 100%  
博士後研究員 0 0 100%  
國外 
參與計畫人力 
（外國籍） 
專任助理 0 0 100% 
人次 
 
 
