 2
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
第一年計畫成果 
 
 
 
 
 
 
 
 
 
 
 
  4
2.2 離散餘弦轉換之應用 
在離散餘弦轉換應用於影像的相關研究方面，絕
大多數著重於使用離散餘弦轉換進行影像的壓縮與
浮水印嵌入，其中包含了例如 JPEG、MPEG 與 H.261
等圖像或影片的壓縮格式等[1, 14, 16]。在其他應用方
面，Ngo [12]等人更進一步利用離散餘弦轉換結合影
像彩色色階分布圖、約略外形模組與影像紋路特徵
等，開發出一套彩色影像索引的技術；Chen [2]使用
離散餘弦頻率域的係數，進行遠端影像監視器的邊緣
訊號增強，其目的為調整遠端監視影像的亮度與對比
值；Lin 和 Ho [8]提出使用 DCT 轉換將空間域數位影
像轉換至離散餘弦頻率域頻譜，搭配兩階段式離散餘
弦頻譜分析與解構規則後，再使用累和管制法偵測頻
率域平緩曲線之轉折點以決定最佳切割扇形半徑，在
去除頻譜扇形半徑區域內的能量值後，再還原至空間
域數位影像，即可完成針孔狀瑕疵的偵測。Lin 和
Jiang [9]使用 DCT 轉換搭配灰關聯分析來決定頻譜
影像中，每一頻率值所要衰減之係數，且藉頻率衰減
之動作來刪除空間域影像中的背景以突顯 LED 表面
之針孔瑕疵。 
2.3 多變量管制圖 
目前多變量管制圖多應用於多變量製程之製程
管制，Mason 以及 Young [10]兩人曾提出一種增加 T2
統計量敏感度之方法。陳志松[18]提出應用品質管制
技術中 Hotelling 多變量管制圖之 T2統計量於表面瑕
疵之檢測，並以表層障蔽型半導性瓷片(SBL)上一種
常見的水紋紋路瑕疵為檢測對象，應用 T2 統計量可
整合多個影像特徵之特性，整合彩色影像之多個紋路
特徵以降低水紋瑕疵檢測之誤判率。陳柏年[21]曾提
出一個多變量管制圖之自動化檢測系統，研究建構以
影像分析為基礎之自動化檢測系統並結合多變量管
制圖與自動化檢測，而對於異常點之分析有更進一步
之探討，最後評估各種自動化檢測情況下適合之多變
量管制圖。 
2.4 灰色系統理論 
灰色系統理論是鄧聚龍[3]於 1982 發表的，其主
要針對系統模型之不明確性及資訊之不完整性下，進
行有效的處理。Ken [6]使用灰聚類演算法，進行 12
個常見形狀辨識之應用。其主要利用一個形狀的特徵
計算群聚辨識的結果，進行反覆疊代，而達到辨識度
相當高的結果，其類似應用有[25]。賴宏仁[24]提出
一個新的灰聚類演算法將資料加以聚類，並探討如何
在已知系統輸入輸出資料時，將所提的方法應用於模
糊系統之建模及控制器的設計。所提出的灰聚類演算
法是一個新的資料聚類方法，是以資料點間的灰色關
聯度為各資料點間相似程度的代表值，並依此將資料
聚類。我們再利用所得的聚類結果，包括聚類後資料
群聚的數目以及各個群聚的中心位置、寬度等資訊，
應用於模糊系統的設計。Zhou [17]使用灰聚類演算
法，進行濕地污染之評估。 
由以上文獻探討可知，雖目前已有許多表面瑕疵
檢測相關研究，但本研究針對曲面光學元件進行可視
瑕疵檢測，其待測物特性與瑕疵特徵與前研究不同，
因此本研究使用區塊離散餘弦轉換搭配多變量 T2 處
理及灰聚類演算法，偵測光學元件中之 LED 透鏡之
可視瑕疵。 
3. 研究方法 
本研究使用電腦視覺技術，檢測 LED 透鏡是否
具有可視瑕疵，而為了克服 LED 透鏡影像具有灰階
值層及影像明暗不ㄧ之現象，無法使用傳統之影像處
理方法進行檢測，因此使用區塊 DCT 轉換，擷取 DCT
轉換之特徵值，並嘗試以各獨立小區塊為單位，以降
低影像灰階值漸層之影響，後續使用多變量管制手
法，將區塊內多個特徵值整合成一個 T2 統計量進行
管制，最後利用灰聚類演算法將瑕疵區塊正確位置偵
測出來，以下將針對上述所使用之方法進行學術原理
之探討，如圖 2 所示。 
研究開始
蒐集待測影像
訓練或測試影像
擷取區塊DCT
轉換後之特徵值
計算無瑕疵影像之
多變量特徵參數
用T2統計量彙整
多變量特徵變數
區塊特徵T2值是否
超出管制界限
結束
執行區塊DCT轉換
進行灰聚類演算法
評估瑕疵偵測效益
擷取區塊DCT
轉換後之特徵值
區塊DCT轉換
找出可疑
瑕疵區塊
YES
為正常區塊
不進行後續分析
NO
NO
YES
進一步篩選可疑
區塊並確認瑕疵
所在位置
分離背景與瑕疵
 
圖 2 LED 透鏡之可視瑕疵檢測流程圖 
3.1 影像前處理 
本研究之 LED 透鏡待測影像，其主要檢測的範
圍為 LED 透鏡中央的圓形區域，而離散餘弦轉換無
法只針對圓形區域來計算，因此必須先建立影像遮
罩，再以人工背景取代遮罩外之區域，而遮罩之功用
在於讓程式自動區分背景區與目標物範圍。因本研究
之待測光學元件為 LED 透鏡，而主要檢測目標為待
測影像中央之圓形區域(圖 3(a)中待測影像中央圓形
區域)，其他區域皆屬於背景區域。然而背景區域非
是本研究之檢測目標，因此若直接將待測影像進行
  6
( )
1/2
-1-1 22 #1 1  0,0 0
⎡ ⎤⎢ ⎥= + × + ≠∑ ∑⎢ ⎥= =⎣ ⎦
QP
E u D                   u v  u vV u v
 (3)
( )
1/2-1-1 2#11 ( 1)         0,0 0
⎡ ⎤= + × + × + ≠∑ ∑⎢ ⎥= =⎢ ⎥⎣ ⎦
QP
E u v D   u vu vD u v
 (4)
-1-1 21 #1
,0 0
= ∑ ∑× = =
QP
E Du vM P Q u v
 (5)
( )
2-1-1 21 #1 ,-1 0 0
⎛ ⎞= −∑ ∑ ⎜ ⎟× ⎝ ⎠= =
QP
E D Eu v MS P Q u v
 (6)
其中， HE 為區塊 DCT 轉換之水平能量特徵值； VE 為
區塊 DCT 轉換之垂直能量特徵值； DE 為區塊 DCT
轉換之交錯能量特徵值； ME 為區塊 DCT 轉換能量之
平均值； SE 為區塊 DCT 轉換之能量變異數。 
3.3 T2統計量之多變量處理 
本研究將常用於監控多變量製程是否發生異常
之多變量管制圖概念應用於 LED 透鏡之可視瑕疵之
初步檢測，而 T2統計量可將區塊 DCT 轉換得到五個
特徵值整合為一個 T2統計量，作為描述 LED 透鏡可
視瑕疵特性之特徵。當 T2 值越高表示該區塊與正常
影像差異越大，因此可判定該區塊為疑似含有瑕疵，
最後則以灰聚類演算法，針對疑似含有瑕疵之區塊進
行聚類，以找出 LED 透鏡可視瑕疵之精確位置。 
3.3.1 計算共變異數矩陣與各影像特徵平均值矩陣 
在多變量處理過程中，共變數(Covariance)可以
用來評估多個變數間的相依程度，可用無瑕疵影像建
立多變量處理所需之參數矩陣。本研究中將區塊DCT
所擷取之特徵值視為欲管制之品質特性，合計共有五
個多變量處理所需之影像特性。採用無瑕疵影像所建
立共變數矩陣如下： 
2
2
2
2
2
5 5
S S S S SE E E E E E E E EH H V H D H M H S
S S S S SE E E E E E E E EH V V V D D M V S
S S S S SS E E E E E E E E EH D V D D D M D S
S S S S SE E E E E E E E EH M D M D M M M S
S S S S SE E E E E E E E EH V D MS S S S S
⎡ ⎤⎢ ⎥⎢ ⎥⎢ ⎥⎢ ⎥⎢ ⎥⎢ ⎥= ⎢ ⎥⎢ ⎥⎢ ⎥⎢ ⎥⎢ ⎥⎢ ⎥⎣ ⎦ ×
 
(7)
其中， 2
pS 表式影像特徵 p 之影像樣本組間的變異數； 
pqS 表示影像特徵 p 與影像特徵 q 之影像樣本組間共
變異。而無瑕疵影像所建立之平均值矩陣如下： 
1
2
  3
4
5 5 15 1
⎡ ⎤ ⎡ ⎤⎢ ⎥ ⎢ ⎥⎢ ⎥ ⎢ ⎥⎢ ⎥ ⎢ ⎥⎢ ⎥ ⎢ ⎥= =⎢ ⎥ ⎢ ⎥⎢ ⎥ ⎢ ⎥⎢ ⎥ ⎢ ⎥⎢ ⎥ ⎢ ⎥⎣ ⎦⎣ ⎦ ××
EX H
EX V
EX  X  Di
EX M
EX S
:  
:  V
:  D
:  M
:   S
區塊水平能量之平均值
區塊垂直能量之平均值
區塊交錯能量之平均值
區塊能量之平均值
區塊能量之標準差
EH
E
E
E
E
 
(8)
3.3.2 瑕疵影像之多變量處理 
本研究使用 4 4× 區塊作為處理之區塊大小，ㄧ
張 256 256× 大小之影像將可分為 (256 / 4) (256 / 4)×
個區塊樣本組，而每個樣本組內共有 4 4× 共 16 個觀
測值，且每個區塊經過 DCT 轉換得到五個影像特
徵。而本研究之 T2能量計算公式如下： 
( ) ( )2 -1-  -      1, 2,...,5= =TT  n X   X S X   X ii i i i  (9)
其中，n 為每個樣本組中觀測值個數；Xi為區塊離散
餘弦轉換之特徵值； iＸ 為無瑕疵影像之特徵平均值
矩陣；S 為無瑕疵影像之特徵共變數矩陣。 
3.3.3 大樣本 T2管制界限 
經上述分別計算區塊之 T2 統計量後，本研究因
樣本數為 4096 筆，因此採用大樣本 T2多變量管制圖
之管制界限來找出疑似含有瑕疵之區塊，如式子(10)
所示。 
( 1) , ,
0
α−= −−
=
p mUCL F p m pm p
LCL
 (10)
其中， α＝顯著水準； p=5 為品質特性個數；
m= (256 / 4) (256 / 4)× 為總資料筆數。若區塊之 T2 統
計量小於管制界限，則此區塊判定為非瑕疵區塊，不
在進行後續之處理；若 T2 統計量大於管制界限，則
判定此區塊疑似含有瑕疵，必須進行灰聚類演算法來
進ㄧ步確認是否為瑕疵區塊。圖 5 為區塊 DCT 轉換
撘配 T2統計量之示意圖。 
 
圖 5 區塊 DCT 轉換撘配 T2統計量之示意圖 
3.4 灰聚類演算法 
Lin 和 Jiang [9]使用灰關聯分析進行瑕疵檢測，
而灰關聯分析只能計算出序列間的關係程度，無法針
對序列間進行分類，因此本研究進ㄧ步提出使用灰聚
類演算法，依灰關聯分析所計算出的關係程度進行聚
類。經上述之 T2 演算法所挑選疑似存在有瑕疵之區
塊，本研究使用翁慶昌[14]所提出之灰聚類演算法。
因灰聚類是以灰關聯分析為基礎之聚類演算法，而灰
關聯分析是ㄧ種具整體性的測度方法，以 DCT 轉換
後之五個特徵值即可進行計算，且區塊 DCT 間不需
符合統計分配等特性。因此灰聚類演算法利用區塊間
之灰關聯分析結果來做為判斷區塊間相似程度，將相
似度高的區塊進行聚類在一起。 
  8
本研究使用區塊 DCT 轉換搭配多變量 T2演算法
及灰聚類演算法來偵測 LED 透鏡可視瑕疵，其中區
塊 DCT 轉換主要為擷取區塊之特徵值做為後續分
析，而多變量 T2 演算法目的是為了降低灰聚類演算
法之資料筆數，使偵測時間大幅縮短，最後之灰聚類
演算法則是確定有瑕疵之區塊之精確位置，其研究流
程如圖 7 所示。圖 7(a)為經前處理後之待測影像，將
其影像進行區塊 DCT 轉換而得到圖 7(b)之 DCT 頻譜
影像，之後擷取區塊 DCT 內之特徵值，並使用多變
量 T2進行整合，若 T2統計量大於管制界限，則判為
可疑瑕疵區塊，如圖 7(c)所示。接著使用灰聚類演算
法將可疑瑕疵區塊進行聚類，去除非瑕疵之區塊，只
留下存在有瑕疵區塊，如圖 7(d)所示，並將瑕疵區塊
對應到圖 7(a)前處理影像相同位置內之灰階值取
出，而其他區域則以人工背景之灰階值填入，而形成
圖 7(e)瑕疵區塊結合人工背景，最後使用 N 倍自動閥
值切割方法區隔瑕疵與背景，完成 LED 透鏡可視瑕
疵偵測，如圖 7(f)所示。 
 
圖 7 LED 透鏡可視瑕疵之偵測流程影像；(a)經前處
理之待測影像；(b)區塊 DCT 轉換後之頻譜影像；(c)
經 T2 統計量所偵測之可疑瑕疵區塊；(d)經灰聚類演
算法所確認之瑕疵區塊；(e)瑕疵區塊結合人工背景；
(f) N 倍標準差之閥值切割結果。 
4. 實驗與結果 
為驗證本研究所提方法之可行性，本研究使用
48 個 LED 透鏡樣本進行實驗，經執行各種瑕疵檢測
方法後，並將結果進行統計評估分析。以下將介紹本
研究所使用之影像擷取系統、自行開發之 LED 透鏡
可視瑕疵偵測系統及效益評估指標。 
4.1 影像擷取系統與檢測軟體開發 
本研究之實驗是在實驗室的環境下進行，使用電
腦視覺系統進行 LED 透鏡之可視瑕疵取像，主要設
備包括CPU為 Pentium IV 2.4GHz個人電腦搭配記憶
體為 512MB DDRII 667Hz、ARTRAY 公司之 USB 2.0 
CCD 相機、1~10 倍可變焦鏡頭、藍色環形正光及 XY
平台，其拍攝之硬體架構如圖 8 所示。 
圖 8 本研究之實驗設備圖 
在程式開發與瑕疵偵測方面，本研究採用
Borland C++ Builder 6.0 進行程式撰寫，自行開發出
一套能進行影像前處理以及影像二維離散餘弦轉
換，並擷取區塊 DCT 頻譜值之垂直能量、水平能量、
交錯能量、區塊平均值與區塊標準差等五個特徵值，
之後建立多變量 T2 演算法模式與灰聚類演算法進行
偵測 LED 透鏡的可視瑕疵，其操作介面如圖 9 所示。 
 
圖 9 本研究所開發之 LED 透鏡可視瑕疵偵測系統 
4.2 LED 透鏡可視瑕疵偵測效益評估指標 
根據本研究所開發之 LED 透鏡可視瑕疵偵測系
統，先針對大小為 256 256× 像素的 LED 透鏡影像進
  10
疵正確偵測出來。其中，灰聚類演算法使用整體灰關
聯度，在計算量上比起前研究使用之局部灰關聯繁雜
許多，而本研究之所以瑕疵偵測時間與前研究相同，
主要原因有三： 
1. 本研究使用 4 4× 區塊大小進行 DCT 轉換較為節
省時間； 
2. 在進行灰聚類演算法前，本研究使用多變量 T2
演算法將資料筆數降低； 
3. 本研究不需進行 DCT 反轉。 
表 2 本研究與先前研究之差異 
 Lin 和 Jiang [9] 本研究 
使用方法 DCT +灰關聯分析(需進行DCT反轉)
 DCT +灰聚類演算法
(不需 DCT 反轉) 
DCT 區塊
大小 128 128×  4 4×  
特徵值 頻率值強度、 能量集中係數 
,  ,  ,  ,  H V D M SE E E E E
等能量值 
1-β (%) 86.6 91.7 
α (%) 0.1 0.1% 
Time (s) 0.9 0.6 
4.4 不同區塊大小對瑕疵檢測之影響 
本研究進行 LED 透鏡之可視瑕疵檢測時，必須
先決定 DCT 轉換之區塊大小，此區塊大小設定對於
資料量及檢測時間均有影響，因此本研究探討使用不
同區塊大小進行 DCT 轉換對於瑕疵偵測之瑕疵檢出
率(1-β)、正常區域誤判率(α)及檢出時間整理如表 3
所示。 
表 3 不同 DCT 轉換區塊大小之檢測效益比較表 
 
DCT 轉換之區塊大小 
2×2 4×4 8×8 16×16 32×32
α (%) 0.2 0.1 0.2 0.3 0.3 
1-β (%) 92.2 91.7 91.8 84.8 66.6 
CR (%) 99.8 99.8 99.7 99.6 99.5 
Time (s) 5.0 0.6 0.5 0.5 0.5 
由表 3 之檢測效益比較表可知，當區塊大小設定
在 2×2 大小時，雖然檢出率高於其它區塊大小之設
定，但因經 DCT 轉換後會產生 (256 / 2) (256 / 2)× 筆資
料進行後續分析，因此大幅增加其檢出時間，並不符
合生產線 on line 的需求。而當區塊大小設定在 16×16
及 32×32 時，因瑕疵檢出率(1-β)未達 90%之標準，因
此不建議採用。當區塊大小設定為 4×4 之瑕疵檢出率
(1-β)較 8×8 低 8.9%，但正常區域誤判率(α)卻比 8×8
減少 50%，因此本研究將 DCT 轉換之區塊大小設定
為 4×4。 
4.5 不同灰關聯公式之瑕疵檢測效果比較 
灰聚類演算法是以灰關聯分析為基礎的聚類演
算法，因此使用不同灰關聯公式進行灰聚類演算法對
於偵測 LED 透鏡之可視瑕疵結果必有差異。以下列
出四種常見整體性灰關聯公式[23]： 
(1) 永井正武之整體性灰關聯度公式 
( ), 1-
max
ij i j
ijx x ΔΓ = Γ = Δ  (25)
其中， ijΔ 為： ( )
1
22
1
n
ij ij
k
k
=
⎛ ⎞⎡ ⎤Δ = Δ⎜ ⎟⎣ ⎦⎝ ⎠∑  
(2) 溫坤禮之整體性灰關聯度公式 
( )  
 
maxmin,
max
ij i j
ij
x x
+
+
Δ ΔΓ = Γ = Δ Δ  (26)
其中， ijΔ 為： ( )
1
1 n
ij ij
k
k
n =
⎧ ⎫⎡ ⎤Δ = Δ⎨ ⎬⎣ ⎦⎩ ⎭∑  
 
(3) 吳漢雄之整體性灰關聯度公式 
( ) maxmin,
max
ij i j
ij
x x
+
+
Δ ΔΓ = Γ = Δ Δ  (27)
其中， ijΔ 為： ( ) 2
1
1 n
ij ij
k
k
n =
⎡ ⎤Δ = Δ⎣ ⎦∑  
(4) 夏郭賢之整體性灰關聯度公式 
( ) -
-
max,
max min
ij
ij i jx x
Δ ΔΓ = Γ = Δ Δ  (28)
其中， ijΔ 為： ( )
1
1 n
ij ij
k
k
n =
⎧ ⎫⎡ ⎤Δ = Δ⎨ ⎬⎣ ⎦⎩ ⎭∑  
為探討不同灰關聯公式對瑕疵檢測效果的影
像，本研究使用 C++ Builder 6.0 實做上述學者所提出
之灰關聯演算法，且將 DCT 區塊大小皆設定在 4×4，
進行偵測 LED 透鏡之可視瑕疵，最後將五種不同灰
關聯公式之檢測結果整理如表 4 所示。 
 
 
  12
11. Nakashima, K., Hybrid inspection system for LCD 
color filter panels, Tenth International Conference 
on Instrumentation and Measurement Technology, 
Hamamatsu, pp. 689-692, 1994. 
12. Ngo, C. W. , T. C. ,Pong and R. T. Chin, Exploiting 
image indexing techniques in DCT domain, Pattern 
Recognition, Vol.34, pp.1841-1851, 2001. 
13. Otsu, N., Athreshold selection method from gray 
level histogram, IEEE Transactions on Systems, 
Man and Cyberneics, Vol. 9, pp.62-66, 1979. 
14. Pan, F. Adaptive image compression using local 
pattern information, Pattern Recognition Letters, 
Vol. 23, No. 14, pp.1837-1845, 2002 . 
15. Sokolov, S.M., A.S. Treskunov, Automatic Vision  
System for Final Test of Liquid Crystal Displays, 
IEEE International Conference on Robotics and 
Automation, Vol.2, pp 1575-1582, 1992. 
16. Sun, M. T., I. M. Pao, Statistical computation of 
discrete cosine transform in video encoders, 
Journal of Visual Communication and Image 
Representation, Vol.9, No.2, pp.163-170, 1998. 
17. Zhou, L. F., S. G. Xu, Application of Grey 
Clustering Method in Eutrophication Assessment 
of Wetland, The Journal of American Science, Vol. 
2, No. 4, 2006. 
18. 林宏達，陳志松，以 T2 統計量為基礎之小波特
徵多變量處理模式應用於表面瑕疵之檢測，工業
工程學刊，第 21 期，第 2 卷，121-135 頁，2004。 
19. 翁慶昌、陳嘉欉、賴宏仁，灰色系統基本方法及
其應用，高立圖書有限公司，台北、台灣，2001。 
20. 陳同孝、張真誠、黃國峰，數位影像處理技術，
松崗出版社，台北、台灣，2-18 至 2-23頁，2001。 
21. 陳柏年，多變量管制圖與自動化檢測系統之整合
性研究，碩士論文，國立成功大學工業管理學系
台南、台灣，1999。 
22. 國家實驗研究院儀器科技研究中心，光學元件精
密製造與檢測，全華圖書公司，台北、台灣，
2007。 
23. 溫坤禮、張簡士琨、葉鎮愷、王建文、林慧珊，
MATLAB 在灰色系統理論的應用，全華科技圖
書，台北、台灣，2006。 
24. 賴宏仁，經由灰聚類演算法之模糊系統設計，碩
士論文，私立淡江大學電機工程系，台北、台灣，
1999。 
25. 鐘俊元，灰色聚類在形狀識別之應用，碩士論
文，國立中央大學機械工程系，桃園、台灣，
1995。 
 
 
 
 
 
 
Construction of Automated Visual 
Defect Inspection System for Optical 
Components 
  
Hong-Dar Lin 
Department of Industrial Engineering and 
Management, 
Chaoyang University of Technology,  
Wufong Township, Taichung County, 41349, 
Taiwan. 
Abstract  
Lenses, one kind of optical components, are popular 
and widely used in digital camera, cell phone, and 
CD-ROM. Nevertheless, LED lens with a curved 
surface is more difficult to detect the surface defects 
with current computer vision systems. The purpose of 
this research is to apply the block discrete cosine 
transform (BDCT) and grey clustering method to detect 
visual defects of LED lens. A spatial domain image is 
converted to DCT domain and some representative 
energy features of each DCT block are extracted. These 
energy features are integrated by T2 statistic and grey 
clustering algorithm and then the defect area can be 
determined. Experimental results show the defect 
detection rate of the proposed method is 91.7% better 
than those of traditional spatial and frequency domain 
approaches.   
 
Keywords：Optical lens, Visual defect inspection, 
Discrete cosine transform, T2 statistic, 
Grey clustering 
 
 
 
  14
建立光學元件之自動化可視瑕疵檢測系統(II) 
林宏達 
朝陽科技大學 工業工程與管理系 
 
摘要  
發光二極體(Light emitting diode, LED)具壽命
長、耗電量低、體積小等優良特性，並搭配不同 LED
光學透鏡，來達到散射或聚光等不同訴求。本研究主
要針對表面具結構性紋路之 LED 透鏡進行可視瑕疵
的偵測，利用小波包轉換 (Wavelet Packet Transform, 
WPT) 擷取紋路與瑕疵之小波特徵，搭配使用多變量
分析中的部份最小平方 (Partial Least Square, PLS) 
法整合小波特徵中重要的資訊，可以有效地將附著於
紋路上的瑕疵檢測出來，比較以往刪除整個小波子區
塊的方式更能保留表面紋路與瑕疵資訊；實驗結果顯
示於瑕疵檢出率可達 97.9 %，而瑕疵誤判率僅 0.1%，
執行每張影像檢測時間僅須 163 毫秒(ms)，非常適用
於實際生產作業中進行瑕疵的檢測。 
 
關鍵字 : LED 透鏡、結構性紋路、可視瑕疵檢驗、
小波包分析、部份最小平方迴歸法、主成
份迴歸法。 
1. 前言 
隨著影像分析技術的進步，現今已有許多生產系
統，將自動光學檢測系統導入在工業元件表面品質的
檢驗上，在許多不同地檢驗產品裡，不乏有許多不同
地紋路、高低起伏、顏色等其它特性附著於不同檢測
表面上；依本研究所檢測樣本光學 LED 透鏡為例，
其表面具不規則紋路、光線反射及本體具透明特性等
問題，當瑕疵產生時，易發生瑕疵重疊、低對比等問
題，使影像在拍攝上較為困難，且當背景具紋路結構
時，依以往使用頻率域或空間域的方式移除紋路，易
造成瑕疵同時被移除，而要使檢測結果達到要求，則
必須先克服上述的幾項難題。因此，本研究將提出以
WPT 搭配使用 PLS，於具表面紋路之光學元件的可
視瑕疵檢測上，本研究實驗樣本如圖 1 所示。因此，
本文主體首先介紹 WPT 在以往研究上的使用方式及
特色；其次，說明 PLS 演算過程及適用於本研究待
測樣本之方法特性；最後，比較空間域與頻率域中不
同方法間的檢測結果。 
 
 
(a) 實驗樣本外觀 (b) 表面拍攝影像 
圖 1 本研究待測樣本外觀及表面擷取影像 
 
2. 文獻探討 
本研究將以 WPT 及多變量方法中的 PLS 針對具
紋路表面之光學元件進行瑕疵檢測，以下針對此方法
對於過去的研究進行探討。 
2.1 頻率域之小波轉換 
過去紋路分析及瑕疵檢測研究領域中，可以常用
的方法包括共發矩陣(Co-occurrence matrix)、傅立葉
轉 換 (Fourier transform, FT) 、 賈 伯 轉 換 (Gabor 
transform, GT) 、 離 散 餘 弦 轉 換 (Discrete cosine 
transform, DCT)及小波轉換等；而小波轉換(Wavelets 
transform, WT)的應用一般而言大多使用於訊號的處
理上，近來被廣泛地應用於影像紋路影像的處理中，
Kim 和 Kang [8]提出以高斯矩陣為基，使用小波包
分解於紋路分類與邊緣的檢測上，同時可將影像中，
數種不同紋路分別地區別外，並將方法試行於不規則
紋路之瑕疵檢測上。Han 和 Shi [4]使用小波轉換於高
度週期性背景之表面瑕疵檢測上，並使用共發矩陣於
小波轉換階數之選擇，可完整地移除背景紋路的影
響。Tsai 和 Chiang [14]更進一步使用熵資訊理論為
基，進行自動選擇小波轉換之子區塊的方式，並決定
刪除或保留其子區塊，於隨機與規則紋路之表面瑕疵
檢則，待測物為生活中常見紡織品等。因此，本研究
將進一步地提出使用多變量分析中變數精簡的方
式，來選擇小波特徵中，對於紋路表示的重要資訊。 
  16
在瑕疵檢測時，必須先透過參數訓練來獲得潛伏
向量(w)與迴歸估計參數(b)二組瑕疵檢測參數；因此
在參數訓練時，首先，使用 WPT 為基之頻率域轉換，
對正常影像進行特徵值(X)擷取；第二，再以 PLS 對
正常影像之小波包特徵計算對應之潛伏向量(w)，構
成潛伏影像(t)並取代小波包特徵值；最後，以潛伏影
像對正常影像進行 MLR 之模型配適，獲得迴歸估計
參數(b)，並結束整個參數訓練流程；而訓練與瑕疵檢
測模式最大的不同，在於瑕疵檢測流程中潛伏向量與
迴歸估計參數是由參數訓練模式所獲得，在實際檢測
上，不須使用 PLS 與複迴歸法 (Multiple Linear 
Regression, MLR)進行計算，因此可以有效地提升瑕
疵檢測的執行時間。 
 
3.1 影像前處理 
常見地視覺檢測系統所拍攝的區域絕大部份屬
於平面產品，因此所檢測的範圍皆為整張影像，而本
研究之待測物為光學 LED 透鏡，所拍攝之影像包含
了透鏡本體與其它區域；所以在進行 WPT 前，需消
除非目標物區域產生之干擾。 
以本研究測試樣本為例，如圖 3(a)所示，使用
Otsu [12]進行影像二值化，並計算影像重心，如圖 3(b)
所示，檢測區域設定為重心區域半徑之 200 像素內，
並產生相對應之影像遮照與原始影像進行對照，並以
偵測區域之平均值灰階值填至刪除區域中，如圖 3(c)
與圖 3(d)所示，即完成檢測區域的選取。 
 
 
圖 3 光學透鏡之檢測前處理流程；(a)原始影像；(b)
影像二值化並計算影像重心；(c)產生對應遮照；(d)
選取偵測區域。 
 
3.2 小波包轉換(WPT) 
本研究使用 WPT 進行特徵值擷取其目的有三；
第一，在影像特徵擷取方法上，使用速度較快的 Haar
基底函數進行 WPT，在包括瑕疵之待測影像進行轉
換後，所獲取的細徵特徵中，其瑕疵的細微特徵與正
常影像的細微特徵差異會最大[13]，並搭配 WPT 本
身具多重解析能力[1]進行特徵值擷取，因此以 Haar
基底對 WPT 含紋路背景之待測影像進行瑕疵檢測是
非常適合地；第二，WPT 是 WT 的延伸，而 WT 只
分解低頻影像，WPT 則會分解高頻及低頻影像，具
有較佳的頻率解析能力[1]，不過在進行後續多變量處
理時，會產生更多的變數維度，因待測物之背景紋路
屬較複雜的非等向性紋路，故借助 WPT 多重解析的
能力，進行特徵值擷取是有助益的；第三，針對具紋
路背景之待測影像進行瑕疵檢測，若發生許多來自紋
路且非瑕疵的干擾，當進行 WPT 時，轉換後特徵影
像會隨著轉換階數(J)的增加，來獲得到更佳程度的平
滑效果[4]；若轉換階數過高時，WPT 之細微特徵維
度也隨著 2 的冪次方大量增加，而過度平滑會使細微
的瑕疵在檢測前就被忽略。 
 
因此本研究提出使用多變量分析中常見的
PLS，進行小波特徵維度的精簡，並消除潛伏影像間
的相關性，確保後續複迴歸分析過程中，擁有最佳的
配適效果。 
 
3.3 部份最小平方法(PLS) 
使用 PLS 在求算小波特徵之潛伏影像時，由於
考慮正常影像(Y)的資訊，能以較少的潛伏影像數
量，即可達到預期的配適結果[16]；而經 PLS 求算後
的潛伏影像並非所有都具有影響力，而資料也不可能
毫無干擾，因此特徵值(Eigen-value)小的成份除了預
期能力不足外，還可能代表干擾因子[2]。而 PLS 演
算上，當輸入的反應變數屬單一或多個維度時，必須
分別地選擇 PLS1 或 PLS2 其一模式進行演算，而本
研究在參數訓練時，使用正常影像之灰階值，作為小
波包特徵之反應變數，為單一的反應變數，因此在
PLS 的計算上，選用 PLS1 [11]模式進行訓練參數的
估算，其演算法過程如下可分為 10 個步驟： 
 
(1) 計算維度之設定 
進行 J 次小波包轉換，並將小波包特徵值進行正
規化，可獲得 a 個小波包特徵子區塊，其預測變
數(X)維度為 n×a，反應變數維度(Y)為 n×1。 
(2) 令 h=0， )1,()1,()1,( nUnFnY hh ==  
(3) 令 ),(),( anEanX h=  
  18
並無法完全地對結果(依變數, Y)進行配適；如表 3
所示，將 1階 WPT 之小波特徵分別地以 PLS 與 PCR 進
行變數轉換，求算其新變數解釋能力百分比進行比
較，PLS 結果顯示，小波特徵與正常影像之間，計算
時以充分地進行相互疊代與計算，並在計算過程中，
移除無法對正常影像配適之小波特徵，最後並留下無
法解釋的部份，因此，沒有一個潛伏影像是缺乏預測
能力的[9]；因此，PLS 取得的潛伏影像雖然對原始
小波特徵解釋力有所下降，但確提升了對正常影像中
背景紋路的配適能力，使得在移除待測影像中紋路背
景能力更有所提升，故選取全部的潛伏影像也無法達
到解釋力 100%。相反地，PCR 重視的是萃取後的主成
份對於原始變數的解釋程度，並不能表示可以提升配
適能力。 
 
表 3 PLS 與 PCR 之新變數特徵值與解釋力 
轉換 
變數 
PCR PLS 
特徵值 
原始 
變數之解
釋力(%)
特徵值 
原始
變數之解
釋力(%)
S1 2.28  57.0  2.08  15.9 
S2 0.72  17.9  0.58  14.6 
S3 0.55  13.7  0.60  15.1  
S4 0.45  11.3  0 (無法解釋殘差) 
 
由表 3可以得知，PLS 所求得的潛伏影像，對原
始小波包特徵之解釋力為 81.5%，無法解釋之殘差對
原變數解釋力為 18.5%，因此可以清楚得知，當無法
解釋的比重過高時，反應了幾個問題；其一，特徵值
(X)可能擷取不當；其次，影像本身紋路過於複雜，
使之配適能力下降；最後，訓練用的正常影像與待測
影像差異過大或拍攝不當，以上問題對檢測結果的影
響都是非常重要。 
經以上對 WPT 與 PLS 等特性進行探討後，將實際
的對PLS等不同設定參數及常用的PCR進行分析及比
較。本研究之以 WPT 之 PLS 對具紋路表面之光學元件
進行可視瑕疵之檢測流程，合稱為 WPLS，後續將同
時與 PCR 進行比較，合稱為 WPCR，完整地 WPLS 檢測
過程如圖 5所示。 
 
圖5 以小波包轉換為基之部份最小平方迴歸法(WPLS)
進行光學元件可視瑕疵檢測完整流程 
 
4. 實驗與結果 
在實例驗證實驗方面，本研究自行開發一套以
WPT 為基之搭配 PLS 進行影像轉換，並對具紋路背
景之光學元件進行可視瑕疵的檢測，分別選定 32 張
具瑕疵之光學 LED 透鏡及 3 張正常影像進行瑕疵檢
測與參數訓練，對本研究所提出的方法進行驗證。 
硬體設備與程式開發方面，本研究採用 C++ 
Build 6.0 進行程式編碼，並在實驗室環境底下進行拍
攝，使用數位 USB CCD 與紅色 LED 正向環型光源
進行取像與照明，將影像傳輸至個人電腦進行瑕疵檢
測，其操作介面與硬體設備如圖 6、圖 7 所示。 
 
 
圖 6 本研究所開發之操作軟體介面 
 
4.1 瑕疵檢測之效益評估指標 
本計畫在對瑕疵檢測的效益評估上，使用在視覺
  20
量非常龐大的 LED 透鏡而言，本方法較其它空間域
方法適用於線上的即時檢測上；最後，由於 PLS 是
由 PCR 的觀念發展而來[16, 17]，故同時將 PCR 方法
結合 WPT，稱為 WPCR 模式，同時進行檢測結果的
比較，因為 WPCR 在變數的轉換上，單純地以共變
異矩陣(Correlation matrix)進行轉換向量的求算，無考
慮到原始影像的關聯，因此無法達到 WPLS 相同的配
適結果，檢測結果可以清楚得知，WPLS 顯然有較高
的檢出率及較低的誤判率。 
 
表 4 WPLS 與 WPCR 檢測結果比較表 
平均檢 
測結果(n=32) 
α 
(%) 
1-β 
(%) 
CR 
(%) 
Time
(ms)
空間域
Otsu [12] 4.4 93.6 95.6 60 
Iterrative [6] 16.3 99.1 83.9 52 
頻率域
 
DCT-Cusum [9] 3.2 44.3 96.3 1390
DCT-Gray [10] 0.1 80.7 99.8 625 
WPCR 1.2 78.5 98.6 165 
WPLS 0.1 97.9 99.9 163 
 
5. 結論 
本研究提出使用以WPT為基並搭配PLS進行具紋
路背景之光學 LED 透鏡的可視瑕疵偵測，再以交叉驗
證法進行最佳配適之潛伏影像的選擇，使小波特徵值
對於紋路背景的配適達到最佳的配適能力，將紋路背
景對於瑕疵檢測的影響盡可能地將其降低，來達到最
佳的瑕疵偵測率。結果顯示，瑕疵檢出率達 97.9%，
誤判率僅 0.1%，並將時間縮短至 163 毫秒，比較後，
效益皆較以為方法獲得大幅度的改善。 
雖然本研究所提出的方法有不錯的瑕疵偵測效
果，但還是有許多可以進步與改善的空間： 
(一) 更多的表面檢測範圍 
本研究所拍攝之 LED 透鏡由於本身的光學特
性，導致表面外環區域產生與中心區域不同的反射結
果，導致無法進行檢測，對於檢測的重要性而言，從
中心點開始漸向外逐漸下降。因此，本研究先從中心
向外，檢測了整個 LED 透鏡 80%的表面區域，未來可
以嘗試使用不同補助光源來改善此狀況。 
(二) 使用不同多變量分析技術  
目前常用的多變量方法不外乎是 PCA、PLS、BPN
等，未來可嘗試使用不同多變量方法進行比較，如糢
糊理論…等其它方法。 
(三) 檢測不同紋路結構 
實際上，不同的產品存在著許多不同的紋路背
景，未來可以嘗試檢測更多不同背景的紋路影像，來
提升本研究方法的價值。 
 
參考文獻 
[1] Coifman, R. R., M. V. Wickerhauser, 
“Entropy-Bases algorithms for best basis 
selection,” IEEE Trans. Information Theory, 
Vol.38, No.2, pp.713-718, 1992. 
[2] Geladi, P., B. R. Kowalski, “Partial least squares 
regression: a tutorial,” Analytica chimica acta, 
Vol.185, pp.1-17, 1986. 
[3] Gnanadesikan, “Methods for statistical data 
analysis of multivariate Observations 2nd ed,” 
Wiley, New York, pp.46-61, 1997. 
[4] Han, Y., P. Shi, “An adaptive level-selecting 
wavelet transform for texture defect detection,” 
Image and Vision Computing, Vol.25, 
pp.1239-1248, 2007. 
[5] Hsu, Y.H., B. J. Kuo, “The study on the partial 
least squares regression , principal component 
regression, and neural network to analysis the 
near-infrared spectrum data,” National 
Chung-Hsing University Department of Agronomy, 
Master thesis, 2003. 
[6] Jain, Ramesh, and R. Kasturi, and B. G. Schunck, 
Machine Vision International Editions, New York, 
NY, Mcgraw Hill 76-86, 1995. 
[7] Kaiser, H. F., “The Application of Electronic 
Computers to Factor Analysis,” Educational and 
Psychological Measurement, Vol.20, No.1, 
pp.141-151, 1960. 
[8] Kim, S. C., T. J. Kang, “Texture classification and 
segmentation using wavelet packet frame and 
Gaussian mixture model”, Pattern Recognition, 
Vol.40, pp.1207-1221, 2007.  
  22
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
第三年計畫成果 
 
 
 
 
 
 
 
 
 
 
 
  24
轉折點以決定最佳切割扇形半徑，去除頻譜扇形半徑
區域內的能量後在還原至空間域，將 SBL 半導性瓷
片之針孔瑕疵偵測出來。張宏佐[13]在瓷漿被遮蓋電
極檢測方面，提供一影像補償方法來改善基層電容濕
式製程中一值無法有效監控製程的問題，並利用檢測
硬刷電銀鈀電極之特徵分析法確實比一般比對法的
檢測能力高，而又利用累和管制圖進行偏移的檢測可
提升至 100%的檢測效果。 
接著在模糊理論方面，Ko [3]等學者提出以模糊
規則為基底和類神經網路的方法來進行表面黏著點
外觀檢測的系統模組。Heikkinen [1]等人利用模糊邏
輯分類法進行 PCB 錫角的瑕疵分類。Yao [10]等學者
提出包含切削條件與檢測訊號的刀具磨損檢測方
法，主要利用聽覺訊號與馬達電流的模糊分類方式，
架構凌波模糊類神經網路(Wavelet fuzzy network)，藉
由刀具磨損的訊號與切削的條件進行模糊推論，結果
可準確提高刀具磨損檢測的可靠度。陳育洺[12]提出
以模糊推論系統來針對表層障蔽型半導性瓷片(SBL)
之跳蛋、反應以及火山口三種表面瑕疵進行瑕疵分
類。 
綜觀上述相關文獻探討，本研究將使用傅立葉轉
換搭配累和管制法以及模糊推論系統與統計相關係
數等方法，達到瑕疵偵測與瑕疵發生位置之正反面判
斷之目的。 
 
3. 研究方法 
本研究藉由機器視覺之技術來檢測透明玻璃是
否有瑕疵存在，並且將瑕疵之正反面判斷出來，其步
驟可分為兩個階段，第一階段為瑕疵偵測，主要是將
玻璃瑕疵由背景中分離出來，第二階段則是瑕疵分
類，主要是針對瑕疵影像依瑕疵特徵將其分類為正面
或反面瑕疵，其流程如圖 1 所示。 
 
3.1 玻璃可視瑕疵偵測 
本研究在瑕疵偵測部份先將對焦中間之待測影
像進行影像反向之前處理將影像強化，再使用傅立葉
正轉，利用累和管制法尋找適當之刪除半徑，將瑕疵
貢獻最多的頻率區域保留，並去除區域內的頻率值，
再經由反傅立葉轉換處理後將背景濾除，將瑕疵資訊
有效地保留於影像中，最後使用 μ+kσ 將影像二值
化，將瑕疵從影像中凸顯出來。 
 
圖 1.  本研究之整體研究流程圖 
 
3.1.1 影像前處理與二維傅立葉正轉換 
由於本研究之待測影像包含較細微刮傷瑕疵與
背景對比度較低，瑕疵本身為較黑之顏色，為了突顯
細微瑕疵，因此本研究首先將待測影像進行影像反
相，目的為將瑕疵與背景對比增強，以達到瑕疵強化
之作用。 
由於傅立葉轉換擁有可以將雜訊干擾降低、增強
週期性的特徵與保存方向性等特性，因此本研究將利
用傅立葉轉換進行透明平面玻璃之可視瑕疵進行偵
測。本研究所輸入之待測影像皆為 MM × 大小的二維
影像，影像中座標 ),( yx 經影像強化後之灰階值為
),( yxge ，其中 1−=j ，u,v 為頻率變數，因此傅立
葉正轉換(Fourier transform)為： 
[ ]∑ ∑
−= −=
+−⋅=
2
2
2
2
2
//(2exp),(1),(
M
Mx
M
My
e MvyMuxjyxg
M
vuF π (1)
然而二維傅立葉轉換是複數函數，即： 
),(),(),( vuIjvuRvuF ⋅+=  (2)
其中 ),( vuR 和 ),( vuI 分別是 ),( vuF 的實部(Real)和
虛部(Imaginary)： 
[ ]∑ ∑
−= −=
+⋅=
2
2
2
2
/)(2cos),(),(
M
Mx
M
My
e MvyuxyxgvuR π (3)
[ ]∑ ∑
−= −=
+⋅=
2
2
2
2
/)(2sin),(),(
M
Mx
M
My
e MvyuxyxgvuI π  (4)
因 此 二 維 離 散 函 數 的 傅 立 葉 功 率 譜 (Power 
spectrum) ),( vuP 為： 
),(2),(2),( vuIvuRvuP +=  (5)
  26
值化分割，其中T 為分離瑕疵與背景之閥值，k 為標
準差之倍數，其二值化公式如下： 
00 σμ kT +=  (14)
因此經由閥值 T 切割後便可得到新的灰階值
),(' yxf ，將其定義為式子(15)，其中 0),(' =yxg 表示
),( yx 為瑕疵，而 255),(' =yxg 則表示 ),( yx 為背景。 
⎩⎨
⎧ +≤=
otherwise
kyxgif
yxg t
    0
),(          552
),(' 00
σμ  (15)
 
3.2 瑕疵發生位置之正反面判斷 
在瑕疵發生位置之正反面判斷部份，因二值化後
影像所顯示的瑕疵會有斷裂情況，因此先導入形態學
的膨脹(Dilation)與侵蝕(Erosion) 將瑕疵斷裂處填補
起來，並利用標籤化(Labeling)進行區塊編號，接著
分別對無瑕疵與對焦正面及反面之瑕疵影像選取每
塊標籤內之灰階值，計算其區塊內之平均灰階值以及
標準差，利用模糊推論法與相關係數法判斷瑕疵為正
面或反面，其判斷流程如圖 4 所示。 
 
圖 4.  本研究所提瑕疵正反面判斷流程圖 
 
3.2.1 影像特徵值之擷取 
本研究所使用之特徵值計算方法包含灰階平均
值以及灰階標準差。利用標籤化將對焦正面與對焦反
面影像做區塊選取及編號，經過區塊選取後，對焦正
面與對焦反面之對應位置皆相同，如此便可以將瑕疵
位置正確選取，由於本研究利用對焦不同之方式取
像，因此對焦正面與對焦反面之瑕疵會有灰階差異之
特性。 
在灰階平均值之計算方面，選取對焦正面與對焦
反面之相同編號區塊，分別計算每個區塊之灰階平均
值，重覆此步驟將所有區塊之灰階平均值計算出來。
令 aijμ 及 bijμ 為對焦正面與對焦反面之待測影像經過
區塊選取後之每個區塊的灰階平均值，其定義分別如
下： 
∑
∑
=
=
),(1
),(1
yxg
n
yxg
n
bij
ij
bij
aij
ij
aij
μ
μ  
(16)
其中 ),( yxg aij 和 ),( yxgbij 分別代表對焦中間與對焦
反面之影像中像素點在座標 ),( yx 上的灰階值， i 為
待測樣本之編號， j 則表示樣本上區塊之編號，而 ijn
表示第 i 個樣本上第 j 個區塊之總 pixel 數。而由於對
焦正面與對焦反面之瑕疵具有灰階差異，因此在此將
對焦正面與反面每個相同樣本區塊之灰階平均值相
減( ij'μ )作為模糊推論系統之輸入值： 
bijaijij μμμ −='  (17)
而另一個特徵輸入值灰階標準差之計算方面，標
準差主要用來衡量灰階影像資料的變異情形，數值較
大則表示影像資料的分佈較分散，因此同樣計算對焦
正面及對焦反面之標準差，故每個樣本上相同編號的
區塊會得到兩個標準差( aijσ 與 bijσ )，利用兩個標準
差相減即得到另一個模糊推論之輸入值 ij'σ ，其計算
如下： 
1
])),(([),(
1
])),(([),(
22
22
−
−=
−
−=
∑∑
∑∑
ij
ijbijbij
bij
ij
ijaijaij
aij
n
nyxgyxg
n
nyxgyxg
σ
σ
 (18)
bijaijij σσσ −='  (19)
圖 5 為本研究影像特徵值計算之示意圖，利用經
標籤化後的二值化影像分別在對焦正面與對焦反面
之原始影像上擷取其對應的區塊，接著對每一相同編
號之區塊(如框選處)計算灰階平均值以及標準差。 
 
 
圖 5.  影像特徵值計算之示意圖 
 
3.2.2 以模糊推論系統法判斷正反面瑕疵 
本研究利用對焦不同來區別正反面，因此正反面
  28
機、照明設備、XYZ 控制平台以及個人電腦所組成；
而在軟體程式方面，本研究除了以 Borland C++ 
Builder 6.0 作為程式開發的工具，另外使用 MATLAB
作為模糊推論使用之軟體。為了了解本研究所提方法
之效果，將針對 30 個瑕疵嚴重程度不一且正反面瑕
疵分佈也不一的玻璃樣本進行結果分析，並且討論本
研究所建構系統之瑕疵偵測結果、瑕疵發生位置之正
反面判斷與限制。 
 
4.1 瑕疵檢測之效益評估指標 
本研究以傅立葉轉換搭配累合管制法尋找適當
刪除半徑以達瑕疵偵測之目的。而在瑕疵效益評估指
標方面，以瑕疵檢出率(1-β)、正常區物判率(α)與偵
測正確率作為績效指標。表 3 為不同 k 值對本研究
30 張待測影像之平均 1-β及 α的影響，而 k 之範圍由
4 至 6，每隔 0.5 取一次 k 值，探討 k 對 1-β及 α之影
響。由於本研究期望於 90%以上，且 α不能太高，故
本研究將 k 值設定為 4.5，而 1-β與 α分別為 92.66%
及 0.18%，在較低對比之瑕疵上，仍有部份是無法偵
測出來的，其部分樣本之偵測結果如圖 7 所示。 
 
表 3.  不同 k 值對(1-β)與 α之影響 
k 4 4.5 5 5.5 6 
1-β 
(%) 0.44 0.18 0.14 0.07 0.06
α (%) 95.78 
92.6
6 
92.0
2 
87.9
7 
87.0
9 
 
4.2 瑕疵正反面判斷之效益評估 
本研究利用模糊推論與相關係數法兩種方法來
進行瑕疵正反面之判斷，在模糊推論方面，假設平均
灰階差為-0.333，灰階標準差之差為 0.268 來進行
Max-min 的運算，得到每一條規則之歸屬函數對應至
輸出項( dO )的面積值，再以聯集的運算方式便可推論
出此 5 條規則之輸出結果分佈情形，最後經解模糊化
則可得到明確輸出值為 1.49，因此推論出來此瑕疵為
無瑕疵。 
本研究之 30 個待測樣本經過標籤化處理後共產
生 496 個區塊，其中正面區塊有 98 個，反面有 180
個，無瑕疵區塊有 218 個，其利用兩種方法之判斷區
塊分配表如表 4 所示，其中左欄為相關係數判斷結
果，右欄為 Fuzzy 判斷結果。而在正反面判斷的效益
評估指標方面，本研究使用瑕疵分類型 I 誤差( 'α )、
瑕疵分類型 II 誤差( 'β )、分類正確率( 'CR )、真實瑕
疵分錯瑕疵類別率( 'γ )作為績效指標。 
表 4.  模糊推論與相關係數之瑕疵區塊判斷表 
   判斷類別
 
實際類別     
正面瑕疵 反面瑕疵 無瑕疵 
相關
係數
模糊
推論
相關
係數 
模糊
推論 
相關
係數
模糊
推論
正面瑕疵 92 98 4 0 2 0 
反面瑕疵 13 0 163 160 4 20 
無瑕疵 11 16 14 2 193 200
因此兩個方法之績效評估如表 5。部分瑕疵樣本
之偵測結果與瑕疵發生位置之正反面判斷結果如圖 7
所示。 
表 5.  正反面瑕疵判斷之績效表 
 'α (%)  'β (%) 'CR (%) 'γ (%) 
相關係數法 11.47 2.15 90.32 6.8 
模糊推論法 8.25 7.19 92.34 0 
本研究所提方法所遭遇到之問題以及研究的範
圍限制說明如下： 
 
1. 由於本研究利用形態學之標籤化來進行瑕疵編
號，若正反面瑕疵有交叉重疊時，其導致標籤化
時將其編成相同之編號，如此便無法正確的將正
反面瑕疵正確的判斷出來，進而造成誤判的存
在，因此本研究之實驗樣本暫不考慮正反面瑕疵
有重疊與交叉之情形 
2. 當瑕疵影像經瑕疵偵測後之二值化瑕疵面積小
於 2 pixel 時，所計算出來的影像特徵值較不客觀
且較不具代表性，因此不列入正反面瑕疵判斷的
考慮範圍。 
3. 在待測物之厚度方面，本研究最薄與最厚之玻璃
厚度分別為 0.55 與 10mm，而利用本研究所提出
的拍攝方法可將正反面瑕疵拍攝出來。 
 
5. 結論 
本研究針對透明平面玻璃之瑕疵檢測提出利用
傅立葉轉換搭配累和管制法選取適當的刪除半徑，並
將半徑內的頻率值刪除且反轉回空間域，且以簡單的
管制界線法進行切割以達到瑕疵偵測之目的，接著以
形態學及標籤化進行區塊選取並計算區塊內之影像
特徵值，最後利用模糊推論及相關係數兩種方法進行
  30
Construction of Automated Visual 
Defect Inspection System for Optical 
Components 
 
Hong-Dar Lin 
Department of Industrial Engineering and 
Management, 
Chaoyang University of Technology,  
Wufong District, Taichung, 41349, Taiwan. 
Abstract  
It is important to detect glass defects and determine 
the defect locations in the front or reverse side because 
the glasses have transparent characteristic and some 
industrial applications of high precision requirements 
usually rivet on one specific side of the glasses, so the 
inspection standards of the visual defects for the front 
and reverse sides are different. This research explores 
the automated glass defect detection and determinations 
of the defects located on the front or reverse side of the 
glasses. 
In this research we first use the Fourier transform 
and cumulative sum algorithm to choose adequate 
cutting radius and remove the frequency values within 
the selected radius. After the frequency components are 
removed, the frequency domain image is transferred 
back to the spatial domain and a simple threshold 
method can be used to separate the background and the 
defects. Then, we use morphology techniques to do 
binary image processing, detect the suspected areas, 
and extract image features of the suspected 
areas. Finally, we apply, respectively, fuzzy inference 
approach and correlation method to determine the defect 
locations whether on the front or the reverse side. 
Experimental results demonstrate the proposed method 
achieves 92.66% probability of accurately detecting the 
defects on glasses and the probability of accurately 
classifying the defect location which is on the front or 
reverse side are 92.34% and 90.32%, respectively.   
 
Keywords：Defect detection，Defect position 
determination，Fourier transform，
Cumulative sum algorithm，Fuzzy 
Inference，Correlation.   
 
 
表 Y04 
一、 參加會議經過 
2011 International Conference on Image Processing, Computer Vision, and Pattern 
Recognition (IPCV-2011) 2011年影像處理、電腦視覺、與圖像識別國際研討會議在美國(USA)
之拉斯維加市蒙地卡羅旅館(Monte Carlo Resort, Las Vegas city)舉辦，由世界科學學會(World 
Academy of Science)組織主辦，從100年7月18日起至7月21日止，為期四天。IPCV-2011國際研
討會與其他多個與電腦技術與應用相關之國際研討會同時舉行，統稱為電腦科學、電腦工程、
與應用計算國際研討會(The 2011 World Congress in Computer Science, Computer Engineering, 
and Applied Computing; WORLDCOMP'11)為資訊相關領域每年重要之研討會，今年IPCV研討
會參與投稿之論文篇數接近四百篇，參與之學者亦超過500多人（來自世界50餘國），來自台
灣的教授與學生亦不在少數，且有逐漸增加的趨勢。參與此類研討會不僅可吸收最新之資訊
科學與工程及相關領域之研究，而且可與來自世界各國之眾多學者交流，亦為國民外交之最
佳表現。而此研討會之主辦單位是專業的科學及工程學會，是國際知名且權威的學術研究學
會，發行相當多的國際知名期刊並收錄在EI中。此次研討會之口頭發表之論文(regular papers)
接受率為24%，張貼發表之論文(poster papers)接受率為18%。 
 
本次會議共計4天，IPCV-2011今年選定的會議主題包含最新之影像處理、電腦視覺、立
體視覺、與圖像識別等相關主題：例如Image database, Data hiding, Image copyright, Face 
recognition, 3D and depth computation, Video and multimedia, Stereo and Imaging Science, 
Surveillance, Biometrics, Inspection, Compression methods, Target and object tracking, 
Recognition techniques, Motion and orientation estimation, Novel applications等，會議內容之學術
領域差異頗大且許多議程同時進行，無法一一參與，因此縮小可參與議程之範圍，僅參與跟
自身研究相關領域之議程。 
 
會議地點在拉斯維加市的Monte Carlo Resort Hoel進行，此旅館之環境設備相當不錯，讓
與會人士能在舒適的開會環境中進行學術交流。本次會議型式包括5個 Plenary speeches by 
world-renown scholars； 7個 Parallel sessions of oral presentations (Novel algorithms and 
applications, Image database, Face recognition, Video and multimedia, Stereo and imaging science, 
Compression methods, Recognition techniques, Motion and orientation estimation)，以多樣式的學
術交流方式，讓參與者除了能從學術文章發表的議程中瞭解他人研究成果，而且透過由研究
極有成就之學者與專家擔任的演講及討論，將最新的研究議題之內容與進度做一精闢的論
述，內容相當豐富。   
 
筆者此次所發表的論文安排在第二天口頭發表(Oral presentation)的Stereo and Imaging 
Science, 3D and Depth Computation, Novel Algorithms and Applications 場次，因大會安排得
宜，此場次所發表之論文性質極為接近。此次筆者所發表的論文題目為「應用電腦視覺於發
光二極體透鏡之自動化工業檢驗」，本研究提出以各獨立小區塊為單位進行區塊離散餘弦轉換
( Block Discrete Cosine Transform；BDCT )，擷取DCT轉換之特徵值，以降低影像灰階值漸層
Automated Industrial Inspection of Optical Lenses 
Using Computer Vision 
 
Hong-Dar Lin1, Wan-Ting Lin2, and Huan-Hua Tsai1 
1Department of Industrial Engineering and Management, Chaoyang University of Technology, 
Taichung, 41349, Taiwan 
2Department of Marketing, Mays Business School, Texas A&M University,  
College Station, TX 77843, USA 
 
 
Abstract – An LED (Light-Emitting Diode) lens with a 
transparent and curved surface is more difficult to detect 
surface defects than electronic components by current 
computer vision systems.  The purpose of this research is to 
apply the block discrete cosine transform (BDCT), Hotelling 
2T  statistic, and grey clustering method to detect visual 
defects of LED lenses.  An image with equal sized blocks is 
converted to DCT domain and some representative energy 
features of each DCT block are extracted.  These energy 
features of each block are integrated by the 2T  statistic and 
the suspected defect blocks can be determined by the 
multivariate statistical method.  Then, the grey clustering 
algorithm is conducted to further confirm the block locations 
of the real defects.  Finally, a simple segmentation method is 
applied to separate the defect areas.  Experimental results 
demonstrate the defect detection rate of the proposed method 
is better than those of current techniques.   
Keywords: Industrial inspection; optical lens; computer 
vision system; block discrete cosine transform; 2T  statistic; 
grey clustering.   
1 Introduction 
  A lens is an optical device with perfect or approximate 
axial symmetry which transmits and refracts light, converging 
or diverging the beam.  Lenses are typically made of glass or 
transparent plastic.  Optical lenses are transparent 
components made from optical-quality materials and curved 
to converge or diverge transmitted rays from an object.  
These rays then form a real or virtual image of the object.  
There are many types of optical lenses. Optical lenses are 
widely used in cell phone, notebooks, automotive, digital 
camera, light-emitting diode (LED) etc.     
 An LED is a semiconductor device that emits visible 
light when an electric current passes through the 
semiconductor chip.  Compared with incandescent and 
fluorescent illuminating devices, LEDs have lower power 
requirement, higher efficiency, and longer lifetime.  Typical 
applications of LED components include indicator lights, 
LCD panel backlighting, fiber optic data transmission, etc.  
To meet consumer and industry needs, LED products are 
being made in smaller sizes, which increase difficulties of 
product inspection.  The functions of LED lenses include 
focusing, beauty, and protection to avoid the waste of light 
and light pollution.  An LED without the assistance of lens 
focus function cannot project light to far distance.  Therefore, 
LED lenses are invented to improve the light scattering 
problems of LEDs and they are widely applied to hand 
flashlights and traffic lights applications.   
 Lens inspection requires special physical conditions, 
particularly in terms of lighting.  In the real working situation, 
each inspected lens is brought into the inspector’s field of 
vision.  The lenses are round and transparent; the defect to be 
inspected could be located on the external surface of the 
lenses or inside.  A lens presents a certain thickness and a 
certain curvature, both of which vary.  At times, lenses 
provide the same perceptive result as a magnifying glass, and 
the defects are all the more difficult to track down and to 
locate in the area of the lens.  The majority of defects are not 
only very small but also they are extremely diverse and can 
assume various forms.  Figure 1 shows LED lenses with 
visual defects.   
 
 
Figure 1  LED lenses with visual defects (a) LED lens with 
dirt defects; (b) LED lens with scratch and pinhole defects. 
 Currently, the most common detection methods for LED 
lens defects are human visual inspection.  Human visual 
inspection is tedious, time-consuming and highly dependent 
on the inspectors’ experiences, conditions, or moods. 
Erroneous judgments are easily made because of inspectors’ 
subjectivity and eye fatigues.  Difficulties exist in precisely 
330 Int'l Conf. IP, Comp, Vision, and Pattern Recognition |  IPCV'11 |
overlapping image blocks of equal size which can be 
conducted DCT individually instead of taking one transform 
on an entire image.   
 Eq.(1) gives the expression for computing the BDCT of 
a digital image ,x yd  of block size P x Q.  This expression 
must be computed for all values of u =0, 1, 2, …, P-1, and 
also for all values of v=0, 1, 2, …, Q-1.  While u and v are 
frequency variables, x and y are spatial variables.   
11
, ,
0 0
(2 1) (2 1)( ) ( ) cos cos
2 2
QP
u v x y
x y
x u y vD u v d
P Q
π πρ ρ −−
= =
⎡ ⎤+ +⎡ ⎤= ⎢ ⎥⎢ ⎥⎣ ⎦ ⎣ ⎦∑∑ .      (1) 
where 
11 , 0, 0
( ) , ( ) ,
2 2, 1,2,3,..., 1 , 1, 2,3,..., 1
vu QPu v
u P v Q
P Q
ρ ρ
⎧⎧      =⎪     =⎪⎪ ⎪=     =       ⎨ ⎨⎪ ⎪     = −      = −⎪ ⎪⎩ ⎩
 
0,1,2,3,..., 1
0,1, 2,3,..., 1
0,1,2,3,..., 1
0,1, 2,3,..., 1
u P
v Q
x P
y Q
= −⎧⎪ = −⎪ ⎨ = −⎪⎪ = −⎩
 
The power spectrum P(u, v) of image ,x yd  is defined as: 
2
,( , ) u vP u v D=                                    (2) 
That is, the sum of the squares of the DCT coefficients is the 
energy of the block.   
 As the origin of the BDCT coefficients has a very huge 
frequency component, it is sometimes called the Direct 
Current (DC) component of the BDCT frequency domain, 
while other coefficients are called the Alternating Current 
(AC) components.  The DC coefficients in the upper left 
corner reflect information of lower frequencies, whereas the 
AC coefficients in the lower right corner reflect that of higher 
frequencies.  BDCT has the property of concentrating the 
dominant energy of a typical image in the low-frequency 
components.  This means that the coefficients of the high-
frequency components are close to zero, and therefore 
negligible in most cases [16].   
 The 2-D and 3-D BDCT spectrum diagrams of an LED 
lens image in Figure 2(b) and (c) show that a lot of energy 
concentrates in the origin (u=0, v=0) and that the energy 
decreases gradually from the origin and the low frequency 
zone on the top-left side to the high frequency zone on the 
bottom-right side.  In the BDCT domain, the tiny and low-
contrast defects are not only significantly enhanced but also 
the gradually changing intensity levels of defects are removed.   
 The edge pattern in a block can be fully captured from 
its DCT coefficients in frequency domain [17].  The energy 
distribution in the DCT domain determines the edge patterns 
in the spatial block.  One way of determining the features in 
the spatial block is by looking into the energy distribution in 
the 2D-DCT domain [18].  The energy concentrated in top 
horizontal region represents vertical edges in the block; the 
energy concentrated in left vertical region indicates horizontal 
edges in the block; and the energy concentrated in diagonal 
region implies diagonal edges in the block.   
 
Figure 2  Examples of the BDCT transformation (a) an LED 
lens image with visual defects; (b) the 2-D BDCT spectrum 
image; (c) the power spectra in 3-D perspective   
 Five energy features of a BDCT are expressed as 
follows:   
( )
1/ 2-1-1
2 2
,
0 0
1 0
QP
H u v
u v
E v D u v
= =
= + × + ≠⎡ ⎤⎢ ⎥⎣ ⎦∑∑                    (3) 
( )
1/ 2-1-1
2 2
,
0 0
1 0
QP
V u v
u v
E u D u v  
= =
= + × + ≠⎡ ⎤⎢ ⎥⎣ ⎦∑∑                 (4) 
( )
1/2-1-1
2
,
0 0
1 ( 1) 0
QP
D u v
u v
E u v D u v
= =
= + × + × + ≠⎡ ⎤⎢ ⎥⎣ ⎦∑∑        (5) 
-1-1
,
0 0
1 QP
M u v
u v
E D
P Q = =
= × ∑∑                            (6) 
( ) ( )
-1-1 2
,
0 0
1
 
-1
QP
S u v M
u v
E D E
P Q = =
= −× ∑∑             (7) 
, where P x Q is the block size of BDCT, D is frequency 
components of BDCT, u and v are frequency coordinates of 
BDCT, HE  is the horizontal energy value of a BDCT, VE  is 
the vertical energy value of a BDCT, DE  is the diagonal 
energy value of a BDCT, ME  is the average energy value of 
a BDCT, and SE  is the standard deviation of energy values 
of a BDCT.   
2.2 Multivariate T 2 statistic 
 The five energy features extracted from BDCT will be 
treated as five quality characteristics for multivariate 
statistical analysis.  Normal texture images can be used to 
estimate the parameters of standard texture characteristics.  
The sample mean matrix ( X ) and the sample covariance 
matrix (S) describe the properties of and the relations between 
the image characteristics of normal and defect images. The 
covariance is a measure of the relationship between two 
random variables.  Since the five energy features do not 
follow a multivariate normal distribution, a logarithmic 
332 Int'l Conf. IP, Comp, Vision, and Pattern Recognition |  IPCV'11 |
3 Experiments and analyses 
 In this section, we implement the proposed approach 
and conduct experiments to evaluate its performance in 
detecting visual defects of LED lenses.  To strengthen the 
visibility of the visual defects, we make use of the following 
equipments: a yellow ring lighting device, a USB 2.0 color 
CCD of ARTRAY company, a lens with 1 to 10 
amplifications of changeable focal lengths, and a XYZ 
electronic control table with a controller.  Experiments are 
conducted on 90 real LED lenses (including 60 normal lenses 
and 30 defective lenses) provided by a local manufacturing 
company of high quality LED lenses in Taiwan to evaluate 
the performance of the proposed approach.  Each image of 
the LED lens has a size of 256 x 256 pixels and a gray level 
of 8 bits.  The visual defect detection algorithm is edited in C 
language and executed on the 6th version of the C++Builder 
complier on a personal computer (Pentium-4 2.8 GHz and 
512 MB DDRII 667Hz-RAM).   
 To verify the performance of the proposed method and 
other approaches, we compare the results of our experiments 
against those provided by professional inspectors.  The 
performance evaluation indices, (1-α) and (1-β), are used to 
represent correct detection judgments; the higher the two 
indices, the more accurate the detection results.  Statistical 
type I error α suggests the probability of producing false 
alarms, i.e. detecting normal regions as defects.  Statistical 
type II error β implies the probability of producing missing 
alarms, which fail to alarm real defects. We divide the area of 
normal region detected as defects by the area of actual normal 
region to obtain type I error, and the area of undetected 
defects by the area of actual defects to obtain type II error.   
 Figure 3 shows partial results of detecting visual defects 
by the Iterative method [20], the Otsu method [21], Lin and 
Jiang method [22], the proposed method, and the professional 
inspector, individually.  The two spatial domain techniques, 
the Iterative and Otsu methods, make lots of erroneous 
judgments (false alarms) on visual defect detection.  The two 
frequency domain techniques, the Lin and Jiang approach and 
the proposed method, detect most of the visual blemishes and 
make less erroneous judgments.  Therefore, the frequency 
domain approaches outperform the spatial domain techniques 
in the visual defect detection of LED lenses.   
 Table 1 summarizes the detection results of our 
experiments.  Two spatial domain approaches and two 
frequency domain techniques are evaluated against the results 
by professional inspectors.  The average defect detection rates 
(1-β) of all testing samples by the four methods are, 
respectively, 99.9% (Iterative method), 98.8% (Otsu method), 
83.4% (Lin and Jiang method), and 92.8% (proposed method).  
However, the two spatial domain methods have significantly 
higher false alarm rates (α), 28.9% (Iterative method) and 
30.1% (Otsu method).  On the contrary, the other two 
frequency domain approaches have rather lower false alarm 
rates, 0.01% (Lin and Jiang method) and 0.17% (proposed 
method).  The proposed method has higher correct 
classification rates (CR) than do the other methods applied to 
defect detection of LED lens images.  More specifically, the 
proposed method not only has a higher detection rate than 
does the Lin and Jiang method but also its false alarm rate is 
more than eighteen times lower than that of the latter method 
applied to LED lens images.   
Table 1  Summarized comparison table of visual defect 
detection of LED lenses for four different methods. 
 
4 Conclusions 
 Machine vision technology improves productivity and 
quality management, and provides a competitive advantage to 
industries that employ this technology. This research 
proposes a novel approach that applies block discrete cosine 
transform, Hotelling T 2  statistic, and grey clustering 
technique for the automatic inspection of visual defects in 
curved surfaces of LED lenses.  Real LED lenses are used as 
testing samples, and large-sample experiments are conducted 
in a real inspection environment to verify the performance of 
the proposed approach.  Experimental results show that the 
proposed approach achieves a high 92.8% probability of 
correctly discriminating visual defects from normal regions 
and a low 0.17% probability of erroneously detecting normal 
regions as defects on curved surfaces of LED lenses. 
Compared with other traditional methods, this approach has 
the advantages of higher detection rates, lower false alarm 
rates, and shorter average processing time. This research 
contributes a solution to a common surface defect detection 
problem of LED lenses and offers a computer-aided visual 
defect inspection system to meet the inspection and quality 
control request.   
5 Acknowledgment 
 This work was partly supported by the National Science 
Council of Taiwan (R.O.C.) through the Grant [NSC 97-
2221-E-324-020-MY3]. 
6 References 
[1] Lin, H.D., Lin, G.C., Chung, C.Y. and Lin, W.T. (2008), 
‘Wavelet-based neural network and statistical approaches 
applied to automated visual inspection of LED chips’, 
Journal of Scientific & Industrial Research, Vol.67, No.6, 
pp.412-420.    
334 Int'l Conf. IP, Comp, Vision, and Pattern Recognition |  IPCV'11 |
[19] Montgomery, D.C. and Runger, G.C. (2007), Applied 
Statistics and Probability for Engineers. 4th Edition, John 
Wiley & Sons, New Jersey, USA.   
[20] Jain, R., Kasturi, R. and Schunck, B.G. (1995), Machine 
Vision, International Editions, McGraw Hill, New York, 
pp.76-86.   
[21] Otsu, N. (1979), ‘A threshold selection method from 
gray level histogram’, IEEE Transactions on Systems, Man 
and Cybernetics, Vol.9, pp.62-66.   
[22] Lin, H.D. and Jiang, J.D. (2007), ‘Applying discrete 
cosine transform and grey relational analysis to surface defect 
detection of LED’, Journal of the Chinese Institute of 
Industrial Engineers, Vol.24, No.6, pp.458-467.   
 
 
336 Int'l Conf. IP, Comp, Vision, and Pattern Recognition |  IPCV'11 |
  
 
 
國科會補助計畫衍生研發成果推廣資料表
日期:2011/07/22
國科會補助計畫
計畫名稱: 建立光學元件之自動化可視瑕疵檢測系統
計畫主持人: 林宏達
計畫編號: 97-2221-E-324-020-MY3 學門領域: 生產系統規劃與管制
無研發成果推廣資料
其他成果 
(無法以量化表達之成
果如辦理學術活動、獲
得獎項、重要國際合
作、研究成果國際影響
力及其他協助產業技
術發展之具體效益事
項等，請以文字敘述填
列。) 
1.國科會專題研究計畫成果報告[NSC97-2221-E -324 -020-MY3 (2/3)],，獲工
業工程與管理(IEM)學門召集人推薦，刊登於第 114 期國科會『工程科技通訊』
(100 年 10 月)中，推介與產業界，100 年 05 月。 
 
2.國科會 98 年度專題研究計畫成果報告，榮獲 98 年度國科會工業工程與管理
(IEM)學門「計畫成果海報優等獎」，99 年 11 月 12 日。 
 成果項目 量化 名稱或內容性質簡述 
測驗工具(含質性與量性) 0  
課程/模組 0  
電腦及網路系統或工具 0  
教材 0  
舉辦之活動/競賽 0  
研討會/工作坊 0  
電子報、網站 0  
科 
教 
處 
計 
畫 
加 
填 
項 
目 計畫成果推廣之參與（閱聽）人數 0  
