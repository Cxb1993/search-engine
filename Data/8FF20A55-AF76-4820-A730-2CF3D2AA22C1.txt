UMTS integrates with these heterogeneous wireless network 
technologies, such as the 802.11 wireless network (WLAN) and 
802.16 series (WiMax), it could offer ubiquitous service at any time, 
any place and even at movement. Through this way, it can reach the 
goal of the next generation communication network. 
 
Cognitive Network is a novel wireless technology. Its concept 
comes from the Radio sensing and learning, Spectrum opportunity, 
Spectrum opportunity realization and Spectrum Re-configure, etc. 
Cooperative Network is the strategy of a group of entities working 
together to achieve a common or individual goal. Besides used for 
improving the efficiency of the wireless network, Cross Layer 
Design does one of the technologies to carry out the Cognitive 
Network and Cooperative Network. 
 
We based on the Cross-Layer 4G testbed built by the previous All-
IP Cross-Layer 4G Project, and integrated Cognitive Network and 
Cooperative Network technologies by the Cross-Layer Design 
approach. This project will focus on Security and Privacy Protection 
Mechanism, QoS and Resource Management, Mobility 
Management and MAC Protocol, Multi-homing and Application 
Services. The testbed will provide all sub-projects to test their 
research results on this platform.  
 
 
 
I 
 
 
摘 要 
第四代行動通訊相關技術為目前熱門議題，加上固定業務和移動業務融合(FMC)逐漸
受到重視，透過標準的網際網路多媒體子系統(IP MultiMedia Subsyetem)將能提供更有彈性
的系統架構。這將使得人們得以隨時隨地利用輕便的無線裝置擷取或傳達語音、數據、多
媒體等資訊。 
 
感知網路(Cognitive Networks)是一個革新的無線感測技術，其概念來自無線環境下的
感知與學習，頻譜機會的認定與分配，以及頻譜機會的實現，並且利用智慧型感測方式獲
得頻譜使用機會資訊、與環境參數，再來選擇最合適的網路或頻譜重組的網路架構。協力
網路(Cooperative Network)則是藉由在一個群組裡的使用者來一起工作以達到公有或私人
資源利用的一種策略。在網路頻寬較受限制的無線網路運用上，則可以縮短使用者的傳輸
時間，增加資源的分享等。跨層式設計(Cross Layer Design)除了廣泛被用來提高無線網路效
能之外，亦是感知網路與協力網路在實作上的技術之一。 
 
計畫執行學校延續上一期 All-IP Cross-Layer 4G 行動通信研究計畫中所建置之 4G 測試
平台，針對 4G-IMS 網路架構分為五個子計畫進行研究，子計畫一為接取網路技術研究、
子計畫二為安全與隱私保護機制、子計畫三為服務品質與資源管理研究、子計畫四為行動
管理與媒體存取協定研究、子計畫五為多重連結與應用服務研究，同時總計畫亦帶領各子
計畫引入感知網路與協力網路等技術輔以跨層設計的實作概念，完成跨層式感知與協力
4G-IMS 無線網路平台之建置，讓各子計畫的研究成果能具體落實並予以整合使各子計畫
能有效整合，經由發展實際應用環境以產生連鎖效益，以便能使台灣在此領域之學術地位
躋身世界一流國家之列。 
 
子計畫一擬建構一跨層式感知與協力4G-IMS 無線網路平台(Cross-Layer Design for 
Cognitive and Cooperative 4G-IMS Wireless Networks Testbed)，提供各研究子計畫功能測試
環境及總計畫系統整合。此測試平台亦可作為未來電信業者導入4G 與 IMS 網路建置及系
統運作之參考。本計畫在計畫執行過程中亦與法國TELECOM Bretagne組織進行合作提案，
於 4G-IMS 平台上進行 IPv6 相關服務之部署經驗交流與合作開發。在子計畫一的平台
中，整個 4G-IMS 除整合各種異質核心網路以外，使用者終端將導入軟體定義無線電技
術，透過可調變的無線電特性，對環境無線電頻譜與各種參數進行感知，經由子計畫一規
劃設計的感知與協力引擎，達到讓核心網路控制端(Control Plane)能夠與使用者端(User 
Plane)進行雙向的感知協力運作溝通，完成跨層式感知與協力4G-IMS無線網路平台的建
置，讓各子計畫能夠順利地在本平台進行整合與各種應用。 
 
子計畫二在4G-IMS無線網路環境中，探討行動用戶使用行動裝置上多重的網路存取介
面漫游於各個無線網路間的安全議題，用戶可以透過的頻譜的掃描與空白頻譜的使用來將
網路資源的使用率發揮到極致，並且因行動裝置的高度可攜性，用戶亦可在不斷線的情況
下往附近的無線網路移動。然而，行動用戶於無線網路上漫游時，若未對基地認證或未採
用任何加密保護機制，資訊安全與個人資料非常容易遭受各種危害。例如：行動用戶在與
基地台進行通訊之前，若未有任何認證的動作，則行動用戶的個人資料、無線傳輸過程中
重要的訊息、或其他帶有隱私的任何資訊都將可能會洩露出去。子計畫二提出感知認證機
制，此機制可避免行動用戶遭受非信任基地台的欺騙，其提供行動用戶分辨可信任與不可
信任基地台的能力。對於資訊的安全與個人隱私較敏感或謹慎的行動用戶，在本機制的幫
助下可完全拒絕與非信任基地台的連線。此外，子計畫二提出的機制更能協助行動用戶減
少因與非信任基地台進行失敗之認證而產生的延遲，此延遲可能會使行動用戶於換手的過
程中產生斷訊的情況，未來行動用戶可快速的找到可信任的基地台並順利的進行換手的動
III 
 
關鍵詞：All-IP、IMS、4G、IPv6、Cross-Layer、Cognitive Network、Cooperative Network、
會議金鑰、身份認證、跨層管理、服務品質、資源管理、軟體定義無線電、媒體
存取控制、頻譜移動性、Multi-homing、Location-based Service、Social Network。 
 
 
V 
 
IP multimedia subsystem (IMS) platform allows service providers to accommodate extended 
services, such as voice, data and video streaming based on open architecture and standards. 
Through unified heterogeneous networks, users are enabled to access applications using 
distinctive user terminals equipped by different network access technologies. When users’ 
terminals access the applications across various network environments, the terminals have to deal 
with different level of handoff decisions. As generally assumed, the certain degree of packet loss 
incurred by the variation of handoffs. This poses a major challenge for QoS provisioning and 
resource management in 4G-IMS network environment. In the third year, the 
project completed the design and development of Quality Assurance Management and Charging 
System interfaces. QAM Charging provides 4G-IMS system billing and control mechanisms. The 
different services levels such as GPRS, IMS and MMS were combined with Online Charging and 
Offline Charging modules which conduct real-time monitoring of resource utilization levels and 
detect the relevant billing information. Moreover, the project enhanced the PCC (Policy Control 
and Charging) function using PCRF (Policy and Charging Rule Function) to offer a high level 
charging flexibility. In contemplation of achieving users’ best-assigned services through 
user-based billing principles, the charging module computes the system resource utilization 
follows the charging standard. 
 
The third year, subproject 4 focuses on integrating the results of the previous two years and 
adding the rely node to solve the issues in LTE, 4G-IMS, core network, WLAN and Ad-hoc 
network by using cross-layer design mobility and protocol management. Our theoretical results: 
(1) E-MAC: an efficient MAC protocol in cognitive radio network, (2) a handoff mechanism in 
cognitive radio network, (3) A relay-assisted handover protocol with security for proxy mobile 
IPv6 in 3GPP LTE systems, (4) network mobility protocol for vehicular ad hoc networks. We 
have also implemented our research methods into SDR (Cognitive Radio Device) to obtain the 
real simulation results. Therefore, we must be used in Cognitive Radio Device to obtain spectrum 
hole in license band. To achieve our goals, (1) spectrum sensing: using the most effective way 
detection spectrum hole, (2) spectrum mobility: using Radio terminal achieves the dynamic 
access spectrum, (3) we adjust our model in order to integrate our project with other subproject. 
 
The subproject 5, we propose a cross-layer designed wireless multihoming mechanism based 
on cognitive network architecture. We use the characteristic of cognitive radio network to design 
a handoff mechanism supporting multihoming connections in cognitive network for reaching the 
optimization of access network selection by user-centric design.  
 
 
Keywords: All-IP, IMS, 4G, IPv6, Cross-Layer, Cognitive Network, Cooperative Network, 
Conference Key, Authentication, Cross-Layered management, Quality of Service, 
Resource Management, SDR, MAC, Spectrum mobility, Multi-homing, 
Location-based Service, and Social Network. 
VII 
 
3.4.2 SEAMLESS SESSION MOBILITY SCHEME IN HETEROGENEOUS WIRELESS NETWORKS........................ 75 
3.4.3 PROTOCOLS AND APPLICATIONS OF CROSS-LAYER IN MOBILITY MANAGEMENT............................ 77 
3.5 子計畫五研究方法 .................................................................................................................... 77 
3.5.1 感知網路下多重連結技術....................................................................................................... 77 
四、 結果與討論 ............................................................................................................................ 84 
4.1 子計畫一結果與討論 ................................................................................................................. 84 
4.1.1 區域感知實現 ......................................................................................................................... 84 
4.1.2 全域感知引擎實現.................................................................................................................. 87 
4.2 子計畫二結果與討論 ................................................................................................................. 92 
4.2.1 會議金鑰交換協定.................................................................................................................. 92 
4.2.2 實作架構與方法 ..................................................................................................................... 93 
4.2.3 感知認證協定 ......................................................................................................................... 95 
4.2.4 實作架構與方法 ..................................................................................................................... 97 
4.2.5 協力防禦機制 ......................................................................................................................... 98 
4.3 子計畫三結果與討論 ................................................................................................................100 
4.3.1 效能分析 ...............................................................................................................................100 
4.3.2 實作成果 ...............................................................................................................................101 
4.4 子計畫四結果與討論 ................................................................................................................109 
4.4.1 實驗環境 ............................................................................................................................... 110 
4.4.2 實作內容 ............................................................................................................................... 111 
4.5 子計畫五結果與討論 ................................................................................................................ 114 
五、 計畫自評與研究成果.............................................................................................................120 
5.1 子計畫一自評與研究成果 ........................................................................................................122 
5.2 子計畫二自評與研究成果 ........................................................................................................123 
5.3 子計畫三自評與研究成果 ........................................................................................................124 
5.4 子計畫四自評與研究成果 ........................................................................................................125 
5.5 子計畫五自評與研究成果 ........................................................................................................126 
 
IX 
 
圖 40. 感知資訊染色體結構 ....................................................................................... 53 
圖 41. Uniform crossover.............................................................................................. 53 
圖 42. Conference Key Exchange ................................................................................. 54 
圖 43. SubBytes ............................................................................................................ 55 
圖 44. ShiftRows ........................................................................................................... 55 
圖 45. MixColumns....................................................................................................... 56 
圖 46. AddRoundKey .................................................................................................... 56 
圖 47. Challenge-Response Authentication .................................................................. 57 
圖 48. PKI 憑證與簽章的驗證 .................................................................................... 58 
圖 49. 4G-IMS 環境架構 ............................................................................................. 59 
圖 50. 4G-IMS 架構模組 ............................................................................................. 60 
圖 51. QAM Charging System 架構圖 ......................................................................... 60 
圖 52. Charging System 費率決策演算法 .................................................................. 63 
圖 53. Charging 決策流程圖 ........................................................................................ 64 
圖 54.系統模型 ............................................................................................................. 65 
圖 55. SU、RN 結構 .................................................................................................... 65 
圖 56.在情境一下之中繼探尋階段例圖 ..................................................................... 66 
圖 57.在情境二下之中繼探尋階段例圖 ..................................................................... 66 
圖 58.在情境一下之環境觀察階段例圖 ..................................................................... 67 
圖 59.在情境二下之環境觀察階段例圖 ..................................................................... 67 
圖 60.在情境一下階段三階段四例圖 ......................................................................... 69 
圖 61.在情境二下階段三階段四例圖 ......................................................................... 70 
圖 62. scenario 1 的 resource blocks 之間的關係。 ................................................... 71 
圖 63. scenario 2 的頻譜移動和換手關係 .................................................................. 72 
圖 64. (a) Total transmission time vs. data size of scenario 1. (b) Total transmission 
time vs.number of PUs of scenario 1 ..................................................................... 73 
圖 65. (a) End-to-end delay vs. data size in scenario 1. (b) End-to-end delay vs. 
number of PUs of scenario 1. ................................................................................. 74 
圖 66. (a) End-to-end delay vs. number of PUs of scenario 2. (b) End-to-end delay vs. 
number of spectrum hole of scenario 2. ................................................................. 74 
圖 67. (a) Number of spectrum mobility vs. data size of scenario 1. (b) Number of 
spectrum mobility vs. number of PUs of scenario 1 .............................................. 74 
圖 68. Number of handoff vs. data size of scenario 2. .................................................. 75 
圖 69. Network architecture of SmSCTP protocol. ...................................................... 75 
圖 70. Handover policy for SmSCTP. ........................................................................... 76 
圖 71. Impact of call mobility ratio on delay time and real implementation: CMR=0.5.
 ................................................................................................................................ 76 
圖 72. 4G-IMS 無線感知網路環境 ............................................................................. 78 
圖 73. USRP 連結上網 ................................................................................................. 78 
圖 74.以 SNR 值為換手依據的垂直換手 ................................................................... 79 
圖 75. SST 頻譜感知流程 ............................................................................................ 80 
XI 
 
圖 117. Cooperative 架構 .......................................................................................... 106 
圖 118. Java Jade Agent-based System ....................................................................... 106 
圖 119. QoS Agent 建置示意圖 ................................................................................. 107 
圖 120. QoS_pAgnet 執行畫面 .................................................................................. 107 
圖 121. QoS_dbAgent 動態更新資訊 ........................................................................ 107 
圖 122. QoS_learningAgent 執行畫面 ....................................................................... 108 
圖 123. Charging Module 建置示意圖 ...................................................................... 108 
圖 124. Offline Charging ............................................................................................ 108 
圖 125. Online Charging ............................................................................................. 109 
圖 126. Record Message ............................................................................................. 109 
圖 127.多媒體服務執行畫面 ..................................................................................... 109 
圖 128.系統架構圖 ..................................................................................................... 110 
圖 129. MN 端以及 WLAN ....................................................................................... 110 
圖 130. IMS 網路端系統平台.................................................................................... 110 
圖 131.安裝有 MIPv6 的 HA 以及 AR 設備 ............................................................ 110 
圖 132. 執行 HA 套件的畫面 ................................................................................... 111 
圖 133. 執行 AR 套件的畫面 ................................................................................... 111 
圖 134. MN 向 HA 要求 IP 位址 ............................................................................... 111 
圖 135. MN 獲得 IP 位址 ........................................................................................... 111 
圖 136. MN 初始化所使用的頻率 ............................................................................ 112 
圖 137. MN 執行換頻到新的頻率 ............................................................................ 112 
圖 138. MN 在執行換手時，發送 Update Router 訊息 ........................................... 113 
圖 139. RN 顯示幫忙轉送封包並顯示 ..................................................................... 113 
圖 140. 換手成功後，保留原始 IP .......................................................................... 113 
圖 141. 換手至 AR 後，發送訊息給 HA ................................................................ 113 
圖 142. 感知頻譜偵測換手實驗架構 ....................................................................... 115 
圖 143. 感知頻譜偵測換手機制執行流程 ............................................................... 115 
圖 144. 情境示意圖 (a) 情境一 (b) 情境二.......................................................... 116 
圖 145. 頻譜偵測 2.397GHz~2.479GHz .................................................................. 116 
圖 146. 頻譜偵測 2.46GHz~2.47GHz ...................................................................... 117 
圖 147. Mobile Node 偵測到連結強度變弱，增加新路徑預備換手..................... 117 
圖 148. 各頻段的頻道可用度(CA)偵測................................................................... 118 
圖 149. 開始換手 ....................................................................................................... 118 
圖 150. 封包傳送情形(情境一) ................................................................................ 119 
圖 151. 封包傳送情形(情境二) ................................................................................ 119 
圖 152. 換手處理中訊號強度與 Mobile Node 距離關係........................................ 119 
圖 153.總計畫實驗平台 ............................................................................................. 120 
圖 154.總計畫計畫資訊交流平台 ............................................................................. 121 
 
13 
 
 
一、 前言 
 
第三代行動通訊(3G)雖未如第二代行動通訊(2G)全面普及，但各大電信業者正如火
如荼在努力搶攻與分食 3G 的市場，隨著使用第三代行動通訊系統各種服務使用者急遽
增加以及使用者對於行動通訊下之高頻寬、高速率的需求，學術界與業界已有人開始探
討第四代行動通訊，加上固定業務和移動業務融合（Fixed and Mobile Convergence, FMC）
逐漸受到重視，標準的網際網路多媒體子系統(IP MultiMedia Subsyetem, IMS) 提供更有
彈性的系統架構。 IMS 是 3GPP 所訂定的一個網路架構子系統，在 3GPP 的
Release5(2002 年五月完成)中已被標準化，而更新的版本則規範在 Release6 中(2004 年
完成)。其概念是把電信技術、無線網路及有線網路在 All-IP 的環境下進行整合，以便
在 3G 乃至未來 4G 系統中提供更彈性的即時與互動之多媒體服務。IMS 使用會談初始
協定(Session Initiation Protocol, SIP)此協定來建立多媒體的 Session，主要功用是結合
Circuit-switched Domain 與 Packet-switched Domain，使得多媒體在使用上沒有限制並擁
有更多的彈性，可以提供更多可選擇的服務給使用者。 
 
本研究計畫延續上一期於 NTP 規劃三年期之整合型研究計畫，並依照新一期通
訊國家型科技計畫(Networked Communications Program, NCP)著手整合型研究計畫之規
劃，後續之架構依各研究主題之關聯性仍區分為數個部分(如下圖 1 所示)，由五個子計
畫主持人依其專長承接執行。各計畫於此計畫所建立之平台上進行研究，除總計畫外，
其下包括五個子項計畫：  
 
總 計 劃：跨層式感知與協力 4G-IMS 無線網路研究 
子計劃一：跨層式感知與協力 4G-IMS 無線網路之接取網路技術研究 
子計劃二：跨層式感知與協力 4G-IMS 無線網路之安全與隱私保護機制研究 
子計劃三：跨層式感知與協力 4G-IMS 無線網路之服務品質與資源管理研究 
子計劃四：跨層式感知與協力 4G-IMS 無線網路之行動管理與媒體存取協定研究 
子計劃五：跨層式感知與協力 4G-IMS 無線網路之多重連結與應用服務研究 
 
 
圖 1.本整合型研究計畫之架構與關係 
 
15 
 
 
圖 2.計畫總體情境架構圖 
 
於本研究計畫中，總計畫將帶領各團隊研究並規劃跨層式感知與協力 4G-IMS 無線
網路之架構，協調各子計畫於測試平台上進行功能模組之初步整合與測試。並且也透過
定期舉行的聯絡人會議與主持人，提供各子計畫間的參與人員了解各別的進度與所遇到
的技術瓶頸，並集思廣益提供解決的方法，並且設置網路論壇與檔案伺服器將相關的參
考文獻、技術報告以及系統手冊等，提供各子計畫參考，並分享各自的研究成果。 
 
 
(2) 子計畫一『跨層式感知與協力 4G-IMS 無線網路之接取網路技術研究』 
 
第三代行動通訊(3G)雖未如第二代行動通訊(2G)全面普及，但各大電信業者正如火
如荼在努力搶攻與分食 3G 的市場，隨著使用第三代行動通訊系統各種服務使用者急遽
增加以及使用者對於行動通訊下之高頻寬、高速率的需求，學術界與業界已有人開始探
討第四代行動通訊，加上固定業務和移動業務融合(Fixed and Mobile Convergence)逐漸受
到重視，標準的網際網路多媒體子系統(IP MultiMedia Subsyetem, IMS) 提供更有彈性的
系統架構。IMS 是 3GPP 所訂定的一個網路架構子系統，在 3GPP 的 Release5(2002 年
五月完成)中已被標準化，而更新的版本則規範在 Release6 中(2004 年完成)。其概念是
把電信技術、無線網路及有線網路在 All-IP 的環境下進行整合，以便在 3G 乃至未來 4G
系統中提供更彈性的即時與互動之多媒體服務。IMS 使用 SIP (Session Initiation Protocol)
此協定來建立多媒體的 Session，主要功用是結合 Circuit-switched Domain 與
Packet-switched Domain，使得多媒體在使用上沒有限制並擁有更多的彈性，可以提供更
多可選擇的服務給使用者。 
 
在 IMS 的核心網路裡架設了特殊的 SIP Server，通稱 CSCF(call session control 
function)，與 HSS (home subscriber system)結合後，就有能力把任何一種 SIP 服務轉到
任何一個核心網路，達到跨越不同核心網路的能力。由此可知，在可以跨越平台以及便
於提供多樣性的多媒體服務前提下，IMS 可說是未來無線通訊網路的趨勢。IMS 架構
17 
 
 
圖 4.感知無線網路分層應用技術 
 
而協力網路(Cooperative Network) 研究與設計部分，如圖 5 的分層應用範圍，本研
究將基於 4G-IMS 平台於各協定層研究可提供的資訊參數與標準界面，以利於其他子計
畫開發進階應用。 
 
 
圖 5.協力無線網路分層應用技術 
 
綜合以上感知網路(Cognitive Network)與協力網路(Cooperative Network)輔以跨層設
計(Cross-Layer Design)的概念目標於本研究的 4G-IMS 無線平台之上，將適於各子計畫
將其所開發的各應用之關鍵模組部署。本子計畫之跨層式感知與協力 4G-IMS 無線網路
平台將建置於宜蘭大學。平台之建構需要考量功能完整性、使用便利性及運作最佳性；
功能完整性將使系統之運作得宜，使用便利性可使關鍵模組之融入容易，運作最佳性將
使各種應用效率更臻完善。本子計畫所建置之測試平台，將作為其他子計畫整合後共同
運作之基礎平台，此外，本測試平台在日後亦可作為未來電信業者 All-IP 網路建置及系
統運作之參考。 
 
在第二年的重要目標，則是將第一年成果推展並加以運用，從頻譜感測的結果能夠
有效了解目前節點環境周遭頻譜使用狀況，進而透過第二年預期設計的感知引擎，達成
對環境中頻譜感測狀況進行有效的蒐集(Collection)、處理與回饋(Feedback)，如此此能
夠大幅提升整體頻譜利用狀況，達到更高的傳輸效益以及傳輸狀況。 
19 
 
移動而切換網路時，連線的穩定性和延遲時間避免太大的影響，各層之間的互相配合就
顯得很重要，我們將以cross-layer design來把不同網路的各層做協調工作。預計在mobility 
and session management部分將會跨link、network、transport與application layer四層。因此
系統需要提供更好的無縫隙換手(seamless handoff)機制及通訊管理(session management)
的能力，才可以滿足使用者的需求。 
 
 
(6) 子計畫五『跨層式感知與協力 4G-IMS 無線網路之多重連結與應用服務研究』 
 
隨著運輸工業的進步，人們來往於各地的機率大增。而在各個地方都能上網的需求
推動無線網路技術的發展。現行的無線網路技術如圖 6，包括 GPRS(General Packet Radio 
Service)、Wi-Fi、WLAN、3G(3rd-generation)、WiMAX(Worldwide Interoperability for 
Microwave Access)等。 
Wi‐Fi
3G GPRS
WiMAX
GSM GPS
Internet
 
圖 6.異質性無線網路環境 
 
早期的無線技術如 2G 系統是用於語音通訊，讓使用者能快速且不中斷傳送語音資
訊，以提供高品質的語音服務。到了 2G 的後期，由於網際網路的興起，人們不再滿足
於只提供語音服務，於是就有了 GPRS 的技術來傳送網路封包。而在電信網路之外，
Wi-Fi、WLAN 這類的高速無線網路技術逐漸受到重視，成為行動裝置必備的功能之一。
Wi-Fi 與 WLAN 都有傳輸範圍不夠大的缺點，於是就有了第三代行動通訊系統(3G)與
WiMAX 的技術來提供大範圍的高速無線網路。 
 
即便是能提供大範圍網路服務的技術還是有其無法覆蓋到的地方，有時還是必須切
換到其他網路技術的系統。但目前各國推行的網路系統不一，不同的網路技術間也沒有
一個整合的服務平台，導致有些服務只能在特定網路平台才能執行。為了解決此一問
題，3GPP 提出了網際網路多媒體子系統(IP Multimedia Subsystem, IMS)[1]的概念。IMS
利用會議發起協定(Session Initiation Protocol, SIP)描述整個系統架構，目的是為了整合各
種不同的無線網路技術，IMS 整合各種網路技術的情形如錯誤! 找不到參照來源。。IMS
提供了一個整合性的服務平台，讓不同網路的使用者都可以透過 IMS 來使用相同的服
務。 
 
21 
 
802.16 WiMAX 網路，現階段我們也建置 IMS 測試平台。 
 
 
圖 8. All-IP Cross-Layer 4G Testbed 系統架構圖 
 
開放原始碼的 Open IMS Core 專案提供 IMS Call Session Control Functions (CSCFs)
和一精簡之 Home Subscriber Server (HSS)，其建構依循 3GPP、3GPP2、ETSI TISPAN 的
IMS/NGN 而來，所有元件都建構在開放原始碼軟體下（例如: SIP Express Router、
MySQL、OpenDiameter 等）。我們針對網路上現有的 IMS 資源與基本服務進行蒐集與整
合部署，預期將原有之 IMS 系統雛形延伸為功能更完備之標準核心網路，並提供標準介
面使各子計畫於此架構上進行研究成果部署。 
 
 
2.1.1 感知網路 
 
在感知網路(Cognitive Network, CN)的研究與設計部分，本研究有別於目前熱門的感
知無線電(Cognitive Radio, CR)技術領域，著重於節點本身區域範圍性實體層(Physical 
Layer)的跨層設計功能，在本研究中將針對感知網路屬於點對點(End-to-End)之決策的跨
層設計功能，其範圍可涵蓋許多協定層，如圖 9 所見對應至不同協定層皆可達到不同層
級的應用。 
23 
 
及系統運作之參考。 
 
 
2.1.3 感知無線電 
 
感知無線電 (Cognitive Radio)的主要概念是利用無線頻譜上的感知 (Spectrum 
Sensing)，使無線通訊設備於主要頻譜(Primary Band)壅塞時，尋找可使用的次級頻段
(Secondary Band)，暫時使用此空閒的頻段完成通訊之目的，使得整體無線資源的利用率
達到最佳化的新穎技術。主要頻譜和次級頻譜使用的差異化是感知無線系統特有的法
則，對無線頻率資源的分配將會造成更多設計層面的考量。 
 
此項技術設計概念是將一頻段的使用分成兩種（或更多）等級，優先使用者(primary 
users)及次級使用者(secondary users)。次級使用者傳送前先偵測被授權可使用的頻帶
中，如果頻段目前沒有優先使用者使用，則可利用這空檔傳送自己的訊號，然而一切以
不干擾影響優先使用者的權益為主。若發現優先使用者要開始傳送，必須馬上退出讓開
此頻段，重新尋找下一個可用的頻段。這個資源(頻段)的空檔被稱做 spectrum hole。次
級使用者必須綜合傳送端與接收端估測到的spectrum hole，找出當中的交集並挑選適合
的頻段傳送，實現 Dynamic Spectrum Access Network。當次要系統發現其使用頻寬擁擠
時，可藉由感知的技術去偵測主要頻寬的使用情形，並進一步加以分配使用。 
 
截至目前為止，感知無線網路的概念已經充分被大家所接受，但實作上與真正應用
情境並無一致的看法與標準，而各標準組織與無線通訊系統例如: 802.11、Wi-Fi、
WiMAX，紛紛提出它們系統對於感知無線的運用與細部設計。由這幾個通訊標準不難
看出感知無線將著重在於頻譜的偵測與管理上，對於實體層(PHY)將需要有配套的天線
偵測與干擾量測方式來估計頻譜的使用與真正的干擾影響，而對於傳輸控制層(MAC)則
需要有相對應的協調機制來幫助系統管理所拿到的額外頻寬，使其充分發揮其效用。本
報告後續章節將進一步分析各個感知量測(Spectrum Sensing)分類，和去說明感知無線網
路設計上所會面臨的挑戰。 
 
 
2.1.4 頻譜感測 
 
在感測頻譜的技巧上，為了感測微弱的無線電頻譜訊號，感知無線電必須比傳統無
線電更明顯改善感測的靈敏度。所需的射頻(RF)前端和類比數位轉換(ADC)難度門檻相
當高。在可靠的接收和取樣的頻帶信號上，數位信號處理技術的使用，進一步提高無線
電靈敏度。最近的頻譜探測工作的重點是 primary transmitter detection。 
 
感知無線網路目前正處於萌芽的階段，目前可分成三個主要的運作模式和相關研究
主題，分別為軟體定義無線電－Software Define Radio (SDR)、頻譜偵測－Spectrum 
Sensing 和頻譜管理－Spectrum Management，在SDR 裡主要是軟體的相關技術發展，
包含如何利用網路達成自我學習(self-learning)功能，並透過數位訊號處理(Digital Signal 
Process)來完成調整的功能，頻譜偵測則是著重於多重頻段天線的設計以及如何針對周
遭環境作完整的掃描工作，而頻譜管理則是結合傳輸品質(Quality of Service)之控管以及
多層結構之資源分配課題。 
 
25 
 
估算其干擾值，但由於無線環境裡充斥的各種無線通訊系統，其
所用的頻譜、功率、溫度、以及干擾的定義皆不同，所以如何達
成不同系統間干擾的轉換動作是此偵測方式要考慮的地方。 
 
感知量測和感知無線電之間獲得了新方面的技術，和 
opportunistic spectrum access的概念，在感知無線電系統裡，這是
一個最具挑戰性的問題，它在感知無線電提出了幾種研究感知量
測方法。從感知無線電角度研究各個方面感知量測的問題和多層
面的感知量測概念介紹，去利用感知量測方法討論感知量測相關
的挑戰，這篇文章解釋 cooperative 感知概念及其各種形式，
External 感知算法和其他替代感知方法進行了討論。最後，給了
一些目前的無線感知特徵標準。 
 
 
 
 
 
 
 
 
 
圖 11. 不同的 SNR 比值以
ROC 曲線為基礎的 energy 
detection 
 
 
 
各方面的感知量測說明如
圖 12: 
 
 
圖 12. 頻譜感測技術相關議題關係圖 
 
傳統的感知 opportunity 是定義 “a band of frequencies that are not being used by the 
primary user of that band at a particular time in a particular geographic area”，只利用頻率、
空間、時間這三方面。無線電空間和提出特點可以被定義為“a theoretical hyperspace 
27 
 
 
表 3 Single-Radio vs Double-Radio 
 
 
對於隱藏的優先使用者問題去討論，隱藏優先使用者的問題是在CSMA(載波感知多
重存取)裡，類似隱藏節點問題。它可能是由於許多因素造成，包括嚴重的多路徑衰落。
例如在圖 13，顯示感知無線電設備對於主要用戶（接收者）造成不必要的干擾。 
 
 
圖 13. 感知網路干擾示意圖 
 
對於商用設備，主要有兩種類型的技術：固定頻率和擴頻。兩個主要的擴頻技術分
別為 FHSS、DSSS ，固定頻率的運作在一個單一的頻率或頻道，而擴頻的運作在多個
頻率或通道之間。當感知無線電是占用到它們的頻寬，優先使用者可以隨時要求其頻
寬，為了防止干擾，和維護優先使用者權利，感知無線電應該能夠迅速探測優先使用者
存在，且量測感知方法應該可以找出優先使用者存在的持續時間，對感知無線電設計就
是一種新的挑戰。 
 
在感知無線電裡，惡意用戶可以修改其播送界面，進而偽裝成為優先使用者。因此，
它可以誤導感知量測所執行的合法優先使用者。這是一個更具有挑戰性的問題，它是需
要制定更有效的策略，防止次級使用者偽裝為優先使用者。合法優先使用者需要傳輸加
密的認證，連同其傳輸去產生使用私人密碼金鑰。這種方式，只能用於數位調變上，因
此，次級使用者應具有同步能力和解調變優先使用者信號。 
 
29 
 
 
圖 15. 跳頻技術(Channel Skipping) 
 
適應型跳頻(AFH)方法為藍芽標準1.2版所提出，此法為藍芽裝置在檢測週遭(On air)
所使用相同的通道時的一種避免干擾的方法。 AFH 的啟動步驟為：步驟一，藉由 RSSI 
(Receive Signal Strength Incident)在空氣中偵測到某一個通道的信號強度是否與此藍芽
裝置所使用之通道重複，藉以獲得此藍芽裝置在某個通道是否有干擾現象或有不好的通
道，其實藍牙本身跳頻就是為了避免連續衝突但並不代表不會衝突。圖 15為藍芽傳輸
時，有 AFH 現象和無 AFH 現象。 
 
IEEE 802.22 技術是感知無線電技術在無線區域內的具體應用，它的特點是在
VHF/UHF 頻段內，不干擾許可授權用戶的情況下，透過一些關鍵技術得以實現靈活頻
譜配置。 
 
IEEE 802.22 固定無線區域網路工作於 54MHz～862MHz  VHF/UHF（擴展頻率範
圍 47MHz～910MHz）頻段中的 TV 通道，它可自動檢測空閒的頻譜資源並加以使用，
因此可與電視、無線麥克風等已有設備共存。利用固定無線區域網路設備的這種優點，
可向低人口密度地區提供類似於城市區域所得到的頻寬服務。 
 
在 IEEE 802.22 系統中，為了實現對許可授權用戶保護，提出工作通道內和工作通
道內感知機制，工作通道內採用兩段式感知（TSS）機製，在快速感知階段，通常採用
單一的感知方法（如能量檢測），迅速感知是否存在許可授權用戶，這個過程通常在微
秒級。在準確感知階段，去獲知已授權用戶的詳細訊息，這個過程通常在毫秒級。 
 
 
2.2 子計畫二－安全與隱私保護機制研究 
  本三年期計畫中，我們分別於每年對 4G-IMS 網路進行不同的安全分析，從而設計
適合的機制改善現有的狀況和問題。於第一年計畫中，在頻譜認證機制未明朗之前，我
們希望在 IMS 伺服器上提出新的 IMS 服務，此服務提供 4G-IMS 網路底下的使用者能
夠非常方便的與其他使用者進行會議金鑰交換(Conference Key Exchange)，並使用此金
鑰進行協力網路與感知網路的通訊。此會議金鑰交換協定能確保只有同群組內的使用者
才能分享相同的金鑰，因此，使用者即使在惡意的頻譜下進行通訊，其傳送的資料仍不
會被第三者竊聽，而且在協力網路之下，使用者之間亦可使用已建立的金鑰來確認資料
的正確性與完整性，藉以提升 4G-IMS 感知與協力網路的安全層級。 
  於第二年計畫中，我們探討在 4G-IMS 無線網路底下使用交談式認證存在的問題，
31 
 
(9) 利用 確認 的正確性。 
  以上的協定中利用到時戳的技術，如果要在 4G-IMS 的環境中實作，必需要先實作
timestamp server，因此我們認為較不適合於實作在 4G-IMS 的環境中。 
 
 
2.2.2 會議金鑰交換協定(二) 
(1) 使用者 1 選擇亂數 ，使得 。接著再計算
和 ，其中 、 為
使用者 1 的私鑰，最後使用者 1 將 傳送給其他使用者。 
(2) 當 使 用 者 j 收 到 之 後 ， 先 確 認
是否成立，若成立，則產生亂數 ，
使得 ，接著再計算 、 和
，然後傳送 給使用者 1。 
(3) 使用者 1 收到 之後，首先確認 是
否成立，若成立，則選擇亂數 ，接著產生 和
，然後傳送 給其他使用者 j。 
(4) 其他使用者 j 收到 ，藉由計算 可得到 the 
conference key，並可透過解密 來驗證 。 
  以上的方法對其他使用者的計算量較大，大約需要 9 個指數的模運算，在以行動用
戶為主的 4G-IMS 網路環境底下較不適當。 
 
 
2.2.3 行動通訊認證協定(一)  
在此認證協定中，HLR(Home Location Register)和VLR(Visited Location Register)透過
AS(Authentication Server)的幫忙已經事先建立安全通道(secure channel)，此協定的認證
步驟如圖 16所示。 
33 
 
MN(Mobile Node) 向 HA(Home Agent) 註冊並透過安全通道得到 MN 的 password 
和 。 
 第一階段(First Phase) 
在此階段，FA(Foreign Agent)驗證MN並發送certificate給MN。此certificate在FA和MN往
後的溝通都會被使用到。 
(1)  MN → FA：  
首 先 MN 計 算 和 Temporary Key 
，然後使用對稱加密法以 來加密 得 ，再
把HA的ID 和自己的timestamp 傳給FA。 
(2)  FA → HA：  
當FA收到MN的訊息，FA將驗證MN的timestamp 是否有效。若有效，則選
擇一個的亂數b，然後用私鑰 對 做簽章並傳給HA。 
(3)  HA→FA：  
HA收到 FA的訊息以後檢查 和 是否有效，若有效，則計算
而 得 。 若 為 MN 的 ID ， 則  HA 計 算
並 解 密 得 到 ， 最 後 以 對
加密得 ，並傳送給FA。 
(4)  FA → MN：  
FA收到HA的訊息以後，以FA檢查 和 是否有效，若有效，則以 解
密 得 ，最後以 加密
，並將結果傳送給MN。 
 第二階段(Second Phase) 
(1)  MN → FA：  
MN用session key 解密所接收到的訊息得 ，最後以 來加密
，並將結果傳送給FA。 
  以上的協定在初始階段時，MN必須要向HA先註冊取得 ，此 往後用來
產生其他加解密的金鑰。由於我們所預期的協定是希望MN能夠在未建立連線而且沒有
註冊的情況下透過單向驗證來判斷基地台的合法性，因此，此機制不適用於我們的感知
認證協定。 
 
 
 
2.3 子計畫三－服務品質與資源管理研究 
 
為了強化模組化的概念，傳統 TCP/IP (Transmission Control Protocol/Internet Protocol)
通訊協定採用階層式(Layer)的模組化設計(如圖 18 所示)，主要的目的在於訊息溝通只
發生在相鄰的階層之間。因此，引發一些影響效能的問題，例如無線網路之安全性、服
務品質、行動通訊的電力耗損與高錯誤率等問題。如繼續維持此模組化的運作架構，勢
必會影響未來 4G 環境的整體執行效能。以下針對幾項重要影響效能課題說明之。 
35 
 
樑，以解決 QoS 議題所面臨之困境。圖 20 為 C3QM 的基本架構，C3QM Manager 可以
接收各階層間所發出之 Events(如表 4 所列)，例如 Handoff Start、Link Lost，由這些Events
觸發 C3QM Manager 內的各模組運作，並調控所有階層之運作。 
 
 
圖 20. Cross-Layer Manager 
 
表 4 各階層之 Events 和可供調控的 Variables 
 
 
    近年來，由於無線通訊及行動計算技術的日新月異，使行動通訊者及服務提供者處
於異質的網路環境中。此種異質性存在於無線存取技術、網路、使用者終端機、裝置設
備、應用程式及服務提供者等。基於下列理由，這些異質性在可預見的未來不太可能消
失： 
 
1、應用程式需求的多樣化，以致於很難找到單一最佳化且全面性的解決方案。 
2、基於競爭公司佔領市場的渴求，許多擁有專利的系統紛紛相繼釋出。 
 
    因此，一個異質環境提供 Seamless 且 Adaptive 的服務品質，將是下一代無線通訊
系統的致勝關鍵之一。未來，提供使用者符合經濟效益、無所不在、無處不連以及高服
務品質的網際網路是最基本的需求。然而，在一個異質無線網路環境中，應用程式可能
因為不同的網路狀況，而使得執行效能降低，而這些效能的波動將被大範圍的散佈開
來。為了解決這些問題，必須有一個能讓上層應用不受底層變化所影響的 QoS 設計，以
確保服務品質的提供。本計畫的研究將著重於目前 TCP/IP 階層式架構中 QoS 不足的部
份提出解決策略，以下茲介紹國內外研究實例，說明 QoS 在有無 Cross-layer、Cognitive、
4G-IMS Network 支援情況下的差異。 
 
 
37 
 
 
圖 22.利用緊密耦合建立 Session 的訊號流程 
 
IMS 的 QoS 機制是為了取代「最佳效率」狀態而設計，以確保所提供的傳輸品質。
IMS 的 QoS 機制為確保封包傳輸的品質，經由對相關網路狀態參數如傳輸率、閘道延
遲及錯誤率之量測，使得 Resource 可事先被保留。用戶可依據服務形式及用戶環境，指
定要求的 QoS。IMS 中「智慧型」的 QoS Request，被稱為政策決策功能 (Policy Decision 
Function，簡稱 PDF)模組(運作架構如圖六所示)，藉由 PDF 模組與基礎分封網路之間的
互動，控制基礎分封網路資源的分配(透過 Go Interface 至 GGSN)。 
 
圖 23. IMS Policy Decision Function 運作架構 
 
在 IMS 標準中，明確地規範 QoS 參數可在兩個 UE (User Equipment)的 Session 建立
前，先進行協商動作。其目的在於檢查兩個 UE 之間的各段連線是否有足夠的 Resource
可供運用，當 QoS參數被確認後，IMS Network 則會要求 Core Network 及 Access Network
為該 Session 保留 Resource。 
 
當 UE1 對 UE2 發出 INVITE Message 時，該 Message 會夾帶 QoS Proposal (Request)，
此QoS Proposal則會分別於UE1及UE2的S-CSCF(Serving-Call Session Control Functions)
檢查其 Subscription Level，並確定 QoS 參數。其後，UE2 會回傳其所屬之 QoS Proposal，
此 QoS Proposal 也會於 UE1 及 UE2 之 S-CSCF 檢查 Subscription Level，並根據此 Level
確定 QoS 參數。最後，UE1 會接收 UE2 的 QoS Proposal，並開始建立 Session 或是根據
SIP UPDATE Message 做出 Renegotiate 的動作。透過 SIP Message 傳遞 QoS 參數，使得
Session Data 得以藉由 Session Description Protocol (SDP)傳輸。 
 
 
2.3.2 Cross-Layer Issue 
 
AMC with ARQ 系統 
  在無線環境中進行資料傳輸，無線傳輸媒介並不如有線網路穩定。無線訊號時常面
39 
 
 
圖 25. ECN Bit 系統架構圖 
 
ECN Bit 系統主要提出的概念是由 Physical Layer 直接將即時的網路環境狀況，向上
反映至 Network Layer,運用 IP 表頭的附加欄位作標示，以便區隔 Congestion 及 Channel 
Fading 這兩種情況所造成的封包遺失，也同樣屬於利用 Cross-Layer 的設計理念，以確
保 QoS 的實例。 
 
WQE（Wireless Quality Enhancer）系統 
WQE 系統(如圖 26 所示)主要是在無線網路中，加入 WQE 裝置至 AP 有線端。上
層的應用程式會將該應用之 QoS 需求附加在每個資料片段，傳遞到 Network Layer；資
料流在網路傳遞時，在 IP 表頭的延伸欄位附加相關資訊以供區別 QoS 的需求。WQE 系
統裡的 AP 能夠依據不同 QoS 的需求，以不同的傳送策略進行傳遞。假如遭遇 QoS 需
求無法識別的封包，便會將該封包送到 WQE 設備，由 WQE 依據該封包的 QoS 需求，
來指定適當的傳送策略，再將此傳送策略讓 AP 知道，並由 AP 依據 WQE 所指定的傳
送策略來進行傳送。 
 
 
圖 26. WQE 系統架構圖 
 
WQE 系統設計即從上層的 Application Layer 跨越至 Network Layer，將 Application 
Layer 的 QoS 需求，利用附加資訊的方式通知下層的 Network Layer 知道，再利用此附
加資訊，依循不同的傳送策略進行傳輸。 
 
一些具有代表性的跨層式設計方案如圖 27 所示。更具體來說，跨層式設計在各層
會利用到的參數如下。  
應用層： Application Types, QoS Requirements 
傳輸層： Rate Allocation, Rate Control  
網路層： Routing Policy, Admission Control 
MAC 層： Channel Assignment, Scheduling 
實體層： Rate Adaptation, Power Control 
 
41 
 
 
Dynamic Channel Sensing Management 
  在感知無線系統裡，利用 Channel Sensing 的策略感知其它使用者的存在，不僅影響
到感知無線技術的使用者本身，也連帶地影響到其它使用者。所以藉由 Orthogonal 
Frequency Division Multiple Access (OFDMA)之技術，開發出在感知無線技術系統上有效
率的 Channel Sensing 管理。為了增進整個系統的效能，上述所提及方法，為利用頻率選
擇性衰減 (Frequency-Selective Fading)的 Channel 與考慮不同類型的主要使用者之
Multiuser-Diversity。其結果顯示，當減少主要用戶的等待時間，可增加感知無線技術系
統的利用度。 
  圖 29 所示，利用 Fixed Quiet Interval 可感知主要使用者的存在。在此 Interval，當
所有感知無線技術的使用者停止傳送和接收資料時，稱之為 Quiet Interval。由於感知無
線技術系統只能夠在此 Quiet Interval 感知主要使用者的存在，所以為了在短時間內搜尋
到主要使用者的存在，Quiet Interval 之間的間隔不能過大。基地台與其廣泛使用者構成
具 OFDMA 的 Cognitive Radio Downlink 系統。為了減少在 OFDMA 系統之上層被
Subcarrier 控制，在此由多個 Subcarriers 構成的「子通道」，可以用來作為控制的單元。
而每個具有子通道的系統，由 Channel 凝聚頻寬之內的 Adjacent Subcarriers 所構成。此
外，系統時間被切割成 Frames，每個 Frame 由 OFDM Symbols 所構成(如圖 30 所示)。 
 
 
圖 29. Fixed Quiet Interval 
 
 
圖 30. OFDMA Frame Structure 
 
  此研究設計出具 OFDMA 的感知無線技術系統之動態感知的排程程式，以減少主要
使用者的感知時間，增加感知無線技術系統的利用度。與採取 Fixed Quiet Interval 的策
略相比，此研究提出的設計具有頻率選擇性衰減的優點，增進 Channel Sensing 的效能。 
 
Self-Aware Networks and QoS 
  在各種相關的網路架構中，以 QoS-Driven Routing Protocol 為核心的架構，稱為
Cognitive Packet Network (CPN)。CPN 是一種封包路徑選擇(Routing)的協定，此協定藉
由即時線上量測的數據，選擇使用適合的技術進行路徑選擇。執行 CPN 的必備條件中，
其中一項為第一次進行隨機搜尋時，CPN 即使沒有初始值也能夠自我啟動(Cold Start)，
並經由執行的紀錄，逐步地改善其行為。由於網路的主要功能是將某一來源(S)的封包轉
送到某一目的地(D)，因此 CPN 必須具備即使沒有轉送路徑的資訊，還是能將封包從 S
轉送到 D 的功能(如圖 31 所示)。 
 
43 
 
（MNO）之間，可將其視為進行服務整合的扮演角色，並針對用戶訂閱和文件配置進
行管理，因此，為了 MVNO 及傳統 MNO 用戶的出現，除了與 MVNO 合作外，傳統運
營商還需要與其他競爭者的服務進行整合，以獲得營運上更大的營收利潤。 
 
Multi-Agent System 
  Multi-Agent Systems (MASs)是由多個代理者(Agent)所構成的，MASs 是屬於
Distributed Artificial Intelligence (DAI)系統之一環。DAI 系統是任務分派、協調、合作與
代理者之間的相互作用語言相關研究之先驅。MASs 的研究目標比 DAI 的目標更寬廣，
其中包含了代理者的分散式網路系統。雖然 MASs 沒有標準的定義，而在 Jennings 所發
表的 Paper 中，定義了三個概念：Situated，Autonomous 和 Flexible。Situated 指的是代
理者在他們的環境中，可以感覺和行動。有別於一般對代理者的認知，其定義中有不完
整知識、環境的部份控制權或兩者兼具。Autonomous 指的是代理者能夠像人類般自由
地行動，或代理者會考慮其它代理者於自主程度上的限制。Flexible 指的是代理者針對
環境變動適時做出反應甚至預先行動，並可以與其它代理者互動，甚至和人們互動，就
如同人們彼此互相幫助解決問題。 
  Dietterich 描述一個標準代理者模組應包括四個主要部份：觀察、行動、推論引擎和
知識庫。在代理者模型中，推理和學習是使用推論引擎和知識庫相結合的結果。而推理
是推論引擎從知識庫收集相關的資訊、知覺的輸入和行動的集合來決定的即時過程。學
習是較長期的過程，藉由推論引擎去評估其關係，譬如比較過去行動和當前觀察之間的
關係，或在並行的行動之間觀察等，並將其觀察的結論轉換成知識，再存放於知識庫。 
 
  Wooldridge 提出兩個影響 MASs 研究的要點： 
  Agent Design(AD)：創造出能夠自主地完成任務的軟體代理者。Society Design(SD)：
創造出在不明確的環境中，能夠藉著某種程度上的互動，完成任務的軟體代理者。 
  其中，在 SD 設計上，可以使用自我組織(Self-Organization)的方法。此外，軟體代
理者也被設計成能夠在大型環境及分散式環境裡運行。因此，MASs 具備幾個特性讓其
能夠去描述 Cognitive Network (CN)行為：其方法能夠滿足複雜的系統，讓不同程度機器
學習，能有自然均勻分佈的特點，以及在非穩定的環境裡仍可運行。由於 MASs 本身具
有互動性，利用這些特點，使得 MAS 的自我組織及緊急處理性得以滿足複雜的系統。 
 
 
2.4 子計畫四－行動管理與媒體存取協定 
 
本子計畫” Cross-Layer Design for Cognitive and Cooperative 4G-IMS Wireless 
Net-works-Mobility Management and MAC Protocol” 於整合型計畫中扮演一個重要的角
色，目的是在我們必須使用感知無線電終端設備（Cognitive Radio Device）去獲得在授
權頻帶中閒置的頻帶且不影響授權用戶情況下使用此頻帶。軟體無線電（SDR）具有的
感知（Cognitive）能力可以感測（Sensing）可用的無線電的訊號，在此我們稱為頻譜感
測。感知無線電媒體存取控制（Cognitive Radio Medium Access Control）簡稱 CR-MAC，
CR-MAC 可以去配置可利用的頻道（Channel）且進行存取達成資料傳送至目的地。為
了讓 Cognitive 特性發揮至最佳化無線電終端設備不僅能借用自己所屬範圍的空閒頻
帶，加入相互合作（Cooperative）的概念還可以感測本身範圍以外的可用頻帶，增加可
使用頻帶使得整體產能（Throughput）大幅提升。 
第三年主要工作在於把前兩年的成果做整合，我們將著重在 Miobiliry 
45 
 
 
圖 34.感知無線電節點的網路架構圖 
 
在前一年度計畫中，我們初步完成一個支援 IMS 應用服務的多重連線機制，但當時
並未充分利用感知無線電的頻譜偵測與配置特性選擇更合適可用頻帶進行通道配置，故
本年度的研究重點將探討利用感知無線電的感知特性：頻譜偵測與頻譜配置，在感知無
線網路下設計支援多重連線的換手機制，來達成行動通訊裝置在個人化網路選擇機制最
佳化目的，甚至可透過行動裝置的多重連現能力達到協力傳輸通訊之效。 
本子計畫是以 GNU Radio 與 Universal Software Radio Peripheral (USRP)建構計畫所
需的 SDR(其架構如圖 35 所示)。透過實作出頻譜掃描機制來偵測環境中連線品質較佳
的頻率作為換手的依據，解決當多位使用者對於頻譜競爭時所產生連線換手問題，以驗
證本子計畫所提出以動態頻譜偵測於連線換手改善機制上，是否能加強網路連線品質，
以達到 4G-IMS 應用服務在跨網通訊時依然仍保持通訊與服務的順暢。 
 
  
圖 35. GNU Radio 與 USRP 建構的 SDR 硬體架構 
 
47 
 
其主要架構如圖 36 所示，可分為: 
 Cognitive Radio Shell - CRS 
 Cognitive Engine - CE 
 Policy Engine - PE 
 Service Management Layer - SML 
 Software Defined Radio Host Platform 
 
CROSS 已完成 Cognitive Radio Shell、Cognitive Engine 以及 Software Defined Radio 
Host Platform 的連結， 其他元件實做尚由維吉尼亞理工大學 wireless@VT 實驗室團隊
進行中。Cognitive Radio Shell 為 CROSS 主要結構，透過 socket 建立與各個元件的連
結，用以進行溝通與訊息交換，初始設定時會載入一以 XML 格式撰寫的配置檔案進行
系統配置，分析 XML 中描述的參數建立資料庫中的資料表，提供感知資訊儲存，同時
亦設定感知無線電組態傳送給其他元件，例如：Policy Engine、Service Management Layer 
等，最終用於 Software Defined Radio Host Platform 及 Cognitive Engine 的雙向資料溝
通。Cognitive Engine 則依照從Cognitive Radio Shell 解析之配置資料對 Software Defined 
Radio Host Platform 感知行為，同時針對感測結果進行計算並儲存相關資訊。由 Software 
Defined Radio Platform 執行感測程式，結合 GNU Radio 專案及開放式硬體設備
(Universal Software Radio Peripheral, USRP)執行感知程序，提供其他元件需要的感測資
訊以及對於環境中的無線電狀態感知。 
 
Cognitive Radio API
Policy Engine API
Cognitive Radio Shell
Policy Engine
Radio 
Front End
XML 
Configuration
Se
rv
ic
e M
an
ag
em
en
t L
ay
erCognitive Engine
(CBR)
Cognitive Engine 
(Neural Net)
Software Defined Radio 
Platform
Host Application
Se
rv
ic
e M
an
ag
em
en
t La
ye
r A
PI
 
Co
gn
iti
ve
 En
gi
ne
 AP
I
 
圖 36. 無線電開放原始碼系統架構 
 
透過 CROSS 架構設計區域感知引擎，透過頻譜感測資料整合至感知程序進行對環
境的回授與控制，達成完整規劃的頻譜分配與使用，除了整體頻譜使用規劃以外，感知
引擎還能夠依據使用者過往的歷史資料與使用服務的需求，執行進階的無線頻譜與資料
調整。同時與 IMS 進行整合通訊的全域感知引擎，讓感知引擎能夠將資訊彙整於 IMS
的家用戶資料庫，進行整體網路資源分配。 
 
本研究提出的區域感知引擎架構如圖 37 所示，構築於 CROSS 之上，並且能夠在
Application Layer、Bearer / Media Plane、Signaling / Control Plane 以及底層的 Access 
Network Layer 進行通訊，全域的資料交換以 IMS-SIP 進行，將資料儲存於 IMS 的家用
戶伺服器之中，達到全域的資料交換。 
 
49 
 
 
圖 38. XML 參數配置 
 
 
3.1.3 全域感知引擎設計 
 
此部分研究結合前述區域感知引擎及網際網路多媒體子系統，提出服務導向之感知
全域感知引擎。在本計畫環境中使用者進行 End-to-End 通訊、使用服務及整體網路控制
時，須同時考量多種因素，例如使用者的位置、節點電量、使用者服務要求、時間及使
用之通訊技術等。透過收集個別使用者感知引擎資訊進行無線網路資源分配，在使用服
務及通訊時滿足個別使用者的需求，同時達到整體網路的最佳化效益。 
 
為了滿足服務導向及資源分配最佳化，對於全域感知決策採用多目標最佳化
(Multi-Objective Optimization, MOO)方式降低最佳化過程複雜度。在實際網路連結情
況，許多因素必須同時考慮，透過多目標最佳化更能符合整體網路真實狀況。多目標最
佳化（MOO）模型可以表示為從 M（M >= 2）決定向量映射至 n 的目標向量如表 6: 
表 6 多目標最佳化模型 
Minimize 
 
subject to 
 
 
 
　 結合區域感知引擎及全域感知引擎有三個優點: 
51 
 
圖 39. 區域感知資訊 SIP/SDP 格式 
 
根據全域感知引擎多目標最佳化，本研究設定參數如表 8 並同時設定參數  組
成目標方程式: 
 
 
 
表 8 全域多目標最佳化參數 
n 使用者節點 
c  頻道 
s  基地台 
f  服務 
Cns 使用者 n 連結基地台 s 所需成本 
Sl 基地台 s 最大連結數 
SL 基地台 s 最大負載量 
 
全域感知引擎多目標最佳化如表 9，目標方程式 FD, FL 和 FQ分別代表連結成本、
網路負載平衡情形及整體網路服務品質。本研究全域感知多目標最佳化策略為達成整體
網路最低連結花費並同時滿足所有基地台平衡負載及使用者服務品質要求。除了目標方
程式外，全域感知策略另有二個限制：每個基地台的連結限制在各個基地台最大連接數
及負載量之下以避免使用者發生干擾及斷線的情況。 
 
表 9 感知引擎多目標最佳化方程式 
Minimize 
  
Subject to 
                 
         
 
使用者和基地台間的距離會影響功耗及干擾機率。在連結成本目標方程式中，
是使用者 n 和基地台間的距離 DS與基地台傳輸範圍 RS的比值，同時為使用者 n 連結
基地台 s 的鏈接成本。我們統計每一個使用者的鏈結成本 FD，以達到整個網絡的最低連
結成本。 
53 
 
Name Maximum Throughput 
(DL) (kbps) 
Minimum Throughput 
(DL) (kbps) 
Maximum Throughput 
(UL) (kbps) 
Minimum Throughput 
(UL) (kbps) 
Web 128 64 64 32 
FTP 1,000 0 100 0 
Video 64 64 64 64 
VoIP 12.2 12.2 12.2 12.2 
 
針對全域感知引擎多目標最佳化我們搭配基因演算法加速決策計算，本研究使用
Non-dominated Sorting Genetic Algorithm-II (NSGA-II)進行最佳化，一般多目標最佳化使
用基因演算法之時間複雜度為 O(GMN2)，G 為子代數，M 為目標方程式數量， N 為子
代人口大小。透過 NSGA-II 可將時間複雜度降至 O(GN log M-1N)。 
 
我們將每個使用者的感知資訊組合成染色體，透過基因演算法及目標方程式進行演
化計算最佳化。圖 40 顯示染色體由 n 個子序列組成 ，每個子序列代表一個使用者的
區域感知資訊分別為連結頻道、連結狀況及相關資訊、服務品質要求及目前使用頻寬，
並使用 uniform crossover(圖 41) 進行交配以及突變來產生子代。 
 
圖 40. 感知資訊染色體結構 
 
 
圖 41. Uniform crossover 
 
 
55 
 
  
(e)最後， 。 
 
 
3.2.3 Advanced Encryption Standard (AES) 
經由我們的會議金鑰交換協定所溝通出來的金鑰，根據使用者應用程式的需求，此金鑰
可用於串流加密或區塊加密演算法，在此我們簡單介紹區塊加密演算法 AES [3]，AES
是於 2001 年由 NIST 由許多加密演算法中選出，其特性是運算速度較快，並且非常容易
實作於硬體上，運算過程中所需求的記憶體也比較少，其提供 128、192、256 等金鑰長
度，使用者可根據安全需求決定金鑰長度。AES 運算可分為 AddRoundKey、SubBytes、
ShiftRows 與 MixColumns。 
 
圖 43. SubBytes 
  如圖 43，SubBytes 的運算過程中，會將 座標上的位元組取代成 的內容，
即 ， 是一個固定內容的矩陣。 
 
圖 44. ShiftRows 
  ShiftRows 的運算是 不改變， 往左移一格， 往左移兩格，
往左移三格。 
57 
 
 
圖 47. Challenge-Response Authentication 
  如上圖 47 所示，client 端選擇一個亂數 傳送給 server 後，server 利用自己的私鑰
對 進行簽章，並選擇一個亂數 傳回給 client 端，client 端使用 server 的公鑰對 的簽章
進行驗證，如果驗證成功，client 即確認 server 身份的正確性。接著 client 再用自已的私
鑰對 作簽章並將簽章傳送給 server，server 使用 client 的公鑰驗證此簽章是否正確，如
果驗證成功，server 則確定了 client 的身份。但在我們於 4G-IMS 無線網路環境中所欲達
成的感知認證機制，基地台並無法與行動裝置作任何互動式的交談，因此
challenge-response 並不適用在我們的協定。我們的認證協定必須做到由基地台單方面的
傳送特定認證訊息，任何在基地台所涵蓋範圍底下的行動裝置，都可以利用收到的認證
訊息，判斷哪些基地台是可以信任的，而不需要透過互動式的交談。此達到單方向的認
證，首先要克服的問題就是 replay attack，當某個基地台發送認證訊息時，附近的攻擊
者可以截取整個認證資訊，再將此認證訊息轉送給位於其他區域下的行動裝置，並假冒
此基地台與行動裝置進通訊，因此為了讓行動裝置可以判斷收到的訊息是不是被重送過
後的訊息，我們採納了 timestamp 的概念，將每個認證訊息都加入了時間，利用時間差
來判斷認證訊息有無被重送，如此可避免 replay attack 的問題。 
 
 
3.2.5 雜湊函數 
資料在網路中傳遞，為了要達到資料完整性(data integrity)，常會使用到雜湊函數來達成
目的，利用雜湊函數可讓接收者確認所收取到的資料與傳送者原先所傳送出來的資料一
致性，並未遭受到中間人竄改。一般而言一個雜湊函數 有下列兩項特性： 
(1) 碰撞抵抗性：無法找到 與 使得 。 
(2) 單向性：給定一雜湊值 ，無法找到 使得 。 
 
3.2.6 簽章系統 
在我們的感知認證機制下，當基地台發送認證訊息時必須針對時間資訊作簽章，目前大
部分的簽章系統都採用公開金鑰架構(Public Key Infrastructure)，即每個人都有一金鑰對
與金鑰憑證，金鑰憑證是信任的第三方憑證中心(Certification Authority)所簽署的合法憑
證，驗證者收到一份簽署的文件後，必須先驗證憑證以確認其公開金鑰的正確性後，在
驗證簽章，如圖 48 所示。 
59 
 
(b) 計算 。 
(c) 驗證是否 ，如果等式成立則此簽章通過驗證。 
 
 
 
3.3 子計畫三研究方法 
以下介紹本研究所提出相關模組設計以及跨層式 QoS 策略演算法連結 Charging 
System 提供之計費機制與控制功能。 
 
3.3.1 4G-IMS 架構 
圖 49 為整體 4G-IMS 環境架構圖，本研究將 QoS 決策建立於 IMS 中 P-CSCF 模
組上，對所有通過 P-CSCF 的 Session 進行分析，並將決策後的結果，在不同存取網路
的 Gateway 上進行流量的控管，並針對使用者的網路環境，判斷是否符合使用者 QoS
的需求，再進行 Adaptive QoS 決策，挑選最適用的存取網路進行換手，以滿足使用者
對 QoS 的要求。 
 
圖 49. 4G-IMS 環境架構 
基於 Cross-layer、Cognitive 和 Cooperative 概念，本研究擬開發一套 C3QM 系統，以確
保 4G-IMS 網路應用之服務品質和資源妥善管理，並改善使用者對於服務品質的觀感。
圖 50 為 4G-IMS 架構模組圖，其中分為資料層（Data Plane）、控制層（Control Plane）
與知識層（Knowledge Plane）。資料層的主要功能是負責資料的收集與傳送及對資料流
的處理並且收集 TCP/IP 各層的資訊和網路狀況的資料，提供至控制層和知識層進行分
析及管理；控制層主要目的是負責 QoS 的控制及訊號處理，提供資料層與知識層每項功
能執行時所需的控制訊號。控制層收到資料層傳來的訊息，再依所設計的功能來做處
理，並將控制訊號透過資料層進行處理及傳送；知識層則是基於 MSM (Multi-Service 
Agent Model)架構的系統，在物件導向式的 Multi-Agent 系統模組中，每種 Agent 都是主
動式的物件，能夠同時獨立工作。 
 
61 
 
在服務層，基於從網路接收到的承載使用請求控制承載使用，如 IMS；在子系統
層，基於從網路（如 IMS MRFC）接收到的會談資訊使用請求控制資源的可用性，
如：准許或拒絕資源使用；在服務層，基於從網路接收到的應用伺服器請求控制
應用服務的可用性，如：准許或拒絕服務的使用。 
 SBCF：執行基於會談的計費和信用控制。其 SBCF 與批價功能通訊決定請求的承
載資源和請求的會談的值，與帳戶結算管理功能(ABMF)通信查詢和更新用戶帳戶
及 Timer 的狀態。而 SBCF 也分為三層應用：在服務層，基於從網路接收到的服務
使用請求控制服務使用，如允許的時間或流量；在子系統層，基於從網路（如：IMS 
CSCF）接收到的會談資源使用請求控制會談，如：准許或拒絕會談建立請求、結
束已有通話。在服務層，基於從網路接收到的服務使用請求控制服務的可用性，
如准予或拒絕服務使用。 
 RF： RF 可決定費率或可計費事件的價格，如每秒的呼叫、數據流量、多媒體會
談、Web 內容等價格。根據從 Charging Gateway Function(CF)接收到的批價請求(價
格或費率請求)，RF 針對各種批價參數(如服務標識、網路標識、用戶位置、服務
使用時間、傳送資料量等)評估請求，決定可申請的價格或費率模型，並返回給計
費功能 CF。為支援線上批價處理，RF 需要 Timer，Timer 可由 RF 或 ABMF 維護。
不維護 Timer 的 RF 稱為 class「A」RF，維護 Timer 的 RF 稱為 class「B」RF。RF
功能包括：流量批價（如針對接入網路實體的計費）；時間批價（如針對 SIP 應
用的計費）；事件批價（如針對 Web 內容或 MMS 的計費）。 
 ABMF：主要負責 QAM Charging System 最後結算之模組。 
 
2. Offline Charging Module：QAM Charging System 中 Offline Charging Module 與傳統之
分封交換網路計費方式不同。Charging Data Function(CDF)在接收完同一網路元件針
對同一通話過程所產生之計費訊息之後，合併生成 Charging Data Record(CDR)。另
外，CDF 針對單一網路元件生成的 CDR 不包含通話的所有訊息。Billing Domain 模
組在獲取到同一通話內所有網路元件在CDF生成的CDR後，可以獲得所有計費訊息。 
 
基於上述機制，QAM Charging System 將提供完善和靈活的計費策略。由於次世代
行動通訊網路可提供的服務類型非常豐富，不同服務、不同內容可以採取多樣的計費策
略，QAM Charging System 的計費機制可有效應用於靈活多變的計費需求。因此，當新
的計費策略引入時，營運商不需要對控制層和服務層網路進行改造，可修改些許參數與
設定，即可運作 QAM Charging System，用以實現相關計費功能。 
 
3.3.3 Charging 策略 
本研究之Charging策略依據前兩年所定義之QoS機制，按照 3G、WLAN 及WiMAX 
QoS 規格，將不同類型之應用程式分為 Interactive Class，VoIP，Video/Audio Streaming
以及 Best Effort 等四個類別(如表 11 所示)，每類應用程式具有不同的 QoS 需求，結合
由感知能力所獲取的 RSSI 值進行 QoS 的決策，判斷是否有更合適的存取網路提供使用
者進行 Handoff 以獲得最佳的傳輸品質，如現有網路環境無法滿足眾多使用者時，再啟
動 Charging 機制。當使用者的網路環境遭受到雜訊干擾時，系統就會根據使用者帳戶的
權重值去判斷是否請求更好的 QoS，有較高權重值的帳戶便會啟動 QoS 策略機制，以
保證應用程式所需的 QoS。 
表 11 QoS 分類等級 
63 
 
境狀態提出一個 QoSnetwork 變數，這個變數可由四項環境參數(BER、Segment Order、
Segment Loss、Segment Delay)所組成。如此再將這 QoSnetwork 變數與上述兩個參數結
合，本研究可得一 Cost 值，如方程式(2)所示，並以此 Cost 值為依據，使得 QAM Charging 
System 進行相關服務規劃。 
Cost= QoSclass * QoSstreamID * QoSnetwork     (6) 
 
圖 52 為 Charging System 費率決策之演算法：一開始使用者會向系統請求所要的應
用服務，當 Charging System 接收到所需求之服務類型之後，再根據所定義之 QoS 流量
等級表去判斷相應之 QoS Stream ID，選擇出適合此服務的 QoS 配置，若有多個候選網
路符合條件，則選擇 RSSI 訊號最強的作為目標網路，進行 Handoff，以確保使用者在通
訊時能擁有最佳的 QoS 品質保證，如網路環境無法支援現有之 QoS 配置，則依循使用
者帳戶之 QoSclass 去做更進一步的決策，越高的 QoSclass 將可優先使用最佳之
QoSnetwork，當服務確定要發送之前，便會傳送給使用者服務費率之計費請求，完成整
個標準費率決策。 
 
 
圖 52. Charging System 費率決策演算法 
 
圖 53 為 Charging System 費率決策之流程圖，首先針對使用者所要求的應用服務進
行 QoS 相關參數的擷取與運算選擇最佳的 QoS 狀態，接著判斷是否有滿足此 QoS 最佳
的網路環境，若有最佳的 QoS 網路環境，便可依照本研究定義之公式決定其費率；若沒
有則判斷此使用者帳戶的 QoS 等級是否高於同一網路環境的其他使用者，有的話便將使
用者的網路切換到最佳的 QoS 網路環境，沒有就降低此應用服務之 QoS 等級，其最後
定義之費率也會隨之降低。當費率決定之後，才會開始計費的動作，扣除使用者帳戶的
Credit。 
 
65 
 
 
圖 54.系統模型 
 
 
圖 55. SU、RN 結構 
 
中繼技術對於增加無線系統的穩定性，功率和覆蓋相當有效，並且不會消耗額外的
頻寬。中繼站可分為兩種類型，靜態和動態的中繼（relay stations, RSs）。靜態的 RS 是
指固定中繼節點設置在特定或邊緣的位置。 
動態的 RS 則是指移動站（mobile stations, MS） 
也扮演中繼站的腳色並且其位置可能會隨時間而改變。設置動態 RS 是一個非常有效的
機制，因為不需要額外的公共設施成本，具非常高的自由度。在本研究中，我們嘗試採
用動態 RS 的策略，使一些 SUs 充當 RSs。 
67 
 
圖 58.在情境一下之環境觀察階段例圖 圖 59.在情境二下之環境觀察階段例圖 
  
 
(b) 環境觀察階段：  
讓 RNz定義為第 z 個可存取當前服務中 eNB 的動態 RN，並且 RN’w 則定義為第 w
個可以存取下一 eNB 的動態 RN。SUx 藉由 SDR 裝置接收頻譜資訊。其中頻譜資訊包含
從當前/下一個 eNB 測得的 SNR 值、資源區塊 (resource blocks ,RBs)的使用狀態和被 SUx
及其周邊裝置所使用的頻譜空閒區間。我們藉由 SNR 值和資源區塊的數量還定義傳輸
率。圖 58 及圖 59 表示在情境一及情境二下 SUx 定期感測所有可用資源區塊的頻段，
包含動態 RN’w 的存取頻譜狀態以獲取占用 RB 的頻率訊息。空閒頻譜區間 SHi包含 mi
個資源區塊。而 則代表第 mi個 RB 在此期間被占用的累積次數。 
較大的 意味著第 mi個 RB 被 PUs 占用的頻率相當高。也代表了 SUx 對第 mi個
RB 使用率相當的低。至於較小的 意味 SUx 對第 mi個 RB 使用率相當的高，有較低的
機率被 PUs 占用導致中斷。SUx 將利用 SNR 值來得知相對位置資訊及傳輸質量。環境
觀察階段過程如下： 
1. 每一個 SUx 在存取當前 eNB 的傳輸覆蓋區域中會定期感測所有的頻段 RBy，其 
2. 中  。在一段時間中，對於所有的被佔用的頻率 也
將會被觀察並記錄 RBy。基於 OFDMA 技術，有些相鄰的持續的閒置的 RBy可以從
空閒頻段區間 SHj ，其中 。因此可以得到一連串的空閒頻譜空間
。 
3. 當 SUx 檢測到空閒頻譜區間 SHx 將會從候選 RN 集合中被 PU 回收，接著 SUx 會廣
播一個請求訊息給 SUx 的鄰居，並且等待中繼訊息去獲取空閒頻譜區間的資訊並且
從這些候選 RN 集合獲取鄰居的 SNR 值。否則重新執行步驟(a)。 
4. SUx在RNs的協助下執行計算及分機階段去執行是否頻譜移動或切換以及是否要藉
由 RNs，取決於 TE(SHi)的數值，TE(SHi)是被計算出的剩餘胡務資料量。 
對於情境一，圖 58 中表示， SU1從舊 eNB 收到了 SNR 值 10dB。然後 SU1廣播一
個訊息去給候選中繼節點 RN1及 RN2，並且接受他們的 SNR 值及頻譜資訊。圖 58 亦表
示 SH1、SH2及 SH3分別為 2RB、3RB 及 4RB。圖 59 則表示若一個 PU1移動到舊 eNB
的範圍並且回收被 SU1 占用的頻譜。該 SU1 進入新舊 eNB 的範圍交疊區域，其各個的
69 
 
個資源區塊 RBs，SH’i在時間 中不被 PUs 占用的機率為： 
 
圖 60(a)顯示了情境一下的範例， 的 值為 10dB。此外在圖 60(b)則表示
, 及 個別的傳輸速率為： 
 
 
 
, 及 個別的服務傳輸所需時間分別為： 
 
 
 
不被占用的機率 
  
  
 
(a) (b) 
圖 60.在情境一下階段三階段四例圖 
 
圖 61(a)則顯示了情境二下的範例，並且 及 為 10dB 及 15dB。圖 61(b)則顯示了 及 
個別的傳輸速率為 
 
 
舊 eNB 擁有之 及新 eNB 擁有之 個別服務傳輸所需時間為： 
 
 
不被占用的機率 
 
 
(d) 評估及傳輸階段：  
最後在這個階段要計算出若在 與新/舊 eNB 間的網路資源較貧乏的預期執行時
71 
 
，否則將回執行換手程序。 
圖 62. scenario 1 的 resource blocks 之間的關係。 
 
圖  62(b) 顯 示 了 評 估 及 傳 輸 階 段 的 例 圖 ， 的 預 期 傳 輸 時 間
  
， 的預期傳輸時間 。
的預期傳輸時間則如圖  62(b)所示。可發現最小的預期傳輸時間為透過 使用
。因此， 會在原先連線的 eNB 執行頻譜移動。當 從 接收資料，並且傳送
中繼資料給原先存取的 eNB。圖 63(b)則顯示另一個評估及傳輸階段的例圖，在使用
存 取 原 先 eNB 的 預 期 傳 輸 時 間 為
，並且透過新的 eNB 存取
預 期 傳 輸 時 間
。其餘的預期傳
輸時間請見圖八(b)。可發現最小預期傳輸時間為使用 使用 。因此 會執行換手
透過 去存取新的 eNB。當 從 接收資料，動態的中繼節點 會中寄資料給新
的 eNB。 
在性能分析方面，我們分析了 total transmission time 及 throughput。圖 65 以及圖 66
所示，在未授權使用者傳輸下一個封包時，必須先滿足該存取的頻譜中每個 resource 
block 都不被授權使用者佔用。一旦某一個 resource block 被佔用，則跳至換頻譜的狀態。 
在 non-overlapped area 下，假設目前所要傳輸的封包數為 N 且目前的頻帶分為 j 個
頻譜可以被未授權使用者使用，則全部封包的傳送時間為： 
  
為換手所需要的時間且 為不需要變動的時間。 
需要換手的時間為換手的機率乘上換手所需要的傳送時間與傳送一個封包的時
間，再加上透過 RN 幫忙轉送的機率乘上傳送一個封包的時間。 
73 
 
 
  
(a) (b) 
圖 64. (a) Total transmission time vs. data size of scenario 1. (b) Total transmission time 
vs.number of PUs of scenario 1 
最後，在 overlapped 的總傳送時間為(9) 
而在 overlapped 的 throughput 與(5) 相同。 
接下來是模擬結果的部份圖 64 為 Total Transmission Time (TTT)與 number of PUs
跟 data size 之間的模擬結果，圖(a)說明考慮到 data size 大小，我們的方法比最小預期傳
輸時間和最大閒置時間的方法還要低。圖(b) 說明考慮到 PUs 的數量我們， 的方法比
最小預期傳輸時間和最大閒置時間的方法還要低。 
圖 65 說明在 scenario 2 下，考慮到 Pus 的數量及 data sizes 大小，當 Pu固定在 0.5 時，
我們提出的方法，隨著 data size 越低，曲線越接近 scheme-A。也可以觀察到 TTT 低於
最小預期傳輸時間，及 MIPv6 的方法。 
圖 66 為 End-to-End Delay (EED)的模擬結果。普遍來說，EED 隨著 spectrum holes 增
加而降低。我們的方法比最小預期傳輸時間和最大閒置時間的方法來的低，原因是我們
採用了 RNs 的中繼輔助。 
圖 67 摸擬在 scenario 2 下 EED 與 PUs 數量和 spectrum holes 的關係。普遍來說，
EED 隨著 spectrum holes 量減少而增加。 
圖 68 為 Number of Spectrum Mobility (NSM) 的摸擬。圖(a)說明了在 scenario 1 下與
data size 和 PUs 數量的關係。NSM 會隨著 data size 的減少而降低。圖(b)的曲線可以比
較出，我們的方法較最小預期傳輸時間和最 
大閒置時間方法來的好。  
圖 68是在scenario 2下的換手次數摸擬，可以看得出來，我們的方法較其它兩種方
法，能有更少的換手次數。 
最後，我們提出了一個在長期演進技術網路下具中繼輔助之感知頻譜移動和換手通
75 
 
圖 68. Number of handoff vs. data size of scenario 2. 
 
3.4.2 Seamless session mobility scheme in heterogeneous wireless networks  
(This result is published by International Journal of Communication Systems, Vol. 24, 
Issue 6, pp. 789-809, June 2011 (SCI IF=0.229)) 
 
圖 69. Network architecture of SmSCTP protocol. 
 
在這篇論文中，提及3GPP R99標準中，UMTS網路服務由以下二部份組成，分別是
circuit-switched (CS)和packet-switched (PS)。UE透過CS服務連線至Public Switched 
Telephone Network (PSTN)，PS服務允許UE存取網路服務。圖 69為PS藉由服務中的
77 
 
線網路，且在UE電量秏盡之前必需獲得最大正常輸出。在full階段，對於異質性網路是
很難去使用SNR值，因為UMTS/HSDPA傳輸的範圍比WLAN大，但WLAN的傳輸速率比
UMTS/HSDPA來得大。因此這篇論文使用可用的頻寬，並根據Shannon capability theorem
來做為換手的依據。 
圖 71標出CMR的影響，其範圍在0.5-1.5之間的訊息消秏，CMR值越高代表UE移動
越頻繁，反之，則表示UE待在同個網路的時間越長。 
 
3.4.3 Protocols and Applications of Cross-layer in Mobility Management  
(A book Chapter in ‘Using Cross-layer Techniques for Communication Systems’, IGI 
Global, 2012) 
於本年度我們編撰了一個書章節，名稱為「Protocols and Applications of Cross-layer in 
Mobility Management」。其中移動管理的設計在下一世代的行動網路是想當重要的議
題。提供無縫的服務切換對於行動站(mobile station, MS)或行動節點(mobile node, MN)
不間斷的服務，在不同以IP為基礎對話的存取網路間的。其中IP的銜接造就了多個以IP
為基礎的無線存取網路科技以及下一世代科技的出現。近年來許多行動跨層設計的研究
成果已可達到最大限度地減少在切換期間的資料遺失以及延遲的問題，令使用者在切換
期間不會遭遇中斷或不可接受的使用經驗。 
為了解決切換的問題，我們提出了一個新穎的協定來減少掃描延遲。一旦掌握了周
圍DVs的物理訊息，他允許OSV廣播網路拓譜訊息 (NTM)給DVs使用預先定義廣播頻
道，當DV進入目標RV的傳輸範圍時，NTM讓DV知道目前哪一個頻道正被使用。 
根據NTM，DV可以調整物理設定，如頻道，而不是等待及接收來自目標DV的訊
息 。透過比較紀錄下來的時間以及速度，DV識別最近的RV。透過從物理層取得的位置
及頻道資訊而進行的MAC層的切換程序互動，提供了一個有趣且有效的解決方案。 
 
 
3.5 子計畫五研究方法 
在『跨層式感知與協力 4G-IMS 無線網路研究』的整合型計畫中，本子計畫主要是
發展 4G-IMS Testbed 上符合 4G IMS 運作的應用服務設計與多重連結技術研究為主，在
第一年已完成 4G-IMS 基本的多媒體應用服務如 SIP-based VoIP、Presence Service、
Push-to-Talk、以及 Video on Demand (VoD)、IPTV、LBS (Location-based Service)皆已實
作完成，而第二年也探究 4G-IMS 以社群網路機制來實現協力的資源共享以及以 SCTP
為基礎的多重連線的 4G-IMS 通訊環境建立，也以 SIP 信令、Accounting 等機制實現跨
各子計畫間的跨層級整合。 
在本年度我們針對以感知無線電機制 Multi-homing 的部分持續研發，並原先使用
Universal Software Radio Peripheral (USRP)架構出一感知無線網路環境，藉由頻譜感知的
技術隨時了解行動裝置換手時通訊頻道使用狀況。接著將偵測所得到的資料導入本子計
畫所提出的換手門檻決策機制以計算出"準備換手"與"開始換手"的 SNR 門檻值。最後根
據門檻值來決定行動通訊裝置在移動時的換手行為。 
 
3.5.1 感知網路下多重連結技術 
本子計畫研究項目將強化一個用於 4G-IMS 行動通訊平台上的無線感知網路環境，
利用跨層式網路多重連線機制來解決在 4G-IMS 網路所面臨的移動性管理問題。首先我
們要參用換手門檻決策機制以決定開始換手動作時機。架構方面，底層會不斷進行頻譜
感知並將目前可用頻道與頻帶資訊通知上層決策機制。最後將應用層 SIP 與傳輸層的
79 
 
 
在行動裝置移動時為了達成服務連續不中斷，需要在 USRP 的多重連線介面間建置
換手決策機制來決定切換連線介面。除了使用者能依其偏好選擇網路連線介面外，網路
花費、傳輸速度、接收訊號強度( Received Signal Strength Indication, RSSI)等都可能會影
響影響換手時機。然而在沒有其他設定的情況下，通常是以網路訊號強度作為最重要的
換手依據。圖 74 為一個以 SNR 值為換手依據的垂直換手情形，其中定義了兩個門檻值
(SNR Sensing Threshold，SST)。 
 
圖 74.以 SNR 值為換手依據的垂直換手 
 
當行動通訊裝置漸漸移動至舊網域邊緣時，感知無線電會根據舊網域的連線狀況來
針對新網路執行頻譜感知，藉由量測新網域的 power dB 得知其頻道可用度(Channel 
availability)，最後將感知新網域所得到的訊號雜訊比(Signal Noise Ratio)與頻道可用度導
入本子計畫所設計的 SNR Sensing Threshold(SST)換手機制計算出預備換手的門檻值。 
其作法是當舊網域的 SNR 值低於預備換手的門檻值，感知無線電會啟動預備換手
機制為換手前的作準備。當行動通訊裝置到達新網域時，感知無線電同樣會量測該網路
的 power dB 以決定該時間點的頻道可用度(channel availability)，最後將先前所得到的預
備換手門檻值與頻道可用度(Channel Availability)導入 SNR Sensing Threshold(SST)換手
機制以計算出開始換手的門檻值。當新網域的 SNR 值高於開始換手門檻值，感知無線
電會啟動開始換手機制來建立換手服務，圖 75 為研究所提出的 SST 頻譜感知機制。 
 
81 
 
道分割方式如表 13 所示。我們以 SDR 來偵測新網域頻道訊號的 power dB 值，得知該
網路的頻道可用度(Channel Availability)，其運作過程為先將頻帶切割成若干的 Resource 
Blocks (RB)，利用頻譜感知找出各個 RB 的 power dB 值。 
經由反覆實驗得知，當 power dB 值變高時代表此一頻段正被使用中。因此，我們
將所有 RB 的 power dB 值加總之後取一個平均值，藉由平均值判斷 RB 是否正被使用。
假如該 RB 的 power dB 值低於平均值便可以判斷為可用。將未被使用且相鄰的 RB 結合
在一起，便形成一 Spectrum hole(SH)，圖 76 為 RB 與 SH 示意圖。 
 
表 13 802.11 頻道範圍表 
 
 
 
圖 76. RB 與 SH 示意圖 
 
對於頻道可用度計算方式是將頻段切割成若干的 Resource Blocks (RB)，透過頻譜感
83 
 
ASCONF_ACK。當 Mobile Node 收到回傳的 ASCONF_ACK 後，位於 Mobile Node 的
SIP module 會根據 B 網域的 IP 對 SIP Registrar 作重新註冊。完成之後，Mobile Node 與
Correspondent Node 便可以經由 B 網域的 IP 作封包的傳輸。 
 
 
圖 77. 行動通訊裝置的模組架構圖 
 
 
圖 78. SST 換手預備流程圖 
85 
 
定，感知引擎啟動時會設定與 Cognitive Radio Shell 雙向溝通所設定之連接埠。連結成
功後 Cognitive Radio Shell 會傳送載入之 XML 配置參數至 Cognitive Engine，設定頻譜
感測效能計算策略，同時建立儲存至家用戶伺服器資料庫中資料表的格式，用以儲存感
測資料，完成後 Cognitive Radio Shell 及 Cognitive Engine 會進行掃描程序，等待由
Software Defined Radio Host Platform 傳送之頻譜感測資料，圖 82 為 Cognitive Engine 收
到由 Cognitive Radio Shell 解析之 XML 配置參數，同時也表示感知引擎啟動成功。 
 
 
圖 81. Cognitive Radio Shell 解析 XML 
 
最後建立 Software Defined Radio Host Platform 以完成整個構築於 CROSS 架構的
IMS 區域感知引擎，此部分由 GNU Radio 軟體套件搭配開放式硬體設備 USRP，透過
頻譜掃描程式進行 802.11 頻帶之頻譜掃描。待測物使用一台筆記型電腦，取得校園無線
網路使用權，透過 GNU Radio 中的頻譜感測函式進行改寫，並整合 Gnuplot 函式庫至其
中進行感測 power 值並繪製出感測結果。當 power 值升高表示感測頻譜中的此段頻帶正
在使用中，同時感測分析結果會經由 Software Defined Radio Host Platform 傳送至
Cognitive Radio Shell，根據 XML 配置的參數轉傳至感知引擎進行 power 值與效能分析。
感測時間、Power 值及分析效能結果會依照先前所設定之資料表格式一併傳送至 IMS 核
心中的家用戶伺服器儲存。家用戶伺服器根據過去的頻帶效能的歷史記錄，提供使用者
對於多媒體服務要求時進行不同頻段的分配。 
 
 
圖 82. 感知引擎啟動程序 
圖 83 是本研究建置的 Software Defined Radio Host Platform，圖 84 則是上層的 IMS
核心網路，依照第三節描述 IMS 感知引擎設計與實現建置而成，經由 SDR 搭配 GNU 
Radio 進行頻譜分析，結果可以藉由頻譜使用狀況圖形來觀察使用者目前所在位置頻譜
使用的情況。圖 85 顯示透過 USRP 感測之 Power 值，在感測時頻帶 2.437GHz 至
2.447GHz 以及 2.457GHz，當頻帶被其他無線使用者使用時，其 Power 值較高，根據頻
譜 Power 圖可以達到尋找頻帶空洞的結果。 
 
87 
 
路可以了解全域使用者目前的情況，以及各使用者不同接取網路、所在位置無線電頻譜
的使用情況，並且 Cognitive Engine 在未來做決策時，可以依照使用者過往的使用紀錄，
進行無線電頻譜以及資源使用的需求進行分配，達到全域的感知效果，讓感知程序能夠
接連不斷的運行。 
 
 
圖 86. 使用者無線電頻譜感測結果 
 
4.1.2 全域感知引擎實現 
 
針對整體網路全域最佳化本研究使用Matlab進行模擬，相關模擬參數如表 14: 
 
表 14 模擬參數 
Name  Value  
網路範圍 5 x 5 (km)  
基地台數量 20 
使用者數量 0 ~ 300 
服務種類 Web, FTP, Video, VoIP 
子代大小 200 
產程子代數 100 
交配機率 (PC) 0.9 
突變機率 (Pm ) 0.1 
 
在無線網路模擬環境中，我們設置了四種基地台分別為: UMTS、4G及Wifi來模
擬異質性網路情況，相關的參數如表 15： 
 
表 15 基地台資訊 
89 
 
 
圖 88. 全域最佳化感知結果 
 
  決策的選擇會因此互相影響各個目標最佳化的結果，有時可能會犧牲一些目標的利
益來實現的具體網路最佳化的需求。例如可能會選擇一個策略使整體網路負載率較為平
衡，避免在使用者高密度區域的連接遭受干擾或斷線，但有些用戶的服務品質可能會被
犧牲，但仍然處於滿足他們最低的服務要求之上。 
  圖 89 多目標最佳化後選擇一策略佈建之結果，由於 MOO 可以生成多個最佳的解
決方案，必須根據實際網路情況選擇其中一種的策略來進行佈建。 
 
圖 89. 全域感知引擎連結拓譜 
 
  除了全域感知策略，我們同時模擬從傳統的 IMS 連線及感知網絡的規劃結果。傳統
的 IMS 並未針對連結進行任何策略，使用者根據自身使用習性進行網路連結，圖 90 顯
示了傳統的 IMS 鏈結拓譜。 
 
91 
 
析可降低連線干擾的情況，但未考慮使用者服務要求，進而影響整體網路負載量。利用
全域感知引擎配合 MOO 做整體網路分配，使用者可以針對不同的情況下獲得更好的策
略。因此滿足用戶的網路連結和服務需求，並同時保持基地台的負載均衡。網絡負載量
可優於傳統的 IMS 網絡及一般感知網路。由於在模擬設定最大網路使用者為 250，當使
用數超過 250 時已大於最大負載量同時干擾情況亦更為嚴重，因此網路負載量會趨緩甚
至下降。 
 
圖 92. 負載量比較 
 
  本研究同時針對干擾情況進行分析(圖 93)，無線網路干擾發生可大致可分為二類: 
    1.多個使用者同時使用同一個頻道連結 
    2.基地台負載量過大 
 
  當使用者數量增加發生干擾機率也同時增加，透過全域感知引擎對所有使用者最佳
化地資源分配及連結策略，比傳統 IMS 使用者及感知網路使用者發生干擾的機率較低。 
93 
 
至各個使用者，圖 94為我們的架構圖。 
 
圖 94. Conference Key Exchange 架構圖 
  我們的協定分成以下幾個步驟來進行： 
(1) A選擇兩個大質數 跟 並計算 ，將 傳送給Ser並告知啟動會議金鑰建立
程序。 
(2) Ser從資料庫中找出A所有的好友B跟C，傳送 給B跟C並通知建立會議金鑰。 
(3) B跟C分別選擇亂數 跟 ，並計算 與 。 
(4) B跟C分別透過Ser將 與 送給A。 
(5) A收到 與 後分別計算 與 並分別得到四個根，透
過 與 的比對可以得到正確的 與 。A隨機選擇一個亂數 ，並計算
與 ，此時使用另一個雜湊函數 。最後，
A分別把 與 送給B與C。 
(6) B與C分別收到 與 後，B計算 ，C計算
。 
(7) 最後A、B與C溝通出會議金鑰為 ，而Ser與其他網路上的監聽者
皆無法得知此會議金鑰。 
  在以上的協定中我們假設A會先拿到Ser對 的簽章，如此B與C才能確認 的正確
性，並利用Rabin Cryptosystem將亂數 與 加密後傳送給A。 
 
4.2.2 實作架構與方法 
於計畫第一年中，我們將會議金鑰交換協定實作於4G-IMS無線網路環境中，並且搭配
子計畫五的應用程式Kphone來進行實作。為了讓我們的協定獨立於4G-IMS系統外，我
們自行透過socket來實作會議金鑰的溝通過程，而不是將我們的協定嵌入於Ser與Kphone
的系統程式碼之中(透過SIP來傳送資料)。如圖 95中綠色部份所示，我們的程式碼獨立
於Ser與Kphone之外，而紅色箭頭則是我們的程式碼分別與Ser跟Kphone接觸之處，以下
我們分別解釋與Ser和Kphone接觸之處的處理過程。 
95 
 
 
圖 97. Table: watcherinfo 
(2) 與Kphone接觸之處主要是利用已經溝通出來的金鑰將欲傳送出去的資料作加密，因
此未來我們只需要寫好加解密的程式，並通知子計畫五在他們的應用程式裡直接使
用我們的程式進行加解密即可。而為了讓子計畫五能更方便的使用我們所提供的加
解密程式，我們會將加解密程式與會議金鑰交換程式作更緊密的結合，因此，子計
畫五並不需要擔心會議金鑰如何溝通且金鑰如何讀取等問題。 
 
 
4.2.3 感知認證協定 
感知無線網路(Cognitive Radio Network)的概念是利用無線頻譜上的感知頻譜偵測
(spectrum sensing)，將一頻段的使用分等級(兩種或更多)，次級使用者傳送資料需事先偵
測被授權的頻帶，若頻帶目前沒有優先使用者正在使用，在不干擾優先使用者的權益
下，次級使用者可進行資料的傳送；若優先使用者於傳送途中使用此頻帶，次級使用者
必須馬上退出此頻帶，並重新尋找其他可用的頻段，使頻譜利用率能夠達到最佳化。然
而感知無線網路協定與頻譜切換技術大多著重於頻寬資源的有效分配與利用，卻較不顧
慮無線網路安全問題所可能帶來的危害，無線網路下的行動用戶容易成為惡意攻擊者的
目標。感知無線網路的環境下，安全的認證協定是必要的。此外，傳統交談式的認證方
式並不能有效的讓行動用戶快速的偵測無線環境中可信任的基地台，基於行動用戶的高
移動性，掌握無線網路環境底下基地台的可信任性是非常重要的。在我們的感知認證協
定中，透過基地台的ID-based簽章與IMS timestamp server與基地台的時間差，我們可以
防止惡意基地台的攻擊與各種潛在的安全威脅。 
97 
 
(a) 為 當下的時間， 以其私鑰對 做簽章，亦即計算 ，並將
傳送給IMSTS。 
(b) IMSTS驗證所接收簽章的正確性，亦即驗證是否 ，若驗證
成功，計算 IMSTS 與 的時間差 ，並計算時間差簽章
，並將時間差 與時間差簽章 傳送給 。 
(c) 驗證時間差簽章是否合法，亦即驗證是否 ，
若驗證成功，則儲存此簽章。 
(4) AP廣播時間證明簽章給MS： 
(a) 每隔一段時間廣播一次封包 ，其中 與 分別為 當時的
時間與其對 所簽的簽章。 
(b) 各個MS皆儲存以下兩列表： 
 : 可信任AP的列表 
 : 不可信任AP的列表 
MS收到上述 所廣播的認證訊息後，驗證是否
與 同時成立，若驗證成功，則計算 ，其
中 是MS當下的時間，並將 加入 。對於 內每一筆 ，若
大於系統可接受的delay time ，則將 從 列表移至 列表；
若 ，則將 從 列表移至 列表。 
 
 
 
4.2.4 實作架構與方法 
於計畫的第二年中，我們將感知認證協定實作於802.11的無線網路環境中，我們於感知
認證協定的程式是獨立的，未來協定開發成熟後可立即於4G-IMS無線網路環境中執
行。感知認證協定包含KGC與時戳伺服器，實作中我們將此兩部份的程式放至時戳伺服
器上執行，IMS伺服器同時扮演協定中KGC與時戳伺服器角色；而協定中基地台的部
分，我們是以真實的AP連接電腦來協助我們開發協定中基地台的所有動作。無線網路環
境中，電腦在未與任何AP連線之前就能掃描附近的AP且彙整出可信任AP列表，所以實
作感知認證協定時也必須讓行動裝置處於未建立連線情況即能接收來自各AP的訊息，此
部分我們是以電腦搭配支援監聽模式的網路卡來模擬，圖 99為感知認證協定實作於無
線網路之架構圖，我們將分別描述其中細節。 
99 
 
 
圖 100. 協力防禦機制示意圖 
  假若在一個環境中， 只接收到 的廣播封包，在沒有其他 AP 廣播封包的情況
下，我們無法分析 的可信任程度，此時， 需要其他 MU 協助提供其他 AP 的廣
播封包，即除 外的其他 AP。如圖 100， 需要 轉送 的廣播封包，以分析
的可信任程度，步驟如下： 
(1) 當 接收到 的廣播封包 ， 驗證 及 簽章的正確性
後，計算出時間差 。 
(2) 而當 只收到 的廣播封包時，則廣播出 Request 封包 ，其中 為
的 ID。 
(3) 接收到 的 Request 封包 後，則轉送 以外的廣播封包
給 。 
(4) 接收到 傳來其他 AP 的廣播封包，並於驗證 及 的正確性後，計算出時
間差 。 
(5) 而 接收 轉送的封包時，會產生傳輸的 delay time，故我們在協力防禦的門
檻值與感知認證門檻值有所差別，協力防禦的門檻值為 ，其中 為感
知認證協定中的門檻值、 為轉送封包的 delay time。 
(6) 在協力防禦機制中，AP 的信任百分比為 ，其中 為接收到此 AP 廣播封包的
總數、 為判定該 AP 為可信任的廣播封包數量。當 時，判斷 是否
大於 ，若大於，即 分析為不可信任，則更新 ，反之，即 分析
為可信任，則更新 與 。當 時， 被分析為可信任，
則更新 與 。 
若 還是只能接收到 ，則週期性地重複步驟1到步驟6，若 可接
收到兩台AP以上的廣播封包，則進行感知認證的執行步驟。 
 
 
101 
 
 
圖 104. VoIP 計費 
 
由圖 105 所示為使用 Video Stream 的計費服務，使用者是透過一個遠端伺服器去獲
得多媒體內容，計費系統每隔五秒就會去記錄一次 Video Stream 的計費情形，從圖中可
以看出計費情況與多媒體當時流量相關。 
 
 
圖 105. Video Stream計費 
 
4.3.2 實作成果 
圖 106 為本計畫完成之 IMS QoS Framework 架構，其中 Policy Repository 由 Open 
Source 的 XDMS Server 進行建構，用來儲存定義的 QoS Policy 檔案。本計畫定義完成
四種 Policy，分別為 Codec、Domain Name、QoS Class 和 Application Class Authorization 
Rules。PCRF 具備 Domain Processor 功能模組，藉由 XCAP 協定(Parsing XML documents)
取得遠端 Repository 存放的 QoS Policy 檔案定義之參數，以及具備 Generic Processor 功
能模組取得全域的參數設定。本計畫處理 AAA 認證需求，主要採取 Open Source 的
Diameter Engine。PCRF 與 AF 之間 AAA 資訊傳遞透過 Diameter Rx 介面實現，而位於
Transport Layer 之 PCEF 與 PCRF 間資訊傳遞則透過 Diameter Gx 介面實現。PCRF 能夠
接收 AF 傳送的授權要求，依據其 QoS 要求取得對應的 Policy 定義之參數，及結合本計
畫完成之 QoS演算法決策後的 QoS 參數，封裝成 Gx 介面之 Diameter RAR 訊息向 PCEF
要求執行。當 PCEF 實際將 Traffic Flow 執行 Admission Control 後，則回傳 Diameter RAA
訊息給 PCRF。 
 
103 
 
 
圖 108. 動態編輯 QoS Class Policy 
 
  圖 109 為編輯 Domain Policy 之介面，藉由此介面，管理者能依據傳送及接收端本
身的 Domain Name 限制其頻寬使用量。 
 
圖 109. 動態編輯 Domain Policy 
 
  圖 110 為 Application Class Rule 之結構，在 Application_class 標籤內，定義每個
Application 類別能夠佔據的頻寬使用量，當此 Policy 被 PCRF 處理完成並授權後，則顯
示 Application Class Authorized 訊息。 
 
 
圖 110. Application Class Rule 結構 
 
  圖 111 為編輯 Application Class Policy 之介面，藉由此介面，管理者可根據正在傳
送 Session 之 Application Class(透過 SDP 訊息包含的 Media Type)，並利用此 Policy Rule
限制其所佔據的頻寬使用量。 
105 
 
 
圖 114.判斷是否超過最大頻寬  
 
  圖 115 為監測流量，目前有五台電腦皆由 AP 指派虛擬 IP，可相互連結傳遞資料。
當流量超過 QoS Class 頻寬限制需求，就會在 AP 執行頻寬流量的監控程式，中斷超過
頻寬的用戶 IP。因此中斷上述超過頻寬的用戶，就無法連線至 AP。圖 116 為執行實作
程式。 
 
 
圖 115.監測流量  
 
 
圖 116.執行實作程式 
 
107 
 
 
圖 119. QoS Agent 建置示意圖 
 
  圖  120 為 QoS_pAgent 開始執行收集 QoS 資訊，並定時傳遞資訊於
QoS_learningAgent 和各異質網路路由器中之 QoS_pAgent，執行各異質網路之 QoS 資訊
交換，並傳遞於 QoS_dbAgent 做 HSS 資料更新，且動態更新 QoS Parameter Database 介
面之資料顯示，而 QoS_learningAgent 執行 QoS 決策判斷。 
 
 
圖 120. QoS_pAgnet 執行畫面 
 
  圖 121 為 QoS_dbAgent 接收資訊後之訊息，透過 QoS_dbAgent 可定時與 HSS 進行
相互溝通，QoS 資料定時更新，可讓使用者方便於得知目前 QoS 資訊。 
 
 
圖 121. QoS_dbAgent 動態更新資訊 
 
109 
 
 
圖 125. Online Charging 
 
  圖 126 為計費系統運行時，Charging Module 所記錄之相關使用者服務資訊。管理
者可根據此紀錄得知使用者所使用的服務 Resource，並把此資訊傳送到 Web 的管理介面
上。 
 
圖 126. Record Message 
 
  在 Charging 費率計算方面，透過 QoSclass、QoSstreamID 和 QoSnetwork 等參數的
設置，可針對不同用戶及不同的服務決定其費率，於 PCRF 中增加 QoS 之 Charging Rule，
對使用者而言增加了執行 QoS 理想頻段決策之公平性，並根據 Online Charging Module
和 Offline Charging Module 傳遞更新資訊，即時改變費率決策資訊。圖 127 為使用多媒
體服務計費之執行畫面。 
 
 
圖 127.多媒體服務執行畫面 
 
 
4.4 子計畫四結果與討論 
  在第三年中，子計劃將 Relay 的概念與前兩年的內容做整合。在環境中，每個 MNs
都具備 Relay 的功能，所以實作上，RN 的設定與 MN 相同。在連線方面，只要使用同
個頻段，USRP 之間就能互相溝通並且幫忙轉送封包。以下為實作研究成果。 
111 
 
些程式片段。實作的想法是 MN (Mobile Node)端 sensing 附近可以使用的頻率(目前先以
802.11 下的 11 個 channel 為基準)來使用，在環境中，有兩台 MN 分別使用不同頻段與
HA (Home Agent)及 AR(Access Router) 建立連線。每隔一段時間會重新 sensing 頻段和
重新建立 tunnel，若計算出的最短預期傳輸時間是與 RN (Relay Node)建立連線，則換手
至 RN 的頻率，並由 RN 幫忙轉送資料。 
 
4.4.2 實作內容 
在子計畫所設計的 Relay-Assisted 架構之中。首先介紹我們在實作系統的架構。我
們利用 Linux 上的 MIPv6 與 RADVD 這兩個套件來架設我們所需的環境，此環境最少
需五台電腦，分別為 HA，MN，AR，CN (Corresponding Node)。在電腦上安裝好 MIPv6
與 RADVD 後，並建立好各電腦的執行腳本檔(腳本檔於後面頁面補充)後，依照順序分
別啟動執行，順序為  
I.執行 HA 的 Script，如圖 132： 
1. 執行 AR 的 Script，確認 HA 與 AR 的 MIPv6 啟動成功後， 
2. 執行 MN 和 RN 的 Script。 如圖 133 所示。 
分別執行後，可看到 RN 和 MN 的 MIPv6 向 HA 和 AR 要求 IP (圖 134)，gr0 介面
也取得了從 HA 註冊 
後所得到的 IP (圖 135)。這表示 MN 已經在 HA 的管理範圍內且 RN 在 AR 的範圍
內，接著執行換頻的動作。 
 以下的程式碼是換頻程式修改部份，我們利用 freq.dat 這個檔案去執行換頻動作，
如果 freq.dat 檔案內的值為 10，表示使用 2.462G (為我們所指定的 AR 頻率)，如果 freq.dat
檔案內的值為 20，表示使用 2.412G (為我們所指定的 HA 頻率)。 
 
圖 132. 執行 HA 套件的畫面 圖 133. 執行 AR 套件的畫面 
 
圖 134. MN 向 HA 要求 IP 位址 圖 135. MN 獲得 IP 位址 
  
self.tb.send_pkt(payload) 
freq1 = open("freq.dat", "rb")    ＃開啟 freq.dat 判斷是否換頻 
113 
 
 
圖 138. MN 在執行換手時，發送 Update 
Router 訊息 
圖 139. RN 顯示幫忙轉送封包並顯示 
  預期的結果有一段落差，如何降低換頻產生的 latency time 在效能的進步上也會是
非常重要且需要努力的一環。 
  
圖 140. 換手成功後，保留原始 IP 圖 141. 換手至 AR 後，發送訊息給 HA 
 
  現今的人們可以更方便地透過行動裝置任意存取網路，以及使用豐富且多元的加值
服務。4G 做為下一代的通訊系統，提供了更優質的無線網路存取環境，其中，最大的
特色是讓使用者可以在任何地方任何時間（Anytime anywhere）連上 Internet，不必考慮
目前裝置處於何種網路環境或者是使用何種通訊技術，並且能夠同時提供語音、多媒體
影音與資料傳輸等功能的高傳輸速率網路，各種在 Internet 上的多媒體服務都可以在 4G
網路上應用，提供更多元化的服務。 
根據資料統計，目前頻譜空閒的主因大部份來自於頻譜資源分配不均，使得頻譜沒有被
有效的分配，導致 License Band 無法充分被利用，在頻譜空間有限以及大多數頻譜已被
分配的情況下，如何善用這些空閒的頻譜，將成為無線網路未來的重要課題。 
本計畫中，我們針對 Cognitive 網路架構下，針對 MAC Protocol 與 mobility management
各項行動管理機制來達到跨層設計，並實作於軟體無線電（SDR）平台中，實驗結果顯
示 SDR 可以做 Spectrum sensing 偵測授權頻帶中空閒的頻譜（Spectrum hole）然後建立
通道，並且於程式中導入 Shannon 與 Poisson 的公式，用以輔助選擇空閒頻帶，使得頻
帶隨時都能夠有效的被利用，提高網路頻帶使用率。在第三年中，我們更加入 Relay 的
概念，來達到更好的頻譜使用率。 
 
 
115 
 
 
圖 142. 感知頻譜偵測換手實驗架構 
  圖 143 為感知頻譜偵測換手機制執行流程：當 Mobile Node 在無線網域間移動時，
會持續的執行感知頻譜偵測與配置機制。USRP 的感知循環結束後會產生一文字檔 CA，
此檔案記錄著每一個 Spectrum Hole 的頻道可用度。此外，USRP 也會傳送一個 Signal
訊號給 Mobile Node 的 caller agent，告知 caller agent 感知循環已結束可以擷取頻譜可靠
度的資料。取得頻譜可靠度之後，caller agent 會自動判斷哪一個頻段為目前連線品質最
佳的頻率並且透過(UDP) Control Channel 的告知 Access Router 的 callee agent，彼此協商
利用最佳的頻率作連線溝通以保持網路封包傳輸品質的穩定。 
 
 
圖 143. 感知頻譜偵測換手機制執行流程 
 
  為了評估 SST 頻譜感知換手機制，對於行動通訊裝置在無線網域間移動時封包傳遞
情形，設計兩實驗情境來評估，分別為情境一：Mobile Node 從舊網域漸漸移動至新網
域但尚未離開舊網域；情境二：Mobile Node 從舊網域離開漸漸移動至新網域。而情境
所用網路架構如圖 144 所示。 
117 
 
 
圖 146. 頻譜偵測 2.46GHz~2.47GHz 
 
  當 Mobile Node 執行服務同時也會藉由感知無線電測量新網路的訊號雜訊比(Signal 
Noise Ratio)與 power dB 值，用以計算預備換手門檻值與開始換手門檻值。當舊網路 SNR
值低於預備換手的門檻值時，會啟動預備換手機制為換手前作準備，如圖 147 示。當
Mobile Node 到達新網路時，感知無線電會測量該時間點各頻道的 power dB 以決定頻道
可用度，如圖 148 所示。最後根據先前所得到的預備換手門檻值與頻道可用度計算出開
始換手的門檻值。 
 
圖 147. Mobile Node 偵測到連結強度變弱，增加新路徑預備換手 
119 
 
 
圖 150. 封包傳送情形(情境一) 
 
圖 151. 封包傳送情形(情境二) 
  為了實際了解換手時機，以作為未來換手機制的改進參考。在本子計畫中，以手持
式雷射測距儀實際量測當 Mobile Node 預備換手時的訊號強度與距離關係，圖 152 為實
際測量結果。在圖 152 中，我們可以看以看出大約在 15~16 公尺的訊號強度有明顯下
降，而且網路也呈現較不穩定狀況。因此，我們可以依此數據作為 SST 各種換手臨界值
的計算與修正參考，以達到最理想化的換手設計。 
 
44
46
48
50
52
54
56
58
60
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24
公尺
訊
號
強
度
 
圖 152. 換手處理中訊號強度與 Mobile Node 距離關係 
121 
 
總計畫第一年已經完成跨層式感知與協力4G-IMS無線網路平台與第二組IP多媒
體子系統的建置，並將平台升級至能夠支援下一代網路中最重要的定址技術－IPv6
支援，並承續上一期計畫的結果，將IMSkphone porting技術移轉至IMSKphoneSI，再
將軟體移轉給子計畫五進行更多應用程式的開發與研究。 
 
並且在第二年計畫中與法國布列塔尼電信學院展開跨國的IMS網路交換，模擬不
同營運商之間的連接，並在其中引入Security、Multihoming與IPv6建置議題，透過安
全加密通道以及IP-in-IP Tunnel達到多重家網路的效果，進行更多元性的研究。 
 
在第三年總計畫協調各子計畫成果與總計畫平台展現，並規劃一完整的整合情境，
讓各子計畫能夠在情境中發揮研究成果。 
 
 
圖 154.總計畫計畫資訊交流平台 
 
在資源共享平台部份，已經建置一維基百科形式之計畫交流平台，對內提供各
種技術文件以及手冊，對外提供計畫介紹以及交換可公開資訊等。 
 
  本計畫各研究團隊均已達成既定目標，各子計畫均將成果致力於學術展現，研究成
果 outcome 部份，總計畫本期研究成果發表之論文如下： 
 
[1] Yu-Hsiu Chuang, Chi-Yuan Chen, Tzong-Chen Wu, Han-Chieh Chao, "Establish a 
Secure and Trustworthy ICT Environment for Educational Systems: A Case 
Study"Journal of Intelligent Manufacturing 
[2] Yao-Hsin Chou, Chi-Yuan Chen, Han-Chieh Chao, Jong Hyuk Park, "Quantum 
Entanglement and Non-Locality based Secure Computation for Future 
Communication"IET Information Security, Vol. 5, No. 1, pp. 69-79 
[3] Huaming Guo, Hongke Zhang, Chi-Yuan Chen, Han-Chieh Chao, "Resolving 
123 
 
 
子計畫一團隊本年度學術論文 outcome 如下： 
[1] Chi-Yuan Chen, Kai-Di Chang and Han-Chieh Chao, "Transaction-Pattern-Based 
Anomaly Detection Algorithm for IP Multimedia Subsystem," IEEE Transactions on 
Information Forensics and Security, Vol. 6, No. 1, pp. 152-161 
[2] Shih-Wen Hsu, Kai-Di Chang, Chi-Yuan Chen, Han-Chieh Chao, Jiann-Liang Chen, 
"An Efficient Path-Migration Mechanism for IP Multimedia Subsystem," the 7th 
International Wireless Communications and Mobile Computing Conference (IWCMC 
2011) 
[3] Kai-Di Chang, Chi-Yuan Chen, Jiann-Liang Chen, Han-Chieh Chao, "Internet of Things 
and Cloud Computing for Future Internet," The 2nd International Conference on 
Security-enriched Urban Computing and Smart Grids (SUComS 2011) 
[4] Shih-Wen Hsu, Chi-Yuan Chen, Kai-Di Chang, Han-Chieh Chao, Jiann-Liang Chen, 
"Towards Service-oriented Cognitive Networks over IP Multimedia Subsystems," The 
17th IEEE International Conference on Parallel and Distributed Systems (IEEE ICPADS 
2011) 
[5] 許士文, 張凱迪, 陳麒元, 趙涵捷, 陳俊良, "結合IP多媒體子系統之感知引擎設計
與實現," 第十屆離島資訊技術與應用研討會 (ITAOI 2011) 
[6] 游衛仁, 曾繁勛, 陳麒元, 周立德, 趙涵捷, "基於集合覆蓋理論之IEEE 802.16j多重
跳躍中繼網路規劃," TANet 2011臺灣網際網路研討會 
 
 
5.2 子計畫二自評與研究成果 
 
子計畫分三階段進行自評說明： 
第一階段：整合階段 
我們已經完成感知認證協定的實作，於整合階段，我們與其他子計畫溝通整合相關事
宜，並進行各子計畫成果整合。如與子計畫四確認彼此程式間如何進行資料交換，以使
子計畫四取得基地台清單並選取基地台連線，亦協助總計畫建置整個實作環境、解決子
計畫間整合問題。 
 
第二階段：協定分析與實測階段 
於此階段，我們對所提出的感知認證協定與金鑰交換協定進行分析，並檢驗實作整合結
果。當協定中行動裝置僅能掃描到一台基地台時，我們檢驗出感知認證協定並無法正確
地分析該基地台是否可信任。 
 
第三階段：缺失修正階段 
針對第二階段所發現的問題，我們找尋相關文獻研究，最後提出協力防禦機制解決此問
題。即使行動裝置僅能掃描到一台基地台，亦能與附近行動裝置進行協力防禦，以分析
出該基地台是否可信任。 
 
研究成果 outcome 部份，子計畫二本期研究成果發表之論文如下： 
[1] Chun-I Fan and Vincent Shi-Ming Huang, ‘Provably Secure Integrated On/Off-Line 
Electronic Cash for Flexible and Efficient Payment,’ IEEE Transactions on Systems, 
Man, and Cybernetics--Part C: Applications and Reviews, vol. 40, no. 5, 2010, pp. 
567~579. (SCI, EI) 
[2] Chun-I Fan, Ling-Ying Huang, and Pei-Hsiu Ho, “Anonymous Multireceiver 
125 
 
Control Implementation in PIM-SM,” Wireless Personal Communications, Vol.55, No.1, 
pp.35-49, September 2010. 
[7] J.L. Chen, Y.W. Ma, C.P. Lai and Y.M. Huang, “Multi-Hop Routing Mechanism for 
Reliable Sensor Computing,” Sensors, Vol.9, No.12, pp.10117-10135, 2009. 
[8] H.F. Lu and J.L. Chen, “Design of Middleware for Tele-Homecare Systems,” Wireless 
Communication and Mobile Computing, Vol.9, No.12, pp.1553-1564, December 2009. 
[9] J.L. Chen, “Cooperative QoS Mechanism for Heterogeneous Networking” Proceedings 
of IEEE Sarnoff, April 12-14, 2010. 
[10] J.L. Chen, Y.W. Ma, Y.M. Hsu and Y.M. Huang, “Adaptive Routing Protocol for 
Reliable Wireless Sensor Networking,” Proceedings of IEEE 12th International 
Conference on Advanced Communication Technology, pp.358-363, February 2010. 
[11] S.W. Liu, S.L. Wu and J.L. Chen, “Adaptive Cross-layer QoS Mechanism for Cognitive 
Network Applications,” Proceedings of IEEE 12th International Conference on 
Advanced Communication Technology, pp.1389-1393, February 2010. 
[12] J.M.  Chang, W.T.  Hsiao, H.C. Chao and J.L. Chen, “The Adaptive QoS for SIP 
Phone using Dynamic Adjust Mechanism,” Proceedings of the 2010 International 
Conference on e-Technology, China, January 2010. 
[13] J.M. Chang, W.T. Hsiao, J.L. Chen and H.C. Chao, “Mobile Relay Stations 
Navigation-Based Self-Optimization Handover Mechanism in WiMAX Networks,” 
Proceedings of the 4th International Conference on Ubiquitous Information 
Technologies & Applications, pp.126-130, 2009. 
[14] J.L. Chen, M.C. Chen,  S.W. Liu and J.Y. Jhuo, “Cross-Layer QoS Architecture for 4G 
Heterogeneous Network Services,” Proceedings of the 11th International Conference on 
Advanced Communication Technology, pp.73-77, Phoenix Park, Korea, February 15-18, 
2009. 
[15] J.L. Chen, Y.T. Larosa, D.J. Deng, P.J. Yang and Y.W. Ma, “QoS-aware Heterogeneous 
Networking using Distributed Multiagent Schemes,” Proceedings of the IEEE Wireless 
Communications and Mobile Computing Conference (IWCMC), pp.1713-1718, August 
2011. 
[16] J.L. Chen, S.L. Wu, Y.T. Larosa, P.J. Yang and Y.F. Li, “IMS Cloud Computing 
Architecture for High-quality Multimedia Applications,” Proceedings of the Wireless 
Communications and Mobile Computing Conference (IWCMC), pp.1463-1468, 
September 2011. 
 
 
5.4 子計畫四自評與研究成果 
 
本子計畫提出Cognitive and Cooperative網路架構下 MAC Protocol與mobility 
man-agement的各項行動管理機制以及Relay的概念，將所設計之機制實現於軟體無線電
（SDR）上，並結合MIPv6(Mobile IPv6)以及於程式中導入Shannon與Poisson的公式用以
實現換手之情境，並獲得實際測試數據及所需成果。根據上述研究成果，我們自評本子
計劃(子計劃四)之設計與實作結果均符合計畫的預定目標。 
 
研究成果 outcome 部份，子計畫四本期研究成果發表之論文如下： 
[1] Yuh-Shyan Chen and Jia-Shiang Hong, "A Relay-Assisted Protocol of Spectrum 
Mobility and Handover in Cognitive LTE Networks," IEEE Systems Journal, 2011.  
[2] Kuan-Lin Chiu, Yuh-Shyan Chen, and Ren Hung Hwang, "Seamless Session Mobility 
Scheme in Heterogeneous Wireless Networks," International Journal of Communication 
Systems, Vol. 24, Issue 6, pp. 789-809, June 2011. 
國科會補助計畫衍生研發成果推廣資料表
日期:2011/10/23
國科會補助計畫
計畫名稱: 總計畫：跨層式感知與協力4G-IMS無線網路研究(3/3)
計畫主持人: 趙涵捷
計畫編號: 99-2219-E-197-001- 學門領域: 無線通訊(國家型)
無研發成果推廣資料
其他成果 
(無法以量化表達之成
果如辦理學術活動、獲
得獎項、重要國際合
作、研究成果國際影響
力及其他協助產業技
術發展之具體效益事
項等，請以文字敘述填
列。) 
無 
 成果項目 量化 名稱或內容性質簡述 
測驗工具(含質性與量性) 0  
課程/模組 0  
電腦及網路系統或工具 0  
教材 0  
舉辦之活動/競賽 0  
研討會/工作坊 0  
電子報、網站 0  
科 
教 
處 
計 
畫 
加 
填 
項 
目 計畫成果推廣之參與（閱聽）人數 0  
 
