三張影像相減，也是採取固定或變動閥值取得二值化影像，和利用連通成分將物件抽取出
來，此法，非常適合於動態環境，但是，無法得到完整的特徵資料；第三類是光流法（optical 
flow）[5][6]，此演算法，主要是估測向量場（vector field），此向量場用來描述影像上面
的每一點，在每一時間上，空間上的移動，並且提供移動分析上重要的資訊，但是，此法
計算量非常大和複雜，若沒有使用特珠硬體，是無法使用在即時系統上。 
在此，我們提出一快速而且有效的背景相減法，可以在固定式（可以延伸到移動式）
的攝影機下，用來偵測車庫中的入侵者。此種方法的優點是容易實作，系統不需要額外的
統計過程而且複雜度低、系統效能也較佳。然而單純的背景消去在偵測上其效果有所限制，
僅能大略的取出物體輪廓；另外，對於環境中有光影或移動物體，若是利用背景消去法，
其結果也不是很好。因此，有些研究強調建立有效的背景模型或是背景圖的更新機制，以
供像素點比較時，可以比較準確的取出前景的物件。要建立有效的背景模型，可以連續統
計數張背景圖片的色彩資訊，用來建立背景模型，接著，輸入的影像，可以藉由背景模型
的判斷，來決定該像素點(Pixel)是否屬於背景。因為要監視的場景，會因為天氣和光線等
因素而變化，所以，背景要隨時更新，更新背景可以更新先前建立的背景影像模型，或是
利用隱藏式馬可夫模型或是卡曼濾波器來預測背景的變化。然而，這些方法為了精準的取
出前景中的移動物件，必須事先蒐集一段不包含移動物件的影片，而且必須透過較為複雜
的統計方法來統計出背景模型，計算量較大而且程式複雜度比較高，而且，所建立的背景
圖，當改變時也必須重新更新，所以，並不適用於各種環境中。另外一缺點是，不論是用
統計或是非統計的方法，透過背景圖(或模型)與前景圖像素點的比較，僅能偵測出畫面中
「變化」的區域，而非真正的「動態」區域，只是常常動態區域必然產生變化，但是變化
區域卻不一定有我們想要偵測的移動物件。尤其是在車庫環境中，背景常會有大幅度的改
變，例如：駛進車庫的車輛，在行進中必須判斷為動態物件，但是在車輛停妥一段時間之
後，必須將其視為背景的一部分，而前景部分也會有經常性的移動物體存在。在過去的研
究中，大多是將偵測畫面中的變化，視為畫面中的移動物件，然而，在停車場（庫）環境
中，畫面的變化可能來自於車輛駛離後的車位，因為原本有車子，當車子離開後，會產生
變化，此部分必須要有其他的機制來達成真正的動態偵測。因此，如何能夠在維持有效的
動態偵測的情況下，除了能夠正常的偵測畫面變化區域外，還要能夠判斷出該變化是否來
自於真正移動中的物件，並給予適當的回饋，是本篇研究的主要動機之一。 
在偵測到真正的動態物件之後，為了能夠提供停車管理上更多的協助，我們希望能夠
將偵測到的物件，分類出是人或是車輛，這是因為人和車輛，是在停車環境中，出現或移
動頻率最高，同時也是最需要注意的兩個動態物件，透過對人和車子的分析，將可以幫助
管理者，提供更充足的管理資訊。 
 
三、研究方法與步驟 
為了達到入侵者的偵測與分類，首先，要將視訊畫面中，所有可能的移動物件範圍，
從背景中分離出來。我們採取的方式是，從將CCD Camera所攝取的連續影像，透過背景消
去法及背景更新的技術，來偵測出前景中移動的物件。在此，我們主要的研究貢獻是，提
出一快速更新背景的技術來即時更新背景，以及建立一物件移動資訊分析表，用來紀錄和
分析移動物件的運動狀態。這些資訊主要是移動物件的移動量和移動方向。最後，利用移
動物件的幾何特性，將移動物件分類為人或是車子，整個系統流程圖如圖3-1所示。 
在動態偵測時，首先，我們將視訊中有變化的物件偵測出來，因為這些視訊中的變化，
像空間，再利用亮度值Y來做為背景影像與攝影機輸入影像做兩兩像素差異值的比較，若
是兩兩相對應的像素差異值足夠明顯，代表這部分的影像發生了變化，我們保留這些發生
變化部分，而將沒有改變的部份去除掉。如何判斷兩兩相對應的像素差異值足夠明顯呢？
一般做法是採用所謂二值化（Thresholding）的固定閥值T，當差異值大於固定閥值T時，設
為白色，否則設為黑色。然而，由於環境中光影的變化，或是攝影機的鏡頭對於光線較於
敏感，容易產生有雜訊或色差。因此，T值的設定良否，會影響移動物件的偵測結果。一
般而言，T值設定的比較小，偵測到的移動物件，含有許多雜訊；T值設定的比較大，偵測
到的移動物件，含有許多破碎的影像。 
在過去的二值化研究中，對於影像中，可以明顯分為兩類的，利用Otsu[7]方法，可以
得到很好的二值化結果。但是，移動物件的變化，有時候很明顯，有時候不是很明顯，尤
其是移動物件變化不是很明顯時，尤其與背景影像非常接近，像素比較的差異值結果不大，
Otsu二值化的方法就不適用，它會產生許多雜訊。為了克服這個問題，在文獻[8]中，利用
一個簡單的機制來設定閥值，他們的方法，是利用光線的變化，進而造成動態偵測的差異
結果，因此，他們先對光線做分析，來決定該視訊影像所要使用的閥值T，在文獻[8]中，
其閥值T定義為T =βμ，其中μ值是視訊影像中的平均照度(Luminous)，β是常數。然而，
視訊影像的亮度值，跟我們使用的攝影器材有關，這些攝影硬體在拍攝視訊時，會進行自
動光線校正或是強制補光的動作。所以，我們修改文獻[8]的方法，設定閥值為T =βμ+γ，
經過實驗後，設定β為0.2，γ為2.8。 
移動物件影像經過閥值T的設定，偵測出來的移動物件影像，仍然存有許多雜訊和破
碎現象。其中雜訊的部份，是由於光線對於攝影鏡頭的一種干擾，這類雜訊大都屬於椒鹽
雜訊(Pepper and Salt)，又稱為點雜訊，為了克服這些雜訊的干擾，利用中值濾波器(Median 
Filter)，來過濾這些孤立的雜訊。 
移動物件影像經過中值濾波器去除雜訊之後，雖然可以濾除掉孤立的點和面積較小的
點。但是由於光影及色差的干擾，仍然會有破碎的結果產生。利用影像處理中的形態學運
算，可以來解決這樣的問題。使用擴張運算(Dilation Operation)來彌補因光影變化所造成的
破碎情況，再利用侵蝕運算(Erosion Operation)將體積較小的點去除掉以及消去因擴張而造
成的不自然點。上述的處理過程，在形態學中稱為閉合(Closing)運算，閉合運算可以使輪
廓部分平滑，也能把狹窄的斷開部分和長細缺口連接起來，消除小洞彌補輪廓上的缺口。 
經過雜訊去除和型態學運算後，我們僅是在視覺上達到移動物件的萃取，為了要能得
到移動物件實際在視訊影像中的二維座標位置，我們利用連通成分（Connected component）
的抽取，將移動物件的二維座標位置抽取出來。 
在停車環境中，本來是停止的車輛，車主要開車或偷車賊要偷車時，會走到車子的旁
邊，開車門進入車內，然後發動車子，把車子開走。為了紀錄人、車子以及停車位的資訊，
我們建立一個『運動分析表』，來記錄移動物件在時間軸上的變動情形，利用前景中移動
物件的移動速度的改變，可以判定移動物件是在行進中，還是停止中。假如在停車環境中，
車輛或人從移動中改為靜止時，系統可以立刻判斷出移動物件靜止而停止對該物體的偵測
（在實際應用場合中，可以在此時錄影，分析是否為合法車主和車輛，若是不合法，發出
警報並通知停車場管理員），進而進行前景影像的更新動作，在我們的實際運作上，若移
動物件連續三個畫面的位移值都很低，我們會將該移動物件融入背景當中，系統會繼續偵
測其他動態的物件。『運動動分析表』所要記錄的內容包括：（1）物件編號（2）物件左
上方座標（3）物件右下方座標（4）物件中色彩平均值（5）物件中色彩變異度（6）位移
們假設第一張畫面中不包含有前景物件，也假設從第二張畫面開始背景產生了變化。為了
將目前的背景圖演化為變化後的影像，我們將兩張圖片對應位置的亮度值相減，判斷出第
一張影像與第二張影像的差異，接著把這差異值加在第一張影像背景當中，讓第一張影像
背景演化成第二張影像背景。通常基本的概念是如此，但是，在攝影機取得的連續畫面當
中，通常包含有移動的物件，若是在差異比較時，將所有的差異值都加到原先設定的背景
圖上，則當移動物件出現時，背景圖會馬上因為差異的修補，也將移動的物件視為背景的
一部分。如此一來便無法透過前景圖與背景圖的比較，將畫面的變化部分偵測出來，為了
控制這樣的問題，我們在演化背景圖時不把所有亮度的差異都加在背景圖上，而是設計了
一個較小的數值來適應背景些微的變化，我們提出的背景更新方法如下列式子所示： 
( ) ( ) ( )1 , min , ( , ) ( , ) ( , ) ( ,B F B F )BP x y P x y P x y Sign P x y P x yα+ += − × −
  1       0
1       0
( )
if x
if x
Sign x
≥
− <
⎧⎪=⎨⎪⎩  
在上面式子中，PF(x, y)是輸入連續影像中單一Frame上座標為(x,y)的亮度值，PB(x, y)
是初始背景圖上座標為(x,y)的亮度值，α是背景更新率。以下說明一下，如何使用α：我
們取一個較小的值α，來跟兩圖中的對應點差值比較後取最小值，一般狀況下α值會小於
亮度的差異值。若是α值大於差異值也可以因為取最小值而限定在一定範圍內。判斷差異
之後將該值乘上一正負號，若是前景影像的亮度值大於更新前背景圖則乘上一正號，反之
則讓背景圖減去與前景圖的差異。倘若α值偏大，則每次遞增或遞減的程度就偏大，因此
演化的速度就加快，反之亦然。然而演化的速度以及範圍需要控制適當，若是給予α一個
極大值造成演化速度過快，則在剛輸入影像時，初始背景圖會立刻演化成該張輸入的影像，
造成無法分離出移動物件的情況。因此，接下來我們將討論在不同情況下，如何決定α值
的機制和背景畫面更新的範圍。 
B
在正常的情況下，背景畫面的更新，只要能適應光線所造成的些微變化，而此變化，
有可能產生在背景畫面中的任何地方，加上有可能的移動物件存在，因此，我們只需要一
個極小的α更新值，來對整個背景畫面做更新的動作即可。 
對於移動中的物體改變狀態到停止時，因為在時間軸上位移量的判斷，會偵測出該物
體的運動狀態改變。當偵測到停止時，除了錄影加以分析與應用外，要對這些前景以及相
對應的背景進行更新，針對此區域給予較高的背景更新速度α值，將該區域迅速的演化成
背景，這就是在『運動分析表』中，所謂的『移動到停止』狀態。 
另外一種情況是在『運動分析表』中，所謂的『停止到移動』狀態，如在系統一開始
載入第一張畫面作為預設的背景圖時，該張畫面已經包含移動中的物件。在接下來的畫面
中，移動物件離開原處，但是在原處會因為產生變化，而讓系統誤判為有移動物件。這也
是文獻[9]中，所定義的「鬼影」(Ghost)。為了解決這樣的問題，當『運動分析表』中的狀
態是『停止到移動』時，也就是在前景分析時，會判定其位移速度為過低的物件，所以，
將此前景的區域範圍，給予較大的背景更新速度α值，讓不正確的畫面快速演化到正確的
背景圖中。 
最後一種情況是，在偵測的過程中，攝影機的位置改變了，這時，前景輸入的連續影
像與背景圖的差異，會突然間的提高，而畫面的大幅度變化也會在像素點比較時被偵測出
來。在一般情況下，利用第一張畫面做為背景圖來偵測畫面改變，並不會偵測到這麼多的
針對所提出的系統，我們分別做了以下的實驗：（1）背景更新，（2）室外車輛駛離
車位的偵測，（3）室外人車分類的偵測，（4）室內車庫車輛的偵測，（5）室內車庫人形
的偵測，以下分別說明之： 
   
   
(a) #3              (b) #4             (c) #5 
  
          
(d) #6                   (e) #7 
圖 4-1 背景更新過程圖 (a) Frame #3 攝影機改變位置；(b)到(d) 更新的過
程；(e)背景演化完成 
背景更新的實驗，以圖4-1來說明，在上方二元圖形中，白色表示偵測到的移動物件，
黑色代表是背景，下方圖形是其對應的原來視訊圖形和連通成分。從圖4-1(a)到4-1(e)，可
以看出系統背景更新的過程。當攝影機改變位置時，經過像素比較的步驟之後，大多數的
像素點都與背景圖有某種程度上的差異，因此在二元圖形中為白色，其對應的輸出結果中，
也以方框標記(圖4-1 (a))，此時系統判斷後，將背景更新率α，調整為最高等級α=55 (= 
此，可以偵測出後面車子的移動，最後，在圖4-3(h)到圖4-3(k)中，顯示人的偵測與分類。 
 
   
(a) #29                   (b) #35                  (c) #44 
   
(d) #60                   (e) #68                   (f) #90 
   
(g) #93                   (h) #119                  (i) #138 
    
(j) #150                    (k)#164 
圖4-3 室外人車分類結果 
 
室內車庫車輛偵測，本實驗在室內的停車環境中，進行移動物件的偵測，我們以圖4-4
來說明，一開始在畫面中Frame #5時，有一輛休旅車從遠方行駛過來，而在Frame #10時，
中間車位也有輛車子要駛離車位，在休旅車經過之後，可以看到從圖4-4(e)開始，小轎車慢
慢離開原來車位的畫面，在離開的過程中，同樣的，利用透過背景與前景的分析以及『運
   
 (a) #11               (b) #19                  (c) #24 
    
(d) #30                    (e) #35 
圖 4-5 室內停車環境人形偵測結果 
對於整體的系統效能，我們使用一般的網路攝影機，來拍攝解析度為320 x 240 的輸入
視訊，每秒鐘可以處理13張畫面數，與文獻[11][12][13]中的11張畫面數相比較，有比較高
的效能(表4-1)。另外，在背景更新的速度上，我們的系統，在四張畫面內，就可以將背景
演化完成，與文獻[10]中，採用統計方式，需要60到120張比較，明顯顯示出，我們提出的
背景更新方法，比其他方法來的快速與有效。最後，本研究提出的方法，確實可以在不需
要事先搜集背景訓練的情況下，可以快速與有效的產生背景圖。 
 
表 4-1 整體系統效能表 
 
Time 
(sec.) 
Frames Frame Rate 
分類 
錯誤數 
分類 
成功率 
Video 1 室內車
庫人形偵測 30 390 13 0 100% 
Video 2 室外車
輛駛離車位 60 765 12.75 7 99.08% 
Video 3 室外人
車分類 90 1155 12.83 13 98.87% 
Gaussian[12] X X 11.25 X X 
Mixture [11] X X 
11  
(160 x120) 
X X 
Bayesian[13] X X 11 X X 
 
