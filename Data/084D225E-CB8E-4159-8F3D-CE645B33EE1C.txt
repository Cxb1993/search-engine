2 
 
人臉追蹤技術是視訊處理中相當重要
的一環，它可區分為人臉偵測與後續的移
動追蹤等兩階段的工作。人臉追蹤技術除
了可應用於機器人與人類互動、生物資訊
安全或監控、目標物自動鎖定與對中校正
等既定用途外，在網路世界的視訊聊天等
娛樂性質的用途也深具市場潛力。通常人
臉偵測常利用定義人臉規則的知識法和人
臉特徵不變性、樣版模型搜尋或是以訓練
類神經網路等方式進行人臉偵測[6]，知識
法是由研究者定義人臉的規則，所以也較
容易因為研究者本身對人臉之定義不同而
得到相異的結果。人類膚色的色彩在色彩
空間的分佈狀態也常被利用作為判斷的重
要特徵資訊，因其計算複雜度較小，所以
可藉此快速的偵測出圖像中的臉孔所在。
一般而言，膚色特徵不易受到方位、大小、
甚至是部分區域遭受遮蔽而有所影響，因
此利用膚色特徵可大量減少搜尋範圍。在
目前的人臉偵測技術中，已有許多研究是
利用膚色資訊來尋找人臉位置。 
人臉追蹤為人臉偵測的接續工作，當
偵測到正確的人臉位置之後，只要持續對
此人臉影像區塊進行追蹤即可。因此它是
在求得目標區塊在一連串時間序列影像中
隨時間的變化。除了影像梯度之外[3]，人
臉的橢圓輪廓和輪廓範圍內之色彩分佈
[4,11]等模型在經過運算處理之後，也可以
達到良好的追蹤效果。這種作法的優點是
運算較快，但相對的其抗干擾的特性較
差，也因此，搭配膚色色彩判斷[12]或是變
動偵測[2]等方法常用來協助區隔非人臉的
背景區域，可強化其在追蹤效果上的穩定
性。在本研究中，我們採用結合膚色模型
與人臉比例的方法來進行人臉偵測，該方
法對於複雜影像環境具有具佳的容忍度，
可以有效的偵測到人臉位置。當完成人臉
定位後，我們便可再透過粒子群最佳化演
算法(Particle swarm optimization, PSO)演算
法來執行人臉追蹤的任務。 
    PSO演算法中族群的個體(Particle)之
間具有相互學習與彼此追隨的仿生物群體
行為特性[7]，因此相當適合應用在動態最
佳化的解題應用上。在成功偵測人臉位置
之後，本論文利用一個基於PSO的人臉追
蹤系統持續追蹤串流影像序列的人臉位
置。我們將串流影像序列中變動的人臉位
置視為一個不斷移動的目標解，並利用前
一張影像之人臉座標位置產生矩形重點區
域(Region of Interest, ROI)作為搜尋區域，
初始族群中每一個攜帶著不同座標資訊的
個體編碼值都提供了一組可能的解集合，
而以影像區塊中之色彩資訊為主的評估函
數(適應函數)則有助於引導個體在重點區
域中快速搜尋新的人臉影像位置。個體在
競逐評估函數極值的過程中，透過彼此之
間的相互牽引和模仿學習等行為即可完成
訊息的交換與修正。一般而言，我們若針
對不同影像重覆進行相同的全域偵測運
算，追蹤效果容易受到因影像環境變化而
造成前後影像中人臉型態差異的影響；而
且因連續影像中，同一個人臉移動位置不
致差距太遠，因此可以使用局部性範圍的
重點區域搜尋，不僅有助於減少運算量，
而且又可提升目標追蹤的準確度。由本研
究的實驗的結果也可以驗證，以PSO演算
法進行串流影像序列的人臉追蹤方法，較
諸重覆針對不同影像執行人臉偵測的作
法，具有更高的正確率以及更少的時間耗
費。 
    為了實現微型化與即時處理的實際應
用目的，除了PC平台的軟體模擬外，我們
也將系統移植至FPGA-based的Nios II嵌入
式處理器平台進行模組功能驗證與性能比
較，並將運算耗時的函數模組改以硬體架
構實現，採用軟、硬體整合設計的方式提
高系統整體效能。 
 
三、研究方法與系統實現 
 
1. 基於串流影像的演化式人臉追蹤系統 
 
1.1 人臉偵測 
 
本研究採用圖 1 之人臉偵測演算法架
構，首先將色彩空間從 RGB 轉換到可減少
光影變化影響的 YCbCr 空間，並利用膚色
模型找出膚色區域，完成最初步的 ROI 區
4 
 
進行機率式的搜尋策略調整。PSO 相似於
傳統式遺傳演算法突變的機制，但和典型
的突變不同的地方在於它並非完全隨機
的，從很多的研究結果顯示 PSO 可以快速
的在問題空間找出最佳解，對於動態系統
提供了一個具高度適應性的最佳化解題方
法。 
PSO 具有類似現實環境中生物群體相
互協調與群體行為一致性的運作特色。每
一個生物個體均有其高適應度的自我最佳
經驗，相對於 PSO 中每個個體皆記憶個體
最佳參數；生物群體的社會性，使得生物
個體間的經驗能彼此互相交換並且傳承，
相對於 PSO 中群體全域最佳參數解的記
憶，因此 PSO 的演算行為具有類似生物群
體中的社會約束及自我認知兩種模式，這
種仿生物智慧的技術結合了社會模式
(Social-Only model) 及 自 我 認 知 模 式
(Cognition-Only model): 
1) Social-Only Model: 
)(()2 idgdidid XPrandVV    
         (5) 
 
2) Cognition-Only Model: 
)(()1 idididid XPrandVV              (6) 
 
3) PSO Combine Model: 
)(()1 idididid XPrandVV    
)(()*2 idgd XPrand                
(7) 
ididid VXX                           (8) 
此處 d  是搜尋空間中變數的維度，i
是群體中的個體， 
iV 是速度向量， iX  是
位置向量。而
iP 是個體所經歷過之最佳解
位置，
gP 則是個體所處之整個鄰域所記錄
的最佳解位置。參數 
1  以及 2  分別是
自我認知與社會模式的學習率。 
  
1.2.2 PSO 人臉追蹤 
 
本論文使用圖1之人臉偵測演算法架
構偵測人臉位置，確定人臉之ROI範圍
後，便開始以PSO在連續串流影像中繼續
追蹤移動的人臉位置。演化系統中決定適
應函數是決定系統效能的關鍵，一個合
理、有效的適應函數會有助於引導PSO所
有個體在重點區域中快速搜尋新的人臉區
塊影像位置。在本研究中，族群中個體
(Particle)的編碼值即為人臉影像座標的訊
息，適應函數則由搜尋到的影像區塊之色
彩資訊計算得到，而前一張影像之人臉位
置周圍所定義出之適當範圍便是PSO的解
空間。 
為了避免不同圖形卻得到相同平均
值，因此本架構加入核心函數 (kernel 
function) [1]，給予搜尋區域中心較大權重
值，且由中心向外遞減，加強樣板的資訊。
式子(9)是加入權重值表示的目標模板顏色
特徵向量 ),,(= BGRt f 表示式。 

































nm
i
i
iB
nm
i
i
iG
nm
i
i
iR
nm
a
OS
K
Bμ
nm
a
OS
K
Gμ
nm
a
OS
K
Rμ
0
0
0
)(
=
)(
=
)(
=
                      (9)
 
 
其中 22 )
2
()
2
(  a
nm
 ,且 
 
otherwise          ,0
1<r              ,-1
 =)(
2


 r
rK                  (10)
 
式子(9)中，m、n 代表目標模板長與
寬，Si 代表第 i 位置(xi,yi)，Ri、Gi、Bi 分別
表示第 i 個像素的色彩值，O 為目標模板中
心。 
在圖 2 之中，紅色方框代表目標影像
區塊長寬 (FH，FW)，(xf，yf)為影像區塊左
上角座標位置；長、寛為(SH，SW)的方框
代表目前 PSO 所有個體追蹤人臉的解空間
範圍，分別為紅色方框上下左右邊界往外
延伸 L1 及 L2 的範圍。 
6 
 
色彩空間轉換 膨脹中值濾波膚色區域篩選
連通物件標定 LoG遮罩 橢圓模板比對
人臉偵測
輸入串流影像
YCbCr
影像
人臉目標模板影像
輸入串流影像 人臉目標模板影像
 
圖 4 人臉偵測 IDEF0 架構圖 
PSO追蹤模組可切割為粒子資訊初始
化和適應函數計算兩個模組，如圖5。根據
前一張影像人臉座標位置參數，設定輸入
影像的追蹤解空間範圍並初始化粒子資
訊。粒子個體送入適應函數計算模組得到
對應的適應值，經過數次迭代並更新速度
與位置向量之後，便可得到一組最佳座標
位置，產生PSO人臉追蹤的輸出結果。 
 
PSO人臉追蹤
粒子資訊初始化 適應函數計算
輸出
輸入串流影像
人臉影像位置 輸出
人臉影像位置
輸入串流影像
 
圖 5 PSO 人臉追蹤 IDEF0 架構圖 
 
    根據所規劃的 IDEF0 架構圖，我們便
可將各個模組獨立切割出來，並實作在嵌
入式平台上。此處，我們選擇 Altera DE2-70
實驗板以進行 FPGA-based 的 Nios II 嵌入
式處理器平台之功能驗證，並由執行結果
評估應進行硬體化設計的部份功能模組。 
 
2.2 VHDL高階硬體合成 
 
本研究採用 Chen 及 Dai [4]所提出之
高階系統硬體設計方法論，針對色彩空間
轉換、膚色區域篩選、中值濾波及膨脹等
計算量較大的函式進行硬體架構的設計。
相關程序分述如下： 
1. 色彩空間轉換模組： 
色彩空間轉換模組有兩個設計重點；首先
是得克服色彩空間轉換公式中需要用到大
量浮點數運算的問題，針對此點，我們先
將固定的浮點數藉由移位運算放大轉換成
整數形式，等運算完成以後再將結果等比
例移位縮小，此作法不但節省硬體浮點數
運算花費的硬體電路，也大幅節省運算時
間。另外則是可將固定係數乘法轉換成移
位加法運算，以實現執行乘法運算的功
能。因此，式子(1)可轉換為式子(14)，其
實現後之硬體電路模組則如圖 9(a)。 








88)  128+1)B+4(B-1)G+2G+3G+4G+6(G-4)R+5R+6((R=C
             88)128+4)B+5B+6(B+1)G+3G+6(G-1)R+2R+5(-(R=C 
                                                       88)16+B)+3B+4(B+G)+7(G+1)R+6((R=Y
r
b  (14)
 
2. 膚色篩選區域模組： 
膚色篩選區域模組主要功能是根據輸入之
Cb、Cr 訊號，判斷是否屬於膚色區域。圖
6 所示為膚色篩選模組之 GRAFCET 建
模，狀態 1 將膚色公式 y)(x, Cb + y)(x,C0.6 r 的
固定浮點係數 0.6 放大 256 倍，得到
256 y)(x, Cb +153 y)(x,Cr ，降低所需的浮點
數運算。而實作出的硬體模組則如圖 9(b)。 
0
1
iEN=1
Temp<=256*Cb+153*Cr
2
Cr>137 && Cr<177
4
Cb>77 && Cb<127
6
Temp>48640 && Temp<55040
=1 =1
=1
=1
8
3
5
7
else
else
else
ROI = 1 ROI = 0
ROI = 0
ROI = 0
Fin = 1
Fin = 0
iEN=0
 
圖 6 SkinRegion 模組 Grafcet 建模 
3. 中值濾波器模組： 
中值濾波器模組的功能是去除 ROI 二值化
影像中的雜訊。此處，我們使用 Altera 提
供的 LineBuffer IP，以降低設計複雜度及
8 
 
(c) (d) 
Fig.15 影像資料庫 (a) class A，(b) class A, (c) class 
B, (d) class B 
本系統在連續串流影像中使用 PSO 追
蹤人臉影像區塊位置，目的是以重點區塊
的演化式搜尋方式，取代重覆針對整張影
像執行偵測運算的繁複工作，加快運算速
度並提高準確度。實驗中，我們以消費型
數位相機的錄影功能錄下 17 秒的 320x240
人臉移動影片進行測試，並使用剪輯軟體
擷取 48 張影像作為實驗連續串流影像輸
入；拍攝環境為一般室內光源，包含複雜
背景但人臉轉動小於 45˚。無任何畫面補償
後置處理。我們以此串流影像比較 PSO 人
臉追蹤系統及和重覆針對所有影像執行人
臉偵測工作所花的時間以及偵測率。軟體
測 試 平 台 為 Intel(R) 2.4MHz 四 核 心
CPU、3GB RAM 個人電腦。PSO 之參數設
定：(φ1, φ2) = (2.0, 2.0)、(L1, L2) = (20, 
20)、  = 20、eps = 1510 。表 2 所列為實
驗所得到結果。由表 2 中，我們可以發現
當 PSO 的族群大小大於 15 (粒子數>15)，
即可得到近 98%的正確率，而重覆執行串
流影像序列人臉偵測的結果，偵測率約
89.6%；且 PSO 人臉追蹤方法在平均花費
運算時間上亦優於重覆執行偵測的作法。
再進一步觀察，可以發現若以單張影像執
行運算之最長和最短時間來看，PSO 執行
人臉追蹤所花費的時間都相當接近，但是
人臉偵測所使用的時間的差距卻很大，甚
至可達 31 倍左右。 
 
2 軟硬體整合設計效能分析 
本論文已將所規劃的 IDEF0 架構圖之
各個模組獨立出來，實作到 FPGA-based 的
Nios II 嵌入式處理器實驗平台上，並考量
各個模組的效能，將硬體化後能夠顯著提
昇效能的模組獨立出來，進行 GRAFCET
建模並合成硬體電路。對於個人電腦以及
Nios II 嵌入式處理器實驗平台之效能比較
如表 3 內容所示。由於橢圓模板比對在運
算過程中因有五個參數需要調整(橢圓中
心座標、長半徑、短半徑、360˚描繪橢圓
點位置)，牽扯到多層迴圈架構，計算上相
當耗時(在 PC 模擬需要 537 毫秒)，故在
Nios II 實驗平台上我們將橢圓模板比對演
算法改成對稱凸多邊形搜尋演算法進行驗
證與比較。為了提高系統的性能，在分析
表 3 中各個嵌入式軟體模組的執行效率
後，我們也選擇四個軟體模組另外實現為
硬體架構，表 4 內容為各個模組使用的硬
體資源列表，我們分別測試每個模組運算
的周期數以及運算時間。最後我們也在表 5
中將之與 NIOS II 平台執行結果一起作效
能的比較。 
 
五、結論 
 
本論文介紹了一種基於PSO的即時人
臉追蹤系統，整體架構區分為人臉偵測及
PSO追蹤兩大部份。從實驗結果可以發
現，我們所建立的人臉偵測系統比起傳統
的Viola-Jones detector具有較佳的偵測率以
及複雜影像環境容忍度；且PSO人臉追蹤
系統相較於重覆執行串流影像的人臉偵測
運算之作法，也有更快的執行速度以及較
高的正確性。此外，為了達到應用系統微
型化與即時處理的功能要求，我們也在
NIOS II嵌入式處理器實驗平台上進行實作
和完成功能驗證，並在性能分析後針對其
中四個影像處理模組完成成硬體架構的設
計，透過軟硬體整合設計的方式有效地提
昇了系統的整體效能。 
 
參考文獻 
 
[1] 顏妙純, 一個即時移動物偵測與追蹤的
嵌入式系統, 碩士論文, 2009, 國立中央
大學. 
[2] A. Arsenioa and J. Sanos-Victor, “Robust 
Visual Tracking by an Active Observer”, 
IEEE IROS 97, Vol. 3, 1997, 
pp.1342-1347. 
[3] B.D. Lucas and T. Kanade, "An Iterative 
Image Registration Technique with an 
Application to Stereo Vision (DARPA)," 
Proceedings of the 1981 DARPA Image 
Understanding Workshop, 1981, 
10 
 
膚色區域篩選 SkinRegion 0.73 1155 
中值濾波 MedianFilter 2.86 463 
膨脹 Dilation 2.70 379 
連通物件標定 CCLabeling 5.01 362 
LoG 遮罩& 橢圓模板比對 LoG Filter、EllipseTemplateMatching 2.81+537.63  
對稱凸多邊形判斷   23 
粒子資訊初始化 PSO Initialize 6.43 8288 
適應函數計算 PSO tracking 263.05 93538 
 
表 4 硬體模組使用資源表 
模組名稱 使用 Logic Element Most Critical Path Delay(ns) 
RGB2YCbCr 286 2.38 
SkinRegion 87 4.217 
MedianFilter 64 4.254 
Dilation_linebuffer 43 4.254 
 
表 5 NIOS II 和硬體 IP 效能比較 
模組名稱 Hardware at FPGA NIOS II at FPGA 
cycles Execution time (ms) Execution time (ms) 
RGB2YCbCr 460790 1.09  
6.16 
886  
2883 SkinRegion 705032 2.97 1155 
MedianFilter 311367 1.32 463 
Dilation_linebuffer 184320 0.78 379 
 
 
 
 
98年度專題研究計畫研究成果彙整表 
計畫主持人：陳慶逸 計畫編號：98-2221-E-130-020- 
計畫名稱：智慧型人臉偵測/追蹤之軟硬體共同設計(II) 
量化 
成果項目 實際已達成
數（被接受
或已發表）
預期總達成
數(含實際已
達成數) 
本計畫實
際貢獻百
分比 
單位 
備 註 （ 質 化 說
明：如數個計畫
共同成果、成果
列 為 該 期 刊 之
封 面 故 事 ...
等） 
期刊論文 0 2 100%  
研究報告/技術報告 1 1 100%  
研討會論文 1 2 100% 
篇 
 
論文著作 
專書 0 0 100%   
申請中件數 0 0 100%  專利 已獲得件數 0 0 100% 件  
件數 0 0 100% 件  
技術移轉 
權利金 0 0 100% 千元  
碩士生 2 2 100%  
博士生 1 1 100%  
博士後研究員 0 0 100%  
國內 
參與計畫人力 
（本國籍） 
專任助理 0 0 100% 
人次 
 
期刊論文 0 0 100%  
研究報告/技術報告 0 0 100%  
研討會論文 0 0 100% 
篇 
 
論文著作 
專書 0 0 100% 章/本  
申請中件數 0 0 100%  專利 已獲得件數 0 0 100% 件  
件數 0 0 100% 件  
技術移轉 
權利金 0 0 100% 千元  
碩士生 0 0 100%  
博士生 0 0 100%  
博士後研究員 0 0 100%  
國外 
參與計畫人力 
（外國籍） 
專任助理 0 0 100% 
人次 
 
 
