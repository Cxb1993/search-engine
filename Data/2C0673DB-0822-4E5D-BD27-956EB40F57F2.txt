 I 
中文摘要 
    本子計畫已經建立一小型人形機器人系統平台，並以其動態平衡為主要的研究主
題。本子計畫主要探討以此小型人形機器人進行跨越障礙物之動態平衡，其研究方法
敘述如下：首先，校正所設計的動態感知系統(即一個三軸加速度計與兩個單軸陀螺
儀之組合)，並以 Butterworth 和 Kalman 濾波改善 Pitch 和 Roll 角度量測之精度。接
著，操控機器人跨越障礙並藉由動態感知系統擷取相關資訊(即其 Pitch 和 Roll 軸之角
度響應)，分析其跨越障礙的響應，藉以設計適當的步態修正策略(即模糊分散平衡控
制)，使得人形機器人跨越障礙物能適應不同的外力干擾(例如，以手指戳碰機器人)。
本子計畫包括如下五個研究主題：(一)伺服機構之設計，(二)嵌入系統之建構，(三)
具有步態規劃和即時控制之人機界面，(四)FPGA 為基準的動態感測系統之設計與開
發，(五)應用此動態感測系統於模糊分散平衡控制之實現。最後，以相關實驗證明所
建議方法的可行性及有效性。 
關鍵字：小型人形機器人、伺服機構設計、FPGA、動態感測系統、人機界面、步態
規劃、模糊分散平衡控制、跨越障礙物。 
  
Abstract 
    The main theme of this subproject is to build up a platform for the small-sized 
humanoid robot with the consideration of dynamic balance. The stepping over an obstacle 
with dynamic balance is addressed in this subproject. In the beginning, the proposed 
dynamic sensing systems (i.e., the fusion of one three-axis accelerometer and two  
single-axis gyros) are calibrated. Together with the use of Butterworth and Kalman 
filtering, the measured accuracy of the pitching and rolling angles is improved. Then the 
proposed dynamic sensing system is employed to obtain the angular responses of the 
pitching and rolling axes of the center of gravity (COG) during the stepping over an 
obstacle. After the anaysis of the response, the suitable path for the stepping over an 
obstacle is effectively planned. In addition, the fuzzy decentralized balance control is 
designed such that it can be successfullly operated in the presence of the external 
disturbance. The main research topics of this subproject include the following five parts: (1) 
the design of servomachanisim, (ii) the design of embedded system, (3) human-man 
interface for path planning and real-time control, (4) the design and development of 
dynamic sensing system, and (5) the fuzzy dynamic balance control using the proposed 
dynamic sensing system. Finally, the corresponding experiments confirm the effeciency 
and effectiveness of the proposed method. 
Keywords: Small-sized humanoid robot, Mechanism design, Servo control system, 
Dynamic sensing system, Human machine interface, Path planning, Dynamic balance, 
Stepping over the obstacle. 
 
 
 
 
 
 
 
 
 
 
 
 
 
 1 
一、前言及研究目的 
眾所周知，人形機器人之研究需要整合多項技術，例如，電力電子科技、計算
機技術、機械技術、人工智慧與運動學等各項理論，可以探討的題目也非常的多元，
國內在機器人相關領域的研究，學術界已發展多年，而且在人形機器人的研究亦有一
些相關研究成果[1]-[15]。機器人產業為一個高度技術整合、高度關聯性且具有高附加
價值的明星產業，未來應用之範圍非常廣泛，除了產業用機器人外，更擴展到服務、
娛樂、軍事、救災與保全用機器人，對國內整體經濟效益提升具有舉足輕重，因此
2005 年政府已將智慧型機器人產業列為發展重點。目前由四大法人研究單位(即工研
院機械所、金屬中心、精密機械中心及中科院)帶頭投入在智慧型機器人產品與技術
之研究。此外，台灣已經在 2007 年春季成立「台灣機器人產業發展協會」，它集合了
機械業、玩具業、保全業、資電業、家電業等各產業代表，以及學界、法人代表，一
起來推動機器人產業，發展台灣經濟的新紀元。 
本計畫研究目標為人形機器人的動態平衡([2]，[6]，[8])，一如人類嬰兒，機器
人也不是天生就能夠在運動中達到平衡，人類靠各種感官感受外界資訊，藉以平衡自
身動作，而機器人則需要感測器，藉以修正(或平衡)本身動作。一般的動態平衡策略
可分如下五種:機器人重心(COG)的 Pitch 和 Roll 角度，機器人身體姿態，零力矩
(ZMP)，著地點及角動量，以設計平衡策略。本子計畫所設定為人形機器人跨越障礙
物的操控[3]、跨越障礙物之步態規劃[16]，以及其遭受外部干擾之動態平衡策略[17]。
在計畫中需要整合如下研究：(一)伺服機構之設計，(二)嵌入系統之建構，(三)具有
步態規劃和卽時控制之人機界面，(四)FPGA為基準的動態感測系統之設計與開發，(五)
應用此動態感測系統於模糊分散平衡控制之實現。本計畫使用如圖一所示的小型人形
機器人實驗平台，包括 21 個自由度(不包含頭部)，應用一個三軸加速度計與兩個單軸
陀螺儀組成動態感知系統，並以 Butterworth 和 Kalamn 濾波改善 Pitch 和 Roll 角度量
測之精度[18]-[21]。藉由此動態感知系統完成人形機器人於跨越障礙物時，遭受外部
干擾(例如，以手指戳碰機器人)之動態平衡。此外，本計畫並開發人機界面，編輯與
產生機器人各馬達的角度與速度控制，組合成所需的動作，完成步態規劃和即時控
制。就我們所知的人機介面中，乃是根據逆運動學推導相關馬達所需轉動之角度(例
如，[1]-[15])，下命令於相關馬達以獲得所想要的姿態，然而這種方式相當耗費時間，
不適合於即時的任務。本計畫所設計的介面將採取不同的方式來創建機器人的動作，
首先以卸力的功能取消馬達之 Holding 力矩，再任意地轉動機器人的自由度以獲得想
要的姿態，接著恢復馬達的 Holding 力矩，並經由回授的功能紀錄與儲存此姿態的相
關馬達之角度，即可完成所需的動作。 
    本計畫報告之組織結構如下：第二段落將探討饲服機構之設計，此乃本整合計畫
的第二代人形機器人，第三段落將討論嵌入系統之建構，第四段落探討具有步態規劃
和即時控制之人機界面，第五段落為 FPGA 為基準的動態感測系統之設計與開發，第
六段落為應用模糊分散控制於動態平衡，至於跨越障礙動態平衡之實驗結果則安排於
第七段落探討，最後，將結論與未來研究安排於第八段落。 
 
 
 
 
 
 
 
 
 3 
2.1 各部位之機構設計 
(1)具有 6 個自由度之腳 
如圖四所示的機器人的腳部設計，乃是採用大、小腿等長比例，以避免於行走中
因屈膝易使重心移出腳底板外，而造成機器人重心無法平衡；至於膝關節則設計成讓
機器人半蹲時，重心位置能保持更低，使得機器人更容易達到平衡。機器人雙腳各規
劃 6 個自由度：標示 1 為股關節旋轉自由度的伺服機，用來控制機器人腳部轉動；標
示 2、3 為髖關節的前後與左右兩個自由度的伺服機，用來控制機器人的腳部可以前
後與左右的轉動；標示 4 為膝關節彎曲自由度的伺服機，用來控制機器人小腿前後的
轉動；標示 5、6 為腳踝關節的左右與前後兩個自由度的伺服機，用來控制機器人的
腳掌可以左右與前後的轉動。而如圖五所示為腳部長度之尺寸。 
 
  
(a) 正視圖 (b) 3D 視圖 
圖四、機器人腳部自由度圖 
 
 
圖五、機器人下半身長度規劃圖 
(2)具有 4 個自由度之手 
手部機構設計的目在讓機器人可以舉起重物及跌倒時將機器人上半身撐離地
面。如圖六所示的雙手各規劃 4 個自由度：標示 1 為肩膀前、後的自由度的伺服機，
用來控制機器人手部的前後轉動，將伺服機設計於機器人身體內部，是為了使機器人
上半身重量更靠近重心；標示 2 為肩膀左右自由度的伺服機，用來控制機器人手部的
左右轉動；標示 3 為手腕旋轉自由度的伺服機，用來控制機器人手掌的旋轉；標示 4
 5 
 
圖九、機器人身體正視圖 
 
(4)機器人被動保護機構 
    如圖十所示的在機器人前後面分別安裝兩片 0.6mm 厚的鋼條，當機器人受到外
力撞擊時(例如，跌倒)，鋼條可以保護其內部的微處理器和驅動電路板不會毀損。此
外，鋼片具有彈性，能夠減小其本身所受到的衝擊，而且不會完全貼於地面，故在執
行跌倒爬起來時，手部相對可以減輕支撐身體的重量，更容易完成跌倒爬起的動作。 
 
  
圖十、機器人身體保護機構 
 
同理，如圖十一所示的肩膀關節是比較脆弱的，如果機器人在跌倒時，由側邊先接觸
到地面，有可能會照成肩膀的機構斷裂，因此我們在肩膀份放上保護墊。 
 
  
圖十一、機器人肩膀保護機構 
 
2.2 伺服馬達 
    本計畫皆使用 Robotis 之伺服馬達，其最大的特色為控制訊號訊為 UART 的數位
資料，與一般使用 PWM 訊號來控制的伺服馬達不同，也因為使用數位資料的方式來控
制，可以藉由傳送命令的方式使馬達回傳位置、溫度及電壓等相關訊息。總共使用 2
顆 RX-64(參考圖十二及表二)、11 顆 RX-28(參考圖十三及表三)、8顆 AX-12(參考圖
十四及表四)。RX-28 主要應用於腳部及腰部，但考量膝關節負荷較大，其亦使用
RX-64。由於 RX-64 重量較重且體積較大，採用太多會造成機器人總重增加。因為機
器人上半身的手部負擔並不大，採用重量較輕且體積較小的 AX-12。 
 
 
 7 
 
圖十四、伺服馬達 AX-12 
 9 
圖十七、嵌入系統 RB-100 的周邊 I/O 
表一、嵌入系統 RB-100 規格 
處理器 DM&P Vortex86DX 
BIOS AMI BIOS 
記憶體 256MB DDR2 onboard  
ADCs AD-7918 10-bit  
I/O 界面 Micro SD slot, USB 2.0 version 
耗電 +5V @400mA 
輸入電源 DC-in 6V to 24V  
尺寸 96 x 56 mm 
重量 40g  
適用 
作業系統 
DOS, Windows 98/ME, Windows XP/ XP Embedded, 
Windows Embedded CE, Windows Embedded Standard Linux  
 
 本計畫所應用的 RX-64、RX-28、AX-12 馬達之控制訊號為 RS-485 及 TTL UART，
嵌入系統 RB-100 本身有提供 4 種不同的 UART 模式(RS-232/RS-485/TTL Full 
Duplex/TTL Half Duplex)，因為各種 UART 模式分別位於不同的連接埠，在考量整體
訊號同步及走線規劃，藉由一個訊號整合轉換電路，將所有馬達串在同一個 UART 訊
號(參考圖十八)，如此一來可避免因通訊埠不同造成指令傳送不同步的現象。  
 
圖十八、訊號整合轉換模組 
 
3.2 訊號整合轉換模組 
圖十九為馬達控制訊號整合轉換簡化電路圖。此電路利用MAX232將RS-232 Full 
Duplex 轉換為 TTL Full Duplex，之後使用 MAX485 將 TTL Full Duplex 轉換為 RS-485 
Half Duplex，將 RX-28 及 RX-64 的控制訊號連接至此，後端再用 MAX485 將 RS-485 
Half Duplex 轉換為 TTL Half Duplex，之後將 AX-12 控制訊號連接於此。因機器人的
控制命令中有使用到回授命令，因此在半雙工的訊號部分必須確保資料流向切換正
確，在本電路上利用最簡單的反向閘進行資料流向控制，並使其能達到
ADDC(Automatic Data Direction Control)的功能。但因運作原理的需求，馬達控制訊號
來源必須為 RS-232 訊號，再加上高速鮑率的需求，此訊號來源為利用 FTDI 公司的
FT232 USB to Serial Convertor 所產生的 RS-232 訊號，經過實測後確認此電路可達到
250Kbps 的鮑率，高於 RB-100 內建的 UART 所能提供的最高 115.2Kbps。 
 11 
Convertor)，可以將加速度值轉換為 12-bit 的數位資料後，再透過 I2C 或 SPI 兩種不同
的數位介面輸出，資料輸出頻率可依需求選擇，最高可達 6.25MHz。 
 
表五、LIS3LV02DQ 加速度計規格 
Parameter Type Max unit 
Supply Voltage 3.3  v 
Full Scale Range  2  g 
Current consumption   0.8 mA 
Resolution of the internal ADC 12  bit 
SPI SCLK  6.25 MHz 
 
 
圖二十一、LIS3LV02DQ 加速度計圖 
 
當機器人跨越障礙時，在身體重心不穩的情況下，易於造成其往前或往後傾倒，
在此使用 MLX90609 單軸陀螺儀偵測機器人身體是否傾斜，陀螺儀的動態範圍在±300 
°/s 之間，MLX90609 有兩種通訊界面，類比訊號透過 A/D 轉換器轉成數值後，再使
用是 SPI 傳輸模組將資料送出。陀螺儀原理敘述如下: 陀螺儀由高速旋轉剛體子中，
旋轉轉子在空間能保持固定狀態並抗拒一切使其改變的力。當受到扭轉力時，它的轉
動方式取決於扭轉力的大小和方向以及陀螺儀安裝的初始狀態。垂直方向自由旋轉的
陀螺儀(萬向支架，兩個半圓環成直角裝在萬向支架上，使其可向任何方向轉動)在運
載工具俯仰傾斜時仍然保持垂直，從而提供一個人工的地平線。水平的陀螺儀將保持
一定的方向，在飛機(輪船)轉彎時指出航向。 
 
表六、MLX90609 規格 
Parameter Type Max unit 
Supply Voltage 5  v 
Full Scale Range  150  s  
Resolution of the internal ADC 11  bit 
Output Full Scale 1920  LSB 
Zero Rate Output (Bias) 1008  LSB 
SPI SCLK  6.25 MHz 
*LSB abbr. = least significant bit 
 
 
 13 
四、具有步態規劃和卽時控制之人機界面 
4.1 馬達控制頁面 
人形機器人在設計與調整動作，是相當複雜與艱難的，往往需要花費許多時間，
若是直接使用程式設計或調整，不僅在設計動作的時間會很長，而且還會發生輸入錯
誤的數值，造成馬達或機構上的損傷。基於以上的理由，本計畫使用 Visual Studio 2008
開發一人機界面以設計與調整機器人的動作，藉著圖形視窗化界面，輸入與輸出使用
者所需要的資料，避免錯誤資料的輸入與單顆馬達誤植資料而需全部重新鍵入。所完
成的人機界面具有傳輸的功能、馬達回傳與編輯功能，其分別敘述如下: 
(1)編輯功能 
編輯功能主要是讓使用者容易並有效率的設計與調整機器人動作，其界面如圖二
十三所示。編輯的方式可分為以下三種:(a)單一傳送模組，(b)馬達卸力模組，(c)選定
馬達傳送模組。 
(a)單一傳送模組 
使用者可以任意調整機器人全身馬達的角度，當選取界面機器人圖形中欲選取的
馬達時，圖形中的馬達便會轉換成紅色，以供使用者亦於分辨欲調整的馬達，使用者
僅需給各顆馬達角度與速度的數值，機器人便會轉到對應的角度。此功能可以觀察機
器人整體的動作與速度。 
(b)馬達卸力 
在調整機器人動作時，輸入每顆馬達適當的數值以達到理想中的動作是非常困難
的，往往調出來的動作大不如預期，此時使用者都會希望用手將馬達轉到所希望的位
置，並讓機器人維持在使用者所期望的姿勢。馬達卸力編輯就是利用上述的功能，將
馬達卸力，讓使用者將馬達轉至想要的位置，並按下編輯界面如圖二十三所示的解除
按紐，以恢復馬達的力矩，讓機器人維持目前動作。此功能可以相當快速地設計動作
與觀察機器人動作的協調性與整體平衡，並達到更人性化的特性。 
(c)選定馬達傳送 
在機器人動作調整，有時使用者只想要針對某幾顆馬達進行調整，如下圖二十三
所示的選定馬達傳送只要勾選所需要調整的馬達，並輸入要調整該幾顆馬達的角度與
速度。 
 
圖二十三、編輯界面 
 15 
(3)組合動作 
組合動作功能就是將多筆已經調整好的單一動作做串聯，每筆單一動作前設有獨
自的 ID，讓使用者易於在多筆動作下做區分與執行。如圖二十五為多筆以調整好的
單一動作資料，圖二十六為組合動作編輯界面，使用者需先設一個四位數的 ID 給欲
執行的組合動作，並將要做組合的單一動作 ID 填入 Act1~Act9 中，而 D1~D9 為各單
一動作與動作間的延遲時間。如圖二十七所示的將欲執行組合動作的 ID，填入組合
動作界面中，並按下傳送組合動作按鈕。 
 
 
圖二十七、組合動作傳送界面 
 
(4)存檔與讀檔 
若所完成的動作資料無法透過軟體來儲存，那將會造成在使用上的不便，每當使
用者重新啟動軟體，就必須從新輸入各顆馬達的資料。所設計的人機界面軟體尚具有
存檔與讀檔的功能，而存檔與讀檔主要是將以完成的單一動作與組合動作資料來儲存
與讀取的功能，在此我們使用 Visual Studio 2008 中的 DataGridView 元件來修改與管
理資料。存檔的功能是將完成於 DataGridView 元件中的資料以橫寫的方式寫入於記
事本中，使用者也可以直接由記事本來修改每顆馬達的資料。讀檔的功能與寫檔相
反，讀取記事本中的資料存入暫存器中，並顯示於 DataGridView 元件中，可使用兩
種方式來修改馬達的資料，第一種方式，直接從人機界面的 DataGridView 中修改，
而另一種為在以存好的記事本中修改。 
 
4.2 動作調整規劃 
在此以人形機器人跨越障礙為例，來介紹如何使用人機界面來調整動作。在機器
人跨越障礙之前，初始站立是非常重要，並須維持雙腳每個自由度左右對稱。人形機
器人跨越障礙動態平衡分為如下兩點：(1)步態分析，(2)重心調整。現在分別敘述如
下: 
(1)本計畫將跨越障礙動作如圖二十八，分為六個步驟：(a) Step 1為機器人初始站立在
障礙物後面，(b)Step 2為抬起其中一隻腳，並跨越過障礙物，(c)Step 3為將跨越過的
腳放到地面，(d)Step 4為將重心由後腳移到前腳，(e)Step 5為將後腳抬起並跨過障礙
物，(f)Step 6為調整回初始站立。其中Step 3與Step 5為單腳支撐(Single-Support-Phase)
 17 
 
  Step1          Step2        Step3 
(a) Step1 to Step 3 
 
  Step4          Step5        Step6 
(b) Step 4 to Step 6 
圖二十八、機器人步態分析 
 
1 2 
3 4 
5 6 
7 8 
9 10 
圖二十九、跨越障礙動作側視圖 
 19 
VHSIC 又是 Very High Speed Integrated Circuit 的縮寫)以及Verilog HDL，此系統主要
是使用Verilog HDL來進行撰寫，可以撰寫設計者所需的電路模組，電路運行時為平行
處理，與一般微處理器上以C程式語言順序處理運行的系統相比，在一般微處理機上
所執行的C語言通常都是單行執行，程式一次只會執行一行，等該行程式執行完成後
才會執行下一行，而硬體描述語言所產生的數位電路則不一樣，各個不同的模組可以
同步執行並節省大量的運算時間，另外，可重新編輯的電路於系統架構變化的適應力
也大大優於實體電路[26]，[27]。 
 
5.2 雙處理器系統架構 
    雙處理器系統架構方塊圖如圖三十一，於NIOS核心板內，粗黑框部分即為DHL
設計之電路模組，包含感測器訊號擷取控制以及傳送至RB-100的回傳模組，NIOS CPU
即為處理DHL無法設計的濾波器演算法處，包含巴特沃斯濾波器以及卡爾曼濾波器，
於RB-100實現運動控制，模糊分散式控制等功能，所有感測器資料使用串列傳輸，遵
守雙處理器架構所協調的傳輸協定作資料交換，使用此方法架構此系統架構。 
 
NIOS
CPU
Pitch軸
陀螺儀
Roll軸
陀螺儀
三軸
加速度計
小型人
形機器
人控制
與模糊
控制端
NIOS EP2C35
濾波器結
果資料
所有感測
器資料
各感測器控制模組
RB-100
回傳
模組
圖三十一、雙處理器系統架構方塊圖 
 
本動態量測系統包括感測器的量測以及濾波器的使用，其架構如圖三十二虛線左
邊部分，內容上先介紹感測器量測的內容，分為公式計算以及實際量測情形以及量測
模組。 
 
 21 
xg
zg
 
圖三十四、加速度計訊號換算 Pitch 軸角度 
同理可得Roll軸傾斜角度為 
 
 1tan .Roll y zg g   (5.4) 
  實際上使用時，由於加速度計得到的是XYZ三軸的加速度值，再加上加速度計
本身靈敏度高，很容易受到外界干擾所產生的加速度所影響，因此於實驗中的加速度
計曲線變化非常劇烈，此外，實驗中還發現兩個加速度計容易產生誤差的情況，第一
個是在運動方向改變時，第二為當加速度計只有水平移動，而沒有轉動時，這兩種誤
差都跟加速度計得到的是XYZ三軸的加速度值此特性有關。 
  加速度計於運動方向改變時，於改變瞬間會量測到與改變方向反向的的角度變
化，如圖三十五，為單軸來回擺動30度的比較圖，圖上方為加速度計的數據，圖下方
為同時刻馬達回授的數據，由圖中顯示，於靜止時向正轉方向啟動時，會先量測到短
暫的負向轉動後，才會得到正轉的加速度計數據，同樣的狀況也會反映於每個波峰與
波谷，因為波峰與波谷皆為方向改變處，所以波峰與波谷值值皆高於正負30度。 
 
圖三十五、加速度計擺動於運動方向改變所出現的誤差 
 
  當加速度只有水平移動，而沒有轉動時，經過反三角函數將會顯示Roll軸的角
度會有變化，但實際上，Roll軸並沒有發生轉動，如圖三十六。 
  雖然加速度計所提供的傾斜角度不會隨著時間發散，但因為加速度計具有曲線
變動劇烈、運動方向改變時具有反向角度以及水平移動時會誤判為轉動等三項狀況，
所以實際上量測機器人傾斜角度時，會採用搭配陀螺儀並經過巴特沃斯濾波器以及卡
爾曼濾波器。 
 23 
表七 加速度計SPI模組腳位功能表 
腳位名稱 功能 
iSYS_CLK 模組工作時脈 
iSPI_MISO_SDI SPI Data Input 
oDATA_AVAILABLE 資料就緒 
oXA X方向分量資料輸出 
oYA Y方向分量資料輸出 
oZA Z方向分量資料輸出 
oSPI_CS SPI Chip Select 
oSPI_SPC Clock for SPI Data Transfer 
oSPI_MOSI_SDO SPI Data Output 
 
5.4 陀螺儀訊號量測與SPI模組 
    使用陀螺儀量測角速度時，首先必須知道其轉向，角速度為正，則為正向旋轉，
角速度為負，則為反向旋轉，接下來，因為所使用之陀螺儀為數位格式，必須經過轉
換得到角速度物理量，求得物理量後，以積分角度來看，只要將角速度積分即可得角
度，但是，實際上使用與公式計算的理想值還是會有誤差，此誤差來自於陀螺儀本身
的物理特性，常稱為偏壓準位飄移，以下將詳述此一特性。 
    所使用之陀螺儀為量測單一軸向的Z軸角速度，其旋轉座標定義符合右手定則，
如圖三十八(a)陀螺儀上⊕符號代表插入紙面，其旋轉之正負轉向即為如三十八圖(b)
所示。 
 
  
(a)座標定義與實體對照 (b)旋轉定義 
圖三十八、MLX90609陀螺儀方向定義(a)座標定義(b)旋轉定義 
 
    本段中，陀螺儀所需要注意的公式如式(5.5)與式(5.6)，分別為將陀螺儀讀值轉換
成角速度物理量以及將角速度積分為角度的公式： 
 
  g data biasc g g                  (5.5) 
 1 1k k k t       (5.6) 
其中 300 / 2048 0.147deg (  )gc s bit  。由陀螺儀規格可知讀取陀螺儀資料為數位
格式，以11個Bit回傳所量測到的角速度，11個Bit代表結果為0到2047，並非正規化的
 25 
0t 1t 2t 3t 4t
0
1
2
3
t

 
圖四十、角速度對時間函數圖 
 
 
0
1 0
2 0 1
( ) 0
( ) ( )
( ) ( ) ( )
...
t
t t t
t t t t t

 
  

 
   
 (5.7)
  
 
    實際上使用陀螺儀時，其本身的偏壓準位非常容易受到干擾，此現象稱為偏壓準
位漂移，首先，需要找尋所謂的 biasg ，圖四十一為靜止不動時陀螺儀 datag 的輸出值，
可發現靜止不動時其輸出值並非落於理想值1023，而大部分落於1008上下，並且震盪
不停，這是因為每個陀螺儀廠商製造出來的規格不同，所以偏壓準位也不同，1008
正好符合本文採用的陀螺儀其內部規格的設定，詳見附錄1，由此可知若將偏壓準位
直接使用1008代入式(5.5)，並以式(5.5)的角速度代入式(5.6)，將會得到如圖四十二的
結果，求出的角度將會向其中一個方向偏移，實際上，本文將不直接使用式(5.5)所求
得的角速度來求得機器人的傾斜角度，但是將以式(5.5)所得的角度與其他感測器結果
做比較。 
 
圖四十一、陀螺儀靜止狀態下角速度示意圖 
 
 27 
5.5 巴特沃斯濾波器 
 使用巴特沃斯濾波器之主要目的為減少加速度計之誤差，以提高卡爾曼濾波器
的精準度，詳細原因與設計方式描述如下。 
    由於實驗中觀察到加速度計分別容易於運動方向改變與水平方向移動時出現誤
差的狀況，若不做訊號處理，加速度計與馬達回授之間的誤差很大，以圖3.4為例，
當馬達擺動到30度以及負30度時，加速度計得出的角度最大來到50度，誤差高達20
度，由式(5.32)可知，加速度計量測的角度會影響到 kY ，而 kY 於式(5.36)中會與卡爾
曼增益 kK 相乘後更新一個新的卡曼估測角度 k 與 ,bias kg ，由此可知，加速度計訊號準
確度提高，有助於卡爾曼濾波器的準確度提高，於是對於加速度計訊號處理方面，使
用巴特沃斯濾波器做低通濾波，以消除大部分的加速度計高頻雜訊，包括減小加速度
計的訊號顫震以及運動方向改變時的誤差，但加速度計水平移動產生的誤差依然無法
於兼顧減少上兩項誤差的狀況下獲得解決，這是因為加速度計水平移動所產生的誤差
其頻率與所需要的訊號頻率相近，若將截止頻率設定到連水平移動產生的誤差都消
除，則會連所需的訊號都消除掉，所以需要的是盡量減小加速度計於圖3.3的擺動實
驗中所得的角度與馬達回授的誤差，使得到的 acc 能盡量的準確，至於水平移動所產
生的誤差，於卡爾曼濾波器中交由陀螺儀於平移中訊號不變的特性即可處理。 
本章節參考了文獻[28]-[30]的相關內容，此方式主要使用了MATLAB軟體中的三
個函式："fft"，"butter"以及"filter"，經過前兩個函式，就可以取得經過巴特沃斯濾波
器後的訊號，若此訊號符合需求，在"butter"指令中所得到的轉移函數參數就會被
"filter"的函式所使用。 
首先，由於本文使用的人型機器人於步行動作中，身體左右來回擺盪約1.5Hz，
所以我們將加速度計安置於馬達平台上，以擺動頻率1.5Hz來回30度取其訊號，取樣
頻率為640Hz；加速度計訊號如圖四十四，取得此訊號以後，將其透過MATLAB裡提
供的快速傅立葉轉換如式 (5.8)，其中，Original_Signal為原始未濾波前訊號，
Tran_Signal為經過傅立葉轉換後的頻率強度訊號，為了方便觀察，將頻率強度的頻率
軸零點置中，並取其絕對值，將其對頻率作圖可得到頻率分布圖如圖四十五。 
 Tran_Signal = fft (Original_Signal )  (5.8) 
 
 29 
 
圖四十六、濾波後加速度計角度訊號 
 
    觀察濾波後的加速度計角度訊號，與圖四十四比較，可發現濾波後訊號比較平
整，角度也比較準確，若將此訊號經式(5.9)，畫出頻率強度對頻率分布圖如圖四十七，
與圖四十五比較，可發現頻率強度大於2的訊號幾乎被濾除，以下將使用巴特沃斯濾
波器作低通濾波的結果前後比對於圖四十八。 
 
圖四十七、濾波後加速度計頻率強度分布圖 
 31 
點來看，有兩種方式可以解決，第一、若陀螺儀一段時間可由另一個感測器得到角度
參考，隨時間發散現象可減小；第二、陀螺儀偏壓準位飄移現象如圖四十二，此現象
為於量測範圍中點間小幅度震盪，若能估計這小幅度的震盪，並使用估測出來的偏壓
準位作積分得到角度，隨時間發散現象也可減小，所以尋找具估測並更新功能的感測
器，就能解決前兩小節感測器的誤差現象，於是本小節使用卡爾曼濾波器處理加速度
計及陀螺儀的量測值，以達到得出準確傾斜角度的目的，本章參考參考文獻[18]-[21]。 
     卡爾曼濾波器(Kalman Filter)是一種遞迴估計的數位濾波器，即只要獲知上一時
刻狀態的估計值以及當前狀態的觀測值就可以計算出當前狀態的估計值，因此不需要
記錄觀測或者估計的歷史信息。卡爾曼濾波器與大多數濾波器不同之處，在於它是一
種純粹的時域濾波器，可以避免如頻域濾波器需要在頻域設計再轉換到時域實現的繁
雜手續。 
    卡爾曼濾波器的操作包括兩個階段：預測與更新。在預測階段，濾波器使用上一
狀態的估計，做出對當前狀態的估計。在更新階段，濾波器利用對當前狀態的觀測值
優化在預測階段獲得的預測值，以獲得一個更精確的新估計值，圖四十九為卡爾曼濾
波器執行步驟示意圖，包含各階段所使用的變數以及簡化後的結果，相關公式將於後
詳述其定義。 
1 , 1
| 1
, , 1
ˆ ˆ ˆ( )ˆ
ˆ ˆ
k k data bias k
k k
bias k bias k
g g t
X
g g
   


     
    
      
00, 01,
| 1
10, 11,
k k
k k
k k
P P
P
P P
 
  
 
ˆ
k acc kY   
00,k k kS P r 
00,0 1
10,1
k
k k
k
PK
K S
PK
      
   
0
|
, 1
ˆ
ˆ
ˆ
k k
k k
bias k k
K Y
X
g K Y
 
  
  


00, 00, 0 01, 01, 0
|
10, 00, 1 11, 01, 1
k k k k
k k
k k k k
P P K P P K
P
P P K P P K
  
    
 
圖四十九、卡爾曼濾波器執行步驟示意圖 
 
    卡爾曼濾波器的狀態表示為以下兩個變數，系統狀態 |ˆ k kX 以及誤差相關矩陣
|k kP ，其中k為現在時刻，k - 1為上一時刻， |ˆ k kX 為在時刻k的系統狀態估計， | 1ˆ k kX 
則為根據時刻 k - 1 狀態，在時刻 k 的系統狀態估計，而誤差相關矩陣則為度量估
計值的精確程度；預測階段有兩個公式，分別為式(5.15)預測狀態，及式(5.16)預測估
計協方差： 
 33 
 
00, 1 01, 1
1| 1
10, 1 11, 1
k k
k k
k k
P P
P
P P
 
 
 
 
  
   (5.26) 
 
00
11
0
0k
Q
Q
Q
 
  
   (5.27) 
 
1k  為k-1時刻卡爾曼濾波器估測的傾斜角， , 1ˆbias kg  為k-1時刻陀螺儀偏壓準位； t
為取樣時間，本實驗取樣時間取得方式為於卡爾曼濾波器每一次處理迴圈的起始與結
束中，設定NIOS其中一個腳位的電位產生升降變化，使用示波器測量此腳位電位變化
頻率，即為取樣時間； datag 為陀螺儀讀值，此陀螺儀讀值為 data gg c ，須注意此處並
無減去偏壓準位，因為偏壓準位需要經過卡爾曼預測與估計； 00, 1kP  、 01, 1kP  、 10, 1kP  及
11, 1kP  為k-1時刻的誤差相關矩陣元素； 00Q 為加速度計的雜訊， 11Q 為陀螺儀的雜訊，
這兩個數值必須經由實驗嘗試去得到最理想的數值；將以上參數對應到式(5.15)及式
(5.16)的預測公式，則可以表示如下： 
    | 1 1| 1
ˆ ˆ
k k k k k k kX F X B U   
1 , 1
, 1
ˆ ˆ( )
ˆ
k data bias k
bias k
g g t
g
  

   
  
    (5.28) 
    | 1 1| 1
T
k k k k k k kP F P F Q     
   
00, 1 10, 1 01, 1 11, 1 01, 1 11, 1 00
10, 1 11, 1 11, 1 11
( ) 0
0
k k k k k k
k k k
P t P P P t P tP Q
P tP P Q
     
  
       
       
         
(5.29) 
 
在更新公式中各個參數分別定義如下： 
 
00, 01,
| 1
10, 11,
k k
k k
k k
P P
P
P P
 
  
   (5.30) 
  k kR r  (5.31) 
  1 0kH   (5.32) 
式(5.30)為式(5.29)中 | 1k kP  相對應的各元素， kr 為預測雜訊協方差，此數值為可調整
的參數，需要經由實驗測試得到。若對應到式(5.17)至式(5.21)的更新公式，則可以
表示如下： 
 | 1
ˆˆ
k k k k k acc kY Z H X        (5.32) 
 | 1 00,
T
k k k k k k k kS H P H R P r     (5.34) 
 
00,1 1
| 1
10,
kT
k k k k k k
k
P
K P H S S
P
 

 
   
    (5.35) 
 35 
 
圖五十、平衡控制模組流程圖 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 37 
(6) (7) 
(8) (9) 
(10) (11) 
(12) (初始站立 999) 
圖五十一、跨越障礙物各單步動作 
 
6.2 小型人形機器人平衡修正方式 
  小型人形機器人之機構以及馬達設計為依照人類型態與運動自由度的設計，所
有馬達皆為Pitch軸、Roll軸以及Yaw軸所組成，在本章節中，每個動作受到干擾以及
恢復平衡所需調整的動作，將主要分為機器人前後以及左右的Pitch軸以及Roll軸這兩
個軸向的馬達調整；組成跨越障礙物的12單步動作中，以圖五十一的編號分為編號1
到編號12的單步動作，將要調整的方向分為兩個方向，分別為Pitch軸以及Roll軸這兩
 39 
 
 
 
 
圖五十三、馬達 ID 與坐標軸定義 
 
    圖五十三為小型人形機器人身上各馬達ID的編號及座標軸的定義，本章討論之馬
達不包括頭部，以下將依分類說明校正方式： 
(1) 雙腳平行支撐時，(a)Pitch軸向的修正：如圖五十四所示的對髖關節、膝關節與踝
關節的Pitch軸向馬達(即分別為ID11、17的馬達，ID13、19的馬達與ID14、20的馬
達) 作修正，其前傾與後傾修正的方式如圖五十五所示；(b) Roll軸向的修正：因
為雙腳為平行的關係，支撐力很穩，Roll軸很難推動，所以並不執行校正動作。 
 
 
圖五十四、雙腳平行支撐之 Pitch 軸的修正馬達位置 
 
 41 
(3)單腳支撐時，馬達之Roll軸與Pitch軸的修正將會採用類似的方式，而手部的修正則
不同。 
  左單腳支撐時，其Pitch軸之修正方式如下：(a) 如圖五十八所示的修正左腳髖
關節、膝關節以及踝關節Pitch軸向的馬達(即其ID分別為11、13與15)，作與圖五十三
相同的校正方式；(b)修正右腳腳踝Pitch軸向的馬達，ID為21，修正方式為使之與地
面平行；(c)修正雙手肩膀Pitch軸向的馬達，ID分別為1與5，修正方式為前後平衡，
前傾時往後，後傾時往前，其前傾與後傾的修正結果圖如圖五十九。 
 
 
圖五十八、左單腳支撐之 Pitch 軸的修正馬達位置 
 
  
前傾時 後傾時 
圖五十九、左單腳支撐之 Pitch 軸的修正方式 
 
單腳支撐且左腳支撐時，其Roll軸之修正方式如下：(a)如圖六十所示的修正左腳
踝關節Roll軸向的馬達(即ID 15)，當左傾時向右修正，當右傾時向左修正；(b)如圖六
十一所示的修正雙手肩膀Roll軸向的馬達(即ID分別為2與6)，修正方式為左右平衡，
左傾時往右擺，右傾時往左擺。 
 43 
當作參考的基準，並以該時刻回授的感測器數值與參考訊號的差值作為模糊控制器之
輸入，經由模糊控制器得到的輸出來控制校正馬達所需的角度。 
  以穩定跨越障礙物連續動作之角度及角速度響應為參考訊號如圖六十二及圖六
十三，圖六十二為每個時刻的角度，上圖為Pitch軸，下圖為Roll軸，每個單步動作的
編號標示於該單步動作開始執行之時刻，圖六十三為各時刻的角速度，上圖為Pitch
軸，下圖為Roll軸，其中角速度來源是經由卡爾曼濾波器式3.28所估算得出的 ˆbiasg 代
入式3.5所得。 
 
 
圖六十二、以穩定跨障礙連續動作之角度響應為參考訊號 
 
 
圖六十三、以穩定跨障礙連續動作之角速度響應為參考訊號 
 
 45 
        
 ( ) , , , , , , , , , ,T e NVB NB NM NS NVS ZE PVS PS PM PB PVB
  
           
 5 4 3 2 1 0 1 2 3 4 5, , , , , , , , , ,B B B B B B B B B B B               (6.7)
 
 ( ) , , , , , , , , , ,T u NVB NB NM NS NVS ZE PVS PS PM PB PVB 
  
            
 5 4 3 2 1 0 1 2 3 4 5, , , , , , , , , ,C C C C C C C C C C C                  (6.8) 
各語言項中，"NVB"，"NB"，"NM"，"NS"，"NVS"，"ZE"，"PVS"，"PS"，"PM"，"PB"，
"PVB"，分別代表了"負最大"，"負大"，"負中"，"負小"，"負最小"，"零"，"正最小"，
"正小"，"正中"，"正大"，"正最大"。  
 
(2) 歸屬函數 
  模糊控制器之輸入輸出語言項定義，輸入變數使用三角形歸屬函數來描述，如圖
六十五與圖六十六，其中圖六十五上方為變數 e 之模糊集合，歸屬度為 ( )e ，圖六十
五下方為變數 e 之模糊集合，歸屬度為 ( )e  。 
 
 
圖六十五、模糊控制輸入變數 e 與 e 之歸屬函數 
 
輸出變數為u，本文以模糊單點(singleton)來描述其模糊集合，如圖六十六，其中， ( )u
為其歸屬度。 
 47 
(4) 模糊推論與解模糊化 
  介紹完模糊資料庫以及模糊規則庫以後，於模糊推論與解模糊化方面，使用了
最小推論引擎(Minimum Inference Engine)來進行模糊推論，並使用重心法來解模糊
化，最小推論引擎推論可得每條規則的權重值如下： 
 ,
min( ( ), ( ))
m nm n A B
w e e  
  (6.10) 
其中 ,m nw 為每條模糊規則所得之權重值，得到權重值後，模糊系統之輸出表示如下： 
 
5 5
, ,5 5
5 5
,5 5
m n
m n m nm n
m n
m nm n
w y
u
w
 
 
 
 
 
    (6.11) 
其中 ,m ny 為模糊集合 ,m nC 的明確值(Crisp value)。 
 
 
 
 
 
 
 
 
 
 
 49 
 
圖六十八、動作編號 999 之干擾測試圖 
 
圖六十九、999 單步動作撞擊後之角度響應 
 
圖七十、999 單步動作撞擊後之角速度響應 
 51 
 
圖七十三、動作編號 3 單步動作撞擊後之角速度響應 
 
  如圖七十四為單腳支撐模式下的編號11單步動作測試，此實驗因為平衡效果不
佳，所以擺槌只能拉抬至擺動75度撞擊，角度與角速度變化結果如圖七十五與圖七十
六，圖七十五與圖七十六的上圖為不啟動平衡，下圖為啟動平衡，由圖可知不啟動平
衡時，機器人皆會傾倒至接近90度，而啟動平衡狀態下，機器人皆可修正回平衡位置。 
 
 
圖七十四、動作編號 11 之干擾測試圖 
 53 
 
圖七十七、連續動作之干擾測試圖 
 
圖七十八、連續動作於兩軸無干擾及未啟動平衡控制之角度響應 
 
圖七十九、連續動作於兩軸有干擾及有啟動平衡控制之角度響應 
 55 
八、結論與未來研究 
  本計畫提出一個具有基本動作能力(例如，微步伐、小步伐、中步伐、大步伐之
直走、左右之橫移動作、小角度游移腳之旋轉、小至大角度之左右旋轉、及左右手部
之運動)的人形機器人系統，並且開發出一個可以設計與編輯動作的人機界面，以及
FPGA為基準的動態感知系統。首先，應用結合加速度計與陀螺儀的動態感測系統，
並以巴特沃斯濾波器及卡爾曼濾波器提高Pitch與Roll兩軸量測角度的準確度，以獲
得較真實的機器人之姿態，接著以所設計的模糊分散平衡控制，進行以連續動作跨越
障礙時遭受外部干擾，抵抗其影響並恢復所規劃的平衡狀態。 
  於感測器的使用上，僅使用加速度計或陀螺儀，易產生較大之量測誤差，如此
一來不利於機器人之平衡控制，是故先以巴特沃斯濾波器將加速度計所獲得之角度響
應不必要的高頻雜訊濾掉，接著結合陀螺儀之角速度訊號輸入至卡爾曼濾波器，以提
高姿態量測的精準度。於人形機器人跨越障礙物部分，首先將其分解為12單步動作，
並於每個單步動作設計其平衡修正動作，藉由模糊分散平衡控制執行每個單步動作的
平衡，並於連續跨越障礙動作時，給予不特定的干擾，以評估所建議的方法之有效性。
由實驗結果得知本計畫所設計的模糊分散平衡控制器，確實可以使得小型人形機器人
於跨越障礙物時發揮不錯的平衡效果。 
     最後提出以下建議改善方案，即“轉移馬達控制與運動控制至NIOS”。本計畫
的馬達控制架構位於RB-100上，馬達控制會占用部分的執行緒與系統效能，於實驗初
期，包括感測器控制與馬達控制與運動控制器全部使用單一處理器處理，造成系統負
荷相當大，實驗後期將感測器與濾波器轉移到NIOS上平行處理後得到不錯的效果，但
是如果馬達控制未來也能移轉至NIOS上處理，則模糊分散平衡控制軟體移至NIOS，屆
時RB-100將可獲得更多的系統效能處理其他的任務。 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 57 
hybrid system,” IEEE Trans. Ind. Electron., vol. 57, no. 5, pp. 1787-1798, May 2010. 
[20] URL: http://en.wikipedia.org/wiki/Kalman_filter. 
[21] URL:http://tom.pycke.be/mav/92/kalman-demo-application. 
[22] 喬治查爾斯電子電路網: http://gc.digitw.com/ 
[23] http://www.kionix.com/accelerometers/accelerometer-KXP84.html 
[24] http://zh.wikipedia.org/wiki/I2C 
[25] http://en.wikipedia.org/wiki/SPI_bus 
[26] R. Marin, G. León, R. Wirz, J. Sales, J. M. Claver, P. J. Sanz and J. Fernández, 
“Remote programming of network robots within the UJI industrial robotics 
telelaboratory: FPGA vision and SNRP network protocol,” IEEE Trans. Ind. 
Electronics, vol. 56, no. 12, pp. 4806-4816, Dec. 2009. 
[27] P. Y. Hsiao, C. L. Lu and L. C. Fu, “Multilayered image processing for multiscale 
Harris corner detection in digital realization,” IEEE Trans. Ind. Electronics, vol. 57, no. 
5, pp. 1799-1805, May 2010. 
[28] 楊武智編譯，感測器與數位信號處理，全華科技圖書股份有限公司，1999。 
[29] 張智星，Audio Signal Processing and Recognition (音訊處理與辨識)，On-line Books. 
[30] 蒙以正，數位信號處理 應用MATLAB，旗標出版社，2004  
[31] C. L. Hwang and C. Y. Shih, “A distributed active-vision network-space approach for 
trajectory tracking and obstacle avoidance of a wheeled robot,” IEEE Trans. Ind. 
Electronics, vol. 56, no. 3, pp. 846-855, Mar. 2009. 
[32] 伍寒楨，考慮動態平衡的人形機器人跨越障礙之研究，淡江大學電機工程學系碩
士論文，民國九十九年六月。 
[33] 林明龍，應用 FPGA 為基準之感測器系統於不平坦地面運動之人形機器人的動態
平衡，淡江大學電機工程學系碩士論文，民國九十九年六月。 
[34] 黃俊豪，人形機器人的人機介面設計與運動控制之研究，淡江大學電機工程學系
碩士論文，民國九十九年六月。 
[35] 陸念聞，應用類神經網路定位為基礎的主動視覺於人形機器人罰踢之研究，淡江
大學電機工程學系碩士論文，民國九十九年六月。 
 66 
 
出席 2009 年模糊系統國際會議(IEEE-FUZ2009) 
心得報告 
 
報告人：淡江大學 電機工程學系 黃  志  良 
 
一. 參加會議經過 
 
2009 年模糊系統國際會議(IEEE-FUZ2009)於韓國/濟州召開，會議日期是
從 8 月 20 日至 8 月 24 日止，共計五日。此次會議每一篇投稿論文均經過三位
評審審查，共有 383 篇論文(其中 302 篇為口頭報告和 81 為海報呈現)在此次
會議發表，此次筆者所參與的會議場為模糊控制、機器人及感知器系統。除了
進行分組論文口頭及壁報發表外，大會現場並有相關書籍展示、產品展覽、及
提供電子郵件服務。此次會議來自世界各國，約數百位專家學者參與，其中來
自我國之與會人員約十位，分別來自學術界、研究機構等。筆者亦在會中發表
兩篇論文“(1)應用模糊分散滑動強健適應欠致動控制於具有自主動態平衡之
電動腳踏車，(2)具有未知死區及未知不確定上限的非線性動態系統之強健適
應控制”。並與多位同領域的學者討論，使筆者獲益良多。 
 
 
二. 與會心得 
 
此次會議是一個大型的會議，主辦單位事先已將大會手冊預先寄給作者參
考，且大會亦於事前透過網際網路將每位作者之論文發表時間告知，因此，筆
者有相當充裕的時間安排所欲聆聽之論文發表。 
筆者有幸獲得國科會之補助，前往韓國/濟州參加 2009 年模糊系統國際會
議(IEEE-FUZ2009)並發表論文，使筆者在各方面均有相當豐富之收穫。筆者近
年來一直致力於非線性系統控制、強健適應控制、模糊類神經控制和建模及智
慧型機器人之研究，因此與會期間，筆者曾就非線性系統控制、適應控制、模
糊控制及機器人控制等方面與與會之學者專家分享研究心得與經驗。並利用彼
此討論機會和與會之學者專家建立友誼關係。 
大會總共安排有口頭發表以及壁報論文，分為四個分組並行進行論文發
表，每個人均可參加有興趣或較相近領域之論文發表。其中與筆者近年的研究
較為相關的有如下之主題：(1) 非線性系統控制，（2）模糊控制器設計，（3）
類神經控制及建模，(4）機器人控制，(5）適應控制系統，(6)感知器系統。
主講者對於未來的研究方向皆有詳細且完整的介紹，也有諸多建設性的建議及
意見。 
 
 
 
 
國科會補助計畫衍生研發成果推廣資料表
日期:2010/11/05
國科會補助計畫
計畫名稱: 子計畫一：人形機器人自主動態平衡之研究(3/3)
計畫主持人: 黃志良
計畫編號: 98-2218-E-032-002- 學門領域: 智慧型機器人
無研發成果推廣資料
碩士生 0 0 100%  
博士生 0 0 100%  
博士後研究員 0 0 100%  
參與計畫人力 
（外國籍） 
專任助理 0 0 100% 
人次 
 
其他成果 
(無法以量化表達之成
果如辦理學術活動、獲
得獎項、重要國際合
作、研究成果國際影響
力及其他協助產業技
術發展之具體效益事
項等，請以文字敘述填
列。) 
無 
 成果項目 量化 名稱或內容性質簡述 
測驗工具(含質性與量性) 0  
課程/模組 0  
電腦及網路系統或工具 0  
教材 0  
舉辦之活動/競賽 0  
研討會/工作坊 0  
電子報、網站 0  
科 
教 
處 
計 
畫 
加 
填 
項 
目 計畫成果推廣之參與（閱聽）人數 0  
