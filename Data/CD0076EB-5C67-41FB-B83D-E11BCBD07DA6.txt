 2
二、緣由與目的 
半導體的製造是一個複雜、昂貴且費時的工作，因此半導體廠內擁有數以百計的生產
機台，其分割成數十個工作站（Station），而晶圓（Lot）在完成每個工作站之生產作業後，
於工作站與工作站間移動。半導體的生產流程擁有多樣的產品類型、再回流的生產特性、
高度不確定性、生產候選機台多元化等特色，所以先前的研究中[1]提出發展一個現場生產
監控系統（Shop floor control system，簡稱 SFCS）可解決以上提及之問題。 
    前人的研究[2-5]將 SFCS 的功能分成規劃（Planning）、排程（Scheduling）、執行工作
（Execution tasks）三個階段。規劃階段由現場環境中選擇執行的工作；排程階段根據系統
狀態和績效指標給予選擇的工作適當的派工法則；最後在執行工作階段，透過與現場生產
環境的互動來執行工作，其資訊流在控制器內採由上而下的方式（即規劃階段後透過排程
階段，最後執行工作），當一個錯誤產生時，一個修復訊息馬上隨之而生。因此，有研究者
[6-8]提出在 SFCS 中使用一個有效的排程派工機制，可滿足不同的績效標準。 
一般來說，SFCS 包含投料控制與派工法則兩種決策，投料控制決定何時投入晶圓到系
統中，而派工法則是當機台可使用時，決定哪個晶圓下一個被投入處理。Wein（1988）[9]
指出使用投料控制在生產績效上會明顯優於使用派工法則，然而 Kumar（1994）[10]和 Li et 
al.（1996）[11]的研究指出良好的派工法則同樣可改善生產的績效；因此對於改善生產績效，
使用投料控制與派工法則的方法皆有明顯的成效。此外，前人的研究[12-13]指出沒有一種
單一投料控制或單一派工法則可以一致地使用在任何環境下而優於使用其他的單一投料控
制或單一派工法則，加上鮮少研究使用結合投料控制與派工法則的方式來探討其成效，因
此本研究認為以結合兩者的方式，對於改善生產績效是一可行的方法。 
根據以上提及之問題，有研究者[14-15]提出設計排程派工控制器在 SFCS 中，可以滿
足前述之特性，最常見的就是使用類神經網路或決策樹之機器學習方法來達到，目的是要
從有限的訓練樣本中得到排程的知識[16]，訓練樣本通常透過模擬的方式來獲得。其優點是
可以提供快速、可接受的解決方案，並且滿足 SFCS 中的操作特點；其缺點是訓練樣本的
目標值必須事先給予，其必須經過長時間模擬各種派工法則後才能得到，然而這將使實驗
變成一個冗長費時的工作。 
為了得到建立排程派工控制器所需的知識，必須先將訓練樣本根據相似的特性來做分
群，其特性包含根據不同績效標準下之系統屬性、目前使用的派工法則以及相對應之下一
次應使用的派工法則，最後再將分群後的知識庫類別，給予一類別標籤。最廣泛被使用的
分群法就是 Kohonen（2001）[17] 所提出之自我組織映射圖（self organizing map，簡稱
SOM）。因此本研究使用 SOM 分群的技術，根據不同的系統狀態、目前使用之派工法則以
及績效指標來將訓練樣本分群，產生派工法則類別，最後建構一個線上排程派工知識庫，
透過線上的模擬在不同的系統狀態與目前使用的派工法則下，從藉由 SOM 建立的線上排程
派工知識庫中挑選出適當的派工法則。 
加強式學習（Reinforcement learning，簡稱 RL）在 1990 年代被提出[18]，廣泛被使用
在許多研究中，有令人注目的成果。不同於監督式學習的觀念，RL 使用代理人的學習機制，
透過與系統（即外部環境）的直接互動來學習。過程中系統會根據代理人送出之動作，給
予代理人一獎勵或懲罰值，此乃代理人先前所送出之動作所導致。由此就可經由獎勵或懲
表 1 工作站描述 
 
表 2 三種加工流程 
 
在即時排程派工知識庫中，訓練樣本集TE可以表示為{O, SF, CD, ND*}的組合， 為
使用者定義的管理績效指標，SF 為系統屬性之集合，CD 表示目前使用之派工法則，ND*
代表根據系統屬性、目前的派工法則以及系統績效之下，下一個排程期應該使用之派工法
則。 
O
在排程的問題中，最常用來評估績效的指標有三種，產出量、週期時間以及達交期，
而本研究使用之績效指標列於表 3。之後根據績效指標篩選出影響系統之重要屬性，因此
所有可能的系統屬性將會被徹底考慮到。表 4 列出本研究的五種系統屬性。 
表 3 本研究使用之績效指標 
 
表 4 本研究五種系統屬性。 
 
 
 4
代表所有可能系統狀態的知識。 
    訓練樣本資料收集機制是採用一多區段模擬的方法（multi-pass），資料內容包含每個
排程期之系統屬性值和使用目前派工法則所產生的績效值。此訓練樣本收集機制的優點在
於它包含許多不同的系統屬性和工作到達資訊，藉此達到可代表所有可能系統狀態之效
果，之後被用來學習建立其分類的知識庫。 
2.2 資料正規化機制 
資料屬性藉由其數值大小正規化後落入較小的範圍，例如–1.0到+1.0之間（即本研究使
用之正規化方法）。正規化之目的是可避免資料數值範圍過於龐大，而將其轉換至較小的範
圍，卻不失原本之特性。常見的正規化方法有四種，十進位的正規化、最大－最小正規化、
z值的正規化以及對數正規化。 
在SFCS中的系統狀態會不斷的更新，以至於屬性資料之最大－最小值變的難以預知，
加上如果資料有離群值的時候，不利於使用最大－最小正規化，因此本研究使用z值的正規
化。 
在 z 值的正規化方法，屬性 A 欄位資料會藉由計算其平均數和標準差，之後屬性 A 
欄位中的一筆資料 v  藉由式（1）正規化到 ，'v A和 Aσ 為屬性 A 欄位資料之平均數和標準
差。 
 A
Avv σ
−='
                                             (1) 
          
2.3 以兩階段SOM將訓練樣本分群 
Vesanto和Alhoniemi（2000）[22]提出兩階段SOM，結合SOM與K-means以及DB指標
（Davies-Bouldin index）的觀念來將資料分群。兩階段SOM是利用SOM的特性將原始資料
化成初始集群（photoclusters），再利用K-means將性質相近的集群結合，藉以找出最佳的
集群數。而使用兩階段SOM方法的優點是可以減少計算的時間和增加精確度，更可以避免
雜訊的影響。DB指標是期望群內差異小而群間差異大所形成的公式，主要是利用幾何原理
進行運算，當使用兩階段SOM尋找最佳的集群數時，期望DB指標能愈小愈好，其公式如下： 
∑
= ≠ ⎭⎬
⎫
⎩⎨
⎧ +=
c
k lkce
lckc
kl QQd
QSQS
c
DB
1 ),(
)()(max1
                                          （2） 
其中 是代表群內的距離， 是群跟群之間的距離， 是分群的數目， 是代表各群（表
示第K群）。 
當群內距離愈小而群間距離愈大，則DB值也愈小，表示各集群間內的資料愈緊密且集
群間
以 為基之即時派工法則類別選擇機制
在以 為基之即時派工法則類別選擇機制階段，訓練樣本根據相似系統屬性與目前
使用
cS ced c Q
的差異愈大，因此也表示此分群數目下的集群結果為資料的最佳群集。 
2.4 SOM  
SOM
的派工法則來分群。當多控制器發送一個控制訊號，以SOM為基之即時派工法則類別
選擇機制會根據系統狀態、目前使用的派工法則以及績效指標來挑選適當的派工法則提供
 6
 8
和 為信賴區間之上界與下界，uCI lCI x 為訓練樣本績效平均值，σ  為母體標準差，n為訓
究採90％信練樣本大小。（本研 賴區間， 1.0=α , 28.1
2
=αz ） 
   假如 或 ，到步驟三，否則跳至步驟五。  
步驟三：藉由式（6）更新 state-action 值， 
           （6） 
  
ut lt
−− ate
CIPI > CIPI <
βγ+= oldnew actionStactionState
γ 為回饋值，定義如下 β 為學習率，
                                                           （7） 
    假如 ut CIPI > ，跳步驟五。 t CPI lI< 到步驟四。  
步驟四：執行 exploration 和 exploitation 
藉由一機率選擇ε 挑選一組新的適合之派工法則，並藉由 ε−1 的機率值挑選出最佳的
state-action 值。 
∑
∈ij
= ij
St
yprobabilitvalueState )__(ε           
j
i
St
                               （8） 
步驟五： ，結束。 
3. 實驗 
3.1 建構模擬模型與產生訓練樣本 
為了印證本研究提出的方法，本模擬實驗架構是使用eM-Plant(2003)[15]物件導向模擬
構與實行，並且在Core 2 Duo個人電腦之Windows XP作業系統中進行。 
晶圓進入的時間採平均100分鐘的指數分配，而達交日
隨機設為總加工時間之4到6倍，並採均勻分佈。  
同的系
統狀態與工作到達）來模擬各種派工法則後，產生訓練樣本。另外，為了使訓練樣本能夠
代表完整的資訊，必須可以代表所有可能的系統狀態，本研究使用多區段模擬的技術
模擬實驗於暖機之後開始計時，暖機時間為
     
utl CIPICI <<
語言來建
在初步模擬必須設定一些參數，
根據Arzi and Iaroslavitz（2000）[10]提出的觀念，藉由給予相同的初始狀態（相
[27]
來收集訓練樣本，包含每個決策點的系統屬性與使用各種派工法則所產生的績效指標 。 
10000分鐘，藉由20個階段排程週期進行，
每個排程週期時間為2000分鐘，最後收集總數7500個之訓練樣本。 
在多決策排程機制上，目前沒有其他的方法可以與本研究做比較，因此本研究選擇與
使用隨機挑選投料法則與啟發式派工法則的組合（例如：SWL，FIFO，FIFO），實驗結果
來做比較。表10列出30次重複模擬後的績效平均值（Mean）與標準差（SD），本研究提出
的方法在兩個績效指標上均明顯優於隨機挑選的方法。 
表10 本研究之多控制器與隨機挑選組合方法之績效比較表 
 
表11列出啟發式派工方法在30次重複模擬後的績效平均值（Mean）與標準差（SD），
投料控制使用SWL ，其他控制區之派工法則使用相同的啟發式派工方法（例如：FIFO，
FIFO或SPT，SPT），本研究提出的方法在兩個績效指標上均明顯優於啟發式派工的方法。 
表11 本研究之多控制器與其他派工方法之績效比較表 
 
最後本研究使用成對樣本 t 檢定來評估提出之多控制器方法與啟發式派工的方法，其
實驗結果是否顯著。在顯著水準為95%的條件之下，假設所有派工法則的平均數均相等，
作為虛無假設（null hypothesis），其檢定結果可由表12得知。在顯著水準為95%條件下，若
p-value小於0.05，則虛無假設於成對樣本 t 檢定中是被拒絕的，也就表示本研究提出之多
控制器方法明顯優於啟發式派工法則。 
表12 本研究之多控制器與啟發式派工法則之成對樣本 t 檢定比較表（α=0.05） 
 
綜合上述可知，本研究提出之多控制器方法與隨機挑選組合方法以及啟發式派工方法
相比，在改善系統績效方面有明顯的成效。 
4. 結論 
半導體的製造是一個複雜、昂貴且費時的工作，因此在高度競爭環境之半導體廠設計
一個SFCS來解決問題，是一可行的方法。故本研究結合SOM和RL的方式設計一個多控制
器應用在SFCS中，期望可以改善生產績效。以下為本研究之研究動機回顧： 
1. 傳統以類神經網路或決策樹等機器學習方法，來在現場生產監控系統中設計控制器
（排程控制器）需經由有限的訓練樣本中歸納排程知識。其主要缺點為訓練樣本的
類別（排程派工規則）必須事先已知。然而此一取得訓練樣本的程序在設計多控制
器於半導體晶圓廠現場生產監控系統時，會變成無法忍受的耗時工作，其原因為在
下一個排程階段需決定多個排程派工規則。 
 10
