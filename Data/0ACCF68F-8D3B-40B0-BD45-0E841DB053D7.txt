中、英文摘要及關鍵詞 
(一)中文摘要 
關鍵詞：餘額分配、預付式服務、P-SCP 
近年來預付式行動電話服務的用戶數成長快速，成為行動電話中一個重要的應用。
從第二代行動電話 GSM 系統到第三代 UMTS 系統，預付式服務也從單純的提供語音服
務，擴展至提供整合的語音與數據資料傳輸服務。 
在 3GPP 規格中並未描述預付式服務之分配餘額的方法。如果每次服務的餘額分配
過小，P-SCP 將忙於檢查和扣除使用者的餘額，P-SCP 與網路元件的信令溝通次數將明顯
增加。這對營運者系統而言，所消耗的系統和網路的資源是很可觀的。相反地，若每次分
配餘額過大，則有可能會限制使用者同一時間使用的服務項目。除了上述問題之外，當餘
額越來越低時，由於使用者同一時間可以使用許多不同的服務，便可能會發生因餘額不
足，而導致正在進行的多項服務被系統強迫中斷。如此一來，使用者勢必會對業者的服務
產生諸多的抱怨。因此，如何適當分配預付式服務的餘額給各項服務，減少信令溝通次數，
便成為未來行動電話預付式服務成功與否的重要關鍵。 
本計畫以Kurtansky 評估預付式的節點方法成本作基礎，設計一新的P-SCP餘額分
配演算法。我們撰寫電腦模擬程式，比較在預付式語音及資料傳送服務中，P-SCP的餘
額分配訊令額外傳送的次數。我們驗證本計劃提出的餘額分配方法，不論在語音服務或
是資料傳送服務，均能有效減少 P-SCP 餘額分配信令的傳送。尤其在多個使用者共享
一個帳號，或是一個使用者使用多個服務時，本計劃所使用的方法比傳統的 P-SCP 餘
額分配方法更能減少餘額分配信令的額外的傳送次數，降低系統業者的負擔與營運成
本。另外，本計劃的方法也可結合保留餘額的作法。當使用者餘額少於某一臨界值時，
依據各項服務的優先順序，彈性回收部分服務的餘額，並重新分配給其他服務，以提高
客戶的滿意度。 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
                                     I. 
報告內容： 
 
一、前言： 
近年來預付式行動電話服務的用戶數成長快速，成為行動電話中一個重要的應用。
從第二代行動電話 GSM 系統到第三代 UMTS 系統，預付式服務也從單純的提供語音服
務，擴展至提供整合的語音與數據資料傳輸服務。 
3GPP 在 TS 23.078、TS 29.078 等規格[1-4] 中描述如何利用 CAMEL 的服務邏輯
來支援 UMTS 在電路交換方式（circuit-switched domain, CS domain）、分封交換方式
（packet-switched domain, PS domain）和 IP 多媒體子系統（IP Multimedia Subsystem, 
IMS）系統下的通話計費流程。 
我們以在 PS domain 下的預付式服務通話流程簡要地做一個說明。 
      
SGSN
gprsSSF
                       圖二：UMTS 系統下預付式服務數據資料傳輸之訊息流程 
        步驟一：在開始預付式數據資料傳輸服務前，手機必須先執行 PDP Context 
Activation. 
        步驟二：SGSN/gprsSSF 送出一個 “EventReportGPRS＂ 訊息給 P-SCP，表示使
用者將使用數據資料傳輸服務。 
步驟三： P-SCP 收到後，檢查使用者的帳戶是否有足夠的餘額使用這項服務。
Cr 時，則引進 γ 變數用來減低下次服務分配的餘額。P-SCP 下次所分配的餘額為θγj
（j≦n, n 為用來減低分配餘額的最大可能值）。於是當使用者的餘額小於 Cr，而且有新
的服務要求要加入時，Lin 也提出另一種 PCR （prepaid credit reclaim）作法。P-SCP 將
選擇 m 個正在執行的服務 （S1, S2, …, Sm），送出回收餘額的要求給執行這些服務的 
SGSN。SGSN 收到之後，將停止原本的封包傳遞服務，並將餘額送回給 P-SCP。如果回收的
餘額總數/(m+1)小於一個臨界值ε，則拒絕提出要求的服務，並將餘額歸還給原先的 S1, 
S2, …, Sm 等服務。否則將餘額平均分配給 m+1 個服務。這個方法在分配餘額時，並沒
有考慮到個別服務的特性。另外，在餘額不足時，PCR 平均分配餘額作法，可能造成所有
服務在餘額耗盡前均無法完成。 
近幾年來，有些學者已經改用 Fractional ARIMA（F-ARIMA）[6] 模型來預測網際網
路數據封包的傳輸特性。Kettani [6] 提出一個方法預測二階自我相似過程中Hurst 參數，假
設得到的樣本是 X1, X2,…Xn,方法是先算出 m ( ) l ( )m 2nn
n
k
k
γρ
σ
= ，其中m ( )n kρ 、l ( )n kγ 和 m 2nσ 分
別為樣本相關係數、樣本共變數和樣本變異數。其次再利用提出的公式算出 Hurst 參數：
m m ( )( )21 1 log 1 12n nH ρ⎡ ⎤= + +⎣ ⎦。Kettani 最後驗證得到的實際數據資料符合 Hurst 參數估計
的範圍。但由於本計畫最後還是無法取得實際電話網路上之服務數據資料，因此最後只好
放棄使用此一方法來預估餘額。 
Kurtansky [6] 探討利用服務節點方式的預付式系統資源消耗時，考慮系統利用服務節
點方式提供服務時，每次檢查預付式服務使用者餘額的成本，及可能因為來不及檢查餘額
造成的呆帳損失，提出一個 TICA 演算法（Time Interval Calculation Algorithm），預估整個
預付式系統資源消耗的變化情形。假設 l ( )1i kx t +  為預估在第 k+1 時段第 i 個服務所消耗
的系統資源估計值， kp 為系統在第 k 個時段檢查餘額的次數， ( )i ktμ 為在 kt 時段系統消耗
資源量的期望值， ( )i ktσ 為在 kt 時段系統消耗資源量的標準差。β為一給定之修正參數，
避免因估計錯誤造成過大的呆帳。則在第 k+1 時段第 i 個服務消耗的系統資源預估值公
式如下所示。 
l ( ) ( ) ( )( ) 11 ki k k i k k i k
k
tx t p t p t
t
μ β σ ++ = +  
 
四、研究方法： 
 
P-SCP 若能在系統提供預付式服務前，準確預測該服務即將耗用的餘額量，則 P-SCP 
只要送一次 “ApplyChargingGPRS＂ 訊息給 gprsSGSN 便可讓服務完成。如此一來便可節
省大量的網路信令交通的成本。在本計畫中，我們修改 Kurtansky 方法，將之應用於預測該
項服務消耗的餘額量。假設 ( )i kx t  為時間 tk時的餘額消耗量， ( )i ktσ 為時間 tk時的餘額消
耗量之變異數，β為一給定之修正參數，則 l ( )1i kx t + 為時間 tk+1時的餘額預估消耗量為 
方法 k=10 k=15 k=20 k=25 k=27 k=30 
P-SCP
餘額分
配訊令
額外傳
送次數 
0 46 23 23 23 7 0 
 
     由上表可看出，當使用的服務個數增加時，本計劃方法使用的餘額分配訊令額外傳送
次數為 0。不論 k 值為何，均比傳統的 P-SCP 方法好。即便當 k 值為(使用人數*通話語
音長度期望值)時，傳統的 P-SCP 作法仍有餘額分配訊令額外傳送的情形。 
     對於數據傳輸服務，數據流量本身具有高度的自我相似（Self-Similarity）。我們假
設資料傳輸交通符合 Pareto 分佈，為模擬 Internet 流量，shape 參數假設是 1.2 [11]，scale 
參數假設是 3000。故其期望值為 18000。我們假設一個封包為 0.001 元，表三顯示在一
個資料傳輸服務下，兩個方法之 P-SCP 餘額分配訊令額外傳送次數的比較。 
 
表三、預付式資料傳輸服務之 P-SCP 餘額分配訊令額外傳送次數的比較 (m=1, β=0.001) 
傳統 P-SCP 方法  本計劃
方法 k=1 k=5 k=10 K=15 K=20 k=30 
P-SCP
餘額分
配訊令
額外傳
送次數 
14 966 159 66 38 26 15 
 
     表三顯示隨著 k 值增加，傳統 P-SCP 方法之餘額分配訊令額外傳送次數減少。於此
一 case 中，當 k=30 時，兩者額外傳送次數約相同。假設一個封包為 128 bytes，則 k=NT$ 
30 相當於 30x1000x128x8 bits～30M bits。雖然隨著 k 值增加，傳統 P-SCP 方法的餘額分
配訊令額外傳送次數減少。但當 k 增大時，表示該項服務佔用餘額比例增高，相對限制同
一帳號的其他使用者使用預付式服務，或是限制同一使用者使用其他項服務。 
由以上的討論顯示本計劃提出的餘額分配方法，不論在語音服務或是資料傳送服務，
本計劃提出的方法均能有效減少 P-SCP 餘額分配信令的傳送。尤其在多個使用者共享一個
帳號，或是一個使用者使用多個服務時，本計劃所使用的方法比傳統的 P-SCP 餘額分配方
法更能減少餘額分配訊令額外傳送的次數，降低系統業者的負擔與營運成本。另外，本計
劃的方法也可結合保留餘額的作法。當使用者餘額少於某一臨界值時，依據各項服務的優
先順序，彈性回收部分服務的餘額，並重新分配給其他服務，提高客戶的滿意度。 
 
六、計畫成果自評 
 
本計劃提出的方法能與其它餘額分配方法做結合，進一步降低餘額分配訊令額外傳送
的次數。此方法需記錄分析使用者提出的餘額要求，業者可依系統的 P-SCP 和 SGSN 處
理能力和速度，彈性調整計算統計參數之精確度，因此可以很容易地應用在實際系統。最
後感謝國科會經費支持，支持於本年度發表一篇會議論文[12]。 
 
