大，則無法即時將心電圖資料傳送回電腦。 
因此，本計畫在配戴於年老長者身上的「可攜式
生理資訊感測器」上進行不整脈偵測演算，再將偵測
之結果傳回電腦，並結合人員定位感測，運算人員所
在位置，以提升緊急狀況時急救的效率。 
 
五、研究方法 
在智慧型居家環境內無線感測器網路的通訊協定
上，本子計畫使用 IEEE 802.15.4 (Zigbee)無線傳輸技
術；Zigbee 為一短距離、低功率、低頻寬無線傳輸技
術無線傳輸協定，具功率消耗低、價格相對便宜、網
路節點數目多等特性。Zigbee 特性如下。 
1. 傳輸距離短 : 傳輸距離約數十公尺。 
2. 低傳輸速率 : 傳輸速率為 20K~250Kbps。 
3. 低功耗 : 資料傳輸料小，封包收發時間短，其餘
時間多為休眠狀態。 
4. 高擴充性 : 網路內可擴充節點達 65000 個。 
在 Zigbee 網路架構方面，Zigbee 堆疊類似 OSI 網
路七層架構，由底層至使用者分別為物理層(PHY)、媒
體層存取控制層(MAC)、網路層(NWK)及應用層
(APS)；每一層都實現一部份的網路功能，並由底層架
構出上一層的網路功能。圖[1]為 Zigbee 堆疊架構。 
 
圖[1] Zigbee 堆疊架構 
 
在物理層(PHY)部分，定義了操作頻帶與傳輸速
度，並透過直接序列展頻技術(DSSS)將一組訊號分為
多個，再經由編碼方式傳輸以避免訊號被干擾。媒體
層存取控制層(MAC)沿用了 WLAN 802.11 系列中
CSMA/CA(Carrier Sense Multiple Access with Collision 
Avoidance)的方式，可於封包傳輸前檢查通道中是否有
資料傳輸，再決定封包是否立即或稍後送出。網路層
(NWK)中定義網路拓樸結構，並將網路內節點依功能
分為全功能設備(FFD，Full-Function Device)及精簡功
能設備(RFD，Reduced-Function Device)。FFD 具備資
料交換及路由功能，而 RFD 只能傳送資料至 FFD 及
接收來自 FFD 的資料[6]。 
無線感測器網路的網路拓樸架構可分為星狀、樹
枝狀及網狀拓樸三種[7]，如圖[2]所示。在大規模網路
環境下，遠端節點的封包資料可藉由其他節點以多次
跳躍(Multi-hop)的傳遞方式將遠端節點的資料路由回
傳，並構成網狀網路。網路中的每一網路節點又依資
料接收功能的不同分為協調者(Coordinator)、路由器
(Router)及終端裝置(End device)。在星狀拓樸中，終端
裝置所感測到的封包可直接傳回協調者接收；若終端
裝置超過協調者節點感測範圍時，封包資料可藉由路
由節點回傳，形成樹狀拓樸；網狀拓樸則結合了星狀
與樹狀特點，網路內路由節點除了提供路由功能外，
彼此間亦可互相連結。 
 
圖[2]Zigbee 網路拓樸 
 
在應用層(APS)及封包資料部分，無線感測器網路
的封包結構上類似 TCP/IP 網路的封包結構方式；感測
器節點將所要傳送的資料與網路協定相關訊息如資料
跳躍次數、網域名稱、來源與目的位址等資料層層封
裝[8]。系統開發者可在封包架構內嵌入感測器節點所
感測到的溫度、濕度、光度等環境因子及居家環境中
硬體使用狀況如家電及房門開闔偵測；再根據協定中
所規範的封包格式層層封裝，將資料送至所指定傳遞
的節點位址。圖[3]為於 tinyOS 下建構以 Zigbee 為通訊
協定之無線感測器網路所定義的封包結構。 
路。 
 
圖[7]華亨無線感測器網路發展套件 
 
CC2430/CC2431EM 為 TI 所設計生產之無線
Zigbee 模組，內含 8051 核心、ADC、UART 以及 20 個
PORT 等，並支援 ZigBee 2006 協定堆疊； CC2431
內建有以訊號強度為定位法則的節點室內定位功能，
可提供系統開發者進行感測器節點定位功能。 
 
圖[8]CC2430/CC2431EM 感測器網路發展套件 
 
CC2430EB 為 Zigbee 感測器節點發展板，包含有
128×64 點陣圖式液晶、按鍵、蜂鳴器及溫度感測器等
元件，可供開發使用。 
 
圖[9]CC2430EB 感測器網路發展套件 
 
本研究於前二年計畫中建構了居家環境室內溫
度、濕度、光度等無線環境因子收集器；以溫
SENSIRION 所生產的 SHT11 溫濕度感測器及 SI 
photodiode 的 S1087 可見光及 S1087-01 紅外光光度感
測器，感測溫濕度、光度等環境因子。 
 
圖[10] SHT11 溫濕度感測器 
 
 
圖[11] S1087 可見光與 S1087-01 紅外光光度感測器 
 
人員的位置偵測為分析居家環境內長者生活模式
的一項重要訊息，藉由室內人員的位置可分析其生活
習慣與居家模式，與生理訊號偵測整合可於緊急狀況
下及時得知長者位置，進行緊急通報與搶救。 
本系統所使用的定位方式為使用訊號強度與距離
衰減關係進行定位分析；本研究在無線通訊傳輸上使
用Chipcon的CC2420 內部建制8位元的接收訊號強度
RSSI(Receive Signal Strength Indicator)[11]；在系統架
構上，感測器節點依功能可分為烽火臺節點(Beacon 
node)、資料路由節點(HOP node)、人員移動端(MS)與
主控端(BASE node)。 
於室內環境下架構烽火臺節點 Beacon node 定時
廣播發送 beacon message 至人員身上所配戴「可攜式
生理資訊感測器」的 MS node 接收，藉由感測 beacon 
message 訊號強度之 RSSI 數值與強弱關係，將資料直
接回傳至主控端端或經由資料路由節點 HOP node 以
多次跳躍(Multi-HOP)方式傳送到所連結的主控端接收
後，送至 PC 端進行定位演算，並將演算結果於使用
者介面上的室內地圖上標示演算的位置。 
 圖[16] 心率不整脈偵測系統架構 
 
    本系統中將不整脈偵測演算分成數個子任務，在
背景執行演算。類比數位轉換(ADC)後取得心電圖資
料及無線傳輸以事件方式(Event)執行，當需要執行
時，暫時中斷不整脈偵測之任務，待完成傳輸後繼續
不整脈偵測。 
 
圖[17] 心電圖隨身裝置程式流程圖 
 
    在心率演算上，本計畫利用年H.H. So 等學者[12 ]
提出一動態偵測法則（So and Chan）進行R波偵測演
算；利用R 波在QRS 波中呈現的斜率最為陡峭之原
理，設定一可動態調整之斜率閥值，當發現連續兩點
斜率大於閥值時，向後尋找斜率最大值即為R 波。 
    「So and Chan」R波偵測演算法流程如圖[18]所
示，先求出心電訊號的前250筆斜率。其中斜率Slope
公式如下。 
Slope = -2X[n-2]-X[n-1]+X[n+1]+2[n+2] 
根據心電圖前250 個取樣點之斜率閥值的最大值
為Maxi，並計算初始斜率閥值Initial Slope。之後每個
取樣點與斜率閥值比較，若連續兩點大於閥值，則將
那點定為R波發生的起始onset點，並從onset點向後尋
找75筆資料的最大值即判定為R 波。當找到R 波後，
再依公式求出新的Maxi值。 
Maxi
paramFilter
MaxiMaxiFirstMaxi +−=
_
_
 
First_Maxi = R波-onset 
同時更新斜率閥值Slope_thresh。 
MaxiparamthreshthreshSlope ×=
16
_
_
 
繼續偵測。Filter_param 及thresh_param 可設定為
2、4、8、16。 
 
圖[18] R波偵測So and Chan演算法流程 
 
在生理訊號的部分，本子計畫於在年老長者身上
的「可攜式生理資訊感測器」分析年老長者是否發生
闔偵測。 
 
圖[23]感測器節點結合磁簧開關 
 
圖[24]室內環境因子感測 
 
在室內人員定位部分，於本校工學館 5F 樓層架設
5 組由本子計畫所研製的無線感測器網路節點
BMOTE 作為感測器網路內的 beacon node，beacon 
node 每 40(ms) 廣播 beacon message，人員身上則同時
配戴感測器網路節點接收 beacon message 並分析
beacon message 的訊號強度之 RSSI 值、感測到的節點
數目與訊號強弱排序；每 500(ms)將這些資訊經由無線
感測器路由網路方式回傳至與伺服端電腦連結的節點
BASE 接收後，再傳送到伺服端電腦上進行定位演算。 
目前室內定位結果誤差約為 1~2 公尺，但已能呈
現人員在室內環境內的區域間移動狀態與大略位置。
如圖[25]所示，在定位準確度上實驗人員在靜態時，於
S0~S3 不同位置上，相關乘冪參數 E 與節點發射功率
模式設定與定位精準度關係。 
 
圖[25]Beacon 三點定位 
 
圖[26]乘冪參數 E 與發射功率模式對準確度關係 
 
在人員移動狀態下的定位測試部分，測試人員在
移動狀態下的定位結果，並在使用者介面標示所運算
的位置，將每次運算的位置連線成為移動的軌跡。下
圖為人員於實驗室外所架設的無線感測器網路環境下
移動時的測試結果；箭頭線段部分表示人員實際上的
移動軌跡。 
 
圖[27]室內環境下人員移動軌跡 
 
    在心率不整脈與無線感測器網路整合成果部分，
