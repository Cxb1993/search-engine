physiological signals monitoring 
machine with automatic abnormal event detection is 
useful to provide the in time 
clinical care and reduce the loading of health care 
staffs. In the mean time, long term 
recording of multi-stream physiological and its 
labeling and analysis is utilized in 
diagnosis sleep scoring, sleep apnea, etc. Thus, this 
project proposed to design and 
implemented a bio-signal processing unit and its 
hardware/firmware integration. By 
integration with the analog front-end circuits and 
storage elements that design by 
other portion of this integration project, a 
miniaturized multi-stream physiological 
signal recording and reacting system is proposed. 
Which can be utilized as a 
polysomnography or other medical device, furthermore, 
the feed-back stimulation or 
alarm from the on-line monitoring can provides the 
function to prevent sudden infant 
death and other syndromes. 
英文關鍵詞： Physiological signal analysis, sleep scoring, sleep 
apnea, sudden infant 
 
目     錄 
 
中文摘要                                I 
 
 
英文摘要                                II 
 
 
研究計畫之背景及目的                P.1--5 
 
 
研究方法                           P.6--25 
 
 
結果與討論                        P.26—92 
 
 
附錄：出國出席國際學術會議心得報告 
II 
 
二、計畫英文摘要 
 
This project proposed an on-line multi-stream physiological signal processing 
and abnormal event detection system and its corresponding integrated circuits designs. 
In clinics, physiological signals play an important role in diagnosis and symptoms 
analysis. For example, EEG, EMG can be utilized to analyze sleeping step; ECG can 
be utilized to monitor autonomic nervous system. Traditionally, clients rely on health 
care staffs to monitor physiological signals. However, in emergency room, intensive 
care unit, and other long-term care units, a reliable physiological signals monitoring 
machine with automatic abnormal event detection is useful to provide the in time 
clinical care and reduce the loading of health care staffs. In the mean time, long term 
recording of multi-stream physiological and its labeling and analysis is utilized in 
diagnosis sleep scoring, sleep apnea, etc. Thus, this project proposed to design and 
implemented a bio-signal processing unit and its hardware/firmware integration. By 
integration with the analog front-end circuits and storage elements that design by 
other portion of this integration project, a miniaturized multi-stream physiological 
signal recording and reacting system is proposed. Which can be utilized as a 
polysomnography or other medical device, furthermore, the feed-back stimulation or 
alarm from the on-line monitoring can provides the function to prevent sudden infant 
death and other syndromes. 
 
Keywords: Physiological signal analysis, sleep scoring, sleep apnea, sudden infant 
death syndrome, polysomnography. 
  
圖 3-1 臨床示警裝置不同準確度所造成醫護人員的反應。(a)示警訊號與結果吻合時，其示警發生率高低對醫護
人員產生 “compliance” 與 “reactance” 反應。(b)示警訊號與結果不吻合時，其誤警發生率高低對醫護人員產生 
“spillover” 與 “reliance” 反應(Vashitz., et al., 2008)。 
基於上述生理感測系統的限制，目前生理記錄大多依靠醫護人員判讀，睡眠生理紀錄約
有8小時，而癲癇觀察可能要有好幾天的數據，要花費許多的專家人力與時間，因此即時訊號
分析系統將可協助專家減少工作負擔(Iasemidis, 2003)。此外，在急診室、加護病房、嬰兒室
與長期照護中心，具有大量患者與患者生理狀態變化快速且變異度大的特性，受限於醫護人
員的有限人力，可靠的即時生理異常示警裝置將能在定時的照護程序外，讓患者在突發狀況
可及時獲得有效的緊急照護，並減低醫護人員的壓力。 
近年來系統晶片技術、資訊科技日益進步，以及各種分析處理方法之改良，已逐漸達到
即時分析多重生理訊號的功能，達到即時偵測與回饋的可攜微型生理監控裝置為目前國際學
界研發的方向，然而其訴求多著重特定科技的突破與應用，未必滿足臨床照護的使用需求。
本計畫未來兩年將同時結合硬體設計與即時訊號處理的技術，嘗試解決上述現有生理訊號感
測系統的實用性問題。 
我們所開發的系統將有以下特點：首先，我們將開發一具備即時分析能力的生理監測系
統軟硬體設計，並兼顧微型化與功耗的設計關鍵，在符合這兩大原則之下，以臨床考量來制
定多通道平台規格並兼顧可靠度的提升、尺寸與功耗的降低。在類比接收端，能夠同時接收
2
 析與分類技術，此外亦結合腦波時頻分析、獨立成分析、自動特徵擷取及模糊類神經網路建
構一個以腦波為基礎之即時精神認知狀態估測系統(IEEE TCAS-I 2005, 2006, IEEE BME 
2008)，及使用者無關之生理異常偵測模型(EURASIP 2008)。就智慧型系統而言，我們提出一
個結合獨立成分分析(ICA)轉換模型的創新模糊類神經網路(FNN)架構，與符合SVM (support 
vector machine)理論之「適應性模糊核心函式(Adaptive Fuzzy Kernel)」，因此能夠利用極少數
的模糊規則來完成FNN架構的建立(IEEE TCAS-I 2005)，(IEEE TFS 2006)。這些研究成果可供
作為開發多通道生理訊號分析與異常事件的基礎。 
 
參考文獻 
[1] Agarwal, R., Gotman, J., “Computer-assisted sleep staging,” IEEE Trans Biomed Eng, vol. 48, 
pp. 1412-1423, 2001 
[2] Kemp, B. Värri, A., Rosa, A., Nielsen, K. D., and Gade, J., “A simple format for exchange of 
digitized polygraphic recordings,” Electroencephalography and Clinical Neurophysiology, vol. 
82, pp.391-393, 1992. 
[3] Carrier, J., Land, S., Buysse, D. J., Kupfer, D. J., Monk, T. H., “The effects of age and gender 
on sleep EEG power spectral density in the middle years of life (ages 20–60 years old),” 
Psychophysiology, vol. 38, pp. 232-242, 2001. 
[4] Cohen, D.C., Eisdorfer, C., Prize, P., Breen, A., Davis, M. and Dadsby, A., “Sleep disturbances 
in the institutionalized aged,” Journal of the American Geriatrics Society, vol. 31, pp. 79-82, 
1993. 
[5] Gaudreau, H., Carrier, J., Montplaisir, J, “Age-related modifications of NREM sleep EEEG; 
from childhood to middle age,” J. Sleep Res., vol. 10, pp. 165-172, 2001. 
[6] Iasemidis, L. D., “Epileptic seizure prediction and control,” IEEE Tans. on Biomedical 
Engineering, vol. 50, no. 5, pp. 549-558, 2003. 
[7] Lerner, R., “Sleep loss in the aged: implications for nursing practice,” Journal of 
Gerontological Nursing, vol. 8, 323-328, 1982.   
[8] Lewicke, A., Sazonov, E., Corwin, M. J., Neuman, M., chuckers, S., “Sleep versus wake 
classification from heart rate variability using computational intelligence: consideration of 
rejection in classification models,” IEEE Tans. on Biomedical Engineering, vol. 55, no. 1, pp. 
108-118,  2008. 
[9] Lin, C.T., Pal, N. R., Chuang, C. Y., Jung, T. P., Ko, L. W., Liang, S. F., “EEG-based subject- 
and session-independent drowsiness detection: an unsupervised approach,” EURASIP Journal 
on Applied Signal Processing, in press, 2008. 
[10] Mardia. K. V., “Tests of univariate and multivariate normality,” In: S. Kotz et al., editors, 
Handbook of Statistics, vol. 1, pp. 279-320, 1980. 
[11] Mahalanobis, P. C., “Generalised distance in statistics,” Proceedings of the National Institute 
of Science of India, pp. 49-55, 1936 
4
 二、研究方法： 
本計畫最主要的目標為開發一個針對智慧型長時睡眠監測系統的多重生理訊號分析
與硬體實現。其目的為開發一即時、多通道之硬體平台與生理訊號處理之低功率晶片系
統，並應用此系統於臨床與實驗室之生理紀錄分析，且針對生命徵兆與異常信號提出即時
的反饋信號。同時，針對子計畫一之感測器與類比前端積體電路的訊號，提供多重訊號之
雜訊去除與處理，亦能針對子計畫三之訊號壓縮與錯誤更正資料及子計畫四所需的長時之
資料分析，提供基本的即時分類，以簡化後續的演算法複雜度。 
 針對上述計畫之分工架構下，本計畫的工作項目主要分成三類，分別是：多重生理訊
號即時分析之演算法、多通道生理訊號處理硬體平台、生理訊號處理器及其晶片系統設
計。此三工作項目下並分別包含數項工作，整理於下表，各項工作之關連性與分年工作項
目於下圖說明。以下之章節即針對下列之工作項目提出詳細之說明，由於，各項工作互有
因果關係，因此說明之順序並非依照此表之順序。 
 
表1: 執行工作項目規畫表 
多重生理訊號即時分析之演算法 
1. 臨床與實驗室睡眠生理紀錄分析 
2. 多重生理訊號雜訊去除與處理  
3. 開發各種生理訊號之分析與異常偵測方法 
4. 不同年齡族群之睡眠與生理模型 
多通道生理訊號處理硬體平台 
1. 多通道生理訊號處理硬體平台 
2. 開發European Data Format(EDF) 轉換程式 
3. 睡眠與生理狀態資訊整合介面  
4. 多重生理訊號即時分析之演算法之嵌入式軟硬體開發 
生理訊號處理器及其晶片系統設計 
1. 具離散記憶體之分散式生理訊號處理器架構設計 
2. 針對多重生理訊號即時分析之演算法於生理訊號處理
器之系統效能評估 
3. 多通道生理訊號處理之低功率晶片系統設計 
4. 整合生理訊號處理於多通道生理訊號處理硬體平台 
 
 
6
 （一） 臨床與實驗室睡眠生理紀錄分析 
目前臨床睡眠生理紀錄儀所量測的生理資訊及其所反應的生理狀態大致可分為以下
各類： 
1. 腦電波(EEG)：紀錄使用者各睡眠期間的睡眠腦波如睡眠初期的 alpha 與 theta wave, 
stage 2 的 spindle 與 K complex，熟睡期的 delta wave 等。 
2. 肌電圖(EMG): Submental EMG 可協助判斷快速眼動期(REM) ，其他 EMG亦可協助
監測磨牙、肢體異常抖動等。 
3. 心電圖(ECG) : 可以監控心跳次數，藉由心律變異 (heart rate variability)分析可以反應
出自主神經活動與生活緊張狀態，睡眠呼吸中止會導致長期缺氧與睡眠中一再的覺醒
(arousal)，造成交感神經的興奮。 
4. 鼻、口腔呼吸流量(Nasal/oral air flow)與腹胸呼吸運動(Respiratory movement):可評估呼
吸節率與偵測呼吸中止。 
5. 指頭血氧計(Pulse oximetry) :評估血中含氧濃度，監測病患缺氧的情形。 
6. 麥克風: 可應用於評估打呼情形。 
7. 同步影像記錄系統: 可以同時觀察受試者的睡眠行為，與生理訊號相互參照。 
此外，在急診室、加護病房、嬰兒室與長期照護中心，許多生理示警裝置大多監測心
律與呼吸並提供警示功能。然這類裝置大多無資料儲存功能。本子計畫主持人與共同主持
人，過去在睡眠腦電波、事件相關腦電波(event related potentials)、心電圖(EKG)分析與量
測已累積豐富經驗與資料，本子計畫首先將與子計畫四新竹馬偕醫院李松澤醫師分析臨床
生理紀錄包含成人與兒童。我們將著重於： 
1. 臨床與實驗室量測數據之比較：比較我們現有量測數據、MIT 生理資料庫與馬偕醫院
生理紀錄之量測儀器、量測方式、使用通道、量測參考點、訊號解析度、訊號訊噪訊(SNR)
等，瞭解其異同後才能修改已有分析方法或開發新演算法讓不同量測結果都有一致的
結果。 
2. 正常與異常生理訊號之比較：我們將比較正常與病患異常之生理訊號，以做為生理異
常警示模型建構基礎。例如正常睡眠與睡眠呼吸中止期的生理訊號差異。圖 4-2 為示
8
 （二）多通道生理訊號處理硬體平台 
為了開發可攜性的生理監控系統，本計畫擬發展對應之硬體處理平台，以用於上述各項
生理訊號之監測、處理與紀錄。雖然生理訊號相對於傳統之電路與訊號處理，看似規格及頻
率與先進的訊號處理有一段距離，但生理監測系統對於多通道同步、高解析度的特性，對於
類比前端與數位訊號處理，均帶來研究和實做之挑戰。因此本平台擬提供居家生理監測之系
統軟硬體設計，並兼顧微型化與功耗的設計關鍵。為符合此兩大原則，必須以醫療等級的考
量來制定多通道平台規格並兼顧可靠度的提升、尺寸與功耗的降低。圖 3 是我們在本計畫中
擬發展之硬體平台之方塊圖。由圖中所示，我們將在第一年的計畫中完成合乎下列規格（見
表 2）之 PCB電路版與硬體平台，以作為本計畫之生理訊號處理平台，並在此開發平台上發
展各式之生理訊號處理電路。 
 
圖 3: 多通道生理訊號處理硬體平台之方塊圖 
 
 
 
10
  
圖 4-4: 多通道 N-M 取樣架構 
 
 
（三）多重生理訊號雜訊去除與處理 
 
多通道的生理訊號當中包含了許多外界干擾，例如感測器因為身體移動產生的干擾 
(movement artifacts)，不同生理訊號間的彼此干擾 (interactions among physiological systems) 
如 REM Sleep EMG 受 ECG 干擾，EEG 受 EOG 干擾，ECG 受呼吸影響產生低頻 envelop 
variation 等等。 
1. Filtering and Adaptive Thresholding 
我們首先設定不同的訊號頻帶設定適合的濾波器，例如使用 1Hz的高通濾波器來去除呼吸所
造成的雜訊，並以 50 Hz 低通濾波器來消除肌肉和線路的雜訊。而我們也將利用 adaptive 
thresholding 的方式，來降低 envelop variation 的影響。 
2. Independent Component Analysis 
獨立成分分析(ICA)是一項能 exploits資料的高階統計結構的強大技術，被廣泛地應用在
找出多通道訊號的主要來源和移除雜訊，例如腦波 brain source, 嬰兒與母親的 ECG 
decomposition,  眼動訊號排除等。本計畫亦將使用 ICA 來解決 movement artifacts，與不同
生理訊號間 cross talk 的問題。線性獨立成分分析法的運作原理為：假設 x 為我們可以觀察
12
 （四） 開發睡眠週期判讀與各種異常事件偵測方法 
 
1. 睡眠週期自動判讀方法 
睡眠週期的人工判讀一般是根據 R&K rules ( Rechtschaffen and Kales, 1968)來做判斷，基
本上，需要用到 EEG(Electroencephalography)、EOG ( Electrooculography)、EMG 
( Electromyography)這三個訊號。另外，也有研究用其他的訊號，像是 EOG (Electrocardiogram) 
(Virkkala etal., 2007)，EKG (Lewicke etal., 2008)來做睡眠判讀，這些方法有使用上的方便性。
使用的訊號愈多，可產生的特徵值(feature)愈多，可將準確率提升，但相對地，測量上會比較
不方便。 
雖然目前睡眠週期自動判讀方法相關論文數據大約可達到 80%左右的成功率，但我們實
際應用 PSG 判讀結果，其中 S1 與 REM 最容易誤判，SWS 容易與 S2 誤判 (Agarwal and 
Gotman, 2001)。我們將結合頻域分析(如快速傅利葉轉換(FFT))和時軸分析(如 energy 與
complexity)，來偵測睡眠中的特徵波形如紡錘波(spindle)，K波 (K complex)，並求出各式頻
帶能量的比例，根據分析其所得的比例和特徵值分出各個睡眠週期。此外我們亦將採取
unreliable segment rejection 的觀念(Lewicke etal., 2008)排除不穩定的區段及依據週期連續性
質，調整睡眠週期判斷，來提升判讀成功率。下圖為我們判讀方法的概念流程。此外，亦將
根據不同年齡群的生理差異如兒童、成年與老年，調整適宜的系統參數，提高不同年齡族群
的判斷準確率。 
 
圖 6: 我們所提出之睡眠週期自動判讀流程。 
 
 
14
 訊，其關鍵在「變異數」問題，利用求特徵值(eigenvalue)及特徵向量(eigenvector)之
方法，過濾出佔最大變異數的型態，此即為最主要之型態。主成分分析演算法步驟如
下： 
1. 算出共變異數矩陣 S ，或相關矩陣分析 R  
2. 求 S 或 R 的特徵值及單位特徵向量 
3. 將特徵值依大小順序排列，設分別為 λ1 · λ2 · λ3 … λp  
4. 求出對應的單位特徵向量 a1· a2 · a3 … ap ，其中 ai' ai = 1 且 ai' aj = 0，則 
y1 = a1' x = a11 x1 + a12 x2 + … + a1p xp 為第一主成分 
y2 = a2' x = a21 x1 + a22 x2 + … + a2p xp 為第二主成分 
 ：：︰      ：：︰ 
yp = ap' x = ap1 x1 + ap2 x2 + … + app xp 為第 p 主成分 
若只取最大的 q 個主成分代替原有的 p 個變數，則這 q 個主成分解釋的變異比例為 
pq
qR λλλλ
λλλ
+++++
+++
=
LL
L
21
212
 
一般以能解釋原有變數變異達 70% 以上為原則。根據我們過去針對精神認知狀態偵
測、癲癇發作偵測、特定事件相關電位偵測的經驗，通常選擇變數變異達約 90% 左右
較佳。 
(5) 分類器：分類器將接收我們所擷取的生理特徵，判斷出是否有異常事件發生。目前
常用的分類器如 neural networks, support vector machine, fuzzy neural networks, 
Gaussian mixture model, linear classifiers 等。由於我們的系統未來要實現在可攜式，
因此，將以線性分類器為主。此外，根據我們的經驗，由於我們的系統判斷主要是
要逼近臨床專家的判斷，因此有代表性的生理特徵結合線性分類器，應是較佳且為
專家較能理解與參與改進的組合。 
 
 
 
16
 DM(Distributed memory):
E-bedded memory with distributed bio-signal 
processing
MEMORY MEMORY MEMORY MEMORY
MEMORY MEMORY MEMORY MEMORY
Distributed BSP Distributed BSP
Host-controller
Multi-channel IO
Host Controller
BSP-to-BSP
parcel network
BSP BSP BSP BSP BSP BSP BSP BSP
Multi-channel I/O Bus 
 
圖 4-8: 具離散記憶體之分散式生理訊號處理器架構 
 
（七）針對多重生理訊號時分析之演算法於生理訊號處理器之系統效能評估 
於前項工作之具離散記憶體之分散生理訊號處理架構與各項多重生理訊號時分析之演算
法完成之後，本計畫即著手進行各項演算法於此架構之效能評估。根據本實驗室過去所提出
之分散式處理核心之效能評估工具，我們將能有效率的將各項演算法及資料頻寬在系統模擬
之層級完成其效能及功率消耗之評估。依據此效能評估之結果，修正前述之微架構設計，並
劃分系統設計中軟硬體之比例與分工。 預期此項目之結果，將有助於修正離散式可重組式生
理訊號處理器之微架構更切合本計畫所提出各項演算法之需求，並據以開發下一階段之晶片
系統設計與應用程式設計。 
 
 
 
 
18
 （九）不同年齡族群之睡眠與生理模型 
由於不同年齡族群的生理機能不同，其背景腦波(background EEG) 睡眠腦波與睡眠型態
皆不同。例如兒童的睡眠的 SWA, theta, alpha, sigma and beta波皆比成年人強(Gaudreau, et al., J. 
Sleep Res. 2001)。如下圖(a)，在 non-rapid eye movement (NREM) sleep，兒童的腦波會出現明
顯的 spikelike transients,， 很容易會被誤判為癲癇。圖(b) 與(c) 分別為兩歲與六個月大女童
的 sleep spindle，其腦波型態亦有所不同，因此對與不同年齡群的生理訊號更需要建構其適用
的模型，這是一般生理紀錄系統較未探討，但對臨床相對重要的議題。 
 
 
 
 
 
 
 
(a) 
 
(b) 
 
(c) 
 
圖 10: (a) 兩 歲 兒 童 NREM 的 spikelike transients ， 容 易 誤 判 癲 癇 
(http://www.medscape.com)。(b) 與(c) 分別為兩歲女孩與六個月大女孩的睡眠紡綞波(sleep 
spindle)(新竹馬偕李松澤)。 
 
 
20
 關係數分析，建構一非監督式(unsupervised) 使用者獨立(subject-independent) 之認知狀態異
常模型，我們將以此架構為基礎，開發跨族群之睡眠與生理模型，其設計構想如下圖所示。
首先分析不同族群之睡眠或生命指標，接者針對這些指標進行Madia test，通過測試後藉由自
動分群法，建構各種指標之正常模型，接著針對各項指標與其正常模型進行 Mahalanobis 距
離(M-distance)運算，並藉由分類器來整合各指標之 M-distance，最後得到睡眠或異常狀態分
析結果。 
Sleep parameters 
of various subject
Groups 
Clustering the 
sleep parameters to
generate the normal models 
Madia test  to the 
extracted 
parameters 
Mahalanobis distance
Measurement to different 
models
Sleep quality   
evaluation
Integrating the M-
distances by 
linear/nonlinear 
classifiers  
 
 圖 4-12: 不同年齡族群之睡眠與生理模型建構 
 
（十）European Data Format(EDF) 轉換程式 
目前醫院睡眠中心所使用的睡眠生理記錄儀本身即具有判讀軟體，雖然準確度有待加
強，但其判讀報告對臨床人員較為熟悉。因此，我們首先將所記錄下來的生理訊號，轉換成
大部分 PSG軟體支援的檔案格式以便判讀。此外，我們所開發的自動睡眠分期的演算法亦可
藉由此介面和 PSG軟體的分析結果做比較，進而可以確認我們自動睡眠分期的準確度。 
我們選擇將檔案轉換成 EDF (European Data Format)的格式，因為 EDF 最廣泛並且通用於
大部分的 PSG軟體，自從 EDF在 1992年被發表出來之後(Kemp et al., 1992)，已經成為商用
儀器以及各個睡眠研究中心的通用格式，所以將格式轉換成 EDF可以讓我們把生理訊號載入
其他 PSG軟體去分析，便臨床判讀以及和我們開發的自動判讀演算法比較。 
 
 
 
22
 （十二）整合生理訊號處理器於多通道生理訊號處理硬體平台 
 現有的多重睡眠紀錄儀有使用不便的缺點，而急診、加護病房與嬰兒室的生理警示裝置
大多不具訊號記錄功能，且假警報比率偏高。因此本計畫所開發的系統希望能強化系統可信
度與可靠度(compliance and reliance Issue)與即時分析功能。若系統的假警報頻率過高，醫護
人員容易忽略警訊、或延遲反應，進而降低警示系統原本所欲提供的功效。因此我們所開發
的技術將與現有系統進行規格與效能上的比較，期望在使用方便性、效率、與可靠度皆能全
面改善，提高醫護人員的信賴度與患者的照護品質。 
本項目則是針對 3-2之硬體平台，結合在 3-7所開發之晶片系統，完成多重生理訊號處
理硬體模組，如下圖所示，在圖 3-2中之 FPGA 將會由本計畫所研發之生理訊號處理器取代。
並整和上述工作項目所發展的相關的驅動程式與應用程式，完成本計畫所提出的多通道生理
訊號處理硬體平台。此平台完成後即可與其他子計畫整合，完成具生物反餽機制之智慧型長
時睡眠監測系統。 
 
 
圖 14: 使用生理訊號處理晶片系統之多重生理訊號處理硬體平台之方塊圖 
 
24
 三、結果與討論 
本計畫成果分為三大部分。第一部分為多重生訊號即分析之演算法，內容描述臨床與實
驗室睡眠生理紀錄分析及實驗結果。第二部分為多通道生理訊號處理硬體平台，描述生理訊
號雜訊去除與處理及即時分析之演算法之嵌入式軟硬體開發成果。第三部分為多通道生理訊
號處理硬體平台，描述生理訊號處理器、晶片系統設計及多通道生理訊號處理硬體平台。 
（一）多重生理訊號即時分析之演算法 
A. Automatic Sleep Staging 
I. Subjects and Recordings 
All-night polysomnographic sleep recordings were obtained from 20 healthy subjects (12 
males and 8 females) ranged from 19 to 23 years in age (mean = 21.2 ± 1.1). None of the subjects 
reported disordered sleep or history of neurological or psychological disorder. The recordings 
included six EEG channels (F3-A2, F4-A1, C3-A2, C4-A1, P3-A2, and P4-A1, according to the 
international 10-20 standard system), two EOG channels, positioned 1 cm lateral to the left and 
right outer canthi, and a chin EMG channel through a PSG device (Siesta 802; Compumedics, Inc.) 
The sampling rate was 1 kHz with 16-bit resolution. The 20 PSG sleep recordings were visually 
scored epoch by epoch (30-sec interval) by a sleep specialist using R&K rules. 
II. Feature Extraction 
The automatic sleep staging system requires only three data channels: central EEG (C3-A2), 
EOG, and chin EMG. A preprocessing procedure was applied to these signals as following: After 
downsampling the signals to 256 Hz, the EEG and EOG data were filtered with an eighth-order  
band-pass Butterworth filter with the passband during 0.5-30 Hz and the EMG data was filtered by 
the filter with the passband during 5-100 Hz. The power spectrum was calculated using fast 
Fourier transformation (FFT) for each 2-second window and the results of 15 windows are 
averaged to represented as average spectrum for each 30-second epoch. Table 5-1 shows the 
summary of the 13 features used in this study [2]-[5]. 
III. Decision Tree for Stage Classification 
The concept of this decision tree is to separate the input epochs into two different clusters for 
each decision node from top to bottom. Each decision node tends to separate two different stages. 
Fig. 5-1 shows the proposed decision tree with total 13 decision nodes for sleep stage classification. 
The classification process comprises four steps: 1) movement epochs detection: epochs containing 
movement (MT) artifact signals were detected, 2) staging with the presented rule-based decision 
tree: the non-MT epochs were classified by the rule-based decision tree mentioned above, 3) 
contextual rule smoothing: the staging result of each 30-sectiond epoch by the decision tree was 
further smoothed according to classified results of its previous and following epochs, 4) movement 
epochs elimination: an elimination procedure was used on those MT epochs according to the 
AASM scoring methods [6]. 
26
 scoring by the expert, the automatic staging without smoothing, and the automatic staging with 
smoothing. As shown in Table 5-2, the overall sensitivity between expert and our system can reach 
86.15%. 
 
Table 5-2 CONFUSION TABLE FOR COMPARISON BETWEEN COMPUTER 
SCORING WITH SMOOTHING AND VISUAL SCORING FORALL 20 SUBJECTS 
 
* SE = sensitivity 
 
 
Fig. 5-2 Sleep hypnograms of a subject. (a) Original manually scored hypnogram, (b) 
automatic staging without smoothing, and (c) automatic staging with smoothing 
 
The innovative aspect of our method is that it combines the advantages of numerical methods 
and traditional rule based methods but eliminating the shortcomings of both methods. In addition, 
the data normalization process can greatly decrease the influence caused by subject variations. 
28
  
Fig. 5-3  通過手指末梢脈衝光線與回收訊強度關係圖[29] 
 
 血紅素物理特性探討 
不同的物體通常會具有不一樣的物理特性，而帶氧血紅素 (HbO2) 和去氧血紅
素(Hb) 對於不同波長之光線亦呈現不同的特性，紅光與紅外光 LED 產生之光線穿
透手指末梢組織和血管時，帶氧血紅素和去氧血紅素（或稱不帶氧血紅素）濃度不
同，光二極體接收訊號的強度亦會有所不同。由回收之光線強度轉換回電訊號，經
過計算後即可得知血液含氧濃度[22]。 
Fig. 5-4中，對於波長為 λ1的紅光 LED而言，Hb消光係數為 HbO2的 8-9倍左
右；對於 λ2的紅外光 LED而言，反而 HbO2消光係數約為 Hb的 2-3倍左右。 
 
Fig. 5-4  不同波長對帶氧血紅素(HbO2)與不帶氧血紅素(Hb)消光係數對照圖[24] 
 
 血氧值換算原理  
Fig. 5-5所示為一理想光線透射模型，根據比爾—朗伯定律 (Beer-Lambert’s 
Low) ： 一平行單色光入射強度為 I0光線，在垂直穿透消光係數為 Ext、濃度為 c、
穿透距離為 d之液體後，所透射出之光線強度 I與消光係數、液體濃度和穿透厚度
乘積呈指數衰減關係，其關係式如下： 
30
  
Fig. 5-6  血管體積變動與入射光示意圖[24]  
 
使用波長分別人 λ1和 λ2的 LED 為入射光，動脈半徑擴張△d時，可表示為如下
之關係式 R： 
                 (5-6)  
 
得到一簡化式： 
                 (5-7)  
 
採用光源 λ1 = 650nm、λ2 = 940nm時，代入 Table 5-4之消光係數後得出理論 SpO2
對應 R值之方程式，並可由方程式繪出如 Fig. 5-7虛線之方程式圖形，而實線部份
為 HP M119A之血氧機所量測到之實際曲線。 
Table 5-4 消光係數表 單位：(Mol．cm)-1 
波長 
種類 
650nm 940nm 
Hb 820 100 
HbO2 100 260 
 
得一簡化式 
                                 (5-8)  
32
  
Fig. 5-9  R值與 SpO2 線性近似轉換 
 加速規 
各種動作會伴隨著不同大小及方向的加速度，藉此我們可以分析加速度感
測器的訊號來獲得使用者目前的活動狀態[35]。隨著使用者配帶的部位不同而
使用不同的演算法分析動作來達成各式各樣的活動分析[1], [21], [24]。 
本實驗室有使用加速規針對睡眠部份進行睡眠判讀與活動分析[28]，分析
方法如下： 
(1) 取出特徵值：以 PSG的 30秒鐘為一頁 (epoch) 做分頁，將加速規訊號 (訊
號以 ACC 表示之) 幅度明顯的動作時間記錄下來，再將記錄峰與峰間隔時
間找出，藉由此方法算出平均活動密度，再以此特徵值決定適用的分析視窗
大小 (window size)。 
    (5-11) 
其中 T值為一般門檻值，其計算方法如下： 
             (5-12) 
以 30秒為一頁，將每一頁中波峰找出，而波峰定義為其偵測到之加速規值
大於一般門檻值。 
 
34
  
Fig. 5-11   OxiMax Durasensor® DS-100A[20] 
 
  
Fig. 5-12 硬體系統架構圖 
 系統電流消耗 
使用 NI-4065多功能數位電錶做電流量測，最高取樣率為 3000S/sec，量測結果
如 Fig. 5-13所示。最大瞬間電流約 50mA，紅外光開啟時，電流約 34.7mA，而紅
 
Radio 
RS-232 
血氧感
濾波放
 
ADC 
三軸加
Radio 
LED Control 
TI CC2430 
Compu
Smart RF TI 
Wireless 
36
  
Fig. 5-14 實測之光體積變化描記圖 
 
由光體積變化描記圖可取得心跳速率，但因訊號包含小雜訊，直接使用鄰點相
對大小偵測方式會造成大量的誤判。因此先將訊號做平滑化 (smooth)，分別取前後
N點和本身做平均值做為新的值，N值會和受測者本身的訊號有關。Fig. 5-15之上
圖為平滑化後做鄰點相對大小偵測找出突起和凹陷處，再將取得之時間點套用到下
圖未平滑化前的原始訊號。 
38
  
Fig. 5-17 平滑化訊號與對應斜率 
 
 
Fig. 5-18 增加時間間距參數修正結果 
40
  
Fig. 5-20 受測者 1 詳細實驗結果 
 
Fig. 5-21 受測者 1 實驗結果 
 
 討論 
正常呼吸 閉氣結束 閉氣開始 
42
 （二）多通道生理訊號處理硬體平台 
A. 多重生理訊號雜訊去除與處理  
近幾年來，生物醫學慢慢成為研究主流，而非侵入式之生醫感測器系統更是重要。光脈
衝式血氧機不僅可以做居家檢測，另外像手術、睡眠檢測及醫院的醫療照護等，也常常會用
到血氧機做監控[39] 。血氧機本身不僅有血氧檢測功能，還有心跳檢測功能，有文獻指出
心跳速率的變化可做為睡眠輔助判讀的依據[40] 。實驗室內已經有使用加速規判讀睡眠的
技術，若能做出可同步檢測心跳和加速規訊號的儀器，相信在睡眠偵測系統的研究能更上一
層樓。 
I. 雜訊偵測與去除電路架構 
 三軸加速度感測器 
加速度計 ADXL 335 為一採用微機電系統 (Micro Electro Mechanical 
Systems, MEMS) 技術所製作出來的三軸加速度，比起其他規格的加速度計（或
稱加速規），ADXL 335 具有較小的體積，溫度特性佳，功率消耗低，適合攜帶
式電路應用。 
 
Fig. 5-22 加速規內部區塊功能說明[41] 
透過加速規可以得知手部是否有活動，用於記錄手部動作產生之雜訊，再
經過一些運算式可以得到活動能量變化。 
44
  
Fig. 5-25 LED切換開關與濾波放大線路圖 
 
電源供應部份，採用 LM1117系列之穩壓器[42]，並加上 22uF電容器做濾
波增加電源穩定度。 
II. 時序與放大器驗證 
LED切換頻率為 125Hz，在取樣前 2ms 開啟，並在取樣完畢後立即關閉節
省電源。Fig. 5-26 為測試點示意圖，LED 因為極性正負交換，在此設為紅光 LED
之順向為正電位，並從 Fig. 5-27得知紅光 LED 順向導通電壓約 1.6V左右，而
紅外光 LED 順向電壓約 1.1V。 
 
Fig. 5-26 量測點示意圖 
 
Fig. 5-27中虛線為 LED燈關閉時間，洋紅色部份為紅外光開啟時間，紅色
第一級輸出 
第二級輸出 
LED正端 
LED負端 
46
 B. 多重生理訊號即時分析之演算法之嵌入式軟硬體開發 
目前市面上充斥著各式各樣的生理監測系統，大部份使用的是有線錄製系統，並將資料
存放於多媒體儲存裝置內。本論文將結合無線傳輸系統，開發出一套可以輕易裝設及卸下之
無線腕式生理記錄器，用來記錄人體血氧濃度和心率變化。 
I. 嵌入式開發版架構與規格 
 無線發射與接收模組 
採用以 TI CC2430 之無線傳輸晶片，該晶片以 8051 做為基礎並做功能強
化，擁有 8倍於原始 8051之效能，雙通道的資料指標。開發軟體為 IAR Embedded 
Workbench，支援 In-circuit interactive debugging，提供便利的開發環境。 
內部週邊 DMA控制器，Power On Reset/Brown-Out 偵測，提供 8個通道可
設定解析度之類比數位轉換，類比數位轉換解析度最高可達 12 bits，可程式化
的watchdog timer，32.768kHz的 RTC功能。另設計有串列傳輸介面 SPI和UART
功能，21支一般功能的數位 I/O腳位。低功率模式部份，具有 4 種可彈性規劃
之 Power mode。 
內部分為 3個大模組，分別為 CPU 模組、電源與測試及 Clock 相關模組、
無線傳輸模組，其詳細規格如下[37]： 
 無線傳輸部份 
(1) 2.4 GHz IEEE 802.15.4 RF規格 
(2) 良好的接收靈敏度和抗干擾 
 一般的電氣特性： 
(1) 低電流消耗(無線發射: 27 mA，無線接收: 25 mA @32 MHz) 
(2) Powerdown mode下僅需消耗 0.5 µA，Stand-by mode下消耗 0.3 µA 
(3) Low-power mode切換到 Active mode 速度快，可用於工作週期低之系統 
(4) 可工作電壓範圍廣（2.0V - 3.6V） 
(5) 可工作溫度範圍：-40℃至+85℃ 
 微控制器： 
(1) 高效能、低功率耗之 8051 核心控制器 
(2) 32, 64或 128 KB的內部程式快閃記憶體(Flash Memory) 
(3) 8 KB的內部隨機存取記憶體(RAM)，在任何功率模式均有 4 KB資料保留
功能。 
(4) 高效能之 DMA功能。 
(5) Watchdog timer功能。 
(6) 內部包含 1 個 IEEE 802.15.4 MAC Timer、1 個 16-bitTimer 和 2 個 8-bit 
Timers。 
(7) 支援硬體中斷的除錯功能。 
 
 
48
  
Fig. 5-30 Chipcon 2430 開發板 
 
Fig. 5-31 力摩科技公司所開發之 2430 小型開發板 
II.  CC2430韌體程式設計 
傳輸部份 TI CC2430微控制器為核心，分為傳送與接收兩部份設計，為確保傳送資料能
正確送達接收端，將使用具有重傳 (Retransmission) 及確認 (Acknowledgment) 之傳輸溝通
機制，多次嘗試傳送皆失敗時，會將資料暫存於發射端之記憶體內，等待錄製結束時，再將
資料全部發送到接收端，並將傳送失敗之資料發送至成功接收為止。 
 資料擷取與發送 
使用 TI CC2430 最高可提供 8個通道 A/D 轉換功能 (P0.0-P0.7)，本論文所
取樣之訊號有 SpO2及三軸加速值 XYZ，故需使用 4個通道 A/D 轉換，訊號取
樣率 250Hz，SpO2設定為 P0.0，XYZ 三軸分別對應至 P0.1至 P0.3。 
韌體程式設計上以 Timer1中斷做為取樣和紅光、紅外光燈號轉換，Timer1
每 2ms中斷一次（每秒鐘發生 500 次中斷），其中：第一次中斷開啟紅光 LED
50
  資料接收與監控軟體 
接收端接收到發送端的封包後，會回傳 ACK訊號給發送端，確認資料已完
整送達，再將資料由 RS-232傳送至電腦端做即時監控，並將資料儲存起來供後
續分析及演算法開發。 
  
Fig. 5-33 主機端使用者介面 
52
  硬體電路實現 
實體電路 Layout 圖如下，長 27.4mm、寬 24mm，在繪製電路板中，盡量讓零件可以夾
藏於印刷電路板與 TI CC2430 間，並加上鋪銅減少訊號干擾。 鋰電池容量 240mAh，以電
路平均電流 26.2mA而言，可以使用 9個小時左右。 
 
Fig. 5-35 PCB Layout 圖 
 
Fig. 5-36 電路板實體圖 
 
Fig. 5-37 無線腕式生理記錄器實體照片 
 
 
X 
Y 
Z 
54
 180000個封包即為 2個小時的資料量。 
由 Table 5-6得知直接傳送成功率為約 97.7%，其餘幾乎可在第一次重傳後補回，極少部
份需要重傳第二次，8個小時內總遺失的封包數量僅 8個，其遺失之資料內容會放置於
CC2430 內部的暫存空間 (放於 RAM 內，最高可存放 70個封包) ，待實驗結束後再傳送回
來。 
 
Table 5-6 無線傳輸系統測試結果 
 
第 1-2 小時 第 3-4 小時 第 5-6 小時 第 7-8 小時 總數量 
直接收到 173765 174024 177473 178204 703466 
第一次重傳 6232 5973 2526 1791 16522 
第二次重傳 0 3 1 0 4 
遺失 3 0 0 5 8 
 
56
 System Level Design 
 System Level Parameter 
Once the specifications of the modulator are decided, the system parameters must be designed 
carefully to achieve these targets. The ENOB and the corresponding peak SNR of a Σ∆ modulator 
can be calculated by the following equation [44]:   
122
2 )12)(
12(
2
3 +×−+= LNL OSR
LDR
pi
                         (5-17) 
The system parameters in Eq. (5-17) include the resolution of internal quantizer (N), the loop 
filter order (L) and the oversampling ratio (OSR). For the target resolution of 12-bit (peak SNR = 
74 dB), it is reasonable to set an overdesign specification to 14-bit ENOB (peak SNR = 86 dB), 
then the decision of the above system parameters is discussed as following: first, OSR is related to 
the operating speed of the modulator. Taking the CMOS process limit and the trade off between 
GBW and power consumption of opamp into account, a sampling rate of 500 MHz is a reasonable 
upper bound [50] in 0.18 µm CMOS process. To ease the loop filter and quantizer design, an OSR 
of 16 (sampling rate is 320 MHz) is an appropriate choice. Second, the loop filter order can be 
considered for the modulator stability and design effort. A high order loop filter may cause the 
quantizer overloaded easily, and the number of the corresponding system coefficients is much 
more than the low order one, which complicates the system design. Third, due to the relatively 
lower OSR in wideband CT Σ∆ modulator design, multi-bit quantizer is commonly used to achieve 
the same SNR. Finally, it can be seen that a loop filter order of 3 combined with a 4-bit quantizer 
is a suitable solution in considering the modulator stability and the achieve performance. With 
OSR = 16, L = 3 and N = 4, the resulted peak SNR is 88.19 dB. 
 
 Architecture of the Loop Filter 
To reduce the sensitivity of circuit non-idealities, single-loop low-pass modulator topology is 
chosen. In general, there are two types of the loop filter architectures to form the CT Σ∆ modulator 
system: cascade of integrators combined with distributed feedback (CIFB) or feed-forward (CIFF). 
The signal transfer function (STF) in CIFB architecture has a flat response, which can provide 
more filtering to inteferers. But stability problem and intrinsically power consumption arise due to 
the large swing at integrator output. In contrast, CIFB is more suitable for low power design, while 
the sum of the feed-forward path could cause overload in quantizer input, a peak transient response 
also occurs at high frequency of the STF at the same time. Combined with above discussion, the 
hybrid loop filter architecture [47] is chosen, which covers the advantages of both CIFB and CIFF 
ones.  
In order to achieve higher in-band SNR, a local feedback loop around pairs of integrators is 
added to move the zeros of noise transfer function away from DC and spread over the signal band. 
The excess loop delay issue of the CT Σ∆ modulator is compensated by an extra feedback path kd 
58
 In order to minimize the influence of the circuit noise, the first stage is the critical one which must 
be considered in detail. According to the thermal noise analysis and the target SNR, the maximum 
value of the usable resistors is 4.808kΩ. Combined with Eq. 5-4-4, the equivalent resistor and 
capacitor can be determined according to the proposed loop filter coefficients in Table 5-8 and 
sampling frequency. Considering some design margin and practical implementation, the 
determined values are shown in Table 5-8. 
Table 5-8  Proposed resistor and capacitor value 
R1 R2 R3 R4 Rz C1,2,3 
1.388k 8.333k 4.166k 4.166k 83.333k 1p 
 
To compensate the RC time constant variation, the unit integration capacitor is replaced by 
multiple capacitor array combined with MOSFET switch. According to TSMC 0.18-µm model, the 
proposed tuning range is sufficient to compensate ±30% resistor variation of real implementation. 
For the resistive loading in continuous-time integrator, one stage cascade opamp is not suitable due 
to the large output impedance. In [47], multistage opamp with nested Gm-C compensation (NGCC) 
is used, which can achieve very large gain (>80dB). However, the frequency compensation of 
NGCC is very complex, and the multistage architecture may even waste some power consumption. 
For simpler design and lower power consumption, two-stage Miller opamp structure is chosen (Fig. 
5-40), and it can provide high GBW and sufficiently high dc gain, combined with a high output 
swing [44][50]. For the same slew rate requirement, the calculated power consumption of 
two-stage topology is about 20% smaller than NGCC, and that of whole modulator can be saved 
by 10% while replacing NGCC with two-stage one. 
 
Fig. 5-40 Two-stage Miller opamp and CMFB 
The specifications of the opamp are considered as following: according to [52], a dc gain of 
20dB is sufficient at all. Taking other noise requirements and design margin into account, a 50dB 
dc gain is a chosen. In CT Σ∆ modulator, the GBW product is the main consideration, which is a 
trade off between performance loss and power consumption. The appropriate GBW is designed by 
incorporating the non-ideal model in system simulation. In [52], the output transfer function of real 
integrator with finite opamp GBW can be modeled. By MATLAB simulink simulation with 
60
 modulator system, any non-ideal effect of the quantizer is attenuated by the noise shaped loop 
filter, so the induced noise and distortion requirements are relaxed.  
 
Fig. 5-43 Flash ADC and the dynamic comparator 
The 15-bit thermometer output of flash ADC is converted to 4-bit binary code by the Wallace 
tree converter which incorporating several 1-bit full adder. Although this structure is not the fastest 
operation, this encoder is the most hardware economic one. In the proposed CT Σ∆ modulator, a 
simple clock generator based on inverter delay chain is used to provide the different clock edge. 
The overall circuit level simulation result combined with this clock generator is acceptable in 
different corner and temperature variation, so the complicated tunable delay line is avoided.  
 Transistor Level Simulation 
62
 100 101 102 103 104
−120
−100
−80
−60
−40
−20
0
Frequency [Bin]
O
ut
pu
t s
pe
ct
ru
m
 [d
B]
100 101 102 103 104
−140
−120
−100
−80
−60
−40
−20
0
Frequency [Bin]
O
ut
pu
t s
pe
ct
ru
m
 [d
B]
 
(a) Fin = 3.203125 MHz          (b) Fin = 8.671875 MHz 
Fig. 5-46 Output spectrum of the post-layout simulation result 
Dynamic Range
-20
-10
0
10
20
30
40
50
60
70
80
90
100
-100 -90 -80 -70 -60 -50 -40 -30 -20 -10 0
|Vin/Vref| (dB)
S
i
m
u
l
a
t
e
d
 
S
N
R
 
(
d
B
)
 
Fig. 5-47 Dynamic range of the proposed work 
64
  
 A Glitch-Free DLL-Based Clock Generator using a Feedback Switching 
Detector for Power Management Systems 
 
I. Introduction 
A power management system can ensure system to operate within specification and achieve 
nominal power dissipation through power/speed modulation [62]. For example, Intel Pentium M 
processor has speedstep technology which has six frequency/voltage modes to switching [60]. For 
such purpose, we will need a programmable, wide frequency range clock generator to provide 
various clock frequencies to confirm different work situations of the system. The clock generators 
could be solved by phase-lock loops (PLLs) or delay-locked loops (DLLs). From the properties of 
PLLs and DLLs we can see that the DLLs have many advantages, such as stable, easier to 
integration, and low jitter performance. Therefore, we prefer the DLLs to the PLLs. To design a 
programmable, wide-range DLL-based clock generator, the locking states, locking ranges, and the 
difficulty of frequency multiplication are the design concerns [54]. 
The number of multiplication factors of DLL-based clock generator almost determined by the 
number of used delay stages. According to this theorem, switching the feedback stage of the DLL 
can changes the number of used delay stage and increases the number of multiplication factors. 
The frequency synthesizer for UWB application [56] has discussion about the directly switching 
between the different feedback stages of the DLL will produce undesired glitch which confuses the 
operation of the PFD and may let the system failed. We can use the multi-PFD-CPs architecture to 
overcome the undesired glitch. However, for an eight delay stages DLL-based clock generator, this 
architecture needs four-pairs of PFD-CPs to generate whole number of multiplication factors. The 
additional PFD-CPs increases the chip area. 
In this project, a DLL-based clock generator using a feedback switching detector is proposed. 
With the proposed feedback switching detector, the clock generator generates eight-type 
multiplication factors without undesired glitch and chip area overhead. Additionally, we improve 
the lock controller [59] to apply in feedback stage switching architecture. The lock detector not 
only enlarges locking range, but also achieves fast locking. Besides, we use pulse reshaper circuit 
[55] to reduce the static phase error to maintain the jitter performance of output signal in wide 
operating frequency range and speed-up the lock time. 
II. Architecture of the DLL-Based Clock Generator 
The conventional DLL based clock generator structure is shown in Fig. 5-48. The DLL based 
clock generator uses edge combiner to produce the multiplied output signal and frequency 
multiplication factor of the DLL-based clock generator is determined by the number of delay cells 
[53]. The equivalent delay can be changed by switching the feedback stage from one delay stage to 
another. Therefore, the output frequency will be changed to another multiplication factor 
consequently. However, direct switching between different feedback stage will causes the 
undesired glitch shown in Fig. 5-49. The appearance of the undesired glitch confuses the operation 
66
  
Fig. 5-50  Proposed DLL-based clock generator 
III. Architecture of Edge Combiner and Proposed Control Circuits 
The pulse toggle edge combiner [57] is using transition detector to detect the rising edge of 
VCDL output, and then generate a short period pulse. The edge combiner puts the short pulses 
together and toggles the phase of output clock at every negative edge of the short pulses. Thus, the 
multiplied output clock signal toggles at every rising edge of VCDL output. Even though the duty 
cycle of VCDL outputs is not 50%, the multiplied output signal does toggle at 50% duty cycle. If 
the VCDL has N delay cells, then the output clock frequency can be expressed as 
( )2_ref_output Mfreqfreq ×= , ( )NMM <≤= 1,integer                    (5-20) 
The multiplication factor M/2 can be chosen dynamically by the multiplication factor 
controller. The outputs of the transition detector are paired to guarantee maximum pulse separation, 
which reduces signal transition overlap and increases the operating frequency of the edge 
combiner [57]. The block diagram of edge combiner is shown in Fig. 5-51. 
 
 
Fig. 5-51  Edge combiner circuits 
 Multiplication Factor Controller 
According to the operation of edge combiner, we design the control pattern to program the 
multiplication factor. The control pattern is shown in Table 5-10. Use the truth table and K- map 
method to design the digital logic to produce the control signal Si. The Last 1 in Si means the 
feedback signal of DLL, so we design the Ei signal to indicate the clock generator which VCDL 
stage is feedback to the PFD to form the DLL loop. 
68
  
Fig. 5-52  Modified lock detector 
Table 5-11 The operating range of the modified lock detector  
 
 Feedback Stage Detector 
In order to avoid switching glitch, we propose a new circuit called feedback switching 
detector. The architecture of this circuit is shown in Fig. 5-53. The multiplication factor controller 
generates the enable signal Ei to let the system know which delay stage output signal is the 
feedback signal of the DLL. The operation waveform of the feedback stage detector is shown in 
Fig. 5-54. For example, when E5 signal falling, no matter what Ei signal is turn on, we know that 
the number of used VCDL stages will increase. Under the same reference period, increase the 
number of used delay stages, the DLL must to charge and decrease the delay time of each used 
delay stage. So, the feedback stage detector turns on the set_upper signal to GFLD and thus 
controls system to charge.  
The proposed feedback switching detector let the DLL-based clock generator can generate 
whole number of multiplication factors and avoid the area-hunger multi-PFD- CPs architecture. 
The proposed DLL-based clock generator can reduce the chip area (compared to the 
multi-PFD-CPs architecture) and perform the DLL feedback signal switching application. Because 
of the pre-charge and pre-discharge mechanical of the feedback switching detector, the DLL-based 
clock generator can speed-up its operation. 
IV. Remainning circuits implementation 
The remaining circuits in our DLL-based clock generator are including of PFD, CP, loop filter 
and VCDL. The DLL is a first-order system in nature, so the loop filter in DLL is just a capacitor. 
In order to employ the control signals, we must modify the architecture of PFD. Furthermore, the 
DLL must lock in a wide Vctrl voltage range for the clock generator can generates wide frequency 
70
 ~ 3pi. The characteristic plot of PFD, CP and LF shows both linear and binary 
characteristics depending on the control signals from the modified lock detector, thereby 
achieving low jitter and fast locking speed simultaneously [59]. The extended work range 
of PFD in all kinds of DLL feedback signal conditions is listed in Table II. 
 CP, VCDL, and Pulse reshaper 
The differential, current mode CP [57] is suitable in high-speed operation. For low 
power consideration, the current-starved inverter delay stage is suitable for this design. The 
pulse reshaper [55] will reshape the UP/DOWN pulse when the REF and VCDL become 
closer in the designed phase difference, the pulse RUP or RDOWN activated by the late 
signal has an increasing voltage value like a glitch. This action will strengthen the phase 
leading signal effect in CP. The gain in the middle of the characteristic plot of PD-CP will 
be increased. The little high gain range that cross the CP current mismatch line closer to 
the Y-axis, so the static phase error will also be reduced. 
 
Fig. 5-55 Modified PFD 
V. MEASUREMENT Results 
The DLL-based clock generator with new control circuits has been implemented in TSMC 
0.18-µm CMOS technology. The die photo is shown in Fig. 5-56, and layout area is 0.494mm2 
(active area is 0.039 mm2). Under different input reference frequency and different multiplication 
factors (eight-types), the clock generator can generates output clock frequency ranging from 
100MHz to 1.6GHz. The Peak-to-Peak jitter is 23.168ps at 1.6GHz. Fig. 5-57 shows eye diagram 
of its maximum output frequency 1.6GHz. Table 5-12 summaries the performance of the designed 
clock generator and compares with other works. With proposed FSD, this work can produce most 
multiplication factors, prevent undesired glitch, and cost less active area. 
Table 5-12  Performance Summary. 
72
  
Fig. 5-57 Output eye diagram @ 1.6GHz (multiplied by 4) 
 A High-Resolution Low Power Multimode Σ∆ADC for Biomedical 
Application 
Table 5-13 : The Electrical Characteristic of common biopotential signal 
Signal 
Specification 
ERG/ EEG ECG ECOG EMG 
Operational 
frequency 
DC-50 
DC-150 
0.01-250 0.5-500 dc-2k 
System SNDR 86dB 80dB 48dB 48dB 
Bandwidth  512/2k 2k 16k 32k 
OSR 1024 512 128 64 
Sample Frequency 1MHz 1MHz 2MHz 4MHz 
     
I. Principle of Operation 
 System Architecture 
1
1
1 −
−
− z
z
1
1
1 −
−
− z
z
 
Fig. 5-58 Architecture of 2nd-order Sigma delta modulator 
 
Fig. 5-58 presents the architecture of single-bit DT Σ∆which consists of a 2nd-order loop 
filter with distributed feedback. The signal transfer function (STF) in CIFB architecture has a 
flat response, which can provide more filtering to interface. In the general, there are two types 
of the loop filter architectures to form the DT Σ∆ modulation system : cascade of integrators 
combined with distributed feedback (CIFB) or feed-forward (CIFF)[64]. In a feedback 
74
              (5-22) 
Where k is Boltzmann’s constant, T the temperature in Kelvin, and the sampling capacitor 
Cs.  The peak signal power can be written in (5-23) 
          (5-23) 
Where Vmax in the maximum amplitude of ADC input signal. From the Peak SNR define 
and consider the OPAMP thermal noise, the sample capacitor requirement can be written in 
(5-24) and (5-25). 
       (5-24) 
        (5-25) 
Where Pnamp is opamp’s noise include thermal noise and flick noise. Reference Table 
5-13 to calculate sampling capacitor with different SNR and relation OSR in these different 
biomedical applications in Table 5-14. 
 
Table 5-14 : The Sample Cap with SNR and OSR in different biomedical application 
SNR(dB) Pin OSR Ps Pamp CS 
86 3.31E-20 1024 0.5 1E-10 2.02E-14 
90 3.31E-20 256 0.5 1E-10 1.7E-14 
72 3.31E-20 128 0.5 1E-10 1.63E-15 
48 3.31E-20 128 0.5 1E-10 5.13E-16 
48 3.31E-20 64 0.5 1E-10 2.04e-18 
 
The sampling capacitor of the first integrator is 1pF which was decided after minimizing 
the amplifier noise. The amplifier’s noise has thermal noise and flick noise. Flick noise can 
using some techniques to reduce or cancel in this low frequency. However these technologies 
are hard to implement in multi-mode clock ∆Σ modulators. For this reason, increasing the 
geometric size of those transistors which are the main source of the flick noise. So the thermal 
noise is the only dominant source of operation amplifier. 
2. Operational Amplifier Effect 
An ideal integrator with unity coefficient, its transfer function is  
             (5-26) 
Where g and α are the integrator’s gain and leakage, respectively. There are many 
nonidealities effect in the ideal transfer function of (5-26), including the integrator’s finite DC 
76
   
 Saturation voltage 
The major concern is the dynamic signal range of ∆Σ modulators. The saturation level 
will affect the op-amp work range. This can simply be done using saturation block in the 
behavior model simulation results to be compared with circuit results. 
II. Experiment Results 
The prototype chip has been fabricated in TSMC digital 0.18um CMOS Process with 3v 
supply (Fig. 5-60). The core area occupies 0.154 mm2. Fig. 5-61 show the measured spectra for 
different bio-medical modes at SNDR. Fig. 5-62 summarizes the performance. 
 
Fig. 5-60 Micro-photograph of Fabricated of 2nd Sigma Delta modulator. 
 
Using cap for reference 
 
(a) 185Hz        (b) 285Hz 
78
  
80
 B. 整合生理訊號處理於多通道生理訊號處理硬體平台 
本計畫所開發的多通道生理量測平台架構圖如 Fig. 5-63。其整合 sigma-delta類比數位轉
換晶片及 OpenRISC做為生理訊號的擷取及分析處理。OpenRISC為 32位元 RISC架構處理
器，具有 1.0 DMIPS的優異處理能力。在本計畫中，OpenRISC燒錄在 FPGA內做為系統雛
型功能驗證。運算結果即時回傳至電腦觀察結果。 
 
OpenRISC SoC
 (Programmed into  
Cyclone III FPGA 
EP3C25E144C8N)
Sigma-
Delta ADC
Analog CH 0 
~ CH 3
Reset
Clock
OpenRISC
Debugger
Low-Noise 
Amplifier
(MC33078)
SMA
Analog CH 4 
~ CH 6
FPGA 
Debugger USB
Digital 
Output
FP
G
A 
JT
AG
OpenRISC 
JTAG
USB
SCL
SDA
 
Fig. 5-63 混合訊號處理開發電路板架構(Sigma-Delta ADC and OpenRISC in FPGA) 
 
 
OpenRISC 1200(OR1200) 是由 OpenCores 組織所發展以及維護的一開放可合成的 CPU 
verilog 程式碼。OpenRISC1200的為架構在 Harvard micro-architecture下的 32位元的純量精
簡指令集 (Reduced Instruction Set Computing，RISC)，其支援 5層的整數管線(Pipeline)，虛
擬記憶體單元(MMU)，以及基本的 DSP 能力[73]，並採用 OpenRISC 1000(OP1K)精簡指令
集架構實現 。Fig. 5-64為 OpenRISC之基本的架構圖。 OR1K架構可使用在 OpenRISC系
列處理器或是自由的精簡指令集處理器核心，且可因應不同的價格效能比做不同範圍的應用
[73],[74]。OR1K 也提供了一靈活的架構定義，允許某些特定的功能使用硬體或是軟體的協
助實現。表二為 OR1K的主要特點。 
82
 Analog Switch
Programmable Gain 
Amplifier
Analog Channel 0 ~ 6
Sigma-Delta ADCI2 C
 
Re
gi
st
er
 
Ba
n
k
31-bit Digital Output
31
SDA
SCL
Clock
Reset
System 
Interface
 
Fig. 5-65 多通道 Sigma-Delta ADC架構圖 
 
 
 
 
 
 
 
 
Fig. 5-66 多通道 PGA架構 
84
  
Fig. 5-69 多通道 Sigma-Delta類比數位轉換器 die photo (如左) 及其封裝照片(如右) 
Sigma-delta類比數位轉換器的效能量測設置如 Fig. 5-70。我們使用 OpenRISC內建的 I2C 
Master Device編輯 Sigma-delta類比數位轉換器設定並啟動。ADC的 digital code是透過Altera 
SignalTap軟體擷取 4096點，再丟到Matlab做頻域分析。Sigma-delta類比數位轉換器的量
測效能如 Table 5-16所示。 
 
 
 
FPGA
OpenRISC
Debugger
Altera USB Blaster
Sigma-Delta ADC
Pre-Amplifier
 
Fig. 5-70 多通道 Sigma-Delta類比數位轉換器晶片效能量測設置(如左)及電路板(如右) 
86
 六、參考文獻 
[1] Rechtschaffen A, Kales A, eds. “A manual of standardized terminology, techniques and 
scoring system for sleep stages of human subjects”. Los Angeles, CA: BI/BR, 1968. 
[2] Schaltenbrand N, Lengelle R, Toussaint M, Luthringer R, Carelli G, Jacqmin A, Lainey E, 
Muzet A, and Macher JP,, " Sleep stage scoring using the neural network model: Comparison 
between visual and automatic analysis in normal subjects and patients," Sleep, 19: 26–35, 
1996. 
[3] Agarwal R and Gotman J, “Computer-assisted sleep staging,” IEEE Trans. Biomed. Eng., 
48: 1412–1423, 2001. 
[4] Berthomier C, Prado J, and Benoit O, “Automatic sleep EEG analysis using filter banks,”
Biomed. Sci. Instrum., 35: 241–246, 1999. 
[5] Duman F, Erdamar A, Erogul O, Telatar Z, and Yetkin S, “Efficient sleep spindle detection 
algorithm with decision tree,” Expert Systems with Applications, 36: 9980–9985, 2009. 
[6] Iber C, Ancoli-Israel S, Chesson A, and Quan SF, “The AASM manual for the scoring of 
sleep and associated events,”  1st ed. Westchester, IL: American Academy of Sleep 
Medicine, 2007. 
[7] Anderer P, Gruber G, Parapatics S, et al, “An e-health solution for automatic sleep 
classification according to Rechtschaffen and Kales: validation study of the Somnolyzer 24x7 
utilizing the Siesta database,” Neuropsychobiology, 51:115-33, 2005. 
[8] S. R. Mousavi, M. Niknazar, B. V. Vahdat, “Epileptic seizure detection using AR model on 
EEG signals,” in Proceedings of Cairo International Biomedical Engineering Conference, 
pp. 1-4, 2008. 
[9] S. Ghosh-Dastidat, H. Adeli, and N. Dadmehr., “Principal component analysis-enhanced 
cosine radial basis function neural network for robust epilepsy and seizure detection,” IEEE 
Transactions on Biomedical Engineering, vol. 55, no, 2, pp. 512-518, 2008. 
[10] H. Ocak, “Optimal classification of epileptic seizures in EEG using wavelet analysis and 
genetic algorithm,” Signal Processing, vol.88, pp.1858–1867, 2008. 
[11] G. Golub, “Numerical methods for solving linear least squares problems,” Numerische 
Mathematik, vol. 7, no. 3, pp.206-216, 1965. 
[12] J. H. Friedman, “Regularized discriminant analysis,” Journal of the American Statistical 
Association, vol. 84, no. 405, pp. 165-175,1989. 
[13] D. E. Rumelhart, G. E. Hinton, and R. J. Williams, “Learning representations by 
back-propagating errors,” Nature, vol. 323, pp.533-536, 1986. 
[14] V. Srinivasan, C. Eswaran, and N. Sriraam, “Approximate entropy-based epileptic EEG 
detection using artificial neural networks,” IEEE Transactions on Information Technology 
in Biomedicine, vol. 11, no. 3, pp.288-295, 2007. 
88
 [30] Nieto F. J., Young T. B., Lind B. K., Shahar E., Samet J. M., Redline S., D'Agostino R. B., 
Newman A. B., Lebowitz M. D., and Pickering T. G., "Association of sleep-disordered 
breathing, sleep apnea, and hypertension in a large community-based study," JAMA: the 
journal of the American Medical Association, vol. 283, p. 1829, 2000. 
[31] Nikooie R., Gharakhanlo R., Rajabi H., Bahraminegad M., and Ghafari A., "Noninvasive 
Determination of Anaerobic Threshold by Monitoring the% SpO2 Changes and Respiratory 
Gas Exchange," The Journal of Strength & Conditioning Research, vol. 23, p. 2107, 2009.  
[32] Rusch T., Sankar R., and Scharf J., "Signal processing methods for pulse oximetry* 1," 
Computers in biology and medicine, vol. 26, pp. 143-159, 1996. 
[33] Schmitt P. M., Gobel T., and Trautvetter E., "Evaluation of pulse oximetry as a monitoring 
method in avian anesthesia," Journal of Avian Medicine and Surgery, pp. 91-99, 1998. 
[34] Reynolds K. J., Palayiwa E., Moyle J. T. B., Sykes M. K., and Hahn C. E. W., "The effect of 
dyshemoglobins on pulse oximetry: Part I, Theoretical approach and Part II, Experimental 
results using an in vitro test system," Journal of clinical monitoring and computing, vol. 9, pp. 
81-90, 1993. 
[35] Veltink P. H., Bussmann H. B., de Vries W., Martens W. L., and Van Lummel R. C., 
"Detection of static and dynamic activities using uniaxial accelerometers," Rehabilitation 
Engineering, IEEE Transactions on, vol. 4, pp. 375-385, 1996. 
[36] Wang L., Wei W., Gong M., and Mu L., "A comparison of response time to desaturation 
between tracheal oximetry and peripheral oximetry," Journal of clinical monitoring and 
computing, vol. 24, pp. 149-153, 2010. 
[37] Texas Instruments, "CC2430 Datasheet". Available: http://www.ti.com, 2010.  
[38] Zmode Technology Co., Ltd, "TI CC2430 Module". Available: http://www.zmode.com.tw/, 
2007.  
[39] Wang L., Wei W., Gong M., and Mu L., "A comparison of response time to desaturation 
between tracheal oximetry and peripheral oximetry," Journal of clinical monitoring and 
computing, vol. 24, pp. 149-153, 2010. 
[40] Lewicke A., Sazonov E., Corwin M. J., Neuman M., and Schuckers S., "Sleep versus wake 
classification from heart rate variability using computational intelligence: consideration of 
rejection in classification models," Biomedical Engineering, IEEE Transactions on, vol. 55, 
pp. 108-118, 2008. 
[41] Analog Device, Inc., "ADXL335 Datasheet". Available: 
http://www.analog.com/en/index.html, 2009.  
[42] National Semiconductor, "LM1117 Series Low Dropout Voltage Regulators". 2004.  
[43] S. Yan and E. Sanchez-Sinencio, “A continuous-time sigma-delta modulator with 88-dB 
dynamic range and 1.1-MHz signal bandwidth, ”IEEE J. Solid-State Circuits, vol.39, no. 1, 
pp. 75-86, Jan. 2004. 
90
國科會補助專題研究計畫項下出席國際學術會議心得報告 
                                     日期：99 年 10 月 31 日 
一、 參加會議經過 
本人於 2010/9/24 搭乘荷蘭航空班機經由曼谷與阿姆斯特丹等地，並於 2010/9/25
轉抵西班牙‧馬德里以參加 18th IFIP/IEEE International Conference on Very Large 
Scale Integration (VLSI-SOC 2010)，該會議於 9/27 開始舉行。本人於會議期間分別
以口頭與海報發表 2篇論文，分別為” A 36-mW Continuous-Time Sigma-Delta 
Modulator with 74db Dynamic Range and 10-MHz Bandwidth”與” An 100MHz 
to 1.6GHz DLL-Based Clock Generator Using a Feedback-Switching Detector”。 
此會議審查過程嚴謹，每篇論文均有超過五位審查委員給予詳盡之意見，本年度
已是其第十八次舉辦，會中約有 200 人參與。此會議結束後，由於受到法國 CMP 研
計畫編號 NSC99－2220－E－009－032 
計畫名稱 具生物反餽機制之智慧型長時睡眠監測系統－子計畫二：多重生理訊
號分析與硬體實現(2/2) 
出國人員
姓名 
闕河鳴 
服務機構
及職稱 
國立交通大學電機工程學系(所) 
會議時間 
2010 年 9 月 27 日
至 
2010 年 9 月 29 日 
會議地點 西班牙‧馬德里 
會議名稱 
18th IFIP/IEEE International Conference on Very Large Scale Integration 
(VLSI-SOC 2010) 
發表論文
題目 
1. A 36-mW Continuous-Time Sigma-Delta Modulator with 74db Dynamic 
Range and 10-MHz Bandwidth 
2. An 100MHz to 1.6GHz DLL-Based Clock Generator Using a 
Feedback-Switching Detector 
A 36-mW Continuous-Time Sigma-Delta Modulator with 74db Dynamic 
Range and 10-MHz Bandwidth 
Kuo-Che Hong and Herming Chiueh  
Department of Electrical Engineering 
National Chiao Tung University, Hsin-Chu, Taiwan  
Email: {seamus10114, chiueh}@soclab.org 
Abstract²A wide-bandwidth low-power CT Ȉǻmodulator with 
10MHz signal bandwidth LV LPSOHPHQWHG LQ 760&  ȝP
CMOS process in this paper. To realize such application 
scenario, the proposed modulator comprises a third-order 
active-RC loop filter and a 4-bit internal quantizer operating at
320 MHz clock frequency. To reduced clock jitter sensitivity, 
non-return-to-zero (NRZ) DAC pulse shaping is used. The 
excess loop delay is set to half the sampling period of the 
quantizer and the excess loop delay compensation is achieved by 
the discrete-time deviator structure. The simulation result 
achieves above 74-dB SNDR (12 ENOB) over a 10-MHz signal 
band. The power dissipation is 36mW from a 1.8-V supply and 
the energy per conversion is 235fJ from post-layout simulation. 
The proposed circuitry can be utilized in low-power medical 
imaging and modern wireless communications. 
I. INTRODUCTION
For modern wireless communications and medical 
imaging applications, a high-performance analog-to-digital 
converter (ADC) is the core building blocks of analog front-
ends. In such advanced applications, data are transferred in a 
channel bandwidth above 5MHz and 10-bit resolution. 
Typically, pipelined ADCs are employed for these 
applications. However, the linearity is limited by the finite 
opamp gain especially in low supply voltage. Digital 
calibration and high gain opamp structure must be used to 
achieve higher resolution (> 10 bits), while the power 
consumption and chip area increases largely. Thus, it is less 
efficient to achieve high resolution with pipelined architecture.  
Over-VDPSOLQJȈǻ$'&VDUHZLGHO\ XVHG LQ DSSOLFDWLRQ-
specific ICs due to their high dynamic range and low power 
consumption. Thanks to the advance CMOS processes and 
continuous-time (CT) analog filter technique, the popularity of 
&7Ȉǻ$'&VKDVEHHQJURZLQJUHFHQWO\Due to the inherent 
anti-alias function and non-sampling loop filter, it is feasible 
to achieve resolution larger than 12 bits with a signal 
bandwidth up to MHz at the same time, leading to more 
power- and area-efficient ADC. Many discussions about the 
SRVVLELOLW\RIEXLOGLQJDKLJKVSHHGDQGKLJKUHVROXWLRQ&7Ȉǻ
ADCs for those applications are presented in [1]-[9].  
According to multi-channel real-time bio-signals 
monitoring system application, this work proposes a CMOS 
CT Ȉǻ PRGXODWRU ZLWK  0+] VLJQDO EDQGZLGWK DQG 
effective numbers of bits (ENOB). By combining the over-
sampling technique and blackened signal processing, a single 
ȈǻPRGXODWRU is utilized to sample multi-channel signals from 
an electrode array for high frequency EEG detections. The 
specifications promote CT ȈǻADCs as alternative to other 
types of ADCs. For the higher requirements of next generation 
applications in the future, the possibility of building CT Ȉǻ
ADCs will arise more by applying modern CMOS technology 
and new circuit technique.  
To realize the proposed application, a wideband low-
power CT ȈǻPRGXODWRU is designed in this paper. The system 
level considerations are described in Section II. Thereafter, the 
practical circuit implementation of some major blocks such as 
integrators, the feedback DAC and multi-bit quantizer are 
introduced in Section III. Finally, the transistor level 
simulation results are presented in Section IV.  
II. SYSTEM LEVEL DESIGN
A. System Level Parameters 
Once the specifications of the modulator are decided, the 
system parameters must be designed carefully to achieve these 
targets. The ENOB and the corresponding peak SNR of a Ȉǻ
modulator can be calculated by the following equation [2]:  
122
2
)12)(
12
(
2
3 u LN
L
OSR
L
DR
S
           (1) 
The system parameters in Eq. 1 include the resolution of 
internal quantizer (N), the loop filter order (L) and the 
oversampling ratio (OSR).  
For the target resolution of 12-bit (peak SNR = 74 dB), it 
is reasonable to set an overdesign specification to 14-bit 
ENOB (peak SNR = 86 dB), then the decision of the above 
system parameters is discussed as following: first, OSR is 
related to the operating speed of the modulator. Taking the 
CMOS process limit and the trade off between GBW and 
power consumption of opamp into account, a sampling rate of 
500 MHz is a reasonable upper bound [8] in ȝP&026
process. To ease the loop filter and quantizer design, an OSR 
of 16 (sampling rate is 320 MHz) is an appropriate choice. 
Second, the loop filter order can be considered for the 
The authors would like to thank Chip Implementation Center 
(CIC Taiwan) for chip fabrication and EDA tools supports. 
This research is supported by National Science Council, 
Taiwan. (Contract numbers: 99-2220-E-009-032, 98-2220-E-
009-001, 98-2220-E-009-066 and 98-2220-E-009-031)
392978-1-4244-6471-5/10/$26.00 c©2010 IEEE
M1 M2
M3 M4
M5
M6
M7
M8
M9
Vin+ Vin- Vout-Vout+
Vfb
VDD
MC MC
VDD
Cc Cc
MB
MC1 MC2
MC3 MC4
MC5
Vo+
Vo-
Vfb
Vcm
MCB
Fig. 2 Two-stage Miller opamp and CMFB 
The specifications of the opamp are considered as 
following: according to [10], a dc gain of 20dB is sufficient at 
all. Taking other noise requirements and design margin into 
account, a 50dB dc gain is a chosen. In CT ȈǻPRGXODWRUWKH
GBW product is the main consideration, which is a trade off 
between performance loss and power consumption. The 
appropriate GBW is designed by incorporating the non-ideal 
model in system simulation. In [10], the output transfer 
function of real integrator with finite opamp GBW can be 
modeled. By MATLAB simulink simulation with non-ideal 
integrator and considering some design margin, the target of 
GBW is set to 2.5 times the sampling frequency.  
B. Current-steering DAC 
VDD
D1+ D1- ... DN+ DN-
Vbias1
Vbias2
Vo-
Vo+
Vs Vs
M1 M2
Fig. 3 Multi-bit current-steering DAC 
In high speed applications, current-steering topology (Fig. 
3) is widely used for multi-bit DAC, and the current-mode 
output is easy to connect the continuous-time loop filter 
without any other transform circuit. To reduce excess loop 
delay, dynamic element matching is avoided for wideband CT 
ȈǻPRGXODWRU7RDFKLHYHLQWULQVLFKLJKOLQHDULW\DODUJHDUHD
device must be used for sufficient matching in circuit 
implementation. According to [9], the required size of the 
device element could be determined based on the process 
parameter mismatch model. As mentioned in [7], the thermal 
noise requirement of the first DAC must also be considered.  
Din+
Din-
Switch
Driver
Din+
Din-
Vs
Vs
Synchronize
Low-crossing
CLK CLK
Din+ Din-
DVDD=1.4V
Out- Out+
DVSS=0.5V
Fig. 4 Low-crossing point switch driver circuit 
Except for the large size device is used, the linearity can be 
improved by enlarge the output impedance of the current cell, 
which is achieved by cascading the transistors at output node. 
Besides, a low-crossing point switch driver (Fig. 4) is 
employed in front of each current cell to make the switch 
transistors still saturated even the input signal is toggled. Thus, 
the induced glitch is decreased and the linearity of the current 
source is improved more. 
C. Quantizer and Clock Generator 
Flash ADC is chosen in multi-bit quantization due to the 
capability of high speed operation. In Fig. 5, it comprises 15 
dynamic comparators combined with SR latches. In whole CT 
ȈǻPRGXODWRUV\VWHPDQ\QRQ-ideal effect of the quantizer is 
attenuated by the noise shaped loop filter, so the induced noise 
and distortion requirements are relaxed.  
+
-
+
-
+
-
+
-
+
-
+
-
VREF1=1.2V
Runit
Runit
Runit
0.5Runit
Vinp
Vinn
Latch
And
Encoder
...
...
...
Preamplifier
Reference
Ladder
Digital
Output
VREF1=0.6V
0.5Runit
Vi+ Vr+
CLK
Vi- Vr-
Fully differential
Dynamic comparator
CLK
Vout+ Vout-
CLKCLK
Fig. 5 Flash ADC and the dynamic comparator 
The 15-bit thermometer output of flash ADC is converted 
to 4-bit binary code by the Wallace tree converter which 
incorporating several 1-bit full adder. Although this structure 
is not the fastest operation, this encoder is the most hardware 
economic one.  
In the proposed CT Ȉǻ PRGXODWRU a simple clock 
generator based on inverter delay chain is used to provide the 
different clock edge. The overall circuit level simulation result 
combined with this clock generator is acceptable in different 
corner and temperature variation, so the complicated tunable 
delay line is avoided.  
D. Transistor Level Simulation 
R1
C1
-
++ -
OP1
+ -
+-
OP2
+ -
+-
OP3
+
- + - +
R1
C1
R2
R2
C2
C2
R4
R4
Rz
Rz
R3
R3
C3
C3
CLK
4-bit
Flash ADC
15-bit
thermometer
DAC2DAC1
-
Vin
+ -
D
Latch
D
Latch
CLK CLKB
DAC3
Fig. 6 Circuit implementation of the proposed modulator 
The overall circuit implementation diagram of the 
proposed CT ȈǻPRGXODWRU is shown in Fig. 6. The input is 
fully differential sin wave and the modulator output is 4-bit 
binary code. The whole chip layout of the proposed CT Ȉǻ
modulator is shown in Fig. 7 and the core area is 0.3 mm
2
. The 
4096-point FFT output spectrum of post-layout simulation 
result is shown in Fig. 8. The harmonic distortion is very low 
and the achieved SNDR is more than 74dB (12 ENOB). Fig. 9 
is the dynamic range (DR) simulation of the proposed CT Ȉǻ
modulator. The simulated DR is 87 dB, and the peak SNR is 
83.25 dB while |Vin/Vref| = -3 dB. The summary of simulation 
results are listed in Table III. The performance of this work 
394 2010 18th IEEE/IFIP International Conference on VLSI and System-on-Chip (VLSI-SoC 2010)
The authors would like to thank Chip Implementation Center 
(CIC Taiwan) for chip fabrication and EDA tools supports. 
This research is supported by National Science Council, 
Taiwan. (Contract numbers: 99-2220-E-009-032, 98-2220-E-
009-001, 98-2220-E-009-066 and 98-2220-E-009-031)
An 100MHz to 1.6GHz DLL-Based Clock Generator Using a Feedback-
Switching Detector 
Ding-Guo Lin, Bing-Hsun Lu and Herming Chiueh  
Department of Electrical Engineering  
National Chiao Tung University, Hsin-Chu, Taiwan  
Email: {hikaru, hidotop,chiueh}@soclab.org 
Abstract²In this paper, a glitch-free DLL-based clock 
generator using a feedback-switching detector is proposed for a 
programmable power management system. The proposed 
circuitry utilizes feedback switching detectors to eliminate 
undesired glitch problem which is generated by switching 
feedback stage of a DLL.  The clock generator can generate 
clock signals ranging from 100MHz to 1.6GHz. The peak to 
peak jitter is 23.168ps and power consumption is 37.8mW at 
1.6GHz. The proposed clock generator is implemented in TSMC 
0.18Pm process and occupies only 0.039 mm2 which is suitable 
for the power management systems. 
I. INTRODUCTION
A power management system can ensure system to operate 
within specification and achieve nominal power dissipation 
through power/speed modulation [10]. For example, Intel 
Pentium M processor has speedstep technology which has six 
frequency/voltage modes to switching [8]. For such purpose, 
we will need a programmable, wide frequency range clock 
generator to provide various clock frequencies to confirm 
different work situations of the system. The clock generators 
could be solved by phase-lock loops (PLLs) or delay-locked 
loops (DLLs). From the properties of PLLs and DLLs we can 
see that the DLLs have many advantages, such as stable, 
easier to integration, and low jitter performance. Therefore, we
prefer the DLLs to the PLLs. To design a programmable, 
wide-range DLL-based clock generator, the locking states, 
locking ranges, and the difficulty of frequency multiplication 
are the design concerns [2]. 
The number of multiplication factors of DLL-based clock 
generator almost determined by the number of used delay 
stages. According to this theorem, switching the feedback 
stage of the DLL can changes the number of used delay stage 
and increases the number of multiplication factors. The 
frequency synthesizer for UWB application [4] has discussion 
about the directly switching between the different feedback 
stages of the DLL will produce undesired glitch which 
confuses the operation of the PFD and may let the system 
failed. We can use the multi-PFD-CPs architecture to 
overcome the undesired glitch. However, for an eight delay 
stages DLL-based clock generator, this architecture needs 
four-pairs of PFD-CPs to generate whole number of 
multiplication factors. The additional PFD-CPs increases the 
chip area. 
In this paper, a DLL-based clock generator using a 
feedback switching detector is proposed. With the proposed 
feedback switching detector, the clock generator generates 
eight-type multiplication factors without undesired glitch and 
chip area overhead. Additionally, we improve the lock 
controller [7] to apply in feedback stage switching architecture. 
The lock detector not only enlarges locking range, but also 
achieves fast locking. Besides, we use pulse reshaper circuit [3] 
to reduce the static phase error to maintain the jitter 
performance of output signal in wide operating frequency 
range and speed-up the lock time. 
The paper organization is shown below. The architecture 
of the proposed clock generator is introduced in next section. 
Feedback switching detector and other control circuits are 
shown in third section. The forth section contains the 
remaining circuits. The measurement results and conclusion 
are presented in final part of this paper. 
II. ARCHITECTURE OF THE DLL-BASED CLOCK 
GENERATOR
The conventional DLL based clock generator structure is 
shown in Fig. 1. The DLL based clock generator uses edge 
combiner to produce the multiplied output signal and 
frequency multiplication factor of the DLL-based clock 
generator is determined by the number of delay cells [1]. The 
equivalent delay can be changed by switching the feedback 
stage from one delay stage to another. Therefore, the output 
frequency will be changed to another multiplication factor 
consequently. However, direct switching between different 
feedback stage will causes the undesired glitch shown in Fig. 
2. The appearance of the undesired glitch confuses the 
operation of the PFD and may let the system failed [4].  
One approach to solve the undesired glitch is using the 
multi-PFD-CPs architecture [4]. The system chooses the 
corresponding PFD/CP for each multiplication factor 
accordingly. However, use multi-PFD-CPs architecture will 
increase the chip area. For an eight delay stages DLL-based 
clock generator, this architecture needs four-pairs of PFD-CPs 
to generate whole number of multiplication factors. It will 
increase the chip area load. In order to solve the undesired
glitch in conventional architecture and to avoid increased chip 
area load in multi-PFD-CPs architecture, we propose a 
feedback switching detector to assist the DLL-based clock 
101978-1-4244-6471-5/10/$26.00 c©2010 IEEE
The fundamental idea is, when the VCDL delay time 
exceeds the safety range (S ~ 3S), the upper signal will 
activate to control the CP and charge to decrease the delay 
time of VCDL, and vice versa. The active signal will turn on 
when VCDL delay time in the safety range and the system 
will perform the normal DLL loop operation. 
We use B2, B4, and B6 signals to gauge the VCDL delay 
time when feedback signal of the DLL is 7
th
 or 8
th
 delay stage 
output signal, And B2, B3, and B4 are used when feedback 
signal of the DLL is 5
th
 or 6
th
 delay stage output signal. The 
operating range of the modified lock detector is presented in 
Table II. 
D Q
Clk
Q
D Q
Clk
Q
D Q
Clk
Q
Ref
B2 Upper
Active
Lower
0
1
0
1
B4
B4
B3
B6
Set_Upper
Set_Lower
D Q
Clk
Q
D Q
Clk
Q
D Q
Clk
Q
Feedback_signal
Q1
Q2
Q3
Fig. 5: Modified lock detector 
TABLE II. The operating range of the modified lock detector  
C. Feedback Stage Detector 
In order to avoid switching glitch, we propose a new 
circuit called feedback switching detector. The architecture of 
this circuit is shown in Fig. 6. The multiplication factor 
controller generates the enable signal Ei to let the system 
know which delay stage output signal is the feedback signal of 
the DLL. The operation waveform of the feedback stage 
detector is shown in Fig. 7. For example, when E5 signal 
falling, no matter what Ei signal is turn on, we know that the 
number of used VCDL stages will increase. Under the same 
reference period, increase the number of used delay stages, the 
DLL must to charge and decrease the delay time of each used 
delay stage. So, the feedback stage detector turns on the 
set_upper signal to GFLD and thus controls system to charge.  
The proposed feedback switching detector let the DLL-
based clock generator can generate whole number of 
multiplication factors and avoid the area-hunger multi-PFD- 
CPs architecture. The proposed DLL-based clock generator 
can reduce the chip area (compared to the multi-PFD-CPs 
architecture) and perform the DLL feedback signal switching 
application. Because of the pre-charge and pre-discharge 
mechanical of the feedback switching detector, the DLL-based 
clock generator can speed-up its operation. 
IV. REMAINNING CIRCUITS IMPLEMENTATION
The remaining circuits in our DLL-based clock generator 
are including of PFD, CP, loop filter and VCDL. The DLL is a 
first-order system in nature, so the loop filter in DLL is just a 
capacitor. In order to employ the control signals, we must 
modify the architecture of PFD. Furthermore, the DLL must 
lock in a wide Vctrl voltage range for the clock generator can 
generates wide frequency range output clock signal. However, 
when Vctrl is working in a wide voltage range, the CP current 
mismatch is inevitable. The CP current mismatch will bring 
about DLL system¶s static phase error when DLL locked and 
it worsens the output clock jitter performance. We use the 
pulse reshaper circuit [3] to modify the characteristic plot of 
PFD-CP to reduce the static phase error when DLL locked. 
In Out R
In Out F
F
F
R
E5
E6
E8
0
1Ref
D Q
Clk
Q
F
F
R
E8
E7
E5
0
1Ref
D Q
Clk
Q
E7
E6
Set-upper
Set-lower
Fig. 6: Feedback stage detector 
E5
Ref
Set_upper
Set_lower
Fig. 7: The operation waveform of feedback stage detector 
A. Modified PFD 
The modified architecture of PFD is shown in Fig. 8. The 
dynamic logic style PFD is adopted to avoid the dead-zone 
problem and improve the operating speed. We just modified 
the active control to the input stage because the PFD is a 
rising edge trigger circuit, other parts of the PFD is the same 
with the PFD in [7]. Controlled by LD, PFD enables a DLL 
to operate at a wider locking range with a help of modified 
lock detector than a DLL that includes a conventional PD, by 
having a correct phase capture range of S ~ 3S. The 
characteristic plot of PFD, CP and LF shows both linear and 
binary characteristics depending on the control signals from 
the modified lock detector, thereby achieving low jitter and 
fast locking speed simultaneously [7]. The extended work 
range of PFD in all kinds of DLL feedback signal conditions 
is listed in Table II. 
B. CP, VCDL, and Pulse reshaper 
The differential, current mode CP [5] is suitable in high-
speed operation. For low power consideration, the current-
starved inverter delay stage is suitable for this design. The 
pulse reshaper [3] will reshape the UP/DOWN pulse when the 
REF and VCDL become closer in the designed phase 
difference, the pulse RUP or RDOWN activated by the late 
signal has an increasing voltage value like a glitch. This action 
will strengthen the phase leading signal effect in CP. The gain 
in the middle of the characteristic plot of PD-CP will be 
increased. The little high gain range that cross the CP current 
2010 18th IEEE/IFIP International Conference on VLSI and System-on-Chip (VLSI-SoC 2010) 103
 [58] Ro-Min Weng, Chun-Yu Liu, Ming-Hui Liang, and Yue-Fang Kuo, “A 192MHz to 
1.946GHz programmable DLL-based frequency multiplier for RF application,” in Proc. of 
IEEE International Conference on Consumer Electronics, Jan. 2007, pp. 1-2. 
[59] K. Chung, J. Koo, S.-W. Kim, and C. Kim, “An anti-harmonic, programmable DLL-based 
frequency multiplier for dynamic frequency scaling,” IEEE Asian Solid-State Circuits 
Conference, Nov. 2007, pp. 276-279.  
[60] “Enhanced Intel speedstep technology for the Intel Pentium M processor,” Intel white paper, 
March 2004. 
[61] K. Jabeom, et al., "A Low-Power Programmable DLL-Based Clock Generator With 
Wide-Range Antiharmonic Lock," Circuits and Systems II: Express Briefs, IEEE 
Transactions on, vol. 56, pp. 21-25, 2009 
[62] H. Chiueh, et al., "A dynamic thermal management circuit for system-on-chip designs," in 
Electronics, Circuits and Systems, 2001. ICECS 2001. The 8th IEEE International 
Conference on, 2001, pp. 577-580 vol.2. 
[63] H.-H. Chang, J.-W. Lin, C.-Y. Yang, and S.-I. Liu, “A wide-range delay-locked loop with a 
fixed latency of one clock cycle,” IEEE J. Solid-State Circuits, pp. 1021-1027, Aug. 2002. 
[64] R. Schreier and G. Themes, Understanding Delta-Sigma Data Converters. 
Piscataways,NJ:IEEE Press,2005 
[65] P. Crombez, G. Vander Plas ,M. Steyaert and J.and Craninckx, “A single-Bit 500 
kHz-10MHz Multimode Power-Performance scalable 83-to-67dB DR CT ∆Σfor SDR in 
90nm Digital CMOS,” IEEE J.Solide-State Circuit,vol.45, N0. 6,June 2010, pp 1159-1171 
[66] P. Crombez, G. Van der Plas, M. Steyaert, and J. Craninckx, “A single bit 6.8 mW 10 MHz 
power-optimized continuous-time with 67 dB DR in 90 nm CMOS,” in Proc. IEEE ESSCIRC, 
Sep. 2009, pp 336–339. 
[67] SIMULINK and MATLAB USER Guides, The Math Works,Inc., Natick,MA,1997 
[68] P. Malcovati et al., “Behavioral modeling of switched-capacitor sigma–delta modulators,” 
IEEE Trans. Circuits Syst., vol. 50, no. 3, pp. 352–364, Mar. 2003. 
[69] H. Zare-Hoseini,I. Kale, and O. Shoaei. “Modeling of switched– capacitor delta– sigma 
modulators in SIMULINK”, IEEE TIM, vol. 54, No. 4, August 2005. 
[70] H. Spence Jackson, “Circuit and Method for Cancelling Nonlinearity Error Associated with 
Component Value  mismatches in a Data Converter”, U.S. Patent 5,221,926, June 1993, 
Filed Jul. 1,1992. 
[71] G. Themes, “Finite amplifier gain and bandwidth effects in switched-capacitor filters,” IEEE 
J.Solid-State Circuits, vol. 15, pp.338-361,June,1980 
[72] D. Johns and K. Martin, Analog Integrated Circuit Design. New York: Wiley, 1997. 
[73] “OpenRISC 1200 IP Core Specification” Rev. 0.7, Sep 6, 2001. 
[74] “OpenRISC 1000 Architecture Manual “July 13, 2004. 
92
99 年度專題研究計畫研究成果彙整表 
計畫主持人：闕河鳴 計畫編號：99-2220-E-009-032- 
計畫名稱：具生物反餽機制之智慧型長時睡眠監測系統--子計畫二：多重生理訊號分析與硬體實現
(2/2) 
量化 
成果項目 實際已達成
數（被接受
或已發表）
預期總達成
數(含實際已
達成數) 
本計畫實
際貢獻百
分比 
單位 
備 註 （ 質 化 說
明：如數個計畫
共同成果、成果
列 為 該 期 刊 之
封 面 故 事 ...
等） 
期刊論文 0 0 100%  
研究報告/技術報告 0 0 100%  
研討會論文 0 0 100% 
篇 
 
論文著作 
專書 0 0 100%   
申請中件數 0 0 100%  專利 已獲得件數 0 0 100% 件  
件數 0 0 100% 件  
技術移轉 
權利金 0 0 100% 千元  
碩士生 5 6 100%  
博士生 2 3 100%  
博士後研究員 0 0 100%  
國內 
參與計畫人力 
（本國籍） 
專任助理 0 0 100% 
人次 
 
期刊論文 0 0 100%  
研究報告/技術報告 0 0 100%  
研討會論文 2 0 100% 
篇 
 
論文著作 
專書 0 0 100% 章/本  
申請中件數 0 0 100%  專利 已獲得件數 0 0 100% 件  
件數 0 0 100% 件  
技術移轉 
權利金 0 0 100% 千元  
碩士生 0 0 100%  
博士生 0 0 100%  
博士後研究員 0 0 100%  
國外 
參與計畫人力 
（外國籍） 
專任助理 0 0 100% 
人次 
 
國科會補助專題研究計畫成果報告自評表 
請就研究內容與原計畫相符程度、達成預期目標情況、研究成果之學術或應用價
值（簡要敘述成果所代表之意義、價值、影響或進一步發展之可能性）、是否適
合在學術期刊發表或申請專利、主要發現或其他有關價值等，作一綜合評估。
1. 請就研究內容與原計畫相符程度、達成預期目標情況作一綜合評估 
■達成目標 
□未達成目標（請說明，以 100 字為限） 
□實驗失敗 
□因故實驗中斷 
□其他原因 
說明： 
2. 研究成果在學術期刊發表或申請專利等情形： 
論文：□已發表 □未發表之文稿 □撰寫中 ■無 
專利：□已獲得 □申請中 ■無 
技轉：□已技轉 □洽談中 ■無 
其他：（以 100 字為限） 
3. 請依學術成就、技術創新、社會影響等方面，評估研究成果之學術或應用價
值（簡要敘述成果所代表之意義、價值、影響或進一步發展之可能性）（以
500 字為限） 
本計畫針對多重生理訊號提出一個硬體平台架構及其對應之訊號處理晶片系統設計，以用
於臨床 
上的異常事件偵測及其即時分析，並提供長時多重生理訊號之記錄，以便於事後之分析與
病症之 
判讀。在臨床醫學上，生理訊號是診斷、照護、治療的重要依據，腦電波、肌電圖、眼電
圖可辦 
別睡眠時期，心電圖可以監控自主神經並反應出生活緊張狀態，鼻孔、胸部與腹部的感測
器可評 
估呼吸節率，血氧計評估血中含氧濃度，麥克風評估打呼情形等。目前生理記錄大多依靠
醫護人 
員判讀，然在急診室、加護病房、嬰兒室與長期照護中心，具有大量患者與患者生理狀態
變化快 
速且變異度大的特性，可靠的即時生理異常示警裝置將能在定時的照護程序外，讓患者在
突發狀 
況可及時獲得有效的緊急照護。同時，長時多重生理訊號的紀錄與分析，也對於許多特定
的病症 
有重要的意義。因此大量的使用於睡眠障礙分析、癲癇外科治療的輔助定位等。本計畫所
提出之 
