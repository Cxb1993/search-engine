I 
 
目錄 
 
目錄...................................................................................................................................................... I 
摘要................................................................................................................................................... III 
ABSTRACT ...................................................................................................................................... IV 
1. 緒論................................................................................................................................................ 1 
1.1 研究背景與動機...................................................................................................................... 1 
1.2 研究目的.................................................................................................................................. 1 
2. 文獻探討........................................................................................................................................ 2 
2.1 入侵偵測系統.......................................................................................................................... 2 
2.2 IDS技術 .................................................................................................................................... 2 
2.3 KDD99資料集 .......................................................................................................................... 3 
2.4 資料探勘.................................................................................................................................. 4 
2.4.1 分類技術........................................................................................................................... 4 
2.4.2 分類評估方式................................................................................................................... 5 
2.5 不平衡資料集.......................................................................................................................... 6 
2.6 特徵選取................................................................................................................................ 11 
2.6.1 ReliefF演算法.................................................................................................................. 11 
2.6.2 BMR演算法 ..................................................................................................................... 12 
2.7 可適式回饋機制演算法........................................................................................................ 13 
2.8 集成系統................................................................................................................................ 14 
2.8.1 集成系統之原理............................................................................................................. 14 
2.8.2 集成系統之架構............................................................................................................. 14 
2.9 結語........................................................................................................................................ 14 
3. 整合式不平衡學習演算法與實驗分析...................................................................................... 16 
3.1 演算法概念............................................................................................................................ 16 
3.2 中位數平衡化取樣機制演算法............................................................................................ 17 
3.3 整合式不平衡學習演算法.................................................................................................... 18 
3.4 實驗設計與分析.................................................................................................................... 19 
3.4.1 實驗架構設計................................................................................................................. 19 
3.4.2 結合BMSMA演算法與AFMA演算法之實驗 .............................................................. 20 
3.4.3 結合BMSMA演算法與ReliefF演算法之實驗 .............................................................. 20 
3.4.4 IILA演算法之實驗.......................................................................................................... 21 
4. 基於IILA之集成演算法與實驗分析.......................................................................................... 27 
4.1 演算法概念與設計................................................................................................................ 27 
4.2 實驗設計與分析.................................................................................................................... 29 
4.2.1 各類別IILA演算法之實驗............................................................................................. 29 
4.2.2 基於IILA之集成演算法之實驗..................................................................................... 30 
III 
 
摘要 
 
    入侵偵測系統在資訊安全領域當中扮演著防堵非法入侵的重要角色。應用資料探勘技術
建構入侵偵測系統，可透過其學習演算法從資料中自動學習分類規則，有效減少人力分析的
重擔。然而，資料探勘型的入侵偵測系統發展至今仍存在著許多挑戰待克服，如不平衡資料
集、多類別不平衡、對新型態攻擊的偵測與不當的特徵選取等問題。本研究逐步提出「中位
數平衡化取樣機制演算法(BMSMA, Balanced Median-based Sampling Mechanism Algorithm)」
和「整合式不平衡學習演算法(IILA, Integrated Imbalanced Learning Algorithm)」，以整合取
樣機制和特徵選取等處理多種不平衡資料集的方法，逐步提升分類效能。最後，整合上述兩
種演算法並運用集成系統之優點，提出「基於 IILA之集成演算法(IILA-Based Ensemble 
Algorithm)」，以進一步結合各方法之優勢來強化分類模型及其效能。本論文採用KDD99資
料集為資料來源，並利用PolyAnalyst、Weka軟體和Java語言建構本論文所提出之演算法和實
驗環境，進行演算法之分類效能驗證實驗。實驗結果證實，本論文所提出之演算法能夠降低
入侵偵測系統的計算負荷，並有效提升對U2R攻擊類別的分類效能，同時強化網路異常入侵
偵測系統的整體分類效能。 
 
關鍵字：入侵偵測、資料探勘、不平衡資料集、集成系統。  
1 
 
1. 緒論 
 
1.1 研究背景與動機 
資訊科技的日新月異與網際網路蓬勃發展下，資訊科技已深入個人食衣住行育樂各個生
活層面，並成為現代人不可或缺的生活必需品，帶給忙碌的現代人許多便利。然而，在我們
享受這些資訊科技所帶來的便利之餘，應該要有基本且重要的認知，那就是如果沒有堅強的
資訊安全為基礎，一旦仰賴的資訊設備遭受到有心人士或駭客的入侵時，除了造成個人財產
與隱私受損，公司商譽與企業形象受損更是金錢無法衡量的；更甚著造成國家機密資訊外
洩，將嚴重影響國家安全。所以我們應該體認到資訊安全的重要性，並正視非法入侵的問題
與所帶來傷害。 
入侵偵測系統(IDS, Intrusion Detection System)是現今防護組織內部資訊安全的重要設
施，其主要功用在監控特定環境之網路活動，並利用系統內資訊來判斷這些活動為合法或可
疑的行為。入侵偵測系統會收集有關於系統觀察到的資訊，所收集到的稽核紀錄將被偵測器
所處理，接下來偵測器將評估這些稽核紀錄中不確定的資訊，並決定這些活動為入侵行為的
可能性[1]。在網路安全領域中，入侵偵測系統已成為重要的研究方向，入侵偵測系統猶如網
路監控及警報裝置，能在入侵行為造成危害前即時發出警訊以進行相關反應措施，防範系統
遭致破壞[2]。 
 
1.2 研究目的 
資料探勘（Data mining）是近年來最熱門且發展迅速的學門。將資料探勘技術應用於入
侵偵測系統，其學習演算法不僅可降低分析大量網路流量所造成的人力負擔外，且能從資料
中自動取得入侵的規則與特徵，並據以比對與分析異常行為，如此一來可取代傳統方法多仰
賴於專家知識的問題。 
資料探勘型之入侵偵測系統是近年來成功應用於資訊安全的技術，多項研究均證實資料
探勘技術能有效提升入侵偵測系統的效能[3-8]。然而，發展迄今仍不免存在著許多問題待克
服，因此，本研究的目的在針對資料探勘型之入侵偵測系統提出有效的演算法機制，希望能
提升網路異常入侵偵測之分類效能，防堵非法與惡意入侵行為，強化整體資訊安全防護能力。 
3 
 
利用狀態轉移的觀點來描述目的事件的分析工具，常用來建立誤用偵測型入侵
偵測系統。 
六、資料探勘 
利用資料探勘與機器學習的技術可以有效的將資料分類，減少不必要的資料比
對，並能產生新的規則來偵測未知的入侵行為，因此成為近年來應用於入侵偵測系
統相關研究最廣泛的技術，適用於誤用、異常或混合型偵測型入侵偵測系統。 
七、其他技術 
其他還有學者提出應用類免疫系統（Artificial Immune Systems）在網路上偵測
入侵行為，另外還有結合模糊理論與軟性計算的新型入侵偵測方法[1]。 
    近年來各種研究大都注重在應用資料探勘與機器學習的技術來提升入侵偵測系統效能
[10]，雖然已經有多項研究均成功證實資料探勘型之入侵偵測系統具有卓越的偵測效能
[3-8]，然而，發展迄今仍不免存在著許多問題待克服，因此，本研究主要針對資料探勘型之
入侵偵測系統進行研究，希望能提升異常入侵偵測之分類效能，以強化整體資訊安全防護能
力。 
 
2.3 KDD99資料集 
    KDD99資料集（KDD Cup 99 dataset）是目前最著名的入侵偵測系統資料集，也最常被
用來驗證入侵偵測系統效能之基準(Benchmark)，KDD Cup 99 資料集的每一筆連線紀錄包含
了 41 種特徵(Features)，並且標示為正常或攻擊種類，資料集中每一筆資料依據攻擊種類來
區分以下五種類別(Class)： 
一、 Probe： 
利用正常的網路連線行為，來嘗試取得特定主機的各類資訊，此類行為並不能
算是攻擊行為，而是在為後續的攻擊行為做試探的動作。 
二、 DoS (Denial of Service)： 
利用對目標主機要求大量的網路服務，或者進行大量而錯誤的連線動作，使得
受攻擊主機忙於處理這些大量、不正常或偽裝的連線，導致無法對其他正常使用者
提供服務，甚至造成該主機因消耗過多資源而當機。 
三、 R2L(Remote to Local)： 
R2L通常是指攻擊者利用目標主機某些網路服務的弱點，企圖取得主機最高權
限的攻擊行為。 
四、 U2R(User to Root)： 
U2R 通常是指攻擊者已擁有目標主機的使用者權限，並企圖取得主機最高權
限。 
五、 Normal：為正常之網路行為。 
    KDD Cup 99 資料集可分成訓練與測試資料集，在訓練資料集中大約有五百萬筆紀錄，
本論文採用 10%的訓練資料集計 494,021筆，測試資料集計 311,029筆。 
  值得一提的是，現今之入侵偵測系統針對正常行為、DOS 攻擊和 Probe攻擊等都有極高的
偵測率，但是在 U2R 攻擊和 R2L 攻擊等極少數類別卻無法有效識別，然而這兩個類別卻是
入侵行為中最危險的，因此本研究希望能夠提升 U2R 攻擊之偵測率，以強化入侵偵測系統
5 
 
建立出分類模型的能力。若能將測試資料集的類別分得越準確，就代表分類模型的效能越高。 
    在訓練分類模型時，值得注意的是過度學習(Over-Fitting)的現象。分類模型的錯誤一般
可分為訓練錯誤(Training Errors)與泛化錯誤(Generalization Errors)等兩類，訓練錯誤就是指訓
練樣本被錯誤分類的數量，而泛化錯誤就是模型對於未知樣本的預測錯誤。一個好的分類模
型不僅要與訓練資料相符，也要能準確地分類未訓練過的樣本，換句話說就是要有低的訓練
錯誤與泛化錯誤，這點對於分類模型相當重要，這是因為若是分類模型與訓練資料太過相符
將會出現較差的預測能力。 
 
 
圖2.2 分類模型訓練流程[12] 
 
2.4.2 分類評估方式 
分類模型的良莠將直接影響分類的效能，因此如何評估分類模型就成為分類問題中相當
重要的一環。分類效能評估的概念在於利用測試資料集被分類模型正確分類與錯誤分類的數
量來決定，也就是常見的分類矩陣(Confusion Matrix)之概念，如表 2.3 所示。表中每一列代
表資料集真正的類別，每一行則代表分類模型所預測的類別，少數類別通常以正類來代表，
多數類別以反類代表，因此 True Positive 代表分類模型將原本屬於正類的樣本正確的預測為
正類之數量，False Positive 代表分類模型將原本屬於反類的樣本錯誤的預測為正類之數量，
False Negative 代表分類模型將原本屬於正類的樣本錯誤的預測為反類之數量，True Negative
代表分類模型將原本屬於反類的樣本正確的預測為反類之數量[11]。 
 
表2.1 兩類問題之分類矩陣 
 
Predicted Class 
Positive Negative 
Actual Class 
Positive 
True Positive 
(TP) 
False Negative 
(FN) 
Negative 
False Positive 
(FP) 
True Negative 
(TN) 
     
7 
 
可以顯示出分類器的效能，然而若是用在不平衡資料集的情況下，將造成不良的影響。
以癌症篩選為例，假設有 100 筆病歷資料，其中 99 筆為正常病患，1 筆為癌症病患，
如果我們以準確率做為評估指標，如此分佈傾斜的病歷資料將形成不平衡資料集的問
題，分類器將傾向於分類多數為(正常)類別，雖然最後準確率為 99%，然而最重要的
1%癌症病患卻無法被正確地篩選出來。即使分類器之整體準確率高達 99%，這樣高準
確率的分類器在實際應用上依然對我們毫無意義，也就是說此分類器無法達到應有的
分類預測結果，也因此不當的評估指標對於不平衡資料集的問題來說，將會增加少數
類別分類的困難。 
二、 資料缺少問題： 
資料缺少又可分作絕對缺少和相對缺少等兩種，絕對缺少代表在資料集中，少數
類別的樣本數量十分稀少，因此在進行資料探勘時將難以發掘其分類規則，甚至很有
可能被視作為雜訊，因此造成分類不易或分類錯誤，另外也容易造成過度學習的現象；
相對缺少則代表少數類別的樣本實際數量不少，只是占全部資料集中的比例相對較
小，一般分類演算法在推論時將傾向於多數類別，而導致少數類別識別更加不易的問
題。 
三、 數據分裂問題 
許多資料探勘中的演算法是採用分治法 (Divide-and-Conquer)的概念，也就是將問
題依照規則或特徵逐一分解成越來越小的問題，也因此少數類別在分解的過程中將越
來越少，反而會造成樣本數更加稀少而分類不易，這也就是數據分裂會加劇不平衡資
料集的問題。 
四、 歸納偏移問題 
資料探勘在訓練過程中進行推論與歸納時，往往會存在著一種額外的偏移，許多
分類演算法利用這種偏移效果來實現分類器的泛化能力而避免過度學習的現象，但是
歸納偏移會產生有利於多數類別的偏移，而對少數類別樣本不利，而進一步造成不平
衡資料集分類不易的問題。 
五、 雜訊(Noise)問題 
在資料集中多餘的雜訊對少數類別的影響往往較普通類別來的大，因為少數類別
之樣本稀少，因此少量的雜訊將足以使分類演算法難以區分少數類別，而無法找到準
確的規則，影響分類效能。另外，若分類演算法有採用防止過度學習的技術去除雜訊
時，則可能會將少數類別同雜訊一起刪除，但若不去除雜訊，分類效果也難以提升，
因此雜訊的問題將嚴重影響不平衡資料集的分類。 
六、 多類別(Multiclass)不平衡問題 
在大部分的不平衡資料集中，除了不同類別之樣本數量差距很大，而影響分類效
能的情形以外，另外也可能存在者多類別不平衡的問題。有些分類演算法無法直接處
理多類別的問題，例如支持向量機(Support Vector Machine)，因此往往必須將多類別的
問題分解成多個兩類問題來解決，但是在不平衡資料集中，卻可能使樣本的分佈變成
更加傾斜，而使不平衡的問題加劇。現今的相關不平衡資料的研究均只著重於兩類-多
數類別和少數類別的問題，但是在真實環境的分類問題中卻通常為多類別(三類以上)
的資料集 [13]，這點從著名的 UCI 資料庫 (UCI Repository for Machine Learning 
9 
 
表2.2 多類別平衡化之Satimage資料集[15] 
類別 
原始資料數
量 
SMean MMean SMedian SMedian 
Class 1 1533 1073 1466 1033 1508 
Class 2 703 1073 679 1033 703 
Class 3 1358 1073 1466 1033 1508 
Class 4 626 1073 679 1033 703 
Class 5 707 1073 679 1033 703 
Class 6 1508 1073 1466 1033 1508 
總和 6435 6438 6435 6198 6633 
 
        以KDD99 10%訓練資料集之入侵偵測為例來說，其資料集分佈差距十分懸殊，DOS
類別樣本數計391,458個，U2R類別樣本數計52個，兩者相差7,528倍，採用上述方法後的資
料分佈如表2.5所示，以該文獻所提效果最好之SMean來說，U2R類別將從52個複製到98,804
個，其樣本過於單調，將導致所建立之分類模型產生過度學習，而大幅降低偵測新型攻擊的
能力，因此不適用於類別差距過大之不平衡資料集。 
 
表2. 3 多類別平衡化之KDD99資料集 
類別 
 原始資料數
量 
SMean MMean 
SMedia
n 
SMedia
n 
Normal  97278 98804 25641 4107 247011 
DoS  391458 98804 391458 4107 247011 
Probe  4107 98804 25641 4107 1126 
U2R  52 98804 25641 4107 1126 
R2L  1126 98804 25641 4107 1126 
總和  494021 494020 494022 20535 497340 
 
    因此，在進行入侵偵測系統之研究時，除了考量不平衡資料集的問題時，也應設法改善
多類別不平衡的問題，如此方能有效提升系統之整體分類效能。此外，若是以取樣方式增加
少數類別之樣本數量時，應特別注意過度學習的現象，以避免降低新型態攻擊的偵測能力，
而影響入侵偵測系統的效能。 
綜上所述，若不考量不平衡資料集所帶來之問題，所建立出來的分類器將傾向於多數類
別的分類，而忽略少數類別，因此必須尋求改善不平衡資料集的方法，目前相關技術可歸納
出以下幾類[18,19]： 
一、 取樣(Sampling) 
取樣是處理不平衡資料集最常用的方法，其主要概念就是藉由改變各類別樣本的
分佈情形，以降低或減小資料集傾斜或不平衡的問題，依方法又可分為降低取樣
(Under-sampling) 與過度取樣(Over-sampling)等兩類。降低取樣主要是將多數類別之樣
本透過隨機取樣、分群或是資料集切割的方式選取其中較少之樣本數量，藉以縮小不
平衡之差距；而過度取樣則是將少數類別之樣本透過隨機複製的方法來增加數量，但
11 
 
此僅訓練單一重要類別的資料集來建立分類器，但是此一忽略其他類別之方法，其獲
得之分類效果往往無法保證。 
五、 特徵選取(Feature Selection) 
當資料集之樣本分佈出現不平衡的情況下，特徵的分佈同樣也是不平衡的分佈，
也就是說對於多數類別而言的重要特徵，可能在少數類別卻完全不具代表性，若選用
這些特徵來訓練分類器，所產生之分類器也將無法識別出少數類別，因此若能選擇關
鍵之重要特徵，將有助於提升不平衡資料集的分類效能。 
六、 集成系統(Ensemble System) 
集成系統的概念來自於不同的演算法對於某些分類問題或類別有較強的分類能
力，因此將多個分類器組合成最終預測模型，可用以提升分類效能。 
     
2.6 特徵選取 
    特徵選取在資料探勘中扮演重要的角色，其目的就是希望能在全部的特徵中，選出其中
對預測有幫助的重要特徵子集，並用以建立更加準確的分類模型 [26] 。特徵選取一般可分
為Filter與Wrapper兩種方法。Filter方法主要目的是將每個資料利用本身獨有的特徵，分別去
計算其權重值，經由特徵集合中挑選出權重值較高的特徵子集合作為訓練資料，常見Filter
方法有Information Gain 、ReliefF 、Gain ratio、Chi-Square 。Wrapper方法是藉由最佳化演
算法來計算特徵子集合，常見Wrapper的方法有基因演算法(GA, Genetic Algorithm)和粒子族
群最佳化演算法(PSO, Particle Swarm Optimization)等[27]。 
    然而，許多特徵選取研究的缺點在於未將資料分佈不平衡的狀況考量在內。特徵選取對
不平衡資料集影響甚大，因為如果資料分佈嚴重傾斜，若要使少數類別準確率提高，就必須
選擇少量類別的重要屬性，才可將多數類別與少數類別分開[19]。因此，近年來逐漸有學者
開始針對特徵選取與不平衡資料集做研究，文獻[26]也主張應將資料分佈偏差的情形考量在
內作特徵選取，並進一步針對有偏差的樣本分佈資料集(即不平衡資料集)提出屬於Filter方法
的Balanced Minority Repeat (BMR)演算法來結合ReliefF特徵選取。ReliefF與BMR演算法分述
如下：  
 
2.6.1 ReliefF演算法 
    ReliefF是一種最常見的Filter特徵選取演算法，大部分應用於資料探勘與機器學習之Filter
特徵選取方法都假設特徵之間有條件的獨立，而ReliefF並不假設特徵之間彼此獨立，因此能
正確地估計特徵與特徵之間的依賴關係強弱，演算法如圖2.7所示。 
 演算法一開始將所有特徵之權重設為0，然後隨機從樣本空間中選取一個樣本Xi，對隨機
樣本Xi來說，可以找到k個距離樣本Xi最近之同類別樣本，稱之為Nearest Hits(以Hj表示)，另
外可找到k個距離樣本Xi最近之不同類別樣本，稱之為Nearest Misses (以Mj(C)表示)，接下來
更新隨機樣本Xi每一個特徵之權重值，演算法重複執行m次(m可以是使用者預設之參數或等
於資料集的樣本個數)。 
演算法用方程式(2.8)來計算權重值，方法是簡單且直觀的，以隨機樣本的每個特徵來
看，若Xi的特徵與在Hj樣本中的相同特徵有不同的數值，則演算法將此特徵視為不可取，並
從權重值中減去兩者之差距。其意義為：若兩個不同類別的樣本，其同一特徵之數值不相符，
13 
 
    特徵選取對於資料探勘型之入侵偵測系統而言十分重要，因為網路流量龐大，透過特徵
選取除了減少偵測時間與成本，多項研究實驗並證實可進一步提升分類準確率 [28-30]，文
獻[6]也特別指出特徵選取是入侵偵測未來重要研究方向之一。除此之外，在進行入侵偵測系
統之特徵選取研究時，也應進一步將不平衡資料集的問題考量在內，方能有效提升入侵偵測
之分類效能。 
 
Input:    A training set with m instances  
Output: W[] the weight values for all attributes 
1.                        build majority ＆ minority subsets from D 
2.            # of instances in           
3.            # of instances in           
4. S1, S2,…, Sn   randomly split           into N subsets with  
            N =  
         
         
  and           = S1 S2 … Sn 
5. For each subset i = 1 to n 
6.         = Si            
          Apply ReliefF to the     
For each attribute  j = 1 to n 
W[j]   W[j] +       
7. Return (W[])  
圖2.4 BMR演算法[26] 
     
2.7 可適式回饋機制演算法 
    文獻[11]提出可適式回饋機制(AFMA, Adaptive Feedback Mechanism Algorithm)來強化特
定少數類別之偵測率，並實驗證實可提升入侵偵測系統之效能，其基本概念簡述如下： 
    建置原始訓練模型後，選定該模型Recall值不佳之類別，將該類別所分類錯誤的資料集
篩選出來回饋增加至訓練資料中，再次迭代(Iteration)的訓練，以強化該誤判類別之辨識率，
演算法如圖2.9所示。 
     
步驟一： 模型訓練：使用訓練資料訓練特定資料探勘分類模型，如：決策樹、類
神經網路、分群演算法等。 
步驟二： 驗證模型：以驗證資料驗證該訓練模型，並記錄各類別捕捉率。 
步驟三： 選定回饋類別：選定訓練模型產生最差捕捉率之類別項目。 
步驟四： 回饋誤判資料：將該類別分類錯誤資料集回饋至訓練資料，重複訓練新
的訓練模型，以強化回饋類別之辨識率。 
步驟五： 判定訓練終止條件：重複步驟一至四，直到符合訓練終止條件。亦即：
該回饋類捕捉率(Recall)到達100%，或已發生過度學習現象。 
圖2.5 可適式回饋機制演算法[11] 
15 
 
  
圖2.6 集成系統架構圖 
 
一般的入侵偵測系統對於已知的攻擊類別雖然有低誤警率與高偵測率的優異
表現，然而卻無法有效偵測未知攻擊或新型態攻擊，並且容易出現大量的錯誤警
報，致使資安防護出現死角。 
三、 未考量不平衡資料集問題[8,11,33,34] 
在入侵偵測的資料中，各類別之間的樣本數量分佈懸殊，其中正常與 DOS 攻
擊的樣本數量占絕大多數，而其他攻擊類別僅占一小部分，也就是存在者不平衡
資料集與多類別不平衡資料集的問題。許多研究證實，一般的分類演算法無法對
這兩類資料集發揮效能，將導致分類重點集中在多數類別的樣本，而忽略少數樣
本的重要資訊，如此一來將無法偵測出少數重要的類別。 
四、 未考量特徵選取問題[6,8,28] 
特徵選取是建構入侵偵測系統的另一個挑戰，許多學習演算法隨著所採用的資
料集特徵不同，而有不同的學習效果，因此，特徵選取基本上可增進系統偵測的
準確率。此外，選用最佳的特徵子集合將可降低訓練的特徵數量，大幅減少系統
計算的成本，然而，現今基於資料探勘技術的入侵偵測系統的特徵選取階段，大
都採用專家知識或直觀來選擇特徵，缺乏有效及客觀的特徵選取方法。 
因此，本研究主要針對資料探勘型之入侵偵測系統進行研究，並進一步提出演算法改善
上述之問題，以提升網路異常入侵偵測之分類效能，防堵非法與惡意入侵行為，強化整體資
訊安全防護能力。 
17 
 
一來將造成重複取樣後之樣本過於單調，所推論規則將變得過於特定，而導致過度學習的現
象。針對以上各個演算法的優缺點，本研究首先提出「中位數平衡化取樣機制演算法(BMSMA, 
Balanced Median-based Sampling Mechanism Algorithm)」，此演算法之目的在透過取樣技術解
決樣本不平衡分布的問題，以提升重要少數類別的分類效能，然後進一步提出整合式不平衡
學習演算法，期能強化入侵偵測系統之分類效能。本章所提演算法中的符號如表3.1所示。 
 
表3.1 演算法符號定義與說明 
符號 定義 
D 原始訓練資料集 
D’ 平衡化之訓練資料集 
Ck 資料集中第k個類別 
xi 第i個樣本 
yi 第i個樣本之類別 
m 資料集中的類別數量 
Md 資料集中所有類別數量之中位數 
Si 原始訓練資料集中之第i個類別群組 
Si’ 平衡化之訓練資料集中第i個類別群組 
V 驗證資料集 
Learn 分類學習演算法 
M 最佳之分類模型 
M’ 錯誤回饋之分類模型 
Y 錯誤回饋類別 
W 錯誤分類樣本集 
n 訓練資料集之樣本數量 
p 特徵選取之百分比 
F 特徵空間 
 
3.2 中位數平衡化取樣機制演算法 
    BMSMA演算法之目的在結合SMOTE方法來解決不平衡資料集的問題，並改善SMedian
容易過度學習之問題，以重新平衡資料集樣本，演算法如圖3.1所示。 
    以KDD99資料集為例，因為資料集有5個類別，因此m=5， 則為            ，分別代
表DOS類別族群(樣本數量：391458)、Normal類別族群(樣本數量：97278)、Probe類別族群(樣
本數量：4107)、U2R類別族群(樣本數量：52)和R2L類別族群(樣本數量：1126)。步驟1為尋
找資料集中之中位數，也就是Probe類別族群之數量4107，接下來於步驟2時，檢查資料集中
每一個類別族群之樣本數量，若樣本數量大於中位數，則利用隨機降低取樣方法，將該類別
族群之數量取樣到和中位數一樣；若樣本數量小於中位數，則利用SMOTE演算法來創造新
的類別樣本，直到類別族群之數量和中位數一樣為止，如此一來，資料集中的每一個類別族
群之數量將相同(等於中位數)，最後可輸出平衡化之訓練資料集D’。  
19 
 
模型M’ 並取代原分類模型M’ ，再利用驗證資料集V對該分類模型實施驗證，並計算其Recall
值，然後檢查是否滿足Recall值為100%之終止條件，若不滿足條件則重複步驟3，並不斷更
新訓練資料集和分類模型，若滿足條件則代表已無特定類別Y被當下之分類模型M’錯誤分類
至其他類別的樣本，因此結束錯誤回饋階段，可得到最後之訓練資料集；接下來進入步驟4，
應用ReliefF演算法中之公式(2.1)對該訓練資料集計算出所有特徵之權重；接著於步驟5選取
特徵權重前p百分比之特徵，並加入至特徵子集合F；最後運用分類演算法針對訓練資料集D’
和特徵子集合F學習對於Y類別之最佳分類模型M。 
  
Input:  
1.            , i = 1, … , n;                    
2. V, Y, p, Learn 
Output: M 
Begin 
Step 1. Apply BMSMA in D, then output D’. 
Step 2. Apply Learn to train the initial M’ in D’. 
Step 3. Error feedback step,  
do { 
3.1 Select W by M’ : 
For i = 1 to n,  
If (yi = Y and M’(xi) ≠ Y) 
Add xj to W. 
End if 
End for 
3.2 Feedback W to D’ and update D’ : 
      D’ = D’ ∪ W 
3.3 Apply Learn in D’, then update M’.     
3.4 Apply M’ in V and calculate Recall. 
     } while ( Recall ≠ 100 %) 
Step 4. Apply ReliefF in D’ and calculate weight for each attribute. 
Step 5. Select top p% attributes to F. 
Step 6. Apply Learn in D’ with F to train M. 
End 
圖3.3 整合式不平衡學習演算法 
     
3.4 實驗設計與分析 
    為證實本論文所提出之演算法可用以提升異常入侵偵測分類效能，將針對傳統演算法、
BMSMA 演算法、AFMA 演算法與 ReliefF 演算法之個別或整合應用進行比較分析，最後進
行 IILA演算法之實驗，以驗證演算法之效能。 
 
3.4.1 實驗架構設計 
    本實驗採用KDD99入侵偵測系統資料集之一般研究常用之10% 訓練資料集計494,021筆
樣本(檔案名稱：kddcup.data_10_percent)，和包含新型態攻擊的測試資料集計311,026筆樣本
21 
 
選取實驗的部分，實驗結果如圖3.6所示，分別選用權重值排序前15、20、25、30、35與全部
41個特徵作比較。從圖中可看出，透過BMSMA演算法改善多類別不平衡問題後，再結合
ReliefF方法選取35個特徵訓練分類模型，可使U2R類別之Recall從13.27%略升至14.16%，證
實選用具代表性的特徵對分類問題有強化的效果，然而效果不如結合BMSMA演算法與
AFMA演算法。 
 
表3.3 結合BMSMA與AFMA演算法執行前後樣本分佈表 
資料集 
類別 
前 後 
Normal 97,278 2,016 
DOS 391,458 2,016 
Probe 4,107 2,016 
R2L 1,126 2,031 
U2R 52 2,016 
 
 
圖3.4 BMSMA與ReliefF在不同特徵數量的實驗結果統計圖 
 
3.4.4 IILA演算法之實驗 
第三部分實驗之目的在證實本研究所提出之IILA演算法可成功結合多種不同的演算
法，並可針對特定類別進行特徵選取以同時解決不平衡資料集、多類別不平衡與歸納偏移問
題，進一步證實演算法可有效提升U2R類別之分類效能，並建立可偵測新型態攻擊的分類模
型。 
    本實驗分類演算法同樣採用決策樹演算法，訓練資料集為KDD 99資料集的10%訓練資料
集樣本，最後同樣以測試資料集驗證分類模型之效能，評估指標除了採用Recall值以外，更
0.00% 
10.00% 
20.00% 
30.00% 
40.00% 
50.00% 
60.00% 
70.00% 
80.00% 
90.00% 
100.00% 
15 20 25 30 35 41 
R
ec
a
ll
(%
) 
特徵數量 
23 
 
 
圖3.6 IILA演算法各階段實驗結果統計圖 
 
 
 
 
 
 
 
 
圖3.7 IILA中AFMA演算法在不同特徵數量對Recall之效果 
0.00% 
10.00% 
20.00% 
30.00% 
40.00% 
50.00% 
60.00% 
70.00% 
80.00% 
90.00% 
100.00% 
0 1 2 3 Relief 
百
分
比
(%
) 
執行階段 
Recall Precision Accuracy F-measure G-mean 
0.00% 
10.00% 
20.00% 
30.00% 
40.00% 
50.00% 
60.00% 
70.00% 
80.00% 
90.00% 
100.00% 
15 20 25 30 35 41 
R
ec
a
ll
(%
) 
特徵數量 
BMSMA+Relief 
IILA 
25 
 
 
圖3.10 IILA中AFMA演算法在不同特徵數量對F-measure之效果 
 
  
圖3.11 IILA中AFMA演算法在不同特徵數量對G-mean之效果 
 
    經由圖3.9到圖3.13等五種衡量指標分析圖可看出，不同特徵數量的分類模型具有不同的
分類效能，而在特徵數量為20時，分類模型之整體分類效能較佳；此外，有結合AFMA演算
法之IILA演算法，其分類效能可獲得大幅度的提升。雖然在圖3.11中的Accuracy較低，但差
距僅不到0.5%，而且都保持在99.40%以上，但在Recall、Precision、F-measure與G-mean等評
量指標均明顯優於未結合AFMA之演算法，證實IILA演算法成功結合三種演算法機制，除了
改善各別多類別不平衡、不平衡資料集與歸納偏移問題外，並可針對特定類別進行特徵選
取，結合之後更可進一步達到最佳之分類效能。 
0.00% 
10.00% 
20.00% 
30.00% 
40.00% 
50.00% 
60.00% 
70.00% 
80.00% 
90.00% 
100.00% 
15 20 25 30 35 41 
F
-m
ea
su
re
(%
) 
特徵數量 
BMSMA+Relief 
IILA 
0.00% 
10.00% 
20.00% 
30.00% 
40.00% 
50.00% 
60.00% 
70.00% 
80.00% 
90.00% 
100.00% 
15 20 25 30 35 41 
 G
-m
ea
n
(%
) 
特徵數量 
BMSMA+Relief 
IILA 
27 
 
4. 基於IILA之集成演算法與實驗分析 
 
有鑑於本研究於第3章所提出之IILA演算法雖然可有效提升特定少數類別及新型態攻擊
之偵測率，但在整體的分類效能卻偏低，因此本研究結合IILA演算法和集成系統的原理，提
出基於IILA之集成演算法(IILA-Based Ensemble Algorithm)，來彌補IILA演算法在分類效能部
份不佳的情形，以進一步提升入侵偵測系統整體效能。 
 
4.1 演算法概念與設計 
圖4.1為基於IILA之集成演算法概念示意圖，整個集成系統分成兩個部份，在第一部分的
集成分類器階段，先利用IILA演算法針對訓練資料集中之類別來訓練出各別不同的分類模
型，若資料集中有m個類別，則產生出m個分類模型的集成分類器；接下來在面對測試資料
集時，利用集成分類器對資料集做推論，並透過第二部份的整合策略，使用多數投票制
(Majority Voting)來結合各分類模型的推論，最後，根據所獲得最多票數之類別，就是基於IILA
之集成演算法之推論結果。以入侵偵測系統為例來說明，如果有一網路行為進入集成系統
內，系統內之各個分類器將對於該行為進行預測，若有三個分類器預測為U2R攻擊，則U2R
類別將獲得3票，最後系統將合理判定該行為屬於U2R攻擊，如此一來可避免單一分類器對
特定類別之誤判。 
  
 
圖4.1 基於IILA之集成演算法概念示意圖 
 
 本章之符號定義如表4.1，基於IILA之集成演算法如圖4.2所示。演算法之步驟1用以訓練
集成系統之分類模型，首先應用IILA演算法針對訓練資料集中各類別來訓練最佳之類別分類
模型  ，若資料集中有 個類別，則在集成系統內分別產生出m個分類模型，以KDD99資料
集為例，則分別產生DOS類別分類模型、Normal類別分類模型、Probe類別分類模型、U2R
類別分類模型和R2L類別分類模型等5個獨立之分類模型，接下來將這些分類模型  加入至
29 
 
Input: 
1.            , i = 1, … , n;                    
2.          , j = 1, … , n’  
3. Learn 
Output:          , j = 1, … , n’ ;                    
Begin 
Step 1. Generate E. 
For a = 1 to m, 
Apply IILA to train      
Add     to  . 
End For 
Step 2. Evaluate   ={            } in  . 
                                 . 
For a = 1 to m, 
 For j = 1 to n’, 
If     
 
      , 
                . 
End If 
 End for 
End for 
Step 3. Obtain total votes received by each class. 
For j = 1 to n’, 
For k = 1 to m, 
                     
 
   . 
End for 
Step 4. Decide the best class. 
                             . 
End for 
End 
圖4.2 基於IILA之集成演算法 
 
4.2 實驗設計與分析 
    為證實本研究所提出之基於 IILA之集成演算法可改善原 IILA 演算法之缺點，並進一步
提升整體分類效能，將進行基於 IILA 之集成演算法實驗，以驗證演算法之效能。本實驗同
樣採用採用 10% 之 KDD99 入侵偵測系統資料集，測試資料集為包含新型態攻擊的資料集計
311,026 筆樣本，可用以驗證演算法具有偵測新型態攻擊之能力，演算法與實驗環境則應用
Weka 3.7 和 Java程式語言等軟體來建構，分類演算法採用 Weka 3.7 內建之 J4.8 分類演算法，
也就是 C4.5 決策樹演算法來進行分類模型訓練。 
    實驗共分為兩個部分，第一部分先針對各類別進行 IILA演算法之實驗，第二部分則是
IILA 之集成演算法之實驗和演算法之效能分析。 
 
4.2.1 各類別IILA演算法之實驗 
    第一部分實驗之目的在證實各獨立分類器都具有顯著之差異性，作法為運用第3章所提
出之IILA演算法來針對訓練資料集各類別分別建立出各個獨立之DOS分類模型、Norma分類
模型、Probe分類模型、U2R分類模型和R2L分類模型等5個獨立之分類器，各分類器訓練資
31 
 
值；且在Normal類別和R2L類別也分別為99.0%及8.4%，達到次高之表現，雖然在Probe類別
為80.7%而未達最高，但是仍高於平均值80.6%。因此基於IILA之集成分類器在各項類別之效
能均在平均水準以上，其中對於U2R類別之提升效果最佳，遠高於平均值(37.6%)達54.8%，
故可證實基於IILA之集成演算法不僅在 
 
表4.4 整體分類效能比較表 
分類器  
類別 
D O S      
分類器 
Normal   
分類器 
P robe     
分類器 
U 2 R     
分類器 
R 2 L     
分類器 
平均值 
IILA 集成    
分類器  
Normal  95.5%  99.4%  98.7%  98.8%  98.8%  98.2% 99.0%  
DOS  96.9%  96.9%  97.0%  97.0%  97.0%  97.0% 97.0%  
PRB  88.9%  72.3%  84.6%  80.1%  76.9%  80.6% 80.7%  
U2R  51.8%  12.7%  53.5%  53.9%  16.2%  37.6% 54.8%  
R2L  7.4%  8.2%  8.3%  8.3%  9.9%  8.4% 8.4%  
     
整體分類效能明顯優於個別其他分類器，同時也能強化少數類別之分類能力。此外，從表4.4
亦可明顯看出各個分類器在各類別之分類效果(Recall值)均不同，亦即泛化能力均能有所差
異，代表各類別之分類器就如同資料集中的各個不同類別般具有差異性與不同的泛化能力，
因此可強化集成系統最後之推論，有效提升整體準確率。 
     接下來使用五個評估指標針對基於IILA之集成演算法進行整體分類效能評量，評估結
果如表4.5所示，從表中可看出基於IILA之集成系統均能有不錯的分類效果，而且整體準確率
(Total Accuracy)可達92.53%，相較於第3章IILA演算法之92.46%提升了0.07%，證實除了可強
化整體分類效能外，對於新型態入侵行為亦能有所提升。因此，基於IILA之集成演算法成功
地改善了IILA演算法僅能增進對特定的分類效能類別，而整體效能不彰之缺憾。 
 
表4.5 基於IILA之集成演算法評估結果 
類別  
評估指標 
D O S        Normal   Probe  U 2 R  R 2 L  
Recall  96.99%  99.04%  80.68%  54.82%  8.43%  
Precision  99.88%  73.83%  77.73%  27.23%  77.68%  
F-measure  98.42%  84.60%  79.18%  36.39%  15.20%  
G-mean  98.32%  95.20%  89.68%  74.00%  29.01%  
Accuracy  97.69%  92.97%  99.43%  99.86%  95.11%  
Total Accuracy  92.53%  
 
33 
 
5. 結論與未來研究 
 
    在危險的網路環境中，資訊安全的確保是我們享受科技便利的同時，所將面臨到的最大
需求與考驗，目前已有許許多多的資訊安全設備被開發出來，如防火牆、VPN、誘捕系統、
防毒系統及入侵偵測系統等，用以保障資訊安全和提供無害的網路環境。入侵偵測系統是其
中用來防杜非法及惡意入侵行為的可靠設備，雖然目前相關研究很多，然而仍存在著一些困
難待克服，如：少數攻擊類別偵測率不佳、無法有效偵測新型態攻擊、不平衡資料集問題與
不當的特徵選取等。因此，本研究提出BMSMA演算法、IILA演算法和基於IILA之集成演算
法來解決這些問題，經由實驗證實可成功改善網路異常入侵偵測分類效能，本研究之效益分
析如下： 
一、 本論文提出BMSMA演算法，有效改善SMedian與AFMA演算法在處理極端不平
衡資料集時容易出現過度學習的問題。 
二、 IILA演算法可提升U2R攻擊類別之Recall達53.95%，而基於IILA之集成演算法更
可進一步提升至54.82%，均為目前入侵偵測系統相關研究最高，證實可有效偵
測少數重要之網路異常入侵行為，成功提升入侵偵測系統效能。 
三、 基於IILA之集成演算法運用IILA演算法針對特定類別強化之特性，成功增加集成
系統內分類模型之差異性，可強化集成系統之效能，而進一步提升整體分類效能。 
四、 就本研究所能蒐集的相關文獻顯示，本論文是第一個結合取樣、歸納偏移與特徵
選取等不同技術的研究，來改善不平衡資料集與多類別不平衡的問題，並經由實
驗成功證實不同的不平衡資料集處理策略於整合後，可更進一步強化分類效果，
有效提升入侵偵測系統效能。 
    然而本研究所提出之演算法仍有值得改進之處，例如R2L類別之分類效能仍未能有效提
升與分類成本過高等問題，因此在未來展望上，本論文分析仍有以下四個研究方向值得進一
步探討： 
一、 降低取樣： 
    將BMSMA演算法朝向降低抽樣的方式進行改良，並進一步結合分群(Cluster)
演算法來獲得具代表性之訓練資料集，取代現有演算法之隨機降低取樣策略，相
信可提升多數類別之分類效能，進而提升整體準確率。 
二、 最佳化特徵子集合： 
    演算法目前在特徵選取的部份採用試誤法進行特徵數量的選取，未來可改良
現有特徵選取方法，使能系統化與自動化的搜尋最佳之特徵子集合，探討對入侵
偵測系統之效能影響。 
三、 成本敏感學習： 
    在基於IILA之集成演算法中，各個分類模型對於特定之類別均有較佳之分類
效果，若能對於各分類模型賦予各別不同的成本值，並在最後推論時根據此一成
本值來實施權重投票(Weighted Voting)，應可獲得更佳之分類效果。 
四、 資料融合： 
    本論文之集成演算法運用於單一種資料集(入侵偵測系統)，未來可結合多種
資安設備之異質式(Heterogeneous)資料庫，如防火牆、誘捕系統(Honeypot)和防毒
35 
 
參考文獻 
 
[1] Adel Nadjaran Toosi and Mohsen Kahani, “A new approach to intrusion detection based on 
an evolutionary soft computing model using neuro-fuzzy classifiers,” Computer 
Communications, Vol. 30, pp. 2201–2212, 2007. 
[2] 李駿偉、田筱榮、黃世昆，“入侵偵測分析方法評估與比較”，資訊安全通訊期刊，第
八卷，第二期，第21-37頁，2002。 
[3] Su-Yun Wu and Ester Yen, “Data mining-based intrusion detectors,”  Expert Systems with 
Applications, Vol. 36, No. 3, pp. 5605–5612, 2009. 
[4] Tsong Song Hwang, Tsung-Ju Lee and Yuh-Jye Lee, “A Three-tier IDS via Data Mining 
Approach,” iCAST Workshop on Emerging Security Technology, 2007. 
[5] Sandhya Peddabachigari, Ajith Abraham, Crina Grosan and Johnson Thomas, “Modeling 
intrusion detection system using hybrid intelligent systems,” Computer Applications, Vol. 
30, No. 1, pp. 114–132, 2007. 
[6] Chih-Fong Tsai, Yu-Feng Hsu, Chia-Ying Lin and Wei-Yang Lin, “Intrusion detection by 
machine learning: A review, Expert Systems with Applications, Vol. 36, No.10,  pp. 
11994–12000, 2009. 
[7] Jing Ma, Xingwei Liu and Sijia Liu, “A New Intrusion Detection Method Based on 
BPSO-SVM,” 2008 International Symposium on Computational Intelligence and Design, 
2008. 
[8] Jiong Zhang, Mohammad Zulkernine and Anwar Haque, “Random-Forests-Based Network 
Intrusion Detection Systems,” System, Man, And Cybernetics-Part C: Applications And 
Reviews, Vol. 38, No. 5, pp. 649–659, 2008.  
[9] Mohammad Saniee Abadeh, Jafar Habibi, Zeynab Barzegar and Muna Sergi, “A parallel 
genetic local search algorithm for intrusion detection in computer networks,” Engineering 
Applications of Artificial Intelligence, Vol. 20, pp. 1058–1069, 2007. 
[10] Hamid Mohamadi, Jafar Habibi, and Hamid Saadi, “Intrusion Detection in Computer 
Networksusing Tabu Search based Fuzzy System,” 7th IEEE International Conference 
Cybernetic Intelligent Systems, 2008. 
[11] 潘致誠，“強健式網路入侵偵測演算法則之研究”，碩士論文，國防大學中正理工學院
資訊科學所，桃園，2009。 
[12] Tan, P. N., Steinbach, M., and Kumar, V., Introduction to Data Mining, Pearson Addison 
Wesley, U.S.A, 2006. 
[13] Haibo He and Edwardo A. Garcia, “Learning from Imbalanced Data,” Knowledge and Data 
Engineering, vol. 21, no. 9, pp. 1263-1284, 2009. 
[14] Qiong Gu, Zhihua Cai, Li Zhu and Bo Huang, “Data Mining on Imbalanced Data Sets, ” 
2008 International Conference on Advanced Computer Theory and Engineering, 2008.  
[15] Naeem Seliya, Zhiwei Xu and Taghi M. Khoshgoftaar, “Addressing Class Imbalance in 
37 
 
“Anomaly-based network intrusion detection: Techniques, systems and challenges,” 
Computers & Security, Vol. 28, No.1-2, pp. 18–28, 2008.  
[33] David A Cieslak, Nitesh V Chawla and Aaron Striegel, “Combating Imbalance in Network 
Intrusion Datasets,” 2006 IEEE International Conference on Granular Computing , 2006.  
[34] Zhao Yueai and Chen Junjie, “Application of Unbalanced Data Approach to Network 
Intrusion Detection, ” 2009 First International Workshop on Database Technology and 
Applications, 2009. 
[35] Mike Wasikowski and Xue-wen Che, “Combating the Small Sample Class Imbalance 
Problem Using Feature Selection,” IEEE Transactions on Knowledge and Data Engineering, 
25 Sept. 2009. IEEE computer Society Digital Library. 
[36] A. Al-Shahib, R. Breitling and D. Gilbert, “Feature selection and the class imbalance 
problem in predicting protein function from sequence,” Applied Bioinformatics, Vol. 4, No. 
3, pp. 195–203, 2005. 
[37] http://kdd.ics.uci.edu/databases/kddcup99/kddcup99.html 
[38] http://www.megaputer.com/polyanalyst.php 
[39] http://www.cs.waikato.ac.nz/ml/weka/ 
100年度專題研究計畫研究成果彙整表 
計畫主持人：楊棋堡 計畫編號：100-2221-E-606-020- 
計畫名稱：基於資料探勘技術之入侵偵測系統分類演算法設計 
量化 
成果項目 實際已達成
數（被接受
或已發表）
預期總達成
數(含實際已
達成數) 
本計畫實
際貢獻百
分比 
單位 
備 註 （ 質 化 說
明：如數個計畫
共同成果、成果
列 為 該 期 刊 之
封 面 故 事 ...
等） 
期刊論文 0 0 100%  
研究報告/技術報告 0 0 100%  
研討會論文 2 3 100% 
篇 
1 篇發表於第十六
屆人工智慧研討
會，1 篇發表於
2011 全國計算基
會議。 
論文著作 
專書 0 0 100%   
申請中件數 0 0 100%  專利 已獲得件數 0 0 100% 件  
件數 0 0 100% 件  
技術移轉 
權利金 0 0 100% 千元  
碩士生 7 2 100%  
博士生 0 0 100%  
博士後研究員 0 0 100%  
國內 
參與計畫人力 
（本國籍） 
專任助理 0 0 100% 
人次 
 
期刊論文 0 0 100%  
研究報告/技術報告 0 0 100%  
研討會論文 0 0 100% 
篇 
 
論文著作 
專書 0 0 100% 章/本  
申請中件數 0 0 100%  專利 已獲得件數 0 0 100% 件  
件數 0 0 100% 件  
技術移轉 
權利金 0 0 100% 千元  
碩士生 0 0 100%  
博士生 0 0 100%  
博士後研究員 0 0 100%  
國外 
參與計畫人力 
（外國籍） 
專任助理 0 0 100% 
人次 
 
