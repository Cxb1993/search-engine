2行政院國家科學委員會補助專題研究計畫
■ 成 果 報 告
□期中進度報告
元件型文件資料庫與資料交換系統整合之研究
計畫類別： ■個別型計畫 □整合型計畫
計畫編號：NSC 95-2221-E-412-004
執行期間： 95 年 8月 1日至 96 年 7月 31 日
計畫主持人：林耀仁
共同主持人：
計畫參與人員： 王正邦, 黃政欽, 范慶達
成果報告類型(依經費核定清單規定繳交)：■精簡報告 □完整報告
本成果報告包括以下應繳交之附件：
□赴國外出差或研習心得報告一份
□赴大陸地區出差或研習心得報告一份
□出席國際學術會議心得報告及發表之論文各一份
□國際合作研究計畫國外研究報告書一份
處理方式：除產學合作研究計畫、提升產業技術及人才培育研究計畫、
列管計畫及下列情形者外，得立即公開查詢
□涉及專利或其他智慧財產權，□一年□二年後可公開查詢
執行單位：育達商業技術學院資訊管理系
中 華 民 國 九十六 年 十 月 一 日
I目錄
摘要............................................................................................................................II
Abstract ......................................................................................................................II
前言............................................................................................................................ 1
研究目的.................................................................................................................... 1
文獻探討.................................................................................................................... 3
研究方法.................................................................................................................... 4
結果與討論................................................................................................................ 5
參考文獻.................................................................................................................... 7
1前言
XML 文件常被分類為資料型(資料為主，data-centric) 和文件型( 文件為主，document-centric)兩大
類，前者的 XML 定義必須是完整的格式(well-structured)，類似關聯式資料庫的欄位綱要，大多用
來做資料的處理及交換。後者僅包含文件架構(例如段落等…)的部份，真正的資料處理是由「內容
管理」來完成，而且通常使用的是全文檢索之類的技術。
但現在 XML 的標準定義日漸成熟，已經有一些介於兩者之間 XML 的應用標準的出現，它有
一部份類似文件型的詮釋資料，可以彈性的引用一些資料，但這些資料其實是資料型的元件，被定
義得很仔細，例如 OASIS 的 ebXML，ADL 裡的 SCORM(Sharable Courseware Object Reference
Model)，以及 HL7 (健康七層組織 Health Level 7)裡的 CDA (臨床文件架構 Clinical Document
Architecture)，包括台灣的電子病歷標準草案亦是基於 CDA 而定義。
目前以資料處理作法的 XML 資料庫均特定與資料型或文件型，無法有效的處理元件型 XML
文件，而是以文件型的 XML 資料庫為主要做法。在資料庫這一個層級並不特意處理元件內部的資
料，而是提供儲存、全文檢索、XML 查詢等文件存取的界面，再由應用程式來完成一切的功能及
需求。雖然說這些功能與需求有許多是跟應用相關的(application-dependent)，但應用程式仍然要負
擔許多文件與元件的拆解、尋找、重組、管理等一般性的工作，相對造成應用開發的障礙。
從直觀上來說，元件型 XML 文件像是一個文件夾，而不是像傳統 XML 的觀念是一個檔案一
個文件。以關聯式資料庫的關點來說，元件型文件並不是一個實體，而是一群符合條件的元件的觀
點。例如每位病友每次就診都有一個病歷紀錄，在 CDA 上線後，每個病歷紀錄即為一個 CDA 文
件，內容包含病友之基本資料及診斷治療所相關的紀錄，如主訴、檢驗及醫令等。如果我們需要某
位病友在醫療過程中，某項檢驗(例如心肺檢查)的歷次檢驗的摘要報告，不只是把所有的 CDA 從資
料庫裡調出來，而是希望有一份就只有該項檢驗資訊的新的 CDA 文件。
本研究即根據 CDA 文件，分別進行後端的元件型文件資料庫之間的資料交換及前端的應用程
式開發所需之架構及功能研究。後端的部份為元件型 XML 文件資料庫的元件管理之功能及界面研
究(簡稱 Cxdb)，並實作基礎平台與操作功能，可以透過 Web Services 提供前端的管理程式定義領域、
拆解、儲存、管理、重組元件之功能，及不同資料庫之間的調用與更新。前端即植基於後端的基礎
平台上，增加元件型 XML 資料庫之應用程式開發輔助工具（簡稱 CxdbApp）就是希望可以透過瀏
覽器提供完整的使用者介面並加入簡易的商業邏輯概念的處理，輔助應用程式的開發工作。[4][7]
本研究針對 V3 CDA 文件(連續照護紀錄)為對象，以達成以下目標：
 能以元件的角度來處理 XML 文件。
 結合商業邏輯的能力，能在機構間共同新增及修改元件。
 方便於 Native XML DB 上開發應用程式。
 簡化未來其他的元件型 XML 資料庫應用開發之負荷。
研究目的
本研究目的分為元件管理與文件管理兩個層次來探討
 元件管理
本研究其中會引用 XML 文件應用標準 HL7/CDA，雖然元件型 XML 文件應用並不侷限於
HL7/CDA，但引用的目的在避免研究結果與實務應用無法配合。研究重點分述如下：
3文獻探討
 HL7 相關議題[2][5]
HL7 包含了一系列與健康醫療有關的協定標準，本研究以與文件交換直接相關且普遍實作的第
二版之轉診訊息及第三版之臨床文件架構為例進行說明。HL7 訊息標準提供一個文件化特定 HL7
訊息的依循方向。當一個訊息被定義後，HL7 訊息的使用者將可以明白的了解到什麼資料將會被傳
送、 那種資料格式將會被傳送、以及收送雙方的互相對答的權責方式。
以電子病歷之 HL7/XML 轉診、轉檢（代檢）標準白皮書（建議草案）中的轉診單為例，應用
開發者（例如:病歷委員會）會訂定的轉診單的格式與表單內容（如原診治醫院診所保險對象基本資
料、日期、病摘、轉診科別、轉診目的、負責醫師、科別、有效期限、接受轉診醫院診所、處理情
形、治療摘要、院所名稱、負責醫師及回覆日期等）輸出為符合格式的 XML 文件，文件內容可以
進行元件之定義、拆解、儲存、管理、重組之功能。
對於應用開發者已定義之元件後，表單設計者(資訊人員)可針對應用開發者所定義的元件設計
專屬的表單提供給終端使用者使用。終端使用者透過 Web 進行選取表單，對 Server 端提出請求後，
Server端會依使用者選取之元件進行轉換提供可瀏覽不可修改的頁面或是可瀏覽亦可修改內容之頁
面。若修改或填寫表單內容，會反轉網頁內容儲存於資料庫中。
一份轉診表單主要由兩大角色所組成：轉出醫院、轉入醫院。轉出（入）醫院的使用者，各自
操作關心的部份。轉出醫院會依轉診訊息的要求，合併成為轉出醫院轉診單。而轉入醫院會將將轉
出醫院轉診單分解成為元件，並於轉入醫院使用者完成操作後，可能會修改部份元件內容，組合成
為一份完整的轉診單，將這些過程進行流程化使其資料流能符合需求者的需要。
在第二版中，訊息的定義是採「由下往上」的方式定義的，各訊息單位依各自的需求定義訊息，
再整合成一整套的格式。第二版也保留了許多的資料欄位供各醫院擴充之用。但這些保留欄位造成
互相交換時，即使雙方擴充了相同的功能，也因各自擴充而不能直接交換，必須另外製作一個交換
界面。
第三版 (V3)就這個問題，及其他的考量， 建構了一個標準的參考模型 RIM (Reference
Information Model)作為基礎。第三版使用 UML (Unified Modeling Language)方法論和 RIM 來定義
訊息。RIM 是第三版中必要的元件，提供精確的語意和文法的表示規則，來表達 HL7 訊息中的所
涵蓋的資訊。
臨床文件架構 CDA (Clinical DocumentArchitecture, 或病歷文件架構 PRA, Patient Record
Architecture)提供了另一個以病歷交換臨床文件(例如出院病摘)，作為接近實際醫院運作的電子版本
模式。新版本的 CDA 引用 XML，HL7 V3 的 RIM 和語彙，將一份文件視為一群元件的集合，一
個元件則相當於一個傳統的訊息。CDA 文件同時包括兩個部分，提供設備讀取的資料，以及提供
使用者閱讀的資訊，以便單一文件可供人及設備同時使用。CDA 亦可以在 XML 的瀏覽器上，包
括 PDA 和手機，以不同的樣式(Style Sheet)方便的瀏覽。台灣之電子病歷標準即以 CDA 為基礎，
定義了許多 “病歷單張”作為電子病歷描述之用。
如果每位病友每次就診都有一個病歷紀錄，在 CDA 上線後，每個病歷紀錄即為一個 CDA 文
件，內容包含病友之基本資料及診斷治療所相關的紀錄，如主訴、檢驗及醫令等。如果我們需要某
位病友在醫療過程中，某項檢驗(例如心肺檢查)的歷次檢驗的摘要報告，不只是把所有的 CDA 從資
料庫裡調出來，而是希望有一份就只有該項檢驗資訊的新的 CDA 文件。
 台灣電子病歷相關議題[6]
衛生署自十一年度已經進行第一期醫療院所病歷電子化試辦計畫、醫療憑證管理中心的設置、
5件，如何建立新定義的註冊機制，當加入一個新的元件定義時，不會有太多的程式負擔(不需要為
每一個元件在兩端寫一個交換的服務，而是在現有系統端作一些與現有系統的內容整合即可。)。
另一個部份是組織間的交換，重點在於跨組織的元件管理、元件流動、版本控制及權限等問題的分
析與提出模型與一般交換協定的整合。
 模組分析
依照問題分析結果，以及平台環境等條件，將系統適當的分為數個子系統，再細分為較小的模
組，包括各模組的輸出入的參數等。並排定實作與個別測試、整合測試的優先順序。
 格式分析
由於 ebXML 的平台較不普及，本研究從較普及、相似但較簡單的 Web Services 著手。如何在
SOAP 中包裝元件化的文件，傳遞規則，及如何自動註冊新元件，為新元件提供服務等協定格式的
問題
 系統架構
依照模組分析的結果，規劃出系統架構，作為未來實際建構系統中使用的部份。資料庫使用開
放原始碼之 eXist XML 原生資料庫[3]，所有的文件及元件均以 XML 的型式存放其中，並且以 XPath
調用其紀錄。
 應用設計
本階段根據雛型中每一個模組設計一個以上之應用，供確認模組之正確性。並且分析模組之間
的相依關係，根據每一個相依關係設計一個以上之應用，供確認模組之間的相互作用的正確性。並
且依各子系統及完整系統，設計從頭到尾的應用實例，供驗證整個系統的正常性。
結果與討論
目前現有的 HIS 系統與電子病歷並未整合，所以元件並非為操作的單位，而輸出成電子病歷格式
後，並不做為進一步處理的依據，與本研究的假設是不相同。但電子病歷的模組(元件)的產生可以
視為單獨運作的部份。也就是說，調用元件的部份，可以視為呼叫產生模組的副程式，從 HIS 中調
用相關資料產生模組。而元件存檔，則可視為 HIS 資料中相對應的異動。
元件型 XML 文件的特徵有三，一是，它有一個由元素組成的結構，結構會被定義成數個層級，
例如款、項、目、節，或頭文件、主體。其二，結構元素會被定義可不可以掛載元件。其三，元件
會被資料模型清楚定義。
當有了這些特徵，就可以從 XML 文件中，分析出元件的特性。而這些特徵需要由使用者告訴
系統，在此稱為「領域參數設定」。當處理分割 XML 文件成為元件時，其分割順序，是依據參數
中結構層級設定切割，而切下來的子樹只是結構的表示，並不足以表達元件，需從子樹中找到元件
類型相關資訊。此等相關資訊在此稱為「領域元件」，可以提供系統儲存元件的指示，及方便使用
者判讀的資訊，且會被系統儲存管理。
當處理組合領域元件成為新的 XML 文件時，需要提供階層式的排列順序，如此才能產生樹狀
結構的 XML。為了產生更有意義的結果，排除非需要的部份，得加入條件。必為了能夠重複使用
這些設定，得命名儲存，在此稱為「類型文件」。
系統主軸就是要能處理文件分解成為元件，元件重組成為文件，而要能處理元件，先要設定前
述的資料並儲存(設定領域參數)，使能夠達成「一次設定無限再用」的目標。其次要有載入 XML 文
件功能，當系統執行此功能時，會參考設定接續執行分割 XML 文件動作，再將元件存入資料庫，
另外也會將元件的特性記錄在領域元件中。而當重組文件時，首先操作排列領域元件，使系統了解
要到何處理取元件，及取回後排列方式。其次決定是否要加上條件，使取得的資料更為所需。最後
