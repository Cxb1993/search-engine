摘要 
 由於網際網路及電子商務的快速普及的影響，大多數的組織和企業花了很多
心力去預防他們重要的資訊系統招受惡意攻擊及入侵。在這相關的防範技術中，
防火牆的使用是最為普遍，由於現今的防火牆多屬安裝於網路節點或個人電腦上
之應用軟體或程序，這使得在建制與管理上相當不便。且一般的傳統防火牆只防
範了外部網路的攻擊及入侵，卻忽略了內部網路的威脅。 
為了讓防火牆的建制與管理更為容易且不破壞網路架構，在本論文中將設計一個
分散式嵌入式網路安全防禦系統。如此以來，我們把防火牆的功能結合在嵌入式
系統，將其視為一張網路卡介面建構在組織或企業的每個電腦上，且我們也建構
一個中央安全策略伺服器，然後管理者透過此伺服器依據每一台電腦的階層權限
給予不同的封包過濾策略。因此，使用我們所提出的架構的組織或企業可以有效
的防禦外部及內部網路的攻擊及威脅。 
 
關鍵詞：分散式防火牆、嵌入式系統、網路安全策略伺服器、系統晶片硬
體平台 
 
 目錄 
 
目錄................................................................................................................................1 
圖目錄............................................................................................................................2 
表目錄............................................................................................................................3 
第一章 序論..................................................................................................................4 
第 2章 背景介紹..........................................................................................................6 
第一節 防火牆技術..............................................................................................6 
第二節 嵌入式系統..............................................................................................8 
第三章 分散式安全防禦系統(DSS)的架構............................................................11 
第一節 分散式安全防禦系統的概念................................................................11 
第二節 嵌入式防火牆........................................................................................11 
第三節 DSS & CSPS..........................................................................................12 
第四章 系統實作......................................................................................................16 
第一節 EFW-NIC實作 .......................................................................................16 
第二節 CSPS實作 ..............................................................................................18 
第五章 實驗結果........................................................................................................20 
第一節 EFW-NIC的網路功能 ...........................................................................20 
第二節 DSS安全策略測試 ................................................................................20 
第三節 監控EFW-NIC網路狀態 .......................................................................26 
第六章 結論與自評....................................................................................................30 
參考文獻......................................................................................................................31 
 
 
 
 
 
 1
 表目錄 
 
表一. EFW-NIC的有線及無線環境下FTP下載速度 ................................................20 
 
 
 
 3
 式防火牆缺點；而 DSS 不只能有傳統式防火牆的功能，又能防禦內部威脅。此
外，本研究計畫透過一些實驗來測驗 DSS 的各項功能，並在此報告中展現成果。 
  此報告接下來的第二章將簡單介紹相關背景，第三章則描述 DSS 的架構，
第四章則為實作部份，接著第五章為實驗結果，最後一章總結整個研究計畫並且
自評。 
 5
 固，但相對的缺點則便是在建構的成本以及建構的難度將會提高，同時由於封包
轉送的過程，可能使得網路的效能會略為降低。 
  第三種狀態檢驗式防火牆則是會針對每個資料流進行分析以及追蹤控制所
有的通訊，不論該資料流是流經 OSI 七層架構的哪些部分，都可以針對該資料
流進行完整的追蹤以及控制。他不像上述兩種的類型的防火牆是針對封包的資料
進行驗證，狀態檢驗式防火牆是針對資料流的狀態以及流向進行判斷分析。此種
防火牆技術的優點為安全性高，為目前業界的高級防火牆所用的通用架構，不過
缺點亦同於應用代理伺服器防火牆，其安全性高，則其建置的成本以及效率將會
相對應的減低。 
  圖一顯示了傳統防火牆的架構以及各個組織的特色及結構。在這種網路設計
架構上，所有網路上的網路資料是否能重送至主機進行後續的服務以及回應都是
由防火牆群所來進行決定。然而，這種架構的缺點在於對於洪水式攻擊有較弱的
防範能力，當遭遇攻擊時，單一出口的設計反而會變成該網路架架構的一個瓶頸
點所在。 
  除此之外，Koch 學者也提出了內部的攻擊相對於外部的網路攻擊會造成公
司企業上更多的財務損失[14]。有鑑於此，個人式的防火牆開始變成一種新的研
發趨勢，同樣地，Bellovin 學者也提出了一種分散式的防火牆概念來試圖解決傳
統防火牆架構所衍生出來的攻擊議題[9] [15]。 
 
 7
 可客製化，並且具有低電量消耗。 嵌入式裝置的基本架構如圖二所示。由於以
上的優點，嵌入式系統的開發者可以針對他們所需要的功能進行客製化的需求極
進行功能的取捨。舉例來說：自動提款機便是一種客製化的嵌入式系統。其具有
螢幕裝置、音效輸出、晶片卡的讀取裝置、以及鍵盤輸入和印表機的輸出裝置，
這便是該機器利用嵌入式系統客製化的產物。其他現今流行的智慧型手機、個人
數位行動助理(PDA)、還有全球衛星定位系統…等等，都是使用嵌入式系統進行
客製化並改善人類生活品質及生活方式的應用及成果。  
 
圖二. 嵌入式系統的架構 
 
  因為我們想要將防火牆的功能與嵌入式系統做緊密的結合並讓它看起來是
一個網路介面晶片，就像是系統單晶片(SoC)的硬體結構平台。有些基於我們的
需求必須被考慮到，例如：晶片硬體平台的選擇、作業系統的考量、以及開發的
工具須使用何者才易於開發維護。 
  一般常用於系統單晶片的微處理器硬體平台有分為兩大主流公司：Advanced 
RISC Machine (ARM) 以及 MIPS Technologies. 他們的產品通常通稱為 ARM 
系列以及 MIPS 系列。在眾多的微處理器中，這兩系列的微處理器特色是易於
開發以及與其他硬體平台有較好的相容性。雖然，眾多的嵌入式系統皆適用於這
兩種微處理器系列產品，不過在這次的研究計畫中，由於 ARM 的高效能、低成
 9
 第三章 分散式安全防禦系統(DSS)的
架構 
  以下為本章的各章節簡介：在第一節中我們將會介紹我們所提出的分散式安
全防禦系統(Distributed Security System, DSS)的主要設計概念。在第二節中我們
將會描述 EFW-NIC 的架構。在第三節中我們會解釋中央安全政策主機在分散式
安全防禦系統中所扮演的角色。 
 
第一節 分散式安全防禦系統的概念 
  在這個研究計畫中，我們設計了一個分散式安全系統(DSS)的架構來抵擋攻
擊。在分散式安全系統中有一些實作上所必須要注意的設計目標將會於後面進行
敘述。  
  首先，這個系統必須要有一個管理的機制，我們稱之為中央安全政策主機
(Central Security Policy Server, CSPS)的一個控管中心。其二，這個分散式安全防
禦系統必須是一個通用的模組設計。 第三，這個系統必須要有傳統防火牆的功
能以及分散式網路的架構特徵以期能同時進行內部網路以及外部網路的攻擊防
範。  
 
第二節 嵌入式防火牆 
  在分散式安全防禦系統的架構中，最重要的部分便是要實作個人防火牆。在
這個研究計畫中，我們使用嵌入式系統來達成這個部分的實作。使用嵌入式系統
來實作這個部分有些易於開發的好處；在嵌入式系統中，其有自己獨立的控制處
理器單元以及記憶體儲存裝置，同時還有網路的介面裝置以及通用序列輸入輸出
(USB)的裝置。除此之外，我們可以將開放原始碼的防火牆模組掛載於嵌入式系
 11
   圖四表示了分散安全系統包含了三種運作機制的中央安全主機的架構。中央
安全政策管理機制可以針對系統環境裡的每一台 EFW-NIC 提供不同層級的存取
權限。網路管理人員可以針對不同的 EFW-NIC 來設定不同的存取權限，這個機
制達成了分層管理的目標。 
 
 
圖四. DSS 的系統架構 
   
  EFW-NIC 存取控制機制是用來控制每一個 EFW-NIC。 所有 EFW-NIC 的
防火牆規則全部都是由 CSPS 來進行控制。CSPS 可以選擇並改變其系統環境內
的所有 EFW-NIC 的防火牆規則。這個存取控制機制使得 EFW-NIC 具有傳統防
火牆的封包過濾功能。同時，在這個架構中，如果 CSPS 有需要的話，EFW-NIC 
可以回傳 CSPS 所需要的 log 檔案回 CSPS 進行分析之用。 
 13
   關於安全政策，中央安全政策管理機制的分析資料庫傳送相關的分析後資訊
到中央安全政策管理機制的嵌入式防火牆管理。在中央安全政策管理機制中的嵌
入式防火牆管理、安全政策管理資料庫、以及安全政策管理機制是密不可分的設
計。安全政策管理資料庫儲存並驗證嵌入式防火牆管理機制以及安全政策管理的
決策資訊。嵌入式防火牆管理機制傳送每一個 EFW-NIC 的層級權限資訊給安全
政策管理機制，此時，安全政策管理機制做出對 EFW-NIC 存取控制機制的存取
控制的政策決策。這個過程顯示在圖六。 
 
 
圖六. DSS 的安全政策控制關聯圖 
 
 15
  
圖八. DMA-270L 晶片組 
 
圖九. S3C2410 晶片組 
 
 17
   而我們所使用的程式語言為 C++、QT [26] 和 Qtopia [27]。他分為兩個部
份：CSPS 和 EFW-NIC。在 CSPS 的部份，程式能夠接收到 EFW-NIC 的主動請
求並且建立連結，CSPS 便能發送各個不同防火牆的規則給不同的 EFW-NIC；此
外，它能接收 IDS 所傳送回來的 log 訊息，並且有著人性化的圖形介面來設定防
火牆規則。在 EFW-NIC 部分，程式必須主動連結 CSPS 並且接收來自 CSPS 的
防火牆規則。除此之外，我們還讓 CSPS 成為 SNMP Server 端來發送請求並接收
各個 EFW-NIC 的資訊，再透過 Cacti 流量繪圖套件，我們便能以網頁的模式來
監控 DSS 每個 EFW-NIC。 
 19
 網路行為。而 CSPS 主要控管各個 EFW-NIC，針對每個 EFW-NIC 給予不同的防
火牆規則。  
 
圖十. DSS 策略決定及傳送規則至 EFW-NIC 流程圖 
  我們可以看到圖十此流程圖可以解釋 CSPS 的決策及傳送防火牆規則至
EFW-NIC 的運作方式。根據圖十我們做了一個範例來說明 CSPS 的決策及傳送
防火牆規則至 EFW-NIC 的過程。 
  此範例為偵測及阻擋成人色情網站，從這個範例中，可以延伸理解 DSS 系
統網路管理者如何找到員工有任何可疑的網路行為，來做即時的阻擋防禦。此範
例的操作步驟如下： 
步驟 1. Client PC 瀏覽成人網站被 IDS 成功偵測到，IDS 得到 syslog 資料，這些
syslog 資料呈現在圖十一，我們能看到這個網站 IP 為「119.160.246.242」。 
步驟 2. IDS 將收集到的 syslog 資訊傳送至 CSPS，CSPS 根據得到的 log 資料來
修改或增加連結此 Client PC 的 EFW-NIC 防火牆規則。圖十二呈現連結
 21
  
圖十三. CSPS 的控制畫面 
 
圖十四. 選擇指令選項畫面 
 
 
 23
  
圖十六. EFW-NIC 處理訊息畫面 
 
 
圖十七. 中央控管策略的測試結果 
 
 
 25
 續 90 分鐘。我們可以明顯的看到圖十九內的流量在 11:00 急速攀高，比平常流
量高出 15 倍之多。  
 
圖十九. EFW-NIC 在 Client PC 遭受到 SYN 洪水攻擊時的流量圖 
 
  經過 30 分鐘的攻擊後，我們傳送防火牆規則至 EFW-NIC，我們明顯的看到
對外流量瞬間降回正常流量，那是因為規則生效，EFW-NIC 不再回應攻擊封包。
然而，流進的流量反而升高了一些，那是因為攻擊方不再收到 EFW-NIC 的回應，
便空出處理回應封包的能力，因此封包容量變大。再經過 60 分鐘便結束攻擊，
EFW-NIC 恢復正常。 
 
二、Ping 洪水攻擊 
  另外，我們也做了 Ping 洪水攻擊，實驗結果呈現在圖二十。從 18:30 開始，
我們每秒傳送 80KB 大小的 Ping 封包，攻擊也是持續 90 分鐘。圖二十明顯地在
18:30 流量開始攀高，達到比平常流量 14 倍多。攻擊 30 分鐘後，我們傳送防火
 27
   因我們要增加攻擊實驗流量圖的可讀性，我們皆在 30 分鐘後才傳送防火牆
攻擊，在實際上，DSS 系統網路管理員，在看到異常流量升高時，便要及時調出
log 記錄檔查閱，以找出攻擊的封包為何，並且做出判斷，給於即時的正確防火
牆規則，以達到防禦的效果。因此我們所提出的 DSS 系統架構是能夠達到預防
外部攻擊及防禦內部的威脅。 
 
圖二十一. EFW-NIC 在 Client PC 主動對外發出 SYN 洪水攻擊時的流量圖 
 29
 參考文獻 
[1] Thorsten Holz, Simon Marechal, Frederic Raynal, "New Threats and Attacks on 
the World Wide Web," Security & Privacy, IEEE, Volume 4, Issue 2, pp.72-75, 
Mar.-Apr. 2006  
[2] Chu-Hsing Lin, Fuu-Cheng Jiang, Wei-Yuah Lee, Wei-Cheng Hsu, "Counteract 
SYN Flooding Using Second Chance Packet Filtering," Proceedings of the 3rd 
International Conference on Ubiquitous Information Management and 
Communication (ICUIMC-09), 15-16 Jan. 2009, SKKU, Suwon, Korea. 
[3] Jian Liu, Zhuqing Li, Dianfu Ma, "An Adaptive Transport Framework for Web 
Services," Proceedings of the IEEE International Symposium on Computer 
Science and its Applications, (CSA 2008), pp.32-37, 13-15 Oct. 2008. Hobart, 
Australia. 
[4] Chu-Hsing Lin, Jung-Chun Liu, Chih-Chieh Lien, "Detection Method Based on 
Reverse Proxy against Web Flooding Attacks," Proceedings of the Eighth 
International Conference on Intelligent Systems Design and Applications (ISDA 
2008) , vol.3, pp.281-284, 26-28 Nov. 2008. Kaohsiung City, Taiwan. 
[5] Chu-Hsing Lin, Jung-Chun Liu, Fuu-Cheng Jiang, Chien-Ting Kuo, "An 
Effective Priority Queue-Based Scheme to Alleviate Malicious Packet Flows 
from Distributed DoS Attacks," Proceedings of the International Conference on 
Intelligent Information Hiding and Multimedia Signal Processing (IIHMSP 
2008), pp.1371-1374, 15-17 Aug. 2008. Harbin,  
[6] Chu-Hsing Lin, Jung-Chun Liu, Ching-Ru Chen, "Access Log Generator for 
Analyzing Malicious Website Browsing Behaviors," Proceedings of the 5th 
International Conference on Information Assurance and Security (IAS 2009), 
18-20, Aug. 2009. Xi'an, China 
 31
  33
有限公司, 2005 年 10 月, ISBN: 986-7198-27-1 
[18] Jen-Hao Teng, Chin-Yuan Tseng, Yu-Hung Chen, "Integration of Networked 
Embedded Systems into Power Equipment Remote Control and Monitoring," 
Proceedings of the IEEE Region 10 Conference on TENCON, vol.C, pp. 566-569 
Vol. 3, 21-24 Nov. 2004. Chiang Mai, Thailand 
[19] Steve Furber, "ARM System-on-chip architecture," Addison-Wesley.,2001. 
ISBN:0-201-73719-1 
[20] ARM Limited, Available at http://www.arm.com 
[21] David Seal, "Architecture Reference Manual, Second Edition" Addison-Wesley 
Professional, 2001. ISBN:0-2-1-73719-1 
[22] Iptables, Available at http://www.netfilter.org/ 
[23] Bridge-util, Available at http://www.linuxfoundation.org/en/Net:Bridge/ 
[24] BusyBox, Available at http://www.busybox.net/ 
[25] Net-SNMP, Available at http://www.net-snmp.org/ 
[26] Qt, Available at http://www.qtsoftware.com/ 
[27] Qtopia, Available at http://qpe.sourceforge.net/ 
 
 
 
 
第九屆 國際平行與分散計算應用技術研討會 
 
林 祝 興 
 
東海大學資訊工程與科學系 
 
 
一、參加會議過程 
2008 年 11 月 30 日撘乘紐航，經過十小時飛行，到達紐西蘭但尼丁機場。到達後，直接專車接送
到研討會舉行地－奧塔哥大學。奧塔哥大學是紐西蘭最古老的大學，設立於 1868 年，在 2007 年
被評選為紐西蘭最好的大學。奧塔哥大學有全紐西蘭第一所醫學院和唯一的牙醫學校，是紐西蘭
南島的醫學研究中心，也是第一個將試管嬰兒付諸實際的醫學中心。奧塔哥大學以古樸的哥德式
風格建築著稱，擁有紐西蘭罕見的英格蘭式建築。校園環境非常優美，而奧塔哥大學主要校園位
於紐西蘭南島的但尼丁市中心，但尼丁市本身是個大學城，人口約為 121,000 人，大多數的學生
住在只需步行就可到達校園的地方，離市中心和購物商圈也都不遠。 
 
 
PDCAT 今年是第九年舉辦，是國際著名的研討會之一，其會議內容探討的範圍相當廣泛，各領
域的有關於平行和分散計算有關的皆可研究探討。今年論文接受率只有 25%，總共接受 56 篇論
文，其論文內容品質十分有參考價值。12 月 1 日早上九點前辦理註冊手續、拿取會議相關資料，
並與幾位外國學者以及台灣過去的學者們交流、寒喧後便進入會議場所，第一天會議舉辦了四個
tutorials，本人全程參與所有課程。其中一個 tutorial: “Passive Network Analysis using Libtrace”，
Linbtrace 是由懷卡扥大學的 WAND Group 研發出來的，此 Libtrace 是截取網路封包進而分析的函
式套件在 Ubuntu 上開發，有 API 介面方便做封包 tracing。其餘三天也聽取會議的 Keynote Speakers
的演講和一些 session 其他人的論文簡報，吸收不少新知，會議的整體過程還算順利。 
 
 
二、與會心得 
在這次的PDCAT’08研討會中，本人所發表的學術論文，所屬的議題為 Routing Protocols，而論文
題目為Node-disjoint Alternative Dual-path Routing for Data Salvation in Mobile Ad hoc Networks，論
文內容是在探討無線行動網路上的路由備援技術，由S.-T. Lee等學者提出的AODV-BR備援路由，
於無線行動網路路由路徑中斷時，在此AODV-BR備援機制下會有條備援路徑讓網路傳輸資料能
不中斷。而我們的方法除了採用AODV-BR的部分備援特性，更揉合X. Li等學者提出的NDMR的
方法(用於route discovery)。而我們方法的備援效果優於AODV-BR，且花費的所需的成本比
AODV-BR低。 
 
 
三、考察參觀活動 
此次紐西蘭但尼丁行，住宿於奧塔哥大學裡的聖瑪格莉特學院，剛好跟台灣不一樣正處於夏季，
是為晴空萬里的好天氣，除了參與這次研討會，其餘空閒時間，有特定去參觀他們奧塔哥大學校
 
 
Node-disjoint Alternative Dual-path Routing for Data Salvation in Mobile  
Ad hoc Networks 
 
Chu-Hsing Lin1,  Fuu-Cheng Jiang2,  Jen-Chieh Chang3 
 
Department of Computer Science and Information Engineering, 
Tunghai University, Taichung, Taiwan 
{1chlin, 2admor}@thu.edu.tw ,  3aja1008@yahoo.com.tw 
 
Frode Eika Sandnes4 
Faculty of Engineering, Oslo University College 
P.O. Box 4, St. Olavs Plass, N-0130 Oslo, Norway 
4frodes@hio.no 
 
 
 
Abstract 
 
This study elaborates the influence patterns of 
different backup strategies on AODV-based routing 
protocols. Although some backup routing strategies 
yield good data delivery rates, they suffer from low 
efficiency. To make the process of data salvation more 
efficiently in case of link failure, we explore the 
possibility of combining the AODV-BR strategy and 
on-demand node-disjoint multi-path routing protocols. 
This article proposes an improved approach named 
NDAMR (Node-Disjoint Alternative Multiple Path), a 
routing protocol that maintains the only two shortest 
backup paths in the source and destination nodes. The 
NDAMR can alleviate the redundancy-frames 
overhead during the process of data salvation by the 
neighboring intermediate nodes. Our simulation 
results have demonstrated that NDAMR delivers good 
data delivery performance while restricting the 
impacts of transmission collision and contention. 
Keywords: Multi-path routing, node-disjoint multi-path, 
alternative path, data salvation, transmission collision and 
contention, mobile ad-hoc network, simulation. 
 
1. Introduction 
 
A mobile ad hoc network (MANET) is a wireless 
network model without the need of central base 
stations. MANETs can be applied in medical 
emergencies, during natural catastrophes, for military 
applications and to conduct geographic exploration. 
Mobile and wireless devices belonging to a MANET 
are usually called mobile nodes. These nodes are 
characterized by high mobility, low power, limited 
storage, and limited transmission range. Mobile nodes 
communicate through bi-directional radio links and 
data transmission is a key challenge. MANET 
communication events are called sessions. The two 
communicating parties, namely the source node and 
the destination node comprise a session pair (or 
source-destination pair). A mobile can communicate 
directly with other nodes if such a link exists within the 
radio transmission range. If the distance between a 
session pair is too large to establish direct contact, then 
the data must be sent via intermediate nodes 
connecting the two parties. 
At least one valid routing path must be established 
before the source node of a session pair can send data 
to its destination node. MANET routing protocols can 
be roughly categorized into three categories [1], 
namely table-driven routing, source-initiated 
on-demand routing, and hybrid routing. Well known 
source-initiated on demand routing protocols include 
AODV [2] and DSR [3]. These protocols are based on 
the strategy of only find valid routes once they are 
needed by the source node. This procedure is known as 
route discovery. Route discovery involves the route 
request phase (RREQ) and the route reply phase 
(RREP). These protocols all construct a single-path 
route between a source node and a destination node. 
Backup routing protocols [4-7] are usually designed to 
provide data salvation capabilities for the previously 
mentioned protocols, and they are classified as a 
special type of single-path routing protocols. A 
multi-path routing protocol usually establishes several 
valid paths for a session pair during a successful 
protocol run. A backup routing protocol mainly 
AODV-BR can be further categorized into 
AODV-BR 1 based on a fixed next hop policy, and 
AODV-BR 2 based on an any next hop policy. The 
backup structure and the characteristic of the one hop 
data broadcast of AODV-BR 1 and 2 are identical. The 
only difference is the choice of alternative paths, which 
are used to salvage data packets broadcasted by nodes 
neighboring the node with link failure. AODV-BR 1 
salvages broadcasted data packets if there is an 
alternative path to the destination node and the next 
hop of its alternative path is exactly same node as the 
one pointed to by the broken link. Neighboring nodes 
in AODV-BR 2 salvages broadcasted data packets as 
long as there is an alternative path to the destination 
node, and the next hop can be any node. 
 
2.2 Backup routing transmission collision and 
contention 
 
One problem to consider when designing backup 
routing protocols is that of transmission collision and 
network contention in case of link failure [4]. 
Backup routing is based on first creating a backup 
structure, that later can be used to salvage data packets 
that passes through nodes with link failures. Since the 
alternative path usually is longer than the primary path, 
it typically takes longer for the message to reach its 
destination. Moreover, if the data packets fail to arrive 
at their destination then resources such as, bandwidth, 
routing costs, and power of the mobile nodes are 
unnecessarily wasted. Furthermore, if a mobile node 
broadcasts data packets to be salvaged to its neighbors, 
and there are a large number of neighboring nodes then 
there may be a dramatic increase in wireless traffic due 
to the assistance provided by these neighboring nodes. 
If many nodes help forwarding the data packets, then 
there will be many copies of the same data packets 
spread across the network. This situation is termed as 
spread of salvaged data packets. Unwise selection of 
next hop nodes will magnify the problem. For example, 
any next hop policy spreads data packets in such a 
manner that the problem of transmission collision and 
network contention is increased. 
 
3. The Proposed Routing Protocol 
 
3.1  AODV-BR 1 vs. AODV-BR 2 
 
The backup routing protocol proposed herein is 
derived from AODV-BR. AODV-BR creates only one 
hop alternative paths to form its backup structure in the 
route reply phase, and it doesn’t use extra routing 
packets during the route reply or data salvation phase. 
AODV-BR 1 is based on a fixed next hop policy which 
enhances the rate of data delivery and prevents the 
spread of salvaged data packets which again lead to an 
increase in transmission collisions and contention. 
AODV-BR 1 will hereafter be referred to simply as 
AODV-BR for simplicity. 
One obvious drawback of the AODV-BR fixed next 
hop policy is that there is only one alternative path, i.e., 
the disconnected next hop. Although this policy 
prevents the spread of salvaged data packets, it results 
in resources being consumed by neighboring nodes. To 
resolve these problems and improve performance 
additional node-disjoint paths are employed.  
 
3.2 The Proposed Routing Protocol 
 
The route discovery is performed through the route 
request phase and the route reply phase. Data salvation 
is initiated when a mobile node encounters a link 
failure. The route request mechanism described in [9] 
is adopted for creating multiple node-disjoint paths, i.e., 
several paths which have no intermediate nodes in 
common. However, only one additional node-disjoint 
primary path is created in addition to the first primary 
path for the session pair. This strategy was chosen as 
the route independence property of node-disjoint 
multi-path allows data transmissions on different paths 
of the session pair without affecting each other. 
Moreover, this route discovery mechanism has been 
shown to have small routing costs and transmission 
delays. Next, the two node-disjoint multiple paths of a 
session pair are established by the destination node at 
the same routing protocol run and are therefore both 
guaranteed suitable for data transmission. Finally, load 
balancing can easily be incorporated into the scheme 
such that larger part of the network can be utilized 
under heavy traffic conditions. NDAMR is illustrated 
in Figure 3. 
 
 
 
 
 
2. Duplicate RREQ packets are compared with the 
one stored in the route table. Only the one that is 
both shortest and node-disjoint is kept. Next, a 
RREP packet is returned to the source node. 
3. Algorithm 1 is applied by intermediate node that 
receives the RREQ packet. 
 
3.2.3 Data Salvation 
 
Once a mobile node on the primary path faces a link 
failure a one-hop data broadcast is transmitted to its 
neighbors that then use the following Algorithm 2. The 
neighbors have at least two choices, namely to use the 
second primary path or the alternative paths. 
 
Algorithm 2: NDAMR data salvation backup 
strategy (action performed by neighboring nodes) 
 
1 
2 
3 
4 
5 
6 
7 
8 
9 
10 
11 
12 
13 
14 
if (active alternative path to destination) 
then 
   if (condition 1) and (condition 2) then 
     
DataPkt_Next_Hop:=Alternative_Next_Hop;
      forward data packets; 
      break; 
   endif 
else if (active primary path to destination) 
then 
   if (condition 1) then 
      DataPkt_Next_Hop : = 
Primary_Next_Hop; 
      forward data packets; 
      break; 
   endif 
else drop it; 
endif 
 Definitions: 
DataPkt : the broadcasted data packet sent 
by the node with a link failure. 
DataPkt_Next_Hop : the next hop of the 
broadcasted data packet. 
Alternative_Next_Hop : next hop along 
the alternative path. 
Primary_Next_Hop : next hop along the 
primary path. 
 Conditions: 
1. My active path’s next hop is not the hop 
that needs help. 
2. My alternative path’s next hop is exactly 
the disconnected hop. 
 
 
4. Simulation Environment 
 
This study employs NS-2 [8] software tools for 
network simulations, Distributed Coordination 
Function (DCF) of IEEE 802.11 for wireless LANs is 
used as the MAC layer protocol, and Lucent’s 
WaveLAN is used as the radio model. WaveLAN 
supports a nominal bit rate of 2 Mb/s and a radio range 
of 250 m. 
The simulations are based on constant bit rate (CBR) 
traffic sources and 64 packet send buffers. The data 
packet payload is 512 bytes. Packets are dropped if 
they remain in the send buffer for more than 30 
seconds. All packets sent by the routing layer are 
queued in the interface queue which has a maximum 
capacity of 50 packets. Routing packets have higher 
priority than data packets. 
A total of 50 mobile nodes were placed into a 
square area of 1000 X 1000 m2. Each simulation was 
run for 180 seconds. Each data point on the simulation 
curves in the figures represents an mean of five 
protocol runs with identical traffic/mobility scenarios. 
Identical mobility or traffic scenarios are used across 
the protocols discussed herein. 
During the simulations the following performance 
measures were used [10-16]. The packet delivery rate 
defines the ratio of data packets successfully delivered 
to the destination nodes to those generated by the CBR 
sources. 
 
 
                                                        
(1) 
 
 
 
The mean end-to-end delay of data packets includes 
all possible delays caused by buffering during route 
discovery latency, queuing at the interface queue, 
retransmission delays at the MAC, data salvation 
latency, and propagation and transfer times. It is 
defined as 
 
 
(2)
 
 
The normalized routing load defines the number of 
routing packets transmitted per data packet delivered at 
the destination node. Each hop-wise transmission of a 
routing packet is counted as one transmission. It is 
given by. 
 
 
packets data received
packets routing  load routing Normalized =
packets data received
latency total delay  Average =
 
packets datasent 
packets data received  ratedelivery Packet =
 
Fig. 7. Mean delay time (Simulation 2) 
 
 
Fig. 8. Normalized routing load 
(Simulation 1) 
 
 
 Fig. 9. Normalized routing load 
(Simulation 2) 
 
 
6. Conclusions 
 
This study addresses the characteristics of 
AODV-based routing protocols, and how different 
backup strategies affect network performance. In 
particular, the study addresses how to design a backup 
strategy and node choice policy to prevent transmission 
collisions and contention. Although AODV-BR 
delivers an acceptable data delivery rate, its backup 
policy limits the choices during data salvation. In order 
to improve the data delivery ratio without increasing 
the spread of salvaged data packets, which leads to 
transmission collisions and network contention, 
node-disjoint multi-path are employed. Simulation 
experiments confirm that NDAMR improves the data 
delivery rate and limits the amount of transmission 
collisions and network contention. 
 
7. Acknowledgements 
 
This work was supported in part by Taiwan 
Information Security Center (TWISC), National 
Science Council under the grants NSC 
95-2218-E-001-001, NSC95-2218-E-011-015, and 
NSC95-2221-E-029020 -MY3. 
 
 
8. References 
 
[1] E. M. Royer, C. K. Toh, A Review of Current Routing 
Protocols for Ad Hoc Mobile Wireless Networks, IEEE 
Personal Communications Magazine, Vol. 6, No. 2, April 
1999, pp. 46-55. 
 
[2] C. E. Perkins, E. M. Royer, Ad Hoc On-demand Distance 
Vector Routing, The 2nd IEEE Workshop on Mobile 
Computing Systems and Applications (WMCSA’99), 
New Orleans, LA, 25-26 Feb. 1999, pp. 90-100. 
 
[3] D. B. Johnson, D. A. Maltz, Dynamic Source Routing in 
Ad Hoc Wireless Network, in: T. Imielinski, H. Korth 
(Eds.), Mobile Computing, Kluwer Academic Publishers, 
1996, pp. 153-181. 
 
[4] S.-J. Lee, M. Gerla, AODV-BR: Backup Routing in Ad 
Hoc Networks, Proceedings of IEEE Wireless 
Communications and Networking Conference (WCNS 
2000), Vol. 3, Chicago, IL, 23-28 Sept. 2000, 
pp.1311-1376. 
 
[5] H.-L. Chen, C.-H. Lee, Two Hops Backup Routing 
Protocol in Mobile Ad Hoc Networks. Proceedings of the 
11th IEEE International Conference on Parallel and 
Distributed Systems (ICPADS 2005), Vol. 2, Fukuoka, 
Japan, 20-22 July 2005, pp. 600-604. 
 
[6] C.-T. Kuo, C.-K. Liang, A Meshed Multipath Routing 
Protocol in Mobile Ad Hoc Networks, The 7th IEEE 
International Conference on Parallel and Distributed 
Computing, Applications and Technologies (PDCAT 
2006), Taipei, Taiwan, 4-7 Dec. 2006, pp. 306-310. 
 
[7] W.-T. Chen, W.-T. Lee, Dynamic AODV Backup 
Routing in Dense Mobile Ad Hoc Networks, IFIP 
International Conference on Wireless On-Demand 
Network Systems (WONS 2004), LNCS 2928, Trento, 
Italy,  21-23 Jan. 2004, pp. 158-170. 
 
[8] K. Fall and K. Varadhan (Eds.), Ns Notes and 
Documentation, 1999, available from http://www- 
mash/cs.berkeley.edu/ns/. 
 
[9] X. Li, L. Cuthbert, On-demand Node-disjoint Multipath 
Routing in Wireless Ad Hoc Networks, Proceedings of 
the 29th Annual IEEE International Conference on Local 
 附件一 
行政院國家科學委員會補助專題研究計畫 ■ 成 果 報 告   
□期中進度報告 
 
分散式網路安全系統在嵌入式平台之設計與實作 
 
計畫類別：■ 個別型計畫  □ 整合型計畫 
計畫編號：NSC95－2221－E029－020－MY3             
執行期間： 95 年 08 月 01 日至 98 年 07 月 31 日 
 
計畫主持人：林祝興 教授 
共同主持人：江輔政講師、李鴻文博士 
計畫參與人員： 陳慶儒、鍾蓉蓉、徐煒程、楊宗哲 
 
成果報告類型(依經費核定清單規定繳交)：□精簡報告  ■完整報告 
 
本成果報告包括以下應繳交之附件： 
■赴國外出差或研習心得報告一份 
□赴大陸地區出差或研習心得報告一份 
□出席國際學術會議心得報告及發表之論文各一份 
□國際合作研究計畫國外研究報告書一份 
 
 
處理方式：除產學合作研究計畫、提升產業技術及人才培育研究計畫、列管
計畫及下列情形者外，得立即公開查詢 
          □涉及專利或其他智慧財產權，□一年■二年後可公開查詢 
          
執行單位：東海大學資訊工程與科學系 
 
中   華   民   國  98  年  07  月   31  日 
Abstract 
Due to the impact of the rapid popularization of Internet and e-commerce, most 
organizations and enterprises make great effort to protect their information systems 
against malicious attacks and invasions. The firewall is the most general method 
among related technologies for the Internet security. However, the firewall systems in 
use today are either application software or utilities running on the PCs or network 
nodes. It is very inconvenient to implement and manage the conventional firewalls. 
Besides, the conventional firewall system only prevents attacks and invasions from 
extranet, ignoring threats from intranet. 
In order to make the management and construction of firewall systems easier without 
disrupting the existing network topology, in this thesis, we implement an embedded 
and distributed firewall system to safeguard the Internet. In this way, we compact the 
functions of the firewall into an embedded system, which can be realized as a network 
interface card, and set it up on each personal computer in organizations or enterprises. 
And we also build a central security policy server to control these embedded and 
distributed firewall systems. According to the security level of each PC, the network 
manager can make different packet filter policies to different PCs through the central 
security policy server. Therefore, by using our framework, the organizations or 
enterprises can effectively prevent the attacks and threats from extranet and intranet as 
well. 
 
Keyword: distributed firewall, embedded system, central security policy server, SOC 
hardware platform
 圖目錄 
 
圖一. 傳統防火牆的結構.............................................................................................8 
圖二. 嵌入式系統的架構.............................................................................................9 
圖三. EFW-NIC的架構 ...............................................................................................12 
圖四. DSS的系統架構 ................................................................................................13 
圖五. DSS的資訊回饋關聯圖 ....................................................................................14 
圖六. DSS的安全政策控制關聯圖 ............................................................................15 
圖七. DMA-270L外觀 ................................................................................................16 
圖八. DMA-270L晶片組 ............................................................................................17 
圖九. S3C2410 晶片組................................................................................................17 
圖十. DSS策略決定及傳送規則至EFW-NIC流程圖................................................21 
圖十一. IDS 收集的各個syslog資料其中一筆 .........................................................22 
圖十二. EFW-NIC的初始狀態畫面 ...........................................................................22 
圖十三. CSPS的控制畫面 ..........................................................................................23 
圖十四. 選擇指令選項畫面.......................................................................................23 
圖十五. CSPS處理訊息畫面 ......................................................................................24 
圖十六. EFW-NIC處理訊息畫面 ...............................................................................25 
圖十七. 中央控管策略的測試結果...........................................................................25 
圖十八. EFW-NIC在Client PC一般使用下的網路流量 ...........................................26 
圖十九. EFW-NIC在Client PC遭受到SYN洪水攻擊時的流量圖 ...........................27 
圖二十. EFW-NIC在Client PC遭受到Ping洪水攻擊時的流量圖 ............................28 
圖二十一. EFW-NIC在Client PC主動對外發出SYN洪水攻擊時的流量圖 ...........29 
 
 
 
 2
 第一章 序論 
  近年來，隨著網際網路與電子商務之日漸普及，各政府機構、民間企業為了
防範資訊系統遭受入侵或攻擊，皆積極投入資源，採用各種網路安全相關技術，
來強化其網路安全的防護能力[1]。 
  在網路安全技術這塊領域已提出許多相關研究，像是 IP 追蹤技術[2-3]，封
包分析技術[4-7]，等。在美國網路安全技術使用的調查中，Gordon 等人曾表示
載他們的 678 個受訪者中，以防火牆技術是最為主流地廣泛使用[8]，佔有率高
達 97%。然而，大多數仍採用傳統的防火牆架構，所謂的傳統防火牆架構即是使
用任何防火牆應用軟體或程序運作在個人電腦或網絡節點上。因此傳統的防火牆
通常是建構在的組織或企業網絡出入口。但，傳統防火牆的架構卻存在著一些嚴
重的問題及缺陷。 
  首先，因傳統防火牆的架構將防火牆建置在網路的唯一的出入口，若任何防
火牆因電力耗損或者招受到外部的洪水攻擊，在組織或企業內部的所有電腦設備
將被無法對外連線至網際網路。 
  此外，對於企業組織的 IT 資訊管理來說內部網路的威脅也是個無可避免的
一大問題，舉例來說，如果有個員工使用企業組織內部的電腦來收發電子郵件，
在無意之中開啟惡意的電子郵件，讓自己目前使用的電腦感染蠕蟲病毒，更透過
內部網路傳播出去，轉眼間，企業組織的內部所有其他的電腦因此中毒，導致內
部網路壅塞。再舉另一例，若企業組織中，有位心懷不軌的員工，透過內部網路
竊取得企業組織的重要資訊，如人力資源編排，自家產品的獨特技術，來往客戶
名單等等，然後兜售給競爭對手，這樣會造成企業組織在營業上、競爭力，等方
面受到重大的損害。 
  因此，此研究計畫實作出一套「分散式安全防禦系統」(Distributed Security 
System , DSS)：將網路卡中嵌入防火牆並且透過中央安全政策機制，以改善傳統
 4
 第 2 章 背景介紹 
 在這個章節中，我們將會在第一節介紹相關的防火牆技術，並在第二節詳盡
的介紹嵌入式系統的平台架構以及列出一些重要的特徵以將來用作開發之用 
 
第一節 防火牆技術 
  防火牆技術可以以特徵被歸類為以下三種不同的防火牆[9-13]: 
 封包過濾防火牆 
 應用代理伺服器防火牆 
 狀態檢驗式防火牆 
  封包過濾防火牆是最早被提出並使用的防火牆技術。這種防火牆通常架設並
運作於開放系統架構(OSI)所制定的網路七層架構(OSI 7 Layer)中的網路層
(Network Layer)。在此之後，動態的封包分析過濾的技術也被用於網路七層架構
中的傳輸層(Transport Layer)。這種封包過濾防火牆的技術通常用來進行監視經
過網路層以及傳輸層的封包，同時分析每個封包的資料，例如：封包標頭、通訊
協定種類、來源及目的網址…等等。此時，封包過濾防火牆會針對封包的資料與
防火牆所設定的規則進行驗證，如果不符合該規則，則將該封包進行丟棄。此類
防火牆的優點在於可以易於建置，並且使用很少的成本即可達成效益。 
  應用代理伺服器防火牆則是運作於 OSI 七層架構中的最高層 — 應用層
(Application Layer)。 這種防火牆技術可以實踐較高層級的網路防禦技術以用來
對付阻擋一些新型的網路攻擊。當封包資料在傳輸的過程中，應用代理伺服器防
火牆會使用代理伺服器進行封包的轉送。而在這個轉送的過程中，會讓使用者感
覺不到代理伺服器防火牆的存在，使用者將會以為自己是直接與目標主機進行連
線。藉由這個封包轉送的過程，我們可以在代理伺服器防火牆上實踐應用層封包
資料的分析與阻擋，以保護我們的目標主機。這種防火牆的優點是較為安全牢
 6
  
圖一. 傳統防火牆的結構 
 
 在這個研究計畫中，我們的研究終點將放在如何將防火牆工作的層級從應用
層移到網路層，這個概念主要是嘗試降低防火牆在工作上所對主機造成的效能影
響。此外，我們也將防火牆技術建構在一個具有處理器、記憶體、以及介面功能
的嵌入式平台上。換個角度而言，我們嘗試將該嵌入式平台建構成一個具有防火
牆功能的網路介面裝置，並將其應用在個人電腦上已達到分散式網路防火牆的效
果。 
 
第二節 嵌入式系統 
  嵌入式系統 [16-18]就像是一個小型的電腦系統. 廣泛來說，嵌入式系統具
有以下的幾點特色： 1) 存在一個微處理器及相關的軟體。 2) 具有兩種的記憶
儲存裝置， ROM 以及 RAM。  3) 具有輸入輸出的裝置，例如：螢幕裝置、
通用序列傳輸裝置、PCI 插槽、序列裝置、音效輸入輸出…等等。 4) 體積小，
 8
 本、以及電力消耗的考量，我們選擇了 ARM 作為我們的系統單晶片硬體平台的
微處理器核心[19-21]. 
  同時，在目前的主流市場也有兩大嵌入式平台的作業系統主流： Microsoft 
Windows CE 以及 Linux-based. Linux-based 作業系統由於其開放原始碼的特
色，使得該系統有著很大的彈性可以進行開發，我們可以針對我們個別的需求去
修改並編譯 Linux 系統的核心架構，並依照我們的需求增加或減少所需要的裝置
驅動程式。同時，由於其依循著開放原始碼的精神，在網路上可以找到許多開放
原始碼的軟體以及程式可供開發參考之用，可大幅減少在開發過程的瓶頸。 最
後，還有一個特點便是 Linux 為一共享的作業系統，所以可以減少在實作上的作
業系統版權成本開銷。有鑑於以上的各種優點，我們選擇了 Linux-based 作業系
統作為我們的系統單晶片核心。  
 
 
 
 10
 統的 Linux-based 作業系統上。藉由這樣的裝置特色，我們可以將遷入式系統以
通用序列輸入輸出(USB)的裝置連結到個人電腦，並同時利用網路介面裝置將嵌
入式系統連結到網路世界。藉由這樣的設計，我們將嵌入式系統設計成一張個人
電腦使用的網路介面卡(NIC)。經由這樣的設計，我們將其命名為嵌入式防火牆
網路介面卡(Embedded Firewall NIC)，或簡稱為 EFW-NIC。 
  圖三顯示了分散式安全系統的簡易架構，我們可以看到其中包含了 Client 
PC、EFW-NIC、以及 CSPS，同時在圖中也看到 CSPS 可對 EFW-NIC 下達規則
以及收集資料。在這個設計中，我們把 EFW-NIC 當成是一個 NIC。他所負責的
工作就是負責將 Client PC 以及外部網路進行連結。而這個 client PC 則是一個正
常的網路使用者，且其被分散式安全(DSS)系統所保護著。此時， EFW-NIC 透
過 USB 傳輸線與 Client PCs 進行連結與資料傳輸。透過 USB 的架構，達成了
我們在設計嵌入式防火牆系統時，所提到的必須使用通用性的一個架構的目的。  
 
 
圖三. EFW-NIC 的架構 
 
第三節 DSS & CSPS 
  中央安全政策主機包含了以下三個運作機制： 
 中央安全政策管理機制 
 EFW-NIC 存取控制 
 入侵偵測回應 
 12
   入侵偵測回應機制會收集 EFW-NIC 所傳回來的 log 檔案，同時將所蒐集到
的 log 檔案傳送到入侵偵測系統(IDS)進行分析，而當 IDS 進行資料分析之後，
會再將分析的結果傳送回 CSPS。藉由這些 IDS 所傳送回來的結果，CSPS 可以
獨立且動態的調整在系統環境中的每個 EFW-NIC 的防火牆規則。藉由這樣的設
計，可以讓系統更加安全及更有彈性。 
  根據設計，這三個運作機制是互相依存以及互動。中央安全政策管理機制的
統計分析資料庫用來蒐集並儲存入侵偵測回應機制所回應並傳回的 Syslog log
資料。中央安全政策管理機制的資訊統計分析機制根據回傳的 EFC-NIC 的狀態
以及查詢統計分析資料庫 EFW-NIC 存取控制機制的信息回饋進行分析。再來，
統計分細資料庫接受並儲存從資訊統計分析機制分析的結果。上述的過程以圖五
表示。 
 
 
圖五. DSS 的資訊回饋關聯圖 
 
 14
 第四章 系統實作  
  以下為本章的各章節簡介：在第一節中我們將介紹 EFW-NIC 硬體設備及使
用的套件，第二節中將描述 CSPS 的硬體設備、軟體以及我們的程式運作。  
 
第一節 EFW-NIC 實作  
  EFW-NIC 的硬體架構為有著 Intel XScale PXA270 520MHz 處理器的嵌入式
開發版，上面配有 USB 1.1 及 10M/100M 的標準網路介面。圖七和圖八為此 SOC
的硬體平台。此用的作業系統核心為 ARM Linux 2.9.6，此平台包含了下列另加
入套件：iptables 1.3.7、 bridge-utils 1.2、 busybox 1.13.4、 net-snmp 5.4.2.1，及
我們所開發的程式。 
   
 
圖七. DMA-270L 外觀 
 16
   我們也使用另外一個 SOC 硬體平台，其為 Sumsung S3C2410 266MHz 處理
器，搭配 USB 1.1 及 10M/100M 的標準網路介面。其晶片組外觀呈現於圖九。其
搭載的作業系統核心則為 ARM Linux 2.9.14，其中也加入下列套件 iptables 1.3.7、 
bridge-utils 1.2、 busybox 1.13.4、 net-snmp 5.4.2.1，及我們所開發的程式。 
  Iptables [22]為 Netfilter.org 的其中專案之一，他能在 Linux 環境下執行，透
過下指令的方式建立封包過濾規則。我們使用它來控制 EFW-NIC 的進出流量和
過濾封包。 
  Bridges 可針對兩種網路硬體介面做連結的功能，並且在其之間轉送封包。
EFW-NIC 因加入此套件的功能：我們將 USB host 介面透過 bridge-utils [23]與乙
太網路卡做連結，使得 EFW-NIC 可視為一張 USB 的網路卡。 
  既然嵌入式系統為小型的電腦，且為了能配合使用者的需求，所以在檔案系
統中並未將包含像一般 PC 所有的指令程式或工具。BusyBox [24]結合了許多
UNIX 工具包成一個小型版本，它能提供標準的 UNIX 指令程式及工具，而我們
使用它來安裝一些網路相關的指令程式。 
  簡單網路管理協定(Simple Network Management Protocol, SNMP)為受歡迎的
網路管理系統之一。我們可以透過它所提供的功能來監控我們網路設備，譬如網
路流量等等其他相關資訊。我們對 Net-SNMP [25]做交叉編譯後放入 EFW-NIC
以便我們來監控 DSS 中每一台 EFW-NIC。 
 
第二節 CSPS 實作 
  使用一般的電腦即可來實作 CSPS，我們使用 AMD Opteron 146 2.0GHz 處理
器、1GB 記憶體的電腦來實作，其作業系統為 Ubuntu 8.04，它包含了 Apache 2、
Mysql Sever 5.0、snmp 5.4.1 和 Cacti 0.8.7b。 
 18
 第五章 實驗結果 
  以下為本章的各章節簡介： 第一節測試 EFW-NIC 能有如同一般網路卡的
功能。第二節測試 CSPS 傳送防火牆規則給 EFW-NIC 是否能成功控制 EFW-NIC
網路行為。第三節則是監控 EFW-NIC 狀態。 
  
第一節 EFW-NIC 的網路功能  
  首先，我們要確定 EFW-NIC 能如同有一般網路卡功能，我們測試在有線和
無線的環境下。我們透過從區網中的 FTP 站下載超過 2GB 大容量的 ISO 檔來做
測試，從表一可以看到實驗結果，將 EFW-NIC 設定成有線環境，可以見到
EFW-NIC 連結網路的傳輸平均可達 935KB/s，可證明 EFW-NIC 可像一般網路卡
網路傳輸量，如果能換到 USB 1.1 的介面，改成 USB 2.0，會有更好的傳輸結果。
在無線設定的環境下，傳輸平均則可達 550KB/s，相較之下比有線速度慢了許
多，那是因為需要將再 EFW-NIC 嵌入式開發版上的無線網路卡做 MAC 位址轉
換，需要花額外的時間去處理封包轉換至無線網路上，大致上不會影響正常網路
的使用。 
 
表一. EFW-NIC 的有線及無線環境下 FTP 下載速度 
State The speed of ISO file download from FTP site Average
Wire (KB/s) 907 931 921 923 915 957 954 949 953 952 936.2 
Wireless(KB/s) 553 572 538 558 548 582 567 542 516 534 551 
 
第二節 DSS 安全策略測試 
  整個 DSS 系統包含了三個部份：EFW-NC、CSPS 及 IDS，EFW-NIC 為 Client 
PC 的網路卡，Client PC 需透過 EFW-NIC 才能上網。IDS 收集且監控區網內外
 20
 Client PC 的 EFW-NIC 的確能正常運作，在初始狀態下 EFW-NIC 是沒
有任何的防火牆規則。  
 
 
圖十一. IDS 收集的各個 syslog 資料其中一筆 
 
 
圖十二. EFW-NIC 的初始狀態畫面  
 
步驟 3. CSPS 得到從 IDS 收集來的 syslog 後，這些 syslog 被記錄在我們監控的
程式中。DSS 系統網路管理者因為這些可疑的 syslog 資訊而修改此
EFW-NIC 的防火牆規則，圖十三呈現 CSPS 的控制畫面。 
 22
 步驟 4.  DSS 系統網路管理者可以選擇各項選項包含：流入、流出、協定、IP
位址、埠號等等來阻擋或接受不同的網路行為。在此範例中，我們從
syslog 中知道成人色情網站的 IP 位址為「119.160.246.242」，可見於圖
十一，在根據此 log，DSS 系統網路管理者做出決策並設定一條防火牆
規則，選擇選項指令的視窗對話圖在圖十四，圖十五和圖十六分別呈現
CSPS 和 EFW-NIC 處理訊息。 
步驟 5. 最後，此 Client PC 被阻擋連線至此成人色情網站 http://119.160.246.242。
圖十七可以看到無法正常顯示網頁，換句話說此成人色情網站已在
CSPS 和 EFW-NIC 阻擋名單中，DSS 系統網路管理者透過維護組檔名單
來達到政策管理。 
 
 
圖十五. CSPS 處理訊息畫面 
 24
 第三節 監控 EFW-NIC 網路狀態 
  首先，我們將普通 Client PC 一般平均的網路流量控制在每秒 25KB，主要是
瀏覽網頁的流量，圖十八可見到 Client PC 上的 EFW-NIC 12 小時內的一般網路
流進流出的網路狀況，流外流量以藍色實線表示，流進流量以綠色且區塊方式呈
現。 
  在尚未受到任何攻擊時，圖十八的網路的流量起伏並不很劇烈，維持在 25KB
上下的水平。 
 
圖十八. EFW-NIC 在 Client PC 一般使用下的網路流量 
 
一、 SYN 洪水攻擊 
  我們利用 SYN 洪水攻擊來研究 EFW-NIC 的流量反應，我們使用的 SYN 洪
水攻擊並未使用 IP 欺騙的技術，而實驗的網路流量結果呈現於圖十九。  
  我們每秒送 30 個 SYN 封包且封包大小是依據攻擊電腦的網路卡的能力，若
處理能力越大，封包容量則大；反之，封包容量則小。攻擊開始時間為 11:00 持
 26
 牆規則至 EFW-NIC，因為規則生效，流外的藍色流量線瞬間降回正常，流進的
流量也降下三分之二。再經過 60 分鐘後，結束攻擊 
  透過 SYN 和 Ping 的洪水攻擊，我們可以確定防火牆規則能夠正常在
EFW-NIC 上生效。 
 
圖二十. EFW-NIC 在 Client PC 遭受到 Ping 洪水攻擊時的流量圖 
   
三、EFW-NIC 對外 SYN 洪水攻擊 
  最後，我們要測試 DSS 是否能阻擋內部的攻擊，因此我們做了 SYN 洪水攻
擊從 Client PC 發出，其中我們也並未採用 IP 欺騙的技術。實驗結果的流量圖於
圖二十一。 
  從 17:30Client PC 每秒傳送 60KB 大小的 SYN 封包攻擊外部電腦，攻擊持續
90 分鐘，我們可以明顯看到流進流外的流量高出平常 20 倍之多。經過 30 分鐘
的攻擊後，我們傳送防火牆規則至 EFW-NIC，流進流外的流量瞬間降回正常值，
那是因為我們成功阻擋了攻擊封包再對外發送。 
 28
 第六章 結論與自評 
  經過三年來的研究與實驗，在本研究計畫中，我們實作出一個分散式的防禦
機制，分散式防火牆的概念能夠預防外部的攻擊及防禦對內的威脅。我們將防火
牆的功能結合中央控管機制放入網路介面卡之中。並且架構好所需的入侵偵測系
統，達成自動安全政策散佈與防禦的功能；管理者手動進階操作以及攻擊警示訊
息分析的部分也大致完備，能順利針對攻擊警示進行持續性的記錄並予以自動更
新嵌入式防火牆網卡端的可移封包過濾政策，這不僅僅是入侵偵測，我們更達成
分散式嵌入式防火牆的快速入侵預防功能，完成主動預防勝於事後補救之中央安
全政策管理服務。 
  而實驗結果明確地顯示出我們的「中央安全防禦系統」的確能夠達到我們提
出的目標：透過每個單一網路卡上的防火牆功能，而且網路卡能夠做到攜帶性及
便利性。我們也將透過監控系統讓網路管理者能透過圖形介面及時發現網路上的
任何網路異常行為，並且再第一時間達到有效的阻擋，並且持續地維護組檔名單
和不同等級的防火牆規則。 
  因透過此計畫的執行，三年內總共發表了七篇國際期刊論文，以及二十七篇
國際會議論文，這都必須感謝國科會經費的幫助，才能有如此良好的成果。我們
亦會更加多方研究思考，提出更具有發展性的新穎計畫。 
  
 30
 [7] Kuo Zhao, Kexin Yang, Meng Zhang, Jinling Wang, Liang Hu, "Denial of 
Service Attack Simulation Based-on CASL," Proceedings of the IEEE 
International Workshop on Anti-counterfeiting, Security, Identification, 
pp.266-269, 16-18 Apr. 2007. Xiamen, Fujian, China. 
[8] Lawrence A. Gordon, Martin P. Loeb, William Lucyshyn, Robert Richardson, 
"CSI/FBI Computer Crime and Security Survey," 2005. Available at 
http://www.cpppe.umd.edu/Bookstore/Documents/2005CSISurvey.pdf. 
[9] William R. Cheswick, Steven M. Bellovin, Aviel D. Rubin, Firewalls and 
Internet Security: Repelling the Wily Hacker, Addison-Wesley Professional, 
1994. 
[10] Michael R. Lyu, Lorrien K. Y. Lau, "Firewall Security: Policies, Testing and 
Performance Evaluation," Proceedings of the 24th Annual International on 
Computer Software and Applications Conference (COMPSAC 2000),  
pp.116-121, 2000. Taipei city, Taiwan. 
[11] Robert Zalenski, "Firewall technologies," Potentials, IEEE, vol.21, no.1, 
pp.24-29, Feb.-Mar. 2002 
[12] Linux Firewall Project, Available at http://www.linuxfirewall.org 
[13] R. Zalenski, Marc Boucher, James Morris, Harald Welte, The netfilter/iptables 
project, Available at http://netfilter.samba.org 
[14] Lewis Z. Koch, "Outsourcing Security, " ZDNet Interactive iWeek, 22 Jun. 2000. 
Available at http://www.lzkoch.com/column_06.html 
[15] Steven M. Bellovin, "Distributed Firewalls", Journal of Login, pp. 39-47. 
November 1999. 
[16] 江元新, “Linux 核心開發與實務－Interl Xscale PXA270,” 長高科技, 2006. 
ISBN: 986-81862-2-6. 
[17] 謝文川, “INTEL IXP425 ARM 嵌入式 Linux 系統原理與實務,” 學貫行銷股份
 32
行政院國家科學委員補助國內專家學者出席國際學術會議報告 
報 告 人 
姓 名 林 祝 興 
服務機關
及職稱 
東海大學資訊工程與科學系 
教授 
時間 
 
會議地點 
97年12月1日～12月4日
 
紐西蘭但尼丁 
奧塔哥大學 
本會核定 
補助文號 NSC95-2221-E-029-020-MY3
會 議 名 稱 
(中文)第九屆國際平行與分散計算應用技術研討會 
(英文) The Ninth International Conference on Parallel and Distributed Computing, 
Applications and Technologies (PDCAT'08) 
發表論文題目 
(英文) Paper accepted: 
Node-disjoint Alternative Dual-path Routing for Data Salvation in Mobile Ad hoc 
Networks 
報告內容： 
 
一、參加會議過程 
 
 
二、與會心得 
 
 
三、考察參觀活動 
 
 
四、建議 
 
 
五、攜回資料名稱及內容 
 
 
六、其他 
 
園，因奧塔哥大學是紐西蘭最古老的大學，其建築屬哥德式建築風格，典雅而卻具英國風味。而
奧塔哥大學位落於但尼丁，但尼丁屬於南島的第二個大城市，因人口以蘇格蘭移民居多，故建築
的風格多為蘇格蘭風；但尼丁的火車站亦是著名的景點之一，尼丁車站是由建築師 George 
A.Troup 設計，建於1906年，按照Flemish Renaissance的風格，設計了但尼丁火車站，外表用了許
多石材建築，候車室以烏釉陶瓷磚鑲嵌並配以皇家島頓馬賽克地板，外表像極了巧克力做成的薑
餅屋。而但尼丁的鮑德溫街是金氏世界紀錄上最陡的街道。也參觀了號稱南半球唯一的古堡拉納
克城堡，等其他景點。這四天的行程下來，除了欣賞紐西蘭但尼丁的優美建築，也對紐西蘭南島
的大自然景色感到心曠神怡。 
 
四、建議 
9th International Conference on Parallel and Distributed Computing, Applications and Technologies 
(PDCAT'08)國際研討會，是具有前瞻性的國際會議，其中探討了許多平行與分散計算等相關應用
的趨勢並且展現出各位學者不同創新技術與建議，經過各學者發展與討論，讓參與會的人員都深
感獲益良多。希望未來我國能不斷地爭取類似的國際研討會主辦權，相信這將會對我國的學術活
動有正面的意義及幫助，並且可以提升我國的平行與分散計算相關資訊競爭力。 
 
 
五、攜回資料名稱及內容 
Ninth International Conference on Parallel and Distributed Computing, Applications and Technologies 
PDCAT 2008 
會議論文集共一本 
Libtrace Live CD 
光碟共一張。 
 
六、其他 
本人參加這次在紐西蘭但尼丁奧塔哥大學9th International Conference on Parallel and Distributed 
Computing, Applications and Technologies (PDCAT'08)國際研討會感覺獲益良多，除了聽取許多外
國學者的研究成果之外，也順道參觀了奧塔哥大學的校園及一些紐西蘭的風景名勝並享用了當地
精緻美食，為此莊嚴的學術研討會增添了一絲輕鬆的氣息。最後本人特別感謝行政院國家科學委
員會補助本人經費，使本人有機會能到紐西蘭參與此次盛會。未來，希望國家能讓更多的人有機
會能參與類似的研討會，進而提升國內學者的學術涵養與實務能力。 
 
 

establishes one valid primary path together with 
several other alternative paths during a successful 
protocol run. After the backup structure (or alternative 
paths) of the primary path is established, it can be used 
for data salvation when a mobile node on the primary 
path encounters a link failure. Backup routing 
protocols may need to face the problem of transmission 
collision and contention, which is caused by the 
additional traffic incurred by the backup strategy. 
Figure 1 depicts several well-known AODV-based 
backup routing protocols. 
This study addresses AODV-based backup routing 
protocols, in particular AODV-BR [4]. The 
performance characteristics of backup routing 
protocols are analyzed and a novel backup routing 
strategy based on the concept of extra node-disjoint 
multi-paths [14-18] is proposed to overcome the 
shortcomings of existing protocols. The proposed 
routing strategy is coined the term: Node-Disjoint and 
Alternative Multi-path Routing (NDAMR). 
Furthermore, a series of simulation experiments to 
demonstrate the reliability and efficiency of NDAMR. 
The results also show that NDAMR can improve the 
data delivery performance and reduce the frequency of 
transmission collision and contention. 
 
 
 
Fig. 1. The backup structure of (a) AODV-BR, (b) 
2HBR, and (c) AODV-MM. 
 
 
2. Background 
 
In this section, the relevant AODV-backup routing 
protocols are addressed. The technical background 
regarding the backup structure and the data salvation 
scenario are in detail explored before proposing our 
approach. And the critical defect embedded in the 
AODV-backup routing protocols , due to the spread of 
salvaged data packets , is also described in the 
following paragraphs. 
 
2.1 AODV-BR (AODV-Backup Routing) 
 
AODV-BR [4] establishes one primary path 
together with alternative paths during its route reply 
phase. Intermediate nodes overhear radio broadcasted 
RREP packets and set up alternative paths in their 
routing tables. Once a mobile node of the primary path 
encounters a link failure, it adopts a one hop data 
broadcast of data packets that need to be saved. The 
one hop data broadcast operation changes the headers 
of the data packets such that it contains the routing 
information of the node suffering from link failure, the 
disconnected hop, and the destination. Neighboring 
nodes overhear the one hop data broadcast and adopt 
the pre-defined backup strategy to salvage the data 
packets. Figure 2 illustrates the AODV-BR backup 
structure and data salvation strategy. 
 
Primary path Alternate path
 
Fig. 2.(a) AODV-BR backup structure. 
 
 
 
Fig. 2.(b) AODV-BR data salvation. 
 
 
(b) Route reply phase  
 
(c) Data salvation  
 
 
 
Fig. 3. NDAMR route discovery and maintenance 
phases. 
 
3.2.1 Route Request Phase 
 
NDAMR establishes two node-disjoint primary 
paths for a session pair. Node-disjoint paths are route 
independent which means that they do not have any 
common intermediate nodes and they will therefore not 
affect each other during data transmission. The steps 
regarding the route request phase are listed as follows: 
 
Route request phase 
 
1. Adopt the route request mechanism described  
herein and accumulate route information. 
2. A source node without a valid path to the  
destination node originates a RREQ packet, 
appends its own address in the route record 
before  broadcasting it. 
3. Algorithm 1 is applied by intermediate node that 
receives the RREQ packet. 
 
Algorithm 1: Recording the shortest hop count. 
 
1
2
3
4
5
6
7
8
9
10
11
12
if (duplicated RREQ packet) and  
(the path is longer) then 
   drop it; 
else if (the shortest path to the source) 
then 
   Shortest_Hop:= RREQ_Hop_Count; 
   Previous_Hop_to_Source:= 
RREQ_Previous_Hop; 
   Route_Record.append(My_Address); 
   RREQ_Hop_Count += 1; 
   re-broadcast the RREQ packet; 
else drop it; 
endif 
Definitions: 
RREQ_Hop_Count : the RREQ packet 
hop count. 
RREQ_Previous_Hop : the previous hop 
that sent the RREQ packet. 
Shortest_Hop : the shortest hop count of 
the same RREQ packet. 
Previous_Hop_to_Source : next hop of the 
reverse path. 
Route_Record : RREQ packet 
accumulated address list. 
 
3.2.2 Route Reply Rhase 
 
The destination node receives several identical 
RREQ packets with different accumulated paths. These 
paths are then assessed. Only the two shortest paths 
that are node-disjoint are stored in the route tables of 
the source and destination nodes. The steps regarding 
the route reply phase are listed as follows: 
 
Route request phase 
 
1. The first RREQ packet received by the 
destination node is recorded in the route table 
before a RREP packet is returned to the source 
node. 
 
                                                                           
(3) 
 
 
 
 
5. Performance Evaluation 
 
Simulation 1 varies the maximum speed of mobile 
nodes to simulate different degree of network mobility. 
Simulation 2 varies the transmission rate of traffic 
sources to simulate different traffic loads. 
Figures 4 and 5 show the packet delivery rate for 
simulation 1 and 2, respectively. According to Figure 4, 
the data delivery rate of NDAMR is higher than that of 
both AODV and AODV-BR. NDAMR therefore has 
better data delivery efficiency than the other strategies, 
even under high mobility conditions. Figure 5 shows 
that NDAMR has a higher data delivery rate than 
AODV-BR. This improvement is mainly due to the 
improved node selection policy of NDAMR. 
Figures 6 and 7 depict the mean delays for 
simulation 1 and 2, respectively. NDAMR has a 
consistently shorter mean delay than AODV-BR. 
Figures 8 and 9 demonstrate the normalized routing 
load of the two simulations, respectively. Here, 
NDAMR has a lower routing load compared to the 
other strategies. This observation reveals that NDAMR 
efficiently reduces the amount of transmission 
collisions and contention. The mean delay of NDAMR 
is smaller because salvaged data packets have less 
chance of passing through an alternative path which is 
too far off the path to their destination. Routing costs 
are reduced due to the efficient AODV-BR one-hop 
radio broadcast and by avoiding interference through 
multiple node-disjoint paths. NDAMR can improve the 
data delivery rate without the need for more routing 
packets or larger routing tables. Unnecessary 
transmission collisions and network contention are 
effectively avoided. 
 
 
 
Fig. 4. Packet delivery rate (Simulation 1) 
 
 
 
 
 
 
Fig. 5. Packet delivery rate (Simulation 2) 
 
 
 
Fig. 6. Mean delay time (Simulation 1) 
 
 
