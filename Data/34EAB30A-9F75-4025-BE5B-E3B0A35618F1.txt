1 
 
摘要 
本計畫旨在考量結合網際網路應用與無線通訊網路環境，設計一套智慧、自動的
軟體封包分類器，作為激發 QoS 支援之基礎，以啟動通訊系統後續之傳輸參數配對、
資源配置、封包排程、策略擬定等 QoS 相關機制之運作。一個完整的 QoS 分類器有兩
個困難點：(1)分類依據項目不固定；(2)許多應用連線的埠號為動態指定，且每個 data 
session 都會改變，因此也要同時追蹤、分析可能出現在資料封包內其他欄位置的資訊，
例如 FTP 協定之命令、RTP 協定之 Audio/ Video type 等才不至遺漏。 
本計畫之分類器主要分類動作依據有二種方式，分別為：提供給設備管理者「預
先設定分類規則（Predefined approach）」與系統依據傳輸之封包內容與特性自動建立
之「智慧型分類規則（Intelligent approach）」。兩者皆可根據：IEEE802.1p 的協定之
Priority 欄位：IP 標頭 ToS 欄位值、Differential Service 的 Code Point 值、Per-session 每
對通訊的動態 Port Numbers 以及 IP、MAC 位址等之設定值執行分類動作，並賦予其
在不同通訊系統中適當的 QoS 類別（例如：Background traffic(Wi-Fi)、nrtPS(WiMAX)、
Interactive service(3G)）；而智慧型分類規則又可以在無預先設定分類規則狀況下，根
據對 Http 協定追蹤、FTP 的 PORT/PASV mode 追蹤、以及 RTP 協定封裝下之 Payload 
Type 作分類追蹤，自動進行認知並建立新的分類規則，期能將未符合預先設定分類規
則的封包也順利進行分類，所有封包因此將被適當分類以遂行完整之 QoS 支援。  
 
關鍵詞：無線通訊網路(3G-UMTS、Wi-Fi 及 WiMAX)、封包分類、服務品質(QoS)、
差異式服務、及時傳輸協定(RTP)。 
 
Abstract 
Quality-of-Service (QoS) support for either wired/wireless communication networks 
has been proposed for a long time. Many QoS architectures, mechanisms, and components 
were defined. However, to enable the QoS support, packet classification that differentiates 
processing priority for various packets generated by different applications or to be forwarded 
by a router would be the first step to be taken. An intelligent packet classifier plays an 
important role but has to break through two hurdles: (1) Classifying item is not fixed, and (2) 
Port number for a data session is on-demand and changing dynamically as well. Thus, 
tracking and parsing a packet into a certain depth (for example RTP payload type) would be 
necessary. Unfortunately, commercial equipments like WiMAX BS/MS stations adopted 
only the simplest way - the provisioned by manual configuration, and thus cannot 
accommodate the multimedia applications in reality. 
This project designed an intelligent and automatic packet classifier to properly and 
3 
 
術都會以語音和影像應用為主，一旦用戶數量過多、傳輸品質又因為壓縮而降
低，適當的服務品質機制，以便區別不同應用滿足使用者期待，就更顯其必要性
了。 
本計畫目的旨在考量配合一般通訊網路需求下，設計一套通用型、智慧與自
動的軟體封包分類器(smart packet classifier)，作為激發QoS機制運作之根本、啟
動後續之傳輸參數配對、資源配置、封包排程、策略(policy)擬定等與QoS相關機
制之運作，建構一個強而有力的分類系統能夠提供優質的QoS支援，並確保具有
即時性的封包能夠得到良好的服務與適時被傳送的待遇。 
 
二、 系統分析、架構設計與實作測試 
（一）系統分析 
本計畫將定義分類規則（依據）與資料結構，使此分類器能對所有不論
是因用戶端設備（如筆記型電腦）執行應用程式所產生的新封包、或是網路傳
輸設備（如路由器）因要處理轉送的封包 (packet forwarding)，都能被適當處
理與分類，以遂行 QoS 支援。本計畫係以三種無線網路 QoS 為分類對象，故
先將各系統之支援分析定義於後。     
 
1. WiMAX 對 QoS 之支援 
IEEE802.16e-2005 規格書中定義了五種不同的服務類別(Service type)，
各自有不同需求的服務品質參數，依其排程處理上的優先序依次敘述，分別
敘述如下： 
(1) Unsolicited Grant Service (UGS)： 
這類服務支援具及時與週期性且傳輸量固定的資料流，例如目前流
行的 VoIP (不做 silence suppression)及 T1/E1 等，其對 QoS 的需求(指必
要項目)包括了最大持續流量(Maximum Sustained Traffic Rate)、最大延遲
時間(Maximum Latency)及可忍受延遲變動率(Tolerated Jitter)等參數。當
SS 要傳輸 UGS 資料流時，就要在 DSA-/DSC-REQ 訊息中告知 BS 其 QoS
參數以便讓 BS 為其保留頻寬。但不可以用競爭(contention bandwidth 
opportunity)或 piggyback 方式取得。 
(2) real-time Polling Service (rtPS)： 
這類服務支援具及時與週期性但傳輸量不固定的資料流，例如
MPEG 影像，其對 QoS 的需求包括了最小保留流量(Minimum Reserved 
Traffic Rate)、最大持續流量及最大延遲時間等參數。當 SS 要傳輸 rtPS
資料流時，就要在 DSA-/DSC-REQ 訊息中告知 BS 其 QoS 參數，BS 會
根據需求定期在 UL-MAP 訊息中公告 Request IE，以保證可以讓 SS 定期
提出新的頻寬需求，而 SS 也可以採用 Bandwidth stealing 或 piggyback 方
式提出，當 BS 收到頻寬請求時會以 polling 的方式指定發出需求的 SS
5 
 
 
表 2.1 IEEE 802.11e QoS 優先權之分類與定義 
TCID / 
Priority 
Acronym
Access 
Category 
Traffic Type 
1 BK AC_BK Background 
2 - AC_BK 
Background 
(Spare) 
0 (Default) BE AC_BE Best Effort 
3 EE AC_BE 
Best Effort 
(Excellent Effort) 
4 CL AC_VI 
Video 
(Controlled Load) 
5 VI AC_VI 
Video 
(<100ms latency and 
jitter) 
6 VO AC_VO 
Voice 
(<10ms latency and 
jitter) 
7 (最高) NC AC_VO 
Voice 
(New Control) 
 
表 2.2 WiFi 之 QoS 對應表 
Access Category Example TCID/Priority 
AC[3] VoIP 7 
AC[2] Video Streaming 5 
AC[1] Signaling bearer 3 
AC[0] 
Normal Data Service 
(e.g. Web, E-mail) 
1 
 
3. 3G-UMTS 對 QoS 之支援 
UMTS 系統制訂端到端(end-to-end)QoS 架構，從服務的起點到服務的終
點都建立和使用具有明確定義的屬性和功能的承載服務(bearer service)。
UMTS 定義了四種 QoS 類別 [9-10]： 
(1) Conversational Class(CA)： 
會話類別的訊務，這類訊務為及時且同步的服務類型，如網路電話 
( VoIP、video telephone )。   
(2) Streaming Class(SC)： 
單向傳輸，直接下載到使用者設備之訊務，如視訊下載 ( video 
downloading )、網路收音機 ( web radio)、streaming multimedia。  
(3) Interactive Class(IA)： 
非同步以及非即時性訊務（在下載通道的容量限制大於上傳通道的
容量），如互動網 ( Interactive Web )、database retrieval、web browsing 和
networking games。  
7 
 
Definition Mapping Subsystem (QCDMS)找出所對應之 QoS Type；PRMS
之優先權高於 Intelligent (Dynamic) Rule Mapping Subsystem (IRMS)，所
以當 PRMS 定義出所屬規則時，QCDMS 則不需再將封包送至 IRMS 進
行分類。 
(B) Intelligent (Dynamic) Rule Mapping Subsystem (IRMS)： 
IRMS 層也同樣是將封包依規則做分類。以智慧、自動化之特性，
從封包觀察封包之內容，依據下列(1) IEEE802.1p (2) ToS (3) DiffServ (4) 
port-number (5) RTP Protocol；將特性相同之封包建立起 rule map，進而
以智慧、自動之方法達到分類之結果，最後將封包之規則分類結果送至
QCDMS 找出所對應之 QoS Type。IRMS 之優先權低於 PRMS。 
(C) QoS Class Definition Mapping Subsystem (QCDMS)： 
此 Subsystem 主要工作為接收 IRMS 或 PRMS 之規則分類結果與規
則的 creating，再對從 QoS class mapping 中歸類其所屬的 QoS Type，將
QoS 結果與其他參數提供給 QoS Statistic & UI 及 Lower Protocol Layer，
也將封包送至 Lower Protocol Layer 繼續處理。 
(3) QoS Statistic & UI： 
此區塊僅為了呈現出封包分類之結果是何種 QoS Type，同時計算封包
數量呈現至 QoS Statistic 與 PG 所送出之封包數量對照是否相同，本系統會
以 WiMAX、Wi-Fi 及 3G-UMTS 三個無線網路為主；例如：若所傳來之封
包是屬於 WiMAX 網路的 nrtPS 封包，則將 WiMAX 介面上的 packet 數量
增加，而 nrtPS 封包數量也增加，以便得知其分類，相同的與之對應的 Wi-Fi
及 3G-UMTS 分類出的 QoS 種類與數量也會增加。此 QoS Statistic & UI 會
支援 PG 與 PC，提供所需產生的封包或規則的設定。 
 
本計畫之分類器主要分類動作依據有二種方式：(1)提供給設備管理者之「預
先設定分類規則（Predefined rule-based classifier）」；(2)系統依據傳輸之封包內
容與特性自動建立之「智慧型分類規則（Intelligent rule-based classifier）」。預先
設定規則根據：IEEE802.1p 的協定之 Priority 欄位、IP 標頭 ToS 欄位值或
Differential Service 的 Code Point（DSCP）值、每對通訊連結的動態 Port Numbers
以及（Src/Dest）IP、（Src/Dest）MAC 位址等之設定值執行分類動作。智慧型
分類規則根據：對 http 協定追蹤、FTP 的 Port/Pasv mode 追蹤、以及 RTP 協定
封裝下之 Payload Type 作分類追蹤，進行認知並自動建立分類規則，期能將未
符合預先設定分類規則的封包進行分類。 
圖二則是本計畫建構之系統內部之主要子系統 Packet Classifier 內部各個
模組間的互動。主要工作有二：(1)依封包檔頭內容，依 Predefined rule 及
Intelligent rule 對於封包規則進行完善之分類；(2)依 QoS 數量與所屬規則呈現
出，並針對 WiMAX、Wi-Fi 及 3G-UMTS 網路規格書所定義之 QoS 定義進行
封包分類。幾個重要子系統之細部運作流程設計呈現於圖三及圖四中，但限於
篇幅將不作深入描述。 
9 
 
 
(a)                                (b) 
圖四 (a) Predefined rule (b) Intelligent rule 分類規則與 QoS Type 歸屬 
   
 (1) Predefined Rule 混合分類測試結果 
使用封包產生器產生 7 種不同類型之封包，讓第 1、2 種連線帶有 VLAN 
Priority 值，並分別設定為 7 和 5，第 3、4 種之後不帶 VLAN Tag 且 ToS/DSCP
值分別為 11100000 和 10100000，第 5、6、7 種分別將 Source 或 Destination 
Port 值設定為 554、21、80。圖五顯示分類出的結果 PR 1~7 為封包產生器
產生出的封包類型且數量相符合。 
 
 
圖五 Predefined Rule 混合封包之分類結果 
 
(2) Intelligent Rule 分類測試結果–以 FTP 為例 
如圖六(a)所示計有有效封包數 40 個：Client 端(140.124.182.170)之封包
11 
 
http://cnw.com.cn/cnw07/NetInfrastructure/advanced/htm2007/20071019_26
972.shtml. 
[3]  Harri Holma and Antti Toskala, WCDMA for UMTS: Radio Access for Third 
Generation Mobile Communications, John Wiley and Sons, 2000. 
[4]  Erik Dahlman, Stefan Parkvall, Johan Sköld and Per Beming, 3G Evolution: 
HSPA and LTE for Mobile Broadband, Acadmic Press, 2007. 
[5]  IEEE Std. 802.11,“Wireless LAN Medium Access Control(MAC) and   
Physical Layer(PHY) Specifications,” 1999. 
[6]  IEEE Std. 802.11e - Enhancements: QoS, including packet bursting (2005). 
[7]  IEEE Std. 802.16-2004, IEEE Standard for Local and metropolitan area 
networks Part 16: Air Interface for Fixed Broadband Wireless Access 
Systems, 2004. 
[8]  IEEE Std 802.16e-2005 (amendment to IEEE Std 802.16),Amendment to 
IEEE Standard for Local and Metropolitan Area Networks - Part 16: Air 
Interface for Fixed Broadband Wireless Access Systems- Physical and 
Medium Access Control Layers for Combined Fixed and Mobile Operation 
in Licensed Bands, Feb., 2006. 
[9]  Le Faucheur, F. et al., “Multi-Protocol Label Switching (MPLS) Support of 
Differentiated Services”, IETF RFC 3270, May. 2002.  
[10]  RFC 3270, MPLS Support of Differentiated Services. 
[11]  Colasoft Packet Player，URL：http://www.colasoft.com/packet_player/ 
[12]  陳勇銘著，「支援通訊網路 QoS 運作之智慧型封包分類器設計」，碩士
論文，國立台北科技大學資訊工程系碩士班，台北，2010。 
 
 2
所形成之傳送路徑，將分別為各來源端建立一樹狀之傳送路徑。經由計算機之模擬結
果，此論文所提出之分散式路徑建立機制不但能有效的改善傳統共享樹(shared tree)
所可能發生的單點失效(Single point of failure)及傳輸瓶頸(Bottleneck)等問題，也能夠
將傳送樹回復所需之時間縮短至簡單的查表動作之時間。 
多位聽眾對此都提出問題，表達其高度的興趣。其中包含了對於分散式路徑建立 
之細節問題，如訊息之交握方式及定址等問題。另外，對於 P2P 網路之模擬所能達到
的網路規模也有多位聽眾感興趣。從回答這些問題的過程中，筆者也充份感受到了不
同國家之學者之間交流的氛圍，也是一個相當好的經驗。 
 
筆者在二十五日則參加了 Power Generation 及 Media Processing 的 Session，
雖然在領域上的不同而對這些論文之目的及方法或多或少會有一些疑惑，但藉由與作
者的交流，不僅能夠獲得其它領域上的知識，也能夠交到一些有著與我們不同文化的
新朋友。在參與此次會議的過程中，筆者也認識了由菲律賓的碩士生及新加坡南洋理
工學院的博士生。二十六日上午則參加了 Optical Communication 的 Session，題目
是有關全光學網路中的交換器的設計與分析。下午則參加了 software and database 
systems 在海報發表的 Session。筆者也對於其中一篇由 Curtin University of 
Technology 的 Muhammad Sheikh SADI 教授所提出的論文感到有興趣。此論文為一種
新的軟體設計方法使得能夠在具有 Mobile 及 Ubiquitous 的特性中，避免 soft error
的問題，筆者也請教了 Muhammad Sheikh SADI 教授有關此方法中模擬之方法。藉由面
對面的討論，筆者對於此種測試軟體的模擬也有了一番不同於網路模擬的體驗。 
 
三、建議 
       此次會議場地附近有多個旅館可供選擇，且旅館與會場之間之距離以步行之方式
可在 10 分鐘內到達，因此，在交通上算是相當的便利，而會場也相當寬敞，能夠讓
發表者與聽眾都能夠有一個舒適的空間，但在會場中必須提供給海報發表的作者的文
具如膠水等稍嫌不足，必須由發表者自己攜帶或向其它發表者借用。 
 
四、攜回資料名稱及內容 
1. 「TENCON 2009 Final Program 手冊」：內含會議所有 sessions 之時間序、論文發
表/口頭報告題目及作者姓名，可總覽整個會議安排及論文/專題研討之架構，對欲
安排大型學術研討會議者甚具參考價值。 
2. 「TENCON 2009 Abstract 手冊」: 內含所有論文之摘要，可供與會者快速閱讀所
有論文之目的及成果。 
3.「TENCON 2009 論文全文集之光碟片」：可供相關學者專家或研究生找尋同領域論
文列印參考。 
4. 相關學術會議資訊及徵稿啟事，例如： 
(1)「TENCON 2010」：Nov. 21-24，2010，Fukuoka。 
(2)「ICC 2010」：May 23-27，2010，South Africa。 
(3)「SCVT 2010」：Nov. 24-25，2010，Enschede, Netherlands。 
(4)「IMS 2010」：Nov. 30 – Dec. 2，2010，Seoul, Korea (South)。 
(5)「ITAB 2010」：Nov. 3 – 5，2010，Corfu, Greece。 
(6)「ADMA 2010」：Nov. 19 – 21，2010，Chongqing, China。 
 

其他成果 
(無法以量化表達之成
果如辦理學術活動、獲
得獎項、重要國際合
作、研究成果國際影響
力及其他協助產業技
術發展之具體效益事
項等，請以文字敘述填
列。) 
參與之研究生對網通 QoS 及軟體設計、測試、CMMI 文件撰寫等實務獲益許多，
另有一位研究生以本計畫相關成果為其畢業論文 
 成果項目 量化 名稱或內容性質簡述 
科 
教 
處 
計 
畫 
加 
填 
項 
目 
測驗工具(含質性與量性) 0  
課程/模組 0  
電腦及網路系統或工具 0  
教材 0  
舉辦之活動/競賽 0  
研討會/工作坊 0  
電子報、網站 0  
計畫成果推廣之參與（閱聽）人數 0  
 
