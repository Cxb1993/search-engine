 一、前言 
目前國內乳癌細胞病理診斷，皆由病理科醫師使用肉眼直接透過顯微鏡觀察切片影像，
但若以人工的方式持續地對大量影像進行判讀工作，需要耗費相當多的人力與時間，且可能
因為疲勞或因不同觀察者之主觀意見等因素而造成判讀結果不一，甚至導致誤判。 
因此為了減輕病理科醫師在判讀上的負擔，我們利用數位影像處理技術分割出細胞核，
分析細胞核的特徵，利用細胞學原理以定量或定性的方式，提供所分析之細胞正常或異常等
相關資訊予病理科醫師，以期能達到輔助診斷的功用，並增加診斷的正確率。 
二、研究目的 
一般細胞抹片，經過染色與四百倍放大處理之後，原始影像會如圖 2.1 所示，屬於細胞
核的部分會呈現深藍色色調，此外包括淡藍色的細胞質部分、紅色的紅血球、深藍色的人工
雜點與其他較亮的背景部分。 
 
 
圖 2.1：原始抹片影像 
染色後的細胞影像的顏色或亮度分布可能會有以下的特性：1.細胞膜與背景對比會較
高，且細胞質與細胞核也會呈現對比但較不顯著。2. 細胞染成深藍色，無任何組織的玻片背
景部分會呈現較亮的顏色。3.背景亮度在不同影像上會有不均勻的現象發生。4.同一個細胞
內部亮度可能會因染色技巧而有差異。5.如果細胞不規則，一旦使用不佳的分割演算法，細
胞會聚集造成細胞團，凋零細胞會因細胞膜斷裂而不好辨識。  
 
三、研究影像格式與實驗流程 
3.1 研究影像 
本研究中所使用的乳房細針抹片影像資料是由彰化基督教醫院病理科醫師所提供，在四
百倍的光學顯微鏡下直接透過 CCD（Charge Coupled Device）成像，每一張影像的解析度為
1524x1012 像素大小，為了研究便利之需求，我們將影像縮小為 640 x 480 像素之大小。 
3.2 研究流程 
 本研究會將取得之細針抹片影像直接讀入系統中進行處理及分析。本研究首先透過轉換
公式將原始影像轉為灰階影像，利用Sigmoid Filter以及Otsu分類演算法將原影像分為前景(細
胞核、紅血球)與背景(間質細胞)部份，而前景的細胞核即為我們所要進行分析的部分。接著
利用直方圖分析，可成功去除切片時所殘留的紅血球細胞，經由計算每個 object 的大小，可
去除過小的人工雜點的部分，而細胞核內因染色時亮度不均及分閥值分割法所造成的空洞也
可利用形態學上的填補（Filling）技巧將其補滿，整研究步驟如圖 4.1 所示。 
     
 Otsu 演算法的目的在於找尋一最佳的臨界值 T，以 T 為臨界值可將影像灰階值分為兩個
群集，使得群集內的變異數和為最小，群集間的變異數為最大。 
 一旦對細胞抹片影像執行臨界值分群後，可取得一臨界值 T，透過此臨界值即可將分群
後的兩群資料以二值化儲存，藉由臨界值分割出抹片影像的前景與背景兩群，此分群成二值
化的公式定義如下： 
 If C(x,y) < T     D(x,y)＝0 
 Otherwise      D(x,y)＝255 
 以 Otsu 分類分割法分割後的結果如圖 4.3 所示，可看到所割出來的包括細胞核、紅血球、
少許間質以及人工雜點的部分。 
 
圖 4.3：以 Otsu 演算法分割後之結果： 3G  
4.4 去除紅血球及多餘人工雜點與間質部分 
將抹片影像二值化之後，於圖 4.3 可發現除了應保留的細胞核部分之外，仍有許多應去
除的間質、紅血球及人工雜點的部分，這部分首先我們利用形態學(Morphology)中的斷開
(Opening)技巧將連接於細胞核周邊的間質部分切斷，接著計算每個 Object 的面積大小，並自
行設定一臨界值 T1 後對影像進行掃瞄，將面積小於 T1 的 Object 視為過小雜訊並去除之，本
研究中的 T1 值設為 50 個像素大小。 
對於紅血球的部分，在觀察所有紅血球的 R、G、B 值以及與醫師討論之後，由於紅血球
部分之 R 值會高於細胞核，我們決定在對分割結果不大的情況下，決定一經驗的 TR值，將影
像中 R 值大於 TR的像素點去除，即可順利地將屬於紅血球的部分移除。 
最後還有少許附著在細胞核上並突出背景部分的深藍色人工雜點待去除，這些部分形態
學上的侵蝕運算與膨脹運算處理，即可成功去除，結果如圖 4.4 所示。 
 
 
圖 4.4：以將細胞質、紅血球與人工雜點去除後之結果： 4G  
 
4.5 分離重疊細胞核 
 醫生在進行切片製作時，玻片上可能同時存在數個平面的組織結構，因而會產生細胞核
重疊之問題。此外在利用 Otsu 演算法區分前景與背景時，有可能因為相鄰細胞核與細胞核之
間距離過於接近而連結在一起，因此如果只使用臨界法分割的結果可能導致錯誤地將兩顆獨
立細胞判定為同一顆細胞；因此本研究擬藉由計算每個輪廓點之曲率，找出可能位於重疊交
界處之分割點，再連接此兩輪廓點，即可順利地將重疊之細胞核分離。 
4.5.1 計算重疊細胞核個別之重心 
 一般而言重疊細胞核之面積會大於獨立之細胞核之面積，因此首先我們計算影像中所有
物件的面積 Aavg，計算所有物件面積之平均值，再設定一變數γ，一旦影像中物件之面積超過
Aavg的γ倍，我們就將此物件視為可能重疊之細胞核，對其進行重疊細胞核分離步驟，本研究
之γ值設為 1.5。 
 為了求出重疊細胞核個別之重心，我們使用形態學上的侵蝕運算對每一顆細胞核重複作
分離，因此我們可以計算剩餘像素點之 X 座標與 Y 座標之平均值，求出重心座標。 
   
(f) 
圖 4.5：實際影像之重疊細胞核計算 
個別重心之步驟圖 
4.5.2 取出重疊交界處分割點，分割重疊細胞核 
一旦取得分離後細胞核之個別重心 O1( 11,YX )與 O2( 22,YX )之後，我們再找出兩顆分離細
胞核之連心線 21OO ，計算細胞核所有輪廓點所在位置之曲率，對於曲率的計算，我們採用
K-Curvature 計算各輪廓點的曲率。此步驟之目的在於找出接近重疊交界處之分割點，若找
出此兩個分割點之後，將此兩分割點連線，即可將此二重疊細胞核分離，其公式為： 
ai＝(xi-xi+K , yi-yi+K) 
bi＝(xi-xi-K , yi-yi-K) 
ci＝cosθ＝
( )
ii
ii
ba
ba
⋅
⋅
 and -1 ≤ ci ≤  1             
                       
若上述兩數值皆大於一經驗臨界值 TC，代表此輪廓點位於輪廓線凹陷或突起之處，可能
位於兩重疊細胞核之重疊交界處，我們將此類輪廓點標記為紅色。                     
在重疊細胞核之輪廓線中，可能會找到許多與相鄰點之曲率差大於 TC之候選分割點，但
是根據我們的觀察，重疊細胞核在連心線 21OO 兩側處會有兩個最大曲率變化的點 P1，P2，我
們在連心線上種植與連心線垂直之搜尋線，在搜尋線範圍內搜尋是否可找到最佳分割點 P1，
P2，使得 21PP 會與連心線相交，且 21PP 與 21OO 會夾有一個夾角θ，我們設定若θ介於 70 度到 90
度之間，代表 P1，P2為最佳分割點，將 P1與 P2連線，即可將此二重疊細胞核分離。 
以上演算法之步驟之示意圖如圖 4.6： 
 
 
 
Candidate 
points 
 
 
Best segmented Point P2 
21OO  
Best segmented Point P1 
O1( 11,YX ) 
O2( 22,YX ) 
高診斷之正確率。 
 
4.7.2 主動式輪廓模型（Active Contour Model） 
本研究參考Kass所提出來的主動式輪廓模型處理步驟，首先針對主動式輪廓模型的初始
輪廓資料作Labeling之動作，若任一原始輪廓 iC ， n,,1i L= 總共有M個輪廓點，我們以5點
為間隔，將初始輪廓依取樣大小切割取樣為 j (j=M/5)個控制點vi,j， )y,x(v j,ij,ii = ， n1j L= ，
這裡 )y,x( j,ij,i 是第j個輪廓控制點 j,iv  的 x和 y 座標，並在控制點 j,iv 所在輪廓線位置之垂直
方向上種植搜尋線(Search Line)，取搜尋線上之 j,iv 及 j,iv 內外側各取兩點共五點為邊界候選
點(Boundary Candidate) Pi,j,k， 2,,2k L−= ，其中Pi,j,0 = j,iv ，再計算此五個邊界候選點所在位置
對應之灰階影像之梯度G(Pi,j,k)與強度I(Pi,j,k)大小以求出外部能量Eext，並計算第k輪廓候選點
Pi,j,k的一階導數與二階導數求出內部能量Eint，其公式表示如下： 
Eext( j,iv ) = I(Pi,j,k) + G(Pi,j,k) 
Eint( j,iv ) = α(Pi,j,k)’ + β(Pi,j,k)”                   
    事實上，若以傳統之主動式輪廓模型對細胞影像偵測最佳輪廓，會因為間質細胞或癌化
細胞核內部之亮度不均勻等因素，影響最佳輪廓之偵測，因此本研究加入輪廓影像特徵、輪
廓形狀特徵、輪廓位置等特徵參數，做為列入找尋最佳邊界控制點之參考因素，然後採用一
改良的輪廓偵測模型，將原本的輪廓能量函數公式重新改寫為下列公式，加入關連性的能量
函數 )v(E j,iR ，以反應更精確的偵測結果。                         
( )∑−
=
++=
1n
0i
j,iRj,iextj,iintsnake )v(E)v(E)v(E)v(E       
我們將輪廓關連性分成兩大類，以下為其關連性的說明與能量函數。 
 
1. 輪廓影像特徵的相關性 
    為了在輪廓的搜尋法線上尋找一個較佳的輪廓點 iv ，我們以影像強度 )(I v j,i 與影像梯度
)v(G j,i 來代表輪廓影像的特徵，作為輪廓相關性能量計算的參數。我們將 j,iv 前後 n 個輪廓點
視為一個物體輪廓的局部區域，在這輪廓局部區域中，輪廓點之間影像特徵是十分相似的，
我們用這性質的能量式子 )v(E j,iF ，作為輪廓能量評估的函數，並以輪廓局部的影像強度 avgI 、
梯度 avgG 的平均值作為輪廓能量評估的基礎，確保物體輪廓特徵的一致性，此能量 )( iF vE 可
以被表示為： |G)(G||I)(I|)v(E avgj,iGavgj,iIj,iF vv −ω+−ω=  
2.輪廓位置特徵的相關性     
這裡我們以 j,iv 到輪廓重心的距離 )v(S j,i 來代表任一點的輪廓位置特徵，將其加入輪廓相
關性能量計算，再根據 )v(S j,i 與輪廓局部的距離平均值 )( avgS 之間的差值，作為輪廓能量評估
的基礎。此步驟能確保相鄰輪廓點間能保持平滑的曲線，避免相鄰的輪廓點因間質細胞與細
胞核內部亮度不均的問題，產生不平滑的輪廓線，此位置能量 )v(E j,iS 可以被表示為: 
avgj,isj,iS S)v(S)v(E −ω=  
計算出影像特徵與位置特徵這兩種輪廓關連性能量後，我們可將關連性能量函數 )( iR vE
表示為： 
 
圖 4.10：以曲率選出之不正常細胞核 
 
4.8.2 計算細胞核之面積 
以組織學或細胞學而言，癌化細胞會不當增生，造成腫大或變形，因此正常細胞核之面
積 Areai 會介於一特定範圍之間( TA≦Areai≦TA’)，此處面積表示則以像素點的個數為單位，
我們計算整張影像中面積未介於正常範圍內的細胞核個數 Nr，若 Nr值達到影像中細胞核總數
的某一比例，即可判定此張影像為異常抹片影像。本研究所設定之經驗面積範圍 80≦Areai
≦180 個像素大小。根據此標準，整個判讀結果會如圖 4.11 所示，(這裡我們將判定為有問
題之細胞核標示為紅色，正常細胞核則為黑色)。 
 
 
圖 4.11：以面積特徵區分之判別結果 
4.8.3 細胞核之緊密度（Compactness） 
 一般而言，緊密度適合評估物體形狀之變化，若以細胞影像而言，它適合判斷細胞核之
形狀是否接近圓形或鬆散，當細胞核趨近圓形時，緊密度數值會被最小化，反之隨著細胞核
輪廓之不規則，其值會隨之增加，而緊密度之公式為周長 2/面積。 
 一旦量測出各細胞核之緊密度後，可取緊密度臨界值 Tcom，若細胞核之緊密度值大於 Tcom，
可將此細胞列為形狀不規則之細胞，若一影像形狀不規則之細胞核個數大於細胞核總個數達
某個百分比以上，即可判定此影像為異常抹片影像。本研究之 Tcom設為 10，其判別結果如圖
4.12 所示，經判別為有問題之細胞核標示為紅色，正常細胞核則為黑色。 
 
 
圖 4.12：以緊密度判別結果 
 
4.8.4 細胞核之亮度對比度（Contrast） 
 一般而言，癌化細胞亦可以內部亮度之兩種情況來判別其為病變之細胞：第一，細胞核
內部會因為染色體即將分裂而造成內部亮度不均，呈現亮暗程度有很大差異之情況；第二，
根據細胞病理與取樣結果，若細胞核内部亮度偏暗且均勻，亦為病變之細胞，我們在與醫師
討論之後，採用細胞核之灰階變異數為指標來量測細胞核內部之亮度對比度，灰階變異數之
公式如下所示： 
  
圖 4.16：其他正常影像之辨識結果 
4.9 以 SVM 作分類工作 
在所有系統診斷的實施步驟中，我們首先透過影像處理技術分割出原始影像之細胞核，
接著逐一計算出細胞核之曲率、面積、緊密度、對比度，並分別與上節所訂定出的臨界值做
順序比對。若比對結果顯示，當所擷取細胞核之特徵參數明顯大於我們所設定之臨界值時，
即為異常細胞核。 
在支援向量機(SVM)的部分，當系統取出所有 n 個細胞核之特徵參數之後，每個細胞核
Ni， n,,1i L= ，會獲得一組相對應之特徵參數數據：Curvi、Areai、Compi、Variai，其中 Curvi
代表細胞核 Ni 中所有輪廓點與前後輪廓點曲率差之平均，Areai代表細胞核 Ni 之面積，Compi
代表細胞核 Ni 之緊密度，Variai代表細胞核 Ni 之對比度，我們將以上特徵參數分別正規化之
後，可以得到一組正規化後的值：N_Curvi，N_Areai，N_Compi，N_Variai，在算出每顆細胞核
Ni， n,,1i L= 對應之正規化數據之後，我們將 N_Curvi、N_Areai、N_Compi、N_Variai設為細胞
核 Ni所對應之四維的特徵向量 Xi＝(N_Curvi，N_Areai，N_Compi，N_Variai)，再將 Xi導入台
大資工林智仁教授所提供之 SVM 程式進行細胞核的分類工作。 
我們採用四組不同之特徵參數作為訓練資料(Training Data)，以交叉比對(Cross 
Validation)的方式，進行辨識系統的樣本訓練，觀察這四組訓練資料之分類結果，最後挑選
分類準確率最高的一組訓練資料建立模組(Model)，待系統參數訓練完成後，再將測試組的樣
本導入辨識系統中進行分類，然後將分類結果與醫師肉眼判讀之結果進行比對，評估系統效
能。 
 
4.10 系統評估 
    一旦經由系統分析細胞參數後，我們可以透過診斷的準確率進行系統效能評估。其中，
所用於評估的特徵參數包含了細胞核之面積、細胞核輪廓之曲率與細胞核之緊密度等等，在
系統產生結果之後，將辨識結果與病理科醫師討論，再與醫師所判讀之結果互相比對，以評
估系統之準確性，做為進一步改善的依據。 
在本研究中我們以辯識正常細胞核與異常細胞核的準確性做效能的評估，基本上本研究
將以臨床醫師的診斷結果與本系統之準確率（Accuracy）、敏感度（Sensitivity）、有效性
（Specificity）作一比較，以評估本系統之實用性。其中，TP、 TN、FP 及FN 在系統評估
中代表之意義分別如下表內，而T、F、P、N 各別之定義如下。 
表 4.1：效能評估表示意圖 
 正常細胞 異常細胞 
系統判斷為 
正常細胞 TN FN 
系統判斷為 
異常細胞 FP TP 
 
這四組資料做為訓練資料(Training Data)進行訓練動作建立模組，再利用四個模組進行交叉
驗證測試工作，最後將具有最佳辨識率之結果模組作為本系統之訓練模組，以評估本系統之
效能。 
 
表 5.3：各組細胞核個數 
組別 正常細胞核個數 異常細胞核個數 
1 250 950 
2 250 950 
3 250 950 
4 250 950 
 
 
表 5.4：各群組之訓練組與測試組 
實驗群組 訓練組 測試組 
G1 1，2，3 4 
G2 1，2，4 3 
G3 1，3，4 2 
G4 2，3，4 1 
 
 
表 5.5：群組 G1 之辨識結果 
 正常細胞核 異常細胞核 
系統判斷為 
正常細胞核 114 TN 31 FN 
系統判斷為 
異常細胞 136 FP 919 TP 
總計 250 950 
 
 
 
表 5.6：群組 G2 之辨識結果 
 正常細胞核 異常細胞
核 
系統判斷為 
正常細胞核 150 TN 37 FN 
系統判斷為 
異常細胞核 100 FP 913 TP 
總計 250 950 
 
 
表 5.7：群組 G3 之辨識結果 
 正常細胞
核 
異常細胞
核 
系統判斷為 
正常細胞核 192 TN 102 FN 
過於複雜、細胞核過於密集，或細胞核內部之亮度不均皆會導致敏感度變低，但系統準確性
方面仍然有著 89.15%的敏感度。 
 在以 ROC 曲線評估診斷準確率而言，會如圖 5.1 所示，可以發現若將所有特徵參數導入
支援向量機進行分類工作，其效能會比只使用單一項特徵參數針對細胞核進行分類要來得
好，這項結果說明了若只使用少數特徵參數對細胞核進行辨識工作，分類之正確率可能相對
下會較低。 
 
Conventional Binormal ROC Curves
0
0.2
0.4
0.6
0.8
1
1.2
0 0.2 0.4 0.6 0.8 1 1.2
FPF
TP
F
a=1.47 b=0.95 Az=0.8570 SVM
a=1.19 b=0.64 Az=0.8419 Compactness
a=1.01 b=0.67 Az=0.7994 Curvature
a=0.96 b=0.58 Az=0.7959 Area
a=0.71 b=1.08 Az=0.6849 Variance
 
圖 5.1：ROC 曲線 
 
六、結論與未來展望 
本研究分析乳癌之粗針切片與細針抹片，針對國內相關研究非常少的乳房細胞影像細胞
學診斷方式，提出一套以細胞學為基礎之乳房細胞影像辨識方法，並針對細胞核重疊之問題，
提出分割方法，並有效分離重疊之細胞核。 
目前國內乳癌細胞之病理診斷方式，皆由病理科醫師使用肉眼直接透過顯微鏡觀察細胞
影像，樣本製作技術的好壞、樣本影像拍攝的品質、以及醫師之年齡、經驗等因素，都會影
響到判讀結果之正確性，且以人工的方式持續地對大量影像進行判讀工作，需要耗費大量人
力、精神與時間，造成病理科醫師之負擔。 
 
七、參考文獻 
 
[1] 林儀信，”以組織學為基礎之乳癌細胞分割及辨識”，嘉義大學資訊工程研究所碩士論
文，2006。 
[2] 賴冠汝，”3D 彩色乳房超音波的血管分析”，中正大學資訊工程研究所碩士論文，2006 
[3] 熊家誠，”自動化螢光顯微影像之次細胞結構辨識”，中原大學醫學工程研究所碩士論文，
2004 
[4] William H. Wolberg, W. Nick Street, Olvi L. Mangasarian, “Computer-Derived Nuclear 
Features Compared with Axillary Lymph Node Status for Breast Carcinoma Prognosis,” Cancer 
Cytopathology, vol.81, no.3, June 25, 1997 
[5] R.C. Gonzalez and R.E. Woods, “Digital Image Processing / 2nd edition,” Prentice Hall, 2001 
 
八、計畫成果自評 
8.1 計畫成果價值 
本計畫在與彰化基督教醫院病理科主任及其研究團對合作下，也進行相當多的實驗病例，整
體成果大致符合預期目標，除此之外我們也將成果與正進行的計畫，也就是有關乳癌預後分
 
