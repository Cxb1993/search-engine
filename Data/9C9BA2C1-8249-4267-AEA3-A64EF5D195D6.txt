目    錄 
第一年計畫成果報告 
中文摘要 ……………………………………………………………………………… 1 
英文摘要 ……………………………………………………………………………… 2 
一、研究目的與文獻探討 ……………………………………………………………… 3 
二、研究方法 ………………………………………………………………………… 5 
1、影像處理單元 …………………………………………………………………… 6 
1.1 邊點序向排列之圓形偵測法 ……………………………………………… 6 
1.2 轉折點偵測法 ……………………………………………………………… 9 
1.3 修正型 Dijkstra 演算法 …………………………………………………… 12 
1.4 NURBS 分段曲線之設計 ……………………………………………… 14 
2、RF 無線傳輸模組 ……………………………………………………………… 17 
3、輪型機器人控制單元 ………………………………………………………… 18 
3.1 伺服機構之控制信號 …………………………………………………… 19 
3.2 SRF05 超音波感測器 …………………………………………………… 19 
3.3 HM55B 電子羅盤 ………………………………………………………… 19 
4、以模糊推論邏輯實現小型機器人的避障軌跡追蹤控制 …………………… 20 
5、以 AC12 接收機實現虛擬距離單機定位之動態實驗 ………………………… 21 
6、結合語音播報與 RFID 在導盲機器人之設計 ……………………………… 23 
三、實驗結果 ………………………………………………………………………… 24 
四、結論與建議 ………………………………………………………………………… 29 
參考文獻 ……………………………………………………………………………… 30 
第二年計畫成果報告 
中文摘要 ……………………………………………………………………………… 31 
英文摘要 ……………………………………………………………………………… 32 
一、前言 ……………………………………………………………………………… 33 
二、輪型機器人感測元件分析 ………………………………………………………… 36 
2-1  CMOS 影像感測器 ………………………………………………………… 37 
2-2  影像緩衝區 …………………………………………………………………… 38 
2-3  影像前置處理 ……………………………………………………………… 39 
2-4  SRF05 超音波感測器 ………………………………………………………… 40 
I
3.1  Buck 變換開關電路原理 ……………………………………………… 83 
3.2  ADC 電池充電器量測電路 ……………………………………………… 83 
3.3 電池電壓與充電電壓 …………………………………………………… 84 
3.4 充電電流值 ……………………………………………………………… 84 
三、實驗結果與討論 …………………………………………………………………… 85 
1、 超音波感測器實驗結果 ………………………………………………………… 85 
2、 語音晶片功能測試 ……………………………………………………………… 86 
3、 無線射頻辨識系統功能測試 …………………………………………………… 86 
4、 鋰電池充電器功能測試 ………………………………………………………… 87 
5、 CMOS 影像感測器驗證測試 …………………………………………………… 91 
6、 輪型機械人直行及停止 ………………………………………………………… 93 
7、 輪型機械人偏左 ……………………………………………………………… 93 
8、 輪型機械人偏右 ……………………………………………………………… 94 
9、 輪型機械人向左轉 ………………………………………………………………    94 
10、 輪型機械人向右轉 ………………………………………………………… 94 
四、結論與未來展望 …………………………………………………………………… 96 
參考文獻…………………………………………………………………………………… 97 
計畫成果自評……………………………………………………………………………… 98 
 
 
 
 
 
 
 
 
 
 
III
中文摘要 
本計畫整合 NURBS 路徑規劃、階層式軌跡追蹤、全球衛星定位系統(GPS)、無線射頻
辨識系統(RFID)、CMOS 影像感測晶片、以及多重感測器融合(Fusion)技術架構一個三年期
的計畫，以盲人的導引服務為最後的目標。第一年計畫將以區域性的室內空間為主，探討
在一個環境模型下，非完整約束輪型機械人(或小型機器人)之路徑規劃與軌跡追蹤控制的問
題。第二年計劃將移動式機械人的研究延伸至戶外作大範圍的導引服務，以 GPS 全球衛星
定位系統為核心技術，結合向量式電子地圖資料庫，為輪型機器人擴增戶外導引的服務功
能。第三年計劃將整合日趨成熟的無線射頻辨識(RFID)技術與語音播報系統來讀取公共場
所中導盲磚或盲人點字內所含的訊息，以實現導盲機器人的設計為目標。第一年區域性軌
跡追蹤的作法在整合 CCD 影像處理、RF 通訊模組、伺服機定位控制、超音波測距以及電
子羅盤，以嵌入式微控制器為平台建立小型機器人的軟、硬體架構。在路徑規劃方面，由
CCD 攝影機取得環境影像圖片，應用多邊形轉折點偵測與圓形偵測演算法來建立障礙物之
分佈模型。本文提出邊點序向排列法(Boundary Sequence Method)，成功地結合圓形偵測法
來提升影像處理與辨識的速度。邊點序向排列法是將所有影像中的物體作分割並且進行有
序的排列，使得轉折點及圓形偵測法能夠獲得最有效率的辨識結果。以最短路徑為代價函
數，提出修正型 Dijkstra 演算法尋找一條連接起始點與終點之避障路徑。有鑑於 B-spline
函數所建立的曲線具有快速收斂、局部學習與分段調整之特點。本文推導分段型 NURBS 
(Non-Uniform Rational B-spline) 曲線來取代傳統的遞迴表示式，有效地整合約束最佳化之
演算法，建構一條連接起始點與終點之最佳化的平滑軌跡，除了滿足轉彎時車輛的曲率限
制以及車輪滾動時之運動約束外，並可成功地避開障礙物。第一年計畫的具體實現在使得
輪型機器人能夠辨識及抓取不同顏色的目標球，並以爪子夾具攜帶目標球沿著路徑規劃所
得到的 NUBS 曲線進行避障軌跡追蹤控制。為了完成上述的工作目標，在本次期中報告中
分為兩個子題作討論，(i)以嵌入式微控制器完成小型機器人追球入門之動作，本系統建構
於 PC Matlab 的 GUI 介面平台，以 CCD 攝影機來擷取足球場中的影像資訊，經由影像處
理的演算法來計算足球機器人與目標球之間的距離與角度，透過無線發射/接收模組與機器
足球員上的嵌入式微控制器 ATMega162 進行伺服機的定位控制。為了避免影像重複擷取與
分析所耗費的龐大運算資源，本系統加入電子羅盤作方位辨識及超音波的距離感測以提升
輪型機器人即時動作反應之性能，快速導引機器足球員將目標球放置在指定的球門位置
內。(ii)以嵌入式微控制器完成小型機器人避障軌跡之追蹤控制，採用模糊邏輯推論作為控
制的演算法，以目前機器人的位置與追蹤軌跡間的距離、方位角誤差作為模糊推論的輸入，
其輸出為左右輪伺服機的速度。為了取得令人滿意的軌跡追蹤效果，本系統將模糊控制演
算法植基於嵌入式微控制器內，同時接收來自電子羅盤、超音波感測器以及光學編碼器以
感知機器人本身座標。本計畫最大的挑戰就是以一顆單晶片要完成如此複雜的工作程序，
以滿足小型機器人的規格需求。 
關鍵詞: 嵌入式微控制器、NUBS 曲線、Dijkstra 演算法、邊點序向排列法、超音波感測
器、電子羅盤、曲率限制、非完整運動約束。 
 
1
一、研究目的與文獻探討 
  第一年計畫的研究目的為建立輪型機器人在一個小型區域範圍內執行某一特定任
務(如軌跡追蹤、夾球射門、路邊停車)所需要的相關技術，這些技術可繼續擴展至戶外區域
的大範圍導航或者針對視障者需求所研製的導盲機器人上。為了滿足小型機器人的規格尺
寸 315 12 15 cm× × ，第一年計畫以小型機器人組(Small-Size League)比賽場地 2274 152.5 cm×
作為設計準則。在場地上方架設一台 CCD 攝影鏡頭，利用個人電腦取得影像資訊進行分
析、辨識、決策，透過 RF 無線傳輸將動作命令傳送至每一台機器人的嵌入式微控制晶片。
本系統成敗的第一個關鍵，在於如何選擇一顆功能強大的嵌入式微控制器作為小型機器人
的控制核心?至少需要具備脈波寬度調變(PWM)輸出、脈波信號捕捉(Capture)功能、計時/
計數器(Timer/Counter)中斷、UART 以及 I2C 串列通訊協定等功能。除了接收主控電腦所傳
送的控制命令之外，還可同時讀取電子羅盤、超音波以及、左右輪編碼器的信號，並且控
制左右輪伺服機以及爪子夾具等。甚至必須考慮到第二年計畫中會用到的 GPS 接收機以及
CMOS 感測器等介面功能。本文採用 Atmel 公司所出的 ATMega162 嵌入式微控制器[1]作
為核心晶片，由於它具備強大的週邊介面功能，RISC(精簡指令集)的架構可提供令人滿意
指令執行速度，達到即時控制的效果，選擇適當的嵌入式微控制器將是本計畫成敗的關鍵。
此外，主控電腦採用 MATLAB 工作平台，由 CCD 攝影機擷取足球場地內的影像圖片經由
主控電腦的負責分析並且進行路徑規劃的工作。所謂路徑規劃就是在有限的工作環境中尋
找一條合理軌跡，連接初始位形(位置與姿態)與最終位形並可成功地避開障礙物[2~5]。本
系統成敗的第二個關鍵在於如何縮短影像處理的時間，使得圓形偵測能夠獲得最佳的辨識
效果。主控電腦在最短時間內獲得機器人的座標位置，直接在 PC 上進行模糊控制演算法，
可以分擔嵌入式微控制器的計算負荷。 
圓形物體的偵測在圖樣辨識中始終佔有極重要的地位，早期的 HoughTransform (HT)
以及 Probabilistic Hough Transform(PHT)都是屬於一點取樣的圓形偵測法[6,7]以獲得很好
的偵測效果，但必需佔用大量的記憶體空間來儲存過去的取樣資料。此外，Coaxial Transform 
演算法[8]為二點取樣法，而 Random Sample Consensus (RANSAC)演算法[9]是利用三點取
樣來偵測圓形物體。Randomized Circle Detection(RCD)演算法[10]是在圖片中隨機取樣四個
點，利用任意四點不容易共圓的特性來決定所謂候選圓(Possible Circle)，再進一步判斷這些
候選圓是否為真正圓(True Circle)。[9,10]的方法是利用邊緣偵測(如 Sobel 演算法)後的結
果，隨機存取三點或四點來判斷是否有圓形物體存在，這種作法必須耗費龐大的計算資源。
原因在於邊緣偵測呈現出來的結果是整張圖片從左掃描到右所有邊點像素全部混在一個集
合中，無法分辨那一個邊點是屬於那一個物體，更無法確認邊點像素間的前後次序(沿著物
體邊緣逆時鐘方向)。龐大繁雜且未經分類的邊點座標對於隨機圓偵測法而言是非常大的計
算負荷，原因在於隨機取樣三個點剛好是在同一個圓的機率已經很低了，在加上取樣的三
點也不見得剛好等距地分佈在物體的邊緣上，使得圓形的辨識率無論在速度或者準確度上
均無法獲得令人滿意的效果。本文提出所謂邊點序向排列法的構想是對影像中的物體作切
割，將每一個物體的邊緣像素座標作有序排列並置於一個集合中。所謂有序排列是指集合
中的像素是按照物體形狀封閉曲線逆時鐘方向作排列。經過邊點序向排列法的處理後，類
似將一大堆繁瑣的資料作分類整理並且將每一筆資料排列整齊，最重要的是它可以簡化後
續影像處理的複雜度。在邊點序向排列法的加持下，圓形偵測法以及轉折點偵測變得非常
有效率，可輕易獲的物體的形狀係數、中心點座標以及半徑大小。文獻中探討轉折點偵測
的方法大致可分為兩種，一為以邊緣為基礎的偵測方法，包括 Medioni-Yasumoto 法[11]、
Beus-Tiu 法 [12] 、 Rosenfeld-Johnston 法 [13] 、 Rosenfeld-Weszka 法 [14] 以及權重型 
κ -curvature[15]法。這些方法都是經由邊緣偵測處理後，計算邊點座標上每一點的曲率值進
而決定影像中所有物體的轉折點。二是以灰階值為基礎的偵測方法，相關文獻請參考
[16,17]。本文採用 Rosenfeld-Johnston 法來偵測影像圖片中的轉折點，作法是比較每一個物
3
二、研究方法 
圖 1 為本系統的方塊圖，整個系統大概可分為影像處理單元、RF 無線傳輸模組、以
及輪型機器人的控制單元。影像處理單元是以 MATLAB 作為工作平台擷取 CCD 的影像功
能，透過本文所提出的邊點序向排列法(Boundary Sequence Method)將影像中的物體作切
割，將每一個物體的邊緣像素座標作有序排列並置於一個集合中。邊點序向排列法類似將
一大堆繁瑣的資料作分類整理並且將每一筆資料排列整齊，最重要的是它可以簡化後續影
像處理的複雜度。在邊點序向排列法的加持下，後續的圓形偵測法(Circle Detection)以及障
礙物的轉折點偵測(Concer Detection)變得非常有效率。利用修正型 Dijkstra 演算法搜尋一條
由起始位形(位置與姿態)至終止位形的最短路徑，除了滿足車輛轉彎時最小曲率半徑的限制
以及起始點與終點之運動約束外，並可成功地避開障礙物。最後，我們建立矩陣型 B-spline
基底函數，在平面上產生一條至少三次可微的分段型平滑 NURBS 曲線，將曲率限制以及運
動約束引入最小路徑的代價函數中，將軌跡規劃的問題轉換成求解約束最佳化的問題。為
了完成小型機器人夾取指定顏色的滾球進行避障軌跡追蹤的目標，主控電腦將計算輪型機
器人與目標球之間的距離及方向夾角轉換為機器人驅動左、右輪伺服機的控制命令，透過
RF 無線傳輸模組傳送給輪型機器人之控制單元，配合電子羅盤與超音波感測器，驅動伺服
轉軸機構朝向滾球所在的位置上移動。本文採用 Atmel 所出的 ATMega162 嵌入式微控制器
作為小型機器人的核心控制晶片，至少需要具備脈波寬度調變(PWM)、脈波信號捕捉
(Capture)、計時/計數器(Timer/Counter)以及串列通訊(UART)等功能，可同時讀取電子羅盤、
超音波以及左右輪編碼器的信號，並且控制左右輪伺服機以及爪子夾具達到追球入門以及
NURBS 軌跡追蹤的功能。 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
圖 1. 小型機器人系統方塊圖 
 
計畫執行至今已歷時九個多月，具體成果可分為四個子項目作說明，除了(2)正在進行
之外，其餘項目均已完成測試工作。其中的(1)、(2)項屬於第一年計畫的工作，而(3)與(4)
則分別屬於第二年與第三年的工作內容。相關技術詳述於後。 
(i). 以嵌入式微控制器完成小型機器人追球入門之動作: 應用影像處理演算法，使得輪型機
器人能夠辨識及夾取不同顏色的目標球進而送至指定球門的位置。至本年度三月底，該
子功能已經全部測試完成，並將初步成果整理成論文稿件投稿 Proceedings National 
HOST COMPUTER
CCD CAMERA
控制命令發
射板
(89S51)
嵌入式微控
制器
編碼
(HT-12E)
RF發射
(發射模組)
M
左輪伺服機
發射
M
右輪伺服機
RF接收
(接收模組)
接收
解碼
(HT-12D)
機器人動作
控制板
(89S51)
嵌入式微控
制器
光偶
合器
光偶
合器
RF無線傳輸模組
輪型機器人
影像處理單元
控輪
制形
單機
元器
人右輪控制
訊號
(Timer 1)
左輪控制
訊號
(Timer 0)
超音波感測器
(Ultrasonic)
電子羅盤
(Compass)
地磁資訊
回授脈波寬度
夾爪控制
訊號
光偶
合器M
夾爪操作伺服機
RS-232
ATMega 62
ATMega162
5
加 1，並將座標點存至邊點集合 jV 中。此時，新的前景像素被視為下一次八近鄰掃描的基
準點，並將前次像素 1jiP− 設定成背景資料(′0′)。 
步驟②: 重覆步驟一，倘若物體的邊緣為封閉曲線，當邊點座標 jiP 等於起始座標 1 jP ，即 
1 1( , ) , )(j j j ji ix y yx= 時，即完成單一物體的邊點偵測。有關八近鄰搜尋法可參考圖 3 中所示。
先觀察左邊的圖示，掃描過程中發現☆為前景像素，表示有物體存在，進入八近鄰搜尋演
算法則。依序檢測 ′1, 2,…, 8′ 是否為該物體的邊點座標(或是前景像素)，一旦檢驗出它的
下一個邊點為 ′3′ 後，立即將其座標存至該物體的邊點集合中，新的前景像素 ′3′ 被視為
下一次八近鄰掃描的基準點☆，並將前次像素☆設定成背景資料。 
步驟③: 影像圖片中經常存在一些細微的雜訊，因此定義一個構成物體邊緣個數的門檻值 
bT 。倘若第 j 個物體所擁有的邊點像素 jn 在門檻值以下者，即 j bn T< ，被視為影像中的雜
訊。此時，應將物體 j
 
及其邊點記錄刪除。 
 
 
 
 
 
 
 
 
 
 
 
圖 3. 邊點序向排列法示意圖             圖 4.  圓形偵測演算法 
 
步驟④: 影像圖片經由邊點序向排列法處理後，影像中的物體被分割且像素座標分別存入
相對應的集合 1 2, , , mV V VL 。分別選取每一個集合內的第一個邊點 1 jP 與最後一個邊點 j
j
nP 作
驗證，其中 1, 2, ,j m= L 。倘若 1 jj jnP P= ，表示該物體是一個封閉的曲線。相反的 1 jj jnP P≠ ，
該物體的邊點無法構成封閉曲線，可能為雜訊不予考慮。 
步驟⑤： 避免數位化誤差影響偵測正確性，在第 j 個邊點集合中選擇非相鄰的 jaP 、 jbP 、 jcP
三點，判斷是否共線。由 jV  集合中選擇第一個邊點當作 jaP 點，第 nj×30%個邊點為 jbP 點，
第 nj×70%個邊點為 jcP 點，其座標分別為 ( , )j j ja a aP x y= 、 ( , )j j jb b bP x y= 、 ( , )j j jc c cP x y= 。任意
三點能夠構成一個圓形的基本條件為這三點不共線，即可視為一候選圓 
( ) ( ) ( ) ( ) 0j j j j j j j jb a c a c a b ax x y y x x y y− × − − − × − ≠                    (1) 
成立，表示 jaP 、 jbP 、 jcP 三點可以構成一個圓形。 
步驟⑥： 計算圓心與半徑。利用取樣的三點分別為 jaP 、 jbP 、 jcP 來決定圓心 ( , )j jα β 與半
徑 jr 分別為 
( ) ( )
( ) ( )
( )
( ) ( )
( ) ( )
2 2 2 2 2 2 2 2
2 2 2 2 2 2 2 2
( ) ( ) ( ) ( ) 2( ) 2( ) ( ) ( ) ( ) ( )
( ) ( ) ( ) ( ) 2( ) 2( ) ( ) ( ) ( ) ( )
,
4 ( )( ) ( )( ) 4 (
j j j j j j j j j j j j
b b a a b a b a b b a a
j j j j j j j j j j j j
c c a a c a c a c c a a
j jj j j j j j j j j
b a c a c a b a b
x y x y y y x x x y x y
x y x y y y x x x y x y
x x y y x x y y x x
α β
+ − + − − + − +
+ − + − − + − +
= =
− − − − − −( ))( ) ( )( )j j j j j j ja c a c a b ay y x x y y− − − −  (2) 
 
( ) ( ) ( )2 2 22 2 2( ) ( ) ( )j j j j j jj a j a j b j b j c j c jr x y x y x yα β α β α β= − + − = − + − = − + −        (3) 
步驟⑦：假定一個門檻值 dT ，用來檢驗每一個邊點座標距離圓心與半徑之誤差。令計數器 C
起始值為 0，我們可從邊點集合 jV 中挑選任何一邊點 ( , )j j ji i iP x y ，其中 1, , ,  , ,ii n i a b c= ≠L 。
檢測距離圓心與半徑之誤差是否小於門檻值 dT 。其中 
1
2
3 4 5
6
78
1
2
3 4
6
78
5
P
               
( 1, , ,  1, , )
j
i
j
P
j m i n= =L L
7
徑可藉由(3)及(4)得到。後續的動作乃是計算機器足球員與目標球之間的距離及方向角，引
入向量分析的數學工具應用在影像追蹤系統上。如圖 5 中輪型機器人的位置向量分別由綠
色的大圓與小圓中心點座標 ( , )s sα β 、( , )t tα β 所組合而成，圖片中三個不同顏色的滾球圓心
座標為 ( , ),  1, 2,3i i iα β = 。故輪型機器人的方向向量為 [ , ]Tm t s t sα α β β= − −r ，目標球與輪
型機器人前輪間的方向向量分別為 [ , ] ,Ti i t i tb bα α= − −r ，利用向量內積的運算，輪型機器人
前進方向與不同顏色滾球之間的夾角定義為 
             
1cos ( 1, 2,3)m ii
m i
iθ − ⋅= =r r
r r
                          (10) 
 
 
然而，機器人與三個目標球之間的距離分別為 
2 2( ) ( ) ,  ( 1,2,3)i i i t i t iα α β β= = − + − =rl                   (11) 
 此外，以 (10)式計算輪型機器人的方向向量與滾球之間的夾角 iθ ，其值總落於
0 180o oiθ≤ ≤ 之間。例如，圖中的 1θ  與 2θ  計算出來的結果均為小於90o的銳角，無法提
供足夠的資訊告訴輪型機器人到底要順時鐘或者逆時鐘方向轉動。要解決上述的問題，我
們引入向量外積作運算， 
, 1, 2,3im m i i i ia b c i= × = + + =r r r i j k                       (12) 
觀察圖 5 中所示， 1r  與 2r  兩向量分別位於機器人方向向量 mr  的右方及左方，分別與 mr  
作外積運算，其結果仍為向量，但兩者在 z 軸的方向剛好相反。藉由 ic  的正負號可以決
定輪型機器人的旋轉方向，當 ic  為正值，表示輪型機器人必須逆時針轉動；若為負值，
則作順時針動作。  
 
 
 
 
 
 
 
 
 
 
 
圖 5. 輪型機器人位置向量與目標球的方向向量 
 
1.2 轉折點偵測法 
物體邊緣某一點切線方向產生不連續的變化，我們稱此點為轉折點，本文採用
Rosenfeld-Johnston 法[13] 來偵測影像圖片中的轉折點，並比較每一個物體邊點向量的夾角
來決定轉折點的位置。為了計算更連續的近似曲率值，順利分辨相鄰邊點的夾角，避免數
位化誤差產生錯誤的轉折點，本文引入一個平滑因子(Smooth Scaling) κ 。經過邊點序向排
列法的處理後，影像中的物體已經被分割，以下說明乃針對同一物體故省略上標 j。 
針對同一物體上的邊點座標 ( , )i i iP x y= ，由平滑因子κ 可定義出前、後的邊點座標分
別 為 ( , )i i iP x yκ κ κ− − −= 、 ( , )i i iP x yκ κ κ+ + += 。 此 外 ， 由 前 後 座 標 可 定 義 出 所 謂 的
vectorκ − [ ,  ]i iκ κα β ，其中 ( , ) i i i i ix x y yκ κ κ+ += − −α ， ( , )i i i i ix x y yκ κ κ− −= − −β 。利用 iκα  與 iκβ  
兩向量間夾角的餘弦值 iκγ  可計算近似曲率值如下: 
mr
1r
1θ
2r
3r
3θ
2θ
( , )s sα β
( , )t tα β 3 3= rl
1 1= rl
2 2= rl
2 2( , )α β
1 1( , )α β
3 3( , )α β
9
2 2 2( , )D x y ~ 1 1 1( , )k k kD x y− − − ，終點座標則為 ( , )k k kD x y 。座標向量則表示如下: 
T
kxxxX ][ 21 L= ， TkyyyY ][ 21 L=
  
             (16) 
(2) 每一個網路節點之間的距離構成一個矩陣稱之為距離矩陣，定義為 
 
2 2( , ) ( ) ( )ij i j i j i jM i j d D D x x y y= = = − + −                   (17) 
倘若兩個網路節點 ,  i jD D 間有障礙物存在，無法互相連通，則距離矩陣 M 內所相對應的元
素定義為 ijd = ∞。 
(3) 由起始點 1D 至任一網路節點 iD 之代價函數定義為 ic ，其中 i = 1 ~ k。起始點本身的代
價函數定義為 1 0c = 。 
(4) 以順時鐘方向搜尋，所有可能到達 Di 節點之路徑包括 1 iD D 、2 iD D 、…、 1i iD D− ，共計 
1i −
 
條路徑。每ㄧ條路徑的代價函數分別為 ,  1,2, , 1ji j jic c d j i= + = −L ，從這些可能路徑
中選擇一個最小值作為起始點至 Di 節點之代價函數 1 2 1min( , ,..., )ii i i ic c c c −= 。節點標記可定義
為 ( ) [ , ]j i j jiL i D c c d= = + ，其中的 Dj 即為所謂的來源節點。 
(5) 同時，我們也定義了逆時鐘方向搜尋的路徑，以 Di 節點為基準，在它之前的網路節點
Dp ( 2, , 1)p i= −L 以逆時鐘方向搜尋所有可能之路徑包括 1p pD D + 、 2p pD D + 、…、p iD D ，共
計 i p− 條路徑，反向搜尋模式的代價函數以 *c
 
來表示。 
禁行路徑之判斷 
假設移動式機械人在 2R 平面上運動，且所有障礙物均屬於凸形集合。所謂的禁行路徑
可參考圖 10 中所示，考慮節點 1 1 1( , )D x y= 與 5 5 5( , )D x y= 的距離，根據(17)式的計算應為
2 2
1 5 1 5( ) ( )x x y y− + − ，但是兩個節點間存在障礙物 1Ω ，根本是無法連通，距離矩陣內的元
素應該修正為 (1,5)M = ∞ 。為了有效實現本文所提出禁行路徑之判斷方法，藉此決定兩節
點間是否連通，建立完整的障礙物模型是首要的工作。首先由定義一條直線的集合開始， 
 { }0( ) 0TL D D Dα= − =             (18) 
其中 2Rα ∈ ，為這條直線的垂直向量， 20 0 0( , )TD x y R= ∈ 為這條直線上的任一點，且
2( , )TD x y R= ∈ ，因此 0D D−  與 α  為兩正交向量。(18)式所代表的直線可將 2R  平面分
為兩個部份，如圖 7 所示。 T Dα β≥  表示與α 向量同一個方向的半平面(如陰影部份)，而 
T Dα β≤  表示與α 向量相反方向的半平面，其中 0T Dβ α= 。在本文中，多邊形的障礙物 Ω  
可藉由上述方法加以描述，如圖 8 中的障礙物是由 r 個半平面所組合而成，每一條直線方
程式 L 的法線向量 1 2,  , ,  rα α αL  定義為向外。障礙物模型可表示如下: 
( ) ( ) ( ){ }1 1 2 2T T Tr rD D Dα β α β α βΩ = ∆ ≤ ∩ ≤ ∩ ∩ ≤L              (19) 
T Dα β>
α
T Dα β=
T Dα β<
0D
               
   圖 7. 直線方程式切割平面的表示              圖 8. 多邊形障礙物模型表示法 
 
其中「∩ 」代表「且」的意義。利用多邊形障礙物模型(19)有助於解決兩個節點間是否為
禁行路徑的問題，其判斷準則與相關步驟陳述如下: 
步驟①: 經由轉折點偵測可以搜尋到每一個障礙物的頂點座標為 ( 1,2, , )ji jP i r= L 。 
步驟②: 對於每一個障礙物中連續二個轉折點(或稱為頂點)，可以決定出一條直線方程式，
Ω
1α
2α
rα
11
演算法的動作流程請參考表 I 中所示。依上述流程，計算每一個節點之代價函數並且完成
順向與反向的搜尋評估，藉以更新所有節點的網路標記。最後，我們可以由終點 Dk 的節點
標記依序向前尋找它的來源節點，直到起始點 D1 被搜尋到為止，連接 D1、中繼節點與 Dk 即
構成所謂的最短路徑。 
以圖 10 為例作說明，圖中存在兩個障礙物，分別為 1Ω  和 2Ω ，經過轉折點偵測的影
像處理後，所有網路頂點的座標為 1 (0,0)D = , 2 (10,5)D = , 3 (5,5)D = , 4 (3,9)D = , 5 (5,13)D = , 
6 (10,13)D = , 7 (12,9)D = , 8 (22,15)D = , 9 (14,15)D = , 10 (13,16)D = , 11 (17,23)D = , 12 (19, 23)D = ,
13 (23,16)D = , 14 (25,25)D = 。採用本文所提的修正型 Dijkstra 演算法來搜尋由起點 1D 到達終
點 14D 的最短路徑，右表為每一個網路節點的手算過程。值得一提的是 6D 與 12D 節點，利用
反向搜尋才發現它的來源節點為 7D 與 13D 時可以獲得最短路徑的代價函數，當然這是因為
代價函數 7 6c c< 且 13 12c c< 所致。我們可以由終點 14D 的節點標記找到它的來源節點為 12D ，
再由 12D 的節點標記依序向前搜尋直到起始節點 1D 為止，搜尋到的最短路徑為 
1 7 13 12 14D D D D D→ → → → 。 
 
                     表 I : 修正型 Dijkstra 演算法程式流程            
Define: (1) 0;  (1) 0;c I= =  
 ( 2, , )for i i k i= ≤ + +      /* forward search loop*/ 
  ( 1, 1, )for j j i j= ≤ − + +  
  ( ) ( ) ( , );fc j c j d j i= +  
  ( )do loop j   
 [ ( ), ( )] ( );c i I i min fc=  
  ( ) ( 1) if c i c i then< −      /* reverse search loop*/ 
  ( ) ( );rc i c i=  
   ( 1, 2, )for p i p p= − ≥ − −  
   for (q = i; q ≥ p+1; q--) 
    ( ) ( ) ( , );rc q rc q d q p= +  
   do loop (q) 
   
* *[ ( ), ( )] ( );c p I p min rc=  
   
*
 ( ) ( ) if c p c p then>   /*compare F-R cost*/ 
    
* *( ) ( ); ( ) ( );c p c p I p I p= =  
    end if  
  do loop (p) 
  end if  
do loop (i)                                                       
* [c, I] = min(x),執行後 c 為 x 向量中最小元素值, I 則為最小元素位於 x 向量的指標值. 
亦即 c 為代價函數, I為來源節點.  
 
 
 
 
 
 
 
 
 
 
 
 
圖 10. 修正型 Dijkstra 演算法的手算過程 
網路節點 節點標記 搜尋方向
1D
2D
3D
4D
5D
9D
8D
7D
6D
11D
10D
12D
13D
14D
1 [ (1), 0]L c=
2 1 12[ , (2) (1) 7.07]L D c c d= = + =
1
2
3
4 5
6
7
8
9
10 11
12
13
14
5 10 15 20 25
5
10
15
20
25
x
y
3 1 13[ , (3) (1) 9.49]L D c c d= = + =
4 3 34[ , (4) (3) 13.96]L D c c d= = + =
5 4 45[ , (5) (4) 18.96]L D c c d= = + =
6 7 76[ , (6) (7) 16.54]L D c c d= = + =
7 1 17[ , (7) (1) 11.18]L D c c d= = + =
8 6 68[ , (8) (6) 22.86]L D c c d= = + =
9 4 49[ , (9) (4) 22.50]L D c c d= = + =
10 4 4,10[ , (10) (4) 29.58]L D c c d= = + =
11 10 10,11[ , (11) (10) 31.58]L D c c d= = + =
12 13 13,12[ , (12) (13) 28.21]L D c c d= = + =
13 7 7 ,13[ , (13) (7) 26.8]L D c c d= = + =
14 12 12,14[ , (14) (12) 37.43]L D c c d= = + =
順 向
順 向
順 向
順 向
順 向
反 向
順 向
順 向
順 向
順 向
順 向
反 向
順 向
順 向
*
*
1Ω
2Ω
13
 由 B-spline 基底函數的特性，每段曲線 ( )js u 被定義在 1[ , ]j k j ku u+ + + 的區間內，並且由 k+1 個
基底函數 
, 1, ,,  , ,  i k i k i k kB B B+ +L 所涵蓋，參考圖 12 所示。透過零階基底函數的轉換，每一條
分段曲線可表示為： 
, ,0 ,0 0
( ) ( ( ) ) ( ) ( ) ,  0,  1, ,  .k kj j k j j k j k js u z u P B u z u P j m+ − + + + − +
= =
= = =∑ ∑l l l l l ll l L       (25) 
第 j 段 B-spline 曲線的形狀僅與控制點 1,  , ,  j j j kP P P+ +L 以及零階基底函數之相對應係數
, 1, 1 ,0,  , ,  j k j k j kz z z+ − +L 有關。 
 
 
 
 
 
 
 
圖 12. B-spline 基底函數所涵蓋區間 
 
為了實現約束最佳化求解 B-spline 曲線控制點的想法，針對均勻分佈的節點向量而言，應
用替換變數的技巧，將相鄰節點的間距作正規化(Normalize)，亦即將變數 u 由 [0,  1)t ∈ 來取
代。我們將 deBoor-Cox 遞迴基底函數(21)拆解成零階基底函數，並且將(25)式進一步轉換
成矩陣形式如下: 
3
2
1 2 3 1
0
1/ 6 1/ 2 1/ 2 1/ 6
1/ 2 1 0 2 / 3( ) , 0,1, ,
1/ 2 1/ 2 1/ 2 1/ 6
1/ 6 0 0 0
j j j j j
t
t
s t P P P P j m
t
t
+ + +
− −   
  
−    = =    
−
  
    
L
        (26) 
本文採用三階(cubic)的基底函數作為平滑軌跡的設計，所建構出來的曲線至少為三次連續
可微，並且保證每個線段 ( )js t 間的位置、速度、加速度均為平滑連續，使得 B-spline 曲線滿
足控制器設計參考軌跡之條件，詳細推導過程可參考[27]。 
約束最佳化方法 
考慮一個具有多邊形障礙物的場地(如圖10)，由 Dijkstra 演算法所搜尋到的最短路徑為
1 7 13 12 14D D D D D→ → → → ，這條路徑是由 0 ~ ( 3)ms s m = 四條線段，5 個通過點組合而成。為
了區分轉折點與通過點的符號，在此將通過點改以 0 0 0 1 1 1( , ) ~ ( , )m m mQ x y Q x y+ + + 表示。一旦將
避障路徑作 B-spline 曲線參數化後，軌跡規劃的問題可以轉換成約束條件最佳化求解2(n+1)
控制點的問題， 0 1 0 1{ , , , , , , },x x x y y yn nP P P P P P n m k= = +P L L 。在二維平面上 x 與 y 軸的分量可
以由曲線 ( )xjs t 以及 ( )yjs t 分別生成，利用這一組控制點 P 建構一條具有三次可微的 B-spline
分段曲線(k = 3)，並且滿足約束條件: 
(A)僅可能通過事先所設定的通過點，期望每一段曲線的初始位置正好落於通過點座標上。 
(B)符合起始點與終點車輪滾動而非滑動之運動約束，亦即符合進、出場條件的限制。 
(C)利用模糊推論引擎來決定 NURBS 分段曲線權重參數 0 1 0 1{ , , , , , , }x x x y y yn nw w w w w w=W L L ，
用來微調曲線某些區段的外型，限制曲率大小滿足車輛轉彎時最小旋轉半徑。 
為了簡化本文之設計，我們假定每一個通過點正好落在每一段 NURBS 曲線的起始位
置上 0( )j ts t = 。然而，最後一個通過點 1mQ + 必須落在第 m 段曲線的尾端 1( )m ts t = 上。每一段
曲線的控制點與通過點座標之間的關係可以表示為 
1 2
1 2
( 4 ) / 6
, 0,1, , 1( 4 ) / 6
x x x
j j j j
y y y
j j j j
x P P P j m
y P P P
+ +
+ +
 + + 
= = +   + +    
L                 (27) 
1ju + j ku + 1j ku + +ju 2j ku + 2 1j ku + +
,j k kB +1,j kB +,j kB
js
L
L
2j ku + +
L
15
NURBS 曲線的權重參數來修改曲率大小，以滿足輪型機器人的最小旋轉半徑。倘若我們偵
測到 jQ 通過點出現過大的曲率值，由於它是 1js − 以及 js 曲線的交會，影響這兩線段的控制
點分別為 1 1 2,  ,  ,  j j j jP P P P− + + 以及 1 2 3,  ,  ,  j j j jP P P P+ + + ，其中以 1jP + 這個控制點對於 jQ 曲率值的影
響最為直接，本文以模糊推論系統針對相對應的權重值 1jw + 進行調整。 
由(31)式可知曲線 ,  x y 分量的二次微分 xjs&& 、 yjs&& 與曲率值大小成正比，利用這個特性來建
構調整權重參數的模糊推論系統。以 0( )xj ts t =&& 以及 0( )yj ts t =&& 作為模糊規則的前件部輸入變
數，並以 1xjδ + 以及 1yjδ + 權重參數的變化量作為後件部的輸出變數。當曲線節點的加速度分量
0( )xj ts t =&& 以及 0( )yj ts t =&& 過大時，表示通過點 jQ 附近曲率過大必須調整。倘若 0( )xj ts t =&& 為正值，
控制點必須向右移動來減小附近的曲率值，故 1xjδ + 取正。相反地，倘若 0( )yj ts t =&& 為負值，控
制點必須向下移動來減小曲率值，故 1yjδ + 取負值。考慮以下結構的模糊推論系統: 
1 1:  ( )   ( )   ,x y x yj j j j j j j j jR IF s t A and s t B THEN C Dδ δ+ += = = =&& &&            (32)  
其中 jA 、 jB 、 jC 以及 jD 為第 j 條規則的模糊集合，其口語化變數定義為
{ }PB, PM, PS, ZE, NS, NM, NB ，分別代表正大、正中、正小、零、負小、負中、負大。分
別採用三角形函數以及單值輸出作輸入與輸出變數之歸屬函數，透過解模糊化的過程決定
輸出值，且權重參數被計算如下 
1 1 1 1( )x x x xj j j jw P Pδ+ + + += + ， 1 1 1 1( )y y y yj j j jw P Pδ+ + + += +              (33) 
2、RF 無線傳輸模組 
本文採用型號為 TG-11 之無線接收/發射傳輸模組，使用頻率為 315MHz，搭配
HT-12E(4-bits 編碼晶片)與 HT-12D 解碼晶片。主控電腦所下達之命令連同密碼以四位元並
列形式輸出至 HT-12E，並且在 TE 腳位降為低電位時由 RF 發射模組以串列形式發送出去。
在接收端的部份，RF 接收模組收到訊號後經由 HT-12D 解碼，通過密碼核定後 VT 腳位將
送出一個高態脈波通知外界。圖 6 為實際示波器所觀察到 TE 與 VT 的時序波形。其中包括
兩組控制命令，每組命令間隔 5000 ms，各包含七筆資料，每一筆資料的發射時間保持
100ms。其中的 CH1 為發射端 HT-12E 的 TE 腳位訊號，可觀察到七個低態脈波。至於 CH2
則為接收端解碼晶片 HT-12D 的 VT 波形，與 TE 訊號比較起來，所延遲的時間 60t ms∆ ≈ 即
為 RF 無線模組信號傳送的時間。控制命令包括起始碼、左右輪轉速以及方向旗標共計七
筆資料。 
 
 
 
 
 
 
 
 
 
 
 
圖 6. TE 與 VT 示波器實測波形 
 
 
 
 
 
圖 14. 實際示波器所觀察到 TE 與 VT 的時序波形 
t∆
1命令 命令2
CH2
CH1
高四位元
起始碼
低四位元
起始碼
高四位元
左輪轉速
低四位元
左輪轉速
高四位元
左輪轉速
低四位元
左輪轉速
伺服機正
反轉旗標
17
3.1 伺服機構之控制信號 
連續旋轉伺服機由外部機殼、控制電路板、直流馬達、減速齒輪和位置感測器組成，
具有完整的位置回授控制電路。由廠商資料得知，供應脈波寬度為 1.5ms，持續 20ms 低態
電壓的 PWM 信號，校正可變電阻可使伺服機呈現靜止不動的狀態，此訊號稱為該伺服機
之中心訊號。輸入脈波寬度為 1.3ms 的 PWM 信號可使伺服機順時鐘全速旋轉，脈波寬度
為 1.7ms 的 PWM 信號可使伺服機逆時鐘方向全速旋轉，相關訊號請參考圖 17 中所示。由
於輪型機器人安裝了三組伺服機，分別用來驅動左、右輪以及爪子夾具，我們所選擇的嵌
入式微控制器至少具備有三組 PWM 信號輸出的功能。 
 
ω
1.5msω =
1.3msω =1.7msω =
 
圖 17. 伺服機之 PWM 驅動信號 
 
3.2 SRF05 超音波感測器 
本系統所使用之超音波感測器是採用 Devantech 公司所出品的 SRF05 模組，其外觀可參
考圖 15 中所示，量測範圍可由 1 cm ~ 4 m。利用信號捕捉功能來量測超音波反射回來的脈
波寬度(us)，乘上比例因子 1/60，推算超音波模組與障礙物之間的距離(cm)。由實驗結果顯
示，超音波反射 Echo 的脈波寬度範圍由100 ~ 25s msµ ，故 SRF05 超音波模組所能量測的距離
大約為 1.67 cm ~ 416 cm。為了保險起見，當脈波寬度在 25ms 以上時即可認定前方沒有障
礙物存在。SRF05 模組的量測誤差大都保持在 3%以內，具有優越的量測性能。 
3.3 HM55B 電子羅盤 
本計畫所採用之電子羅盤為 Hitachi 公司所生產的 HM55B 晶片模組，用來量測目
前輪型機器人的方位與地磁北方的夾角，其外觀請參考圖 15。當機器人的方位改變時，
電子羅盤送出 y 軸與 x 軸地磁強度，分別記為 Mag_y 與 Mag_x。由嵌入式微控制器讀
取後，機器人前進方向與地磁北方之夾角公式可以表示為 
1 _tan
_
Mag y
Mag x
θ −  = − 
 
                           (34) 
為了加速機器人控制單元的執行速度，本系統均以組合語言撰寫周邊介面的驅動程
式。(34)方位角的計算牽扯到反正切函數，在組合語言中並無提供三角函數的指令，最
簡單的作法就是利用查表的方法來尋找方向夾角θ。採用這個方法面臨一個很繁瑣的問
題，我們必須作實驗用電子羅盤量測 0 ~ 360o oθ = 的實驗數據，分別得到每一個角度的
_Mag y 與 _Mag x值，計算兩者比值，乘上 10000 倍後取整數部份，並且轉換為 16 進制
的資料，計算過程如下: 
16
_( ) 10000 , ( )    
_
Mag y
D fix fix x taking integer of x
Mag x
θ
θ
θ
 
= × = 
 
       (35) 
這不僅是一項大工程，而且一項不可能的任務，因為實驗所用的指北針的根本無法分辨 1o  
的刻度範圍。實驗過程中我們只能調整電子羅盤對準角度 0oθ = 、11.25o、22.5o 、33.75o 、
45o 、56.25o、67.5o、78.75o、90o進行 y 軸與 x 軸地磁強度的量測，並根據(35)計算 ( )D θ
19
  
 
 
 
 
 
 
 
 
 
 
圖 20. 小型機器人軌跡追蹤示意圖 
本系統以 ed 、 eϑ 、 eθ 為模糊控制器的輸入變數，以線速度 1( )vϕ∆ = ∆& 以及角速度 ( )wθ∆ ∆& 的
補償值作為輸出變數，比較符合駕駛者的經驗法則。在設計過程中，同時考慮了 eϑ 以及 eθ 兩
個誤差角。這是因為只考慮 eθ 的話，視線角 eϑ 的部份無法調整，一旦 0eθ → ，車體只能沿
著參考路徑平行前進。另一方面，只考慮視線角ϑe，一旦缺乏 eθ 的訊息，當 0eϑ → 車體的
運動軌跡會有抖動的現象。 
其次是以專家知識與經驗所建構的 IF-THEN 規則庫進行模糊推論(Fuzzy Inference)來
實現人類在處理事務的邏輯思維。引入駕駛車輛的專家經驗，模糊規則庫建立之準則如下:  
R1 : 當 eϑ 接近於零且 eθ 較小時，車體應快速前進避免有任何轉彎的動作，此時的 0w∆ → 。 
R2 : 假如距離誤差 ed 趨近於零時，調整載具的角速度 ( )w∆ 比調整線速度 ( )v∆ 來得重要。
所以此時的 ( 0)v∆ → ，而 w∆ 隨著 eθ 而變化。 
R3 : 假如距離誤差 ed 非常大，則輪型機械人只會向前運動而不旋轉 ( 0)w∆ → ◦ 
R4 : 角速度補償值 w∆ 將隨著 ed 遞增而逐次遞減，並隨著 eϑ 或 eθ 的遞增而增加。 
R5 : 線速度補償值 v∆ 將隨著 ed 遞增而逐次遞增，並隨著 eϑ 或 eθ 的遞增而減少。 
最後經由解模糊的過程(Defuzziation)將推論出來的結果 ( , )v w∆ ∆ 轉換成左、右兩輪的滾
動速度，其中 2b 為輪距，r 為車輪半徑，參考[26,ch4] 
1 1
2 2 2 2
2( )
v
b
v w
r
ϕ ϕ
ϕ ϕ ϕ ϕ
= + ∆


= + ∆ = + ∆ + ∆
& &
& & & &
                    (37) 
5、以 AC12 接收機實現虛擬距離單機定位之動態實驗(第二年計畫) 
除了標準的 NMEA 輸出格式之外，大部分的接收機都會提供所謂的原始資料(raw data)
以供使用者自行解算，利用差分定位演算法以大幅提高定位之精度為主要目的。本計畫採
用 Thales 公司所出產的 AC12 接收機，它的 OEM 板報價大約$150 美金。除了低價位之外，
接收機本身具有載波相位輸出，對於微弱信號具有高靈敏的接收能力、快速鎖定衛星之功
能以及優越的電源管理模式等優點是選擇 AC12 接收機的原因。 
GPS 為三維的即時定位系統，衛星繞行軌道時它會不斷地向地球廣播所謂的星曆資料
(Ephemeris Data)以及導航訊息。地面上的 GPS 接收機收到星曆資料後會進行解算，得到每
eθ
dθ
θ
eξ
θ
eη
ed
r
x dx
r
y
dy
eϑ
eϑ
φ
r
2b
21
 .Sun .Mon .Tues .Wed .Thur .Fri .Sat
00 : 00 : 00 oet
reference
 
圖 22.  GPS 時間 
 
例如，2008 年 12 月 17 號晚上 21 點 41 分所作實驗，GPS 接收機讀取到 4 個 bytes 的
rcvtime(ms)資料分別為 12 63 4A 68，換算結果為 308497 秒，剛好是在星期三 13 點 42 分
的時刻。上述為 UTC 時間，必需加上 8 才是台灣的時間。藉由 PBN、SNV 以及 MCA 三
組原始資料便可進行 GPS 定位座標的解算。 
6、結合語音播報與 RFID 在導盲機器人之設計(第三年計畫) 
視障朋友們長期處於黑暗的世界中，缺乏影像的資訊使他面臨外在環境以及障礙空間
的挑戰，其危險性比一般正常人高出數百倍。尤其在戶外活動時祇能藉耳朵與柺杖來探索
週遭的環境，再憑模糊的印象來推測所在的位置。本計畫的最終目標乃針對盲人的需求設
計類似導盲犬的可魯機器人，結合無線射頻辨識(RFID)與語音播報系統來取代傳統導盲磚
的公共設施。近年許多 RFID 晶片廠商願意公佈介面協定的原始碼，使得這項技術得以廣
泛地被應用。本計畫將 RFID 的卡片標籤(Tag)黏貼於導盲磚上，導盲磚所蘊含的訊息是藉
由語音播報系統提供盲人作為方位辨識、公車資訊、建築物導覽或者障礙物警告等。目前
的進度是將 RFID 讀卡機、超音波感測器以及語音晶片結合在一台無動力的輪型機器人(底
部具有三個自由輪)上，前端並以一根柺杖作聯結由盲人推著前進。一旦接近導盲磚，RFID
將讀取 Tag 上的 UID 碼(距離是 1.75-3 英吋)透過語音播報系統以聲音告知視障者行走的方
向與周遭環境之訊息。本系統有三大部分，無線射頻辨識系統 RFID，語音播報系統以及超
音波感測器。超音波感測器是採用 SRF05 模組，最大量測距離可達 4 公尺以上。ISD4004
是由美國 ISD 公司所推出的語音晶片，可以多次錄放音、儲存的語音時間長、不需要額外
擴充記憶體以及簡單的週邊介面電路等優點。此外，ISD4004 的特點還包括它所紀錄的每
一段語音資料並沒有長度的限制，而且錄音資料不必經過 A/D 轉換及壓縮，以快閃記憶體
作為儲存的介質，電源關閉後儲存時間長達 100 年，重複錄音的次數更是高達 10000 次以
上。ISD4004 具有長時間儲存語音資料的優點(有 8 分鐘、12 分鐘以及 16 分鐘的分別)，本
計畫所使用的語音晶片為 ISD4004-12MP 可儲存 12 分鐘的語音資料。 
 
 
 
   
 
 
 
 
 
 
圖 23. 導盲機器人之雛型設計 
Ultrasonic
Encoder
Compass
GPS
Voice
CMOS Sensor
 
23
[實驗 2] Matlab 工具箱的圖形使用者介面(Graphical User Interface；GUI) 撰寫避障路徑模
擬軟體，於 Pentium 4 (2.8GHz) CPU 個人電腦下執行。將本文所提出的邊點序向排列法、
轉折點偵測法、禁行路徑偵測法以及修正形 Dijkstra 最短路徑搜尋等方法集中在一個多功
能的整合型視窗內。至於環境模型中的障礙物分佈可藉由 CCD 所擷取的影像照片或者由使
用者自行選擇設定。例如圖 25(a) 的工作區間，起始點座標位於(0, 0)，終點座標為(25,25)，
使用者選擇一個中心點在(10,5)半徑為 3 的三角形障礙物，一個中心點在(15,15)半徑為 3 的
五邊形障礙物以及一個中心點在(20,20)半徑為 2 的六邊形障礙物，希望設計一條由起始點
到終點最短路徑曲線。由影像處理的轉折點偵測演算法可以得到共計 1 19~D D 個網路節點，
啟 動 路 徑 規 劃 的 按 鈕 ， 藉 由 修 正 型 Dijkstra 演 算 法 所 得 到 的 最 短 路 徑 為
1 9 15 19D D D D→ → → ，如圖 25(b)所示。圖 25(a)是稍微將五邊形障礙物向左邊移動，使其
中心點位於 (12,15)。有趣的是路徑規劃的結果竟然會大不相同，最短路徑變為
1 4 12 11 14 15 19D D D D D D D→ → → → → → ，如圖 25(b)所示。 
   
圖 25(a). 障礙物的分佈情形   圖 25(b). 路徑規劃的結果 
  
圖 26(a). 障礙物的分佈情形    圖 26(b). 路徑規劃的結果 
 
[實驗 3]  以嵌入式微控制器完成小型機器人追球入門之動作 
為了實現影像追蹤系統的功能，首先在實驗室裡建置了整套的實驗設備，其中包括 CCD 影
像處理單元、RF 無線通訊模組、輪型機器人控制單元，參考圖 27 中所示。本系統以 MATLAB
作為工作平台，嘗試以 GUI 工具箱建立如圖 28 的圖控視窗畫面，其右下角為影像擷取框
架，基本功能包括 
(1) 影像重置: 負責清除影像分析框架內的資料以及實際影像顯示區域。啟動初始化 CCD
攝影機，清除影像擷取卡的資料緩衝區。 
(2) 影像擷取: 下達影像擷取命令 getsnapshot，並且將整個足球場地的布景與物體全部顯
示在實際影像區域中，如圖 28 之右上角區塊。 
25
  
 
 
 
 
 
 
 
 
 
 
 
 
圖 28. GUI 圖形視窗介面 
 
 
 
 
 
 
 
 
 
 
 
 
圖 29. 機器足球員夾取指定球          圖 30. 機器足球員朝向指定球方向移動 
 
圖 31. AC12 即時解算視窗畫面 
27
四、結論與建議 
第一年計畫執行至目前為止，相關的成果、結論以及建議將陳述如下: 
(1). 建立小型機器人影像追蹤系統的工作平台，從硬體組裝、單元測試、系統整合到嵌入
式微控制器組合語言設計以及 MATLAB 工作平台高階語言的撰寫，全部自行動手完成，
以厚植小型機器人開發設計能力。由實作過程中培養經驗逐步掌握關鍵技術。 
(2). 本計畫提出邊點序向排列法，事先進行物體的切割，將影片中每一個物體的像素進行
分類與排序對於後續圓形偵測與轉折點偵測可大幅提升速度。其原因乃針對一個物體的像
素集合作處理與整張圖片的像素比較起來已經減少很多，計算的時間也相對地降低。其次，
在分類集合中任意選取三個點必可保證在同一個物體，不必要花費額外時間來驗證是否為
候選圓。最後，在分類集合中選取 0%、30%、70%三個點作圓形偵測，可以保證取樣的三
點必定等距地分佈在物體的邊緣上，不必花費額外時間在排除取樣不佳的偵測結果。 
(3). 提出一套有系統的方法來解決路徑規劃的問題，基於邊點序向排列法，多邊形障礙物
的轉折點偵測以及圓形偵測才能順利被執行。其次，以障礙物的轉折點當作網路節點，引
入禁行路徑幾何偵測的觀念，運用修正型 Dijkstra’s 演算法尋找一條最短且具平滑效果的避
障路徑。 
(4). 基於零階基底函數的轉換，在 1.4 中推導了分段 B-spline 曲線的矩陣型式，成功地引入
各種約束條件，進行最佳化的求解成為路徑規劃關鍵技術。在環境模型的基礎下，針對輪
型機械人規劃一條避障路徑，不僅能夠穿過事先所設定的通過點，並且滿足車體的進、出
場限制以及最小旋轉半徑的約束。B-spline 曲線具有快速收斂、局部學習與分段調整等特
質。之後引入模糊推論作為權重調整的方法，分段 B-spline 曲線擴充成分段 NURBS 曲線的
設計，使得參考軌跡的局部修改或調整非常具有彈性與效率。但利用模糊推論的方式作為
權重參數的微調，似乎無法獲得很好的效果，未來建議改用其他方法繼續研究。 
(5). 在小形機器人的實作方面，採用 PWM 驅動的伺服機來取代傳統的直流馬達，使得定
位精度明顯的提高很多。為了隔離馬達電感特性所造成的誤動作，在伺服機輸入信號前加
入光耦合器可以避免電感雜訊對於 RF 無線傳輸模組所帶來的誤動作。本系統採用低價位
的TG-11之無線接收/發射傳輸模組，配合HT-12E以及HT-12D編/解碼晶片的TE 以及VT 腳
位作交握協定可以提升傳輸資料的正確性。但在電瓶電力不足或者天線方向不對，仍有誤
動作發生。未來建議改用高單價的 Zigbee 或者藍芽無線通訊模組改善這個問題，並可建構
全雙工無線收發的功能，改善現有狀態下主控電腦單向對輪型機器人傳送控制命令的方
式。改成雙向溝通之系統，使得感測器量測的信號能夠傳到主控電腦，控制演算法可由主
控電腦分擔，不僅減輕嵌入式微控制器的負荷，並且提高整個系統的穩定度及可行性。 
(6). 反覆利用 CCD 影像擷取與分析來獲取輪型機器人與目標球之間關係固然可行，但耗費
大量的運算時間以及 RF 無線模組傳輸時間，對於取樣時間要求較為嚴苛的工作任務 (如軌
跡追蹤等)無法得到令人滿意的效果。引入慣性導航的感測元件如電子羅盤以及超音波提昇
小型機器人的運動速度及靈活性將無可避免。市面上所提供的超音波感測器，即使是低價
位的產品也都能夠獲得令人滿意的測距精度。然而，電子羅盤不僅取得困難，且量測效果
不佳與預期結果落差甚大。如本系統所使用的 HM55B 模組價位在$3500 元左右，但非常容
易受到環境、溫度及濕度的干擾。廠商建議在每次使用前必須作定位校正，但以組合語言
查表的方式來處理反正切函數值，每次校正都必須更換表格資料，似乎是不可行的辦法。
在整個實作過程花費了許多時間在提昇電子羅盤的定位精度並未獲得很好的成效。準確度
較高的電子羅盤大都屬於軍規系統取得不易，動輒數萬元以上，尋找適當的替代品乃是目
前當之急務。 
(7). 採用 MATLAB 作為主控電腦的工作平台無非想利用它強大的影像處理以及 GUI 視窗
工具箱，但也必須接受執行速度緩慢的事實，採用 C 或者 JAVA 作為高階語言的工作平台
成為刻不容緩的工作了。此外，目前採用第三代晶片 ATMega162 作為機器人的微控制器尚
可滿足目前的工作需求，但未來加入 CMOS 或 GPS 感測器恐怕就無法應付。在未來計畫中
尋找 ARM 第四代嵌入式微處理器的小型公板取代 ATMega162 微控制器恐怕無法避免。 
29
  
 
 
 
 
第二年計畫成果報告 
 
 
 
 
 
 
 
 
 
 
 
 
 
 Abstract 
To establish guiding system for blind pedestrians, the proposed system integrates B-spline 
obstacle-free path planning, hierarchical trajectory tracking control, global positioning 
system(GPS), CMOS image sensor and multi-sensors fusion techniques to form a three-year 
project. The works of second year include two parts; the first is to implement the trajectory 
tracking control of B-spline curve for wheeled mobile robots based on embedded microcontroller. 
Fuzzy logic controller will be used to infer the output of wheel speed according to the current 
location of the mobile robot and following path. The second is to integrate ultrasonic and CMOS 
image sensors into the wheeled mobile robot to avoid obstacles in real time and move to target 
location. Nonholonomic systems are characterized by constraint equations involving the time 
derivatives of the generalized coordinates. Among them, the wheeled mobile robots can be 
treated as the classical examples. The kinematic equation of such system may be derived from the 
nonholonomic constraints, and involved the relationship between the generalized coordinates and 
control inputs(or privileged velocities) of system. Dynamics belong to the scope of fundamental 
principle in mechanics, which is more realistic to describe the relationship between applied 
torques and state variables of the system. Using geometric constraints as well as non-holonomic 
constraints, a systematic and structural procedure is proposed to derive the kinematics of 
mechanical system. Furthermore, a set of measurement equations for encoder are established to 
obtain the coordinates of wheeled mobile robots. Fuzzy inference system formulates expert 
knowledge and experience using a set of IF-THEN rules, embedded on the Microcontroller 
ATMega162, which provides human-like reasoning and decision-making to realize the B-spline 
trajectory tracking control. On the other hand, ultrasonic and CMOS image sensors are integrated 
successfully into the wheeled mobile robot to avoid obstacles in real time and move to target 
location. For small convex obstacles, the CMOS image sensor will be used to capture visual 
information in the front of robots. By using the proposed image channel select method, an 
obstacle-free path in the workspace is found so that the robot can arrive at the goal location safely. 
Next, let us consider a large convex obstacle, the obstacle detection are carried out by six 
ultrasonic sensors imposed on the platform of wheeled mobile robots. The PD controller is 
applied to realize wall following algorithm by keeping the pre-designed distance from robot to 
obstacle. Wall following algorithm is a popular and useful technique to obtain the shortest 
obstacle-free path for mobile robot navigation. To demonstrate the effectiveness of the proposed 
trajectory tracking fuzzy control strategy, a scale-down prototype system has been established in 
the laboratory to support our research. Experimental results show that the proposed real-time 
obstacles avoidance system is applicable, and gives good results. 
 
32
牆前進法(Wall Following)被認為是一種最為普遍且最實用的避障演算法，結合超音波感測
器實現沿牆走法的避障策略成為許多學者研究的主題。1995年Yuta及Ando[7]在機器人的前
方及左右兩邊不同位置安裝超音波感測器，完全依賴超音波的距離資訊，完成沿牆走法的
目標。1992年Huang以及Lee在[8]中提出H模式(Heuristic mode)及T模式(Track mode)兩種避
障策略，其中的T模式就是讓機器人保持一個安全距離沿著障礙物邊緣前進的演算法。文中
證明沿牆走法具有最短距離之代價函數的特性，完成理論背景的推導。後續的文章[9]，利
用模糊推論的方法來實現H模式及T模式似乎是非常可行的作法。再來，融合多個超音波感
測器的測距資料來建立週遭環境的地圖資訊，或者建立障礙物表面的形狀模型也是另外一
個重要的研究主題[10,11]。近年來，電腦的速度愈來愈快，利用影像處理的技巧進行避障
的即時反應，可行性變得愈來愈高。事實上，增加CCD攝影機或者是CMOS影像感測器的
平面資訊可以解決超音波搜尋距離過短，視角範圍不夠等缺點。但龐大的資料量及過重的
計算負荷，採用嵌入式微控制器為工作平台恐怕是一大挑戰。其次，如何判斷影像中的區
域內有障礙物，機器人必須閃避為另一個關鍵性的技術。Ohya等人[12]將整張影片分為五
個區域，計算每個區域內像素的平均值，若超過門檻則判定此區域內有障礙物。2006年
Abdelfatah[13]等人所提的障礙物偵測法則，透過量化的過程將原圖分割成12 x 16個導航格
點(Navigation Grid)，藉由Right、Left、Stop權重參數建立機器人前進、左右轉即停止等命
令，進而達成避障之目的。文[14]中，機器人所拍攝的影像與原先儲存的影像互相比對，如
果有差異表示有障礙物出現。此外，論文[15]整合GPS、電子羅盤、超音波及攝影機等感測
元件，使導航車能追尋路面上預先規劃好的標線軌跡，並且具備即時閃避障礙物的功能。
第二年的計畫目標 (I) 是以 ATMega162 嵌入式微控制器作為系統核心，結合超音波及
CMOS 影像感測器來偵測環境中的障礙物，並且透過沿牆走法及通道選擇法來閃避障礙
物。超音波感測器用來對付大型障礙物，文中嘗試以六個超音波的距離資訊執行沿牆走法
的避障策略。CMOS影像感測器用來偵測小型障礙物，透過影像處理的技巧將影片中的區
域分為五個通道，藉由障礙物分佈參數決定機器人所應該選擇的通道，以閃避障礙物。 
除了閃避障礙物之外，第二年計畫另外一個核心目標為以模糊推論實現輪型機器人軌
跡追蹤控制。輪型機器人為具有約束性質的機械系統，早在 1990 年代開始便吸引學者青睞
的眼光，尤其是運動模型本質的探討與控制器設計更是目光的焦點。眾所皆知，一個機械
系統的運動模型是由非完整約束矩陣推導而來[17]。考慮具有 N 個剛体之機械系統，至少
需要 6N 個位形變數(Configuration Variable)來描述每個剛体的質心位置與轉動關係。倘若該
系統具有K條幾何約束與L條非完整約束，則出現在L條非完整約束的廣義座標(Generalized 
Coordinates)降為 n = 6N – K 個。事實上，所謂的非完整約束是對廣義速度所存在之約束條
件，由於 n > L，故系統存在 m = n - L 個變數，稱之為特權速度或控制輸入。由於控制輸
入所構成的空間維度小於廣義座標空間維度，由機械的觀點可視為欠驅動(Under-Actuated)
系統。本文提出一套結構化的方法來推導欠驅動系統的運動模型，使得每一條約束方程式
的幾何與物理意義更容易被掌握。在實際應用中，許多機械系統屬於欠驅動系統，如何設
34
二、輪型機器人感測元件分析 
本文所組裝的輪型機器人是由四個剛體(Rigid Body)所組合而成，分別為一個平台
(Platform)、左右兩個固定輪(Fixed Wheels)以及一個用來支撐後方重量的自由輪(Castor 
Wheel)。在感測元件方面，機器人前方的中央位置架設一台 CMOS 影像感測器，用來取得
前方的影像資訊，判斷是否存在小型障礙物，作為閃避決策的依據。在機器人的左前方、
右前方及左右兩側各安裝一顆超音波感測器，利用六顆 Devantech 公司所出產的 SRF05 超
音波作為距離量測，用來探知大型障礙物的存在，藉由四個超音波取得機器人與障礙物之
間的相對應關係，實現沿牆走法的閃避策略，繞著障礙物的周圍朝目標前進。此外，機器
人上方安置一塊 320x240 繪圖模式液晶顯示器作為人機溝通的介面，經過嵌入式微控制器
處理後的二值化影像以及控制資訊均可顯示在這塊 LCD 上。輪型機器人的動力來源分別由
固定在左、右兩輪的伺服機所提供，用來控制輪型機器人的前進、後退、左轉以及右轉等
相關動作。左右車輪伺服機的兩側分別安裝兩組光學編碼器(Optical Encoder)，當車輪滾動
時，編碼器依序送出串列脈波，藉此計算車輪滾動的距離，進而換算出輪型機器人的座標。
此外，在實際車體上另外安裝了由 Topteam 科技所出產的 TDCM3 電子羅盤(Compass)以取
得機器人目前的方位角。輪型機器人的實際成品位於圖 1，而圖 2 為整個機器人的系統方
塊圖。 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
圖 1: 機器人本體外觀及週邊元件 
 
 
 
 
 
 
 
繪圖模式液晶
顯示模組
超音波
測距感測器
CMOS
影像感測元件
36
它不僅具有色彩移動、物體移動追蹤的功能外，並且具有平均色彩以及辨識色差的能力。
藉由鏡頭上的焦距可調整影像輸出的品質，並可任意擷取影像視窗的大小。此外，微處理
器 SX52 的 I/O 埠支援了五組伺服馬達，以方便使用者進行追蹤控制的驅動器。採用 UART
介面輸出，允許 9600, 38400, 57600,115200 等鮑率規格，體積小，功率低，非常適合安裝在
小型機器人作為影像視覺之用。具備兩種影像解析度以及兩種影像輸出格式供使用者選
擇，分別為 87 x 143、160 x 255 像素以及 RGB、CrYCb 兩種輸出格式。本系統的影像解析
度採用 87 x 143 像素，影像輸出格式為 RGB，UART 傳輸速度鮑率定為 115200。圖 4 乃針
對上述規格的影像圖片，CMUcam2+所送出來的封包格式，其中包括了 Group 1、2、3 組
資料。 
 
 
 
 
圖 4: CMOS 影像輸出規格 
 
Group 1 共計三筆資料，以 01H 作為起始辨識碼，之後出現的兩個位元組分別代表這張影
片中 x 軸像素與 y 軸像素的大小。Group 2 共有 143 組列框(row frame)資料，每一組列框資
料中都是以 02H 作為辨識碼，僅接在後面的是每一列元素的 RGB 顏色分量，共有87 3× 筆
位元組資料。最後的 Group 3 只有兩筆資料 03H，3AH，代表這一張影片的結束碼。綜合
以 上 所 述 ， 每 傳 送 一 張 影 像 影 片 ， CMUcam2+ 所 送 出 來 的 封 包 資 料 共 計
37468))387(1(1432 =×+×+ 個位元組，大概需要 38K 記憶體空間才夠容納。  
2-2.  影像緩衝區 
本文採用 87 143× 像素的 RGB 影像輸出，經由 CMOS 影像感測器拍攝下的影像資料
量非常龐大，每讀取一張圖片大概需要 38K 記憶體(RAM)作為儲存緩衝區。然而，本文採
用 ATMega162 晶片作為系統的微控制器，內部可使用的資料記憶體 SRAM 為 1K byte，不
足以儲存一張圖片的影像資料。為了滿足大量資料的儲存需求，本研究使用微控制器
ATMega162 外部記憶體 SRAM 擴充功能作為影像緩衝區，由原來 1K bytes 擴充到 64K 
bytes。圖 5 為外部擴充記憶體的方塊圖，圖中的栓鎖器是用來將八位元位址匯流排與資料
匯流排分開，CMOS 影像感測器藉由串列通訊所傳送出來的 RGB 像素資料將被暫時存放在
這塊 64K 的記憶體內。 
 
 
 
1 xSize ySize 2 rgb rgb … rgb rgb 2 rgb rgb … rgb rgb 2 rgb rgb … rgb rgb 3 
87 143
共計87個像素
共計143筆列框
38
2-4.  SRF05 超音波感測器 
本系統所使用之超音波感測器是採用 Devantech 公司所出品的 SRF05 模組，其外觀可
參考圖 6 所示，量測範圍可由 1 cm ~ 4 m，具有優越的量測性能。兩種應用模式可供使用者
選擇，模式 1 乃使用 SRF05 模組之 Trigger in 與 Echo out 兩支接腳作為觸發致能以及回應
脈波。模式 2 則將觸發致能和回應脈波共用單支接腳，優點在節省嵌入式微控制器的 I/O
接腳，右圖為 SRF05 超音波感測器模式 2 腳位使用狀態。 
    
圖 6: 超音波感測器模組及模式 2 狀態下之接腳 
 
本文採用模式 1 的操作腳位，相關控制時序可由圖 7 觀察得到。首先利用機器人控制
板上之嵌入式微控制器傳送 10 sµ 的高態脈波給 SRF05 超音波模組之 Trigger in 觸發致能
端，其內部會自行振盪並發射出 8 個週期的 40KHz 超音波訊號，並使 Echo out 腳位轉為高
電位。超音波訊號打到障礙物回彈給 SRF05 模組，將會使得 Echo out 輸出腳位降為低電
位，由於 Echo 訊號維持高電位之寬度與超音波發射與彈回的時間成正比關係，故利用脈波
寬度來推算超音波模組與障礙物之間的距離是可行的方法。 
 
內部電路
發射超音波
40KHz 8CYCLE
超音波
迴音訊號回傳時間100us-25ms
若時間超過30ms即代表無偵測到物體
觸發脈波訊號
至少10us之脈波寬度輸入觸發脈波
訊號至RF05
輸出
迴音訊號波形
至使用之微控制器
MODE 1 控制時序圖
 
圖 7 超音波感測器模組於模式 1 狀態下之控制時序圖 
 
 
40
1.3 1.35 1.4 1.45 1.5 1.55 1.6 1.65 1.7
-4
-3
-2
-1
0
1
2
3
4
ra
d/
s
Width of PWM (ms)
廠廠廠廠
實實實實
 
由圖中可知當 PWM 脈波寬度為 1.6ms 到 1.4ms 之間，伺服機的轉速與 PWM 脈波寬度
能夠維持線性關係，在此範圍內的最大轉速可達 4.2 rad/s 左右。在以下的模擬與實作中，
我們將以此數據作為車輪最高轉速之約束條件。 
2-6. 電子羅盤 
本文採用型號為 TDCM3 的電子羅盤，由 TOPTEAM 公司所生產之模組，實體尺寸
為 19mm × 19mm × 4.5mm，其外觀如圖11 所示。TDCM3為一種雙軸磁場感測器，利用地
球磁場來判定與正北方之方位差，其中地磁北方(N)定義為座標 0°，沿著順時鐘方向旋轉
角度逐漸變大，直到角度 360° 為止。其解析度為 0.5°，測量準確性達到 ±3°，提供正常
(Normal)模式、連續(Continuous)模式以及校正(Calibration)模式供選擇，目的在提供輪型機
器人方位角之資訊。 
 
         
1
54
2
3 6
8
7
 
      圖10: 方位角示意圖                  圖11: TDCM3 電子羅盤外觀 
 9 :  PWM圖 脈波寬度與轉速之關係圖
42
 3-1. 幾何約束分析 
吾人定義一固定座標系，稱為慣性(Inertial Frame)座標軸 { }, ,x yO E E ，載具的質心位置
PC ，當載具旋轉  θ  角度後，可定義出另外一組座標系稱為剛體 (Body Frame)座標
{ }, ,P x yC e e ，這個座標軸架構於載具上，隨著機械人的移動而變動。本文採用六個變量數 
( , , , , , , 1,  2,  )i i i i i ix y z i pψ ϕ θ =  來描述輪型動機器人每一個剛體的運動模式，其中 ( , , )i i ix y z 代
表每一個剛體的質心座標， ( , , )i i iψ ϕ θ 則代表旋轉姿態。 iθ  稱為方向角(Heading Angle)，為
對 ze  軸的旋轉角度， iψ  稱為側滾角(Camber Angle)，為對 xe  旋轉的角度。 iϕ  則稱為
滾動角(Spin Angle)，為對 ye  旋轉的角度。輪型機器人系統總共有 6 3 18× =  個變數來描
述每個剛體的位移與姿態。為了減化系統的模型，我們可以利用各剛體間的完整約束(幾何
約束)來簡化龐大之變數量。首先假設輪型機器人在水平面上移動，以下三條幾何約束將被
引入， 
(G1)  z1 = r,  (G2) z2 = r,  (G3) zp = hp， 其中 hp表示車體平台的高度。 
其次，我們假定車體平台在機器人的運動過程中保持穩定，無傾斜與側滾的現象發生，以
下兩條的幾何約束將被成立。 
(G4) 0pϕ = , (G5) 0pψ = 。 
倘若左、右兩個車輪在滾動時與地面保持垂直方向運動，不會左右晃動，則左、右兩輪 (i=1,2) 
的俯仰角將被設 0，故 
(G6) 1 0ψ = , (G7) 2 0ψ = 。 
此外，由於剛體間的互相聯結，輪型機器人在運動時所有剛體的方向角應該滿足以下的約
束條件， 
(G8) 1θ 2 ( )θ θ= ≡ 以及 (G9) 2 pθ θ= 。 
參考圖 13 輪型機器人之幾何結構圖，倘若我們以左輪的質心座標 1 1( , )x y  為基準點，則右
輪與車體平台的質心座標可藉由幾何關係引入以下四條約束條件， 
(G10) 2 1 2 sin ,  x x b θ= +  (G11) 2 1 2 cos ,y y b θ= −  
(G12) 1 sin cos ,p rx x b dθ θ= + +  (G13) 1 cos sin ,p ry y b dθ θ= − +  
透過 G(1) ~ G(13) 條的幾何約束，18 個位形變數可以簡化成 5 個變數 1 1 1 2( , , , , )ix y θ ϕ ϕ ，已
大幅降低系統模型的複雜度。 
3-2. 非完整約束分析 
假設 1r 、 2r  分別定義為機器人左、右輪於慣性參考座標{ }, ,x yO E E 的位置向量， rr  定
義為左右輪的中心點於慣性參考座標{ }, ,x yO E E 的位置向量，由輪型機器人的幾何關係可知 
     
1
2
r y
r y
b
b
= +

= −
r r e
r r e
                             (3) 
 
44
 1
1
( ) cos
( )sin
r
r
x b r
y b r
θ ϕ θ
θ ϕ θ
 = +

= +
& &&
& &&
                          (8) 
左輪質心位置 1 1( , )x y  與兩輪中心點位置 ( , )r rx y ，兩者之間的幾何關係如下: 
1
1
sin
cos
r
r
x x b
y y b
θ
θ
= +

= −
                            (9) 
將(9)式代入(8)，並引入 B-spline 參考軌跡的表示法 1 1( , )d dx y ，則左輪滾動的參考速度為 
2 2
1 1 1 1
1
,d d d du x y
r
ϕ= = +& & &                         (10) 
車體方位角轉動的參考速度可被推導得到 
1 1 1 1
2 2 2
1 1
d d d d
d d
d d
x y x y
u
x y
θ −= =
+
& && && &
&
& &
                       (11) 
再經由(G14)式，右輪滾動的參考速度可被推導得到， 
                       2 1
2
d d d
b
r
ϕ ϕ θ= + && &                            (12) 
3-4. 輪型機器人運動模型之推導 
由於 (V1)、(V2) 這兩條非完整約束條件是以 
r
Q  為基準點，故輪型機器人之廣義座
標被定為 1[ ]Tr rx y ϕ θ=q 。重新將約束條件整理成矩陣之形式 0=Dq& ，其中 2×4 的
矩陣 D 被稱之為約束矩陣，可以表示如下: 
cos sin
.
sin cos 0 0
r bθ θ
θ θ
− − 
=  
− 
D      (13) 
q&  被稱為廣義速度，由於 (V1)、(V2) 兩條非完整約束條件的存在，四個廣義速度非完全
獨立，系統的自由度(Degree of Freedom)變為 4 2 2− = 。我們可以從 q&  中選擇 2 個獨立
的廣義速度 1u  以及 2u ，稱之為特許速度(Privileged Velocities)，並將 D 矩陣拆解成兩
部份，一個為非奇異矩陣(Nonsingular Matrix) 2 2R ×′∈D 以及另一個矩陣 2 2R ×′′ ∈D 。剩下的
兩個變數稱之為非特許速度(Non-privileged velocities)，由廣義速度所構成的聯立方程式即
為本系統的運動方程式。針對三輪式移動機器人系統，我們挑選了 2 個廣義速度 1 1u ϕ= &  以
及 2u θ= &  作為特許速度。這是因為在(13)式中，矩陣 D 出現了變數 θ ，為了使得運動方
程式具有解耦的特性，θ&  必須被選為特許速度，至於解耦特性將在以下的段落中被介紹。
另一個特許速度 1ϕ&  代表左輪的滾動速度，它是由伺服機所產生的轉動力矩 τ  直接帶動
產生，選擇 1ϕ&  最大的好處在於所推導出來的運動模型可以獲得最簡潔的形式。 
46
  
 
 
 
 
 
 
圖 14: 光學編碼器脈波輸出 
 
其次，左右輪所行經的路徑可以決定車體偏向角度與其旋轉半徑。當 1 2S S=  時，車
體直線前進；當 1 2S S>  時，車體向右偏轉；當 1 2S S<  時，車體向左偏轉。圖 5 為右輪
行走距離大於左輪，使得車體向左偏轉之示意圖，由圖可知車輪行走距離與旋轉半徑之間
的關係為 
1 1
2 2 1
:                                                            (19. )
: ( 2 )                                  (19. )
S R a
S R R b b
φ
φ φ
= ⋅ ∆

= ⋅ ∆ = + ⋅ ∆
 左輪
右輪  
 
 
 
 
 
 
 
 
 
 
 
 
 
圖 15: 輪型機器人向左偏轉 
 
將 (16.b) 減去 (16.a) 可以得到輪型機器人由 Q  至 'Q  旋轉瞬心所偏移的角度為 
2 1
2
S S
b
φ −∆ =                             (20) 
 
 
 
光學編碼器輸出
直徑=
0  1  2  3  4  5  6  7  8  9
移動方向
φ∆φ
2b
d∆
1S
2S
1R
2R
Q
'Q
6.6cm
48
2 2 2 2
2 2 2 2
[ cos( ) sin( )]
2 2( ) ( ) ( ) ( )
          
[ sin( ) cos( )]
2 2( ) ( ) ( ) ( )
d
d
α pi β piφ φ
α β α β
α pi β piφ φ
α β α β
∆ ∆ ∆ ⋅ ⋅ + + ⋅ + ∆ + ∆ ∆ + ∆ 
=
 ∆ ∆∆ ⋅ ⋅ + − ⋅ + 
∆ + ∆ ∆ + ∆  
         (24) 
利用積化和差三角函數的基本運算，(24)式可以簡化為 
cos( )
2
sin( )
2
m
m
d
x
y d
φφ
φφ
∆ ∆ ⋅ + ∆ 
=   ∆ ∆   ∆ ⋅ +
  
                        (25) 
由於方位角的變化量等於機器人旋轉瞬心所偏移之角度，慣性座標下輪型機器人的姿態(包
括質心位置與方位角)量測方程式，以遞迴形式可表示為 
( )( ) cos ( )
2( 1) ( )
( )( 1) ( ) ( ) sin ( )
2( 1) ( ) ( )
m m
m m
m m
kd k k
x k x k
ky k y k d k k
k k
k
φφ
φφ
θ θ φ
∆  ∆ ⋅ +  
  +   
 ∆     + = + ∆ ⋅ +        +       ∆ 
 
 
             (26) 
 
五、 模糊推論控制器之設計 
模糊系統的精神在引入專家的知識與經驗實現人類邏輯思維的決策法則，所謂專家的
知識大致可分為兩大類:一為可以用口語化的型式來表現的具体化(Conscious)知識，另一抽
像化(Subconscious)知識，通常為實驗所獲得的大量輸入/輸出資料。模糊控制器的架構是以
歸屬函數(Membership Function)將輸入變數進行模糊化的動作，實現人類對於事物主觀的判
斷標準。其次是以專家知識與經驗所建構的 If-Then 規則庫進行模糊推論(Fuzzy Inference)
來實現人類在處理事務的邏輯思維。最後經由解模糊的過程(Defuzziation)將推論出來的結
果轉換成明確的信號。在設計模糊控制器之前，必須對控制問題與受控系統作明確的定義
來決定模糊控制器的輸入、輸出變數及其歸屬函數。圖 17 為三輪式移動機械人軌跡追蹤示
意圖，其中 ( , )d dx y 為 B-spline 參考路徑座標， dθ 為 B-spline 參考路徑的方位角。參考路徑
和機器人間的姿態誤差定義為 ( , , )e e ex y θ ，其中 ,e d r e d rx x x y y y= − = − , e dθ θ θ= − 。而載具
與參考路徑間的相對距離為 2 2e e ed ξ η= + ，載具行進方向與質心至參考路徑連線間的夾角
定義為視線角(Line of Sight Angle) ( )1tane e eϑ η ξ−= ，其中 eξ 以及 eη 可由姿態誤差的座標轉
換得到，其關係為 
cos sin 0
sin cos 0
0 0 1
e d r
e d r
e d
x x
y y
ξ θ θ
η θ θ
θ θ θ
−     
     
= − −     
     
−     
                   (27) 
 
50
 符號 ZE、PB、PM、PS、NB、NM、NS 分別代表模糊集合中的零、正大、正中、正
小、負大、負中、負小。所有輸入變數包括 ed 、 eθ 以及 eϑ  所定義之模糊集合，其歸屬函
數被繪於圖 19(a) 中。輸出變數 1u∆ 及 2u∆  歸屬函數採用如圖 19(b)的單值輸出。根據駕
駛者的經驗法則以及所定義的模糊集合，本文所採用 28 條模糊規則所構成的資料庫，如表
(I)中所示。左邊表格為方位角誤差 eθ  為 "零" 之模糊規則庫，右邊表格為方位角誤差 eθ
為 "正" 或 "負" 的規則庫，所有的模糊集合分別加入一個下標 x，表示原有的單值輸出必
需加入一個偏移量。值得注意的是， 2u∆ 的歸屬函數將根據 eθ 為 "正(P)"、"零(Z)"或"負(N)"
區分為三組。當 eθ  為 "零(Z)" 時，輸出變數 2u∆  的歸屬函數如圖 11(b)所示之單值輸
出。當 eθ  為 "正(P)" 時，將圖 19(b)的單值輸出全部加上一個偏移量 0.3; 當 eθ  為 "負
(N)" 時，圖 19(b)的單值輸出全部減去一個偏移量 0.3，以補償方向角誤差 eθ 所產生的影響。 
 
( )eµ θ ( )eµ ϑ
 
圖 19(a): 輸入變數之歸屬函數 
1( )uµ ∆ 2( )uµ ∆
 
圖 19(b): 輸入與輸出參數之歸屬函數 
 
表 (I) 軌跡追蹤之模糊規則表 
PBPS PMZE
PB
PS
ZE
NS
NM
NB
PM
ed
e
PS
ZE ZE ZE
ZE
ZE
ZE
ZE
ZE
ZE
ZE
ZE ZE
PS
PS PM PB
PS
ZEZE
NS
e
Z
PM
PM
PS
NM
NM ZE
PS
ZE
ZE
NS
NS
ZE
PM
ZE
ZE
ZE
ZE
ZE
ZE
ZE
PS
PS
PS
PM
PM
PS
PB
PB
PM
1u∆ 2u∆ 1u∆ 1u∆ 1u∆2u∆ 2u∆ 2u∆
PB
PM
PS
NS
NM
NB
PBPS PMZE
PB
PS
ZE
NS
NM
NB
PM
ed
e
PS
ZE ZE ZE
ZE
ZE
ZE
ZE
ZE
ZE
ZE
ZE ZE
PS
PS PM PB
PS
ZEZE
NS
e
P,N
PM
PM
PS
NM
NM ZE
PS
ZE
ZE
NS
NS
ZE
PS
ZE
ZE
ZE
ZE
ZE
ZE
ZE
ZE
ZE
ZE
PS
PS
ZE
PM
PM
PS
1u∆ 2u∆ 1u∆ 1u∆ 1u∆2u∆ 2u∆ 2u∆
PB
PM
PS
NS
NM
NB
x
x
x
x
x
x
x
x x x
x x x
x
x
x
x
x
x
x
x
x
x
x
x
x
x
x
 
52
由 CMOS 擷取的影像圖片中，圓形障礙物與正方形障礙物之間的距離為 22 公分，佔有 4
格影像寬度。正方形與長方形障礙物之間的距離為 7 公分，佔有 1 格寬度。至於機器人距
離正方形障礙物有 74 公分，影像深度則佔有 3 格單位。為了滿足影像避障策略的需求，有
關障礙物的影像分佈圖必須進行參數化的處理，將影像的平面資訊轉換成的向量表示法。
以影像寬度作為向量的維度，以每一行障礙物的影像深度作為向量元素的內容值，倘若該
行沒有障礙物，該元素的內容值設為 0。如圖 21 所示，影像寬度為 11，則障礙物分佈向量 
1V  可表示為 
1 [14 0 0 0 0 15 0 15 15 0 0]V =  
其次，本文提出影像通道濾波的方法，目的在選擇一條最適合的通道，讓機器人順利
通過。整張影片被劃分為五個通道，分別為左 1、左 2、中間通道、及右 1、右 2 等通道。
原因在於我們在距離障礙物 74 公分處拍攝的影片，其寬度大概為 72 公分左右，每一台機
器人通過的寬度約為 12 公分，故可容許 5~6 台機器人通過，故以 5 個通道作為本文之設計。
在此，我們為每個通道建立一個權重值，分別定義為 L1、L2、M、R2 及 R1 通道權重，權
值愈大，表示此區塊內的障礙物分佈較多，輪型機器人僅量避免通過該區間。透過影像濾
波向量內積之作用，可以得到相對應通道的權重值，影像濾波器為一組向量，其定義分述
如下: 
R1 影像濾波向量  _1 [0 0 0 0 0 0 0 1 2 3 4]RPF =     (28.1) 
R2 影像濾波向量  _ 2 [0 0 0 0 0 1 2 3 2 1 0]RPF =     (28.2) 
M 影像濾波向量         [0 0 1 1 2 3 2 1 1 0 0]MPF =     (28.3) 
L2 影像濾波向量  _ 2 [0 1 2 3 2 1 0 0 0 0 0]LPF =     (28.4) 
L1 影像濾波向量  _1 [4 3 2 1 0 0 0 0 0 0 0]LPF =     (28.5) 
 
有關圖 20 的 CMOS 影像圖片，五個通道的權重值可分別計算如下 
 
   11 _1 45R V RPF= =通道權重值  
   12 _2 90R V RPF= =通道權重值  
   1 75M V MPF= =通道權重值  
   12 _2 15L V LPF= =通道權重值  
   11 _1 56L V LPF= =通道權重值  
 
由於機器人的正前方為正方形障礙物，故中間通道的權重值高達了 75，表示正前方的障礙
物分佈密度高，機器人不適合通過。右邊區塊有個長方形障礙物，致使 R2 通道的權重值也
高達 90。左邊 L1 通道有一顆小球擋住，使得權重值也高達 56，只剩下左邊 L2 通道的權重
值為 15，允許機器人通過。 
 
 
54
[步驟一] 偵測前方大型障礙物 
 當輪型機器人沿著直線朝向目標物前進，此時車體的線速度定為 1u ，直線前進的角速
度應該為 2 0u = ，根據(17.c)及(17.d)兩式可以求得左、右輪的滾動速度分別為 1 1uϕ =&  與 
2 1uϕ =& 。為了達到滾動速度上的需求，左、右輪伺服機必需分別輸入相對應的 PWM 脈波
寬度信號(參考圖 9 轉速與 PWM 脈波寬度之關係)，使得輪型機器人保持 1u  固定速度前
進。每過 ts ms 取樣時間後，機器人將去讀取正前方超音波感測器 U1 及 U2 的距離資訊，
倘若 U1 及 U2 測出正前方出現障礙物，且兩者的距離均小於事先所定義的安全距離
safe_D，則機器人停止動作。 
1 _ 2 _ .If U safe D and U safe D then MR Stop< < ⇒         (29) 
亦即在左、右輪伺服機分別輸入 1.5ms 的 PWM 脈波寬度信號，強制機器人停止下來，MR
代表輪型機器人。 
 
[步驟二] 調整機器人的姿態方位角 
 為了要進行沿牆走法的演算法，我們必需要調整機器人的姿態方位，使得機器人前進
方向與障礙物的邊緣保持平行。其次，判斷機器人要沿著右邊牆壁前進或者左邊牆壁前進，
假設機器人是沿著左邊牆壁前進，則機器人必需逆時鐘旋轉來調整它的姿態方位角。此時
車體的線速度定為 1u ，角速度則定為 2u ，則左、右輪的滾動速度分別為 1 1uϕ =&  與 
2 1 2(2 / )u b r uϕ = + ⋅& 。其中的 2u  可以決定機器人的左、右轉，當 2u  為正時，機器人左轉; 
反之，機器人向右轉。同樣，藉由圖 9 的關係式可推得到左、右輪伺服機必需施加多大的
PWM 脈波寬度，車體才能順利轉動。每過 ts ms 取樣時間後，機器人將去讀取右邊超音波
感測器 U5 的距離資訊，參考圖 23 所示。剛開始轉動時，U5 應該偵測不到障礙物，距離量
測結果為∞。隨著轉動持續進行，U5 開始偵測到障礙物，且距離量測結果會逐漸變小，這
也代表了機器人的前進方向逐漸與障礙物漸漸趨向平行。一旦平行後，U5 的量測結果應該
會是最小，繼續再轉，U5 量測反而變大了。換言之，每次取樣時間到了，偵測 U5 一次，
遞迴量測結果應該逐漸變小，一旦變大，則令機器人停止，此時機器人的前進方向應該是
最平行於障礙物的周圍牆壁。其演算法為 
1
1
( 5 5 )
( ), 5 5 .
.
k k
k k
While U U
MR Left Turn or Right Turn and U U
end
MR Stop
−
−
≤
⇒ =
⇒
     (30) 
其中的 15kU − 為前一次 U5 超音波的量測值。 
 
 
 
 
56
七、實驗結果 
[Case 1] 針對大型障礙物，本文提出了超音波避障演算法來實現沿牆走法的最佳化路徑設
計，為了驗證本文所提避障策略的可行性，我們先利用 Matlab7.0 程式語言進行模擬驗證，
挑選模擬後的最佳化參數完成輪型機器人閃避障礙物的實作。本文所採用的輪型機器人外
觀如圖 1 中所示，實地量測左右輪半徑以及輪距分別為 r = 3.3cm，2b = 10.57cm。位於左右
輪上的兩組伺服機，其轉速與嵌入式微控制器所送出來的 PWM 脈波寬度之間的關係可參
考圖 9 中所示。至於線速度、角速度與左右輪滾動速度之間的關係可分別參考(17.c)、(17.d)
兩式。圖 24 為輪型機器人不斷地繞著一個六邊形障礙物的模擬結果，障礙物的半徑長約為
50cm，機器人與障礙物之間保持 10cm 的安全距離。配合 U1~U6 超音波所得到的距離資訊，
輪型機器人的控制可分為三個步驟執行，分別為偵測前方障礙物、調整機器人的姿態方位
角、執行沿牆前進演算法，每一個步驟所給定的線速度及角速度，或者是左右兩輪的滾動
速度，甚至是左右兩輪伺服機所施加的 PWM 脈波寬度全部列於表(II)中。圖 25 的模擬除
了上述三個步驟之外還加入電子羅盤，讓機器人前進至目標區域內。圖 26(a)及 26(b)為輪
型機器人沿著一個六邊形障礙物邊緣前進的實作圖片。至於 PD 控制器的參數分別為
1 1 2 20.5, 0.1, 0.2, 0.04p d p dk k k k= = = = ，取樣時間 2st = 秒。 
 
避障策略流程 偵測前方障礙物 調整姿態方位角 沿牆走法演算法 
線速度與旋轉速度 
(rad/s) 
1 1v =  2 0v =  1 0.6v =  2 0.2v =  1 1.5v =   
左右兩輪滾動速度 
(rad/s) 
1 1ϕ =&  2 1ϕ =&  1 0.6ϕ =&  2 1.24ϕ =&  1 1.5ϕ =&  參考 
(17.c d)式 
伺服機 PWM 寬度
(ms) 
1ω =1.519 2ω =1.481 1ω = 1.512 2ω =0.477 1ω = 1.529 參考 
圖 9 
超音波偵測條件 參考(29)式 參考(30)式 藉由 U3,U5(或 U4,U6) 
 
       圖 24: 繞著障礙物前進                     圖 25: 前進至目標區域 
 
58
很明顯地，右邊 R2 通道的權重值為 15，允許機器人通過。圖 29(a)為機器人初始位置，經
過 CMOS 擷取影像圖片及影像濾波進行向量內積作用，選擇 R2 通道可供機器人通過。圖
29(b)為機器人向右滑行至 R2 通道的實作照片，滑行過程分為兩個步驟，首先是令左輪的
滾動速度大於右輪的滾動速度，致使機器人向右畫圓旋轉，待旋轉 2pi 後機器人停止。繼
續作第二個動作，再令右輪的速度大於左輪的速度，致使機器人向左畫圓旋轉 2pi 後機器
人停止。圖 29(c)為機器人向右滑行後的照片，此時 CMOS 作第二次的影像擷取，經過影像
濾波分析後，發現 M 通道的權重值為最小，表示機器人的正前方沒有障礙物，可供前進通
過。圖 29(d)為機器人通過障礙物的實作照片。 
 
       
         圖 29(a): 第一次擷取影像              圖 29(b): 向右滑行逼近 R2 通道 
 
      
       圖 29(c): 第二次擷取影像作分析        圖 29(d): 直行前進並通過障礙物 
 
 
 
 
 
 
 
60
0 20 40 60 80 100 120
0
1
2
3
4
5
6
sp
ee
d 
of
 
rig
ht
 
w
he
el
(ra
d/
s)
Time(s)
 
    圖 30(c): 右輪參考轉速與實際轉速     圖 30(d): 左輪參考轉速與實際轉速 
 
 圖 31(c)與圖 31(d)分別代表整個控制過程 128 秒中左輪與右輪的轉速，其中虛線部份
為車輪的參考轉速，實線部份為左右論實際轉速，單位為 rad/s。值得注意的是，除了剛開
始初始位置與參考路徑偏移過大，左右輪必需用比較大的轉速來修正偏差量之外，其它時
候都保持在最高轉速 4.2(rad/s)之限制下。 
 根據模擬結果，選擇最佳化參數實現輪型機器人軌跡追蹤控制。其步驟與參數規格如
下: 
(1) 取樣時間為 100ms，採用每轉 32 脈波數的光學編碼器，左右輪最大轉速限制為 4.2 
rad/s。 
(2) 選擇如圖 30(a)的 B-Spline 追蹤路徑，每隔 100ms 參考軌跡的座標位置，共計 128 筆
建立成參考軌跡表格資料，內植至 ATMaga162 微控制器的 ROM 內。 
(3) 將圖 30(c)與圖 30(d)左右輪的參考轉速 1 2( , )d du u 轉換成 PWM 的脈波寬度，共計 128
筆資料(包括左輪與右輪伺服機的 PWM 脈波寬度)建立表格，燒錄至 ATMaga162 微控
制器的 ROM 記憶體內。此時，可將輪型機器放至參考軌跡的起始位置上，微控制器
每隔 100ms由表格取出一筆資料送至左右輪伺服機，測試機器人是否能夠繞出一條 ∞  
的路徑。 
(4) 引入 28 條模糊規則，設計模糊推論引擎的程式碼燒錄至 ATMega162 微控制器內。此
時，可將輪型機器人放至距離參考軌跡 50cm(x 軸)、-30cm(y 軸)位置上，測試機器人
行走軌跡是否如圖 30(a)模擬所示，能夠順利地追上參考軌跡。 
(5) 圖 31(a)與圖 31(b)為機器人在參考軌跡上移動的照片。 
 
 
 
 
 
 
 
0 20 40 60 80 100 120
0
0.5
1
1.5
2
2.5
3
3.5
4
Time(s)
sp
ee
d 
o
f l
e
ft 
w
he
el
(ra
d/
s)
62
參考文獻 
[1]. S. S. Ge, and Y. J. Cui, "New Potential Functions For Mobile Robot Path Planning", IEEE Trans. on 
Robots and Automation, vol. 16, no, 5, pp. 615-620, 2000. 
[2]. E. Palma-Villalon, and P. Dauchez, "World Representation and Path Planning for a Mobile Robot", 
Robotica, vol. 6, no. 1, pp. 35-40, 1988. 
[3]. G. Paolo, and G. Alessandro, "A Technique to Analytically Formulate and to Solve the 2-Dimensional 
Constrained Trajectory Planning Problem for a Mobile Robot", Journal of Intelligent and Robotic 
Systems, vol. 27, pp. 237-262, 2000. 
[4]. D. M. Keirsey, E. Koch, J. McKisson, A. M. Meystel, and J. S. B. itchell, "Algorithm of Navigation 
for a Mobile Robot", IEEE Inter. Conf. on Robotics and Automation, vol. 1, pp. 574-583, 1984. 
[5]. E. M. Petriu, "Automated Guided Vehicle with Absolute Encoded Guide-path", IEEE Trans. on 
Robots and Automation, vol. 7, no, 4, pp. 562-565, 1991. 
[6]. K. Jiang, and L. D. Seneviratne, "A Sensor Guided Autonomous Parking System for Nonholonomic 
Mobile Robots", in Proc. IEEE Inter. Conf. on Robotics and Automation, vol. 1, pp. 311-316, 1999. 
[7]. Y. Ando, and S. Yuta, "Following a Wall by an Autonomous Mobile Robot with a Sonar-Ring", IEEE 
Inter. Conf. on Robotics and Automation, vol. 4, pp. 2599-2606, 1995. 
[8]. H. P. Huang and P. C. Lee, "Microprocessor-Based Control of Autonomous Mobile Robots with 
Obstacle Avoidance", Proceeding of the 30th Conference on Decision and Control, Brighton, England, 
December, 1991. 
[9]. R. A. Hogle and P. P. Bonissone, "A Fuzzy Algorithm for Path Selection in Autonomous Vehicle 
Navigation", Proceeding of the 23th Conference on Decision and Control, Las Vegas, NV, December, 
1984. 
[10]. Y. Han, and H. Hahn, "Localization and Classification of Target Surfaces Using Two Pairs of 
Ultrasonic Sensors", Elsevier Science on Robots and Autonomous Systems, vol. 1, pp. 31-41, 2000. 
[11]. D. Silver, D. Morales, I. Rekleitis, B. Lisien, and H. Choset, "Arc Carving: Obtaining Accurate, Low 
Latency Maps from Ultrasonic Range Sensors", IEEE Inter. Conf. on Robotics and Automation, vol. 
2, pp. 1554-1561,2004. 
[12]. A. Ohya, A. Kosaka, A. Kak, "Vision-Based Navigation by a Mobile Robot with Obstacle Avoidance 
Using Single-Camera Vision and Ultrasonic Sensing", IEEE Trans. on Robots and Automation, vol. 
14, no, 6, pp. 969-978, 1998. 
[13]. D. Abdelfatah, A. M. Hafaz, and M. L. Rabeh, "An Algorithm for Vision-Based Navigation of an 
Indoor Mobile Robot", Information and Communication Technologies, April, Damascus, Syria, vol. 
1, pp. 1800-1803, 2006. 
[14]. K. S. Roh, and W. H. Lee, "Obstacle Detection and Self-Localization without Camera Calibration 
using Projective Invariants", Proc. IEEE/RSJ Inter. Conf. on Intelligent Robots and Systems, vol. 2, 
pp. 1030-1035, 1997. 
[15]. 蘇信豪，無人載具避障之導航與控制，台灣大學應用力學研究所碩士班論文，2006。 
[16]. 鍾國亮，影像處理與電腦視覺，東華書局。 
[17]. Pu-Sheng Tsai, Model Modeling and Control for Wheeled Mobile Robots with Nonholonomic 
Constraints, Ph. D. Thesis, National Taiwan University, 2006. 
[18]. R. M. Murray, and S. S. Sastry, "Nonholonomic Motion Planning: Steering Using Sinusoids", IEEE 
Trans. on Automatic Control, vol. 38, no. 5, pp. 700-716, 1993. 
[19]. Fliess, M., Lévine, J., Martin, Ph. and Rouchon, P., 1992, "On Differentially Flat Nonlinear Systems", 
In IFAC Symposium on Nonlinear Control Systems Design, pp. 408-412. 
[20]. J. A. Chacal B., and H. Sira-Ramirez, "On the Sliding Mode Control of wheeled mobile robots", 
Proc. IEEE conf. on Systems, Man, and Cybernetics, pp. 1938-1943, 1994. 
[21]. C. Samson, "Control of Chained System: Application to Path Following and Time-varying 
Point-Stabilization of Mobile Robots", IEEE Trans. on Automatic Control, vol. 40, no.1, pp. 64-77, 
1995. 
64
  
 
 
 
 
 
 
 
第三年計畫成果報告 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
Abstract 
To establish guiding system for blind pedestrians, the proposed system integrates B-spline 
obstacle-free path planning, hierarchical trajectory tracking control, global positioning 
system(GPS), CMOS image sensor and multi-sensors fusion techniques to form a three-year 
project. The first year, the problem of path planning and trajectory tracking control for 
autonomous vehicles or mobile robots moving in the exploration of hazardous or complex areas 
is solved. The works of second year is to implement the trajectory tracking control of B-spline 
curve for wheeled mobile robots based on embedded microcontroller. Fuzzy inference system 
formulates expert knowledge and experience using a set of IF-THEN rules, embedded on the 
microcontroller ATMega162, which provides human-like reasoning and decision-making to 
realize the B-spline trajectory tracking control. On the other hand, the ultrasonic and CMOS 
image sensors are integrated successfully into the wheeled mobile robot to avoid obstacles in real 
time and move to target location. The goals of the third year are the integration previous results to 
implement the guiding mobile robot for blind. The visually impaired people have long been 
facing the dark space. They can’t realize the colorful world with the vision, hence they have to 
rely on the tactile, the smelling and hearing to feel and experience the environment. Lack of the 
video information, the blind may take action according to wrong decision-making and get in 
trouble when facing the challenge of outer circumstances and obstacles. It is very difficult for a 
blind pedestrian to accurately estimate the position and orientation by a walking stick or a guide 
dog. For this purpose, an intelligent wheeled mobile robot with guidance is designed to help blind 
pedestrians to move safely in this project. The blind guiding systems, which integrate CMOS 
image sensor, radio frequency identification system (RFID), voice system, battery charger system 
and crash avoidance techniques, serve those outdoor blind pedestrians among obstacles and other 
hazards. The RFID reader will be installed at the mobile robot. The RFID tags will be fixed at the 
guide tile. Once the mobile robot come near the specified guide tile, the voice system will be 
actuated to information included in guide tile or the braille system of facilities. In addition, the 
CMOS image sensor mounted on the mobile robot to detect the white markings on lead tiles, 
guide the blind to forward or turn around between two standard lines. Finally, the lithium battery 
charger system is designed for the guidance mobile robot, a microcontroller ATting25 is applied 
to supervise the capacity of battery during charging. 
Key word: CMOS Image Sensor, Wheeled Mobile Robot, Embedding microcontroller, Radio Frequency 
Identification Module, Ultrasonic Sensor. 
 
 
 
 
 
 
 
67
大概只有導引與警告兩種，對於盲人的幫忙可謂杯水車薪。更何況在許多人行道上導盲磚
的設置早已變成一排機踏車整齊排列，導盲磚早已破損而不堪使用。視障者最大的困難在
於方向的辨別和資訊的取得，只要給予適當的訊息和定位訓練，視障者通常都能行動自如。
有鑑於此，本計畫的導盲機器人將結合無線射頻技術(RFID)與語音播報系統來取代傳統的
導盲磚設施，提供盲人更豐富的環境資訊或者平面方位，甚至是某個場合的導覽地圖語音。
近年 RFID 技術已有大幅的進步，利用 RFID 的卡片標籤儲存導盲磚所蘊含訊息，並藉由
語音播報系統提供盲人作為方位辨識、公車資訊、建築物名稱或者障礙物警告等。 
無線射頻辨識系統(Radio Frequency Identification system, RFID)[9]是一種非接觸式的識
別技術，它是利用 RF 無線電波辨識目標物上的卡片標籤(Tag)，以便進行身分辨識及擷取
相關資訊的工作。RFID 是第二次世界大戰時(1948 年)，英國人用在機場辨別敵我戰機而研
發出來的。日漸成熟的技術使得應用層面日趨廣泛，並且逐漸改變人類消費方式以及生活
型態。例如台北巿捷運悠遊卡、社區門禁管制系統之感應卡、圖書館藏書標籤、寵物身上
植入的識別晶片等。其中非接觸的使用方式以及成功地解決電源問題都是技術上的一大突
破。此外，這項革命性技術被認為在物流零售業的庫存管理上有重大的突破，在 2004 年全
球零售業龍頭 Wal-Mart 百貨開始要求前 100 大供應商，在出貨產品中導入 RFID 系統，引
爆了物流業的大革命，未來 Wal-Mart 如果全面導入 RFID，預估在整個供應鏈上可以省下
8 億多美元。而正是因為 RFID 能夠創造如此高的成效，許多大廠如 IBM、HP 等都積極投
入 RFID 的研發。基本上，RFID 是由射頻讀卡機(Radio Frequency Reader Unit)、標籤卡片
(Tag)、天線(Antenna)以及伺服端資料庫與應用程式所組成，如圖 1 中所示，並分述如下: 
(1) 天線(Antenna) 
被動式標籤的內建天線用以感應和產生 RF 無線電波，以收發資料。Reader 的天線一般
內含於 Reader 機盒內部，當讀取距離較長時，因所需的 RF 能量更大，故天線會單獨存
在並與 Reader 相連接。 
(2) 標籤卡片(Tag)又稱感應器(Transponder) 
內含微控制晶片(如 Philips 的 I-CODE)及天線(Antenna)，感應器如果透過電池動作，稱
之為主動式(Active)Tag。主動式 Tag 具有較大的記憶體容量以及較遠的讀取距離，但價
格較為昂貴而且每隔 7~10 年需更換電池。感應器如果靠內感電耦動作，則稱之為被動
式(Passive)Tag，被動式 Tag 的記憶體較小，但價格較具競爭力、體積小、壽命長。 
(3) 讀卡機(Transceiver, Reader) 
主要的功能在於接收主機伺服端的命令，對於儲存在感應器的資料以有線(如RS422或
Ethernet)或無線(如Bluetooth)方式傳送回主機，射頻讀卡機內含微控制器 (Controller)及
天線 (Antenna)，如果讀取距離較長，則天線可以單獨存在。其工作原理為讀卡機發射
69
二、導盲機器人系統架構 
導盲機器人整體架構可分為主系統控制單元、影像處理控制單元、電池充電控制單元
三個部份。主系統控制單元是以嵌入式微控制器 ATmega162 為主要核心，分別對超音波感
測器、及無線射頻辨識系統(RFID)進行信號偵測處理，並且藉由同步串列通訊(SPI)控制語
音播報系統。超音波感測器模組是採用由 SRF04 進化改良而來的 SRF05，提供更遠的量測
距離，最大量測距離可達 4m 以上。RFID Reader 模組是由 Parallax 公司所設計。採用
2.45GHz(微波)頻段，工作電壓為直流電壓 5V 伏特。語音播報系統採用是由美國 ISD 公司
所推出的語音晶片 ISD4004，它擁有多次錄音與放音、儲存的語音時間長、不需要額外擴
充記憶體以及週邊電路簡單等優點。此外，主系統控制單元還包括伺服機馬達控制以及文
字型液晶顯示模組等元件。第二部份的影像處理控制單元有 CMOS 影像感測器、繪圖模式
液晶顯示模組、外部擴充記憶體等。採用第二顆嵌入式微控制器 ATmega162 為本單元的控
制核心，CMOS 影像感測器在擷取導盲磚上兩條黑色的標線，經過資料擬合(Data Fitting)
演算法處理完畢後，將黑色標線以及特性參數顯示在繪圖模式液晶顯示器上，並且透過
RS232 將控制命令傳達至主系統控制單元，控制輪型機器人前進、後退、左右轉等相關動
作。電池充電控制單元包含鋰電池本體以及鋰電池充電器，充電器本身是採用 Buck 變換電
路(開關電路)充電原理、Smart Battery 充電概念、鋰電池本身的保護電路及溫度偵測器精簡
電路而成。以 ATtiny25 微控制器作為控制核心，負責提供 PWM 信號作為 Buck 變換電路
的充放電控制，以及監控電池電壓、充電電壓及負載電流。透過 RS232 將電池的狀態傳遞
至主系統單元作顯示。 
 
圖 2 導盲機器人系統配置圖 
71
1、主系統控制單元 
1.1 左右伺服機馬達控制方式 
本系統是使用 Parallax Standard Servo，由 Parallax 公司[10]所設計之伺服機馬達。具有
體積小、重量輕、扭力大等優點，可利用簡易脈波寬度調變(PWM)訊號加以控制，並具有
省電的特性。伺服機馬達乃是採用週期為 20ms 脈波寬度調變的控制信號，脈波寬度如圖 5
所示。 
∆
∆
∆
∆
∆
 
圖 5  PWM 脈波寬度調變控制訊號 
伺服機馬達的接線可參考圖 6 所示。INPUT 腳位接至 ATmega162 微控制器的 PWM 輸
出控制端，利用 ATmega162 內部的 PWM 功能來產生脈波調變訊號，控制旋轉伺服機馬達
前進(順時鐘)旋轉，後退(逆時鐘)旋轉以及停止等動作。 
         
        圖 6 伺服機馬達之接線圖 
本系統所採用的嵌入式微控制器 ATMega162 內部具有兩組 16 位元的計時/計數器
(Timer1、Timer3)，選擇 11.05962MHz 的石英振盪器作為內部的時脈基準。利用 Timer3 可
以產生兩組 PWM 驅動信號，其中 PD4 (OC3A)用來驅動右輪伺服機，而 PB4(OC3B)則驅動
左輪伺服機。至於嵌入式微控制器 ATmega162 乃藉由(ICR3H, ICR3L)暫存器控制 PWM 脈
波信號週期，(OCR3AH, OCR3AL)及(OCR3BH, OCR3BL)暫存器分別控制兩組 PWM 信號的
高態脈波輸出，其計算公式如下[11]: 
(a) PWM 脈波週期 = 1( 3 , 3 ) 2 _
osc
ICR H ICR L Pre scale Nf× × × ×            (1)     
(b) PWM 高態脈波寬度 = 1( 3 , 3 ) 2 _
osc
OCR AH OCR AL Pre scale Nf× × × ×    (2) 
73
的輸入觸發脈波信號(Pin3:Trigger in)以及輸出脈波寬度信號(Pin2:Echo out)，分別接至
ATmega162 微控制器的 Trigger I/O 腳位以及輸入補捉控制接腳(ICP)，如圖 8 超音波感測器
接腳控制線。首先，ATmega162 傳送 10 sµ 的高態脈波信號至超音波模組的觸發脈波輸入
(Trigger in)腳位，其內部會自行產生 8 個 40KHz 的週期信號，並使得輸出脈波寬度信號(Echo 
out)腳位，由低電位轉為高電位。當超音波信號打到物體回彈給感測器模組，將會使得輸出
脈波寬度信號 (Echo out)腳位回復為低電位。此時，我們可以利用輸出脈波寬度來計算超
音波感測器與障礙物體之間的距離。由廠商所提供的規格書所示，超音波感測器與障礙物
體之間的距離(cm)，是回應的高態脈波信號寬度，乘上一個比例因子 1/58 ( )µcm s 。由於
回應的脈波信號之寬度(Reponse Pules width)時間( sµ )約為100 ~ 25s msµ ，由此數據可以得
到量測距離的範圍約為 1.72 cm ~ 431cm。 
 
圖 8 超音波感測器控制時序與接腳訊號圖 
1.3 無線射頻辨識系統(RFID) 
完整的一套 RFID 系統是由讀卡機 (Reader)、電子標籤 (Tag)或稱為應答器
(Transponder)以及電腦應用程式資料庫三個部份所組成。其動作原理為由 Reader
發射一特定射頻訊號，以無線方式接收 Tag 的資料，同時將此射頻訊號作為無線電
波能量驅動電子標籤電路，將內部之 UID 碼或者儲存資料送出。此時 Reader 依序
接收解讀此 UID 碼或資料，送給電腦應用程式資料庫作處理。電子標籤本身不需
使用電池，可以永久工作。本計畫將無線射頻辨識系統應用在導盲機器人上，並且在
導盲磚上裝設電子標籤，使得安裝在導盲機器人下方的讀卡機 (Reader)，經過導盲
磚時可以讀取電子標籤上的 UID 碼，再由微控制器 ATmega162 判讀目前的方位或者地
標，以語音播報告知盲人並且決定輪型機器人下一步的走向。參考圖 9 為本系統所使用
的讀卡機 (Reader)及電子標籤 (Tag)，由 Parallax 公司所出產[10] 
 
              圖 9 讀卡機 (Reader)及電子標籤 (Tag) 
75
影像輸出的品質，並可任意擷取影像視窗的大小。此外，CMUcam3 模組的 I/O 埠，支援
伺服機馬達(Servo)的驅動控制，以方便使用者進行追蹤控制等應用。而通信介面是採用
Serial Port 輸出，以固定 115200 鮑率(Baud)規格傳送，體積小，功率低，最適合在小型機
器人上作為影像視覺之用。最大影像解析度是 352×288 像素及三種影像輸出格式 RGB、
CrYCb、HSV 供使用者選擇。本系統的影像解析度採用 128×64 像素，影像輸出格式為 RGB。
此外，該模組工作的直流電壓(DC)範圍非常廣泛，從 9~12 VDC 都可接受。 
 
圖 12  CMUcam3 影像感測器實體元件圖 
圖 13 乃針對影像輸出為 128×64 的圖片，CMUcam3 所送出來的封包格式。起始碼為
01H，之後出現的兩個位元組，代表這張影像圖片的 x 軸像素與 y 軸像素的大小。之後會出
現 y 個 02H 作為起始碼的 R、G、B 影像資料，共計有 128 個 RGB 的位元組，而 R、G、
B 有三個位元組，所以 02H 起始碼之後，會出現 128×3 個位元組，共計有 384 個位元組。
上述 384+1 個位元組將會重覆出現 64 次，就是 385 個位元組×64，共計有 24,640 個位元
組。而最後出現 03H，則為結束碼。若加上全部的起始碼及結束碼，完整的封包資料共計
有 1 + 2 + 64× (1 + ( 128×3 ))+1 =24,664 個位元組。 
 
圖 13  CMOS 影像輸出規格 
 其次，CMUcam3 提供了 47 組指令集，透過指令可調整 CMUcam3 組態，如 I/O 控制、
77
為了讓這一條直線僅量地逼近上述 N 個資料點，我們採用卡方的評價函數(Chi-square Cost 
Function)作為量測訊息，卡方的評價函數可以寫成 
2
2
1
( , )
N
i i
i i
y c mx
m cχ
σ
=
 − −
=  
 
∑                        (4) 
我們希望求得一組 ( , )m c 使得卡方的評價函數愈小愈好，為了求得(4)式卡方評價函數的極
小值，我們將(4)式分別對 ,  m c  兩變數進行偏微，並將其結果令為零，再來解聯立方程式
求得 ( , )m c 。偏微後的結果如下所示， 
 
2
2
1
( , )0 2
N
i i
i i
y c mxm c
c
χ
σ
=
− −∂
= = −
∂ ∑
                   (5) 
2
2
1
( )( , )0 2
N
i i i
i i
x y c mxm c
m
χ
σ
=
− −∂
= = −
∂ ∑
                 (6) 
為了讓(5)與(6)式看起來更為簡潔清楚，我們定義了以下的表示式 
2
2 2 2 2 2
1 1 1 1 1
1
                                   
N N N N N
i i i i i
x y xx xy
i i i i ii i i i i
x y x x yS S S S S
σ σ σ σ σ
= = = = =
≅ ≅ ≅ ≅ ≅∑ ∑ ∑ ∑ ∑ (7)           
有了上述的表示式(7)後，(5)與(6)式可以重新改寫為 
x y
x xx xy
cS mS S
cS mS S
+ =
 + =
                            (8) 
解(8)聯立方程式，可以獲得以下之結果 
,      
xx y x xy xy x yS S S S SS S S
c m
− −
= =
∆ ∆
                 (9) 
其中 2( )xx xSS S∆ = − ，m 為直線方程式的斜率，c 為直線方程式的截距。 
2.5  CMOS 影像尋線策略 
(a) 將灰階處理與二值化後 128×64 像素的影像圖片，分成左(1)、右(2)兩個 64×64 像
素的區間，如圖 14 所示。 
(b) 取得左(1)、右(2)兩個平面區間的座標點位置 ( , )i ix y 及座標點個數 c1 及 c2。 
(c) 進行資料擬合演算法，取得左(1) 、右(2)兩個平面區間之左斜率 m1 及右斜率 m2。
此左斜率 m1 及右斜率 m2 兩資訊可作為輪型機器人直行比對之依據。 
(d) 經過資料比對後，取得正確的前進方向及旋轉角度θ 。(紅色箭頭為原進行方向、
藍色箭頭虛線為修正的進行方向) 
(e) 左斜率 m1 與直行資料進行比對，會得到一個α 角度，此角度也就是機輪型機器人
所應修正的角度θ 。( mθ 為機器人在標線正中間直行時，標線斜率所換算出來的角
度， nθ 為左斜率 m1 所換算之角度， m nθ θ θ= − )。 
 狀況一 : 輪型機械人在標線正中間直行  
 由 COMS 影像感測器擷取出來的影像圖片如圖 15 所示，輪型機器人位於軌道的正中
間前進。左(1)、右(2)兩區塊所搜尋到的座標點個數 1 2 0c c= > ，左(1)、右(2)兩區塊的像素
點座標透過資料擬合演算法可以得到左斜率 1 0m > 、右斜率 2 0m < ，且 1 2m m≅ 。透過資
料比對的結果，輪型機器人行進的方向為 1 0= = oθ θ 。 
79
 2 17 −圖 狀況四的影像圖片
1 2
1 2
1 2
1 2
* >0,  >0
* < 
* >0, < 0
* 
c c
c c
m m
m m<
斜率 斜率
18
 
 狀況五 : 輪型機械人稍微偏向左 
 圖 19 CMOS 影像感測器所擷取到的影像圖片為輪型機器人稍微偏向左邊的狀況，拍攝
的影像涵蓋左邊的軌道標線以及一小部份右邊的軌道標線。左(1)以及右(2)區間的座標點個
數分別為 1 0c > 及 2 0c > ，且 1 2c c> 。左(1)以及右(2)區間的標線斜率分別為到 1 0m > 及 2 0m <
而且 1 2m m> 。經過資料比對後，輪型機器人取得正確的行進角度 5= oRθ θ 。 
 2 18 −圖 狀況五的影像圖片
1 2
1 2
1 2
1 2
* >0,  >0
* > 
* >0, < 0
* >
c c
c c
m m
m m
斜率 斜率
19
 
 狀況六 : 輪型機械人極多偏右  
最後，我們討論兩種特殊狀況，輪型機器人極端向右偏轉與極端向左偏轉。參考圖 20，
機器人向右偏轉的角度過大，CMOS 影像感測器的鏡頭涵蓋到右邊軌道標線的範圍過長，
延伸至左(1)的區塊當中。此時，左(1)及右(2)區間都存在有座標點個數，其中 1 0c > 及 2 0c > ，
且 1 2c c< 。至於左(1)及右(2)兩個區間所出現的標記斜率可被計算求得 1 0<m 及 2 0<m 。經過
資料比對後，輪型機器人取得正確的行進角度為 6= oLθ θ 。 
 2 19 −圖 狀況六的影像圖片
1 2
1 2
1 2
1 2
* >0,  >0
* < 
* <0, < 0
* 
c c
c c
m m
m m≅
斜率 斜率
20
 
 狀況七 : 輪型機械人極多偏左  
狀況七是輪型機器人向左偏轉的角度過大，導致 CMOS 影像感測器的鏡頭涵蓋左邊軌道標
線的範圍過長，延伸至右(2)的區塊當中，參考圖 21 中所示。此時，左(1)及右(2)區間都存
在有座標點個數，其中 1 0c > 及 2 0c > ，且 1 2c c> 。至於左(1)及右(2)兩個區間所出現的標記
斜率可被計算 1 0>m 及 2 0>m 。經過比對後，輪型機器人取得正確的行進角度為 7= oRθ θ 。 
 2 20 −圖 狀況七的影像圖片
1 2
1 2
1 2
1 2
* >0,  >0
* > 
* >0, >0
* 
c c
c c
m m
m m≅
斜率 斜率
1  
81
 ATtiny25 電池充電器的控制核心利用 9600bps、8 data bits、No Parity、1 stop bit 的通訊
協定，將電池的特性參數及狀態，隨時傳遞給主系統微控制器 ATmega162。電池狀態的傳
遞資料總數是 24 bytes，我們自定了完整的資料格式，在每一筆資料，加上固定的表頭與結
尾，以便於主系統微控制器辨別，表頭與結尾的格式如表 2 所示。 
                        表 2 電池狀態資料傳遞格式說明 
數據名稱 數據型態 數值 個數 說明 
HEAD nsunsigned char  0x5B 1 標頭 
Message status unsigned char  16 電池狀態資訊 
VBAT，M_BAT，IBAT unsigned char  6 參數資訊 
END unsigned char 0x0A,0x0D 2 結尾 
3.1  Buck 變換開關電路原理 
其次，我們討論 Buck 變換開關電路的工作原理。Buck 變換開關電路包括一個 NPN 
電晶體驅動一個 P 通道的 MOSFET 開關、電感器、二極體和電容器所構成。外加一個額
外二極體，用來防止在斷電時，電池向微處理器供電。當開關接通時(P 通道MOSFET)，電
流流動的方式如圖23(A)所示，電容器通過電感器被充電(電感器也吸收了能量)。當開關打
開時，如圖23(B)所示，電感器試圖保持電流，從而導致電流流過二極體、電感器和電容器，
形成一個迴路。Buck 變換開關切換一次形成一個工作週期，如果減少工作週期比，使得開
通時間減少，斷開時間增加，則輸出電壓也隨之下降。反之，增加工作週期比，輸出電壓
將隨之增加。至於 P 通道 MOSFET 的開關，則是由微控制器 ATtiny25 所送出來的 
PWM 信號加以控制。 
  
                      圖 23 Buck 變換開關電路及開關原理 
3.2  ADC 電池充電器量測電路 
參考圖 22 所示，單體電池電壓為V1，電池電壓為V2以及充電電壓為V3，可直接從電
池正極測得。利用 ATtiny 內部 10 位元 ADC 測量的充電電壓，若高於基準電壓(Vcc)時，
需要增加兩個電阻，將其分壓到 0 ~ Vcc 的範圍。至於充電電流則是將充電電壓 V3 減掉
電池電壓 V2 之後除以一個極小的精密電阻(Rsense)而得到。換言之，圖22 的 ATtiny25 微
控制器除了產生 PWM 脈波寬度調變訊號之外，也負責三組 ADC 的轉換。其中ADC3是
擷取 R1 和 R2 對充電電壓 V3 進行分壓的類比電壓值，也稱為 C_BAT。ADC2 是擷取 R3 
和 R4 對電池電壓 V2 進行分壓的類比電壓值，也稱為 V_BAT。ADC1 乃直接擷取單体電
池電壓 V1 值，亦稱之為 Cell_BAT。由於單体電池電壓 V1 值小於系統的基準電壓，故不
83
三、實驗結果與討論 
1、 超音波感測器實驗結果 
將超音波感測器實際接至以 ATmega162 微控制器為核心的輪型機器人上，並且
在輪型機器人的前方放置障礙物體，如圖24 所示為超音波感測器之實際測試圖。首先，
ATmega162 微控制器輸出一個觸發信號，脈波寬度為10 sµ 的高態脈波至超音波感測器模
組，並使超音波感測器輸出一個高態脈波信號，利用微控制器ATmega162 加以接收，
並且嘗試計算這個高態脈波信號的寬度，經過一個倍率的轉換，即可獲得超音波感測器與
障礙物體之間的實際距離。測試數據如表 3 中所示，由實際測試結果可以發現，最大誤差
小於等於 3%。 
 
      圖 24 超音波感測器之測試實體圖 
 
表 3 超音波感測器之測試數據表 
實際距離 
(cm) 
量測距離 
(cm) 
計數量 
(HEX) 
誤差 
(%) 
實際距離 
(cm) 
量測距離 
(cm) 
計數量 
(HEX) 
誤差 
(%) 
 9 9.2 93 2.2 20 20.4 146 2.0 
10 10.3 A5 3.0 21 21.5 152 2.4 
11 11.3 B5 2.7 22 22.4 166 1.8 
12 12.3 C5 2.5 23 23.4 176 1.7 
13 12.7 CB 2.3 24 23.3 185 1.3 
14 13.7 DB 2.1 25 24.9 18D 0.4 
15 15.3 F5 2.0 26 26.4 1A6 1.5 
16 16.4 106 2.5 27 27.5 1B8 1.9 
17 17.5 118 2.9 28 28.4 1C6 1.4 
18 18.5 128 2.8 29 29.3 1D5 1.0 
19 19.5 138 2.6 30 30.5 1E8 1.7 
 
85
  
圖  26 RFID系統接收實體電路測試圖  
4、 鋰電池充電器功能測試 
在 ATtiny25 鋰充電器電路中，我們利用微控制器內的 PWM 脈波寬度調變控制 
MOSFET 開関及 Buck 變換開關電路進行充放電，並利用 10 bits A/D 轉換器，監控電池
電壓、充電電壓及電流值。在本系統規格中，我們先訂定輸入電源電壓值最大值為 9 伏特，
充電電流值最大值為 1 安培，電池的最大充電電壓為8.4 伏特( 4.2伏特x 2 )，而截止電壓
為 6 伏特。電池串聯方式為 1S2P 連接，如圖27所示。 
 
圖 27 電池充電器之實際電路圖 
在程式中，提供八種電池的狀態訊息，分別陳述如下: 
Message[8][17] = { 
 " 0Bat_notging  ", // 電池電壓值，在正常狀態。 
 " 1Battery Low     ", // 電池電壓值小於 6 伏特電壓值。 
" 2Chargering...     ", // 電池充電中。 
 " 3Full charger      ", // 電池電壓值等於 8.4V 伏特電壓值。 
 " 4Battery ERROR   ", // 無電池電壓狀態訊息，電池電壓值等於 0V 電壓值。 
 " 5Discharger       ", // 電池電壓值小於 8.4V 伏特電壓值，無充電狀態訊息。 
 " 6Power off        ", // 電池電壓值小於 6 伏特電壓值，請開機或立即充電。 
 " 7Cell_ERROR     "}; // 電池無電壓狀態等於 0V 伏特電壓值。 
87
充電功能測試: 
參考圖 29 之充電測試方塊圖，直流電源輸入電壓為 DC 9V，此時電池電壓為 7.63V，
經 ATtiny25 判斷，以 200mA 電流進行充電，參考 28 程式流程圖中電池電壓與充電電流之
關係。電池容量為 1000mAH(1C)，若以 C/2(500mA)電流進行充電，需經 2 小時，才可充飽
1000mAH 的電池。一旦電池充滿電時，液晶顯示模組會顯示 Full Charger 的電池狀態資訊，
如圖 29 (A) 與 (B) 分別為實際測試圖與充飽電後液晶顯示畫面。 
 
圖 29(A) 實際充電測試圖           圖 29(B) Full Charger 的電池狀態資訊 
 ATtiny 微控制器傳遞電池充電器的狀態資訊，資料串第一個識別碼一定是 Head 碼 
0x5B，若發現資料不符合，程式必須要停止或不予處理，以防止不可預期的錯誤發生。 
傳遞的資料內容：  
 程式送出： 0x5B 0x32 0x43 0x68 0x61 0x72 0x67 0x65 0x72 0x69 0x6E 
              0x67 0x2E 0x2E 0x2E 0x20 0x20 0x5D  
              0x49 0x35 0x30 0x30 0x4D 0x41 0x20 0x20  
              0x07 0x37 0x03 0x10 0x04 0x95 0x0A 0x0D 
 傳遞的資料分析： 
(a)、標頭資訊：0x5B，為 1 bytes。 
(b)、電池操作模式： 0x32 0x43 0x68 0x61 0x72 0x67 0x65 0x72 0x69 0x6E 
                   0x67 0x2E 0x2E 0x2E 0x20 0x20 0x5D 
ASCII 內容是 :  2Chargering...  ，其中 0x5D 為電池狀態結束碼，共計為 17 bytes。 
(c)、充電電流資訊： 0x49 0x32 0x30 0x30 0x4D 0x41 0x20 0x20 
ASCII 內容是 :  I200MA , 為 200mA 進行充電, 為 8 bytes。 
(d)、電池狀態資訊： 0x07 0x63 0x03 0x30 0x04 0x95    
ASCII 內容是 :  VBAT= 7.63V，Cell_BAT = 3.30V，I_BAT = 495 mA 安培，共計 6 
89
5、  CMOS 影像感測器驗證測試 
影像緩衝區的大小共計 32K+32K bytes，分別存放影像的原始資料 24,664 bytes，灰階
資料 7,936 bytes，二值化資料 1,024 bytes 以及壓縮量化後的資料。圖 32 乃利用 ATmega162
微控制器內的兩組 UART，透過 RS232 準位轉換晶片，分別接至 PC 及 CMUcam3 影像感
測器模組之示意圖。由 ATmega162 微控制器作為接收發送的介面，進行 CMUcam3 指令的
驗證與測試。 
 
圖 32  CMOS 影像感測器驗證接線圖 
本實驗的目的在於驗證影像前置處理以及平面座標轉換後的結果，透過 128 64×  繪圖
模式液晶顯示器，將處理完畢後的影像顯示在螢幕的畫面上。由 CMOS 影像感測器擷取一
張具有兩條標線的影像圖片，其大小為128 64× 像素，如圖 33(A)所示。經過灰階處理後，
將 RGB 彩色圖片轉換成 0~255 的灰階圖片，如圖 33(B)所示。再透過二值化的處理，將 0~255
的灰階圖片轉換成只有 0 和 1 的黑白圖片，如圖 33(C)所示。由於濾波前的二值化影像有許
多雜訊影響兩條標線位置的判斷，經過二值化濾波(調整 threshold)後可以去除大部分的雜
訊，濾波後的結果如圖 33(D)所示。當然，經過濾波後的影像與原本的影像會產生差異，部
分影像會產生失真，變形等。由顯示結果可以觀察該影像的失真程度與原來影像相比差異
不大，在可以接受的範圍內不影響導盲磚上標線的判斷。 
 
 
 
 
 
 
 
 
 
圖 33 影像處理之二值化濾波之結果 
91
6、 輪型機械人直行及停止 
將輪型機械人設定於標線中央，如下圖 36(A)所示。同時將 RFID 的電子標籤(Tag)置於
標線中央，如圖 36(B)所示。CMOS 影像感測器擷取的影像圖片，經過本文所提出來的影像
處理演算法將整張影片分割成左右兩張 8 × 8 的平面座標。取得左邊平面標線座標為
(1,5)(2,6)(3,7)(4,8)，座標點個數 1 4=c 。再經過資料擬合演算法，取得左斜率 1 1=m 及
1 45=
oθ 。同理取得右邊平面標線座標為(5,8)(6,7)(7,6)(8,5)，座標點數目 2 4=c ，右斜率
2 1= −m 及 2 45= − oθ ，我們由左區斜率 1 1=m 及 1 45= oθ ( 1nθ θ= )，可以計算得到前進修正的
角度為 0om nθ θ θ= − = ，請參考表 1 可以得知輪型機械人乃直線前進。電子標籤被放置於
標線的中央，由裝置於輪型機械人的下方 RFID Reader 讀取到 Tag 的資訊時，輪型機械人
會立即停止前進及起動語音播報。 
 
圖 36 輪型機器人位於標線中央 
7、 輪型機械人偏左  
將輪型機械人設定於標線偏左位置，如下圖 37(A)。圖 37(B)為修正角度後繼續前進的
圖片。由於輪型機器人整個偏向於左方，故 CMOS 感測器的鏡頭只能照到左邊的軌道標線，
無法照到右邊的標線。經過影像前置處理及二值化平面座標轉換後，左(1)、右(2)兩區塊所
搜 尋 到 的 座 標 點 個 數 分 別 為 1 7 0= >c 、 2 0=c 。 取 得 左 邊 平 面 標 線 座 標 為
(1,4)(2,5)(3,5)(4,6)(5,6)(5,7)(6,7)，透過資料擬合演算法將像素點座標對直線作擬合，可以得
知右邊平面因無座標點，故斜率不存在。左邊平面標線的斜率為 1 0.5882=m 及
1 30.4655
o
nθ θ= = ，經過資料比對後，得知 45 30 15o o om nθ θ θ= − = − = ，輪型機器人取得
修正行進方向 3 15= =o oRθ θ 。 
圖 37:偏左及直行 
93
人右轉，然後進行右轉動作，完畢後再繼續前進。萬一無法偵測到 RFID 電子標籤的任何
訊息，輪型機器人將停止前進。 
 
 
圖 39 導盲機器人左轉彎 
 
圖 40 導盲機器人右轉彎 
95
理器 ARM 做為主系統的控制器，或者是利用 CMOS 影像感測器上的嵌入式微處理器 ARM 
7，先將擷取的影像經過演算法處理後，再將有用的資訊回傳至 ATmega162 微控制器，可
減少微控制器的繁重計算負荷。 
(6)  在本文的設計中，當輪型機器人行駛在具有標線的導盲磚上時，若沒有電子標籤的指
引，或者是電子標籤過少時，在行駛的過程中將缺少相關資訊指引。我們可以將全球衛星
定位系統(GPS)移植置入本系統中，以取得更多的相關資訊。例如將輪型機器人目前座標及
前進方位進一步運用 GPRS 回傳至遠端系統，將導盲機器人行進軌跡儲存至遠端電腦成為
未來的研究方向。 
(7) 在未來的研究中，我們希望將導盲機器人整合在導盲的白手杖中，並且提昇 CMOS 影
像感測器的性能，結合無線網路與全球衛星定位系統(GPS)，精確回報視障者目前所在位置
及座標，將盲人的行進軌跡回傳至遠端的主控電腦。此外，透過語音播報提供視障者更多
實際的需求及行進的資訊。 
參考文獻 
[1]. 臺灣導盲犬協會  網址 : http://www.guidedog.org.tw 
[2]. S. P. Levine, et al., "The NavChair Assistive Wheelchair Navigation System", IEEE Trans. Neural 
Systems and Rehabilitation, vol. 7, pp. 443-451, Dec. 1999. 
[3]. S. Shoval, J. Borenstein and Y. Koren, "The NavBelt-A Computerized Travel Aid for the Blind 
Based on Mobile Robotics Technology", IEEE Trans. Biomedical Engineering, vol. 45, pp. 
1376-1386, Nov. 1998. 
[4]. I. Ulrich and J. Borenstein, "The GuideCane - Applying Mobile Robot Technologies to Assist the 
Visually Impaired", IEEE Trans. Systems, Man and Cybernetics, vol. 31, pp. 131-136, Mar. 2001 
[5]. Shang-Shian Chen, "Development of a Satellite-Based Guiding System for the Blind", Master Thesis, 
National Taiwan University, Electrical Engineering, 1999. 
[6]. Yen-Ting Lin, "The Development of an Electronic Travel Aid which Integrates Auditory Images and 
an Ultrasonic Sensor for the Blind", National Central University, Computer Science and Information 
Engineering, 2006. 
[7]. http://www2.tku.edu.tw/~ac/951news/951002.htm 
[8]. Chien-Hsiung Tai, "A Study on Guide Brick Recognition Using Vision-Based Techniques", National 
Chiao Tung University, Electrical and Control Engineering, 1998. 
[9]. RFID 產業資料庫, http://www.u-rfid.com.tw 
[10]. Parallax 公司  網址: http://www.parallax.com 
[11]. ATMEL 微控制器  網址:http://www.atmel.com/dyn/resouses/prod_doc/doc2536.pdf 
[12]. WheelWatcher WW-02 Product Manual  網址:http://www.nubotics.com 
[13]. Devantech 公司模組  網址:http://www.playrobot.com/Specific/sirf05.htm 
[14]. ISD4004 語音晶片  網址:http://www.nuvoton.com/hq/ISD4004.pdf 
[15]. Acroname CMOS 模組  網址:http://www.cmucam.org, http://www.cs.cmu.edu/~cmucam 
[16]. David Eberly, Least Squares Fitting of Data, Geometric Tools, LLC,  網址,http : // www. 
geometrictools. com /Documentation/LeastSquaresFitting.pdf. 
[17]. Coope, I.D., Circle fitting by linear and nonlinear least squares, Journal of Optimization Theory and 
Applications Volume 76, Issue 2, New York: Plenum Press, February 1993 
[18]. Duda, R.O., and Hart, P.E., Pattern Classification and Scere Analysis, John Wiely & Sons, New  
York, 1973 
[19]. Smart Battery System  網址,http://www.j-tek.com.tw/doc/JT2002.pdf. 
[20]. ATMEL 微控制器  網址:http://www.atmel.com/dyn/resouses/prod_doc/doc2585.pdf 
97
  
第二年計畫 
以嵌入式微控制器 
實現輪型機器人軌跡追蹤與
閃避障礙物 
 
能，量測效果佳，具可行性，
用來偵測大型障礙物。 
(7) CMOS 影像感測器 採用 CMUcam2+的感測模組，
透過影像處理演算法來偵測小
型障礙物。 
(8) 光學編碼器(Encoder) 採用Parallax公司所出品的光
學編碼器，每轉一周送出 32
脈波，用來計算輪型機器人的
座標位置。 
(9) 以模糊推論實現輪型機器人  
    軌跡追蹤之控制 
提供實驗影片，下載網站 
http://ee.cust.edu.tw/tps 
/98 國科會期中報告實驗影片 
投稿論文: [25] 
(10)結合超音波與 CMOS 影像感   
   測器在輪型機器人避障之研究 
提供實驗影片，下載網站 
http://ee.cust.edu.tw/tps 
/98 國科會期中報告實驗影片 
投稿論文: [26] 
 
 
 
 
 
 
 
 
 
第三年計畫 
智慧型導盲機器人的設計 
(11)語音播報系統 利用 ISD4004-12MP 完成語音
播報系統與功能測試 
(12)無線射頻辨識系統(RFID) 完成 RFID 卡片標籤 UID 碼的
讀取與識別 
(13)GPS AC12 虛擬距離單機定位 後處理方式完成虛擬距離單機
定位解算，動態與靜態實驗 
，與向量式地圖整合成功 
投稿論文:[27] 
(14)CMOS 影像感測器與尋線策略 利用CMOS影像感測器針對導
盲磚上左右兩條標線進行偵
測，目的在使導盲機器人保持
在兩條標線內前進。 
(15)鋰電池充電器之設計 利用 ATtiny25 微控制器內的 
PWM 脈波寬度調變 Buck 變
換開關電路進行充放電，並利
用 10 bits A/D 轉換器，監控電
池電壓、充電電壓及電流值。 
(16)第一代無動力導盲機器人設計 
 
提供實驗影片，下載網站 
http://ee.cust.edu.tw/tps 
/98 國科會期中報告實驗影片 
(17)第二代具動力智慧型導盲機器
人設計 
提供實驗影片，下載網站 
http://ee.cust.edu.tw/tps 
/99 國科會成果報告實驗影片 
 
 
 
 
 
 
 
 
 
 
99
97 年度專題研究計畫研究成果彙整表 
計畫主持人：蔡樸生 計畫編號：97-2221-E-157-004-MY3 
計畫名稱：以嵌入式系統實現輪型機械人之軌跡追蹤控制以及盲人導引之應用 
量化 
成果項目 實際已達成
數（被接受
或已發表）
預期總達成
數(含實際已
達成數) 
本計畫實
際貢獻百
分比 
單位 
備 註 （ 質 化 說
明：如數個計畫
共同成果、成果
列 為 該 期 刊 之
封 面 故 事 ...
等） 
期刊論文 5 7 100%  
研究報告/技術報告 3 3 100%  
研討會論文 4 6 100% 
篇 
 
論文著作 
專書 0 0 100%   
申請中件數 0 0 100%  專利 已獲得件數 0 0 100% 件  
件數 0 0 100% 件  
技術移轉 
權利金 0 0 100% 千元  
碩士生 3 3 100%  
博士生 0 0 100%  
博士後研究員 0 0 100%  
國內 
參與計畫人力 
（本國籍） 
專任助理 0 0 100% 
人次 
 
期刊論文 0 0 100%  
研究報告/技術報告 0 0 100%  
研討會論文 0 0 100% 
篇 
 
論文著作 
專書 0 0 100% 章/本  
申請中件數 0 0 100%  專利 已獲得件數 0 0 100% 件  
件數 0 0 100% 件  
技術移轉 
權利金 0 0 100% 千元  
碩士生 0 0 100%  
博士生 0 0 100%  
博士後研究員 0 0 100%  
國外 
參與計畫人力 
（外國籍） 
專任助理 0 0 100% 
人次 
 
國科會補助專題研究計畫成果報告自評表 
請就研究內容與原計畫相符程度、達成預期目標情況、研究成果之學術或應用價
值（簡要敘述成果所代表之意義、價值、影響或進一步發展之可能性）、是否適
合在學術期刊發表或申請專利、主要發現或其他有關價值等，作一綜合評估。
1. 請就研究內容與原計畫相符程度、達成預期目標情況作一綜合評估 
■達成目標 
□未達成目標（請說明，以 100 字為限） 
□實驗失敗 
□因故實驗中斷 
□其他原因 
說明： 
2. 研究成果在學術期刊發表或申請專利等情形： 
論文：■已發表 □未發表之文稿 □撰寫中 □無 
專利：□已獲得 □申請中 ■無 
技轉：□已技轉 □洽談中 ■無 
其他：（以 100 字為限） 
準備以「結合語音播報與 RFID 在導盲機器人之應用」為題申請新型專利,目前正和專利事
務所洽談中. 
3. 請依學術成就、技術創新、社會影響等方面，評估研究成果之學術或應用價
值（簡要敘述成果所代表之意義、價值、影響或進一步發展之可能性）（以
500 字為限） 
本計畫整合日趨成熟的無線射頻辨識系統(RFID)與語音播報系統來讀取公共場所中導盲
磚或盲人點字內所蘊涵的訊息，配合 CMOS 影像感測器偵測導盲磚上左右兩條標線，以實
現導盲機器人的設計為目標。視障朋友們長期處於黑暗的世界中，無法以視覺來體認這五
彩繽紛的世界，必須依靠聽覺、觸覺、嗅覺等來感受他所生存的空間。缺乏影像的資訊，
使他面臨外在環境以及障礙空間的挑戰，其危險性比一般正常人高出數百倍。尤其在戶外
活動時祇能藉耳朵與柺杖來探索週遭的環境，再憑模糊的印象來推測所在的位置。為了讓
盲人安心地踏出每一個腳步，本文的構想是在導盲磚的背面貼上無線射頻辨識系統(RFID)
的電子標籤(Tag)，並且將 RFID 讀卡機、超音波感測器以及語音晶片結合在一台輪型機器
人上，前端並以一根柺杖作聯結。一旦盲人接近導盲磚，RFID 將讀取 Tag 上的訊息透過
語音播報系統以聲音告知視障者行走的方向與周遭環境之訊息。此外，架設在輪型機器人
上的 CMOS 影像感測器用來偵測導盲磚上的黑色標線，導引盲人在兩條標線之間前進或左
右轉。最後，我們在輪型機器人上加裝鋰電池充電控制單元，透過一顆 ATtiny25 微控制
器對電池本體進行充、放電控制及目前電池容量的監控。本系統的開發將提供視障朋友環
境資訊的取得，道路指引功能以及附近的交通資訊，透過豐富的空間環境訊息，使得盲人
具有走出戶外的信心與勇氣。近年來，在許多公益團体大力奔走與倡導下，弱勢團体逐漸
受到社會較多的關懷。但國內對殘障者(包括智障、視障、殘障)之需求研究相當匱乏，雖
然許多人想幫助這群「折翼的天使」，卻無從得之正確的方法，以至於殘障朋友們無法得
