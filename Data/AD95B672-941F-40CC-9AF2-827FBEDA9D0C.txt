壹、摘要 
    本實驗以上年度研究結果為基礎，進行 PC-based 整合性光普量測系統之開發研究；其主要之
成果為：1.開發以 LabVIEW 虛擬儀控程式為基礎的模組化控制軟體，可依使用者不同需求更換模
組，整合性及方便性大為提高；2.開發嵌入式之微型化光譜儀控制器，藉以縮小體積、降低成本，
控制介面替換為一般電腦皆有的 RS-232 介面，更提高了系統的可攜性。本光譜量測系統功能性
強、價格平易、且又可整合測量、分析不同功能於一台個人電腦之內；並於軟體設計中引入「虛
擬儀控」概念，以 LabVIEW 作為軟體平台，並將程式進行模組化設計，再藉由適當的傳輸介面
（RS-232），將光譜量測系統操控功能整合在同一台個人電腦上。設計後的軟體程式讓使用者可
以搭配其所需之硬體（如：PMT、H10、TRIAX 系列單光儀、ARC 公司生產的 SpectraPro-300i），
達到客制化(customized)設計之效果。   
      本計劃之執行，除其既有商機之外，也促進了計畫主持人／共同主持人、兼任研究助理
（學生）及合作廠商研發人員間的緊密互動和技術互惠，也同步提升了產學研發能量。除了可培
育研發人才之外，並可發開企業研發能力、貢獻醫療應用，也可為台灣競爭力注入新血。 
 
 
 
 
 
 
 
 
 
 
 
關鍵詞：LabVIEW 虛擬儀控、微型化嵌入式系統、PC-based、整合性光譜量測系統 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
  3
本配備，配合 LabVIEW 語言來發展虛擬儀表。本系統之
完成，可提供不同之量測精密度需求。而開放式的設計環
境可依使用者的測量需求及模式進行調整；其操控系統可
以隨著電腦硬體與作業系統的升級而升級。對於植基於個
人電腦所完成的光譜量測系統在降低成本及創造人性化
的需求上，有相當重要的意義存在。 
可利用之產業及可開
發之產品： 
產業：臨床光電、基礎醫學研究、半導體、化學等。
產品：可將硬體與軟體分區，商業價值與營運模式可
配合現行經費管理制度來調整。此產品可在國內自行研
發，無須擔憂或受限於國外產品的控制，進而促進國內可
觀的商機。 
推廣及運用的價值：如
增加產值、增加附加價
值或營利、增加投資/
設 廠 、 增 加 就 業 人
數………等。 
此部份建議由此計劃配合廠商_昇航科技股份有限公司來
回覆，較為合適。 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
  5
等功能，整合在同一台電腦上。本系統可開拓出精密且低成本的光譜儀功能，使之結合
高可攜式性與實用性特點，並適用於臨床量測之需求的光譜量測系統。 
 
4. 研究方法 
本系統除了延續上年度研究之方法外，也改善了自製控制器部分；微型化嵌入式光譜
控制器，除了降低成本之外，也增加了儀器的可攜性。為展現整合性與模組化功能，在硬
體上我們整合了較低階(Jobin Yvon, H10)與較高階(ARC, SpectraPro-300i)的兩種單光儀、可
低電壓驅動的 PMT hiusing (PMT 仍採用 Hamamatsu 公司生產的 R928)，以及取代 DAQ 功
能的嵌入式微型控制器—單晶片微處理機(ATmega8535);軟體部分我們依舊是在 LabVIEW
圖形化程式語言環境下進行開發。為更完整展現模組化功能，我們亦設計了 Jobin Yvon 公
司生產 TRIAX 190 系列單光儀的操作模組；軟體中只要替換掉相關模組，即可整合該單光
儀與 H 10，提供使用者更的多方便性。 
LabVIEW 具有相當優秀的程式開發、人機介面、節省開發時間等優點，這是本光譜
系統採用 LabVIEW 來發展儀控軟體主因。本系統另依優勢為採用微型嵌入式系統來取代
DAQ 卡。由於嵌入式系統所使用的單晶片微處理機和用來傳輸的 RS232 都是電腦儀器上
廣泛使用的工具其成本可以大幅降低許多。為使硬體開發順利，控制器使用單晶片微處理
機 (8-bit AVR Microcontroller with 8K bytes In-System Programmable Flash ， 型 號
ATmega8535)，將 PC 下達的指令解碼後，再用以控制步進馬達。此外，PMT 量測資料回
傳程序也相同。雖然單晶片微處理機透過 RS-232 與電腦溝通速度比 DAQ 卡為慢，但改良
過後的 ATmega8535 在速度上已經提升許多，已可以滿足光譜量測上速度的需求。除此之
外我們也進行了控制器與馬達趨動的開關電路、光譜資料傳輸以及 PMT 轉換電路、放大
電路和 PMT Detector 輸入電壓控制部份。 
單晶片微處理機又稱為系統晶片，主要的概念是將電路縮小化模組化使其所有功能結
合在一個晶片當中使其變成一多功能的晶片。整體來看單晶片微處理機分為 2 個部份，軟
體方面是控制微電腦驅動的程式其程式語言為 C 語言；硬體部分可分為五大部分：輸入單
元、記憶單元、運算單元、控制單元、輸出單元，其運算單元和控制單元又合稱為中央處
理單元，所謂的 CPU。 
 
5. 結果與討論 
5.1 PC-based 光譜儀系統架構 
光譜儀硬體配件包括下列 
1.6V 和 12V 變壓器電源插頭 
2.自製光譜儀控制板(光譜儀步進控制裝置) 
3.激發光(Excitation)分光裝置 
4.放射光(Emission)量測裝置 
5.光電倍增管 
6.接線(RS232 轉 USB 接線 1 條、RS232 轉 PS2 接線 1 條、15pin 光電倍增管 
      接線 1 條、BNC 接線 1 條) 
 
     本系統在硬體上激發光分光裝置上使用 H10，雖然 H10 為簡易型單光儀但是因為其
分光率不像 SpectraPro-300i 那樣高以致於可通過的光線較多，作為激發光使用有其優
點。而放射光裝置則使用 SpectraPro-300i，SpectraPro-300i 具有高解析度、量測範圍大、
可自行初始化等優點。 
  7
光波長調變裝置和放射光分光裝置其各需要 4 個數位訊號，一共需要八個數位開關作控
制。 
 
圖五、步進馬達趨動開關電路設計圖 
 
本系統步進馬達趨動是透過ATmega8535依圖四單極1-2相激磁波形圖做出時序訊
號後，再將訊號導入 ULN2803AP，藉由內部的達靈頓電路讓訊號增強以推動馬達裝置。
ULN2803AP 的內部電路如圖五所示(Each Driver)，當 ATmega8535 產生 High(高頻訊號)
時電晶體導通 common 端所連接的+6V 便會導通使馬達動作；反之，當 ATmega8535
產生 Low(低頻訊號)時，電晶體 OPEN 使+6V 電壓無法流通而馬達無法動作。藉由這種
方法控制馬達動作。 
 
5.4  PMT 光電倍增管電訊號轉換.電壓放大和 Detector 連結器電路配置 
單光儀分光後所得光強度訊號，需藉由光電倍增管將其轉換為電訊號再由 AVR 擷
取資料後呈現 。光電倍增管是一種具有高度敏感度與超快響應時間的光探測元件，一
般典型的光電倍增管在其最佳響應範圍內(近紅外光區~紫外光區)可以將微小的光訊號
轉換為脈衝電流,我們利用其脈衝電流來做訊號分析。 
本系統所使用PMT為Hamamatsu R928，其響應範圍為180 nm到900 nm，圖六(a)圖
說明此R928 PMT(虛線)不同波長同強度光線所動應的電流 )/( WmA 曲線。(b)圖說明
PMT內部電壓供應與反應時間的特性圖，反應時間為PMT內部將光訊號轉成電訊號需
要的時間，因此馬達轉動的時間不可大於反應時間。(c)圖說明電壓供應與訊號增益及
電流Sensitivity特性圖，當電流Sensitivity不高時可提高電壓將增益加。 
 
圖六、Hamamatsu R928特性曲線圖 
本系統所使用的 PMT Housing 為 Jobin Yvon 公司出品的型號：DPM-HVH 下圖為
DIN 連結器插頭電路配置(1)+12V~+15V 的電壓供給,本系統是給予+12V (2)接地端 
(3)n/c (4)控制輸入電壓端,輸入電壓透過 PMT 放大之後的比例是 1：100。本系統在輸入
電壓控制上是給予 0~10V 的電壓訊號。 
  9
2. 下載程式 
3. 馬達電壓控制 
4. 12V 電壓輸入經過電壓調變之後+12V 輸出給做 PMT 電 
            訊號轉換、電壓放大和輸入電壓控制的 IC； 
            +5V 則是提供給 ATmega8535 的電壓。 
5. PMT 電訊號轉換、電壓放大和輸入電壓控制。 
6. ATmega8535 的測試 PIN。 
7. ATmega8535 的電路。PIN1~PIN8 是單光儀控制；PIN9 是 
            RESET；PIN14、15 是上傳資料控制；PIN21 是 Digital  
            Output；PIN37 是 Analog Input。 
8. 上傳資料控制。 
 
 
圖十、系統完整電路圖 
 
5.6 光譜量測程式 
5.6.1 CPU(ATmega8535)韌體部分 
5.6.1.1  CPU(ATmega8535)韌體執行功能 
ATmega8535 內部程式是採用 C 語言所撰寫，程式內部主要分為馬達控制及數位
類比轉換兩部分，其中為了防止步進馬達失步，在馬達控制程式中增加了加減速的功
能。在整體光譜儀量測系統中，ATmega8535 所扮演的角色是傳送指令及接收訊號，
並透過 RS232 作為資料傳輸介面將其送至個人電腦，讓使用者可操作程式執行單光儀
波長選擇、PMT 控制電壓和接收量測訊號之功能。 
 
5.6.1.2 馬達韌體設計 
其程式內部為偵測鍵盤所輸入的 ASCII 碼。小寫 f、b 字元控制第一顆馬達正反
轉；小寫 s、t 控制第二顆馬達正反轉（f、s：正轉；b、t：反轉）。當使用者從 LabVIEW
端輸入 f、b、s、t 此指令經由 RS232 傳輸線送進 CPU 後，CPU 會給 LabVIEW “Enter 
front steps:”訊息告訴使用者輸入要正轉的步數假設輸入值 1000 則傳送給 LabVIEW 
“steps 1000” 訊息。 
  
  11
 
圖十三、將激發光單光儀轉動至欲量測之波長位置 
 
 
圖十四、訊號量測 
  13
閱、光譜資料正規化等功能。其中，光譜量測包含以下四種模式： 
A. 激發光(Excitation)掃描模式： 
固定放射光波長，改變激發光波長的量測模式。所量測出的圖形，縱軸為放射光強度
(特定波長)，橫軸為激發光波長。 
B. 放射光(Emission)掃描模式： 
固定激發光波長，改變放射光波長的量測模式。所量測出的圖形，縱軸為放射光強度，
橫軸為放射光波長。 
C. 激發放射矩陣(Excitation-Emission Matrix, EEM)掃描模式： 
EEM 掃描為設定一激發光波長範為及每一波長間隔，且用每一個單一波長的激發光
激發出一範圍波長的放射光強度曲線圖；再將每一波長激發光激發出的放射光光譜組
合成二維矩陣。所掃描出的光譜為二維強度圖形。 
D. 同步掃描模式(Synchronous Scan)： 
同步掃描為激發光與放射光以固定波長間距，同步掃瞄之方式。所量測出的圖形為激
發光波長對應放射光強度曲線圖。 
 
肆、 綜合評估 
 
    我們比較 Jobin Yvon 出品的控制器 Datescan2 與本研究開發的 PC-based 光譜儀(表一) 
 
表一、Datescan2 與 PC-based 光譜儀之比較 
 PC-based 光譜儀 Datascan2 
大小 較小(12*15*2.5 cm3) 較大(30*30*15 cm3) 
可攜性 較輕便 較笨重 
價格 較便宜，約 15000 元 較貴，約 18 萬 
量測時間 約 40 秒 約 40~60 秒 
 
    這套改良之後的 PC-based 光譜儀，硬體方面由於我們使用現在廣泛使用的微型嵌入式系統讓
成本大幅下降許多。而在軟體方面，我們也改良成模組化程式系統讓不同的硬體可以互相套用至
光譜量測系統中，增加軟體擴充性可以使使用者更容易變更。最後我們提供方便臨床人員使用的
人機介面讓使用者與光譜儀溝通無障礙。 
 由於我們身為醫學領域人員，也同時讓此光譜儀系統增加其它優勢。於本研究團隊先前的研
究成果中顯示，光譜訊號量測應用於癌症診斷有其發展潛力，能夠快速且正確地診斷出初期癌症
的發生。但是受限於目前市面上流通的光譜儀較為笨重，此技術必須克服許多不便利才能進一步
推廣於臨床中使用；因此本系統將光譜儀體積輕量化，解決不易移動的困擾，便能夠增加光譜診
斷技術於臨床使用的可行性。 
此外，本研究團隊尚具備光譜訊號分析系統的開發成果(多種生醫多變數分析技術廣泛應用在
生物光電測量系統，93-2218-E-214-003)，主要應用多變數分析方法建立光譜訊號與病症間的關聯
性，當輸入新的光譜訊號後便可依據此關聯診斷癌症。這同時也是使用 LabVIEW 開發此系統的
優點，LabVIEW 可完整開發硬體控制與軟體分析部份，因此我們可將已開發完成的多變數分析應
用程式整合於此光譜量測系統，構成完整的光譜量測分析診斷系統。未來將此光譜量測分析診斷
系統應用於臨床診斷中，以達到快速診斷癌症病變的目標。 
在醫學工程研究人員的訓練方面，本計畫確實訓練學生於硬體設計方面、軟體開發設計方面
的能力；另一方面，也訓練學生面對問題的邏輯思考能力，以及學問與實作間的協調能力。本計
畫與昇航公司合作開發，對於學界的專業知識、產業界的技術、人力相互合作、帶動產業的推廣
與發展、技術整合等，都有達成預定的目標。然執行此計畫最重要的收獲，在於學界的研究過程
  15
柒、 附件 
PC-based 光譜量測系統 v1.6 使用指導書 
目錄 
1 目的 ...................................................................................................... 1 
2 範圍 ...................................................................................................... 1 
3 權責 ...................................................................................................... 1 
4 參考資料 .............................................................................................. 1 
5 系統配備 .............................................................................................. 1 
6 系統規格 .............................................................................................. 2 
7 系統安裝說明 ...................................................................................... 3 
7.1 安裝需求...............................................................................................................................................................3 
7.2 安裝流程...............................................................................................................................................................3 
7.3 注意事項...............................................................................................................................................................4 
8 光譜儀量測系統使用說明 .................................................................. 5 
8.1 量測程式簡介.......................................................................................................................................................5 
8.2 初始設定操作流程...............................................................................................................................................6 
8.3 主程式操作說明...................................................................................................................................................7 
8.3.1 激發光(Excitation)掃描 ................................................................................................. 8 
8.3.2 放射光(Emission)掃描 ................................................................................................... 9 
8.3.3 激發放射矩陣(Excitation-Emission Matrix, EEM)掃描 ............................................... 9 
8.3.4 同步掃描 ...................................................................................................................... 10 
8.3.5 儲存檔案 .......................................................................................................................11 
8.3.6 開啟檔案 ...................................................................................................................... 12 
8.3.7 圖形檢視 ...................................................................................................................... 12 
8.3.8 結束程式 ...................................................................................................................... 16 
 本文件內容為國科會計畫(NSC 94-2622-E-214-007)之專有財產，非經書面許可，請勿複製或轉換成任何型式
使用。This information contained in this document is the exclusive of the NSC(NSC94-2622-E-214-007-CC3). 
Neither this document nor any part may be reproduced or transmitted in any form or by any means 
without prior permission in writing.  
撰稿人: 陳惠雯、賴泳如 
 
○5  光電倍增管 
○6   接線(RS232 轉 USB 接線 1條、RS232 轉 PS2 接線 1條、15pin 光電倍增管接線 1 條、
BNC 接線 1條) 
 
圖一、PC-Base 光譜量測系統配備 
 
6 系統規格 
廠牌型號 
項次 構成配備 廠牌 型號 
1 單光儀 JOBIN-YVON H-10 
2 單光儀 Acton Research Corporationt Spectra Pro-300i 
3 光電倍增管 HAMAMATSU R-928 
4 個人電腦 自行組裝  
5 
自製光譜儀
控制板 
義守大學生醫光電實驗室 BOX-1 
 
設備功能 
 本文件內容為國科會計畫(NSC 94-2622-E-214-007)之專有財產，非經書面許可，請勿複製或轉換成任何型式
使用。This information contained in this document is the exclusive of the NSC(NSC94-2622-E-214-007-CC3). 
Neither this document nor any part may be reproduced or transmitted in any form or by any means 
without prior permission in writing.  
撰稿人: 陳惠雯、賴泳如 
 
A. 安裝 PC-Based 光譜儀量測程式。 
B. 請依照圖二配線連接電腦與硬體。 
 
 
 
 
 
  
 
 
 
 
 
 
 
 
 
C. 開啟量測程式隨即進行量測。 
 
7.3 注意事項 
A. 掃描範圍請勿超過單光儀所能量測範圍,避免造成儀器損壞。 
B. 請勿在儀器運作時擅自拔除電源，此動作容易引起硬體裝置損壞。 
Acton 單光儀 
單光儀 
PMT 
光譜儀 
PC-Base 控制盒 
PC 
(圖二) 
15pin to 
 9pin line 
PS/2 to 9 pin line 
USB to 9 pin line 
USB to 9 pin line
 本文件內容為國科會計畫(NSC 94-2622-E-214-007)之專有財產，非經書面許可，請勿複製或轉換成任何型式
使用。This information contained in this document is the exclusive of the NSC(NSC94-2622-E-214-007-CC3). 
Neither this document nor any part may be reproduced or transmitted in any form or by any means 
without prior permission in writing.  
撰稿人: 陳惠雯、賴泳如 
 
8.2 初始設定操作流程 
程式開始執行時，會先要求 CPU 的 RS232 接線(圖三)及 Acton 單光儀的接線(圖四)是
否連上，否則程式不會執行下一步。 
            (圖三)       (圖四) 
 
程式執行後會先彈出設定激發光步進馬達初始位置視窗，(圖五)，此時激發光步進馬達
初始位置需與硬體上所顯示的刻度一致(圖六)。設定完成後請按“Set Ready?”按鈕確定
設定。 
(圖五) (圖六) 
注意: 此時必須非常小心將位置設定正確，否則將會引起量測上的錯誤，嚴重時甚至會造成
儀器的損壞。 
 
設定完成激發光步進馬達的設定之後，接著會彈出放射光量測步進馬達的設定，同樣地
需要與硬體顯示的刻度一致(圖五)。 
 本文件內容為國科會計畫(NSC 94-2622-E-214-007)之專有財產，非經書面許可，請勿複製或轉換成任何型式
使用。This information contained in this document is the exclusive of the NSC(NSC94-2622-E-214-007-CC3). 
Neither this document nor any part may be reproduced or transmitted in any form or by any means 
without prior permission in writing.  
撰稿人: 陳惠雯、賴泳如 
 
8.3.1 激發光(Excitation)掃描 
進行光譜量測時需先設定量測模式，在上方的工具列中選擇: “參數”>>“設定”(圖九) 
(圖九) 
 
選擇後即彈出“設定”視窗(圖九)。在掃描模式中選擇“激發光掃描”。“激發光起點”與“激
發光終點”為所要掃描的波段範圍，“放射光中心位置”為所要量測的放射光波長，“步
長”為光譜的解析度設定。“電壓”用來調整 PMT 的電壓。若要將此次的設定記錄下來
以便日後使用，請選擇“存檔”。“讀檔”即可將之前存的設定取出使用。 
(圖十) 
 
設定完成後選擇“設定完成”即會回到主畫面，按下畫面中的“開始量測”進行量測量測
進行中下方按扭會顯示為“緊急停止”，若要發現錯誤可按下便立即結束量測(圖十一)。 
(圖十一) 
 本文件內容為國科會計畫(NSC 94-2622-E-214-007)之專有財產，非經書面許可，請勿複製或轉換成任何型式
使用。This information contained in this document is the exclusive of the NSC(NSC94-2622-E-214-007-CC3). 
Neither this document nor any part may be reproduced or transmitted in any form or by any means 
without prior permission in writing.  
撰稿人: 陳惠雯、賴泳如 
 
(圖十三) 
(圖十四) 
 
8.3.4 同步掃描 
同步掃描模式的設定畫面(圖十五)如同先前所述，僅需將模式更改為“掃描”，再依需
求設定其它參數。在“激發光起點”與“激發光終點”選定激發光波長範圍，“激發-放射
波長差”設定激發光與放射光的波長差(nm)，此時“步長”為激發光的間隔。其餘操作
 本文件內容為國科會計畫(NSC 94-2622-E-214-007)之專有財產，非經書面許可，請勿複製或轉換成任何型式
使用。This information contained in this document is the exclusive of the NSC(NSC94-2622-E-214-007-CC3). 
Neither this document nor any part may be reproduced or transmitted in any form or by any means 
without prior permission in writing.  
撰稿人: 陳惠雯、賴泳如 
 
(圖十七) 
 
8.3.6 開啟檔案 
量測的結果可以讀取出來進行檢閱，路徑是“檔案”>>“開啟檔案”。 
(圖十八) 
 
8.3.7 圖形檢視 
在圖形檢閱的模式下可利用工具協助光譜的閱讀。 “圖形檢閱”>> “檢視模式”(圖十
九)，可將圖形顯示區的 Cursor 中心移到感興趣的光譜上，再用滑鼠左鍵按兩下，右
側資料顯示區便會顯示該光譜的資訊，被選擇的光譜線條為粗體(圖二十)。在檢視檢
視模式時其它工具列上的功能並不能執行，欲結束檢閱模式需按“結束檢閱模式”。 
 本文件內容為國科會計畫(NSC 94-2622-E-214-007)之專有財產，非經書面許可，請勿複製或轉換成任何型式
使用。This information contained in this document is the exclusive of the NSC(NSC94-2622-E-214-007-CC3). 
Neither this document nor any part may be reproduced or transmitted in any form or by any means 
without prior permission in writing.  
撰稿人: 陳惠雯、賴泳如 
 
(圖
二十一) 
(圖
二十二) 
 
