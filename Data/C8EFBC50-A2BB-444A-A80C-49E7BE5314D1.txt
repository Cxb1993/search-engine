 I 
中文摘要 
本子計畫主要目的即在針對國科會電力工程學門規劃之重點研究方向及產業需求所提
出之實用可調速永磁交流電機及驅動器研究計畫，於過去三年內從事永磁直流無刷電動機
及永磁交流同步電動機之控制器開發。在永磁直流無刷電動機控制器之開發方面首先提出
一新型可調速、內模鎖相式控制架構，經由此內模鎖相式控制架構可使控制器更具強韌性
及精確度；再者因整合另一子計畫之具電流感測脈波寬度調變之直流無刷驅動器使得整體
控制架構更加簡潔、可靠與適合 IC化。 
至於永磁交流同步電動機控制器之開發方面提出一新型相位頻率偵測器 (Phase 
Frequency Detector, PFD)，其輸出視轉速誤差絕對值之大、小及等於零時，分別設定為零、
線性虛擬相位差及真實相位差，可使全速調整範圍獲得良好的協調關係。第二，基於前述
PFD，提出一新型可調式精密速度控制器；其特點是不僅採用單位安培最大轉矩控制策略
以獲得快速響應之效果，並且可達更精準之速率控制精度。此外，文中並就所提新型精密
速度控制器之設計提出一些準則，俾於設計時可以快速滿足控制器規格。第三點，本計畫
最後並以德州儀器公司推出的DSP TMS320F2812結合FPGA實現新型鎖相迴路速度控制器
之控制法則，實際針對一 6 極 2 馬力之內嵌式永磁電動機製作一硬體電路雛型來驗證本計
畫所提控制策略之可行性。經實驗結果驗證，此新型鎖相迴路控制器在轉速從 482rpm 至
3122rpm均可獲得鎖相控制之效果。 
 
 
 
 
 
 III 
目錄 
中文摘要 
英文摘要 
目錄 
圖例說明 
表例說明 
第一章 緒言 
第二章 直流無刷電動機新型內模鎖相迴路控制技術 
2.1前言 
2.2等效於直流有刷電動機的永磁直流無刷電動機之數學模型 
2.3強韌性內模式速度控制器 
2.4鎖相迴路簡介 
2.5以鎖相方式實現之內模控制直流無刷電機速度控制器 
2.6 模擬與實作驗證 
2.7結論 
第三章 內嵌式永磁同步電動機之最大轉矩電流控制技術 
3.1前言 
3.2內嵌式永磁同步機之數學模型 
3.3內嵌式永磁同步電動機之最大轉矩控制策略 
3.4內嵌永磁同步電動機驅動器之電流控制迴路設計 
3.5負載轉矩估測器 
第四章 內嵌式永磁同步電動機之鎖相迴路控制技術 
4.1前言 
4.2新型鎖相迴路控制策略 
4.3控制器設計準則 
4.4實體製作與實測結果 
4.5結論 
第五章    結論 
第六章    計畫成果自評                                           
參考文獻 
 
 V 
圖 2-24  直流無刷電動機控制器系統暫態測試結果(a) rw , rf 及 a相電流波形(b) (a)中之部分
放大波形 
圖 3.1  理想三相內嵌式永磁同步電動機之結構示意圖 
圖 3.2 理想三相內嵌式永磁同步電動機等效電路圖 
圖 3.3  aF 投影至直交軸之示意圖 
圖 3.4  永久磁鐵感應至 a相繞組， rq 位置與 afl 之關係 
圖 3.5  內嵌式永磁同步機在同步座標下之數學模型等效電路 
圖 3.6  內嵌式永磁同步電動機在轉子轉座標下電氣與機械動態模型 
圖 3.7  轉子座標之直軸、交軸電流控制器 
圖 3.8  本篇計畫所採用之轉矩控制策略 
圖 3.9  降階估測器方塊圖 
圖 3.10  本計畫使用之負載轉矩估測器方塊圖 
圖 3.11 內嵌式永磁同步電動機速度控制器在增加負載轉矩前饋控制後於加載下之模擬波
形(a)轉速響應(b)控制器轉矩輸出(c)估測之負載轉矩 
圖 4.1  新型鎖相迴路速度控制器 
圖 4.2  新型相位頻率偵測器 
圖 4.3  虛擬相位差產生器之輸入輸出關係 
圖 4.4  新型相位頻率偵測器於0 Mf f< D £ D 時之數學模型 
圖 4.5 新型相位頻率偵測器於 0fD = 之數學模型 
圖 4.6  Mf fD > D 時之系統等效方塊圖 
圖 4.7  0 Mf f< D £ D 時系統之方塊圖 
圖 4.8  0 Mf f< D £ D 時將增益( 2
eK
p
)移至相位迴圈內之等效方塊圖 
圖 4.9  將圖 3.15中 ( )sC s 與 ( )pC s 合併之等效方塊圖 
圖 4.10  新型鎖相迴路速度控制器只考慮相位誤差之等效數學  模型 
圖 4.11  新型鎖相迴路速度控制下之轉速響應 
圖 4.12  新型鎖相迴路速度控制系統於 2t 時間內之數學模型 
圖 4.13  新型鎖相迴路速度控制器響應結果  (轉速命令100 / sec  rad ) 
圖 4.14(a)內嵌式永磁同步電動機新型鎖相迴路速度控制系統方塊圖 
圖 4.14(b)內嵌式永磁同步電動機新型鎖相迴路速度控制系統實現架構圖 
圖 4.15  先進電流感測控制系統方塊圖 
圖 4.16  轉速偵測電路 
圖 4.17 隔離驅動電路 
圖 4.18  數位-類比轉換器電路圖 
 VII 
表例說明 
表 3.1  內嵌式永磁同步電動機之參數值表 
表 4.1  速度伺服控制所需之規格 
表 4.2  電腦模擬速度伺服控制所需之規格 
 
 2 
第二章 直流無刷電動機新型內模鎖相迴路控制技術 
2.1 前言 
永磁交流電機的設計依應用場合之不同可區分為永磁同步電機與直流無刷電機。永磁
同步電機之氣隙磁通密度分佈設計成弦波，當電機旋轉時，電機線圈感應出弦波電壓，驅
動器配合電機磁場位置輸入弦波電流以驅動電動機。為正確偵測電機磁場位置，通常在電
機上安裝高解析度編碼器，利用編碼器之脈波訊號合成所需之對應電流命令訊號。市面上
販售之永磁同步電機伺服裝置性能優異，可提供轉矩、轉速、位置控制，其中轉速控制頻
寬可達上百 Hz，而位置控制頻寬可達數十 Hz，但價格卻很昂貴。然而直流無刷電機無論
在馬達或驅動器性能設計要求上都比永磁同步電機簡單許多，所以更具價格競爭力，因此
本計畫選擇直流無刷電機來研制一實用型可調速驅動裝置。直流無刷電機之氣隙磁通密度
分佈設計成梯形波形式，因此在驅動時只需偵測磁極極性來控制電機線圈電流流向，故可
排除昂貴之精密編碼器，而改採簡單且便宜之霍爾元件來偵測磁極極性，以產生所需之控
制用電流。另霍爾元件因偵測磁極極性故亦同時提供電機轉子轉速脈波訊號，以方便速度
控制應用。 
本子計畫主要目的在於配合國科會電力工程學門之規劃方向，完成無刷直流電機之鎖
相迴路控制策略研究[8], [12-14]。本計畫依進度研發完成無刷直流電機之強韌性鎖相式內模
控制之速度控制器。在設計直流無刷電機速度控制時，計畫中採用鎖相式控制策略，此速
度控制器利用霍爾偵測器偵測之無刷直流電機速度脈波信號與命令脈波信號之相位差，當
作速度誤差積分信號[15]，配合鎖相控制策略，完成強韌性內模式速度控制器，由於信號以
脈波方式直接處理無需轉換，因此可避免因轉換而伴隨之額外誤差，故可大幅提高速度控
制之精確性。另速度控制器整體之控制架構採內模控制，因此控制器更具強韌性且整體控
制電路簡捷易於實現皆大幅提高本控制器之實用價值。 
2.2 等效於直流有刷電動機的永磁直流無刷電動機之數學模型 
茲考慮一擁有梯形氣隙磁通密度分佈及對稱三相定子繞線之永磁直流無刷電動機
(PMBLDC)，當其被一換流器驅動時，三相定子繞線之各相迴路方程式[16]如(2.1)所示，其
對應之電壓、電流及換相信號波形則繪於圖 2.1。 
 0  0 -    0      0
0   0   0    -    0
0  0   0      0    -
a a a a
b b b b
c c cc
v R i L M i e
dv R i L M i e
dt
R i L M i ev
é ù é ù é ù é ù é ù é ù
ê ú ê ú ê ú ê ú ê ú ê ú= + +ê ú ê ú ê ú ê ú ê ú ê ú
ê ú ê ú ê ú ê ú ê ú ê úë û ë û ë û ë û ë ûë û
   (2.1) 
其中 
 4 
4( ) ( )
3 r
Sc t Sa t p= -
w
    (2.5) 
其中 ( )u t 為步級函數。由圖 2.1 之三相換相信號，吾人亦可定義一轉換方程式以將三相變
數 ( )af t , ( )bf t , ( )cf t 轉換為等效成有刷直流馬達之變數， ( )eqf t ，如下： 
[ ]
( )
( ) ( ) ( ) ( ) ( )
( )
a
eq b
c
f t
f t Sa t Sb t Sc t f t
f t
é ù
ê ú= ê ú
ê úë û
  (2.6) 
將 (2.2)-(2.5) 代入 (2.6), 得等效反電動勢方程式 ( )eqe t 如下： 
( ) 2 ( )eq c re t k t= fw   (2.7) 
設 ( )eqi t 為永磁直流無刷電動機等效於直流有刷電動機之電樞電流，既然 PMBLDC 之
定子電流 ( )ai t , ( )bi t , ( )ci t 經換流器控制成如圖 2.1 所示之三相方波波形，則由(2.6)可得等
效 電樞電流， ( )eqi t ，方程式及對應之電磁轉矩如下： 
[ ]
( )
( ) ( ) ( ) ( ) ( )
( )
a
eq b
c
i t
i t Sa t Sb t Sc t i t
i t
é ù
ê ú= ê ú
ê úë û
 (2.8) 
( ) / 2e a a b b c c r c eqT e i e i e i k i= + + w = f   (2.9) 
同理由(2.8)或(2.9)，一旦電磁轉矩命令或等效電樞電流 ( )eqi t 已知，其對應之三相定子電流
( )ai t , ( )bi t , ( )ci t 可由[ ] [ ]( ) ( ) ( ) ( ) ( ) ( ) ( )
T T
a b c eqi t i t i t Sa t Sb t Sc t i t= × 逆向求得。今考慮 BLDC電
動機之動態方程式如下： 
r
r e l
dJ B T T
dt
w
+ w = -            (2.10) 
其中 lT為負載轉矩， J及 B為電動機之轉動慣量及摩搓係數，由(2.9)及(2.10)可得等效電樞
電流 ( )eqi t 對轉子機械轉速之轉移函數為： 
 6 
 
圖 2.2 子計畫一研製之具電流感測之脈波寬度調變直流無刷驅動器 
 
 
w
 
圖 2.3 以轉速信號 ( )r Sw 為輸出之具電流感測脈波寬度調變之直流無刷驅動器方塊圖 
 
w w
 
圖 2.4 強韌鎖相式內模速度控制方塊圖 
 
 8 
加以實現，其中 /[ ( )]P p S L fk T k Tt= + 而 1/[ ( )]I S L fk k Tt= + ，由 IMC控制法則可輕易決定出 Pk
及 Ik 參數值。 
ww
 
圖 2.5 內模速度控制之迴授控制架構 
2.4鎖相迴路簡介 
鎖相迴路主要原理在於產生一對應系統中受控變數之訊號去追隨一外部參考訊號，讓
該系統訊號與外部參考訊號同步。當兩訊號之頻率相同，而其穩態相位差變為零或只剩下
某固定相位差時，即達到鎖相迴路之目的。鎖相迴路最早運用在通訊系統上[18-19]，在通
訊系統中常用於解調變(Demodulation)、載波同步(Carrier Synchronization)及除頻與倍頻
(Frequency Division and Frequency Multiplication)…等運用，是通訊系統中不可缺少的重要
技術。由於鎖相迴路可以達到精準的訊號追蹤能力，因此鎖相迴路被推廣應用到各種不同
的領域，伺服控制即為其中之ㄧ。 
鎖相迴路的架構基本上是由三個元件所組成： 
(1) 電壓控制震盪器(Voltage Controlled Oscillator, VCO) 
(2) 相位頻率偵測器(Phase Frequency Detector, PFD) 
(3) 迴路濾波器(Loop Filter, LF) 
其結構如圖 2.6 所示，由圖中可看出鎖相迴路基本架構屬於控制系統中的負迴授型態。圖
2.6中 sf 為外部參考訊號，經由相位頻率偵測器檢測參考訊號與系統內部迴授訊號( rf )之頻
率與相角差，輸出至迴路濾波器。不同的相位頻率偵測器具有不同的輸入輸出關係，圖 2.7
所示為一常用相位頻率偵測器之輸入輸出特性，其中 eq 為 sf 與 rf 之相位差，u為相位頻率
偵測器平均輸出。迴路濾波器為一低通濾波器，負責補償系統頻寬，並濾除系統中之高頻
雜訊，而 fu 為迴路濾波器之輸出。電壓控制震盪器根據迴路濾波器輸出訊號大小來調整震
盪器輸出頻率( rf )。電壓控制震盪器輸入輸出關係式如圖 2.8所示，其中 0f 為無輸入訊號時
電壓控制震盪器之輸出頻率。 
 
 10 
rf
fu
0f
 
圖 2.8 電壓控制震盪器之輸入輸出關係 
 
    鎖相迴路應用在電動機定速度控制上之運用，係以回授電動機編碼器訊號取代傳統鎖
相迴路之電壓控制震盪器。一典型的鎖相迴路速度控制器之架構圖如圖 2.9所示。圖 2.9中
*T 為迴路濾波器所產生之轉矩命令， Power Amplifier為功率放大器，負責產生驅動的電動
機所需的電流( si )。  
sf
rf
u *T si
rw
 
圖 2.9 電壓控制震盪器之輸入輸出關係 
 
    由於相位頻率偵測器不只可以偵測到微小的頻率誤差，就算是趨於零的頻率誤差，也
會被視為不斷累積的相位誤差而產生適當的誤差量(u )給迴路濾波器作補償，所以鎖相迴路
 12 
 
圖 2.11 轉速命令100 / secrad ，轉子轉速95 / secrad 時相位頻率偵測器之輸出與其平均值 
 
 
圖 2.12 rf 頻率不同時相位頻率偵測器之平均輸出 
 14 
由” 1”→”0”， 或由”0”→”-1”或由”-1”→”-1”，當 sf 與 rf 兩脈波信號之前緣
交互作用在相角頻率偵測器上時，則輸出狀態便在” 1”,”0”或”-1”變化，輸出狀態信
號波形指示出 sf 與 rf 兩脈波信號間之相角差。圖 2.13中相角頻率偵測器所偵測之相角差 eq
可提供控制器所需之速度誤差積分信號，鎖相控制迴路將與傳統之積分控制迴路 (1 ) /k s-
合併成1/ s，此外，若系統頻率超出鎖相範圍時，則由圖 2.13中速度命令信號 sw 與直流無
刷電機轉速信號 rw 相減產生速度誤差信號 ew ，然後速度誤差積分信號 eq 與速度誤差信號
ew 再依內模控制法則(2.19)，經增益或積分方塊合成電流控制信號 Si ，以消除速度誤差，
快速進入鎖相範圍。由圖 2.13可看出，本計畫提出以鎖相方式實現內模控制之直流無刷電
機速度控制器，此速度控制器以速度命令脈波信號 sf 及電機轉速脈波信號 rf 之相角差作為
速度誤差之積分信號，當速度控制器使用積分信號消除控制迴路之穩態速度誤差時，電機
轉速脈波將追隨速度命令脈波而達鎖相狀態。然則在系統頻率尚未進入鎖相範圍時相角頻
率偵測器(PFD)之非線性特性本計畫將以一描述方程式 ( )D x 實現。因 PFD之平均輸出電壓
對 sf 與 rf 頻率差之圖形如圖 2.15(a)所示，今若以一弦波 ( )x cosq = q當作 PFD之等效輸入訊
號，則根據圖 2.15(a)之輸出入特性可得 PFD之對應輸出 ( )y q 如圖 2.15(b)所示，若只考慮基
本波，則 PFD (IC4046)在暫態下之輸出入關係將為 ( ) ( ) 1.987 ( )dy k x xq @ q = q ，此時系統控制
架構可考慮為圖 2.16之形式。 
  
(a) 
 
(b) 
圖 2.15 4046PFD 在頻率未進入鎖住範圍時之(a)輸出入特性函數圖(b)以 cosq當作輸入時之
輸出波形圖 
 16 
(1 )(1- ) (1- )( ) ( ) [ ( ) ] ( ) [ ]
1
s LI I
P I e p P I d
p
k sk k k kG s H s k kk D G s k kk k
s s T s
- t
= + w + = + +
+
   (2.26) 
若將複數頻率代為 jw則式(2.26)可表示為 
2
2 2
2
2 2
(1- )(1- )( ) ( ) [ ]
1
[ ]
                       [(1- ) - ( )]
1
(1- )                          [- ( ) - (1- )]
(1 )
s LI
p I d
p
s p I d
L p p L
p
s I
p L L p
p
k jk kG j H j k kk k
j j T
k k kk k
T j T
T
k k k T j T
T
wt
w × w = + +
w + w
+
= w t w + t
+ w
+ w + t w t
w + w
 (2.27) 
2
2 2Re{ ( ) ( )} [- ( ) - ]1
s I
L p p d d L p L
p
k kG j H j T T kk kk kT K
T
w × w = w t + + t + + t
+ w
  (2.28) 
2 2
2 2Im { ( ) ( )} [ ( ) 1 ](1 )
s I
p d L d p L p
p
k kg G j H j T kk kk T k T k
T
w × w = - w + t + + t + -
w + w
 (2.29) 
其中Re{ ( ) ( )}G j H jw × w 及 Img{ ( ) ( )}G j H jw × w 分別為迴路增益之實部及虛部部分。由(2.27), 
吾人令 Img{ ( ) ( )}p pG j H jw × w 為零，可得系統之增益邊限, Gm, 為 
1 Re{ ( ) ( )}
( )
p f d L
p p
p f L
T T kk
Gm G j H j
T T
- t
= + w × w =
+ t
 (2.30) 
接著令 ( ) ( ) 1g gG j H jw × w = , 可得系統之相位邊限, Pm , 為 
1 Im ( ( ) ( ))tan ( )
Re( ( ) ( ))
g g
g g
g G j H j
Pm
G j H j
- w × w= + p
w × w
   (2.31) 
式(2.30)及(2.31)中, pw 及 gw 分別為系統之相位交越頻率及增益交越頻率，同時系統穩定時
需滿足 
0
( )
p f d L
p f L
T T kk
Gm
T T
- t
= >
+ t
            (2.32) 
由式(2.32),吾人可再次求得與式(2.25)一致之系統穩定度條件。 
 18 
示，於圖 2.18中 Si 為 4Amp輸入之步階命令，而 rw 為直流無刷電機之速度響應，依參考文
獻[20]，計算得直流無刷驅動器之系統函數如下： 
(1 ) 0.771(1 0.01818 )( )
1 1 0.2
s L
p
p
k s sG s
T s s
- t -
= =
+ +
 (2.33) 
若選擇 
-
0.771( )
1 0.2M
G s
s
=
+
       (2.34) 
及 
1 1 0.2 1( )  ( ) ( )  
0.771 1IMC M f
sG s G s F s
T s-
- += = ×
+
 (2.35) 
將 ( )PG s 代入 ( ) = IC P
kG s k
s
+  可得比例及積分常數為： 
0.2
0.771 (0.01818 )p f
k
T
=
× +
 (2.36) 
1
0.771 (0.01818 )I f
k
T
=
× +
     (2.37) 
 
圖2.19 所提控制系統迴路增益之波德圖 
 20 
 
(a) 
 
(b) 
w
 
(c) 
圖 2.20 “a”相電流及等效電樞電流於電流感測電路中所量得之波形(a)不使用等效電樞電
流控制迴路(b)使用等效電樞電流控制迴路(c)使用等效電樞電流控制迴路及速度控制迴路 
 22 
 
圖2.22 在不同時間常數 pT 下，所提直流無刷電機速度控制器之速度模擬響應結果       (a) 
pT =0.2sec. (b) pT =0.3sec. (c) pT =0.1sec. 
 
為瞭解參數 k 及 fT 變動對系統相對穩定度之影響，吾人利用(2.30)中之增益邊限方程
式，將 k及 fT 值對系統迴路增益穩定度之關係顯示於圖 2.23，於圖 2.23中，吾人可得知，
若為得到較佳之系統穩定度，則應該選擇較大之 fT 值及較小之 k 值。最後對系統進行暫態
量測可得圖 2.24之結果。於圖 2.24中，系統於負載轉矩 4 Nt-m 及 22rf Hz= 運轉下於 t=A
點將速度命令 sf 由 22Hz瞬間提升至 93 Hz，然後在 t=B點將 4 Nt-m負載突然移除一段時
間，再在 t=C點重新加入負載。其對應之 a相電流 ai ， rw 及 rf 響應顯示於圖 2.24(a)中。於
圖 2.24(a)中之響應可知，即使在暫態響應下，系統之速度響應不管在電子電路上及機械轉
動上皆相當平順。為便於觀察，圖 2.24(b)為圖 2.24(a)訊號響應之部分放大圖形。 
 
 
圖 2.23 系統參數 k及 fT 之選擇對直流無刷電動機控制器系統穩定度之影響結果 
 
 24 
第三章 內嵌式永磁同步電動機之數學模型與最大轉矩電流控制技術 
3.1 前言 
內嵌式永磁同步電動機是將永久磁鐵內嵌在轉子內部，機構上較表面黏著式永磁同步
電動機(Surface-Mounted Permanent Magnet Synchronous Motor)有較堅固的機械結構，因此
更適合高轉速之應用場合。由於內嵌磁鐵之安置結構，使磁路不同於表面黏著式永磁同步
電動機，造成 d軸與 q 軸電感量不同，因此內嵌式永磁同步電動機比表面黏著式永磁同步
電動機轉矩多出額外的磁阻轉矩分量。本章第二節首先推導內嵌式永磁同步電動機之數學
模型。第三節則說明本篇計畫所採用之內嵌式永磁同步機轉矩控制策略，內容包含磁場導
向控制理論(Field Oriented Control)與單位電流最大轉矩(Maximum Torque Per Ampere)控制
策略，第四節介紹負載轉矩估測器並模擬加載運作之結果。 
3.2 內嵌式永磁同步機之數學模型 
內嵌式永磁同步機之數學模型包含電氣系統與機械系統兩部分。在推導內嵌式永磁同
步機數學模型之前，先假設以下基本條件： 
1. 永磁同步機一次側為三相平衡繞組 
2. 氣隙(Air Gap)中的磁動勢(MMF)為弦波分佈 
3. 忽略鐵損(Core Loss) 
4. 磁路無磁飽和(Magnetic Saturation)現象 
5. 忽略繞線槽效應(Slot Effect) 
6. 無阻尼繞組(Damper Winding)  
 圖 3.1所示即為三相內嵌式永磁電動機示意圖，其中 a-axis、b-axis及 c-axis分別
表示電動機定子 a、b、c三相繞組之參考軸。d-axis、q-axis為轉子座標之直、交參考軸，
而 rq 為轉子直軸(d-axis)與 a相繞組參考軸(a-axis)所形成的夾角，N 、 S分別表示永久
磁鐵之北極與南極。由於三相繞組之間彼此都有互感存在，而轉子永久磁鐵產生磁場亦會
隨轉子運動在定子繞組產生磁通變化。因此，吾人可以利用耦合電感模型與法拉第定律推
導內嵌式永磁同步電動機之電氣電路模型。假設定子繞組為三相 Y接，則圖 3.1之模型亦
可以圖 3.2 之等效耦合電感與永久磁鐵與各繞組磁產生之磁交鏈表示之。其定子側電壓方
程式，由克希荷夫電壓定律可表示成如下： 
as s as as
dV R i
dt
l= +                                         (3.1) 
 26 
sR
sRsR
aaL
ccLbb
L
baab LL = caac LL =
cbbc LL =
afl
cfl
bfl
csv
bsv
bsi
asv
csi
asi
S
N
S
N
rw
 
圖 3.2 理想三相內嵌式永磁同步電動機等效電路圖 
 
接著，吾人將推導在定子側電壓方程式中的各電感參數： 
1. 定子側各繞組之自感( aaL 、 bbL 及 ccL ) 
以 a相為例，只外加 ai 電流，可求得 a相之磁動勢 asiNF =a ，其中 sN 為每相繞組之有
效匝數。如圖 3.3所示，吾人將 a相之磁動勢 aF 投影至轉子之直軸和交軸，可獲得直軸及
交軸之分量如下： 
da coss as rF N i q=                                          (3.7) 
qa cos( 90 ) sinq q= + = -
o
s as r s as rF N i N i                            (3.8) 
由於磁通量(Flux)f，等於磁動勢與磁導(Permeance) P 之乘積，即表示如下： 
P´= MMFf                                          (3.9) 
因此 a相磁通量 af 在直、交軸之各分量可表示如下： 
da a cosda d r dF Ff q= =P P                                    (3.10) 
 28 
2
a a cos 22 2
d q d q
a s s rN N il f q
+ -é ù
= = +ê ú
ë û
P P P P
                     (3.13) 
則 a相自感 aaL 為： 
2 cos 2
2 2
d q d qa
aa s r
a
N
i
l
q
+ -é ù
= = +ê ú
ë û
P P P P
L                        (3.14) 
1 2 cos 2 rL L q
D
= +                                      (3.15) 
上式中 
2
2
1
qd
sNL
PP +
=
D
，
2
2
2
qd
sNL
PP -
=
D
 
同理可得 b相及 c相之各自感( bbL 及 ccL )為： 
o
1 2 cos(2 120 )q= + +bb rL LL                                 (3.16) 
o
1 2 cos(2 120 )q= + -cc rL LL                                 (3.17) 
由上述之結果可知，任一相的定子自感都含有 rq 變數，且含有隨二倍轉子頻率變化之電感
分量，此乃由於直軸與交軸磁路不同等所造成。 
2. 定子側繞組間之互感( abL 、 acL 、 baL 、 bcL 、 caL 及 cbL ) 
  以 a、b相耦合為例，只輸入 ai 電流，其鏈接至 b相之磁通量 baf 為： 
 o o ocos( 120 ) cos( 90 120 )f f q f q= - + + -ba da r qa r  
 o ocos( 120 ) sin( 120 )f q f q= - - -da r qa r  
       o o[cos( 120 )cos sin( 120 )sin ]q q q q= - + -s a r r d r r qN i P P  
   o[ cos(2 120 )]
4 2
q
+ -
= - + -d q d qs a rN i
P P P P
                   (3.18) 
茲假設定子側三相有效繞組都相等， sscsbsa NNNN === ，則 bl 為： 
 30 
N
S
90orq =
S NSN
0orq =  
                          
圖 3.4 永久磁鐵感應至 a相繞組， rq 位置與 afl 之關係 
 
同理，吾人可得永久磁鐵對 b相及 c相之磁交鏈( bfl 及 cfl )為： 
( )ocos 120l l q= -bf f r                                    (3.25) 
( )ocos 120l l q= +cf f r                                    (3.26) 
吾人將上述三項推導之結果以矩陣型式表示，可表示成： 
 [ ]
aa ab ac af
ba bb cb bf
ca cb cc cf
l
l
l
D
é ù
ê ú= ê ú
ê úë û
L L L
L L L L
L L L
 
  
o
1 2 1 2
o o
1 2 1 2
o
1 2 1 2
1cos 2 cos(2 120 )
2
1 cos(2 120 ) cos(2 120 )
2
1 1cos(2 120 ) cos 2
2 2
q q
q q
q q
é + + - + -ê
ê
ê= - + - + + +
ê
ê
ê- + + - +
êë
l
l
r r
r r
r r
L L L L L
L L L L L
L L L L
 
 32 
0 0( 120 ) ( 120 )2 ( )
3
r r rj j j
as bs csi e e i e i
q q q- - - - += + +                        (3.31) 
再將(3.31)式以直交軸型式表示，可表示成： 
   ( ) ( )o o2 cos sin cos( 120 ) sin( 120 )
3
q q q qé+ = - + - - -ë
r r
ds qs as r r bs r ri ji i j i j  
        ( )o ocos( 120 ) sin( 120 )q q ù+ + - + ûcs r ri j     (3.32) 
吾人從(3.32)式之實數與虛數部份獲得兩個實數方程式： 
o o
o o
2 cos cos( 120 ) (cos( 120 )
3
2 sin sin( 120 ) sin( 120 )
3
q q q
q q q
ì é ù= + - + + ûï ëï
í
ï é ù= - - - - +ë ûïî
r
ds as r bs r cs r
r
qs as r bs r cs r
i i i i
i i i i
             (3.33) 
假設該電動機為三相四線式，且考慮不平衡狀況時，吾人必須考慮下式零相序電流成份： 
( )csbsasos iiii ++= 3
1                                       (3.34) 
接著，吾人可將(3.33)~(3.34)式表示成矩陣型式如下： 
o o
o o
cos cos( 120 ) cos( 120 )
2 sin sin( 120 ) sin( 120 )
3
1 1 1
2 2 2
q q q
q q q
é ù
ê úé ù - + é ù
ê úê ú ê ú= - - - - +ê úê ú ê ú
ê úê ú ê úë ûë û ê ú
ë û
r
ds r r r as
r
qs r r r bs
os cs
i i
i i
i i
           (3.35) 
同理，定子 a、b、c三相之磁通鏈空間向量表示式為： 
( )l l l l= + +v 22
3
s s s s
s as bs csa a                               (3.36) 
 34 
為完整起見，吾人亦可考慮零相序成份如下： 
ososos
e
os iLiL
D
l == l                                        (3.42) 
上式中 osL 稱為零相序等效電感。 
同理可將(3.1)~(3.3)式表示成空間向量： 
s
s
s
ss
s
s dt
diRv l+=                                         (3.43) 
接著，再將(3.43)式兩邊同乘 rje q- 以轉換至轉子座標： 
r r r r
s s s s r s
dv R i j
dt
l w l= + +
uur ur uur uur
                                  (3.44) 
其中wr為轉子電器角速度；然後再將(3.44)式分成實數、虛數部份，表示成果直、交軸座
標分量： 
r r r r
ds s ds ds r qs
dv R i
dt
l w l= + -                                   (3.45) 
r r r r
qs s qs qs r ds
dv R i
dt
l w l= + +                                   (3.46) 
若考慮零相序電壓成分如下： 
osossos dt
diRv l+=                                        (3.47) 
則此電動機之輸入總電功率為： 
in as as bs bs cs csP v i v i v i= + +  
( )3 3
2
r r r r
ds ds qs qs os osv i v i v i= + +                             (3.48) 
由於本計畫內所採用一三相平衡系統，所以吾人將(3.48)式變成： 
 36 
( )( )32 2
r r r
e f qs ds qs ds qs
PT i L L i il= + -                          (3.57) 
由(3.57)式可知，內嵌式永磁同步電動機所產生之電磁轉矩可以由 rdsi 與
r
qsi 控制，若電磁轉
矩採用 0rdsi = 控制策略，則(3.57)式可以寫為： 
3
2 2
r
e f qs
PT il=                                   (3.58) 
因此內嵌式永磁同步電動機之電磁轉矩可直接由 rqsi 控制。 
    將(3.40)與(3.41)式分別帶入(3.45)式及(3.46)式，可得到內嵌式永磁同步電動機於
轉子座標下直軸、交軸之電氣方程式如下： 
r r r r
ds s ds ds ds r qs qs
dv R i L i L i
dt
w= + -                          (3.59) 
( )r r r rqs s qs qs qs r ds ds fdv R i L i L idt w l= + + +                    (3.60) 
其等效電路圖如圖 3.5所示。 
 至於內嵌式永磁同步機之機械系統模式，吾人使用旋轉運動之機械方程式，獲得如下
之結果： 
m
e m load
dT J B T
dt
w
w= + -                                 (3.61) 
其中 
J  ： 轉子慣量 
B  ： 摩擦黏滯係數 
loadT  ： 負載轉矩 
 
 38 
機控制。根據 3.2 節所推導的內嵌式永磁同步電動機在轉子座標下之數學模型，吾人將依
據磁場導向控制理論，控制定子電樞電流之大小與相角來達到內嵌式永磁同步電動機之轉
矩控制。 
由(3.57)式推得之結果，內嵌式永磁同步機之電磁轉矩由定子電樞電流 rdsi 、
r
qsi 決定，而
由(3.59)及(3.60)可知，欲使用 rdsv 、
r
qsv 控制
r
dsi 、
r
qsi ，會因為直軸與交軸之耦合項 
r
r qs qsL iw 與
( )rr ds ds fL iw l+ 互相干擾，使響應結果不如預期。因此吾人採用電壓解耦合方式，先令： 
,
r r
ds ds cmd r qs qsv v L iw= -                                   (3.62) 
( ),r r rqs qs cmd r ds ds fv v L iw l= + +                              (3.63) 
其中 ,
r
ds cmdv 、 ,
r
qs cmdv 分別為控制
r
dsi 、
r
qsi 之電壓命令，將(3.62)式、(3.63)式帶入(3.59)式、
(3.60)式得到：  
,
r r r
ds cmd s ds ds ds
dv R i L i
dt
= +                                 (3.64) 
,
r r r
qs cmd s qs qs qs
dv R i L i
dt
= +                                 (3.65) 
將(3.64)式、(3.65)式改寫為： 
,
1r r rs
ds ds ds cmd
ds ds
Rd i i v
dt L L
= - +                              (3.66) 
,
1r r rs
qs qs qs cmd
qs qs
Rd i i v
dt L L
= - +                              (3.67) 
因此經由電壓解耦合後，(3.59)式與(3.60)式之耦合項已去除，吾人可由 ,
r
ds cmdv 、 ,
r
qs cmdv 控制
r
dsi 、
r
qsi ，進而控制電磁轉矩。 
    依據(3.66)式 、(3.67)式之結果，可設計轉子座標下直軸、交軸電流控制迴路，由於
此電流控制迴路各個控制變數都在轉子座標下，因此所有變數都必須轉換至轉子座標，其
直軸、交軸電流控制迴路之架構如圖 3.7所示。 
 40 
若假設定子電流向量之大小為常數時，也就是 ss ami i=
v
並帶入(3.69)式得： 
( )( )232 2 r r re f qs ds qs am qs qs
PT i L L i i il= + - - ´
                      (3.70) 
將(3.70)式對 rqsi 微分並將結果令為零，也就是： 
0er
qs
dT
di
=
                                              (3.71) 
此運算就物理意義而言，表示在某個固定的定子電流向量下，所能產生之最大電磁轉矩，
而產生此最大電磁轉矩之 rdsi 必須滿足以下之關係式[21]。 
( )
2
2
2  4( )2
f fr r
ds qs
qs dsqs ds
i i
L LL L
l l
= - +
--
                        (3.72) 
得到 rdsi 後，可由(3.68)式得到
r
qsi 。 
2 2r r
qs am dsi i i= -                                          (3.73) 
不考慮弱磁運作時，只需考慮電流限制條件， rdsi 、
r
qsi 必須滿足： 
2 2 2r r
ds qs SMi i I+ £                                          (3.74) 
其中 SMI 為空間向量表示之最大定子電流。 
在電流限制條件下，單位安培最大轉矩軌跡上之 rdsi 與
r
qsi 關係可寫為下式[21]。 
2 2 22( ) 4( ) 0r rqs ds ds f f qs ds qsL L i L L il l- - + + - =                    (3.75) 
由(3.75)式與(3.74)式，可以得到電流限制圓下所能產生之最大轉矩為： 
 42 
將(3.83)帶入(3.75)式可得到在某電磁轉矩命令對應之控制量 *u 與交軸電流命令關係： 
2 2 *4 * * 2 *29 ( ) 12 16 0r rds qs qs tM f qs tMP L L i PK u i K ul- + - =                  (3.84) 
故吾人若有一電磁轉矩命令 *eT ，可由(3.79)式產生對應之控制量
*u ，此控制量 *u 由(3.82)
式與(3.84)式解出直軸、交軸電流命令 *rdsi 、
*r
qsi ，其關係如圖 3.8所示。 
 
*
eT 1
tMK
*u
*r
dsi
*r
qsi
 
圖 3.8 本篇計畫所採用之轉矩控制策略 
 
3.4 內嵌永磁同步電動機驅動器之電流控制迴路設計 
本計畫研發之內嵌永磁同步電動機驅動器於轉矩迴路設計上採用最大轉矩電流比控制
策略，驅動器對於某轉矩命令可分配電機中 d、q 軸電流，d、q 軸電流經電流控制器饋入
至電機中，使電機輸出命令轉矩，獲得高驅動效率。本計畫採用強韌性內模式電流控制器
控制內嵌永磁同步電動機之 d、q軸電流，內模式控制(Internal Model Control，IMC) [5-7]
如第二章已敘述過，是一種強健性控制，依據應用於永磁同步電動機之控制方法，首先將
(3.59)至(3.60)表示為： 
* * * *r r r r
ds s ds ds ds r qs qs
dv R i L i L i
dt
w= + -  (3.85) 
* * * *r r r r
qs s qs qs qs r ds ds
dv R i L i L i
dt
w= + +  (3.86) 
式中 *r rqs qs r mv v w l= - ，假設電氣系統之時間響應遠比機械系統之響應為快，則在電流控制
迴路中，吾人可將 rw 近似為常數，因此其對應之頻域模式為： 
 44 
[ ]1 0
a aa ab a a a
b ba bb b b b
a
b
x F F x G x
u F Gu
x F F x G x
x
y
x
é ù é ù é ù é ù é ù
= + +ê ú ê ú ê ú ê ú ê ú
ë û ë û ë û ë û ë û
é ù
= ê ú
ë û
&
@
&
 (3.92) 
   :
  :
, :
a
b
x
x
u
y
F G
   :
 :
  
其中 可由感測器直接量測訊號之狀態變數
需要估測訊號之狀態變數
輸入
輸出
為已知常數矩陣
 
將(3.92)式展開，則需估測狀態 bx 之方程式為： 
b bb b ba a bx F x F x G u= + +&  (3.93) 
定義 ˆbx 為 bx 之估測值，且令 
ˆb b bx x x= -%  (3.94) 
其中 ˆbx 為估測誤差，接著對(3.94)式兩邊微分： 
( )             
ˆ
ˆ        
b b b
bb b ba a b b
bb ab b
d x x x
dt
F x F x G u x
F lF x
= -
= + + -
-
&% &
&
%@
 (3.95) 
(3.95)式即表示估測誤差之動態方程式，其中 bb abF lF-  為動態方程式之特徵值，因此可由
設計 l值來決定估測誤差之收斂速度，估測誤差趨近於零，意即 ˆb bx x» ，則吾人可得有效之
估測值 ˆbx 。 
將(3.93)式代入(3.95)式： 
 ( )( )ˆ ˆbb b ba a b b bb ab b bF x F x G u x F lF x x+ + - = - -&  (3.96) 
(3.96)式經整理後可得： 
( )ˆ ˆ ˆb bb b ba b aa a ab bx F x F y G u l y F y G u F x= + + + - - -& &        (3.97) 
(3.97)式又可寫為： 
 46 
0 0  , (Nominal Value), ,J B J BD D其中  為標稱值 為變動量。由(3.102)式，吾人可得： 
*m
m e
d a bT b
dt
w
w g= - - +  (3.103) 
其中 
( )
0
0
0
1
  mLoad m
Ba
J
b
J
dT J B
dt
w
g w
=
= -
= + D + D 不確定項之總和
 
在不確定項總和 g 中，由於 JD 與 BD 之變動都不大，所以 LoadT 主導g 之變動。因為 LoadT 的
變動不會在瞬間變化，於是吾人可假設其在很短暫的取樣時間內為常數。由以上之假設，
吾人便可將欲估測之g 與可量測之 mw 代入(3.92)式： 
[ ]
*
0 0 0
1 0
m m
e
m
m
a b bd T
dt
y
w w
g g
w
w
g
- -é ù é ù é ù é ù
= +ê ú ê ú ê ú ê ú
ë û ë û ë û ë û
é ù
= = ê ú
ë û
 (3.104) 
將(3.104)式代入(3.97)式，可得估測器動態方程式為： 
( )*ˆ ˆel y ay bT bg g= + + -& &  (3.105) 
其中 l 為狀態回授增益 
gˆ 表示 g 之估測狀態 
吾人定義g 之估測誤差 gˆ 為： 
ˆg g g= -%  (3.106) 
由於數位控制器的取樣頻率相比， g 變化算是相當緩慢，其微分為零。因此吾人可得此估
測誤差之動態方程式為： 
( )*ˆ ˆed d l y ay bT bdt dtg g g= - = - + + +% &  (3.107) 
 48 
表 3.1 內嵌式永磁同步電動機之參數值表 
極數 6 
轉子電阻 0.15W  
直軸電感 0.3mH 
交軸電感 0.525mH 
反電動勢常數 0.042V/(rad/sec) 
最大相電流 20A 
轉子慣量 19.4m 2N-sec / rad  
摩擦係數 2.57m N-sec / rad  
負載轉矩 1N-m 
 
接著吾人於數位控制器實現時將(3.111)式中之積分項(
1
s
)以後向(Backward)近似法，即： 
1
1
1
1 s
z T
s z
-
-= -
 (3.112) 
其中 sT 為數位控制器之取樣周期，將(3.112)式代入(3.111)式整理後可得差分方程式如下： 
( ) ( ) ( )
( ) ( ) ( )*
ˆ ˆ1 1 ( )
                   1 1 1
s m
s m s e
k lbT k l k
T l a k lbT T k
g g w
w
= - - - +
+ - - + -
 (3.113) 
(3.113)式中， gˆ 即為估測之負載轉矩，在數位訊號處理器相當容易實現。 
    接著吾人為了驗證此負載轉矩前饋控制，將模擬速度控制之內嵌式永磁同步電動機加
載情形，其模擬條件與電動機參數如表 3.1所示，而模擬結果如圖 3.11所示。由圖 3.11(a)
之轉速響應可見，比例積分控制器在無負載轉矩前饋補償時，有較大之轉速誤差，但在加
上負載轉矩前饋補償後，可以有效改善轉速響應結果。圖 3.11(b)為控制器之輸出轉矩，
有負載轉矩前饋補償之比例積分控制器會輸出額外之轉矩，消除負載轉矩造成之干擾，圖
3.11(c)為估測器之轉矩。 
 
 
 50 
第四章 內嵌式永磁同步電動機之鎖相迴路控制技術 
4.1 前言 
鎖相迴路應用在伺服控制可達到更精準的速度控制，因此常用於一些需要精密製程的
產業，例如半導體製程、工具機、生產線之輸送帶及光碟機等。然而這接應用大都屬於定
速控制。就可調速控制而言，由於電動機之摩擦與慣量，使其電磁轉矩對轉速之轉移函數
成為一具有時間延遲之低通濾波器特性。而此存在的時間延遲特性甚易使得控制器產生過
多或過少的轉矩命令，造成鎖相迴路速度控制易發生震盪、暫態響應時間過長，甚至不易
鎖相等問題。針對此問題，本計畫提出ㄧ新型鎖相迴路速度控制器，與傳統鎖相迴路不同
的是，藉由所提出的新型相位頻率偵測器，可以克服電動機慣性與時間延遲不易達到鎖相
的缺點。 
本章首先介紹本計畫所提出新型鎖相迴路控制策略，然後建立新型鎖相迴路的數學模
型，並依據所建立的數學模型提供一新型鎖相迴路速度控制器之設計準則。最後，以一速
度控制器之實例設計並藉由數值分析軟體模擬結果，相互驗證所提控制策略之可行性。 
4.2 新型鎖相迴路控制策略 
本計畫所提之新型鎖相迴路速度控制器架構圖如圖 4.1 所示，係採用速度控制迴路與
鎖相控制迴路之雙迴路控制，再加上負載轉矩前饋補償迴路整合而成。其設計理念是由速
度控制迴路達到快速轉速響應，緊接著以鎖相控制迴路達到精密轉速控制，並以負載轉矩
前饋補償迴路改善加載特性，增加鎖相能力。新型鎖相迴路控制器主要針對傳統鎖相迴路
中的相位頻率偵測器加以改良，以新型相位頻率偵測器取代傳統相位頻率偵測器。新型相
位頻率偵測器之結構如圖 4.2所示，主要由頻率偵測器(Frequency Detector)、虛擬相位產生
器(Virtual Phase Difference Generator)、命令訊號產生器(Command Signal Generator)及相偵測
器(Phase Detector)所構成。新型鎖相迴路控制器中各個元件功用如下所述。 
頻率偵測器 
頻率偵測器輸入訊號有二，其一為電壓控制震盪器根據轉速命令產生之脈波頻率
( sf )，另ㄧ輸入為電動機編碼器脈波訊號頻率( rf )，頻率偵測器比較出 sf 與 rf 之頻率誤差
( fD )，並將頻率誤差傳遞給虛擬相位差產生器。 
虛擬相位差產生器 
虛擬相位差產生器根據頻率偵測器所產生的頻率誤差訊號，決定虛擬相位差( sqD )之大
小。虛擬相位差產生器輸入輸出數學式如(4.1)式所示，其中 1e 為一趨近於零之正實數量，
MfD 為鎖相迴路控制器開始動作時之頻率誤差，而虛擬相位差產生器輸入輸出關係如圖4.10 
 52 
sqD
MfD
Mf-D
12p e-
12p e- +
fD
 
圖 4.3 虛擬相位差產生器之輸入輸出關係 
 
所示。 
1
0            ,
2   ,
0              ,
M
s M
M
M
f f
f f f
f
f f
p e
q
ì D > D
ï
-ïD = D D £ Dí
Dï
ï D < -Dî
                        (4.1) 
命令訊號產生器 
命令訊號產生器會依據虛擬相位差產生器產生之虛擬相位差角( sqD )與編碼器頻率 rf
來決定輸出命令訊號，為明確說明命訊號產生器輸出訊號之產生原理，吾人定義一脈波週
期函數 ( )nE q 如(4.2) 式所示。 
( ) (2 ) (2 ( ))n n nE E ft E f t Tq p p= = +                     (4.2) 
其中 2 ftq p=  
1T
f
=  
因此電壓控制震盪器輸出之脈波訊號可使用脈波週期函數 ( )nE q 表示為：  
(2 ) ( )n s n sE f t Ep q=                                 (4.3) 
其中 2s sf tq p=  
 54 
Mf fD > D 、0 Mf f< D £ D 與 0fD = 三種狀況。當 Mf fD > D 時，新型相位頻率偵測器可視為
沒有動作，理由是當頻率誤差很大時，可利用速度迴路快速減少速度誤差，吾人無須調整
微小相位誤差量去調控速率變化。而當0 Mf f< D £ D 時，新型相位頻率偵測器之數學模型
如圖 4.4 所示，其中頻率偵測器之數學模型即如同減法器，虛擬相位偵測器之數學模型可
由(4.1)式獲得。若考慮脈波訊號 *( )qn rE 與 ( )qn rE 之相角差為為 12p e- 時，相位偵測器輸出
為 dK ，因此在此範圍相位偵測器之數學模型即可視為一常數增益，而其增益值為 2
dK
p
。 
 
sf
rf
sqD qDfD 2
Mf
p
D 2
dK
p
 
圖 4.4 新型相位頻率偵測器於0 Mf f< D £ D 時之數學模型 
 
當 0fD = 時，新型相位頻率偵測器即如同傳統鎖相迴路，其數學模型則如圖 4.5所示。 
接下來依據新型相位頻率偵測器之數學模型，新型鎖相迴路速度控制器同樣可依頻率
誤差( fD )的大小，分成三個工作區段，分別就 Mf fD > D 、0 Mf f< D £ D 與 0fD = 三種狀況
予以探討。 
 
 
 56 
sw wD 1
+Js B
rw
+ps isK s K
s
Tw
( )sC s ( )G s
 
圖 4.6 Mf fD > D 時之系統等效方塊圖 
因此由(4.7)建立之羅斯表為: 
2
0
                                         
                                    
                             
+
is
ps
is
s J K
s B K
s K
 
由羅斯穩定準則可得到此系統若要滿足第一行正負符號不變，則必須滿足(4.8)式 
0
  
is
ps
K
K B
>
> -
                                         (4.8) 
因此基本上只要速度比例積分控制器的增益 psK 及 isK 均大於零，即可達到系統穩定條件。 
2. 0 Mf f< D £ D 之情況 
當0 Mf f< D £ D 時，新型鎖相迴路速度控制器同時結合速度迴路控制器及相位迴路控
制器，因此系統方塊圖可以圖 4.7 表示之，此處相位迴路控制器採用領先補償(Lead 
Compensation)之架構。為方便分析，將圖 4.7的方塊圖予以化簡，首先將圖 4.7中電壓控制
震盪器與編碼器增益(
2
eK
p
)，經由訊號流程圖移到 fD 後方，得到等效方塊圖如圖 4.8。根據
圖 4.8可以得到速度迴路之比例積分控制器為 
( )
+
= ps iss
K s K
C s
s
                                 (4.9) 
相位迴路之領先補償器為 
 58 
sf fD
rf
sq
PT
Twsw wD 1
+Js B
rw
+ps isK s K
s
2
eK
p
2
eK
p
2
Mf
p
D
p
pp
p
S Z
K
S P
+
+2
dK
p
( )sC s ( )G s
rw
sqD
 
圖 4.7 0 Mf f< D £ D 時系統之方塊圖 
 
 
rw
sqD
PT
Twsw wD 1
+Js B
rw
+ps isK s K
s
2
eK
p
2
Mf
p
D
+
+
p
pp
p
s Z
K
s P2
dK
p
( )sC s ( )G s
rw
wD fD
1( )pC s
sq
 
圖 4.8 0 Mf f< D £ D 時將增益( 2
eK
p
)移至相位迴圈內之等效方塊圖 
 
 
因此由(4.13)式建立之羅斯表為： 
 60 
3. 0fD = 之情況 
    當 0fD = 時，命令脈波訊號 ( )qn sE 與編碼器脈波訊號 ( )qn rE 之剩下一相角差，若
假設控制器在縮小相位誤差的過程中 fD 變動量很小，則吾人可以利用重疊原理之觀念，將
系統視為轉速運轉在 sw 工作點上，而只需分析存在的相角誤差即可，其系統方塊圖如圖 4.10
所示。 
 
由圖 4.17可寫出其開迴路轉移函數如(4.15)式所示。 
2 2
( )
LoopGain
4 ( )( )
pp d e p
p
K K K s Z
s P Js Bsp
+
=
+ +
                       (4.15) 
因此這時之閉迴路特性方程式 ( )D s 為： 
3 2
2 2( ) ( ) ( )4 4
e d pp e d pp
p p p
K K K K K K
s Js P J B s P B s Z
p p
D = + + + + +       (4.16) 
因此由(4.16)式建立之羅斯表為： 
3
2
2
2
                                                                                            
4
                                                                         
4
e d pp
p
e d pp
p
K K K
s J P B
K K K
s P J B Z
p
p
+
+
2 2
0
2
( )( )
4 4                    
                                  
4
p
e d pp e d pp
p p p
p
e d pp
p
K K K K K K
P B P B J Z
s
P B
K K K
s Z
p p
p
+ + -
+
 
由於 eK 、 dK 、B及 J都大於零，若要滿足第一行正負符號不變，則相位迴路之比例積分控
制器必須滿足(4.17)式。 
2 2( )( ) 04 4
e d pp e d pp
p p p
K K K K K K
P J B P B J Z
p p
+ + - >                 (4.17) 
此處所建立的新型鎖相迴路速度控制器數學模型，將可做為控制器設計之依據，最後可總
結控制器參數設計滿足(4.8)式、(4.14)式及(4.17)式，則系統可達到穩定條件。 
4.3 控制器設計準則 
本節將提供新型鎖相迴路速度控制器參數之設計準則，並舉以一實際案例根據所提之 
 62 
(1) 速度迴路安定時間( 1t ) 
(2) 鎖相迴路安定時間( 2t ) 
(3) 相位安定時間( 3t ) 
由於新型鎖相迴路速度控制器採用雙迴路控制架構，以速度迴路控制器決定初期
的上升時間，接著以鎖相迴路控制器縮小細微的轉速誤差，最後達到鎖相的目的，
因此吾人可分配速度迴路控制器之安定時間 ( 1t )與相位迴路安定時間( 2 3t t+ )約為
7比 3。系統安定時間( st )等於速度迴路安定時間( 1t )、鎖相迴路安定時間( 2t )及相
位安定時間( 3t )之總合，故可得到安定時間之建議值如(4.18)式與(4.19)式所示。 
1 0.7 st t=                                    (4.18) 
2 3 0.3 st t t+ =                               (4.19) 
因此依據伺服系統所需的安定時間( st )可由(4.18)式、(4.19)式可獲得到新型鎖相迴
路速度控制器之響應規格之建議值。 
步驟三、控制器參數設計 
新型鎖相迴路速度控制器包含速度迴路比例積分控制器( psK 、 isK )、相位迴路領
先補償器( ppK 、 pZ 、 pP )、 MfD 與 LfD 共七個參數。吾人由步驟二制定之規格分別
設計各迴路控制器參數，其設計可分為三部份： 
(1) MfD 與 LfD  
    MfD 與 LfD 的選擇視系統而定，若伺服系統只使用速度控制器的最大穩態
誤差為 SEfD ，則可選擇 M SEf fD ³ D ，確保相位迴路控制器能夠正常運作， LfD 可
由頻率偵測器所能偵測的最小頻率誤差來決定。 
(2)速度迴路比例積分控制器( psK 、 isK ) 
 速度迴路控制器將以速度迴路安定時間( 1t )為設計目標，吾人採用極零點
對消之設計方法，因此速度迴路比例積分控制器可以(4.20)式表示。 
( )+ +
=ps is s
K s K Js Ba
s s
                        (4.20) 
其中 sa 為一速度迴路控制器參數，因此迴路增益 ( )SLGG s 為： 
( ) 1( )
( )
+
= ´ =
+
s
SLG s
aJs BG s a
s Js B s
               (4.21) 
而系統速度閉迴路增益 ( )SCLGG s 為：   
 64 
qD 1
+Js B
+
+
p
pp
p
s Z
K
s P
pT
2
dK
p
sf rw
2
eK
p
rf
rf
fD 2
Mf
p
D
sqD
 
圖 4.12 新型鎖相迴路速度控制系統於 2t 時間內之數學模型 
而圖 4.12之閉迴路增益 1( )PCLGG s 為：   
1
( ) 2( )
1 ( )
2
p
p
D
= =
+
+ +
D
p e d
LG M
PCLG
p e dLG
p
M
a K K
G s fG s a K KG s s P
f
            (4.27) 
因此吾人可由 2t 安定時間決定(4.27)式中的極點位置，而1/( )2
p e d
p
M
a K K
P
fp
+
D
即為
圖 4.12閉迴路系統中的時間常數，若以五倍閉迴路系統時間常數為 2t ，則可
得到(4.28)式。 
25 /( )2
p e d
p
M
a K K
P t
fp
+ =
D
                              (4.28) 
接下來考慮 3t 之時間區間內時，新型鎖相迴路速度控制即可視為圖 4.10，
由(4.15)式之開迴路增益為可得到圖 4.10之閉迴路增益為： 
2
2
2
2
( ) 4( )
1 ( )
4
p
p
= =
+ + +
p e d
PLG
PCLG
p e dPLG
p
a K K
G sG s a K KG s s P s
          (4.29) 
由(4.29)式特性方程式可得到圖 4.10之閉迴路系統極點： 
 
 66 
 
 
 
 
 
 68 
bsv
csv
asv
bsi
asi
rw
asi
bsi
IPMSM
*r
dsv
*r
qsv
*r
dsi
*r
qsi
, ,
    
  ,
as bs cs
ds qs
r
qsi
r
dsi
rq
csi
  ,
    
, ,
ds qs
as bs cs
     IMC
  Current
Controller
1
s
sqD
PT
Tw
sw wD
rf
+ps isK s K
s
2
eK
p
2
Mf
p
D
+
+
p
pp
p
s Z
K
s P2
dK
p
( )sC s
fD
( )pC s
sq
*T MTPA
Control
rwC
G I
G
PG
Current
Sensing
Circuit
csi
2
eK
p
rw
sfVCO
 
圖 4.14(a) 內嵌式永磁同步電動機新型鎖相迴路速度控制系統方塊圖 
 
 
 
1S
2S
3S
4S 6S
5S
Encoder
DCV
+
-
61~SS
61~PWMPWM
TMS320F2812
TMS320F2812  eZdsp
CPU
PWM module
A/D module
QEP module
DSP controller
4. D/A module
ai ci
GPIO
Lattice LFEC10E
FPGA
bi
 
圖 4.14(b) 內嵌式永磁同步電動機新型鎖相迴路速度控制系統實現架構圖 
 70 
向上數;反轉時為b領先a九十度，此時轉速編碼器的計數器為向下數，此外每旋轉一週會
產生一個脈波的方波訊號( z、z )，吾人可藉由 z方波訊號來決定轉子磁極的位置。a、b脈
波訊號提供給數位訊號處理器(DSP)之四象限轉速編碼器(QEP)單元做數位訊號處理，經過
轉速編碼器(QEP)單元後轉子每轉一週在 DSP 內的計數器將從零計數到八千。因為一週有
360 度所以其解析度為 360 除以八千，因此有很高的解析度，然而此三組脈波訊號可能會
因為電動機旋轉磁場的干擾或是類比電路的雜訊影響而造成轉速的估測誤差，這是因為如
果解碼器所產生的方波訊號雜訊過大將會使數位訊號處理器(DSP)之轉速解碼器(QEP)單元
產生誤判而影響轉速估測，所以在解碼器與數位訊號處理器(DSP)之間亦額外增加了一組介
面電路，如圖 4.16所示為a、a這組訊號處理之電路圖，而b、b和 z、 z 也相同。此介面
電路提供轉速解碼器(QEP)所需的 3.3伏特直流電壓，並且使用了三顆高速光耦合 IC-6N137
作為類比電路和數位電路之間的隔離電路，因為隔離了類比端和電動機端的雜訊，所以可
以獲得比較正確的轉速脈波。 
 
6N137
2
3
6
7
A
1K
470
+3.3V
8
5
a
a
0V
 
 
圖 4-16 轉速偵測電路 
 
3. 閘極隔離驅動電路 
在三相反流器驅動電路部分，由於部分開關元件(如 IGBT)不共地，因此以光耦合放大
器 TLP 250做為隔離驅動電路。如圖 4.17所示，因有六組相同原理之電路，故在此只舉一
組驅動電路做為說明。其由 DSP內建之脈波寬度調變模組產生之控制信 61 ~ PWMPWM ，
經光耦合放大器 TLP 250作為隔離驅動，再送至限流電阻以驅動 IGBT之用。 
 
 72 
 
控制器製作 
吾人之新型鎖相迴路控制器將以數位控制實現，數位控制具有下列諸多優點：(1) 系統
的穩定性提高，減少飄移；(2) 整合性強；(3) 使用之零件相對減少，維護容易，可大幅降
低維護成本；(4) 雜訊隔離能力強；(5) 容易更改控制法則，適合應用在開發階段之產品。
且微處理器工作頻率愈來愈快，雖然仍不若類比控制器快，但由於機械的響應緩慢，其應
用在機電整合領域上已將當足夠。 
吾人選用德州儀器公司(TI)之數位訊號處理器 TMS320F2812作為核心單元。其市場定
位於電力電子與電動機控制等領域，因此已內建脈波寬度調變(PWM)模組以及類比-數位轉
換器(ADC)等模組，故僅需簡易設定暫存器即可使用，其具有之特色如下所述： 
 
(1) 屬為 32位元之處理器。 
(2) 最高工作頻率為 150 MHz。 
(3) 有 16組脈波寬度調變(PWM)訊號。 
(4) 具有 16個通道的 12位元類比-數位轉換器。 
(5) 有七個計數器，包含三個 32位元處理器計數器(CPU Timer)與 
 四個 16位元通用計數器。 
(6) 有 6個捕捉單元(Capture Unit)，可切換為兩組 QEP。 
(7) 共有 56個 GPIO介面。 
(8) 具有 40kB的隨機存取記憶體(RAM)。 
(9) 周邊暫存器使用 C語言結構封裝，設定方便。 
 
圖 4.19為各週邊電路與數位訊號處理器之資料傳輸方塊圖，其中電流偵測電路偵測目
前輸入電動機的 a、c相電流大小後，即可透過 TMS320F2812數位訊號處理器內建之 ADC
將 0~3V之類比訊號，轉換成以二進位表示的數位訊號，分別儲存在兩組 12位元數位取樣
結果儲存器(ADCRESULT0、ADCRESULT1)中，以回授給電流控制器。編碼器產生之脈波
訊號經由光耦合電路可得到三組位置脈波訊號，透過數位訊號處理器內建的第一組 QEP，
偵測其中 a、b 相脈波訊號正/負邊緣，產生每轉 8000 次的脈波訊號，並觸發第二計數器
(T2CNT)，依據 a、b兩相脈波訊號超前或滯後關係，來判斷正轉或反轉。接著得到電動機
磁極位置，吾人先量測電動機磁極位置與編碼器 z 相脈波訊號之夾角，得知夾角大小後吾
人便可藉由 z相脈波訊號來矯正電動機之磁極位置，以供轉換參考座標之計算。 
 
 74 
 
圖 4.20程式流程圖 
 76 
量測轉速響應之穩態結果，其結果如圖 4.28、圖 4.29、圖 4.30及圖 4.31所示，圖中由上而下
分別為 sF、 rF與 PFD之輸出訊號，要特別說明的是吾人在此以數位邏輯訊號代表 PFD之輸出。
其結果皆可藉由鎖相迴路達到零頻率誤差。接著測試加載時之穩態轉速響應，吾人將負載電
動機外接電阻當成發電機使用。速度控制器分別下達 500rpm及 1000rpm之轉速命令，其結果
如圖 4.32及 4.33所示，即使在加載的情況下，依然可達到零頻率誤差之效果。 
 
 
圖 4.21 內嵌式永磁同步電動機驅動器硬體電路雛型 
 
 
圖 4.22 內嵌式永磁同步電動機機電模組 
 78 
6A
6A
r
dsi
r
qsi
 
圖 4.25以線性上升之轉矩命令產生的轉子座標直軸、交軸電流 
 
 
sw
200 secm
6A
r
dsi
rw
 239.7 
/ secrad
r
qsi
 
圖 4. 26轉速步階響應與轉子座標直軸電流、交軸電流 ( 239.7 / secs radw = ， 0N-mLoadT = ) 
 
 80 
500 secm
sF
rF
PFD
1-
1667Hz
 
圖 4. 29 無載下，轉速命令 1000rpm之鎖相結果(
sF =1667Hz,)  
 
 
100 secm
sF
rF
PFD
1-
3333Hz
 
圖 4. 30 無載下，轉速命令 2000rpm之鎖相結果( sF =3333Hz,) 
 
 82 
500 secm
sF
rF
PFD
1-
1667Hz
 
圖 4. 33 有載下，轉速命令 1000rpm之鎖相結果(
sF =1667Hz,) 
 
4.5 結論 
內嵌式永磁同步電動機擁有高效率、高功率密度之優點，因此非常適合應用在各種機
械驅動之領域。在加上近年來半導體技術快速發展，使功率半導體元件及數位訊號處理器
之價格不斷下降，性能卻不斷上升，使得實現向量控制控技術所需之硬體花費亦變的符合
經濟效益。精密控制為高科技產業界之基礎之ㄧ，凡舉半導體製程、化學、生物等領域的
生產過程必須依靠高精度之伺服控制，因此吾人選擇以鎖相迴路速度控制器作為本計畫之
研究基礎，並結合負載轉矩估測器作前饋補償，改善加載時之暫態響應，接著以提供一完
整之鎖相迴路速度控制器設計準則，作為實際應用於精密速度控制之解決方案。 
本計畫於第三章推導內嵌式永磁同步電動機之數學模型，並介紹內嵌式永磁同步電動
機之向量控制理論及單位安培最大轉矩控制策略，接著以負載轉矩前饋補償改善加載時之
暫態響應。接著在第四章中以模組化之方式規劃內嵌式永磁同步電動機驅動系統，將其分
為內嵌式永磁同步電動機、反流器及其閘極驅動電路、電流偵測電路、編碼器電路及 FPGA
電路部分，並以 DSP控制器為核心單元，整合各區塊電路之運作，最後針對所完成之實作
雛形系統進行實驗以驗證，以實驗結果驗證本計畫所提控制策略確實可行。 
 84 
第六章 計畫成果自評 
本子計畫除依計畫規劃目標完成強韌型鎖相式內模控制之直流無刷電機速度控制器及
永磁交流同步電動機強韌性高效率控制器外，於計畫執行期間在人才培育方面：參與學生
有碩士班七員已畢業，博士班一員已畢業，就學中博士班兩員。在專利部分：整合子計畫
一共同申請發明專利二件，分別為:『一種電機參數及轉子位置信號估測方法』發明專利申
請，案號：096101364，及『一種鎖相式速度控制裝置』 發明專利申請，案號：094105968。
於著作方面：發表 IEEE 國際期刊論文兩篇、國際研討會論文一篇及國內研討會論文十篇，
另有一篇 IEEE 國際期刊論文已投稿，正接受審稿委員建議修稿中。著作明細如下： 
 
1. Ching-Tsai Pan and Shinn-Ming Sue, “A Linear Maximum Torque Per Ampere Control for 
IPMSM Drives Over Full Speed Range,” IEEE Transactions on Energy Conversion, vol. 20, 
no. 2, pp. 359-366, Jun. 2005. 
2. Shinn-Ming Sue and Ching-Tsai Pan, “Voltage-Constraint-Tracking Based Field-Weakening 
Control of IPM Synchronous Motor Drives,” accepted by IEEE TIE, Sept. 2007. 
3. Ching-Tsai Pan and Emily Fang, “A Phase-Locked Loop Assisted Internal Model Adjustable 
Speed Controller for BLDC Motors,” submitted to IEEE TIE, Aug. 2007.(under revised) 
4. Shinn-Ming Sue, Ching-Tsai Pan, and Yuan-Chuen Hwang, “A New Field-Weakening 
Control Scheme for Surface Mounted Permanent-Magnet Synchronous Motor Drives,” in 
Proceeding of the 2nd IEEE Conference on Industrial Electronics and Applications, May 
2007, pp. 1515-1520. 
5. X. G. Zhong, G. Y. Cai, Z. X. Lin and Ching-Tsai Pan, 2005, “A Novel RFOC Sensorless 
Induction Motor Drive,” Proceedings of the 4th Symposium on Taiwan Power Electronics , 
pp.122-125. 
6. Tai-Long Tang and Ching-Tsai Pan, 2005, “A Fixed Structure Sliding Mode Position 
Controller for Linear Permanent Magnet Synchronous Motors with Load Disturbance 
Feedforward Controller,” Proceedings of the 4th Symposium on Taiwan Power Electronics , 
pp.13-17. 
7. Emily Fang and Ching-Tsai Pan, 2005, “A Novel IPMSM for Speed Sensorless Drives,” 
Proceedings of the 26th Symposium on Electrical Power Engineering, pp.641-645. 
8. Ting-Yu Chang, Emily Fang and Ching-Tsai Pan, 2005, “Implementation of a Speed 
Sensorless Drive for Permanent Magnet AC Motor, ” Proceedings of the 26th Symposium on 
Electrical Power Engineering, pp.342-345. 
 86 
參考文獻 
[1]  S. Rajagopalan, J. M. Aller, J. A. Restrepo, T. G. Habetler and R. G. Harley, 
“Analytical-Wavelet-Ridge-Based Detection of Dynamic Eccentricity in Brushless Direct 
Current (BLDC) Motors Functioning Under Dynamic Operating Conditions,” IEEE Trans. 
Ind. Electron., vol. 54, no. 3, pp. 1410-1419, June 2007. 
[2] C. Cavallaro, A. O. D. Tommaso, R. Miceli, A. Raciti, G. R. Galluzzo and M. Trapanese, 
“Efficiency Enhancement of Permanent-Magnet Synchronous Motor Drives by Online Loss 
Minimization Approaches,” IEEE Trans. Ind. Electron., vol. 52, no. 4, pp. 1153-1160, Aug. 
2005. 
[3] A. A. Aboulnaga, P. C. Desai, F. Rodriguez, T. R. Cooke and A. Emadi, “A Novel, Low-Cost, 
High-Performance Single-Phase Adjustable-Speed Motor Drive Using PM Brush-Less DC 
Machine: IIT's Design for 2003 Future Energy Challenge,” in 2004 Proc. IEEE APEC Conf., 
pp. 1595-1603. 
[4] M. Naidu, T. W. Nehl, S. Gopalakrishnan and L. Wurth, “Keeping Cool While Saving Space 
and Money: A Semi-Integrated, Sensorless PM Brushless Drive for a 42-V Automotive 
HVAC Compressor,” IEEE Ind. Appl. Magazine, vol. 11, no. 4, pp. 20-28, July/Aug. 2005. 
[5] I. L. Chien and P. S. Fruehauf, “Consider IMC Tuning to Improve Controller Performance,” 
Chem. Eng. Progress, vol. 86, no. 10, pp. 33-41, Oct., 1990. 
[6] Qing-Guo Wang, Qiang Bi and Yong Zhang, “Partial Internal Model Control,” IEEE Trans. 
Ind. Electron., vol. 48, no. 5, pp. 976-982, Oct. 2001. 
[7] L. Harnefors and Hans-Peter Nee, “Model-Based Current Control of AC Machines Using the 
Internal Model Control Method,” IEEE Trans. Ind. Electron., vol. 34, no. 1, pp. 133-141, 
Jan./Feb. 1998. 
[8] R. E. Best, Phase-Locked Loop Design, Simulation & Applications, The McGraw-Hall 
International, Taipei, 2003, pp.109-114. 
[9] S. Pavljasevic and F. Dawson, “Synchronization to Disturbed Utility-Network Signals Using 
a Multirate Phase-Locked Loop,” IEEE Trans. Ind. Electron., vol. 53, no. 5, pp. 1410-1417, 
Oct. 2006. 
[10] L. G. B. Rolim, D. R. da Costa Jr. and M. Aredes , “Analysis and Software Implementation 
of a Robust Synchronizing PLL Circuit Based on the pq Theory,” IEEE Trans. Ind. Electron., 
vol. 53, no. 6, pp. 1919-1926, Dec. 2006. 
[11] Ching-Tsai Pan and Shinn-Ming Sue, “A Linear Maximum Torque Per Ampere Control for 
