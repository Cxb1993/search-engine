  
                                         共 31 頁   第 2 頁 
FPGA. Finally, an experimental system of XYZ table is set-up to evaluate the constructed 
motion control IC. 
Keywords: Motion control IC, Fully closed-loop control, PMSM, Self-tuning 
neural-network controller, FPGA, XYZ table. 
  
一、 緣由與目的： 
 
全數位化平台驅動控制器系統，已蔚然成為一種運動控制器之主流，而常見
於自動化機具、雷射切割機、點膠機、倉儲設備、半導體廠設備、X-Y 平台、零
件抓取機、運輸系統、表面處理廠、3D 工作機…的場所中。近年來，文獻中有
關於平台之驅動控制技術也引起廣泛之研究[1-14]。常見的平台驅動由一顆馬達
帶動滾珠導螺導運轉，使得轉轉運動變成直線運動，以帶動平台移動。而平台位
置控制方法中，又分為半閉迴路伺服控制器系統及全閉迴路伺服控制器系統兩種，此
兩種控制器架構描述如下： 
(1) 半閉迴路伺服控制器系統： 
控制器架構如圖 1 所示，其中平台上沒有位置感測器，僅利用馬達尾端之光編
碼器間接計算平台位置，作為位置迴授值以進行閉迴路控制。因此稱為半閉迴
路伺服控制系統。然而，轉動馬達及平台間之機械結構，例如：齒輪、導螺桿
等，這些結構引入的一些問題；譬如背隙(backlash)造成的定位不精確、摩擦
力的增加、導螺桿之導程誤差、因此將造成能量損失、故障率高、控制不易
精準。 
(2) 全閉迴路伺服控制器系統： 
控制器架構如圖 2 所示，其中平台上具有位置感測器，可直接量測平台位置，
作為位置迴授值以進行閉迴路控制。因此稱為全閉迴路伺服控制系統。此系統將
機械結構體之非線性問題，如背隙、摩擦力及導螺桿之導程誤差等含在內，因
此控制上較精準，但是控制的困難度較高。 
Motion Table 
rSVPWM
PI
PI
rfxv
rfyv
rfzv
ai
wici
*
qi
*
di



v
v
dv
qv
Z
3-Phase
inverter
PWM1
PWM2
PWM3
PWM4
PWM5
PWM6
Current
detector
ui
U
V
W
qi
di

Encoder
detector & 
Transform.
-
Rectifier
 
AC
A/D
bi
1
Modified 
Clarke1Park
Park Clarke
A
B
,
,
cba ,,
cba ,,
,
qd,
,
qd,
Sin&Cos
= 0
LPF
A/D LPF
αi
βi
Full digital implementation
e Comparator
Circuit
To x-axis or 
y-axis PMSM
Signal from 
Rotary Encoder
+
-
1-z-1
vK
u
Intelligent
controller
*
px Reference 
Model
+
_
e
Position loop using Intelligent Controller
and Speed loop using PI controller
px
mx
pxTrajectory
Planning
Position 
command
Current loop 
using vector control
PMSM
px
 
圖 1.單軸平台半閉迴路伺服控制器系統架構圖 
  
                                         共 31 頁   第 4 頁 
語意控制能力，使控制器不僅具有人類思維經驗，又具有學習能力，足以應付機
電整合中複雜之授控系統及多變化之外界環境，以提高整個驅動系統較佳之動態
特性。由圖 2 所知，平台控制器之全閉迴路伺服控制為具有高度非線性現像，應用
智慧型控制器以提高平台位置控置的精準度及增加控制器之穩健性，是非常重要
之議題。 
與 DSP 晶片比較，由於 FPGA 具有硬體可程式化、快速時間推到市場、短的
設計週期、嵌入式微處理器、低電力消耗及高密度容量，因此極適合數位系統之
實現[33]。FPGA 提供一種介於特殊 ASIC (application specified integrated circuit)
硬體與一般功能處理器之元件[34]。因此，很多應用在換流器及馬達控制電路
[35-49]上，如 Y.T. Tzou [35] 及 Z. Zhou [36]個別以 FPGA 實現三相換流器之空間
向量 PWM。 Z. Zhou [36] 及 T. Takshashi [40] 提出以 FPGA 實現永磁同步馬達之
速度控制器。M.F. Tsai [36]應用 CPLD 實現馬達用方波編碼器及計數器之介面晶
片；D. Carrica [45] 以 FPGA 為基礎實現步進馬達控制器；Y.S. Kung[47]則結合
DSP 與 FPGA 晶片建構高性能永磁同步馬達駆動控制器，其中 DSP 晶片發展智慧
型速度控制器而 FPGA 晶片發展電流控制器。C.H. Fang [44] 以 FPGA 為基礎設
計永磁同步馬達之滑動模式控制策略。F.J. Lin [38] 展示以 FPGA 來發展線性馬
達之模糊滑動模式控制器。不管如何，上述研究，僅利用 FPGA 之數位硬體來進
行換流器及馬達控制電路簡單計算，而無法處理複雜之控制法則，使得駆動器整
體數位控制電路無法整合在一顆晶片，晶片加值功效減低。然而近年來，FPGA
晶片可嵌入一顆 NiosII 多核心處理器以形成 SOPC 設計環境，因此使用者發展之
應用 IP 及 NiosII 多核心處理器 IP 可共同下載到 FPGA 晶片內，以提供使用者進
行軟硬體共同設計。電路需要快速計算但不複雜者，可在 FPGA 以硬體實現；而
計算法則複雜但不需太快者，可在 NiosII 以多顆處理器實現。以軟硬體共同設計
之方式，增加可程式設計能力、使數位系統設計更具彈性、可減少系統發展時間
及加強系統性能。文獻中不乏以 DSP 晶片研究 XY 平台(旋轉型馬達或線型馬達
驅動)之伺服控制器及其控制方法[3]，但因 DSP 晶片僅極限可整合兩軸馬達控制
器的能力，因此無法應用到三軸 XYZ 平台之運動控制上。 
因此有鑑於 FPGA 晶片之優點及可嵌入一顆 NiosII 多處理器，本計畫引入
並用來研製發展三軸 XYZ 平台運動控制晶片之軟硬體設計技術。此 XYZ 平台由
參顆永磁同步馬達帶動滾珠導螺桿運動，平台上具有線性尺以迴饋平台實際移動
位置，來進行全閉迴路控制。而 XYZ 平台之運動控制晶片為本計畫發展之核心；
此晶片內將執行三組永磁同步馬達之電流控制器、三組平台之位置及速度控制器
及一組運動軌跡控制器之功能。各組電流控制器採向量控制，各組位置控制器採
智慧型控制以解決系統參數未確定性及外界負載干擾問題，而運動軌跡控制器將
執行 XYZ 平台一維、二維及三維運動軌跡之計算。 
 
  
                                         共 31 頁   第 6 頁 
其中  
ft
PK 
4
3  (4) 
進一步考量平台之機械機構，則平台的動態機械方程式下： 
dt
dx
r
B
dt
xd
r
JTT pm
p
mLe
 22
2
2
  (5) 
其中 Te 是馬達的推力，Kt 是力的常數，Jm 是總慣性值，Bm 是黏滯摩擦係數，TL
是外部的力量而 r 滾珠螺桿之導程。 
2.2 平台位置迴路自調式類神經 PID 控制器： 
XYZ 平台每軸之位置控制器採用自調式類神經 PID 控制器，如圖 4 所示。
此控制器包括一組參考模式、一組 PID 控制器及一組徑向基底函數類神經網路。
各模組功能詳細說明如下：   
*
px Reference 
Model
(RM)
tK
mm BsJ 
1
*
qi
X-axis table drive system
eF
LF

s
1
px
vK
px
mx
+
_
11  z

_
RBF
Neural Network
+
_
PID controller
rbfx
nne
Adjusting Mechanism
ue
Jacobian
11  Z
1Z
u
2Z
Auto tuning of PID controller based on NN
2
r
 
圖 4. 單軸平台自調式類神經 PID 控制器系統 
A. 參考模型 
二階系統常常被當作參考模型被使用在適應性控制系統，因此圖 4 中所使用
的參考模型之轉移函數如下: 
22
2
* 2)(
)(
nn
n
p
m
sssx
sx


  (6) 
其中 n 為自然頻率(Natural frequency)，ξ 為阻尼係數，接著透過雙線型轉換可以
將一個連續模型(6)式轉換成一個離散模型如下式： 
2
2
1
1
2
2
1
10
1*
1
1)(
)(






zbzb
zazaa
zx
zx
p
m  (7) 
再將(7)式寫成差分方程式： 
)2()1()()2()1()( *2
*
1
*
021  kxakxa kxakxbkxbkx pppmmm  (8) 
  
                                         共 31 頁   第 8 頁 
)(
)()(
)()()()()1( 3
2
kb
kckX
khkwkekbkb
j
j
jjnnjj
   (16) 
式子中為學習率，j 為第 j 個神經元，而 i 為第 i 個中心值。 

)(ku
)1( kxp
)2( kxp
rbfx
1w
2w
1h
mw
2h
mh
Input layer Hidden layer Output layer
)(kxp
nne +
-
 
圖 5. RBF 類神經網路 
D.參數調整機構 
定義參數性能指標為 
22 ))()((
2
1)(
2
1)( kxkxkekE rbfp   (17) 
利用最陡坡降法可得: 
))1()(()( 

 keke
u
x
ke
k
Ek p
p
p   (18) 
)()( ke
u
x
ke
k
Ek p
i
i 

   (19) 
))2()1(2)(()( 

 kekeke
u
x
ke 
k
Ek p
d
d    (20) 
在式子(18)~(20)式中 為學習率，
u
xe

 稱為Jacobian 計算式，可利用類神經網路
來辨識而得，如下： 




 m
j j
j
jj
rbfp
b
kuc
hw
u
x
u
x
1
2
1 )(  (21) 
 
 
  
                                         共 31 頁   第 10 頁 
2.3.2 平面圖形 
    常見的運動軌跡如圓形軌跡和窗形軌跡。這些運動軌跡將作為 XYZ 平台控
制器之性能測試使用。 
(a) 圓形軌跡 
   圓形軌跡如圖 6 所示，圓形軌跡方程式如下： 
1
sin( )
cos( )
i i
i i
i i
x r
y r
  


  


                  (29) 
其中  為角度變化量； r 為圓半徑； ix 為 X 軸命令軌跡； iy 為 Y 軸命令軌跡；
經由上述之軌跡方程式，隨時間經過角度累加即可產生圓形軌跡，而由  的大
小可改變轉子運動的速度。 
y
r
( , )i ix y
1 1( , )i ix y 

1i i    
0 0( , )x y x
Start
 
  圖 6. 圓形軌跡 
(b) 窗形軌跡 
   窗形軌跡規劃如圖 7 所示，窗形軌跡方程式可以分成 9 個部份，窗形軌跡方
程式如下： 
1i i      
a 軌跡： 1 1,i i i ix x y S y      (30) 
b 軌跡： 6( : 2 )
4i
    
1 1cos( ), sin( )i x i i y ix O r y O r       (31) 
c 軌跡： 1 1,i i i ix S x y y      (32) 
d 軌跡： 6( : )
4i
    
  
                                         共 31 頁   第 12 頁 
2.3.3 立體 3D 圖形 
(a)螺旋形軌跡 
   螺旋軌跡如圖 8 所示，螺旋軌跡方程式如下： 
1
1
sin( )
cos( )
i i
i i
i i
i i
x r
y r
z s z
  




  


 
 (39) 
螺旋軌跡之 X 和 Y 軸命令和平面圓形相同，Z 軸命令方程式中，S 為位置增加量；
ix 為 X 軸命令軌跡； iy 為 Y 軸命令軌跡； iz 為 Z 軸命令軌跡；經由上述之軌跡方
程式，隨時間經過角度累加即可產生螺旋軌跡。 
 
2 4
6 8
10
12 14
20
40
60
80
100
120
140
0
2
4
6
8
10 命令
回授
Position (mm) Position (mm)
Position (mm)
0 0
0 0
0
0 0
0
0
0
0
0
 
圖 8. 螺旋軌跡 
 
2.4 三軸 XYZ 平台運動控制晶片設計：  
此三軸 XYZ 平台全閉迴路運動控制晶片實現方式有兩種： 
(1) Case-1:三軸 XYZ 平台的位置迴路/速度迴路/電流迴路以硬體實現，而運動軌
跡規劃在 Nios II 內以軟體實現。 
(2) Case-2:三軸 XYZ 平台的電流迴路以硬體實現，而三軸 XYZ 平台的位置迴路/
速路迴路及運動軌跡規劃計算各自應用一顆 CPU 共 3 顆在 Nios II 內以軟體實
現。 
 
2.4.1 Case-1: 三軸 XYZ 平台的位置迴路/速度迴路/電流迴路以硬體實現，而運動
軌跡規劃在 Nios II 內以軟體實現，如圖 9 所示 
 
XYZ 平台運動控制晶片內部架構如圖 9 所示。FPGA 晶片採用 Altera Stratix II 
  
                                         共 31 頁   第 14 頁 
+
-
1-z-1
vK
u
Intelligent
controller
*
px Reference 
Model
e+
_
mx rSVPWM
PI
PI
rfxv
rfyv
rfzv
ai
wici
*
qi
*
di



v
v
dv
qv
Z
3-Phase
inverter
PWM1
PWM2
PWM3
PWM4
PWM5
PWM6
Current
detector
ui
U
V
W
qi
di

Encoder
detector & 
Transform.
-
Rectifier
 
AC
A/D
bi
1
Modified 
Clarke1Park
Park Clarke
A
B
,
,
cba ,,
cba ,,
,
qd,
,
qd,
Sin&Cos
= 0
LPF
A/D LPF
Current loop controller
αi
βi
px
e Comparator
Circuit
Z
-A
B
Comparator
Circuit
To x-axis 
PMSM
Signal from x-axis 
Rotary Encoder
Signal from x-axis
Linear EncoderEncoder
detector & 
Transform.
Nios-II processor
FPGA
X-axis
+
-
1-z-1
vK
u
Intelligent
controller
*
py Reference 
Model
e+
_
my rSVPWM
PI
PI
rfxv
rfyv
rfzv
ai
wici
*
qi
*
di



v
v
dv
qv
Z
3-Phase
inverter
PWM1
PWM2
PWM3
PWM4
PWM5
PWM6
Current
detector
ui
U
V
W
qi
di

Encoder
detector & 
Transform.
-
Rectifier
 
AC
A/D
bi
1
Modified 
Clarke1Park
Park Clarke
A
B
,
,
cba ,,
cba ,,
,
qd,
,
qd,
Sin&Cos
= 0
LPF
A/D LPF
Current loop controller
αi
βi
py
e Comparator
Circuit
Z
-A
B
Comparator
Circuit
To y-axis 
PMSM
Signal from y-axis  
Rotary Encoder
Signal from y-axis
Linear Encoder
Encoder
detector & 
Transform.
Position / Speed loop controller
+
-
1-z-1
vK
u
Intelligent
controller
*
pz Reference 
Model
e+
_
mz rSVPWM
PI
PI
rfxv
rfyv
rfzv
ai
wici
*
qi
*
di



v
v
dv
qv
Z
3-Phase
inverter
PWM1
PWM2
PWM3
PWM4
PWM5
PWM6
Current
detector
ui
U
V
W
qi
di

Encoder
detector & 
Transform.
-
Rectifier
 
AC
A/D
bi
1
Modified 
Clarke1Park
Park Clarke
A
B
,
,
cba ,,
cba ,,
,
qd,
,
qd,
Sin&Cos
= 0
LPF
A/D LPF
Current loop controller
αi
βi
e Comparator
Circuit
To z-axis 
PMSM
Signal from z-axis  
Rotary Encoder
Position / Speed loop controller
pz
Position / Speed loop controller
Y-axis
Z-axis
 
圖 10. XYZ 平台運動控制晶片之內部結構 
+
-
x
x
+
x
+
x
s0 s1 s2 s3 s4 s5
x
+
-
+
-
s6
+
-
+
-
s7 s8
)(* kx p
)( 1kx p 
)( 1kxm 
)(k v
)1( ke
0a
1a
2a
1b 2b
s9
Computation of the reference model output Computation of the velocity, 
position error and error change   
s15~s76 s77 s79 s80 s82 s83 s87s81 s84
Computation of RBF NN
s10 s11 s12
)(ke
)(* 1kx p 
)(* 2kx p 
)( 2kxm 
)(kxm
)(kx p
s85 s86
x
pk
x
dk
+
x
ik
)(ke
+
)(kui
)1( kui
+
)(ku p
)(kud
)(ku
Position PID controller
+
)(k v
-
x
vk
s13 s14
*
qi
Speed P controller
+
)1( ku
)(ku-
)(ku
)(kxp
)1( kxp
Neuro-1
computation
Neuro-2
computation
Neuro-3
computation
+
out1
out2
out3
J1
J2
J3
+
+
rbfx
+ Jaco
s78
+
x
)(ke
-
)1( ke

x
Je
x +
)1( kk p
)(kk p
x
)(ke
+
)1( kki
)(kki
de
+
)1( ke
de
-
+
)2( ke
x +
)1( kkd
)(kkd
Tuning of the PID controller gains  
圖 11. 以 FSM 方式實現位置自調式類神經 PID 控制器及速度比例控制器 IP 
  
                                         共 31 頁   第 16 頁 
Fix and simple computation but high computation 
bandwidth (16kHz, PWM circuit: ~Mhz) 
Complex computation but low 
computation bandwidth (1KHz)
Multiprocessor IP for three axis’ position and 
speed controller which is implemented by software
Application IP for three axis’ current controller
Which is implemented by hardware
Four CPU used here
CPU-1
- trajectory computation
- send the position 
command  to
CPU-2 ~CPU-4 
- communication with 
external device
CPU-2 ~CPU-4
- position loop and 
speed loop controller
for x-, y-, and z-table
respectively 
- receive the position
command from CPU-1
- send the current 
command to position IP
Current loopPosition loop Speed loop Inverter
DC
PWM*6
QEP
Encoder
θ
Position measurement module
Speed measurement module
Position cmd
Current loopPosition loop Speed loop Inverter
DC
PWM*6
QEP
Encoder
θ
Position measurement module
Speed measurement module
Position cmd
Current loopPosition loop Speed loop Inverter
DC
PWM*6
QEP
Encoder
θ
Position measurement module
Speed measurement module
Position cmd
software hardware
Equation
Calculation
Trajectory
Calculation
Avalon
bus
CPU-1
Linear Encoder
Motor power
Motor power
Motor power
Linear Encoder
NIOS II Processor
CPU-2 for x- table
CPU-3 for y- table
CPU-4 for z- table
XYZ table
External
memory
PC
Multiprocessor-based Motion Control IC for XYZ table
using FPGA 
 
圖 12. 在 FPGA 晶片內以多處理器為基礎之 XYZ 平台運動控制晶片(三軸平台的
電流迴路以硬體實現，而三軸平台的位置迴路/速路迴路/運動軌跡規劃在
Nios II 之四顆 CPU 內以軟體實現) 
 記憶體空間配置與資源共享 
    在多處理器系統下，有很重要的一點就是記憶體空間的配置，它可以使原本
單一使用的記憶體空間分割規劃提供各處理器使用。在早期的 Nios 系統裡，記
憶體配置相當的困難，尤其是外部的記憶體(SRAM)，不容易將想規劃的空間直
接設定在記憶體配置上，只能退而求其次，運用晶片本身所擁有的 64k On-chip 
RAM，將所撰寫的 c 語言程式下載到此區域，由於空間有限，因此程式設計上困
難度又增加了許多。而新一代的系統，可以更便利的使用內部的設定去修改記憶
體配置的空間，如圖 13 所示，以三個處理器為例，個別配置一個記憶體空間提
供各個處理器存放程式，可以針對所需要的空間大小，分配給各處理器使用。 
 
圖 13. 記憶體分配 
  
                                         共 31 頁   第 18 頁 
X-軸位置迴路計算 y-軸位置迴路計算
4
Z-軸位置迴路計算
X-軸速度迴路計算 y-軸速度迴路計算 Z-軸速度迴路計算
X-軸速度命令送出 y-軸速度命令送出 Z-軸速度命令送出
 
圖 15. 多 CPU 之動作流程圖 
 
 
2.5 實驗系統與實驗結果： 
 
2.5.1 實驗系統:  
XYZ 平台伺服運動控制器之實驗系統架構如圖 16 及圖 17 所示，此實驗系
統包括一台 XYZ 平台(每單軸平台由一顆永磁線型同步馬達驅動導螺桿所組
成)、三組馬達驅動板、一組以 FPGA 晶片為基礎之伺服控制板及一台個人電腦。
FPGA 晶片乃系統核心，其中平台之運動軌跡(如點對點、直線、圓、窗形等之
功能)，二維及三維軌跡之計算在 NiosII 處理器內以軟體實現；而三組永磁線型
同步馬達之電流與向量控制之計算-包括兩組(12 線) PWM 輸出、兩組(4 線)QEP
輸入、兩組座標轉換、向量控制、SVPWM 信號計算輸出;及三組平台之位置與
速度控制器法則之計算將以數位硬體實現。NiosII 嵌入式軟核心處理器內主要以
C 語言撰寫，而硬體電路主要以 VHDL 語言描述。圖 16 之各元件功能說明如下： 
 XYZ 平台：本計畫使用之 XYZ 平台，其實體圖如圖 16(a)所示。各單軸平台
由永磁同步馬達驅動滾珠導螺桿組成。永磁同步馬達將驅動滾珠導螺桿運
轉，使旋轉運動轉換為線型移動。永磁同步馬達之電力、額定電壓、額定電
流及額定速度各自為 300W、90V、10A 及 2500rpm。永磁同步馬達後端連
結一顆旋轉型光學編碼器，以偵測馬達之電氣角度。X 平台及 Y 平台上有光
學線性尺作為平台位置迴授。光學線性尺之解析度為 5m。滾珠導螺桿之行
程為 300mm，導程為 5mm。XYZ 平台之行程為 300mm x 300mm x150 m。Z
平台沒有光學尺，平台位置僅由馬達尾端之光編碼器間接計算獲得，因此屬
  
                                         共 31 頁   第 20 頁 
IPM
PS21265-AP
UP VP WP UN VN WN
邏輯保護電路
光耦合
FPGA motion controller
PWM1  ~  PWM6
U
V
W
PMSM
Current 
sensor
低通濾波器
AD1 AD2
比較電路
Rotary 
Encoder
QEP1~QEP3   QEP4~QEP6
L
C
整流器
交流
來源
P
N
低通濾波器
Motion Table 
Linear 
Encoder
ADC
ADC
 
圖 17. 單軸換流器之電路架構圖 
 
  
2.5.2 實驗結果： 
 
實驗中，電流迴路之取樣頻率為 16 kHz，而速度及位置迴路之取樣頻率為 2 
kHz。為驗證本計畫所提之 XYZ 平台運動控制器正確性及有效性，在軌跡追蹤中
2-D 之運動部分選用圓形及窗形軌跡，而在 3-D 之運動部分則採用螺旋軌跡，並
利用 PID 控制器與自調式類神經 PID 控制器來追蹤運動軌跡。為了比較其效能。
訂定性能指標參考，定義如下： 
1
( ) /
n
k
m T k n

  (40) 
在式子(40)中 
2 2( ) ( ) ( )x yT k T k T k   (41) 
( ) ( ) ( )i mi iT k d k d k  ， ,i x y  (42) 
2
1
( ( ) ) /
n
s
k
T T k m n

   (43) 
在式子中m為追隨誤差平均值、n為取樣數、 ( )iT k 為各軸命令與回授值之誤差、 ( )mid k
為各軸命令、 ( )id k 為各軸回授值與 Ts追隨誤差之標準差。 
在 2-D 之運動實驗中，以圓形運動軌跡及窗形運動軌跡來評估所提運動控制晶
片之動態性能。在 X-Y 平台使用 PID 控制器及使用自調式類神經 PID 控制器之
圓形及窗形運動軌跡追蹤實驗結果各自如圖 18~21 所示。在採用 PID 控制時，控
  
                                         共 31 頁   第 22 頁 
-20 0 20 40 60 80 100 120
-20
0
20
40
60
80
100
120
(mm)
(m
m
)
0 2 4 6 8 10 12
-50
0
50
100
150
Time (s)
X 
ax
is
 P
os
iti
on
 (m
m
)
0 2 4 6 8 10 12
-5
0
5
Time (s)
X 
ax
is
 e
rr
or
 (m
m
)
0 2 4 6 8 10 12
-50
0
50
100
150
Time (s)
Y 
ax
is
 P
os
iti
on
 (m
m
)
0 2 4 6 8 10 12
-5
0
5
Time (s)
Y 
ax
is
 e
rr
oe
(m
m
)
0 2 4 6 8 10 12
-1
0
1
Time (s)
iq
X 
ax
is
 (A
)
0 2 4 6 8 10 12
-1
0
1
Time (s)
iq
Y 
ax
is
 (A
)
(a) (b)
(c) (d)
(m
m
)
X 
ax
is
 P
os
iti
on
 (m
m
)
X 
ax
is
 e
rr
or
 (m
m
)
Y 
ax
is
 P
os
iti
on
 (m
m
)
Y 
ax
is
 e
rr
oe
(m
m
)
iq
X 
ax
is
 (A
)
iq
Y 
ax
is
 (A
)
 
圖 19. 自調式類神經 PID 控制器之圓形運動軌跡追蹤(a) 圓形軌跡響應(b)
各軸控制力(c)各軸軌跡響應(d)各軸追蹤誤差量 
 
-20 0 20 40 60 80 100 120
-20
0
20
40
60
80
100
120
(mm)
(m
m
)
0 5 10 15
-50
0
50
100
150
Time (s)
X
 a
xi
s 
Po
si
tio
n 
(m
m
)
0 5 10 15
-5
0
5
Time (s)
X 
ax
is
 e
rro
r (
m
m
)
0 5 10 15
-50
0
50
100
150
Time (s)
Y
 a
xi
s 
P
os
iti
on
 (m
m
)
0 5 10 15
-5
0
5
Time (s)
Y 
ax
is
 e
rr
oe
(m
m
)
0 5 10 15
-1
0
1
Time (s)
iq
X
 a
xi
s 
(A
)
0 5 10 15
-1
0
1
Time (s)
iq
Y 
ax
is
 (A
)
(a) (b)
(c) (d)
(m
m
)
X
 a
xi
s 
Po
si
tio
n 
(m
m
)
X 
ax
is
 e
rro
r (
m
m
)
Y
 a
xi
s 
P
os
iti
on
 (m
m
)
Y 
ax
is
 e
rr
oe
(m
m
)
iq
X
 a
xi
s 
(A
)
iq
Y 
ax
is
 (A
)
   
圖 20. PID控制器之窗形軌跡追蹤響應(a) 窗形軌跡響應(b)各軸控制力(c)
各軸軌跡響應(d)各軸追蹤誤差量 
  
                                         共 31 頁   第 24 頁 
 
-100
0
100
200
-100
0
100
200
0
20
40
60
80
100
mmmm
m
m
0 5 10 15 20
-1
0
1
Time (s)
iq
X 
ax
is
 (A
)
0 5 10 15 20
-1
0
1
Time (s)
iq
Y 
ax
is
 (A
)
0 5 10 15 20
-0.5
0
0.5
Time (s)
iq
Z 
ax
is
 (A
)
(a) (b)
m
m
iq
X 
ax
is
 (A
)
iq
Y 
ax
is
 (A
)
iq
Z 
ax
is
 (A
)
m
m
iq
X 
ax
is
 (A
)
iq
Y 
ax
is
 (A
)
iq
Z 
ax
is
 (A
)
  
0 5 10 15 20
-50
0
50
100
150
Time (s)X
 a
xi
s 
Po
si
tio
n 
(m
m
)
0 5 10 15 20
-50
0
50
100
150
Time (s)Y
 a
xi
s 
Po
si
tio
n 
(m
m
)
0 5 10 15 20
-50
0
50
100
150
Time (s)
Z 
ax
is
 P
os
iti
on
 (m
m
)
0 5 10 15 20
-5
0
5
Time (s)
X 
ax
is
 e
rro
r (
m
m
)
0 5 10 15 20
-5
0
5
Time (s)
Y 
ax
is
 e
rr
or
 (m
m
)
0 5 10 15 20
-1
0
1
Time (s)
Z 
ax
is
 e
rro
r (
m
m
)
(c) (d)
X 
ax
is
 P
os
iti
on
 (m
m
)
Y 
ax
is
 P
os
iti
on
 (m
m
)
Z 
ax
is
 P
os
iti
on
 (m
m
)
X 
ax
is
 e
rro
r (
m
m
)
Y 
ax
is
 e
rr
or
 (m
m
)
Z 
ax
is
 e
rro
r (
m
m
)
X 
ax
is
 P
os
iti
on
 (m
m
)
Y 
ax
is
 P
os
iti
on
 (m
m
)
Z 
ax
is
 P
os
iti
on
 (m
m
)
X 
ax
is
 e
rro
r (
m
m
)
Y 
ax
is
 e
rr
or
 (m
m
)
Z 
ax
is
 e
rro
r (
m
m
)
  
圖 22. PID 控制器之螺旋軌跡追蹤響應(a)螺旋軌跡響應(b)各軸控制力
(c)各軸軌跡響應 (d)各軸追蹤誤差量 
  
                                         共 31 頁   第 26 頁 
在 FPGA 內以硬體實現。因此整體功能由單一顆 FPGA 以軟硬體共同設計方式來
實現。實驗結果也證實所提運動控制晶片之有效性。 
本計畫這兩年之執行成果：有三篇期刊論文發表[50-52]、三篇技術期刊文章
[53-55] 、九篇國際研討會論文[56-64]、七篇國內研討會論文[65-71]及四個產學
合作計畫[72-75] 。本計畫也培養六位本國碩士班學生及兩位外(越南)籍碩士班
學生。未來，除培養更多位碩博士生外，也將發表更多論文、產學合作計劃及技
術移轉，以求有更多之成果。 
 
參考文獻: 
 
[1] T. Knight; A. Zilouchian and B. Szabo, “Design and implementation of position feedback 
controllers for an X-Y table,” Southeastcon '94. 'Creative Technology Transfer - A Global 
Affair, Proceedings of the 1994 IEEE, pp. 324-328. April 1994. 
[2] Z.Z. Liu, F.L.L. Luo and M.H. Rashid, “QFT-based robust and precision motion control system 
for a high speed direct-drive XY table positioning mechanism,” Industry Applications 
Conference, 38th IAS Annual Meeting, Conference, vol. 1, pp. 293 – 300, Oct. 2003. 
[3] F.J. Lin, H.J. Shieh, P.H.Shieh and P.H. Shen, “An Adaptive Recurrent-Neural-Network Motion 
Controller for X-Y Table in CNC Machine,” IEEE Trans. on System, Man and Cybernetics – 
Part B: Cybernetics, Vol. 36, No. 2, April 2006. 
[4] F.J. Lin, P.H.Shieh and P.H. Shen, “Robust Recurrent-neural-network Sliding-mode Control for 
X-Y table of a CNC machine,” IEE Proc. – Control Theory Appl., Vol. 153, No.1, January 
2006. 
[5] E.C. Park, H. Lim and C.H. Choi, “Position Control of X-Y Table at Velocity Reversal Using 
Presliding Friction Characteristics,” IEEE Trans. on Control System Technology, Vol. 11, No.1, 
January 2003. 
[6] H.T. Cho and S. Jung, “Neural network position tracking control of an inverted pendulum an 
X-Y table robot Intelligent Robots and Systems,” IROS 2003. Proceedings of IEEE/RSJ 
International Conference on, vol. 2, pp. 1210 – 1215, Oct. 2003. 
[7] Z.Z. Liu, F.L.Luo and Rashid, M.H., “Robust high speed and high precision linear motor 
direct-drive XY-table motion system,” Control Theory and Applications, IEE Proceedings- , 
vol. 151, Issue: 2, pp. 166 – 173, March 2004. 
[8] G. J. Wang and T. J. Lee, “Neural-network cross-coupled control system with application on 
circular tracking of linear motor X-Y table Neural Networks,” IJCNN '99, International Joint 
Conference on, Vol.3, pp. 2194 – 2199, July 1999. 
[9] Hyuk Lim; Jin-Woo Seo; Chong-Ho Choi “Position control of XY table in CNC machining 
center with non-rigid ballscrew,” American Control Conference, Proceedings of the 2000, Vol. 
3, pp. 1542 – 1546, June 2000. 
  
                                         共 31 頁   第 28 頁 
[26] Y.S.Kung and C.M. Liaw, “A fuzzy controller improving a linear model following controller 
for motor drives”, IEEE Trans. on Fuzzy Systems, vol.2, no.3, pp.194-202, 1994. 
[27] M.N. Uddin and M.A. Rahman, “High-speed control of IPMSM drives using improved fuzzy 
logic algorithms” IEEE Trans. on Industrial Electronics, vol.54, no. 1, February 2007, pp. 
190-199. 
[28] J. R. Jang, “ANFIS: adaptive-network-based fuzzy inference system,” IEEE Trans. on System, 
Man, and Cybernetics, vol. 23, no. 3, May/June 1993. 
[29] F.J. Lin and C.H. Lin, “On-line gain tuning using RFNN for linear synchronous motor,” PESC, 
2001 IEEE 32nd Annual, vol. 2, pp. 766-771. 
[30] F.J. Lin, C.H. Lin and P.K. Huang, “Recurrent fuzzy neural network controller design using 
sliding-mode control for linear synchronous motor drive,” IEE proc.- control Theory 
Application, July 2004. vol. 151, no.4, pp407-416. 
[31] L. Zhen and L. Xu, “Fuzzy learning enhanced speed control of an indirect field-oriented 
induction machine drive,” IEEE Trans. on Control Systems Technology, vol. 8, no. 2, 
pp.270-278, March 2000. 
[32] Y.S. Kung, P.G. Huang and F.K. Tu, “Development of DSP-based Adaptive Fuzzy Controller 
for Permanent Magnet Linear Synchronous Motor Drives,” The 24th Symposium on Electrical 
Power Engineering, PP. 1844~1848, Dec. 2003. 
[33] B.W. Bomar, “Implementation of Microprogrammed control in FPGAs,” IEEE Trans. on 
Indust. Electr., 2002, vol. 49, no. 2, pp. 415-422. 
[34] R.Wei, X.H. Gao, M.H. Jin, Y.W. Liu, H.Liu, N. Seitz, R. Gruber and G. Hirzinger, “FPGA 
based hardware architecture for HIT/DLR Hand,” in Proceedings of the IEEE/RSJ 
International Conference on intelligent Robots and System, 2005, pp. 523-528. 
[35] Y.Y. Tzou and H.J. Hsu, “FPGA realization of space-vector PWM control IC for three-phase 
PWM inverters,” IEEE Trans. on Power Electronics, 1997, vol.12, no.6, pp.953-963. 
[36] Z. Zhou, T. Li, T. Takahahi and E. Ho, “Design of a universal space vector PWM controller 
based on FPGA,” in Proceedings of the Applied Power Electronics Conference and Exposition 
Conference, 2004, vol. 3, pp. 1698-1702. 
[37] Y.S. Kung and M.H. Tsai, “FPGA-based Speed Control IC for PMSM Drive with Adaptive 
Fuzzy Control”, IEEE Transaction on Power Electronics, Vol. 22, No. 6, November, 2007, pp. 
2476-2486. 
[38] F.J. Lin, D.H. Wang and P.K. Huang, “FPGA-based fuzzy sliding mode control for a linear 
induction motor drive,” IEE Proc.- Electr. Power Application, vol. 152, no.5, Sep. 2005, pp. 
1137-1148. 
[39] J.Y. Jyang and Y.Y. Tzou, “A CPLD-based Voltage/Current Vector Controller for 3-Phase 
PWM Inverters,” IEEE, 1998, pp. 262-268. 
[40] T. Takahashi and J. Goetz, “Implementation of complete AC servo control in a low cost FPGA 
and subsequent ASSP conversion,” in Proceedings of the Applied Power Electronics 
  
                                         共 31 頁   第 30 頁 
[53] 龔應時, “以TMS320F2812 DSP為基礎無位置感測器電動跑步機速度控制器之研製,” 工
程科技通訊期刊, 103期, pp. 250-254, 2009年12月. 
[54] 龔應時、陳良榮、陳建文、盧俊豪、呂明典, “以DSP為基礎無位置感測器電動跑步機
速度控制系統之研製 ,” 電機月刊 , 變頻器應用與節能技術專輯 , 第二十卷 ,第一期, 
pp.2-10, 2010年1月. 
[55] 龔應時、楊政達、黃中雋、黃亮橋, “以FPGA為基礎永磁同步馬達無位置感測元件速度
控制晶片之研製 ,” 電機月刊 , 變頻器應用與節能技術專輯 , 第二十一卷 ,第一期 , 
pp.132-141, 2011年1月. 
[56] Y.S. Kung, Nguyen Vu Quynh, Nguyen Trung Hieu, C.C. Huang and L.C. Huang, 
“Simulink/Modelsim Co-Simulation and FPGA Realization of Speed Control IC for PMSM 
Drive,” Accepted by 2011 International Conference on Power Electronics and Engineering 
Application (PEEA 2011), Dec. 24 - 25, 2011, Shenzhen, China.  
[57] Y.S. Kung, P.H. Huang, F.C. Su and T.S. Chen, “Realization of an FPGA-based Motion 
Control System for Electric Standing Wheelchairs,” Accepted by the 2011 IEEE Symposium 
on Industrial Electronics and Applications (ISIEA 2011),  Sep. 25-28, 2011, Langkawi, 
Malaysia. 
[58] Y.S. Kung, Nguyen Vu Quynh, C.C. Huang and L.C. Huang, “Simulink/ModelSim 
Co-Simulation of Sensorless PMSM Speed Controller,” Accepted by the 2011 IEEE 
Symposium on Industrial Electronics and Applications (ISIEA 2011),  Sep. 25-28, 2011, 
Langkawi, Malaysia. 
[59] Y.S. Kung, Nguyen Vu Quynh, H.H. Chou, Chiu-Pao Tien, Chih-Nan Yen,“Design and 
Simulation of a Speed Control IC for PMSM Drive Based on Neural Fuzzy Control,” 
ELECTRIMACS 2011, June 6-8, 2011, Paris, France. 
[60] Y.S. Kung and S.W. Li, “FPGA-Realization of a Motion Control IC for X-Y Table with 
Adaptive Fuzzy Control,” The 11th IEEE International Workshop on Advanced Motion 
Control (AMC2010), pp. 191~196, March 21~24, 2010, Nagaoka-city, Niigata, Japan. 
[61] Y.S. Kung and C.C. Huang, “Motion Control IC for Linear Motor Drive X-Y Table Using 
FPGA Technology,” The 2010 International Conference on Applied Electronics, pp.183-186, 
Sep. 8-9, 2010, Pilsen, Czech Republic. 
[62] Y.S. Kung, C.T. Hsu, H.H. Chou and and T.W. Tsui, “FPGA-Realization of a Motion control 
IC for Wafer-Handling Robot,” The 2010 IEEE International Conference on Industrial 
Informatics (IEEE INDIN 2010), pp. 493-498, July 13-16, 2010, Osaka, Japan. 
[63] Y.S. Kung, M.S. Wang and C.Y. Yang, “Realization of a Motion Control IC for 
Electric-Powered Wheelchair,” The 2010 IEEE International Conference on Industrial 
Informatics (IEEE INDIN 2010), pp. 523-528, July 13-16, 2010, Osaka, Japan. 
[64] Y.S. Kung, N.K. Quang and Le Thi Van Anh, “FPGA-based Neural Fuzzy Controller Design 
for PMLSM Drive,” The 8th International Conference on Power Electronics and Drive 
Systems (PEDS'09), Nov. 2~5, 2009, Taipei, Taiwan. (EI) 
 1
出席國際學術會議心得報告 
                                                             
計畫編號 NSC 98-2221-E-218-050-MY2  
計畫名稱 以 FPGA 為基礎三軸 XYZ 平台運動控制晶片軟硬體設計技術(II) 
出國人員姓名 
服務機關及職稱 
龔 應 時 
南台科技大學電機工程系教授 
會議時間地點 99/9/8 ~ 99/9/9 
 Pilsen, Czech Republic (捷克皮爾森) 
會議名稱 
(中文) 2010 應用電子國際研討會 
(英文) 2010 International Conference on Applied Electronics
(AE 2010) 
發表論文題目 
 (中文)  使用 FPGA 技術實現線型馬達驅動 X-Y 平台之運動控制
晶片 
 (英文) Motion Control IC for Linear Motor Drive X-Y Table Using 
FPGA Technology 
 
一、 參加會議經過 
 
本人此次參加的國際會議為捷克西波希米亞大學主辦的『2010應用電子國
際研討會』(2010 International Conference on Applied Electronics, AE 2010)。會
議時間為2010年9月8至9日，會議地點在捷克皮爾森(Pilsen, Czech Republic)的西
波希米亞大學(University of West Bohemia)內舉辦。此會議之論文將被收錄於
IEEE 之資料庫。此會議之論文分為下列類別：  
1. Analogue and digital electronic systems  
2. Automotive electronics  
3. Electronics in industry and transport  
4. Electronics in measurement and control  
5. Electronics in medicine  
6. Electronics in telecommunication devices  
7. Embedded systems, HW and SW  
 3
     
(a) ACM 2010會議註冊處                           (b)與主持人拍照 
圖1. 參加AE 2010會議現場狀況 
 
二、 與會心得 
此次參加『2010 應用電子國際研討會，AE 2010』，由捷克西波希米亞
大學主辦。本人參與此次研討會，有以下參點心得報告： 
(一) 在 AE 2010 會議中發表的論文涵蓋所有電子應用領域，有關數位及類比
電子、汽車電子、工業及運輸電子、量測及控制電子、醫學電子、通訊
電子、嵌入示系統(含軟硬體)、訊號處理(含軟硬體)之應用等，都是此會
議探討之題目。此會議之論文 90%為歐洲學者所發表。因此，參加此會
議可以很快了解歐洲國家在這些領域目前的發展技術，也可提供國內專
家學者在研究方向之參考。  
(二) 此次 AE 2010 會議中，由現場討論較為熱烈的論文評定，應稍為偏重實
務應用之論文，而其論文涵蓋所有電子應用領域，因此，AMC 2010 會
議適合國內研究電機與電子之學者或研究生參與。 
(三) 此次 AE 2010 會議雖為 IEEE 協會主辦且發表之文章可收錄於 IEEE 之資
料庫。但是僅有 89 論文被接受在此會議發表。AMC 研討會以往常見有
不錯的文章發表，且參與的人數也不少。此次參與人數並不多，其原因
可能是研討會地點不佳(過於偏遠)及天氣過冷的關係。 
 5
附件一: 論文被接受發表之證明文件 
Dear author, 
 
The paper named "Motion Control IC for Linear Motor Drive X-Y Table Using FPGA Technology" that you have 
submitted to "Applied Electronics 2010" has been reviewed with the following result:  
******************************************************************** 
  Accept the paper 
******************************************************************** 
 
A good advance in the related field. The authors demonstrated clearly what they aimed. The paper can be accepted for 
presentation. 
******************************************************************** 
 
During the check-up of the format of your paper we have found the following formal shortcomings: 
******************************************************************** 
Page Format (A4):   OK 
Top margin:         OK 
Bottom margin:      OK 
Left/right margin:  OK 
Gutter:             FAILED 
******************************************************************** 
 
For your information we are enclosing the preview of your original paper as if printed in the AE 2010 Proceedings. You 
can see that the formatting needs adjustments according to the AE rules which are available at 
http://appel.zcu.cz/doc.php . 
 
In the case that some alterations of your paper have been suggested, please follow the comments and instructions and 
alter your paper as required. The required changes are NECESSARY for your paper to be finally accepted. 
As we announced, the AE 2010 Proceedings will be submitted to the IEEE Xplore database. Therefore, all the papers 
must be IEEE Xplore compliant. For this reason, the IEEE PDF eXpress will be enabled for use by AE 2010 conference 
authors. 
The IEEE PDF eXpress serves for converting the original MS Word (.DOC) file into the IEEE Xplore compliant .PDF 
file. It does not change the paper formatting. Therefore, you will need a formally and factually correct .DOC file. 
In short time you will receive detailed instructions about converting your paper and sending it to the conference database 
of printing-ready papers. Until then you have some time for making the required changes. 
Please do not forget that the deadline for early payment of the conference fee is June 30th. Also do not forget to pay 
increased fee for EXTRA PAGES as announced at conference www pages. 
We announced price reductions for the first authors if they are IEEE members, IEEE-IES members, or students. It is 
necessary to deliver INDIVIDUAL applications for these price reductions to the conference chairman 
pinker@kae.zcu.cz BEFORE payment. Instructions for payment in EUR and in CZK are available at 
       http://appel.zcu.cz/payment.php?eur 
       http://appel.zcu.cz/payment.php?czk 
 
The preliminary schedule of the conference sessions will be presented on our WWW pages during the first half of July. 
Regular visiting of http://appel.zcu.cz/ is recommended. 
 
Thank you for submitting your paper to AE 2010. 
 
Yours sincerely, 
        Organizing committee of Applied Electronics 2010 
 
 
 
Motion Control IC for Linear Motor Drive X-Y Table 
Using FPGA Technology    
 
Ying-Shieh Kung1 and Chung-Chun Huang2 
 
1Department of Electrical Engineering, Southern Taiwan University, Taiwan  
kung@mail.stut.edu.tw 
2The Energy and Environment Research Laboratory, Industrial Technology Research Institute, Taiwan 
CCHuang@itri.org.tw   
Abstract- In this paper, a motion control IC for linear 
motor drive X-Y table using FPGA (Field programmable 
gate array) technology is presented. Firstly, the 
mathematical model of the X-Y table is defined. Secondly, 
an adaptive fuzzy controller (AFC) is introduced and 
adopted in position loop of X-Y table to improve the 
motion tracking performance under unmodelled 
uncertainty condition. Thirdly, in implementation, an 
FPGA embedded by a Nios II processor is used to design 
the overall circuits of the motion control IC which the 
scheme of position/speed/current control for two 
PMLSMs (permanent magnetic linear synchronous 
motors) is realized by hardware in FPGA and the motion 
trajectory algorithm for X-Y table is implemented by 
software using Nios II embedded processor. To reduce 
the FPGA resource usage, an FSM (Finite state machine) 
joined by a multiplier, an adder, a LUT (Look-up table), 
some comparators and registers is used to model the 
overall AFC algorithm. Therefore, a fully digital motion 
controller can be implemented by an FPGA using 
hardware/software co-design technology which will make 
the motion controller of the X-Y table more compact, 
flexible and better performance. 
I. INTRODUCTION 
The development of a compact and high 
performance motion controller for the X-Y table of a 
CNC machine has been an important field in 
literatures [1-3]. The typical architecture of the 
conventional motion control system for X-Y table is 
shown in Fig. 1, which consists of a central controller, 
two sets of servo drivers and an X-Y table. The central 
controller, which usually adopts a float-pointed 
processor, performs the function of motion trajectory 
and data communication with servo drivers and with 
external device. Each servo driver usually use a fixed-
pointed processor, some specific ICs and an inverter to 
perform the functions of position/speed/current control 
at each signal axis of X-Y table and to do the data 
communication with the central controller. Data 
communication between two devices uses an analog 
signal, a bus signal or a serial asynchronous signal. 
However, the motion control system in Fig.1 has some 
drawbacks, such as large volume, easy effect by the 
noise, expensive cost, inflexible, etc. In addition, data 
communication and handshake protocol between the 
central controller and servo drivers slow down the 
system executing speed.  
In recent years, the FPGA has been widely applied 
in implementing the digital control system [4-7]. 
Besides, an embedded processor IP and an application 
IP can be developed and downloaded into FPGA to 
construct a SoPC environment [8-10], allowing the 
users to design a SoPC module by mixing hardware 
and software in one FPGA chip. Therefore, based on 
the novel FPGA technology, we improve the 
aforementioned drawbacks and integrate the central 
controller and the controller part of two servo drivers 
in Fig. 1 into a motion control IC in this study, which 
is shown in Fig. 2. Our proposed motion control IC 
has two IPs (Intellectual Properties). One IP performs 
the functions of the motion trajectory by software. The 
other IP performs the functions of two axes’ 
position/speed/current controllers by hardware. As the 
results, this two IP will parallel processing in FPGA, 
and the hardware/software co-design technology in 
FPGA can make the motion controller of X-Y more 
compact, flexible, better performance and less cost.  
Controller-1 Inverter-1
Servo driver for Y-axis
Controller-2 Inverter-2
Servo driver- for X-axis
Central 
controller
Y-axis 
position 
command
X-axis 
position 
command
Motion control system for X-Y table
Motion 
command
X-axis 
PMLSM
Y-axis 
PMLSM
X-Y Table 
(Driven by two 
linear motors)
Linear 
encoder
Linear 
encoder
U,V,W
U,V,W
 
Fig.1. Conventional motion control system for X-Y table 
Digital circuit of 
position/speed/ current 
controller for Y-axis
Embedded Processor IP
(Nios II Processor)
Application IP
FPGA
Inverter-1
Inverter-2
X-axis 
PMLSM
Y-axis 
PMLSM
X-Y Table 
(Driven by two 
linear motors)
Linear encoder
Linear encoder
Digital circuit of 
position/speed/ current 
controller for X-axis
FPGA-based motion control system for X-Y table
U,V,W
U,V,W
FPGA-based motion control IC  
Fig.2. Proposed FPGA-based motion control system for X-Y table 
Further, the X-Y table usually leads to the existence 
of unmodelled dynamics and disturbances which often 
significantly deteriorate the system performance 
during a machining process. Many studies attempt to 
improve the tracking performance in a machining 
process [11-12]. Therefore, to alleviate the effect of 
unmodelled dynamics and external disturbance in X-Y 
table, an AFC constructed by a fuzzy basis function 
and a parameter adjustable mechanism is presented. In 
implementation, to reduce the FPGA resource usage, 
an FSM joined by a multiplier, an adder, a LUT, some 
comparators and registers is used to model the overall 
AFC algorithm. Finally, an experimental system is set 
up to verify the performance of the proposed motion 
control IC for linear motor drive X-Y table. 
the parameters nmc , of FC described in (8) can be 
adjusted by  
mnipvnm keKKkkc ,, )()(    )( ξαΔ +=  (11) 
with m = j, j+1 and n = i,i+1.  
C. Star motion trajectory of X-Y table 
Star motion trajectory is shown in Fig.4. The 
formulation is derived as follows: 
y
x
be
a
c
d
Start
72°
18°
36°
54°
 
Fig. 4. Star trajectory 
a-trajectory : 
11         −− =+= iiii yy,xSx   (12) 
b-trajectory :  
11 36sin*      ,54sin* −− +−=+−= i
o
ii
o
i ySyxSx   (13) 
c-trajectory : 
11 72sin*        ,18sin* −− +=+= i
o
ii
o
i ySyxSx  (14) 
d-trajectory :  
11 72sin*        ,18sin* −− +−=+= i
o
ii
o
i ySyxSx   (15) 
e-trajectory : 
11 36sin*      ,54sin* −− +=+−= i
o
ii
o
i ySyxSx  (16) 
Where S , ix , iy  are position increment, X-axis 
trajectory command and Y-axis trajectory command, 
respectively. The motion speed of the table is 
determined by S . 
III. MOTION CONTROL IC DESIGN FOR X-Y TABLE 
Figure 5 illustrates the internal architecture of the 
proposed FPGA-based motion control IC for linear 
motor drive X-Y table. The FPGA uses Altera Stratix 
II EP2S60 and a Nios II embedded processor is 
downloaded into FPGA to construct SoPC 
environment. Herein, Altera Stratix II EP2S60, which 
has 48,352 ALUTs (Adaptive Look-Up Tables), total 
2,544,192 RAM bits, and a Nios II embedded 
processor which has a 32-bit configurable CPU core, 
is used. The internal circuit in Fig. 5 comprises a Nios 
II embedded processor IP (Intelligent Properties) and 
an application IP. The Nios II processor is depicted to 
generate the motion trajectory and collect the response 
data. The application IP includes the circuits of the 
position AFC, the speed P controller and the current 
vector controller for X-axis and Y-axis table. The 
sampling frequency of position control loop is 
designed with 2kHz. The frequency divider generates 
50 Mhz (Clk), 25 Mhz (Clk-sp), 16 kHz (Clk-ctr) and 
2 kHz (Clk-po) clock to supply all circuits in Fig. 5. 
In Fig.5, an FSM is employed to model the 
algorithm of position AFC and speed P controller 
which uses one adder, one multiplier, a look-up table, 
comparators, registers, etc. and manipulates 35 steps 
machine by 1.40 μs to carry out the overall 
computation. Other detailed circuits, such as current 
vector controller, SVPWM and QEP refer to [6]. The 
resource usage of an AFC circuit in FPGA needs 
8,055 ALUTs, and the overall resource usage of the 
motion control IC for X-Y table in Fig.5 need 31,203 
ALUTs and 642,816 RAM bits, which the Nios II 
embedded processor IP needs 8,275 ALUTs and 
46,848 RAM bits which is shown in Table 1. 
Frequency 
divider
CLK
CPU
On-chip
ROM
On-chip
RAM
UART
PIO
Timer
SPI
A
va
lo
n 
B
us
A
va
lo
n 
B
us
Nios II Embedded Processor IP
Altera FPGA (Stratix II EP2S60F672C5ES )
Clk
Clk-ctr
Clk-sp
[15..0]
[15..0]
Application IP
X-axis Position controller
STSB
RCB
RCA
STSA
CHB
CHA
xPWM 1
xPWM 2
xPWM 3
xPWM 4
xPWM 5
xPWM 6
xADIN[11]
xADIN[0]
xBDIN[11]
xBDIN[0]
Circuit of 
current vector 
controller and 
QEPs Interface  
Clk
Clk-cur
Clk-step
xEncoder-A
xEncoder-B
xEncoder-Z
Circuit of position 
adaptive fuzzy 
controller (AFC) and 
speed P controller [15..0]px
Clk
Clk-sp
*
px [15..0]
Clk-step
[11..0]*qi
*
px
STSB
RCB
RCA
STSA
CHB
CHA
yPWM 1
yPWM 2
yPWM 3
yPWM 4
yPWM 5
yPWM 6
yADIN[11]
yADIN[0]
yBDIN[11]
yBDIN[0]Circuit of 
current vector 
controller and 
QEPs Interface 
Clk
Clk-cur
Clk-step
yencoder-A
yEncoder-B
yEncoder-Z
Circuit of position 
adaptive fuzzy 
controller (AFC) and 
speed P controller 
Clk
Clk-sp
*
py [15..0]
Clk-step
[11..0]*
qi
*
py
Y-axis Position controller
[15..0]py
 
Fig. 5. The internal architecture of a control IC for X-Y table 
Table 1 The resource usage of a control IC in FPGA 
Application IP
642,81631,203
595,9686,818
2 x Current loop controller 
(Current vector control, 
SVPWM,ADC,QEP)
016,1102 x Adaptive fuzzy controller (AFC)
Total
46,8488,275Nios II Embedded Processor IP
Memory
(bits)
ALUTsModule circuitIP
 
IV. EXPERIMENTS AND RESULTS 
The experimental system in Fig.2 includes an 
FPGA experimental board, two sets of voltage source 
IGBT inverter and an X-Y table which is driven by 
two PMLSMs. The PMLSM is a single-axis stage with 
a cog-free linear motor and a stroke length with 
600mm. The parameters of the motor are: Rs = 27Ω , 
Ld = Lq = 23.3 mH, Kt = 79.9N/A. The input voltage, 
continuous current, peak current (10% duty) and 
continuous power of the PMLSM are 220V, 1.6A, 
4.8A and 54W, respectively. The maximum speed and 
acceleration are 4m/s and 4 g but depend on external 
load. The moving mass is 2.5Kg, the maximum 
payload is 22.5Kg. A linear encoder with a resolution 
of 5μm is mounted on the PMLSM as the position 
sensor, and the pole pitch is 30.5mm. The FPGA-
Altera Stratix II EP2S60 in Fig.2 is used to develop a 
full digital motion controller system for X-Y table. In 
國科會補助計畫衍生研發成果推廣資料表
日期:2011/09/23
國科會補助計畫
計畫名稱: 以FPGA為基礎三軸XYZ平台運動控制晶片軟硬體設計技術(II)
計畫主持人: 龔應時
計畫編號: 98-2221-E-218-050-MY2 學門領域: 電機機械 
研發成果名稱
(中文) 以FPGA為基礎之多軸運動控制晶片
(英文) FPGA-based Mutli-axis motion control IC
成果歸屬機構
南臺科技大學 發明人
(創作人)
龔應時
技術說明
(中文) 本技術主要以一顆現場可程式邏輯元件(FPGA晶片)並嵌入Nios處理器來發展三軸
XYZ平台運動控制晶片。此XYZ平台由三顆永磁同步馬達帶動滾珠導螺桿運動，平
台上具有線性尺以迴饋平台實際移動位置來進行全閉迴路控制。在運動晶片設計，
Nios處理器內以軟體程式實現，其功能包含圓形、窗形及螺旋運動軌跡之計算；
FPGA晶片內以數位硬體方式實現，其功能主要為位置迴路PI控制器設計、速度迴
路P控制器設計、電流向量控制設計、SVPWM產生電路、座標轉換、QEP偵測電路。
因此，三軸XYZ平台運動控制器可在一顆FPGA內實現。
(英文) An FPGA (Field programmable gate array) embedded with a Nios processor is applied to 
develop a motion control IC for XYZ table in this technology. The XYZ table is driven 
by three permanent magnet synchronous motors (PMSMs) and three ball screws. The 
table position, which is measured by linear encoder, is feedbacked for full close-loop 
control. In motion control IC design, the circle, window or spiral trajectory motion is 
realized by software using Nios processor; the position PI controller, speed P controller, 
current vector controller, SVPWM generation and QEP interface are implemented by 
hardware in FPGA. Therefore, a motion controller for XYZ table can be implemented in 
one FPGA. 
產業別 機電工程業
技術/產品應用範圍 CNC機器,多軸伺服控制機器,多軸機械手臂. 
技術移轉可行性及
預期效益
具有提高機器性能,控制器小型化,節省機器成本..等優點.
註：本項研發成果若尚未申請專利，請勿揭露可申請專利之主要內容。
其他成果 
(無法以量化表達之成
果如辦理學術活動、獲
得獎項、重要國際合
作、研究成果國際影響
力及其他協助產業技
術發展之具體效益事
項等，請以文字敘述填
列。) 
A. 協助辦理學術活動: 
[1] IEEE IES Technical Committee of Electronic Systems on Chip 
Website: http://vega.unitbv.ro/~ieee/Membership.html 
[2] Scientific Commitee of international conference ELECTRIMACS 2011 
Website: http://www.u-cergy.fr/electrimacs2011/committees.php 
 
B. 產學計畫: 
[1] 龔應時, ’伺服驅動模組設計’, 工業技術研究院(機械所)產學合作計
畫，100 年 9 月 01 日 ~ 
100 年 11 月 30 日。計畫經費：300,000 元。 
[2] 龔應時, ’SoPC 輔助控制系統 IP 可重組化 應用技術’,金屬工業研究發
展中心產學合作計 
畫，100 年 3 月 01 日 ~ 100 年 12 月 31 日。計畫經費：300,000 元。 
[3] 龔應時, ’伺服驅動控制晶片演算法研究’,工業技術研究院(機械所)產
學合作計畫，99 年 
3 月 1 日 ~ 99 年 11 月 30 日。計畫經費：400,000 元。 
[4] 龔應時, ’以 FPGA 為基礎永磁同步馬達無感測速度控制技術研究’,工業
技術研究院(綠能 
所)產學合作計畫，99 年 3 月 19 日 ~ 99 年 11 月 30 日。計畫經費：480,000
元。 
 成果項目 量化 名稱或內容性質簡述 
測驗工具(含質性與量性) 0  
課程/模組 0  
電腦及網路系統或工具 0  
教材 0  
舉辦之活動/競賽 0  
研討會/工作坊 0  
電子報、網站 0  
科 
教 
處 
計 
畫 
加 
填 
項 
目 計畫成果推廣之參與（閱聽）人數 0  
 
