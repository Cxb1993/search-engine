 2 
壹、導 論 
 
隨著科技的進步，越來越多可攜式電
子產品都必須與非揮發性的記憶體搭配使
用。例如，個人數位助理(PDA)、手機、
數位相機、MP3隨身聽和錄音筆。而快閃
記憶體儲存卡，符合以上產品之需求，因
而成為近年來可攜式電子產品所必備使用
的新寵兒，如 Smartmedia Card，CF Card 
和 SD Card等。 
而快閃記憶體又分為兩種型態，NOR
型快閃記憶體(簡稱 NorFlash)和 NAND型
快閃記憶體(簡稱 NandFlash)。NorFlash具
有隨機存取的特性，適合做程式碼儲存，
一般作為嵌入式系統的 O.S.核心運作用，
但由於其單位記憶體比 NandFlash 昂貴，
因此不適合做為大量資料儲存用，所以資
料儲存方面以 NandFlash為主軸。 
但 NandFlash 就單位記憶體費用而言
仍比傳統式硬碟貴上數十倍甚至百倍之
多，並且快閃記體有以下的兩個問題。首
先是寫入頻寬的問題，因為基本寫入運算
以頁為單位，而且抹除運算應該在寫入運
算之前被執行，因此寫入頻寬成為其性能
上的瓶頸。第二是儲存容量的問題。而以
上兩個問題可以藉由壓縮來解決。 
在 NandFlash中，它僅支援頁 I/O，在
一般的快閃記憶體管理架構〔1-3,6-7〕，
若被壓縮的資料比資料頁容量還小時，它
並不具任何壓縮效果，將會產生內部碎
片。因此，必須在傳統快閃記憶體管理架
構下的快閃轉譯層 (Flash Translation 
Layer，簡稱 FTL)中增加一快閃壓縮層，
如此才能有效的達到壓縮效果〔9〕。 
但就目前文獻所提之方法〔9-10〕，
雖然具有壓縮成效，但卻造成緩衝記憶體
的大量使用及讀取速度嚴重下降之缺點。
所以，如何增加快閃記憶體的使用空間並
兼具快閃記憶體連續讀取之優點，是一重
要研究議題。本文中，我們將以 NandFlash
作為研究基礎，依據特性使用 X-RL 壓縮
演算法及配置策略，以改善該文獻之缺
失，提高實用價值。 
本文的架構安排如下。在第二部份中
描述 NandFlash 的基本工作原理。壓縮演
算法之探討於第三部份中討論。第四部份
是主要研究結果。最後，第五部分為結論。 
 
貳、基本原理 
 
NandFlash 將記憶體分割為數個固定
的區塊(Block)，每個區塊切割成數個大小
相同的資料頁(Page)。其中區塊是抹除的
基本單位，資料頁則是 I/O 的操作單位，
也是 NandFlash 與主記憶體間資料交換的
單位。NandFlash基礎架構如圖(一)所示；
由圖(一)中可發現 I/O 匯流排(Bus)為 8 位
元，資料頁由(512+16)B所組成，每 32個
資料頁組成一區塊單位 (16K+512)B〔
11-12,14〕。 
 
 
圖(一) NandFlash基礎架構圖 
 
 
 
 4 
LZW演算法〔4〕。為求即時壓縮速度，所
以我們採用上述之字典基礎模型 X-RL 非
失真壓縮法運用於 NandFlash中。 
 
 
 
圖(二) 字典基礎模型壓縮演算法範例 
 
肆、主要研究結果 
 
首先，經由 NandFlash 的基本特性
中，我們可得知存取的單位為資料頁。因
此，在編程(Programming)中必須降低內部
斷裂未使用空間情況。在文獻〔9〕中，提
出使用 IPS Best-Fit 方式運用至 Smart- 
Media Card，其基礎架構如圖(三)所示。在
內部封裝方案(Internal Packing Scheme，簡
稱 IPS)策略中，使用緩衝器(Buffer)配合
Best-Fit群組政策，使得在多種應用程式檔
案格式中，其平均資料頁內部破碎程度最
低〔9〕。 
我們從NandFlash及 SmartMedia Card
相關資料〔11-14〕，發現部份議題可更進
一步探討。因此，以下將提出我們綜合性
的建議，希望在此運用中更為完善。 
在讀取頻寬之探討方面，NandFlash
在於連續性資料頁讀取時間上可達 50 ns
的高速讀取時效。因此，NandFlash 利於
連續資料讀取之運用。然而在 Best-Fit 方
式中，是依照壓縮後資料的大小給予最佳
的配置，但是此配置結果將依檔案型態的
分割頁而呈現不同的配置結果，使得檔案
的連續性變差，造成讀取頻寬因此降低。
例如：若一個檔案為 2.4KB，以頁 I/O 單
位方式分成 A1、A2、A3、A4及 A5，再經
壓縮後分別成為 A1’、A2’、A3’、A4’及 A5’ 
B，之後由 Best-Fit方式配置，如圖(四)所
示。 
我們若以讀取時間作為考量點，則
IPS Best-Fit 方式會因為每一個資料頁處
於未連續配置狀態。因此，每一資料頁皆
必須花費一次定位時間及讀取時間，所以
總共必須花費[(12us*5+(A1’+A2’+A3’+A4’ 
+A5’)*50ns]=60us+(A1’+A2’+A3’+A4’+A5’)
*50ns。由此例中我們可發現，該檔案讀
取，一共執行了五次定位。 
 
 
 
圖(三) Best Fit壓縮配置方式 
 6 
檔案大小等於十頁時的定位次數分布圖
1468457; 40%
1334961; 37%
600732; 17%
38934; 1%6678; 0%
924; 0%
1; 0%
177996; 5%
108; 0%
9; 0%
1次定位
2次定位
3次定位
4次定位
5次定位
6次定位
7次定位
8次定位
9次定位
10次定位  
圖(六) 定位超過八次以上的機率佔
94%，平均為 9.1次 
 
從 NandFlash 特性中我們知道，每一
個資料區塊都必須重新定位，也就是即使
一個被壓縮後大小為30K的檔案呈連續排
列，仍得定位兩次 ë û ) 216/30 ( =kk ；而機
率排序問題是一種階層問題，16KB 的區
塊，若以壓縮率 40.8%而言〔9〕，最高可
以存放 45個被壓縮頁，因此其可能的組合
為 45!，此數字超過一般電腦所能運算的
極限。我們由圖(七)中可以發現，檔案資
料頁數與平均定位次數圖中，當資料頁數
大於 4以上時，幾乎呈現一直線，因此我
們求得該近視線性公式，如下式所示。 
 
ï
ï
î
ï
ï
í
ì
³³-
=
=
=
=
4y45   ,   65.0975.0
3y        ,          6/14
2y        ,             5.1
1y        ,                1
_
y
numaveg  
aveg_num表示平均定位次數，y表示檔案頁數 
0
1
2
3
4
5
6
7
8
9
10
1 2 3 4 5 6 7 8 9 10
檔案頁數
平
均
定
位
次
數
平均值
近似曲線值
誤差值
 
圖(七) 不同檔案大小的平均定位次數與
近似曲線及差異值 
表(三) 近似公式誤差值 
頁數 平均定位次數 近似公式定位次數 誤差值 
1 1.00 1.00 0.00% 
2 1.50 1.50 0.00% 
3 2.33 2.33 0.00% 
4 3.25 3.25 0.00% 
5 4.20 4.23 0.71% 
6 5.17 5.20 0.58% 
7 6.14 6.18 0.65% 
8 7.13 7.15 0.28% 
9 8.11 8.13 0.25% 
10 9.10 9.10 0.00% 
 
由表(三)所示，可得知近似公式與實
際誤差不大。因此，我們粗估當檔案等於
45頁時，其平均定位次數為 43.225次。 
綜合以上結果，我們學習希望能改善
資料配置方法，使得資料呈現循序性方
式，進而發揮 NandFlash 之特性。因此，
我們提出將圖(四)之架構，改善如圖(八)
所示之架構，稱之為 IPSoptimal方式。我們
估計 IPSoptimal 方式的檔案讀取時間為
12us+(A1’+A2’+A3’+A4’+ A5’)*50ns，比起
圖(四)的架構足足省下 48us的讀取時間。
如此在大檔案容量時，如數位相機
(DSC)、USB Flash Device或MP3隨身碟
之運用時，其成效更為彰顯。 
圖(九)為套用 IPS Best-Fit的平均壓縮
率 140.8%與我們提出的 IPSoptimal架構在讀
取時間方面的比較圖（每個區塊可以儲存
45個被壓縮頁），我們發現當檔案是 180kB
時，IPS Best-Fit的讀取時間是 IPSoptimal的
1.6倍，多花費了 4.05ms；當檔案是 1MB
時，IPS Best-Fit的讀取時間為 60.8ms，一
樣是 IPSoptimal的 1.6倍，多花費 23ms(以上
讀取時間僅是定位讀取資料時間，不包含
解壓縮時間等)。因此，我們必須將讀取頻
 8 
16MB及 8MB之 SmartMedia Card 〔11〕，
上述之 IPSoptimal方式亦可直接套用。 
再者，SmartMedia Card 之架構與
NandFlash (Samsung, Toshiba)之架構亦相
同〔12-14〕，在於一般式的 NandFlash (Page 
=512B, Block=16KB)亦可採用此架構。 
 
表(四) ISP Best-Fit及 IPSoptimal比較表 
 ISP-Best Fit  IPSoptimal 
特性 分散 連續 
緩衝區大小
(RAM) 512B × 320 512B × 4 
讀取速度 
(正規化) 1 1.65 
內部破碎 å
=
n
i
iionFragmentat
1
 小於 512B 
 
伍、結 論 
 
我們提出新的 IPSoptimal架構，並且使
用 MATLAB 軟體模擬，在成效上不但降
低了緩衝區記憶體的使用，更使得總壓縮
率可以比參考文獻 IPS Best-Fit架構〔9〕
高，主要是由於本文採用連續記憶體配
置，先將緩衝記憶體填滿，再以頁 I/O 的
方式寫入至 NandFlash 中，如此不但充份
利用每一資料頁，更使得在讀取方面有顯
著改善，當檔案大於 8K 以上時，平均讀
取時間而言 IPSoptimal只須 IPS Best-Fit架構
的 0.625 倍。如此，意謂著 IPSoptimal壓縮
層架構方法，使用在MP3或數位相機時，
不會因非連續儲存而降低讀取速度。例
如，當觀瀏覽數MB的數位圖片時，不因
壓縮層配置之故，而嚴重降低讀取速度，
使得本文所提之壓縮方案更符合實用價
值。 
 
參考文獻 
 
〔1〕 黃文增，陳彥勝，陳俊達，鄭重志，
“高可靠度和低成本的快閃記憶體
管理方法之研究”，台北科技大學學
報，Vol. 37-1，Accepted，Oct，2003. 
〔2〕 黃文增，陳俊達，陳彥勝，劉倉吉，
“以區塊為基礎之反及閘快閃記憶
體管理模式”，台北科技大學學報，
Vol. 37-2，Accepted，March，2004.  
〔3〕 鄭重志，黃文增，陳俊達，陳錦杏，
“快閃記憶體檔案管理系統的設計
與實作”，台北科技大學學報，Vol. 
36-2，pp. 43-62, March，2003. 
〔4〕 戴顯權，“資料壓縮”，松岡電腦圖書
資料股份有限公司，民國八十八年
六月。 
〔5〕 S. Bunton and G. Borriello, “Practical 
Dictionary Management for Hardware 
Data Compression,” Communications 
of the ACM, Vol. 35, No. 1, pp. 
95-104, 1992. 
〔6〕 F. Douglis, R. C’eres, F. Kaashoek, K. 
Li, B. Marsh, and J.A. Tauber, 
"Storage alternatives for mobile 
computers," Proc. OSDI94, pp. 25–37, 
1994. 
〔7〕 H. J. Kim and S. G. Lee, "An 
Effective Flash Memory Manager for 
Reliable Flash Memory Space 
Management," IEICE Trans. 
Information & System, Vol. E85-D, 
No. 6, pp. 951-964, June 2002. 
〔8〕 M. Kjelso, M. Gooch, and S. Jones, 
“Design and Performance of a Main 
Memory Hardware Data 
Compressor,” In Proceedings the 
22nd Euromicro Conference, IEEE 
Computer Society Press, pp. 422-430, 
1996. 
