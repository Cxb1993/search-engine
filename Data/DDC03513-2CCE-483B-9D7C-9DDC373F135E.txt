QoS 的各項排程分類及相關安全性議題，再來介紹
可提供具有私密性防護的可動態變換金鑰的
Diffie-Hellman 演算法與其如何實做到 VoIP 服務，
接下來是實驗環境的介紹、實驗所獲致的相關數據
與其效能分析，最後是結論與未來工作。 
 
2. WiMAX 語音傳輸服務品質與安全性
相關議題 
由於服務品質要求極高的 VoIP 應用在頻寬共
享與公開的 WiMAX 網路下必頇要能夠同時具有
即時傳輸效能與有效的私密性防護，於是接下來就
經由介紹不同的WiMAX傳輸服務類別與WiMAX
本身具有的安全防護機制，藉以了解如何在不影響
VoIP 傳輸服務品質的條件下，有效提升 VoIP 在
WiMAX 網路環境下的私密性防護能力。 
 
2.1 WiMAX 的傳輸服務類別 
WiMAX 是近年來新一代的無線網路傳輸方
案，它在 2001 年開始由 WiMAX Forum 所推動，
並訂為 IEEE 802.16，技術開發至這幾年已漸趨成
熟，儘管 WiMAX 最吸引客戶的地方在於較快的傳
輸速度，但是單純提供寬頻上網服務並不能夠滿足
營運商的獲利需求，因此 WiMAX Forum 應用工作
組在 WiMAX 中納入了多種不同的 QoS 機制，其
中 VoIP 就是優先權最高的服務類型，顯示出 VoIP
在 WiMAX 應用中的重要性。 
有關 WiMAX 的 QoS 機制將分類成四種排程
方法，分別為 UGS(Unsolicited Grant Service)、rtPS 
(real-time Polling Service) 、 nrtPS(non-real-time 
Polling Service)、BE(Best Effort)。可參照表格 1 所
示。 
UGS 本身的設計是為了要支援有固定封包大
小，而且封包傳送週期間隔固定的應用，因此網路
上的頻寬是永遠為 UGS 保留著，無需先向基地台
BS(Base Station) 申請。BS 定時的分配頻寬給此類
相關的連線應用服務，像是 T1/E1 連線與沒有靜音
抑制的 VoIP 應用等。 
rtPS 也是提供給即時性的服務，如：聲音與視
訊的串流服務，它的資料傳輸週期也是固定的，但
不同於上述 UGS 的是 rtPS 的資料長度可以是變動
的，如常見的 MPEG 視訊壓縮格式。另外它也可
以對 BS 要求頻寬，但 BS 需透過輪詢的方式以確
保滿足 rtPS 對頻寬的要求，因此這種服務所需額
外付出的輪詢時間及系統成本 (Overhead)要比
UGS 來的大。 
ErtPS 則是 rtPS 的延伸，支援所謂靜音抑制的
VoIP 應用服務，當使用者處於沉默狀態時，BS 會
停止分配頻寬給此條連線，藉此達到節省整體頻寬
的效果。 
nrtPS 則是提供非即時性的服務，它只保證最
小的頻寬要求，以及最長的網路延遲容忍範圍，與
rtPS 一樣是使用輪詢的機制去要求頻寬，典型的運
用為 File Transfer Protocol(FTP)，這類的服務對頻
寬有大量的需求，但對 delay 則是有較高的容忍範
圍。 
BE 則是沒有提供任何的 QoS 保證，適用於
資料傳輸頻寬，需要以競爭的方式來取得，常見的
運用如資料傳輸與網路瀏覽器服務等。 
 
表格 1  WiMAX QoS 型態 
QoS 類別 應用 QoS 規格 
UGS 
Unsolicited 
Grant Service 
VoIP 
〃可限制最大頻寬 
〃限制最大延遲 
〃Jitter 容忍度 
rtPS 
Real-Time 
Polling Service 
視訊串流或
影音 
〃最小保留頻寬 
〃可限制最大頻寬 
〃限制最大延遲 
〃流量優先權 
ErtPS 
Extended 
Real-Time 
Polling Service 
語音主動偵
測(VoIP) 
〃最小保留頻寬 
〃可限制最大頻寬 
〃限制最大延遲 
〃Jitter 容忍度 
〃流量優先權 
nrtPS 
Non-Real-Time 
Polling Service 
檔案傳輸協
定(FTP) 
〃最小保留頻寬 
〃可限制最大頻寬 
〃流量優先權 
BE 
Best-Effort 
Service 
資料傳輸及
網路瀏覽等
等… 
〃可限制最大頻寬 
〃流量優先權 
 
很顯然地，VoIP 符合 UGS 的特徵，聲音的封
包體積雖然不大，不過因為語音通訊對於封包延遲
及封包遺失率非常敏感，而且並不像隨選視訊
(VOD, Video on Demand)服務可以先作緩衝預載的
動作，因此對於封包傳輸延遲時間(delay)和延遲時
間的變異量(jitter)要求甚高，如果傳輸速度太慢、
延遲時間變動過大或者封包的遺失都會造成聲音
的播放品質下降。 
 
2.2 WiMAX 的安全防護   
然而在無線環境中各項資料傳輸要面臨的另
一項重大挑戰便是資料的安全性與隱密性的問
題，因此有關 WiMAX 網路中安全性部分的考量便
成了一項重要的議題。因此 IEEE 802.16d 標準版
本中，在 MAC 層中定義了一個所謂的隱私次層
(Privacy Sub-layer)以提供安全通訊。隱私次層主要
包括兩個協定：資料加密封裝協定(Encapsulation 
Protocol for Encrypting Packet Data)和公開金鑰管
理協定(Privacy Key Management, PKM)。其中資料
加密封裝協定詳細定義了 IEEE 802.16 標準所能支
援的資料加密與完整性的驗證演算法。而 PKM 協
定則提供了安全的金鑰交換機制，支援週期性的重
新認證與金鑰更新。 
802.16d 所使用的 PKMv1 協定中包含兩個重
而在802.16e所使用的PKMv2(參考圖 3)中提
升為兩層的認證機制，包括網路設備認證，以及連
線服務網路(Connectivity Service Network, CSN)與
固定式用戶端/行動式用戶端(Subscriber Station, 
SS/Mobile Station, MS)間的用戶端認證。主要是引
入了可擴充式認證協定(Extensible Authentication 
Protocol, EAP)機制，透過 MAC Layer 新訂定之
PKM-Req-EAP Transfer Request Message 與
PKM-Rsp-EAP Transfer Reply Message 來傳送使用
者端與基地台端之 EAP 訊息，在基地台端之後則
透過 RADIUS(或 Diameter)協定與後端認證伺服器
(AAA Server)進行使用者身分認證。 
802.16e 可支援 PKMv1 與 PKMv2，而 PKMv1
是對 SS 裝置做認證，僅在 BS 中支援。但由於
802.16e 增加了移動與漫遊功能，這時搭配 EAP 與
AAA (Authentication, Authorization, Accounting)的
PKMv2，便提供了一個更為彈性的架構，可對裝
置做認證，亦可對使用者做認證，或對兩者同時做
認證，以適用於不同的商業模式需求。 
雖然 WiMAX 有特別針對 VoIP 設置了較高的
優先權及 QoS 保證，但對於安全性方面仍是有些
許堪憂，例如：文獻[2]點出了 802.16e 的三個安全
上漏洞： 
1. 有不需認證的訊息命令：攻擊者有可能假造這
些命令來影響甚至破壞合法者的連線服務。 
2. 管理訊息沒有加密：攻擊者可以竊聽連線雙方
的重要資訊。 
3. 多點與廣播服務的加密金鑰是共用的：同組人
員可以藉此假造訊息，甚至洩漏金鑰。 
 
所以 WiMAX 固然可以帶來高寬頻及高效率
的網路服務，但由於是透過無線傳輸的方式與本身
安全機制標準尚未完善，使得 WiMAX 也面臨和
IEEE 802.11 的 Wi-Fi 一樣的安全性問題。在無線
網路環境中，攻擊者只要在無線網路涵蓋的範圍內
架設監聽器，不需要實際進到網路內部，就可以擷
取到內部的無線網路傳輸資料，因此在建置無線網
路時，無線傳輸的安全性更是不容忽視。 
 
3. KCDH(Key-Changing Diffie-Hellman)
安全加密機制 
由於網際網路傳輸環境的開放，透過一般使
用明文的方式來進行聲音資料傳輸易使得被監聽
的風險大幅增加，而且即使被監聽了也不易發現，
因此為 VoIP 加上安全加密機制是非常的重要。縱
使仍然有被破解的危險，不過就目前密碼學的發展
而言，如果單純利用擷取到的公開資料或是使用暴
力破解的方式來得到語音加密金鑰，都是無法在即
時完成的，只要金鑰夠長與加解密破解複雜度夠
高，即使是利用電腦進行破解一般也需要執行數百
年以上 
儘管 WiMAX 提供了 PKM 的加密機制，進行
中央集權式的加密金鑰管理，但是資料的保護及認
證卻是僅只在 BS 與 SS 之間；有別於 PKM 的加密
機制，可以動態變更金鑰的 Diffie-Hellman 加密金
鑰 交 換 演 算 法 ( 也 就 是 Key-Changing 
Diffie-Hellman, KCDH)[3]則是可提供 Peer-to-Peer
的機密性保護，因為只要是認證過的 VoIP 用戶兩
端，破解 Diffie-Helman 加密金鑰交換機制是離散
對數的問題，同時我們再引進動態變更加密金鑰機
制，來進一步解決 VoIP 在如 WiMAX 安全性較不
足的無線網路上可能遭遇的私密性防護問題。 
然而在一般無 QoS 機制的網路下，同時要達
到高連線品質與強有力私密防護的 VoIP 應用服務
是有相當的困難度，因此本計畫就是透過實際
WiMAX 連線來檢視其 QoS 排程對於具有動態金
鑰交換加密機制之 VoIP 服務的聲音品質的影響。 
VoIP 的安全加密機制在此採用Diffie-Hellman
作為基礎，然後再衍生為可以動態更換金鑰的安全
加密機制 KCDH，再用速度快與防護力強的 AES[3]
將語音內容加密。使用 Diffie-Hellman 最大的好處
是他可以在公開的網路上進行金鑰的協調交換，即
使被擷取了所傳輸的參數，它仍然是一個相當複雜
的離散對數問題，要破解加密所用的金鑰或是某一
方的私密金鑰(private key)是有相當的困難度。在
Diffie-Hellman 中雙方不需要預先知道對方加密所
需要用的參數，金鑰協調時由一端先選定唯二的兩
個參數，第一是參數為一個大的質數 q，另外一個
參數α為質數 q 之原根(primitive root)。產生參數
之後雙方各產生一把自己的私密金鑰，這把金鑰並
不讓其他人知道，而是將私密金鑰的α次方去對 q
作餘數除法後作為公開金鑰(public key)之用。 
當雙方取得對方的公開金鑰之後，便可以開
始計算通訊所要用的通訊金鑰(session key)，方法
是將對方的公開金鑰作為底數，自己的私密金鑰作
為指數，接著對 q 作餘數除法，接下來就可以使用
這把金鑰加密聲音內容。 
 
產生質數α和 q
私鑰：Xs, Us
公鑰：Ys = α
Xs mod q
公鑰：Vs = α
Us mod q
私鑰：Xc, Rc
公鑰：Yc = α
Xc mod q
公鑰：Sc = α
Rc mod q
通訊金鑰：K 0 = Ys
Xc mod q
KGF乘數：K’ = Vs
Rc mod q
傳送α, q及Y
s , Vs
傳送
Yc , 
Sc
通訊金鑰：K 0 = Yc
Xs mod q
KGF乘數：K’ = Sc
Us mod q 以K0加密
以Ki加密K i+1 = K i
K’ mod q K i+1 = K i
K’ mod q
 
圖 4  KCDH詳細流程 
 
為了更進一步提升私密性防護效能，而我們
再將上述 Diffie-Hellman 加密金鑰交換演算法做了
延伸，使得可以在不重新協調金鑰的狀況下不斷的
路下受到 QoS 機制、封包遺失及網路延遲的影響。 
實驗過程中，我們使用 Client A 與 Client B 進
行 VoIP 的語音通話，並在兩端紀錄著各個封包送
出的時間以及抵達的時間。另外有兩部電腦
External A 與 External 負責送出其他的 UDP 封
包，額外的流量會企圖影響原來的 VoIP 語音封
包，造成 WiMAX 設備因為頻寬不足而延遲封包的
傳送或遺失封包。而在啟動 WiMAX 的 QoS 之後
在封包分類時便會給 VoIP 封包等級最高的優先
權，以提升傳統品質。 
語音編碼
擷取聲音
KCDH及AES
聲音加密
封包封裝
透過網路送出
取得時間戳記
解開封包
接收封包
KCDH及AES
聲音解密
語音解碼
透過網路送出
取得時間戳記
發送端時間戳記取得 接收端時間戳記取得  
圖 7 發送端/接收端的時間戳記取得 
 
程式中語音封包的處理流程如所示，為了檢
驗 KCDH 金鑰變換及 AES 加密對聲音品質的影
響，因此發送端將在語音編碼之後與聲音內容加密
之前取得時間戳記與接收端則在解密之後取得時
間戳記，如圖 7。以便瞭解加密是否會造成封包的
延遲，並檢視其影響程度。本實驗將在上述實驗環
境中分作以下幾個變數進行分析： 
(1) 封包遺失率：在 Dummynet 上設定以下四種不
同的封包遺失率 0%、1%、3%、5%，藉此探討
封包遺失率對於語音通話品質的影響。 
 
 
圖 8  iLBC 封包不同遺失率下封包到達時間間格的平
均數與變異數 
 
從實驗結果(圖8與圖 9)中比較 iLBC 與PCM的
封包遺失率對於通話品質的影響，單純透過
WiMAX 傳輸語音資料並且不使用任何加密機
制與在原有 WiMAX 傳輸機制下額外附加
KCDH 動態變更加密金鑰的語音傳輸相比；附
加KCDH機制的語音傳輸品質並不會因為有較
高的封包遺失率而容易造成語音通話品質下降
過多，而且平均封包間隔也比沒有 KCDH 機制
的語音傳輸來的較短，顯示在 WiMAX 語音傳
輸中附加 KCDH 機制不但可以提升安全強度，
更不會對語音傳輸造成任何負擔。 
 
 
圖 9  PCM 封包不同遺失率下封包到達時間間格的平
均數與變異數 
 
(2) 封包延遲時間：將 Dummynet 的延遲時間分別
設定成 50ms、100ms、200ms，藉此探討封包
延遲時間對於語音通話品質的影響。  
 
 
圖 10  iLBC 封包不同延遲時間下封包到達時間間格的
平均數與變異數 
 
 
圖 11  iLBC 封包不同延遲時間下封包到達時間間格的
平均數與變異數 
 
在語音傳輸過程中，封包延遲時間過長會造成
語音通話品質下降，且可能會造成回音。透過
本實驗結果(圖 10 與圖 11)可顯示，即使在語音
傳輸過程中附加了 KCDH 機制，對於語音通話
品質仍舊是沒有影響。 
 
(3) QoS 機制對於傳輸效能之影響：在 WiMAX 傳
輸環境中，比較有無設定使用 QoS 管控機制狀
況下，外部流量對於傳輸效能及傳輸延遲之影
響。 
 
