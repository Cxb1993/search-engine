基於 P2P SIP 環境下之網路語音廣告防堵系統 
A SPIT prevention system under P2P SIP environment 
 
摘 要 
隨著 Internet 的發展，未來的電信網路將是基於 IP 技術的網路，而 SIP 是新世代網路
標準組織所建議語音、視訊多媒體控制協定的首選。不過近年來所發生的 SIP 攻擊事件，
使得 SIP 安全性議題也漸漸浮上檯面。因此將 P2P 的觀念套用到傳統的 SIP 架構上，以期
能減少傳統的 SIP 架構被攻擊之風險。但網路電話的弱點還是會出現新一代的 P2P SIP 架
構，如：垃圾廣告語音（Spam internet telephony, SPIT），並且 SPIT 問題與通訊架構並無關
係，可能會形成和垃圾信件氾濫的情況。因此本研究透過 P2P SIP 架構建置適合此模式下
之網路語音廣告防堵系統，此系統可在 P2P 動態環境下，進行黑白名單同步更新與維護管
理。 
關鍵字：SIP、P2PSIP、SPIT、黑白名單 
 
基金項目：國家科學委員會專題研究計畫補助編號(NSC 96-2221-E-224-026-)、以及
TWISC@NCKU 補助編號(NSC 97-2219-E-006 -003) 
 
1. 引言 
近年來，由於網際網路與資訊科技不斷地發展，使得網際網路已成為現代人生活的重
心之一。從早期的電子商務、網路購物以及電子郵件，直到近期十分熱門的網路電話(Voice 
Over Internet Protocol, VoIP)。目前網路電話協定由 IETF(Internet Engineering Task Force)所制
定的 SIP(Session Initiation Protocol)為主。在傳統的 SIP 架構下，雙方通話之前會透過 Proxy 
Server 進行溝通，因此 Proxy Server 在 SIP 架構下是個非常重要的角色。若 Proxy Server 遭
受到攻擊，無法正常提供服務時，整個 VoIP 環境都會癱瘓。為了解決 SIP 架構的安全性問
題，已著手發展 P2P SIP 協定，亦即利用 P2P 架構補強傳統 SIP 架構上之不足。通過 P2P
的分散資源搜尋方式來取代 SIP Proxy，透過此機制，駭客不易掌握 Proxy Server 為網路上
的哪一個節點，不但增加 VoIP 網路的強韌性，也減少被駭客進行攻擊的機會。 
 
中小企業為了減少龐大的電話費及佈線複雜性，選擇引進 VoIP 的技術來取代傳統高成
本的電話交換系統。相對於廣告商而言，藉由 VoIP 廣告程式將錄製好的語音訊息，也就是
語音廣告或垃圾語音(Spam over Internet Telephony, SPIT)發送至各用戶端。倘若缺乏適當管
理和防堵語音廣告的機制，整個 VoIP 網路就會被無數的語音廣告所癱瘓。以往語音廣告的
防堵方式，大部份是透過黑白名單來防堵語音廣告，無論是將防堵機制放至使用者端或伺
服器端，都面臨一個很嚴重的問題，若名單資料的伺服器招受攻擊時，將會使整個防堵系
統失靈。 
 
 
2.2.2 SIP 社群網路 
 
SIP Social Network 是一種以信譽為基礎的機制，利用 SIP 社群來防堵垃圾郵件，在這
種網路架構透過名譽系統（Reputation System）做為防堵機制，這種機制應用於在一些不同
的區域，將使用者與一個可靠的社群互相建立信任，而在 SIP Social Network 就提出了一個
SIP Reputation Network 的網路架構。一個社群網路可視為一個連繫相同形態或者相互連結
的一群人，再從這群人的關係去繪製出一個以圖形來表示他們之間的關係，通常這些人都
是通訊軟體的好友名單或者通訊錄名單的集合，再經由使用者針對通訊名單的每位使用者
給予不同的名譽值（Reputation Value），在完成設定名譽值之後，可以將大家之間的關係以
圖形表示，並以此值大小作為判斷是否為語音廣告之依據。 
 
2.2.3 漸進式灰名單 
 
目前大多數之防堵之方式是透過黑白名單，若發話方不屬於黑白名單中時，則該通電
話該如何來處理？若使用者在短時間內發出成千上萬之語音連線，則該使用者正在惡意使
用網路電話的可能性相對提高很多，若能在伺服器端記錄使用者之連線習慣，則可以有效
防堵大量語音廣告。將使用者連線頻率區分成兩種類別，一種為短期使用頻率 (e.g., 1 
min) ，另一種則為長期使用頻率 (e.g., several hours or days) 。伺服器端設定使用頻率界限
值，若短期加長期使用頻率超過該值時，則將該使用者之連線請求中止，待使用者停止一
直連線之行為後，使短期使用頻率值降低，使其低於界限值時才允許使用者連線。 
 
3. 系統設計 
3.1 設計概念 
 
雖然已提出 P2P SIP 的架構，但其架構中尚未規劃語音廣告之解決方案，但可預計的，
在無伺服器管理之下的 P2P SIP 將會發生更嚴重的語音廣告。黑白名單資料要如何來透過
此架構進行名單同步更新與維護管理，以往透過伺服器加以更新與維護，但是在 P2P 環境
下，並無特定之伺服器存在，如何在變動的節點上，進行名單同步更新與維護管理，且有
效降低更新名單時所造成的廣播封包。 
 
3.2 系統架構 
 
研究架構可分為三大部份，第一部份是語音廣告防堵機制，第二部份是黑白名單同步
更新與維護管理，第三部份是超級節點失效恢復機制。 
 
表 1 黑白名單種類 
種類 項目 等級 
(1 最大) 說明 
個人化白名單 1 由使用者自行定義的白名單。 白名單 公認白名單 3 經由超級節點整合後所判定的白名單。 
個人化黑名單 2 由使用者自行定義的黑名單。 黑名單 公認黑名單 4 經由超級節點整合後所判定的黑名單。 
觀察白名單 5 使用者依通話結果設定之白名單。 觀察名單 
觀察黑名單 6 使用者依通話結果設定之黑名單。 
 
黑白名單之間運作的優先順序如下圖所示： 
 
圖 3 黑白名單運作流程 
 
3.2.1.2 灰名單 
 
但由於公認黑白名單產生需收集個人化黑白名單，若在短時間內產生大量語音廣告
時，則無法短時間內防堵此類型語音廣告。發話方與受話方要求進行通話時，其訊息都是
經由超級節點代為轉送，超級節點透過記錄用戶網路電話使用頻率，針對使用者網路電話
使用頻率，判斷是否為惡意行為。 
 
3.2.2 黑白名單同步更新與維護管理 
 
 黑白名單維護管理，負責整合與維護用戶端所傳送之個人化黑白名單。黑白名單同步
  
圖 5 同步更新公認黑白名單 
 
3.2.3 超級節點加入與失效恢復機制 
 
超級節點加入此系統時，除了進行公認黑白名單同步更新外，並且會取得失效恢復名
單。當某超級節點收到離開訊息或加入訊息後，確定有某超級節點離開或加入此系統時，
收到訊息之超級節點根據訊息內容修改失效恢復名單，並將此訊息內容傳給其他超級節
點，通知它們須修改失效恢復名單內容，維持名單一致。透過此名單找出下一個負責之超
級節點，避免因名單同步更新之超級節點失效而使名單同步更新與維護管理發生問題。 
 
圖 6 超級節點加入與失效恢復機制 
 
 
4. 實驗結果 
本研究目標以建置 P2P SIP 環境下之網路語音廣告防堵系統，提供本系統之使用者不
再受到語音廣告之干擾，考量現實網路環境中包含許多複雜難以量化因素，因此本研究透
過 Testbed@TWISC 網路安全測試平台，設計實驗環境之網路拓樸、網路速度及電腦數量。 
 
 
 
圖 8 網路拓樸-連線速度為 512Kb 
 
4.2 超級節點數量實驗 
 
測量超級節點數量是否會影響公認黑白名單同步更新時間，透過相同網路速度進行本
實驗。實驗參數：超級節點數量設定為 1、4、8 及 16 台，名單同步更新數量為 150 筆，用
戶端數量合計為 20 台，每種實驗組合將進行 100 次，將實驗結果求平均值及最差狀況(Worse 
Case,數據最差之 25%)平均值。實驗結果如圖 9。觀察名單同步更新時間，超級節點數量從
1 台提升至 4 台、8 台時，更新花費時間獲得明顯改善，但超級節點數量提升到 16 台時，
因超級節點過多，負責名單同步更新之超級節點，同時發送更新訊息的數量變多，使得封
包傳送時產生延遲，因此超級節點數量過多時，將使整體名單同步更新效能下降。 
 
 
圖 9 各種超級節點數量名單同步更新時間 
4.4 封包大小實驗 
 
由上述實驗結果得知，封包傳送數量會影響名單同步更新時間且影響程度超過線性，
若增加封包內更新名單數量，降低產生之封包數量，是否會影響名單同步更新時間。此次
實驗參數為：黑白名單同步更新數量為 10、30、90、150、300 和 450 筆，超級節點數為 4
台，用戶端合計為 20 台，封包內更新數量分別為 30 筆和 150 筆，若同步更新名單數量超
過封包內更新數量時，則更新名單數量須經過切割再分別傳送，每種實驗組合進行 100 次，
並將每次實驗結果求平均值及最差狀況平均值。實驗結果如下圖，影響名單同步更新時間
之重要因素為封包大小，同步更新名單數量為 150 筆時，封包內更新數量為 30 筆的情況下，
須將更新名單切割成 5 個封包後，再分別傳送更新訊息至其他超級節點及用戶端，與封包
內更新數量為 150 筆的情況下相比，更新名單不須經過切割，即可送出完成名單同步更新，
減少更新花費時間。 
 
 
圖 12 不同封包大小名單同步更新時間 
 
4.5 超級節點失效恢復時間實驗 
 
本實驗將透過二種不同網路速度，分別為 100Mb、512Kb，超級節點數量為 15 台，實
驗負責名單同步更新之超級節點失效時系統所需之恢復時間。若負責之超級節點離開時，
透過失效恢復名單優先順序來尋找下一個負責之節點，此過程所花費時間為本實驗數據。
實驗重覆進行 30 次，並將每次數據結果求平均值及最差狀況平均值。實驗結果如下圖，其
失效恢復時間與網路速度相關程度不大，且傳送單一封包花費時間相當短暫，縮短系統失
效時間，增強系統強韌性。 
 
參考文獻 
[1] 古東明、蔡嘉原、林皇伸、魏見安、陳曉蘭、陳麗紋，網路電話之垃圾廣告防堵機制
探討－採用兩階段黑白名單[C]//林宜隆，「網際空間：資安、犯罪與法律社會」學術研究暨
實務研討會：台灣師範大學，2006。 
[2] 賈文康，SIP 會談啟始協議操典[M]，台灣：文魁資訊，2005。 
[3] D. Shin, M.K. Consulting, J. Ahn, T. University, C. Shim, Q. Inc, Progressive Multi 
Gray-Leveling: A Voice Spam Protection Algorithm[J], IEEE Network, vol. 20, pp.18-24, 2006. 
[4] Fei Wang, Yijun Mo and Benxiong Huang, P2P-AVS: P2P Based Cooperative VoIP Spam 
Filtering[C]//Khaled Ben Letaief, WCNC, pp.3547-3552, 2007. 
[5] Ion Stoica, Robert Morris, David Karger, M. Frans Kaashoek, Hari Balakrishnan, Frank 
Dabek, Chord: A Scalable Peer-to-peer Lookup Service for Internet Applications[J], IEEE/ACM 
Transactions on Networking, vol. 11, pp.17-32, 2003. 
[6] J. Rosenberg, C. Jennings, The Session Initiation Protocol (SIP) and Spam[EB/OL], 2007, 
http://www.p2psip.org. 
[7] J. Rosenberg, H. Schulzrinne, G. Camarillo, A. Johnston, J. Peterson, R. Sparks, M. Handley 
and E. Schooler, SIP: Session Initiation Protocol[EB/OL], 2002, 
http://www.ietf.org/rfc/rfc3261.txt?number=3261. 
[8] K.K. Dhara, V. Krishnaswamy and S. Baset, Dynamic peer-to-peer overlays for voice 
systems[C]//Enrico Gregori, PERCOMW, pp.6, 2006. 
[9] M. Hansen, Countering SPAM over Internet Telephony (SPIT)[EB/OL], 2006, 
http://www.datenschutz-berlin.de/attachments/87/ifa-2006-Hansen.pdf?1171962898. 
[10] M. Zangrilli and D. Bryan, A Chord-based DHT for Resource Lookup in P2PSIP[EB/OL], 
2007, http://www.p2psip.org. 
[11] S. Cirani, L. Veltri, A Kademlia-based DHT for Resource Lookup in P2PSIP[EB/OL], 2007, 
http://www.p2psip.org. 
[12] S. Kundan and S. Henning, Peer-to-Peer Internet Telephony using SIP[C]//Wu-chi Feng, 
NOSSDAV, pp.63-68, 2005. 
 
 
 
 
表 Y04 
行政院國家科學委員會補助國內專家學者出席國際學術會議報告 
                                                          2008 年 11 月    日 
報告人姓名  
古東明 
 
服務機構
及職稱 
國立雲林科技大學 
資訊管理系副教授 
     時間 
會議 
     地點 
2008/10/16~2008/10/18 
 
中國北京交通大學 
本會核定
補助文號
 
會議 
名稱 
 (中文)2008 海峽兩岸信息科學與信息技術學術交流會議 
 (英文)2008 Cross-Strait Conference on Information Science and 
Technology 
發表 
論文 
題目 
 (中文)基於 P2P SIP 環境下之網路語音廣告防堵系統 
 (英文) A SPIT Prevention System by Black/White List for P2P SIP 
 
 (中文)基於 SIP 協定實現以攻擊樹為基礎之 VoIP 弱點檢測機制 
 (英文) SIP Phone Vulnerability Exam System Based on Attack Tree 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
表 Y04 
我們所投稿的兩篇論文被安排在論文發表的第一個 session 中口頭報告，會場中參與者眾
多，大陸研究生都踴躍提問，討論氣氛熱烈。 
第三天則是參訪北京交通大學、北京奧運公園、奧運場館、水立方等著名地標。主辦單
位接待熱誠，教師與研究生都很親切，三天的會議過程，有大量的互動，對於台海雙方
學術專長與專業術語起了很大的交流作用。與會學者專家都對明年在宜蘭主辦的第三屆
會議有更高的期待。 
 
二、與會心得 
這是我第二次到大陸參加研討會，這個研討會因為沒有強調國際性，與會人員都是
海峽兩岸的大學師生，北京交大身為主辦單位，對台灣的專家學者加倍熱誠，服務的師
生都很殷勤，真的有賓至如歸的感覺。 
北京交大雖然是所有交通大學中最晚歸隊的成員，其實它應該是交通大學中最早的
成員。設立於清朝(西元 1909 年)的鐵路管理傳習所，歷經鐵道專長的發展，北京鐵道學
院，北方交通大學，於西元 2003 年正名成為現在的北京交通大學。可能全球大部份交通
大學的校友們對它的瞭解都不多。現在正在計算機的領域中急起直追。由於才剛剛成立
研究生院沒幾年，但是博士班與碩士班的陣容都不小，而且仍在高速成長中。看到這樣
的情況，就有些擔憂台灣高等教育的發展，十年前還很有優勢，現在已經差不多被追平
了。台灣的腳步還要再快些。 
由於北京交大是鐵道專長的學校，大陸鐵道部門有許多的優秀校友。Keynote 演講
中，有一場是由北京交大工程學院的鍾章隊教授主講：「中國鐵路數字移動通信系統與高
速鐵路」令我印象深刻。由於中國的鐵路運輸是長程的主要交通工具，鐵路網綿密，運
量極高，國家科學院的鐵道專長學者享有尊崇的地位。過去幾年我有搭乘大陸鐵路的幾
次經驗，雖然對於台灣沒有的軟臥、硬臥、軟座、硬座感到新鮮，但是整體而言，大陸
鐵路運輸管理與技術落後台灣甚多。但是鍾章隊教授的演講提到高速鐵路的發展卻是令
人瞠目結舌，在短短的十年中，投入中國科學院的研發能量，以極低的價格引進德國西
表 Y04 
外，還可以廣邀港澳及新加坡的學者專家共同參與。除了可以有學術與技術上的交流，
還可以聯繫同文同種的華人們，一起壯大資訊科技的能量。不久的將來，也許我們都可
以看到亞洲的崛起，而華人就是主宰亞洲的關鍵族群。 
明年在台灣舉行，主辦的宜蘭大學如果能夠敞開胸懷，廣邀更多台灣的專家學者擔
任議程委員，將可以擴大這個會議的影響力與能見度。希望論文的質與量都不要被大陸
學界比下去了。 
 
五、攜回資料名稱及內容 
本次會議攜回資料有 
1. 全文論文集一本，內有所有論文的全文紙本 
2. 會議議程一本 
3. 大會合影一張 
 
六、其他(附上會議參加照片) 
 
與會人員大合照(前排左六教育部電算中心趙涵捷主任) 
