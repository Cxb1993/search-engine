業之競爭力。近年來，溫度控制應用領域大
致上包含了：工業溫度之調節、可燃性氣體
燃燒之溫度控制、暖氣設備之溫度控制、溫
室氣候之溫度控制及水溫控制等。就傳統的
控制方法來說，如：適應性控制[1]-[2]、非線
性控制[3]-[4]及電壓控制[5]等。近年來，由
於模糊理論（fuzzy theory）及類神經網路
（neural networks）的出現，對於控制問題上
已普遍成為一個更有效率的解決方法[6]。相
較於傳統控制方式，它們提供了一個主要的
有利形勢，即是不需要任何複雜的數學推導
過程。 
在類神經網路領域方面，主要利用多層
感知機（multilayer perceptron）的架構及有效
率的使用倒傳遞演算法則（backpropagation 
method），透過學習來不斷的調整網路中的
權值（weight），進而達到自我調整的優點，
有助於類神經網路技術能夠逐漸使用在控制
領域之中。但是，由於類神經網路全域調整
的特性，通常會導致過度調整（over-tuned）
的現象進而降低控制的效能。為了克服在網
路中的全域特性的缺點，我們利用小波函數
（wavelet function）來取代類神經中的活性函
數，此種網路我們稱之為小波類神經網路
（wavelet neural networks,WNN）。它能夠結
合了一般類神經網路的學習模式及利用小波
分解（wavelet decomposition）的能力，它主
要 特 徵 在 於 每 個 小 波 對 於 時 域
（time-frequency）皆擁有局部化特性，使得
小波函數能夠能被容易的逼近在任意的非線
性函數上。 
對於在控制領域中的動態控制而言，因
為動態系統（dynamic system）的輸出有可能
和過去的輸出或過去的輸入有關係，所以這
並不像簡單的靜態系統。如果採用前饋網路
（feedforward network），則我們應該必須提
前知道延遲輸入和輸出的個數，並且對網路
輸入供給這些延遲的輸入和輸出[7]。但是動
態系統的架構通常是不明確的，過多的延遲
輸入的使用將會增加輸入端的維度數，並且
會造成網路的過大問題。為了處理這個問
題，動態訊號處理系統必須使用遞迴網路架
構，而它近年來穩定生長，也有許多研究學
者已經提出了一些遞迴架構[8]-[10]。而我們
在網路中主要是藉由回授內部神經元連接現
有網路來完成他們的遞迴性質，達到內部記
憶體的功能。我們在本計劃提出了結合以上
優 點 的 遞 迴 式 小 波 類 神 經 模 糊 網 路
(wavelet-based recurrent neuro-fuzzy network, 
WRNFN)來解決溫度控制系統的問題。 
但其最大的問題在於透過軟體進行模
擬，往往因為運算量的問題，需要花甚多的
時間，這對於有即時運算需求的工作，造成
很大的困擾，因此，解決方法為利用硬體來
實現整個網路模型便可以獲得較快速的運算
效能，以達到即時應用的要求。 
在學習演算法方面，傳統的倒傳遞演算
法在訓練的過程之中，必須要花費較長的訓
練過程以及較高的困難度。同時，為了配合
在硬體實現上的成本考量以及學習演算法實
現的困難度，我們在本計劃中採用的是混合
式學習演算法，並且利用線上的模式來調整
歸屬函數的形狀與小波類神經網路的連結權
重值。 
在硬體實現方面，我們使用的是 Field 
Programmable Gate Array (FPGA)[11]-[13]，它
是一種在研發現場可立即規劃的多功能元
件；其內部是由許多邏輯閘及正反器(Flip 
Flop)所組成，經過規劃燒錄後，就可以完成
具有運算功能的 IC。它使用再次可程式開
關，取代了以往傳統的 PLD 元件使用的熔絲
開關。這些開關可以重複地使用去實行新的
設計，不用在每次更改完設計後就必須要在
買一個新的裝置，大大地減少設計成本，而
且因為是用單純的邏輯元件去設計電路，所
以程式執行的速度也比較快。它具備了上述
的優點，使得 FPGA 使用的場合十分普遍，
由於使用 FPGA 很容易地製作自己所需要的
系統，所以常常被應用在設計原型機
(Prototype)或少量的產品上。本計畫最後將
點中，只是把輸入訊號 xi直接傳輸
至下一層，即 
ii xu =
)1(
               (4) 
 
第二層：在這一層中每一個節點稱之為輸入
語 意 識 的 節 點 （ input linguistic 
node），本層之主要功能相當於模糊
控制中之模糊化介面，其歸屬值表示
一輸入值屬於一模糊集合的程度。在
這 層 中 我 們 採 用 高 斯 歸 屬 函 數
（Gaussian membership function），其
關係為 
    )
)(
exp(
2
2)2(
)2(
ij
ijij
ij
md
u
σ
−
−=   (5) 
其中 mij和 σij表示高斯歸屬函數
之中心點（center）及寬度（width），
此外，在第二層之中我們另外考量了
時間的因素 )2(ijd ，即 
)()()( )()2( tutxtd fijiij +=    (6) 
ijij
f
ij tutuwhere θ⋅−= )1()(
)2()(    (7) 
其中，我們利用了反饋權值
（feedback weight）θij與前一次的語意
識輸出值 )1()2( −tuij 做計算，使得網路
能夠保有前一次的資訊，以有效處理
動態系統問題上。 
 
第三層：在這一層中節點稱為法則節點（rule 
node），而每一個節點代表一個模糊
法則，此層完成模糊邏輯法則前建部
匹配工作，所以此模糊節點完成模糊
且（fuzzy AND）或積（product）運算，
在本計畫中，我們採用積運算，其輸
出如下 







 −
−== ∏∏
==
2
2)2(
11
)2()3(
)(
exp 
ij
ijij
n
i
n
i
ijj
md
uu
σ
              
(8) 
其中 n為輸入個數。 
 
第四層：在這一層中節點稱為接收節點
（receives node），主要是能夠同步接
收第三層輸出 )3(ju 及小波類神經網路
局部輸出 ljyˆ ，計算第 l個輸出 Yl。定
義 ljyˆ 如下 
∑
=
==
M
balj
u
1k
,
l
jk
l
j
)4(
wyˆ ϕ    (9) 
 
第五層：此層的節點稱為輸出節點（output 
node），在此層中，將完成解模糊化
（defuzzifier）動作並得到網路輸出。 
∑
∑
∑
∑
=
=
=
=
++
=
==
M
j
j
M
j
j
l
j
l
j
l
j
M
j
j
M
j
jlj
ll
u
uwww
u
uu
Yu
1
)3(
1
)3(
1.130.120.01
1
)3(
1
)3()4(
)5(
)( Lφφφ
  
(10) 
 
四、混合式學習演算法 
在本計劃的WRNFN模組中，我們為了讓
WRNFN的學習演算法架構可以更容易地被
FPGA實現，並且符合硬體成本的消耗以及可
以得到穩定的學習收斂效果，我們採用了混
合式學習演算法。它是由粒子群最佳化
(Particle swarm optimization, PSO)演算法[14]
與最小均方(least mean square, LMS)演算法
所組成。同時，為了符合市場的需求，在硬
體實現的架構中只有WRNFN中的後建部的
參數(小波類神經網路的連結權重值)，利用線
上(on-line)的方式作調整。 
 
4.1粒子群最佳化演算法 
在類神經網路中最常被使用的學習演算
法為倒傳遞演算法，但是倒傳遞演算法已經
被證實很容易會陷入到局部最佳解的狀況
中，沒有辨法確定目前所找到的解為最佳
解，所以我們選擇可以更容易找到整體最佳
解的粒子群最佳化(particle swarm 
optimization, PSO)演算法。它是一種進化式
的演算法，逐步的向最佳解移動，進而在訓
練結束時可以找到一個最接近期望輸出的最
佳解出現。PSO最早是James Kennedy 和
Russell Eberhart 這二位學者在1995年提出，
以模擬鳥群覓食的行為所構想出來的。 
當一個區域中的一群鳥在覓食，在這個
地區中只有一個地方有食物的存在，而這群
鳥只知道食物所在的方向，卻不知道食物確
 
圖四 FPGA的設計流程 
 
依照上述的步驟，可以來設計我們所要的
網路架構以及混合式學習演算法，由於錯誤
的修正相當方便，加上近年來半導體製作技
術不斷進步，FPGA 內部所含邏輯閘數量越
來越大，使得即使是複雜的網路架構，也能
更加的容易實現。 
 
5-2 設計方法 
a. 數值表示法 
本計劃在 FPGA 上所使用到的數值表示
方式是一種固定位元數[15]的方式。它可以針
對使用者的需要而決定位元數的大小，如此
一來便不會浪費掉多餘的硬體空間。它的表
示方式如下 
bas ⋅][            (18) 
S 代表符號位元，當 S = 0 代表數值為正
數，當 S = 1 代表數值為負數。a 表示整數位
元數。b 表示小數位元數。我們在本計劃中
所使用到的規格是 S4.12。說明範例如表一。 
 
表一  數值表示法說明(規格為 S4.12) 
 
Value     Data representation     Encoded value 
 
-1.34052   1 0001 010101110010   - 1.34033  
3.5234    0 0011 100001011111   3.52319 
-0.7231    1 0000 101110010001      - 0.7229 
 
 
b. WRNFN的硬體實現 
圖(五)是 WRNFN 的網路架構在 FPGA
上實現時的整體架構圖。首先，為了要配合
我們在 FPGA 上所採用的數值表示式，在
WRNFN 的硬體實現過程中，我們將會遇到
TSK 模組網路中的高斯歸屬函數的指數
(exponential) 運 算 與 小 波 類 神 經 網 路
(WNN)(圖六)的小波轉換單元(wavelet unit)
的 cosine 運算在硬體實現上的問題。 
 
圖五 WRNFN的硬體架構圖 
 
 
圖六 WNN的硬體架構圖 
 
在本計劃中，我們解決指數和 cosine 的
運算方法有兩種：一為查表法(Look-Up Table, 
LUT)，另一為泰勒展開(Taylor expansion)。
泰勒展開的方式如公式(19)-(20)， 
∑
∞
=
=+++++=
0
32
!!!3!2!1
1
n
nn
x
n
x
n
xxxx
e L   (19) 
)!2(
)1(
!6!4!2
1cos
2
0
642
n
xxxx
x
n
n
n∑
∞
=
−=−+−= L
(20) 
 
 
圖七 cosine函數實現方塊圖 
在圖七中表示的是硬體實現 cosine 函數
c. 混合式學習演算法的硬體實現 
本計劃所使用的混合式學習演算法的硬
體實現方塊圖如圖(十三)，針對於遞迴式小波
類神經網路模組的小波類神經網路的連接參
數值以 on-line 的狀態下使用 LMS 演算法作
學習及更新的動作。在硬體上實現的 LMS 演
算法主要分為兩個單元，分別是學習單元以
及修正單元。 
 
圖十三 使用混合式學習演算法的硬體實現架構 
 
a. 學習單元 
首先，我們透過誤差估算單元計算出
WRNFN 模組的輸出值與期望值的相差值，
並且將小波類神經網路的第二層與 WRNFN
的第三層輸出透過乘法器、除法器以及加法
樹的使用來實現公式(17)，最後再乘上學習因
子 η 就可以得到小波類神經網路的連接參數
值的更新量(圖十四)。 
 
圖十四 學習單元的硬體方塊圖 
 
b. 修正單元 
接著，我們可以利用這些參數更新量，
透過修正單元(圖十五)對於目前的對應的參
數值作修改的動作，在經過這兩個單元的反
覆學習來更新小波類神經網路的節點之間的
所有參數值之後，我們可以逐步得到較好的
收斂效果。 
 
圖十五 修正單元的硬體方塊圖 
 
六、水槽溫度控制系統 
考慮在一個離散時間內，單輸入單輸出
（SISO）的溫度控制系統[16]公式如下： 
040)(5.0
]1[)(
1
)1(
)()1( yeku
e
e
kyety Ts
ky
Ts
Ts α
α
α α
β
−
−
−
− −+
+
−
+=+  
.             (21) 
其中， α=1.0015e-4 、 β =8.67973e-3 且 
y0=25 ( c° )，u(k)表示電壓輸入，且電壓範圍
限制在 0~5V 間，取樣週期 Ts=30。控制結構
如圖(十六)所示，yref(k) 表示參考之溫度，yp(k)
表示目前的溫度，將兩者輸入至控制器，隨
後經由控制器輸出電壓 u(k)來當作水槽系統
之輸入，改變水槽目前之溫度。然而，控制
器輸入變數也伴隨著水槽系統的溫度狀況做
變動。 
 
圖十六、水槽系統控制結構圖 
 
針對控制器部分，我們使用 WRNFN 控
制器，為了能夠有效的處理在控制環境中無
法預料的轉變，我們利用了線上學習方法，
建構於直接式反向模組學習結構（direct 
inverse- modeling learning scheme，如圖十
七），然後定義學習樣本（yp(k)， yp(k+1) 及 
u(k)）個數，根據控制器中輸出 )(ˆ ku 及期望輸
出 u(k)之誤差 E(k)，逐步的修正控制器，使
誤差減至最小。 
u(k)
 
 
Water 
Bath System 
Controller 
y(k)
 
Z
-1 
y(k+1)
 
WRNFN 
