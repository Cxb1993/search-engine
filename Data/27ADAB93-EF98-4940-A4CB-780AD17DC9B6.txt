研究摘要(500字以內)： 
本計劃的研究成果是以FPGA實現穿戴式電極量測ECG及即時心率估計系統。由於使用
紡織電極之心電圖訊號量測容易受到受測者穿戴時因呼吸或走動所造成的干擾影響，致使
訊號品質嚴重衰減，因此將所量測到的訊號經類比至數位轉換後的處理，實為我們是否能
有效應用的關鍵。為此，我們提出了子空間追蹤方法以追蹤並消除基線電位的影響，然後
加以絕對值的運算以符合後續方法的需要，接著使用自我相關度的估計方法來估測心率。
為了達到能即時估計心率的需求，我們從Power Method 發展出適應性子空間追蹤技術，並
應用快速傅立葉轉換(FFT)來實現即時心率估計的相關分析。 
在硬體實現方面，前端類比電路為執行心電圖訊號的擷取、雜訊濾除及放大，並透過 
類比至數位的轉換將心電圖送入FPGA 作進一步的處理與分析。為了提高未來所設計出 
之硬體的運用彈性，我們將整體心電圖數位訊號處理的部分大致區分為幾個模組，以IP 
(Intellectual Property) 的概念來作設計，之後利用簡單的控制電路予以整合，最後將程式碼
編譯並下載至Altera EP2C35F672 Cyclone II FPGA 上以驗證我們所發展的系統。在最後，
我們將進行實際量測以檢視此即時心率估計系統的實用性。 
 
 
人才培育成果說明： 
參與計畫人員獲得了估計方法理論推導的觀念，並且應用 FPGA實現設計之系統與演
算法。由理論研究和 FPGA實作的過程進一步學習到通訊系統整合及生醫訊號處理之經
驗；從而發掘更多軟硬體相互支援所需注意的研究課題。 
 
技術研發成果說明： 
ECG顯示方面：可以正確的擷取出 ECG波型並且順利顯示於 FPGA 板上如圖一所示，
且顯示於 FPGA板上的 ECG波形與示波器相同，均可以完整的看出其 P、Q、R、S、T 波。  
計算心率方面: 採用人工計算，計算 R 波的間距，計算結果與 FPGA 計算相同，並可
以即時的計算心率顯示於 FPGA板的七段顯示器上。 
  
 
 
 
 
 
表 1：使用階乘法之適應性子空間演算法 
 
將上述之方程式帶入(2)，且利用 ( 1) ( 1) ( 2)p n n q n− =Φ − − 之關系式可得以下之方程式： 
 
( ) ( 1) ( 1) ( 2) ( 1) ( 1)Tp n p n q n q n n nα α δ= − − − + Φ − −  
(1 ) ( ) ( 1) ( )Tx n q n x nα+ − −  
 
由於 ( 1)q n− 與 ( 2)q n− 之夾角很小，因此可假設 ( 1) ( 2) 1Tq n q n− − = 且 ( 1) 0nδ − = 最後可推
導得一適應性子空間追踨的演算法，其表示如下： 
 
( ) ( 1) (1 ) ( ) ( 1) ( )Tp n p n x n q n x nα α= − + − −  
( )
( )
|| ( ) ||
p n
q n
p n
=                                            (4) 
 
之後將所接收之訊號 ( )x n 投影到訊號相對應之主子空間 ( )q n 上以求出訊號基線飄移之成分
( )b n ，藉由下列關系式： 
( ) ( ) ( ) ( )Tb n q n q n x n=                                       (5) 
由此即可求得 ECG 訊號之基線飄移成分，以提供所量測呼吸訊號之比較與修正。適應性子
空間追踨方法整理如表 1。 
將量測到的 ECG 訊號去除基線飄移成份後，其訊號已能清楚地觀察出 R-R 區間的波
形。但事實上由人體所接受到的心電圖訊號其峰值到峰值之間的時間並不一致，若使用者
的心率有了劇烈的變化，我們不法在第一時間內由頻率去觀察出其改變；因為一次心跳到
下一次心跳的時間即時忽然加大，在頻譜上也會被平均掉其特性而需要一段時間才能顯示
出來。在此我們利用自我相關方法(Auto-Correlation Method)直接去估測訊號中每次心跳的
時間差。相關方法是利用訊號其自我相關度 
 
(0) [1,0 0] ; (0) ;0 1T α= = ≤ ≤q p 0L
For Each Time Step Do:
Input : ( )
( ) ( 1) (1 ) ( ) ( 1) ( )
( )
( )
( )
( ) ( ) ( ) ( ) :  baseline wander
T
T
n
n n n n n
n
n
n
n n n n
α α= − + − −
=
=
x
p p x q x
p
q
p
b q x q
*Input : ( )
( ) { ( )}
( ) ( ) ( )
( ) { ( )}  Find maximum value 
1
Heart - rate = 
j
j j j
r
j
r r
n
Y e FFT y n
C e Y e Y e
c n IFFT C e
ω
ω ω ω
ω
τ
τ
=
=
= →
y
 
表 2 即時心率估測演算法 
 
Baseline Wander Removal
Module
Absolution
Module
Heart Rate Estimation
Module
Seven-Srgment Control 
Module
ADC Control
Module
MUX 4x1
MUX 4x1
LCD Control
Module
RAM
RAM
RAM
I/O
Dout
12
BUSY
BWR_out_available
12
BWR_out
abs_out_available 12 abs_out
HRE_out_available
9 9
SQI_out HRE_out
I/O
I/O
8
LCD_DATA
LCD_in_available
 
圖三、即時心率估計器的模組設計 
 
首先針對基線漂移的去除，一個適合基線漂移去除的演算法涉及了計算連續執行，因
此，需要一個控制單元决定一個平方根操作的過程，如内積，向量的增加等等，控制電路
被作為一個有限狀態機實現(finite state machine，FSM)，有四個狀態被引用去控制基線漂移
去除演算法如圖四所示。第一個狀態，Idle，是處理器什麼都不做的重新設置狀態和等待開 
始的基線漂移去除模組；第二、三、四狀態分別為 inputBWR、computeBWR 及 outputBWR，
工作頻率的基線漂移去除模組和心率估計模組被設置為 6MHz。經驗上，向量的長度設定為
40 個 words，在保存數據上採用三個 RAM。這三個向量 x(n), p(n) 及 q(n)分別是 12 位元， 
26 位元和 10 位元。資料在 inputBWR 期間時，有必要等待上升觸發的同步信號，以確保轉
換的 ECG數據已完成，資料接收完成後，數位化的 ECG信號將被接收到 RAM 保存。在
computeBWR 期間，因為取樣率設為 200Hz 和每個取樣是 12 位元，我們將更加重視硬體資
源利用的速度，而不是設計時的結構體系，因此，它是一個動態比例分配數據路徑的每個
模塊是很重要的硬件實現，並會嚴重影響整體性能。我們按比例提高 q (n)為 210 和正歸化
内積到原始的 1/1024，它可以很容易地藉由位移(Shift)10 位元去糾正並且避免弄錯最後結
果，因為 q (n) 每個成分通常是少於一。 
 推廣及運用的價值： 
(如增加產值、增加附加價值或營利、增加投資/設廠、增加就業人數………等。) 
(1) 改良傳統黏貼式電極透氣性不良而無法久戴的缺點，且可穿戴式電極可以無限次
使用，長期使用上可兼具環保與降低醫療廢棄物。 
(2) 使大部份的老人或病患增加穿戴 ECG監測系統的意願，對於一些年紀較大且有慢
性病患的老人可以長期追蹤並予以最適當的治療。 
(3) 以 FPGA實現訊號處理，未來可作成 IC，減少量測電路面積，未來可延伸至 SOC，
將所有量測的功能都能在一顆 IC 上實現，未來可結合手機，使國人都可以自
我量測心率(HR, Heart Rate)，進而可得心率變異度(HRV, Heart Rate 
Variability)，HRV是各項慢性病的指標，隨時注意自已的健康，早期發現早期
治療，籍而延長國人的壽命。  
 
※ 備註：精簡報告係可供國科會立即公開之資料，並以四至十頁為原則，如
有圖片或照片請以附加檔案上傳，若涉及智財權、技術移轉案及專
利申請而需保密之資料，請勿揭露。 
