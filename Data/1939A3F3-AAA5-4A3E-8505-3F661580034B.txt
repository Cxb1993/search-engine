 I
植基於視訊影像分析與 RFID 定位之精神病患管理系統(3/3) 
計畫編號：NSC 96－2221－E－006－018 
執行期限：96 年 8 月 1 日 至  97 年 7 月 31 日 
主持人：詹寶珠   國立成功大學電機工程學系 
摘要 
本計畫在於開發出一套精神病患照護系統幫助醫療人員管理、監控精神病患之日
常行蹤，一來以協助醫護人員掌握病患之活動範圍達成有效管理，二來可協助分析精
神病患之活動狀況，以瞭解其行為之偏好並藉以偵測異常情形。 
在研究方法部分將會利用 RFID 定位，結合 video 影像分析，以記錄病患之蹤跡並
以視訊影像判斷病患活動，以達到結合定位與視訊的病患管理。計畫為了病患蹤跡記
錄，將測試三套依據不同 RFID 產品規格所做的定位系統，分別依據定位所需之粗細
與以測試，找尋理想之架設設備組合。在蹤跡分析部分將以統計熵值法等方式，歸納
病患之軌跡頻率及規則性。計畫中並將利用室內各重點架設之視訊設備，擷取連續影
像，以分析醫師所指定之數種需特別留意之行為動作，以協助醫護人員預防病患引發
之危險行為。 
基於計畫第一、二年在成大醫院心理健康中心的 RFID 系統所得之成果，在計畫
第三年，我們提出了動態幅度調整定位 (Dynamic Range Adjustment Localization, 
DRAL)演算法，可以對精神病患做有效及可靠之定位，此研究成果將可協助視訊影像
做病患的活動分析，並促進醫護人員對病患的有效管理。 
關鍵詞︰ 精神病患照護系統、RFID 定位、視訊影像處理 
 III
目錄 
摘要 .............................................................................................................................................I 
Abstract ..................................................................................................................................... II 
目錄 .......................................................................................................................................... III 
圖目錄 ...................................................................................................................................... IV 
表目錄 ...................................................................................................................................... IV 
緣由與目的 ................................................................................................................................ 1 
研究方法與成果 ........................................................................................................................ 2 
1 現存 RFID 定位方法介紹................................................................................................. 2 
1.1 LANDMARC 方法 ................................................................................................ 2 
1.2 Jin 的方法 .............................................................................................................. 3 
2 動態幅度調整定位(Dynamic Range Adjustment Localization, DRAL)演算法 .............. 3 
3 功率-距離模型參數校正................................................................................................... 4 
4 定位方法 ............................................................................................................................ 6 
5 RFID 定位實驗結果.......................................................................................................... 7 
6 視訊分析 - 三維行走姿態估測..................................................................................... 11 
6.1 肢體特徵(Skeleton vector)定義 .......................................................................... 11 
6.2 CART with Gradient TreeBoost ........................................................................... 12 
6.3 三維姿態估測實驗結果 ...................................................................................... 13 
計畫成果自評 .......................................................................................................................... 14 
參考文獻 .................................................................................................................................. 15 
 1
緣由與目的 
本計畫在於開發出一套精神病患照護系統幫助醫療人員管理、監控精神病患之日
常行蹤，一來以協助醫護人員掌握病患之活動範圍達成有效管理，二來可協助分析精
神病患之活動狀況，以瞭解其行為之偏好並藉以偵測異常情形。 
在研究方法部分將會利用 RFID 定位，結合 video 影像分析，以記錄病患之蹤跡並
以視訊影像判斷病患活動，以達到結合定位與視訊的病患管理。計畫為了病患蹤跡記
錄，將測試 RFID 所做的定位系統依據定位所需之粗細與以測試找尋理想之架設設備
組合。在蹤跡分析部分將以統計熵值法等方式，歸納病患之軌跡頻率及規則性。計畫
中並將利用室內各重點架設之視訊設備，擷取連續影像，以分析醫師所指定之數種需
特別留意之行為動作，以協助醫護人員預防病患引發之危險行為。 
在目前競爭激烈的社會中，人們多數承受著過大的工作或是生活壓力大，加上現
代人人際關係薄弱互動有限，當這些壓力找不到適當的舒解管道時很可能產生精神疾
病，影響日常生活或是工作，更嚴重者常造成社會問題。 
當精神病患者在急性發病 (嚴重的妄想或幻聽、嚴重自殺危險、無法照顧自己、
或有酒精及藥物濫用問題) 時則需密集治療，有時包括住院治療。而精神病患在住院
治療過程中，常會有無法控制自己行為而傷害別人，或對周遭環境感到混亂和無法理
解，而使自己陷入危險的情況，或是妄想的情形傷害自己或他人。因此，不同一般因
生理疾病而住院的病患，醫護人員需要掌握每位病患的狀況以防止意外的發生。如患
有妄想症的病患會有破壞、自傷、自殺、傷人、他殺之傾向或行為，因此需注意這樣
的病患是否有靠近工具間、廚房、或是在某一場合滯留過久的情形。而有自殺傾向的
病症患者在高樓層時，需注意是否有靠近窗戶的情形，對於周遭環境感混亂的病患也
需注意他是或有走出看護場所的情況發生，本計畫稱上述列舉的情形為異常行為。 
然而在有限的醫療資源下，利用人員隨時注意每位病患的一舉一動及所在位置，
將是耗時及沒有效率的方式。因此，對於精神病患的住院管理上，若能輔以一套精確
的病患活動定位結合視訊分析系統，將使醫護人員在掌控病患行為及位置有較佳的效
率，使醫護人員能迅速知道病患的所在位置，是否於院內的那一個空間或是未經同意
離開醫院。並且能針對特定病患設定警告範圍，用以偵測病患是否接近警告範圍中，
使醫護人員對意外狀況的預防，同時長時間的記錄精神病患的活動軌跡、發病記錄，
分析病患發病的地點、時間，應用此資料協助醫生瞭解病患之病情。 
本計畫目標在於設計一結合定位與視訊分析之輔助精神病患照護系統，以應用於
精神病患醫療照護環境之中。利用本計畫之技術，醫護人員能正確地掌控病患在照護
環境的位置，並記錄每天病患的活動情況瞭解病患活動，偵測其危險異常行為。醫護
人員亦能利用相同技術，針對病患設定警訊範圍，當病患發生走失、靠近危險場所、
或非經許可離開醫療院所時，讓應用系統能發出警告通知相關醫護人員。同樣地，其
他相關的精神照護機關、療養院也能透過此計畫所發展的系統增加其工作效率、減少
 3
1.2 Jin 的方法 
Jin 的方法也是取與目標標籤功率距離最小的 k 個參照標籤，並以三角測量
(Triangulation mechanism) 估 算 此 k 個 參 照 標 籤 的 位 置 ， 並 計 算 平 均 誤 差
)1,1(),(
11
∑∑
==
ΔΔ=ΔΔ
k
i
i
k
i
i yk
x
k
yx 以校正使用三角測量估算的目標標籤位置。 
2 動態幅度調整定位(Dynamic Range Adjustment Localization, DRAL)
演算法 
本計畫所提出之演算法是依目標標籤(Target Tag)與多個定位器(Field Generator)的
距離以三角定位方法為基礎來求出的最佳位置。因此首要之務為求出目標標籤與定位
器的距離。半主動 RFID 的運作機制是由定位器發送夾帶定位器編號的 RF 訊號觸發訊
號範圍內的標籤，再由標籤發送夾帶定位器編號與標籤編號的 RF 訊號回報給讀取器
(Reader)。讀取器由接收到 RF 訊號確認目的標籤在某個定位器範圍內。為了取得標籤
與定位器的距離，因此我們假設定位器多夾帶了發送功率級別(power level)[5]，在我
們的系統定了 1-10 等十級的功率級別。 
根據文獻[7]可知功率-距離模型可由下式表示: 
 nd d
PP ∝ , 66.1 ≤≤ n , (2) 
其中 P 為來源功率大小， dP 為傳輸距離 d 後的殘餘功率大小。文獻[7]也提到，路
徑損失指數(path loss exponent) n 會因環境的不同而有差異，如表 1 所示。而從第 2 節
的介紹可知，LANDMARC[5]與 Jin[2]的方法都未考慮環境因素對路徑損失指數的影
響，基於此，我們提出動態幅度調整定位(Dynamic Range Adjustment Localization, 
DRAL)演算法，依不同環境因素彈性校正路徑損失指數 n 而動態取得功率級別的傳輸
幅度。 
表 1 不同環境下的路徑損失指數 
Environment Path Loss Exponent, n
Free space 2 
Urban area cellular radio 2.7 to 3.5 
Shadowed urban cellular radio 3 to 5 
In building line-of-sight 1.6 to 1.8 
Obstructed in building 4 to 6 
Obstructed in factories 2 to 3 
校正路徑損失指數 n 是由己知固定位置資訊的參照標籤(Reference Tag)來進行校
正。籍由校正的路徑損失指數 n 將目標標籤(Target Tag)所收到的功率級別轉換成與定
 5
 
圖 2 定位器與參照標籤示意圖 
由公式(4)的可知功率-距離模型包含路徑損失指數 n 與比例參數 C。對同一個定位
器而言，其環境因素相近，因此我們假設定位器 i 具有相同的路徑損失指數 ni與比例
參數 Ci。在此假設下，若定位器 i 附近有 k 個參照標籤，如圖 2 所示，且己知定位器
i 的路徑損失指數為 xn ，則由公式(4)我們求得參數 xiC , 的平均解為 
 ∑
=
=
k
j
ij
n
ijxi Ldk
C x
1
, /
1  (6) 
我們可由 xiC , 推算定位器 i 與參照標籤 j 的路徑損失指數 xijn , 為 
 )(,
,log xiij
ij
CL
dxijn =  (7) 
而且我們希望最小化 xijn , 的變異度(因為定位器 i 具有相同的路徑損失指數 ni，即
iilij nnn ≈≈ )。因此由公式(6)(7)我們定義一參數成本函數 )( xnf  
 ( )∑
=
−=
k
j
xxijx nnnf
1
2
,)( , (8) 
其中 xijn , 由公式(6)、(7)求得， ∑
=
=
k
j
xijx knn
1
, / 。 
由表 1 可知路徑損失指數 n 的值介於 1.6~6 之間，因此為了校正定位器 i 的參數
ni與 Ci，本論文採用兩階段逼近求解路徑損失指數 in : 
階段 1： 求路徑損失指數整數解 'in  
令 xn =1,2,…,6 
)(minarg' x
n
i nfn
x
=  
階段 2： 求路徑損失指數 in  
令 xn = 1'−in  to 1'+in  step 0.01 
)(minarg x
n
i nfn
x
=  
再由下式求解比例參數 Ci: 
：定位器 ：參照標籤 ：目標標籤
RTj
FGi
dij
(Fxi, Fyi)
(Rxi, Ryi)
(Tx, Ty)
 7
 
⎪⎪⎩
⎪⎪⎨
⎧
−−=∂
∂
−−=∂
∂
∑
∑
=
=
h
i it
it
i
h
i it
it
i
d
dFyTy
Ty
TyTxf
d
dFxTx
Tx
TyTxf
1
1
)ˆ1)((2
),(
)ˆ1)((2
),(
 (13) 
因此依據梯度下降(gradient descent)法則，目標標籤坐標的更新量為 
 
⎪⎪⎩
⎪⎪⎨
⎧
−−−=Δ
−−−=Δ
∑
∑
=
=
h
i it
it
i
h
i it
it
i
d
dFyTyy
d
dFxTxx
1
1
)ˆ1)((2
)ˆ1)((2
η
η
 (14) 
其中η是每次更新的比例參數。反覆更新目標標籤坐標直到成本函數 ),( TyTxf <容許成
本，便可求得目標標籤的坐標 ),( TyTx 。 
5 RFID 定位實驗結果 
為了驗證本計畫提出之動態幅度調整定位(DRAL)演算法，我們建構在一個 10 公
尺 x 10 公尺的模擬空間，平均配置 4 個定位器(Field Generator)及 25 個參照標籤
(Reference Tag)，如圖 4 所示。 
 
圖 4 實驗環境(4 個定位器，25 個參照標籤) 
同時我們也為了比較本計畫提出之方法與其它現存方法的準確性，因此我們利用
公式(1)實作了 LANDMARC[5]的方法；並使用公式(1)及利用與目標標籤功率距離最小
的 k 個參照標籤的平均誤差校正來實作 Jin[2]的方法，其中 k=4，以利後續實驗比較之
用。實驗中的誤差計算使用尤拉(Euclidean)距離，若實際目標標籤位置坐標為 ),( ii yx 而
：定位器 ：參照標籤
 9
個數從原本配置的 25 個降低為 9 個，並平均配置於模擬環境中，如圖 7 所示。 
 
圖 6 平均誤差比較圖表(25 個參照標籤)) 
 
 
圖 7 實驗環境(4 個定位器，9 個參照標籤) 
：定位器 ：參照標籤
路徑損失指數 n 1.6 2.0 4.0 6.0 
 LANDMARC 0.55218 0.59757 1.01191 2.01339
 Jin 0.55218 0.59757 1.00781 2.00854
 DRAL 0.35717 0.52832 0.86689 1.25510
平均誤差
(公尺
) 
2.5 
 
2.0 
 
1.5 
 
1.0 
 
0.5 
 
  0 
10mx10m 
4 個定位器 
25 個參照標籤 
 11
6 視訊分析 - 三維行走姿態估測 
在成功以 RFID 定位病患位置後，我們以視訊影像分析病患的動作；為了使動作
分析不受自體遮蔽(self-occlusion)及相機拍攝角度的影響，我們需要取得肢體的 3D 位
置。以視訊影像來獲取物體 3D 資訊有二種主要作法，一種為多相機(multi-view)，一
種為單相機(single-view)。由於多相機的作法在架設相機及計算各種相機幾何參數上比
較耗時且彈性小，因此我們採用單相機及 Learning-based 的方法來進行研究。
Learning-based 的方法是利用迴歸(regression)的方式，從大量訓練資料中找出 2D 影像
上的特徵與 3D 姿態參數間的關係式，之後，利用這個關係式即可把未知的 2D 動作對
映到其相對的 3D 姿態參數。由於人的動作種類繁多，我們以最普遍且一致性高的行
走動作做為分析目標，成功取得的行走三維姿態將可做為初始其他複雜動作的依據。 
本計畫提出的三維行走估測其架構圖如圖 9 所示。我們利用 POSER [21] 合成出
各種行走姿態的 3D 模型，並利用多支虛擬相機取得行走時各個角度的 2D 影像。接
著，利用我們定義在 2D 影像上的特徵(skeleton vector)及其對應的 3D 模型關節角度，
我們找出他們之間的迴歸函數。在測試階段(Testing Stage)，我們利用 particle filter 追
蹤頭、軀幹及下半身，並依此找出 skeleton vector，再依訓練好的迴歸函數得出肢體
3D 關節角度。三維行走姿態估測的細節，分節敘述如下。 
 
圖 9 三維行走估測架構圖 
6.1 肢體特徵(Skeleton vector)定義 
我們以 19 個向量來代表肢體特徵，如圖 10 及圖 11 所示。其中，前八組向量用
來表示同一時間點各肢體部位的相對位置，後九組向量用來表示相鄰影像間肢體的位
 13
對映關係，我們以下式來代表 F(x)。 
 { }
⎥⎥
⎥⎥
⎦
⎤
⎢⎢
⎢⎢
⎣
⎡
==
∑
∑∑
=
=
= M
0m m
p
m
M
0m m
l
mM
0m
m
p
m
1
m
)R,Ah(x;
...
)R,Ah(x;
)R,A,...,Ah(x;  F(x)   (16) 
最後我們以 Least square 的方式加入求解 F*(x)，演算法如下： 
For End
),k,a,a(x;h (x)F(x)F   
)}(xF-mean{y , )}(xF-mean{ya,a   
))k,,a,a;(xh-y~(minargmin,k   
N1,i , )(xF-y)y~,,y~(y~   
do M  to1mFor 
Square(LS)Least   }mean{y(x)F
mm2m1ms1-mm
)(xf:ii1-mi)(xf:ii1-mi2m1m
2N
1i 21is
1
im
p
1j a2a1,k,mm
i1-mi
p
im
1
imim
N1,ii0
i
k
i
k
θν
θθ
θθ
θ
+=
=
=
===
=
=
≥<
==
=
∑∑
KL
K
 
6.3 三維姿態估測實驗結果 
為了呈現實驗結果，我們將經由迴歸算得的各 3D 關節角度套用到 3D 人型模型，
再將 3D 模型投影回原 2D 影像。圖 12 上半部呈現投影回影像上的肢體部位，下半部
則呈現對應的 3D 模型行走動作。 
 
圖 12 姿態估測結果 
 15
參考文獻 
[1] F. Wu, F. Kuo, and L. W. Liu, “The application of RFID on drug safety of inpatient nursing healthcare” 
ACM International Conference Proceeding Series; Vol.113, 2005, Page(s): 85-92 
[2] G. Y. Jin, X. Y. Lu, M. S. Park, "An Indoor Localization Mechanism Using Active RFID Tag " IEEE 
International Conference on Sensor Networks, Ubiquitous, and Trustworthy Computing, 2006. Vol. 1, 
05-07 June 2006, Page(s):40 – 43 
[3] H. D. Chon, S. Jun, H. Jung, and S. W. An, “Using RFID for Accurate Positioning” Journal of Global 
Positioning Systems, 2004, Vol. 3, No. 1-2, Page(s): 32-39 
[4] K. Michael, and L. McCathie, “The Pros and Cons of RFID in Supply Chain Management” 
International Conference on Mobile Business, ICMB. 11-13 July 2005, Page(s):623 – 629 
[5] L. M. Ni, Y. Liu, Y. C. Lau and A.P. Patil, "LANDMARC: indoor location sensing using active RFID", 
Proceedings of the First IEEE International Conference Pervasive Computing and 
Communications,2003.(PerCom2003). 23-26 March 2003, Page(s):407 – 415 
[6] S. Haykin, “Neural networks: a comprehensive foundation,” second edition, Prentice Hall, 1999. 
[7] T. S. Rappaport, “Wireless Communications: Principles and Practice”, 2nd Edition, Prentice Hall PTR, 
2002 
[8] V. Kulyukin, C. Gharpure, J. Nicholson, and S. Pavithran, “RFID in robot-assisted indoor navigation for 
the visually impaired” Proceedings  of IEEE International Conference on Intelligent Robots and 
Systems, (IROS 2004). 28 Sept.-2 Oct. 2004, Vol. 2, Page(s): 1979- 1984 
[9] Landt J, “Shrouds of Time: the history of RFID.”, Report for the Association of Automatic Identification 
and Data capture Technologies (AIM). 
[10] Foster P.R. and Burberry R.A. “Antenna problems in RFID systems” RFID Technology (Ref. No. 
1999/123), IEE Colloquium on 25 Oct. 1999 Page(s):3/1 - 3/5 
[11] Siden J. , Jonsson P. , Olsson T. and Wang G. “Performance degradation of RFID system due to the 
distortion in RFID tag antenna” Microwave and Telecommunication Technology, 2001. CriMiCo 2001. 
11th International Conference on 2001 Page(s):371 – 373 
[12] Xiang Zhou and Gang Wang “Study on the influence of curving of tag antennas on performance of 
RFID system” Radio Science Conference, 2004. Proceedings. 2004 Asia-Pacific 24-27 Aug. 2004 
Page(s):54 – 57 
[13] Fukumizu Y. , Nagata M. , Ohno S. and Taki K. “A design of transponder IC for highly collision 
resistive RFID systems” Advanced System Integrated Circuits 2004. Proceedings of 2004 IEEE 
Asia-Pacific Conference on 4-5 Aug. 2004 Page(s):438 – 439 
[14] Waldrop J. , Engels D.W. and Sarma S.E. “Colorwave: an anticollision algorithm for the reader collision 
