2(I) 第一子題(第一年)：多變數系統下以操作數據引導式之 PLS的 Run-to-Run控制
設計
Abstract
This work focuses on the modification of the PLS (partial least squares) modeling. The
new method allows incorporation of a dEWMA (double exponentially weighted moving
average) control algorithm into the standard run-to-run controller design for
semiconductor processes. The resulting structure of the PLS model can extract the
strongest relationship between the input and the output variables. It is particularly useful
for inherent noise suppression. In addition, the resulting non-square MIMO control
system can be decomposed into a multi-loop control system by employing
pre-compensators and post-compensators of the PLS model, which is constructed from
the input and output loading matrices. Subsequently, the conventional dEWMA controller
can be separately and directly applied to each SISO control loop. The performance of the
proposed method is illustrated through a chemical-mechanical polishing process in the
manufacturing of the semiconductor.
Keywords: chemical-mechanical polishing, partial least squares, run-to-run control
I. Introduction
In recent years, both industry and academia had a strong interest in the development and
application of run-to-run (RtR) feedback control in the semiconductor manufacturing
industry [1-3]. The RtR control is used to adjust a recipe that contains the setpoints of the
inputs, produces the proper output product and reduces variability in the output product.
Although there are numerous ways to design an RtR controller, the most widely
implemented design is the exponentially weighted moving average (EWMA) scheme.
Basically, RtR process control consists of two major steps. First, a linear regression
model is updated based on the available in-situ and ex-situ measurements of the past runs.
The model relates the input variable to the output variable. This static model was often
used in the literature [4-5]. The second step in the RtR control determines a control action
based on EWMA, giving different weights to measurement data from the past runs. The
computed RtR controller is used to get the desired values or improve the performance for
the next run. It has been applied to chemical mechanical polishing (CMP) [4] and plasma
etching [6]. However, with aging of the process, the existing EWMA RtR controllers
cannot handle process drifts or ramp disturbances in a proper manner. As a result, offset
in the process outputs sometimes occurs. The double EWMA (dEWMA) controller was
4adaptive RtR controller, based on the decomposition of PLS related models for the
multi-loop control problem, has not been addressed, to a large extent, in the past research.
It is our aim to elaborate on the PLS based RtR controller for MIMO non-squared
semiconductor processes in this research.
Linear
Controller (C) Process
Linear
Model (M)
Output
Setpoint Disturbance
Output
+
+
Updated Process
Parameters
Fig. 1. A typical RtR controller.
2. MIMO RtR Control Problem
A typical RtR controller is illustrated in Fig. 1. MIMO RtR control is similar to SISO RtR
control, but there are M inputs or controllable factors and N outputs or responses. The
linear model that needs to be controlled can be considered as the linear combination of
the process inputs ( x ), a deterministic offset (α) and uncorrelated noise (ε) [5],
kkk k εδβxαy  1 (1)
where  TkMkk xx ,,1 x denotes the vector of the input recipes,
 TkNkk yy ,,1 y denotes the vector of the output variables,  TkNkk ,,1  ε
denotes the process disturbance with the white noise sequence, k is a run number, δ is
a vector equal to average drift rate per run, α is a vector of the offset parameters, and β
is a process gain matrix. On account of the equipment aging or process disturbances, the
process may drift or shift over time. The EWMA filter used to update δ and α is
basically a weighted average of the previous estimate of the process drift (and shift) and
its current calculation
)()( 1111   kkkk BxyαIα (2)
and
6residual matrix that is not useful for describing Y , and F contains the part that cannot
be related to X . R is the number of principal components that can be defined by some
heuristic and other statistical methods [20,21]. The relationship between X and Y is
represented as a linear algebraic relation between their scores T and U . The inner
relationship of the score matrices can be constructed as
   TBttuuU  RRR bb  111 (7)
where B is a diagonal matrix containing the regression coefficients ( ib ) of the score
model.
W










Rb
b

1
CV H
x yt u
Process
Input
Rotation Output
Rotation
Fig. 2. Diagonalize the MIMO process.
On account of its simplicity and easy interpretation, the applications of this approach
can be found in an abundant of literatures [22,23]. Currently, after the MIMO regression
process is calculated by PLS, it is broken into a series of univariate regression processes
(Fig. 2). The process is post-multiplied by the matrix H and pre-multiplied by the
matrix V ,
      RTRRTTT qqqIqqIqqIcqqIqH 1122112111  
       RTRRTTT wwwIwwIwwIwwwIwV 1122112111   (8)
where WV because the vectors iw are mutually orthogonal. After projections, the
transformations of output Y and input X are expressed in terms of iu and it
respectively,
 RuuuYH 21
 RtttXV 21 (9)
The resulting transformed inputs T and outputs U are next completely decoupled.
The PLS decomposition of the MIMO process is useful when a conventional SISO RtR
82
1
2
1,
2
11,
2
11,
2
1
min
2
1
min
2
1
)()(min
2
1
)()(min
2
1
min
2
1






k
set
kPLS
set
PLS
k
set
kPLS
set
PLS
kkPLS
setset
PLSk
kk
k
kk
J
ffyτ
ffyτ
fyfτyτ
xx
x
xx
(10)
Process
Output
Setpoint
Disturbance
Output+
+
Updated Process
Parameters
V H
H










RM
M1











RC
C1

setu
u
x y










RdEWMA
dEWMA1

+t
Fig. 4. The structure formulation of the PLS-based dEWMA RtR controller.
where 


R
r
r
set
r
set
PLS u
1
qτ and 

 
R
r
rkrkPLS u
1
1,1, qy . Assuming that the difference of the
projection errors coming from the random noise or the insignificant disturbance
variations can be neglected,
2
1,min2
1
 kPLSsetPLS
k
J yτ
x
. A one-step ahead output can be
predicted since the objective function involves a term in the future of the next run; that is
to say that, 1,1, ˆ   krkr uu , because 1,. kru is not available at time k,
10
noise and update one or more parameters in the process model. The update is needed
because the developed models are not always accurate or the process model is subject to
changes due to the disturbances in the process.
Similar to a SISO dEWMA controller, the observer assumes that each output score is
the linear combination of the corresponding input score, a deterministic offset and a
deterministic trend disturbance,
iM : krkrrkrkr ntbau ,1,,,ˆ   (13)
where the bias term kra , is recursively estimated at each run according to the traditional
dEWMA filter
1,1,1,,1,, )1()(   krrkrrkrrkr atbua  (14)
and the trend estimation filter krn , is also estimated as
1,2,1,1,,2,, )1()(   krrkrkrrkrrkr natbun  (15)
where kra , and krn , are updated on-line, using equations at the end of each run. These
stability conditions are the same as the conventional dEWMA ones and they can be found
in [26]. If model (Eq. (13)) is known to be a true system description and setru denotes the
target value, it is simple to get the minimum mean square error control strategy by fixing
the controllable factor at the value
iC :
r
krkr
set
r
kr b
nau
t ,,1,
 (16)
Equation 16 assumes that the parameters ra and rn from time point 1k to k do
not change. Thus, the input for the k+1 run is
12
kkxxxxy ,143211 9.09.249.1782.383.1595.1563 
kkxxxxy ,243212 05.01.376.322.1136.32254 
(19)
Eq. (19) is a typical MIMO process with interaction. With the proposed PLS based RtR
control design strategy, the setpoint targets are tracked by the on-line updated algorithm.
Fig. 5 indicates that the proposed multi-SISO updated algorithm is able to track the
setpoint signal in the MIMO process. The means and standard deviations of 1y and 2y
of PLS based RtR are [1999.7, 66.3] and [100.0, 33.7], respectively. Meanwhile, the
MIMO RtR control algorithm (Eq. (5)) is also applied (Fig. 6). The means and standard
deviations of 1y and 2y of MIMO RtR are [1999.7, 70.9] and [100.0, 36.4],
respectively. Although the means of the controlled variables in the MIMO RtR and the
proposed PLS based RtR can reach the set points, the variations of the control actions in
the proposed method are smaller. Furthermore, the proposed decomposition structure
can significantly reduce the computational load and feasibly avoid the non-invertibility
problem.
(a) (b)
0 100 200 300 400 500 600 700 800 900 1000
-500
0
500
1000
1500
2000
2500
k
re
sp
on
se
s
y1
spt : mean = 2000 and min std. dev. = 60
y1 : mean = 1999.7 and std. dev. = 66.3
y2
spt : mean = 100 and min std. dev. = 30
y2 : mean = 100.0 and std. dev. = 33.7
0 100 200 300 400 500 600 700 800 900 1000
-4
-3
-2
-1
0
1
2
3
k
co
nt
ro
lla
bl
e
fa
ct
or
s
x1
x2
x3
x4
Fig. 5. Control performance of a linear CMP process controlled by PLS-based RtR
controller: (a) controlled responses; (b) factors.
14
(a) (b)
0 100 200 300 400 500 600 700 800 900 1000
-500
0
500
1000
1500
2000
2500
k
re
sp
on
se
s
y1
spt : mean = 2000 and min std. dev. = 60
y1 : mean = 2000.9 and std. dev. = 70.6
y2
spt : mean = 100 and min std. dev. = 30
y2 : mean = 99.9 and std. dev. = 36.2
0 100 200 300 400 500 600 700 800 900 1000
-8
-6
-4
-2
0
2
4
6
k
co
nt
ro
lla
bl
e
fa
ct
or
s
x1
x2
x3
x4
Fig. 7. Control performance of a non-linear CMP process controlled by PLS-based RtR
controller: (a) controlled responses; (b) factors.
(a) (b)
0 100 200 300 400 500 600 700 800 900 1000
-500
0
500
1000
1500
2000
2500
3000
k
re
sp
on
se
s
y1
spt : mean = 2000 and min std. dev. = 60
y1 : mean = 1999.8 and std. dev. = 165.5
y2
spt : mean = 100 and min std. dev. = 30
y2 : mean = 99.9 and std. dev. = 67.9
0 100 200 300 400 500 600 700 800 900 1000
-8
-6
-4
-2
0
2
4
6
k
co
nt
ro
lla
bl
e
fa
ct
or
s
x1
x2
x3
x4
Fig. 8. Control performance of a non-linear CMP process controlled by MIMO RtR
controller: (a) controlled responses; (b) factors.
16
Semicond. Manuf. 4 (1991) 134.
[4] D. S. Boning, W. P. Moyne, T. H. Smith, J. Moyne, R. Telfeyan, A. Hurwitz, S.
Shellamn, J. Taylor, Run by run control of chemical-mechanical polishing, IEEE
Trans. CPMT(C) 19 (1996) 307.
[5] E. Sachs, A. Hu, A. Ingolfsson, Run by run process control: combining SPC and
feedback control, IEEE Trans. Semicond. Manuf. 8 (1995) 26.
[6] J. R. Moyne, N. Chaudry, R. Tefeyan, Adaptive extensions to a multi-branch
run-to-run controller for plasma etching, J. Vac. Sci. Technol. B 13 (1995) 1787.
[7] S. W. Butler, J. A. Stefani, Supervisory run-to-run control of a polysilicon gate etch
using in situ ellipsometry, IEEE Trans. Semicond. Manuf. 7 (1994)193.
[8] S. R. Roy, P. Glynn, R. Hogan, J. Reynolds, A novel reactor design configuration for
contamination control and improved performance in the polysilicion doping process
using pocl3, J. Electrochem. Soc. 141 (1994) 2257.
[9] S. T. Tseng, R. J. Chou, S. P. Lee, A study of a multivariable EWMA controller, IIE
Trans. 34 (2002) 541.
[10] E. Del Castillo, R. Rajagopal, A multivariable double EWMA process adjustment
scheme for drifting processes, IIE Trans. 34 (2002) 1055.
[11] D. E. Reeves, Y. Arkun, Interaction measures for nonsquare decentralized control
structures, AIChE J. 35 (1989) 603.
[12] P. Grosdidier,M. Morari, B. Holt, Ind. Eng. Chem. Fund. 24 (1985) 221.
[13] B. A. Ogunnaike, W. H. Ray, Process dynamics, modeling and control, Oxford
University Press, New York, 1994.
[14] H. Lau, J. Alvarez, K. F. Jensen, Synthesis of control structure by singular value
analysis: dynamic measures of sensitity and interaction, AIChE J. 31 (1985) 427.
[15] T. Kourti, J. F. MacGregor, Multivariate SPC methods for process and product
monitoring, J. Quality Technol. 28 (1996) 409.
[16] M. H. Kaspar, W. H. Ray, Dynamic PLS Modelling for Process Control, Chem. Eng.
Sci. 48 (1993) 3447.
[17] M. H. Kaspar, W. H. Ray, Chemometric Methods for Process Monitoring and High
Performance Controller Design, AIChE J. 38 (1992) 1593.
[18] S. Lakshminarayanan, S. L. Shah, K. Nandakumar, Modeling and control of
multivariable processes: the dynamic projection to latent structure approach, AIChE J.
43 (1997) 2307.
[19] G. Baffi, J. Morris, E. Martin, Non-linear Model Based Predictive Control through
Dynamic Non-Linear Partial Least Squares, Chem. Eng. Res. Des. 80 (2002) 75.
[20] W. R. Zwick, W. F. Velicer, Comparison of Five Rules for Determining the Number
18
(II)第二子題(第二年)：以操作變數發展 Hidden Markov Tree之批次程序的診斷
技術
Abstract
A novel technique of on-line batch process monitoring based on the wavelet-based
multi-hidden Markov model tree (MHMT) is developed. Unlike most of the existing
batch process monitoring methods for only time scale, MHMT can not only analyze
the measurements at multiple scales in time and frequency but also capture the
clustering and persistence of the statistical characteristics for practical measured data.
This approach provides less signal distortion and better understanding of the principal
source of the system variability affecting the process. After extracting the essential
features of the past operating information, subsequently, two simple monitoring charts
are presented to track the progress of each batch run and monitor the occurrence of
observable upsets. The applications are discussed through a fed-batch penicillin
production to illustrate the advantages of the proposed method in comparison to some
conventional methods.
Keywords: Hidden Markov Model, Multiway Principal Component Analysis, Process
Monitoring, Wavelet Transform
1. Introduction
With computerized measurement devices in the well-equipped industrial processes,
usually the sensors and data gathering devices have enabled data to be collected. The
data can be systematically studied to understand these sources of variability and the
correlation of the measurement profiles with the final product quality. Many statistical
techniques for mining process information from the operating measurement profiles
have been developed. Nomikos and MacGregor (1995) first used multi-way principal
component analysis (MPCA) to analyze the three-way batch data. Chen and Liu (2002)
and Chen and Yen (2003) have extended the dynamic principal component (Ku et al.
1995) to the batch process. These methods integrated the time-lagged windows of the
process dynamic behavior with MPCA. Even though they could enhance the
detectability of the on-line batch monitoring, modeling by the above mentioned
methods only captured the process evolution along with the single solution of the time
scale. That is, they could not extract the events occurring at different scales in the
chemical operation processes (Bakshi, 1998). The multiscale principal component
analysis (MSPCA) strategy was proposed to analyze process trends (Yoon and
MacGregor, 2004; Aradhye et al., 2003; Bakshi, 1998). It was based on the wavelet
transform to decompose the measurement data into the time-frequency content. The
20
into the summation of the product of score vectors t and loading matrices p :
1
Batches
Time
1
1
Variables
1
X
X
K
I
J
J J2 KJ
I
1 J
K
K2
IK
X
Structure IIStructure I
Fig. 1. Two unfolding structures for MPCA
ETPEptX 

T
R
r
rr
1
(1)
where R is the number of principal components, E is a residual matrix, T
expresses the a score matrix and P is a loading matrix. This unfolded method
(Structure I of Fig. 1) is focused on the variability among the batches by collecting the
data information with respect to both the measured variables and their time variation
instead of considering the variability among the batch variables. In this paper, the
variable-wise unfolding method is adopted (Structure II of Fig. 1), because it can be
used to obtain information on the variability among the batch variables, and the
computed score vectors t contain the process features at each time. Several
examples have been used to analyze batch data and detail the procedures for
monitoring batch processes (Lee et al., 2004; Nomikos and MacGregor, 1995, 1994;
Wold et al., 1987; Kosanovich et al., 1996).
In Eq. (1), the process data matrix X is represented by the explained variation of
the quality characteristic TTP plus the unexplained variation )}({ keE , often
called the random measurement error resulted from the uncertain variations and
disturbances among the lurking variables. When the process is operated in a state of
control, the expected distribution of )(ke should be normally distributed with
22





  2
,
2
,
2
,
2
)(
exp
2
1
)|(
md
mdd
md
dd
w
mSw 


 (3)
1
2 3
5 64 7
node
11 S
k
Scale
21 S
12 S 22 S 13 S 23 S
17 S 27 S26 S16 S24 S14 S 25 S15 S
Fig. 2. The HMT structure of the multi-scale wavelet coefficients for a decomposed
measurement in the wavelet domain. The wavelet coefficients and their hidden state
variables are denoted by gray and white nodes, respectively.
and
1)(
1


M
m
d mps (4)
The probability mass function )(mpsd denotes the probability that each coefficient
is associated with state mSd  . In HMT, at node d, with a state, mSd  , an
observation wavelet coefficient, dw , is generated with probability density
)|( mSw dd  . Furthermore, the transition from the children state ( mSd  ) to the
parent state ( nS d )( ) is also probabilistic and is governed by the transition
probability ( mn dd )(, ). The join probability of a vector sequence ( },,,{ 21 Dwww w )
and tree structure sequence ( 1T ), given a model
},1,;,1|,,),({ 2,,)(, MmnDdmps mdmd
mn
ddd   θ , is calculated simply as the
24
( KJI ). The unfolded data matrix is mean centered and scaled to attenuate the
major nonlinear behavior of the process. This will avoid the important variables of
small magnitudes from being taken over by less important but larger magnitude
variables. PCA is applied to decomposing the variables into the lower dimensional
ones in the orthonormal space. Then HMT is used to obtain information about the
variability among batches for batch monitoring (Fig. 3).
MHMT-Based MPCA Model
First, based on the Structure I of Fig. 1, each row of the data matrix for one batch run
is rearranged to form a two-dimensional matrix with timevariables,
1 J
K
K2
IK
1X
1 R
K
K2
IK
R
2X
IX
2T
IT
TP
1T
I
K
RT
I
K
MHMT1
1 J
K
K2
IK
MHMT,1X
1 R
K
K2
IK
MHMT,2X
MHMTI ,X
MHMT,2T
MHMTI ,T
1T
MHMT,1T
1r Rr
MHMT
1T
MHMT
RT
MHMTR
rT
I
K
r
r
I
K
I
K
1r Rr
MHMT
rT
I
K
r
MHMTr
  
MHMT
1E
MHMT
rE
MHMT
RE
Fig. 3. A new approach of MPCA-MHMT for on-line batch monitoring
26
batches to form a component matrix )( IKr T ,
  RrIrrrr ,,2,1,21   tttT (12)
1
2 3
4 5 76
1
rw
1
2 3
4 5 76
1
2 3
4 5 76
Batch
2
rw
I
rw
Tying across
among batches
Tying within
a batch
Fig. 4. Tying structure of HMT for the multi-batch profiles
The above procedure enables us to easily model HMT for each component variable.
After the wavelet transformation is applied to the score matrix ( rT ) in each direction
( r ), the corresponding wavelet coefficient matrix (  Irrrr wwwW 21 ) is
divided into I different wavelet trees, as shown in Fig. 4. In order to avoid over-fitting
HMT model and to achieve the robust training result, instead of one single tree of
HMT based on one batch training data only, the tying cross all simultaneous batch
runs and within a batch at the same scale to train the HMT model for each direction in
the reduced space is applied. Thus, the nodes of each HMT at the same scale with the
same distribution are used here. Using the parameters estimates rθ, the probabilities
),|( r
i
r
i
d mSp θw and ),|,( )( riri did nSmSp θw  for each tree ( i ) via the EM
algorithm are updated in each iteration. Once the probabilities for the hidden states are
known, the parameters can be updated:
28
the unexplained one. For the on-line monitoring of the measurement variables, the
control limits should be built up at each sampling time point. As the new batch
revolves, only the process values from the beginning of the batch to the current time
( k ) are available ( )( JkX ). In order to fulfill the incomplete data set from current
time to the end of the batch for on-line monitoring, filling the missing values with the
normal profile is applied here. The score matrix by projecting the data ( )( JKk X )
mentioned above onto the loading matrix ( P ) can be computed:
  PXtttT kRkkkk  ,2,1,  (16)
The reconstructed score matrix and the corresponding unexplained matrix can be
gotten by applying the trained MHMT
 MHMTRkMHMTkMHMTkMHMTk ,2,1, tttT 
  TMHMTkkMHMTJkMHMTkMHMTkk PTXvvvV  ,2,1, 
(17)
In order to check if the current operating process is normal or in-control, the control
charts for the monitoring procedure should be properly set up. The SPE statistics at
sample k is defined as
 


J
j
HMT
jk kkSPE
1
2
, )()( v (18)
where )(, k
HMT
jkv is the k-th element of the batch for the variable j . The statistics
)(2 kI s at the sample k for a measure of the systematic part of the process variation
to the model, is the sum of the squared independent scores:
 


R
r
HMT
rks kkI
1
2
,
2 )()( t (19)
where )(, k
HMT
rkt is the k-th element of the batch for the component r . The
confidence limits of )(kSPE and )(2 kI s cannot be determined directly from a
30
the fault detection indicates that WT-MPCA is not better than MPCA-MHMT; the
former is not good enough to eliminate the false variables under the noise
environment. Although WT-MPCA is developed based on the time and frequency
domains, the scale contribution to SPE and 2T statistics for each scale can be
diagnosed (Fig. 8). At the highest approximation level, the fault condition can clearly
be detected; however, at the other detail levels, several false alarms occur, because the
inter-scale dependencies of the wavelet coefficients are not considered. Thus, some
control points of WT-MPCA in the control charts (Figs. 5(b) and 6(b)) have some
false detections at the normal and the abnormal batches. Thus, the proposed method
can detect the abnormal condition of this system earlier than the MPCA and
WT-MPCA methods. It has the ability of capturing the actual process relationship
between the variables under the noise environment to eliminate the false variables and
to clearly identify the occurred event.
(a) (b)
50 100 150 200 250 300 350 400
10
20
30
Time (hr)
S
P
E
0 50 100 150 200 250 300 350 400
0
1
2
3
4
Time (hr)
T2
50 100 150 200 250 300 350 400
1
2
3
4
Time (hr)
T2
50 100 150 200 250 300 350 400
10
20
30
40
S
P
E
Time (hr)
(c)
50 100 150 200 250 300 350 400
10
20
30
40
50
Time (hr)
S
P
E
50 100 150 200 250 300 350 400
20
40
60
80
100
120
Time (hr)
I2 s
Fig. 5. Control charts for on-line monitoring of the normal batch in Example 2: (a)
MPCA, (b) WT-MPCA, and (c) MPCA-MHMT. Each chart contains 95% (dash line)
and 99% (solid line) control limits.
32
100 200 300 400
2
4
D
1
T2
100 200 300 400
2
4
6
D
2
100 200 300 400
2
4
6
8
D
3
100 200 300 400
2
4
6
A
3
Time (hr)
100 200 300 400
5
10
15
D
1
SPE
100 200 300 400
2
4
6
8
D
2
100 200 300 400
2
4
D
3
100 200 300 400
20
40
A
3
Time (hr)
Fig. 8. Multi-scale detection of WT-MPCA of the abnormal batch.
6. Conclusion
In this research, the framework for coupling MPCA and HMT together and their
implementation features are provided. MPCA is used to extract the independent score
variables between variables based on the operating data. The score variables are
related to the stochastic behavior to be extracted based on the HMT structure under
the wavelet transform domain. The training HMT model can keep the clustering and
persistence of the wavelet coefficient distribution resulting from the efficient
extraction of the system disturbance variation. The analysis of the database results in
greater understanding of the principal source of the system variability affecting the
process. This proposed monitoring model, an enhanced version of MPCA constructed
in the time domain, can void the detection distorted by the stochastic data information
and improve the conventional detectability. In order to keep a simple HMT model, the
tying structure of HMT is applied to extracting disturbance variation. To build up the
control limits, statistics at each time point are calculated based on the normal
operating data. This allows evaluating the current process with respect to the normal
operation. Such MHMT-based MPCA tools are a good starting point for the data
mining technique used for batch process detection and the application of corrective
policies for better quality of batch processes. The additional work in these areas will
be the next research topics.
Literature Cited
(1) Aradhye, H.B., Bakshi, B.R., Strauss, R.A., Davis, J.F., 2003. Multiscale SPC
using wavelets - theoretical analysis and properties. A.I.Ch.E. Journal 49,
34
(16)Nomikos, P., MacGregor, J.F., 1995. Multivariate SPC charts for monitoring
batch processes. Technometrics 37, 41-59.
(17)Sun, W., Palazoplu, A., Romagnoli, J.A., 2003. Detecting abnormal process
trends by wavelet-domain hidden Markov models. A.I.Ch.E. Journal 49, 140-150.
(18)Yoon, S, MacGregor, J.F., 2004. Principle-component analysis of multiscale data
for process monitoring and fault diagnosis. A.I.Ch.E. Journal 50, 2891-2903.
(19)Wold, S., Geladi, P., Esbensen, K., Ohman, J., 1987. Multi-way principal
components and PLS analysis. Journal of Chemometrics 1, 41-56.
36
continuous ones. When the process is operated continuously, there is a variety of
methodologies in the feedback control loop system to ensure closed-loop stability and
to achieve acceptable steady-state performance with respect to setpoint and
disturbance inputs. Because of the intrinsically dynamic operations of batch processes,
the conventional approach of the controller assessment cannot be directly applied.
ILC of batch operation allows the extraction of information from the past batches to
refine the new batch run and to improve the performance of tracking control for
product quality. ILC utilizes a feedback controller for stabilizing the closed-loop
system. It also uses a feedforward controller for designing the transient response of
the operating profile. Numerous ILC schemes have been developed in the past
decades. They enhanced the control performance over a fixed time interval
iteratively (Chen et al., 1997; Moore, 1993; Lucibello, 1992). The effect of ILC on a
continuous controlled system has been investigated to improve the performance (Tan
et al., 2006; Ratcliffe et al., 2005). Comprehensive review of this topic is shown in the
references (Xu and Tan, 2003; Moore, 1993). The webpage for iterative learning
control research is linked (http://www.ece.usu.edu/csois/ilc/ILC/index.html). However,
these control research papers focused mainly on design strategies. They did not show
how good the current controller performance of the batch operation was in
comparison with benchmark control. If the deterioration of controller performance
cannot be identified in time, the malfunction would cause inconsistent product quality
and monetary loss.
The performance assessment of the control loop based on the minimum variance
was first presented by Harris (1989). Several techniques using the minimum variance
have been proven useful in prioritizing the activities of process engineers, including
monitoring and assessing the controller performance (Huang et al., 2000; Desborough
& Harris 1993). However, the controller performance of the batch operation is
influenced not only by the unmeasured disturbance but also by the deterministic
regulation which is defined by the setpoint changes. Since the deterministic regulation
is very different from the stochastic one, their achievable performance bounds should
be separated (Isaksson et al., 2003; Swanda and Seborg, 1999). Although there were
many research papers on assessing continuous control systems, to our best knowledge,
the assessment of the batch control system has not been mentioned.
2. Configuration of ILC of Batch Units
Suppose there is an operation of a batch run ( ).The feedback control structure for the
batch system is shown in Fig. 1. A discrete linear time-variant (LTV) process is used
to represent a batch operation system. Its form which is any linear time-invariant
38
 kiy ,
w k
( , )spx i k
cwP GGG ,,
),( 1 kqG f

( )spy k
 kiy ,1
w k
( 1, )spx i k
cwP GGG ,,
),( 1 kqG f

( )spy k
Run i
Run 1i
 ,e i k
 1,e i k
Fig. 2. The schematics of ILC with the feedback controller ( 1( , )cG q k
 ) and the
feedforward controller ( 1( , )fG q k
 ).
To complement this, the iterative improvement strategy in a structure with
two-degree of freedom is widely applied to tracking errors by improving its control
action estimates. In Fig. 2, a block diagram interpretation of the ILC scheme is shown.
The dashed block in Fig. 1 denotes the feedback process for the time-varying closed
loop system at a particular run in Fig. 2. The principle of ILC makes use of the
measurement (  ,y i k ) and the reference signal (  ,spx i k ) of the previous batch run
for control during the current batch ( 1i ) under the disturbance input ( w k ). The
feedback controller ( 1( , )cG q k
 ) undertakes correction based on non-deterministic
disturbances and modeling errors. The feedforward controller ( 1( , )fG q k
 ) adjusts the
40
i , is represented by a deterministic dynamics ( det 1( , )G q k ) plus a stochastic
disturbance ( 1( , )stoG q k ). The stochastic disturbance is often called the unexplained
measurement error. It is resulted from the uncertain variations and disturbances
among the lurking variables. The deterministic dynamics, which is explainable, is the
function of ( )spy k , that keeps the mean constant trajectory. Thus, the performance
bound ( J ) in Eq. (3) can be expressed by two parts: the stochastic effect ( DisturbanceJ )
from unmeasured disturbance in the feedback loop and the deterministic effect
( SetpointJ ) from the desired setpoint trajectory in the feedforward loop,
2
Setpoint Disturbance
( , )
( , ) ( , )
k
C f C f
J E e i k
J G G J G G
    
 
 (5)
To achieve the minimum bound, Eq. (5) will be
2 * *
Disturbance Setpoint, ,
min min ( , )
C f C fG G G G k
J E e i k J J
     
(6)
where *Disturbance Disturbance,minC fG G
J J and *Setpoint Setpoint,minC fG GJ J .
*
SetpointJ can be
identically zero under perfect control. This means that the final output error is zero
over the whole batch duration if there is no disturbance. Thus, the feedforward
learning controller ( 1( , )fG q k
 ) can be obtained
1 1
1
1 1
1 ( , ) ( , )
( , )
( , ) ( , )
P C
f
P C
G q k G q k
G q k
G q k G q k
 

 
 (7)
DisturbanceJ can be regrouped into controller-invariant and controller-dependent terms.
Using the Diophantine identity,
42
2
2
02
2 1
2
0
2 ( )
( )
( )
2 ( )
k
j
je
d
w
j
j
k T d
k
k
k T d


 



  
 


(11)
where the signal-to-noise ratio ( 2 ( )k ) is used for simple expression.
To detect if the current operations have deviations from the minimum bounds, a
statistical hypothesis testing approach can be applied to the control output error at
each time point. Based on the traditional statistical process control methods, the upper
control limits (UCL), the center line (CL) and the lower control limits (LCL) at each
time point are given
( ) 3 ( )UCL k k (12)
( ) 0CL k  (13)
( ) 3 ( )LCL k k (14)
where 1, 2, ,k T  . Fig. 3(a) shows the control chart with LCL and UCL is used to
compare the performance of a current control loop with that of the control loop with
benchmark controlers when the benchmark’sexpected output errors fall on CL. Fig.
3(b) shows a pictorial display of what characteristics of the underlying distribution
might be during each time point. The shaded regions covered by the upper and lower
control limits at each operation time are also plotted. Thus, there is no lack of the
benchmark performance when the output error falls between the control limits.
Whether the current operating data from a batch run is in control with good
performance can be determined.
44
  1 21 5 1 20.2 0.11 0.9 0.8P
q q
G q q
q q
 
 
 

  (15)
 1 111 0.5wG q q

 
(16)
where both models are linear time invariant. The unmeasured noise ( w ) with zero
mean and unit variance enters the disturbance model. The reference profile used in
this example is shown in Fig 4. A feedback controller and a feedforward one are
used to control this system,
1
1
0.9062 0.6324
1c
q
G
q




1
1
0.4138 0.1043
1f
q
G
q




(17)
0
50
100
1
5 9
12
-2
-1
0
1
2
3
4
Batchk
y(
k)
Fig. 4. The controlled outputs for the initial designed controllers in Example 1. The
bold lines are the reference profiles and the dotted lines represent the controlled
outputs for Batch 1, 5, 9 and 12.
46
significantly enough. In the second (maintenance) stage, the cooling water in the
jacket is used to remove the exothermic heats of reaction. The reactor temperature is
controlled by two split-ranged control valves, a steam valve and a water valve. Thus,
feedback control is used to eliminate the disturbance effect on the manipulated
variables and keep the heat requirement within the batch run. The feedforward
controller is used to modify the specified temperature profile from one batch to
another. The duration of each batch is 250 minutes. The sampling time of each batch
is 1 minute. Fig. 6 also shows the plot of the response to the controlled temperature
for two operating batch runs. From the operating process data, which control system
does the job better?
To assess the performance of the controlled system, the benchmark of the control
system should be set up first. The benchmark performance bounds are determined
based on the process and disturbance models. A total of 50 batch runs of the data are
collected. From the data, the dead time ( d ) of the processes calculated by
cross-correlation analysis is three. According to the identification procedure, the
process ( 1( , )pG q k
 ) and the disturbance models can be calculated. Due to the space
limitation, the detailed identification procedure is referred to Yea and Chen (2007).
Thus, the estimated minimum variance bounds of the controlled output errors for a
batch run can be calculated from Eqs. (12)-(14) To illustrate the control performance
in Fig. 6, the control charts for these two operation batch runs are shown in Fig. 7.
The charts indicate that the controller performance of the second batch run
outperforms that of the first one, but the two controller designs cannot fall into the
control bounds because the MV bounds, which are the minimum performance bounds,
can be achieved for MV control only.
0 50 100 150 200 250
5
6
7
8
9
10
11
12
13
k
T
Controller Design I
Controller Design II
Setpoint
Fig. 6. The controlled outputs for two designed controllers in Example 2.
48
have been around for years and engineers have acquired lots of experience, but many
operational problems still go undiagnosed for a prolong period of time. In this paper
the performance bounds of ILC benchmark for the LTV batch operation system is
developed.
In practical operation plant, the process data can be accessible from any time
period at the touch of a button because most modern chemical processes utilize
computer systems in which large amounts of data is stored cheaply and efficiently.
Thus, developing a firm grasp of the data mining technique to identify and
performance assessment of the ILC system is (a reflection of this merging need)
strongly required to maintain good performance of the operating batch unit when
producing products. On the basis of the operating data from the repeated tracking task
which is run at a finite time interval in the time domain and an infinite repetition
along the iteration domain, the two-stage method for modeling the process and the
disturbance in turn is proposed. Eventually, the performance bounds at each time
point can be estimated by multiple objective optimizations with the pre-identified
process and disturbance models. They can be used to assess the performance of the
setpoint tracking and the disturbance rejection. From the routine operation data, the
advantages of the proposed method are demonstrated through simulated examples that
explain how to build the achievable performance bounds and accurately identify the
control performance of the current batch operation at each time point. This prototype
will be used for field testing in our future study to investigate if the proposed
approach is practically good enough for industrial batch applications.
REFERENCES
Chen, Y.; Xu, J.-X.; Lee, T. H.; Yamamoto, S. Comparative Studies of Iterative
Learning Control Schemes for A Batch Chemical Process', IEEE Int. Symposium
on Control Theory and Applications, Singapore, 1997.
Desborough, L.; Harris, T. J. (1993). Performance assessment measures for univariate
feedforward/feedback control, Canadian Journal of Chemical Engineering, 71,
605.
Harris, T. J. (1989). Assessment of control loop performance, Can. J. Chem. Eng., 67,
856.
Huang, B.; Shah, S. L.; Miller, R. (2000). Feedforward plus feedback controller
performance assessment of MIMO systems, IEEE Transactions on Control
Systems Technology, 8, 580.
Isaksson, A. J. and Horch, A., Dumount, G. A. Event-triggered deadtime estimation
from closed-loop data. Proc. ACC, Arlington, Virginia, 2001,
50
(IV)結論
傳統的統計製程管制，多偏重於異常的偵測上，且僅限制在簡單的單變數系統。而對的批
次操作單元的工業製程，許多工廠都未能有有效的方法來分析及消化製程數據，以萃取出
有用的資訊，而只憑經驗與直覺來判讀數據。本計劃完成，提昇原有在批次製程的控制，
監控及控制系統評估的技術，特別是在半導體及生化反應的製造程序。具體而言，本研究
計畫已證實：
1. 發展出多變數 PLS的 RtR 的統計程序控制系統，並與傳統 RtR 控制系統比較。相關的
研究成果己分別發表：
 J. Chen and K.-C. Lin (2008) “Integrated Batch-to-Batch Control and within-Batch
On-Line Control for Batch Processes Using Two-Step MPLS-Based Model
Structures,”Ind. Eng. Chem. Res. SCI (Accepted)
 J. Chen and K.-C. Lin (2008) “Batch-to-Batch Iterative Learning Control and
within-Batch On-Line Control for End-Point Qualities Using MPLS Based dEWMA,”
Chem. Eng. Sci., 63, 977-990 SCI
 J. Chen and F. Wang (2007) “PLS Based dEWMA Run-to-Run Controller for MIMO
Non-Squared Semiconductor Processes,” J. Process Contr. 17 (4) 309-319 SCI
 J. Chen, K.-C. Lin and C.-K. Kong (2007) “Application of the Batch-to-Batch and
Within-Batch Iterative Optimal Design Strategy for Pervaporation Processes,” Sep.
Purif. Technol. 55, 265-273 SCI
 J. Chen, K.-P. Wang, J.-Y. Houng and C.-H. Liao (2006) “Sequential Design of pH
Profiles for Asymmetric Bioreduction of Ethyl 4-Chloro-3-Oxobutyrate Using a New
Experimental Design Method,” Enzyme Microb. Technol., 38(5) 689-696 SCI
 J. Chen, Y.-C. Chang and Y. Yea (2005) “Multiloop PID Controler Design Using PLS 
Decoupling Structure,”Korean J. Chem. Eng., 22(2) 173-183 SCI
2. 發展出 Off-Line及 On-Line製程的MHMT-PCA統計程序控制模式，建立提前預警的偵
測系統，並與傳統MPCA監控模式比較。相關的研究成果己分別發表：
 J. Chen, C.-J. Hsu and C.-C. Chen (2008) “A Self-Growing Hidden Markov Tree for
Wafer Map Inspection,”J. Process Contr. SCI (in press)
 J. Chen, C.-J. Hsu, Y.-C. Jiang and M.-W. Lee (2007)“Self-Growing Hidden Markov
Tree Based Multiway Principle Component Analysis for Enhanced Monitoring of
Batch Processes,”Ind. Eng. Chem. Res. 46 (18) 6010-6024 SCI
 J. Chen and H.-H. Chen, (2006) “On-Line Batch Process Monitoring Using MHMT
Based MPCA,” Chem. Eng. Sci., 61(10) 3223-3239 SCI
 H. Chang, J. Chen, and Y.-P. Ho, (2006) “Batch Process Monitoring by Wavelet 
Transform Based Fractal Encoding,” Ind. Eng. Chem. Res., 45 (11) 3864-3879 SCI
 J. Chen and W.-J. Chang (2005) “Applying Wavelet-Based Hidden Markov Tree to
Enhancing Performance of Process Monitoring,” Chem. Eng. Sci., 60(18) 5129-5143
SCI
3. 發展出控制系統的效能評估與監控技術。相關的研究成果己分別發表：
 J. Chen and Y. Yea (2007) “Controled Output Variance Based Diagnosis Tree for
出席國際學術會議心得報告
計畫編號 NSC 96-2221-E-033-021
計畫名稱 發展以操作數據為基礎的批次單元之控制、監控與效能評估
出國人員姓名
服務機關及職稱
陳榮輝 中原大學化學工程學系 教授
會議時間地點 96年 8月 15-18日 Xi’an, China
會議名稱 PSE Asia 2007, The 4
th International Symposium on Design, Operation &
Control of Chemical Processes
發表論文題目 PLS-based Iterative Control of a Simulated Moving Bed
一、 參加會議經過
此次 PSE ASIA 2007為第四屆 International Symposium on Design, Operation & Control
of Chemical Processes，由 Chinese Process System Engineering Society，Asia Process
System Engineering Committee以及Xi’an Jiaotong University共同主辦，於 2007年 8
月 15日至 18日在Xi’an Jiaotong University, Xi’an, China舉行。參與此項國際會議的
人，來自 12個國家，約三百人左右。在投稿的論文共有 192篇被接受，其中台灣共
有 36篇。會議並在 16場的 oral sections及 8場的 Keynote speech中進行。我於 8月
14日中午搭乘國泰航班機經由 Hong Kong，於當晚抵達Xi’an，並於隔日前往開會地
點進行註冊報到。
本次大會作者於 Session T01A (Dynamic & Control (A))宣讀我們的研究成果與經驗，在此
session，有九篇論文宣讀。我們報告的題目為：
PLS-based Iterative Control of a Simulated Moving Bed
本次研究報告為改進模擬移動床(simulated moving bed, SMB)系統的監控技術。由於在傳
統蒸餾的分離程序，無法分離化學異構物，因此管柱層析分離(chromatographic separation)
普遍受到學術界以及工業界的使用來分離化學異構物。管柱層析的原理是利用溶質
(solutes)在兩相中(固體相(stationary phase)和流體相(mobile phase))的相對親合性(relative
affinities)的不同，產生不同速率的移動(migration)，使其分離。但管柱層析系統為為半連
續式。過去連續操作的 SMB己發展出，利用進料出料循序切換節點，且與流體流動相同
的方向，來模擬的流體相與固體相的逆向流。但 SMB為多變數的複雜系統且具有特殊的
物理現象，若直接以數學模式做控制設計，因建立數學模式需長時間的驗證，且又受外
界的干擾導致不符合實際系統特性，此經驗模式需要可以隨系統變化逐步做修正，但若
單純使用經驗模式做控制設計，且忽略了可觀察的系統特性，因此本論文提出一套以經
驗模式為基礎的控制設計並利用物理現象做限制條件，使其出口品質達到所需要的規範。
隨機分佈,因此可以將常規隨機系統中關於輸出的均值和方差的控制視為隨機分佈
控制的特例。近年來，針對隨機分佈控制系統已經有不少研究成果，系統地建立
了多種建模及控制方法。此外，隨機分佈控制理論已經應用在造紙過程、化工過
程、燃燒過程、網路控制系統等領域。
三、 建議
積極地參與國際性學術會議，聆聽同行學者的研究心得，進行學術交流，能夠知己知彼，
對個人研究工作的精進很有助益，並提高國家與學校的能見度。近年來，中國大陸的年
輕學者與會者逐次増加，而且更積極的從事國際會議之主辦，這反映他們對學術活動的
積極性與研究工作的日益進展。特別是在中國大陸高學位的人力市場，學術性研究相當
廣泛，這是值得我們注意與努力的，並多發表論文，作學術交流，才能提昇台灣的研究
能力。
四、 攜回資料名稱及內容
PSE Asia 2007, The 4th International Symposium on Design, Operation & Control of Chemical
Processes: Program Book and CD ROM
五、 發表論文
PSE ASIA 2007, August 15-18, 2007, Xi’an, China
identification. It facilitates data-compression by condensing the variance of the process into a very
low-dimensional latent subspace. Moreover, the MIMO SMB process can be transformed into a
system of the parallel uni-variate SISO control problem. Also, the decoupling of the system is
useful because conventional SISO control can be directly applied. The performance of these
control strategies will be assessed by implementation on a virtual eight column SMB unit.
2 SMB System
Feed
(A+B)
Column 6Column 5
C
olum
n
3
C
olum
n
4
C
olum
n
8
C
olum
n
7
Column 1Column 2
Zone I
Zone III
Z
on
e
IV
Z
one
II
Solvent
(D)
Extract
(A+D)
IIIv
Iv
Raffinate
(B+D)
Raffinate
(B+D)
Feed
(A+B)
Extract
(A+D)
Solvent
(D)
IIv IVv
vRv
F
vE vD
Fig. 1. SMB unit
The SMB unit under consideration is a standard SMB unit consisting of four sections as
shown in Fig. 1. It consists of eight columns arranged in a 2-2-2-2 configuration. The SMB unit
can be divided into 4 zones. Each zone is constituted of two same volume chromatographic
columns. The figure shows the first instance when the solvent enters between column 1 and 8, and
the feed, between column 4 and 5. The dotted lines indicate the position of the respective inlet and
outlet after the first switch. The directions of the successive switches are the same and after 8
switches, i.e. a completion of a cycle, the nodes will return to the same position as the first
instance. The process is described by a two phase models, mobile and stationary, and each
describes the concentration of components in the moving fluid and absorbent particles respectively
(Dunnebier et al., 2000). The model equations are not listed here because of the space limitation.
For a detailed coverage, readers are referred to the above reference. In this paper, the equilibrium
relationship follows bi-Langmuir isothermal.
3 PLS Modelling
Although physical models can describe the actual SMB process accurately, for practical
applications, the control design results may not be reliable because of the complex model. The
PLS model is used, because PLS can offer the data-compression facility to extract the essential
information of the state of the process from the operation data.
PSE ASIA 2007, August 15-18, 2007, Xi’an, China
( )
( )
T
c
T
c
c
c
 
 
x t P e
y u Q f
(6)
P and Q are the loading matrices. e and f are residual vectors that are not useful for
describing x and y , respectively. x and y are related through their scores ct and cu by
the inner relation,
,1 ,2 ,1 ,1 ,2 ,c c c c c c Ru u u t t t      B  (7)
where 1 2( )Rdiag b b bB  . Now the MIMO SMB process can be transformed into a system
of the parallel uni-variate regression process through the application of PLS for process control.
4 SMB control design
The control strategy aims at achieving a desired product quality ( spy ) by changing the
appropriate inputs ( ( 1)v cx ). The objective function is defined as
   
( 1) ( 1)
1
min min ( ) ( )
2v v
Tsp sp
c c
J c c
 
  
x x
y y Ω y y (8)
Ω is the diagonal weighting matrix. The above objective can be decomposed into R
sub-objective functions in the subspace by mathematical operations,
 
1,
2
1,
( 1) 1 1
1
min min
2v c r
R R
sp
r r c rtc r r
J u u

  
     x (9)
sp
ru is the desired target obtained by projecting
spy onto the PLS space. However, the process
model is subject to change because of disturbances or process decay. The developed input-output
MPLS model does not always have an accurate correlation. The procedure of the parameter
estimator based dEWMA is used to filter out measurement noise and update the process
parameters,
1 1 1 1c c c c     u a Bt d (10)
where the bias term, 1ca , and trend estimation filter, 1cd , are updated recursively in the
traditional dEWMA sense. Thus the input variable xˆ for cycle 1c
1,
1
(ˆ 1)
R
T
c r r
r
c t 

 x w (11)
The obtained input variable xˆ cannot be directly implemented because it contains past
information px , the flow rates and purities of the extract and the raffinate of the previous cycle
and future information cx , the designed flow rates for the new cycle. To achieve the target
qualities, the computed score should still be applied. After conducting mathematical operations,
the input variables cx should be re-adjusted as
-1
1 1 2 2 2( 1) ( - ( 1) )(( ) )
pc T T
cc c  x t x W P W P (12)
PSE ASIA 2007, August 15-18, 2007, Xi’an, China
0 20 40 60 80 100 120 140 160 180 200
0.7
0.8
0.9
1
P
E
0 20 40 60 80 100 120 140 160 180 200
0.7
0.8
0.9
1
Number of Switch
P
R
Fig. 4. Disturbance rejection: Purities of the extract and the raffinate at each switching time
4.2 Disturbance rejection
The disturbance change in the feed concentration and in temperature can affect the
parameters of the process. For the case study, temperature at the 80th switch point is changed and
this results in the change of the isothermal characteristics. The diagram based on the triangle theory
shown in Fig. 3 indicates that the complete separation region has been changed. Under the proposed
control scheme, the desired set point is achievable after the disturbance change as seen from the Fig. 4..
Fig. 3 also explains how the adjustments of the flow rates approach the new separable region.
5 Conclusion
A novel scheme for the control of the SMB process has been developed and implemented on
a virtual eight column SMB. The continuous switching process poses a great challenge for control
design because the SMB unit does not reach a steady state with a constant profile of all the process
variables. The proposed controllers have demonstrated excellent control performances not only in
the case of set-point tracking but also disturbance rejection. In view of the simulation results, the
control strategies are expected to be applicable to SMB units of different configurations and
different switching operations.
6 REFERENCES
1  Dunnebier G., Klat K. U., “Modelling and simulation of nonlinear chromatographic separation
process: a comparison of different modeling approaches,”Chemical Engineering Science,
55,373-380 (2000).
2 Song I. H., Lee S. B., Rhee H. K., Mazzoti M., “Optimization-based predictive control of a
simulated moving bed process using an identified model,”Chemical Engineering Science,
61,6165-6179 (2006).
3   Wang C., Klatt K. U., Dunnebier G., Hanisch F., “Neural network-based identification of SMB
chromatographic processes,” Control Engineering Practice, 11,949-970 (2003).
4   Schramm J., Gruner S., Kienle A., “Optimal operation of simulated moving bed chromatographic 
processes by means of simple feedback control,” J. Chromatography A.,1006,3-13 (2003).
9. SmartFactory–From Vision to Reality in Factory Technologies, Detlef Zuehlke, Chairman of
executive board, SmartFactory Technology Initiative e. V. Kaiserslautern, Production
Automation, University of Kaiserslautern, Germany
在本次大會中，作者於 Iterative Learning Control I Session發表我們的研究成果與經驗，在此
session，一共有六篇論文宣讀：
MoB12.1 Performance Assessment Measures of Batch Processes for Iterative Learning Control, pp.
1466-1471. Chen, Junghui and Kong, Cho-Kai
MoB12.2 Design and Stability Discussion of a Hybrid Intelligent Controller, pp. 1472-1477.
Mohammadzaheri, Morteza and Chen, Lei
MoB12.3 Iterative Learning Control Based on Stochastic Approximation, pp. 1478-1483.
Butcher, Mark Edward John, Karimi, Alireza and Longchamp, Roland
MoB12.4 A Design Method of Robust Stabilizing Simple Multi-Period Repetitive Controllers, pp.
1484-1489. Yamada, Kou, Hagiwara, Takaaki, Takenaga, Hiroshi and Kobayashi, Masahiko
MoB12.5 Perfect Tracking of Repetitive Signals for a Class of Nonlinear Systems, pp. 1490-1495.
Yang, Zaiyue and Chan, Che Wai
MoB12.6 Strong Practical Stability and Stabilization of Uncertain Discrete Linear Repetitive
Processes, pp. 1496-1501. Dabkowski, Pawel, Galkowski, Krzysztof and Rogers, Eric
我們的論文宣讀為第一篇，研究的問題是如何利用 SPC 的方法來評估 ILC 的控制系統。疊
代式學習控制器目前已廣泛被應用於批次程序上，其控制過程因為有記憶性(memory)以及學
習性(learning)，所以應用在批次程序操作時，只要學習因子(learning factor)挑選得當，批與批
修正後之誤差值皆能夠收歛至零。真實製程多會受到未知干擾的影響，而在過去文獻中，針
對批次系統之未知擾動，其多為白色干擾(white noise)，且無動態關係，由於白色干擾其平均
值為零，只要疊代式學習控制器之學習因子調整合適，依然可以將批與批之間的誤差收歛至
零。而化工程序中之未知擾動，由於其反應較慢且關係較複雜，因此擾動對於系統輸出的影
響就會有個動態關係，根據 Harris(1989)提出之最小變異量控制 ( minimum variance control )
的概念，當未知擾動有動態關係存在時，就會有控制器無關項的存在，因此批與批之間的誤
差不會收歛至零，而是收歛至一極值。本研究主要是針對批次程序在存在有動態關係的擾動
下，針對非時變(time invariant)系統以及時變系統(time variant)系統，利用最小變異量控制的
概念，設計最佳之疊代式學習控制器以及內部控制器，建立最佳之效能指標(performance
index)，評估目前控制器之控制效能，並進而建立管制界線，用以監控程序操作過程是否有異
常情況發生。在物理系統測試方面，除了控制器的控制效能評估外，將探討時變系統當做非
時變系統下操作，以及在固定內部控制器，只設計疊代式學習控制器的操作下，其控制效能
與效能指標之比較。
Performance Assessment Measures of Batch Processes
for Iterative Learning Control
Junghui Chen, Cho-Kai Kong

R&D Center for Membrane Technology Department of Chemical Engineering, Chung-Yuan Christian University
Chung-Li, Taiwan (e-mail: jason@ wavenet.cycu.edu.tw)
Abstract: A new method is proposed for the assessment of the batch control system when the iterative
learning control is applied. Unlike the continuous process, the performance assessment of the batch
process requires particular attention to both disturbance changes and setpoint changes. Because of the
intrinsically dynamic operations and the nonlinear behavior of batch processes, the conventional approach
of the controller assessment cannot be directly applied. The bounds at each time point are derived and
computed for the controlled output variance to create simple monitoring charts. They can help tracking the
progress in each batch run to monitor the occurrence of the observable upsets. Simulation cases are used
to demonstrate the advantages of the proposed strategies.

1. INTRODUCTION
Interest in research and development of batch control based
on iterative learning control (ILC) has increased steadily
since the term, ILC, was first presented (Arimoto et al., 1984).
The control design in batch processes is quite different from
that in continuous ones. When the process is operated
continuously, there is a variety of methodologies in the
feedback control loop system to ensure closed-loop stability
and to achieve acceptable steady-state performance with
respect to setpoint and disturbance inputs. Because of the
intrinsically dynamic operations of batch processes, the
conventional approach of the controller assessment cannot be
directly applied. ILC of batch operation allows the extraction
of information from the past batches to refine the new batch
run and to improve the performance of tracking control for
product quality. ILC utilizes a feedback controller for
stabilizing the closed-loop system. It also uses a feedforward
controller for designing the transient response of the
operating profile. Numerous ILC schemes have been
developed in the past decades. They enhanced the control
performance over a fixed time interval iteratively (Chen et al.,
1997; Moore, 1993; Lucibello, 1992). The effect of ILC on a
continuous controlled system has been investigated to
improve the performance (Tan et al., 2006; Ratcliffe et al.,
2005). Comprehensive review of this topic is shown in the
references (Xu and Tan, 2003; Moore, 1993). The webpage
for iterative learning control research is linked
(http://www.ece.usu.edu/csois/ilc/ILC/index.html). However,
these control research papers focused mainly on design
strategies. They did not show how good the current controller
performance of the batch operation was in comparison with
benchmark control. If the deterioration of controller
performance cannot be identified in time, the malfunction
would cause inconsistent product quality and monetary loss.
The performance assessment of the control loop based on the
minimum variance was first presented by Harris (1989).
Several techniques using the minimum variance have been
proven useful in prioritizing the activities of process
engineers, including monitoring and assessing the controller
performance (Huang et al., 2000; Desborough & Harris 1993).
However, the controller performance of the batch operation is
influenced not only by the unmeasured disturbance but also
by the deterministic regulation which is defined by the
setpoint changes. Since the deterministic regulation is very
different from the stochastic one, their achievable
performance bounds should be separated (Isaksson et al.,
2003; Swanda and Seborg, 1999). Although there were many
research papers on assessing continuous control systems, to
our best knowledge, the assessment of the batch control
system has not been mentioned.
In this paper, two issues are addressed to assess the controller
performance of the batch operation. First, the minimum
variance performance bound is developed for batch operation
systems. The performance bound can subsequently be used
for the performance assessment of the batch system control
loop. The remaining paper is structured as follows: The
performance assessment of the control loop in the batch
operation system is defined in Section 2. In Section 3, the
performance assessment bounds of the batch control system
are derived. The effectiveness of the proposed method and its
potential applications are demonstrated through two
computer simulation problems, including a simple linear
system and a nonlinear batch reactor in Section 4. Finally,
concluding remarks are made.
2. ILC STRUCTURE OF BATCH
Suppose there is an operation of a batch run ( i ).The
feedback control structure for the batch system is shown in
Fig. 1. A discrete linear time-variant (LTV) process is used to
represent a batch operation system. Its form which is any
of 2( , )
k
e i k depends on all the system controller functions,
1( , )cG q k
 and 1( , )fG q k
 . The calculation described by Eq.
(3) is also provided for examination.
3. PERFORMANCE ASSESSMENT MEASURES OF ILC
When ILC is applied to the process, the output error ( ( , )e i k )
at the time point ( k ) can be represented by
det 1 1
stochasticdeteriministic
( , ) ( ) ( , )
( , ) ( ) ( , ) ( , )
sp
sp sto
e i k y k y i k
G q k y k G q k w i k 
 
  (4)
( , )e i k , the measurement of the output error variable at time
k for a particular batch i , is represented by a deterministic
dynamics ( det 1( , )G q k ) plus a stochastic disturbance
( 1( , )stoG q k ). The stochastic disturbance is often called the
unexplained measurement error. It is resulted from the
uncertain variations and disturbances among the lurking
variables. The deterministic dynamics, which is explainable,
is the function of ( )spy k , that keeps the mean constant
trajectory. Thus, the performance bound ( J ) in Eq. (3) can
be expressed by two parts: the stochastic effect ( DisturbanceJ )
from unmeasured disturbance in the feedback loop and the
deterministic effect ( SetpointJ ) from the desired setpoint
trajectory in the feedforward loop,
2
Setpoint Disturbance
( , )
( , ) ( , )
k
C f C f
J E e i k
J G G J G G
 
  
  
 
 (5)
To achieve the minimum bound, Eq. (5) will be
2 * *
Disturbance Setpoint
, ,
min min ( , )
C f C fG G G G k
J E e i k J J
 
   
  
 (6)
where *Disturbance Disturbance
,
min
C fG G
J J and
*
Setpoint Setpoint
,
min
C fG G
J J . *SetpointJ can be identically zero
under perfect control. This means that the final output error is
zero over the whole batch duration if there is no disturbance.
Thus, the feedforward learning controller ( 1( , )fG q k
 ) can
be obtained
1 1
1
1 1
1 ( , ) ( , )
( , )
( , ) ( , )
P C
f
P C
G q k G q k
G q k
G q k G q k
 

 

(7)
DisturbanceJ can be regrouped into controller-invariant and
controller-dependent terms. Using the Diophantine identity,
1 1 1( , ) ( , ) ( , )dwG q k Q q k q R q k
     (8)
where Q is LTV polynomials of degree 1d and R is a
proper LTV transfer function. After substituting the
feedforward controller (Eq. (7)) and the Diophantine identity
(Eq. (8)) into Eq. (5), the output error will come from the
disturbance only. To achieve *DisturbanceJ , the controller
dependent term must be zero. The feedback controller
( 1( , )CG q k
 ) can be obtained
1
1
* 1 1
( , )
( , )
( , ) ( , )
C
P
R q k
G q k
G q k Q q k


  (9)
where * 1( , )PG q k
 is the process model without any time
delay. Hence, the minimum variance (MV) of the
performance bound can be derived into
2 2
1 0
1 1
2 2 2 2
1 0 1 0
2 ( )
2 ( ) 2 ( )
T k
j w
k j
d k T d
j w j w
k j k d j
k T d
J
k k T d
 
   
 
 
   




  


 
(10)
where ( )j k is the time-variant coefficients of the
polynominal 1( , )Q q k . Here the same variance of the
disturbance ( ( )w k ) with a normally distributed random
variable at any time and at any batch run is assumed. 2w is
the variance of the unmeasured white noise. For the duration
of each batch run, the variances ( 2 ( )k ) at time k
represented by the MV benchmark controller can be obtained
by
2
2
02
2 1
2
0
2 ( )
( )
( )
2 ( )
k
j
je
d
w
j
j
k T d
k
k
k T d










 
 



(11)
Under the initial designed controllers, the responses of the
output tracking to some batch runs are shown in Fig. 4. The
controlled output is converged after 12 batch runs. The
system under the unmeasured disturbance change seems to
have some deviation from the reference setpoint; however, it
is hard to evaluate the current performance from the batch
output response. On the basis of the given process and the
disturbance models, the minimum variance bounds for each
batch can be computed using Eqs. (11)-(14). The control
chart for the minimum variance performance bounds is used
to test the performance of the controlled output for the
batches using the controller design (Eq. (17)). Fig. 5 shows
the results of the controlled error when the controller
parameters are used. It is found that 55 out of the total 120
data points fall out of the performance bounds. This indicates
the controllers should be tuned.
0 20 40 60 80 100 120
-40
-30
-20
-10
0
10
20
30
k
e/
 w
Fig. 5. The control chart with the minimum variance bounds
(marked in solid line) for evaluating the control outputs
(marked in asterisk).
4.2 Example 2: Nonlinear Batch Reactor
This example is intended to show how to evaluate iterative
learning batch controllers for a typical exothermic chemical
batch reactor. The differential equations and the parameter
values describing the reaction process are referred to Luyben
(1990). The reaction system involves two consecutive first-
order reactions:
A B C 
Two stages are run in the system. In the first (start-up) stage,
the steam in the jacket initially heats up the reactor content
until the exothermic heat of reaction is generated
significantly enough. In the second (maintenance) stage, the
cooling water in the jacket is used to remove the exothermic
heats of reaction. The reactor temperature is controlled by
two split-ranged control valves, a steam valve and a water
valve. Thus, feedback control is used to eliminate the
disturbance effect on the manipulated variables and keep the
heat requirement within the batch run. The feedforward
controller is used to modify the specified temperature profile
from one batch to another. The duration of each batch is 250
minutes. The sampling time of each batch is 1 minute. Fig. 6
also shows the plot of the response to the controlled
temperature for two operating batch runs. From the operating
process data, which control system does the job better?
To assess the performance of the controlled system, the
benchmark of the control system should be set up first. The
benchmark performance bounds are determined based on the
process and disturbance models. A total of 50 batch runs of
the data are collected. From the data, the dead time ( d ) of
the processes calculated by cross-correlation analysis is three.
According to the identification procedure, the process
( 1( , )pG q k
 ) and the disturbance models can be calculated.
Due to the space limitation, the detailed identification
procedure is referred to Yea and Chen (2007). Thus, the
estimated minimum variance bounds of the controlled output
errors for a batch run can be calculated from Eqs. (12)-(14)
To illustrate the control performance in Fig. 6, the control
charts for these two operation batch runs are shown in Fig. 7.
The charts indicate that the controller performance of the
second batch run outperforms that of the first one, but the two
controller designs cannot fall into the control bounds because
the MV bounds, which are the minimum performance bounds,
can be achieved for MV control only.
0 50 100 150 200 250
5
6
7
8
9
10
11
12
13
k
T
Controller Design I
Controller Design II
Setpoint
Fig. 6. The controlled outputs for two designed controllers in
Example 2.
6. CONCLUSIONS
In practical operation plant, the process data can be
accessible from any time period at the touch of a button
because most modern chemical processes utilize computer
systems in which large amounts of data is stored cheaply and
efficiently. Many processes have been around for years and
engineers have acquired lots of experience, but many
operational problems still go undiagnosed for a prolong
period of time. Thus, developing a firm grasp of the data
mining technique to identify and performance assessment of
