 
 
目   錄 
 
一、計畫摘要               4 
二、計畫緣由與研究目的             4 
三、研究方法-系統架構與測試流程           4 
四、研究方法-分部模組電路架構 
 取樣/保持電路             6 
 數位/類比轉換電路            6 
 數位控制延遲電路            9 
 比較器               10 
 系統有限狀態機             12 
五、研究方法-測試晶片實做與量測 
 測試晶片架構與測試環境建置          12 
 晶片量測結果             13 
六、結論與討論               14  
七、參考文獻               15 
八、計畫成果自評              16 
九、附錄:研究成果摘錄  
 衍生專利: Jenchien Hsu, Hungwen Lu, Chauchin Su, YeongJar Chang, “Built-in jitter 
measurement circuit.” U.S. Patent, Application No. 11/870,113, October 25, 2007.  
 衍生專利: Jenchien Hsu, Hungwen Lu, Chauchin Su, YeongJar Chang, “Sample and 
hold circuit and related data signal detecting method utilizing sample and hold circuit,” 
U.S. Patent, Application No. 11/854,560, Aug. 13, 2007.        
 衍生專利: Chauchin Su, Hungwen Lu, Shunmin Chi, “Self-Calibrating High-Speed 
Analog-to- Digital Converter.” U.S. Patent, Application No. 7,474,239, Jan. 6, 2009.  
 國際研討會論文 : M.H. Chou, J.C. Hsu and Chauchin Su, “A Digital BIST 
Methodology for Spread Spectrum Clock Generators” The Fifteenth Asian Test 
Symposium, Nov. 2006.  
一、計畫摘要 
在高速傳輸接收系統的量測中，高效能
儀表與長測試時間使測試成本居高不下，因
此本文提出一高速序列介面之自我測試電
路設計，它利用數位控制延遲電路與數位/
類比轉換電路分別決定取樣時脈與電壓比
較區間，判斷眼圖有無符合規格。本設計使
用 UMC 90nm 製程實現，晶片面積為
1.44mm2。驗證結果顯示對 2.5Gbps 的待測
資料，可偵測振幅為±600mV，平均電壓解
析度為 2.34mV；可偵測時脈範圍為 700ps。
平均時脈解析度為 2.8ps，在 1V 與 2.5V 的
供應電壓下功率消耗為 8.8mW。 
關鍵字–自我測試電路，時脈抖動量
測、眼狀圖、介面電路 
二、 計畫緣由與計畫目的 
隨著製程技術與電路技術的改進，操作
速度達到數 Gbps 的序列傳輸系統廣泛地應
用許多商用通訊介面上，如 PCI-E,SATA, 
USB 等，在量產測試上需要更高階的量測
機台，對各項特性進行長時間的量測，使得
製造成本無法有效降低。因此本論文提出一
測試電路，可以針對信號的眼圖 (Eye 
diagram)進行量測，如圖 一所示，並將測
試結果以較為低速的數位訊號輸出，不需高
階量測機台即可進行量測結果的分析，以降
低生產成本。 
本報告內容組織章節如下，第二部分以
行為層次介紹此內建自我測試電路之測試
流程與所使用的電路模組。第三部分敘述每
個分部模組的電器規格、電路架構、設計考
量與模擬驗證結果。第四部分介紹整個電路
系統晶片的實現與量測，包含電路的佈局設
計，測試環境的建置以及測試結果整理之規
格表。第五部分則總結本研究內容。 
三、 研究方法-系統架構與測試流程 
整個自我測試系統分為五個區塊，如圖 
二所示，包含數位控制延遲電路、數位/類
比轉換電路、取樣/保持電路、比較器與計
數器。 
整個測試系統操作流程概述如下，取樣
/保持電路取樣待測資料並送到比較器的輸
遲電路產生不同相位的參考時脈給取樣/保
持電路。數位/類比轉換電路產生不同差模
參考電壓給比較器。兩個全差動比較器分別
比較待測信號與正負差模參考電壓，兩比較
器輸出使用互斥邏輯閘做運算，當輸出入，
數位控制延邏輯為 1，代表信號取樣值小於
差動電壓絕對值，反之則代表信號取樣值大
於差動電壓絕對值。關於電路的動作部分，
T1~T8 代表延遲電路產生的延遲時間，
V1~V8 代表數位/類比轉換電路的輸出電
壓，首先將時間與電壓固定為 T1 與 V1，進
行多次取樣並記錄，完成取樣後將資料送
出，接著改變至其他電壓繼續取樣，當 V1
到 V8 整個電壓範圍都完成取樣動作並送出
資料，我們可以得到眼狀圖在特定相位底下
電壓的分佈狀況(Histogram)，接著往右增加
一個時脈解析度 Δt 變成 T2，再次對 V1~V8
每個電壓進行取樣得到下一特定相位的電
壓分佈，重複此動作直到所有資料相位都完
成，據此我們可以描繪出待測資料的眼圖並
確認有無符合規格。 
M
A
X
.1
20
0m
V
80
0m
V
 (T
X
)
17
5m
V
 (R
X
)
160ps (RX)
300ps (TX)
400ps (1UI)
Minimum
Eye
opening
Normal Eye
Overshoot
Overshoot
TX
Eye diagram
Measurement
 i
t
RX
v5
t2
v6
v7
t3t1 t4 t5 t6
v8
Pass Fail
v2
v3
v4
v1
t7 t8
 
圖 一 高速序列傳輸系統之自我測試電路示意圖 
VS
VO
RS CS
VS
VO
VERROR
fS
CLK
X1
X2
X3
2.5V
1V
X2/
X3
IN
INB
O
OB
400p 400p
TR ~1UI
fS ~1.25GHz
TR ~0.25UI
fS ~5GHz
 
圖 五 取樣/保持電路 
 
振幅最大值為 1.2V，因此數位/類比轉換電
路的產生±0.6V 的差動電壓。電壓解析度設
定為 1%，可容許最大取樣誤差比例為 5%，
眼狀圖內每點是根據 1E+6 次取樣結果，因
此計數器設定為 20 位元。 
根據 PCIE 的輸出資料進行設計，關於
分部模組所需之電器規格，為得到完整眼
圖，數位控制延遲電路的調整範圍間須大於
一個資料周期，假如要偵測到 0.1 個資料區
間的隨機性峰對峰時脈抖動，錯誤率低於
1E-12 狀況下，最小時脈解析度須為
(0.1/14.2)個資料區間，也就是 2.8ps。輸出
資料差動振幅最大值為 1.2V，因此數位/類
比轉換電路的產生±0.6V 的差動電壓。電壓
解析度設定為 1%，可容許最大取樣誤差為
5%，眼狀圖內每點需要根據 1E+6 次取樣結
果，所以計數器設定為 20 位元。 
四、 研究方法-分部模組電路架構 
 取樣/保持電路 
取樣/保持電路主要的作用是抓取發射端
2.5Gbps 的資料，將值送到比較器與數位/
類比轉換電路去做比較。PCIE 在發設端的
信號規格，定義 20%至 80%的轉態時間為
0.125 個資料區間，此資料可近似 5GHz 的
時脈。若將取樣電路以單極點系統的增益函
近似，由於我們對取樣/保持電路的要求是
在 5GHz 操作頻率下，要求取樣值誤差比例
(△V)小於 5%，即信號增益為 0.95，則輸出
點時間常數可計算如下 
0.95 
21
1)( =+= SSS CRf
sA π  (1)
SSSS TTCR 0523.0 2
329.0 == π  (2)
計算得到輸出點的寄生電阻與寄生電
容乘積須小於 10.47ps，其中寄生電組部分
由開關的等效電阻主宰，在此設定為 20Ω，
另外寄生電容則是開關的寄生電容 SWC 加
保持電容 LC ，設定為 0.523pF。在開關為
20Ω 的尺寸底下其寄生電容變動範圍為
0.1~ 0.15pF，因此設定保持電容的大小為
0.4pF。取樣/保持電路架構如圖 五所示，由
於輸入共模電壓為 0.7V，為了提高開關閘
極(Gate)與汲極(Drain)間的壓差，藉以降低
電晶體的尺寸，以得到較穩定的阻值，開關
電阻採用 2.5V 厚氧化膜的 N 型電晶體。 
由於數位控制延遲電路的輸出震幅為
1V，我們加入一 Pseudo-N 組態的反相器做
為時脈緩衝電路(Clock Buffer)，以提升時脈
振幅至 2.5V 並驅動切換開關。另外由於單
相位時脈本身有偶合至輸出信號 (Clock 
feed through) 造成誤差的問題，解決方式為
因此產生反相時脈並偶合至額外複製的開
關(dummy switch) 以抵消原相位的誤差。 
 數位/類比轉換電路 
數位 /類比轉換電路的輸出範圍為
±0.6V，控制信號為八位元，因此輸出解析
度為 2.34mV，整個數位/類比轉換電路電路
架構如圖 六所示，為了減少被動元件的使
用以降低硬體成本，我們採電流切換式數位
類比轉換(Current-mode DACs)的架構，在電
流源的控制上分為四位元的微調電路(Fine 
tune)與四位元的粗調電路(Coarse tune)，由
於電流源與電流開關電路疊接(Cascade)了
三級，消耗許多頂部空間(Head room)，無 
I2p
2K
OP1
OP1
OP1
2KIb
Bias
O
4/0.4
M=2
0.5/0.4
M=2
1/0.8
M=2
Bias
O
5/0.4
M=2
0.4/0.4
M=2
2/0.8
M=2
(a) (b) (c)
 
圖 八 使用於數位/類比轉換電路中 P 與 N 型電晶體主動負載全差動比較式放大器之電路
圖 (a) OP1 (b) OP2 (c) OP3 
Frequency (MHz)
O
pe
n 
lo
op
 g
ai
n 
(d
b)
Ph
as
e 
(d
eg
re
e)
Additional 
pole & zero
PM:37
Unstable
pole
Zero
W/I RC
W/O RC
W/I RC
W/O RC
0
20
40
60
90
0
-90
0.1 1 10 100
180
-180
0.4
C
R
 
圖 九 對數位/類比轉換電路的自我校正電路加入電阻電容作極點補償前後之頻率響應圖  
 
於 M10 與 M9 兩電晶體的電流鏡射關係，
使得通過複製輸出電組上的電流降低，則輸
出電壓因此提升。若此時放大器的負端輸入
仍低於 400mV，則回授電路會重覆上述回
授動作直到放大器輸入兩端電壓相同。 
回授路徑中所使用的運算放大器
OP1/2 採用以電流源為負載的單級放大
器，架構如圖 八所示，考量對應的共模操
作範圍，運算放大器 OP1 需要較高共模的 
輸入準位，因此設計為 N 型輸入差動對，
輸入共模範圍為 0.1V~0.6V，輸出共模電壓
為 0.7V，另一運算放大器 OP 則針對低輸入
共模準位，因此設計為 P 型輸入差動對，輸
入共模為 0.3V ~0.9V，輸出共模電壓為
0.3V。 
同時我們於回授路徑上置入一串聯電阻-電
容產生額外零點與極點進行穩定度補償
(Pole-Zero compensation)，增加一個主極點
和一個零點，此零點的位置大約為迴路增益
等於 1 的頻帶，如此可以達到約 45∘的相
位邊限(Phase margin)，圖 九則是回授系統
的頻率響應模擬的加入補償電路前的系統
增益轉換曲線的頻率響應圖沒有加串聯電
阻-電容，相位超過 180 導致系統不穩定，
會在時域上產生的輸出電壓震盪的現象。運
算放大器本身在高頻響應是屬於低通，故僅
需在運算放大器的輸出，置入一單階低通電
阻-電容網路，即可作頻率補償，極點-零點
補償法就是去除原第一極點，增加一個零
點，來消除原第一極點。圖 十是數位/類比
轉換電路模擬，結果顯示在製程飄移分別為
FF、TT 與 SS 情況，供應電壓變動±10%的
情況下，最大的非線性積分誤差與微分誤差
分別保持在±0.5 和±0.15 LSB 以內。 
Control
TD
TD’
R
es
ol
ut
io
n
1 2 3 4
R
es
ol
ut
io
nΔt’ ΔtΔt Δt Δt’ Δt
Control:1 Cotnrol:2 Control:3
0.2 0.4 0.6 0.8 1.0 1.2 1.4 1.6
ΔCNΔCN ΔCPΔCP
1.0
1.4
1.8
2.2
2.6
3.0
Pa
ra
sit
ic
 C
ap
ac
ita
nc
e 
(f
F)
Output voltage VO ( V )
Pa
ra
sit
ic
 C
ap
ac
ita
nc
e 
(f
F)
Ctrl
VOVIN
Ctrlb
Ctrl
CN
CP
VO
(a)
(b)
CN (Ctrl=0)
CP (Ctrl=1)
CP (Ctrl=0)
CN (Ctrl=1)
 
圖 十二 微調單元電路及操作原理示意圖 
Pre-Amp
VIP
VIN
VR
VRB
VOUT
GS GS GS GS
ib r
ob
2.5V
o
i rb
obo
o2
1V
oob
o2b
1V
 
圖 十三 比較器之電路圖 
 
的電容值。若控制信號為一，當輸出電壓值
為低準位，輸出點電容值為 N 型電晶體導
通的電容值加上 P 型電晶體關上的電容
值，當輸出電壓值為高準位，輸出點電容值
為 N 型電晶體關上的電容值加上 P 型電晶
體導通的電容值。模擬結果顯示微調單元可
達解析度為 2.8ps。 
 比較器 
比較器的架構如圖 十三所示，由差動
放大器與增益級放大器組成，其中差動放大
器用來比較不同共模準位的待測信號與參
考信號之間的差動振幅大小並得到差值，此
差值再經三級放大器逐級放大到後端數位
邏輯可判斷的位準，差值最小等於數位/類
比轉換電路解析度的一半(0.5LSB)，差值放
大後等於類比數位轉換電路的全幅輸出，因
此所需放大倍數為 512(54db)。 
差動放大器的輸入範圍是由發射端的
輸出電壓所決定，發射端的差模電壓範圍為
800~1200mV，輸入共模範圍為 0V~1V，為
了用寬範圍的共模輸入位準，輸入差動對選
擇 ( )IBI VV − 與 ( )REFBREF VV − 進行比較，而非
( )REFI VV − 與 ( )REFBIB VV − ，另外我們未採用
互補式差動對來達成操作全幅共模範圍的
要求，而是用 UMC 90nm 中輸入/輸出單元
的 2.5V 電晶體，原因在於可避免互補式差
動對本身 N 型與 P 型電晶體本質上及製程
VICM:0Æ1V
Frequency (MHz)
0.1 1
70
82
74
78
86 AD >85dB,F3db >255M TT
SS
FF
AD >78dB,F3db >606M
AD >71dB,F3db >680M
27.6dB
25.7dB
23.8dB
Frequency (Hz)
0.1 1
FF
TT
SS
22
24
26
28
 
圖 十六 (左)增益級放大器之增益 (右)輸入共模變異之增益 
CI
C[7] C[1] C[0]
ET DD D
CLK
D
DD D D D
C[2]
Out
CK2
CK3
i[7]
D
i[6]
D
i[1]
D
i[0]
D
D D D D
Sb
CK3
/RS2
(a) (b)
CTRL[1,0]
CK2 CK3
CLK
F/25
F/25
F/25
F/22 F/22
UP
T S0 T S1 T S18 T S19
CK
DIn Out
D D
C[0] C[1]
D D
C[2] C[3]
CK3
CTRL
D
C[4]
D D D
C[5] C[6] C[7]
(a)
(b) (c)
 
圖 十七 數位電路架構圖 (a) 計數器 (b) 數位控制延遲電路有限狀態機/數位/類比轉換電
路有現狀態機 (c)除頻器 (d)序列輸入電路 (e)序列輸出電路圖 
 
 系統有限狀態機 
包含有限狀態機、計數器、除頻器與序
列輸出/輸入電路，計數器負責計數取樣資
料的絕對值落在數位/類比轉換電路輸出之
參考電壓內次數。在 PCIE 中定義時脈抖動
值是以 1E+6 次取樣的累計值，因此使用 20
位元同步式計數器。取樣週期由一個除數為
2E+20 的除頻器實現，可以經外部數位控制
信號改變取樣週期，可選擇取樣週期為
2E+5、2E+10、2E+15 和 2E+20 四種。有限
狀態機產生延遲電路和數位/類比轉換電路
的控制信號，每完成一個點的取樣，會透過
除頻器產生溢位信號通知有限狀態機更新
到下一組控制信號，整個眼圖的逐點取樣在
控制信號的變動如同 16 進位的計數器，其
中較高 8 位元為數位延遲控制電路的控制
信號，較低 8 位元為數位/類比轉換電路的
 
圖 二十 測試 PCB 照相 
4 4 4 4 4 4 5 8888888888601
4 4 4 4 4 4 0 0 0 0 6 888888530
4 4 4 4 4 0 0 0 0 0 0 288888455
4 4 4 4 4 0 0 0 0 0 0 0 88888380
4 4 4 4 0 0 0 0 0 0 0 0 0 8887 305
4 4 4 4 0 0 0 0 0 0 0 0 0 8887 230
0 4 4 0 0 0 0 0 0 0 0 0 0 0 880 155
0 4 4 0 0 0 0 0 0 0 0 0 0 0 87 0 80
0 44 0 0 0 0 0 0 0 0 0 0 0 87 0 5
0 4 4 0 0 0 0 0 0 0 0 0 0 0 87 0 -70
0 4 4 0 0 0 0 0 0 0 0 0 0 0 88 0 -145
4 4 4 4 0 0 0 0 0 0 0 0 0 7 885 -220
4 4 4 4 0 0 0 0 0 0 0 0 0 8885 -295
4 4 4 4 40 0 0 0 0 0 0 6 8888-370
4 4 4 4 4 0 0 0 0 0 0 0 88888-445
4 4 4 4 4 40 0 0 0 1 888888-520
4 4 4 4 4 4 56 888888888-596
4784434133843553242952662362061771481198859300
400m
V
400ps
1010101010101010101010101010101010601
1010101010101010101010101010101010530
1010101010101010101010101010101010455
44444000 0 88888888380
44440000 0 0 0 888888305
44400000 0 0 0 0 88888230
44400000 0 0 0 0 38880155
44000000 0 0 0 0 0 8880 80
0 4000000 0 0 0 0 0 0 82 0 4
44000000 0 0 0 0 0 8880 -70
44400000 0 0 0 0 0 6 880 -145
44400000 0 0 0 0 88888-220
44440000 0 0 0 888888-295
44444000 0 88888888-370
1010101010101010101010101010101010-445
1010101010101010101010101010101010-520
1010101010101010101010101010101010-596
47844341338435532429526623620617714711888.45929.50
400m
V
400ps
1010101010101010101010101010101010601
1010101010101010101010101010101010530
1010101010101010101010101010101010455
1010101010101010101010101010101010380
1010101010101010101010101010101010305
1010101010101010101010101010101010230
4 4 4 400 0 0 0 0 0 0 88888155
04 4 0 0 0 0 0 0 0 0 0 0 088080
4440 0 0 0 0 0 0 0 0 0 78805
4 4 4 40 0 0 0 0 0 0 0 0 7 888-70
4 4 4 4 0 0 0 0 0 0 0 0 88888-145
1010101010101010101010101010101010-220
1010101010101010101010101010101010-295
1010101010101010101010101010101010-370
1010101010101010101010101010101010-445
1010101010101010101010101010101010-520
1010101010101010101010101010101010-596
4784434133843553242952662362061771481198859300
400m
V
400ps
(a) (b) (c)  
圖 二十一 測試系統驗證結果 (a)眼圖張開振幅約為 600mV (b)眼圖張開振幅約為 400mV 
(c)眼圖張開振幅約為 200mV 
 
N4901B 產生 2.5Gbps 得隨機信號，並使電
路進入自我測試模式。利用 Agilent 16702B
紀錄晶片所輸出的取樣次數與相位、電壓控
制信號，利用桌上型電腦之軟體，加以分析
並繪製，與眼狀圖做比對。圖 二十是整個
晶片的測試電路版照相圖 
 晶片量測結果 
圖 二十一為整個測試電路系統針具有
三種不同的輸入振幅、操作於 2.5Gbps 的隨
機資料所進行的驗證，輸入振幅分別為
200mV、400mV 與 600mV，類比數位轉換
電路與數位控制延遲電路的解析度則設定
為 4bit，為了方便呈現結果，圖中 0~10 代
表取樣點數為在電壓範圍之內的次數占總
點數的比例，如 8 代表八成的取樣結果都在
參考電壓範圍之內，若為 0 則代表所有取樣
值均大於參考電壓，圖中黃色區域代表沒有 
信號經過，可以等效為眼圖張開區域(eye 
opening) ，由於測試電路所取樣得到的眼狀
圖與外部輸入的眼狀圖吻合，顯示我們所設
計的測試電路系統可以完成眼狀圖的量
測。根據相關的量測與模擬結果，表格 一
為整個電路系統的效能總結。 
六、 結論與討論 
在本研究中，我們實現了一高速序列介
面之自我測試電路設計，並運用於 PCI-E 規
格，此電路可逐一取樣眼狀圖中不同時間區 
間與電壓區間的資料，判斷眼圖有無符合規
格。我們利用數位控制延遲電路與數位/類
比轉換電路分別決定取樣時脈與電壓比較
區間，並透過數位電路將結果轉換成較為低
速的數位資料輸出至儀器進行分析，不需要
昂貴的測試儀器以降低成本。 
本設計使用 UMC 90nm 製程實現，晶
片面積為 1.44mm2 。驗證結果顯示對
2.5Gbps 的待測資料，可偵測振幅為±0.6V，
平均電壓解析度為 2.34mV；可偵測時脈範
圍為 700ps。平均時脈解析度為 2.8ps，在 
 16
Spectrum Clock Generators” The 
Fifteenth Asian Test Symposium, Nov. 
2006  
[18] J.C. Hsu and Chauchin Su, “BIST for 
Jitter Measurement and Jitter 
Decomposition of CDR,” IEEE 
International Mixed-Signals Testing 
Workshop, Jun. 2006.  
[19] J.C. Hsu and Chauchin Su, “Timing Jitter 
and Modulation Profile Extraction for 
Spread-Spectrum Clocks,” IEEE Trans. 
On Instrumentation and Measurement, 
(Accepted) 2009. 
[20] J.C. Hsu and Chauchin Su, “BIST for 
Measuring Clock Jitter of Charge-Pump 
Phase-Locked Loops,” IEEE Trans. On 
Instrumentation and Measurement, Vol. 
57, No.1, pp.276~295 2008. 
八、 計畫成果自評 
在本研究計畫中，我們按照預計畫內容
逐一完成下列工作: 
1. 提出了一個適用於高速序列介面之
自我測試方式，並以 2.5Gbps 之背板通訊傳
輸規格 PCI-E 帶入此測試方式。 
2. 以行為模式規劃這個測試系統的操
作流程與時序，並逐一針對每個模組設計適
用的電路架構進行模擬，並利用模擬確認此
測試系統的可行性。 
3. 透過測試晶片的驗證來量測 2.5G 
bps 的資料，得到合理的眼狀圖，確認此架
構的可行性。 
4. 撰寫相關的技術文件與文獻並且針
對其中的三項關鍵技術先後完成了三項美
國專利[14] [15] [16]的申請，在論文部分發
表為兩篇國際研討會論文[17][18]與兩篇
IEEE 國際期刊[19][20]，詳細內容收於附
錄。 
4. 培育專門之人才，包含兩位碩士級
畢業生與一位博士級畢業生與其他衍生效
益部分，並且也衍生一個相關的業界合作計
畫，以提升相關產業競爭力。相關資料如下: 
z 衍生業界合作計畫 
1. 時間: 2005 年 1 月~2008 年 6 月 
2. 名稱: BIST for and PCI-express 
3. 單位: 智原科技 
 
z 培育相關人才 
1. 徐仁乾 - 博士級畢業生 
2. 史汝敏 - 碩士級畢業生 
3. 紀順閔 - 碩士級畢業生 
附 錄 
 衍生專利: Jenchien Hsu, Hungwen Lu, Chauchin Su, YeongJar Chang, “Sample and 
hold circuit and related data signal detecting method utilizing sample and hold circuit,” 
U.S. Patent, Application No. 11/854,560, Aug. 13, 2007.   
 
 
附 錄 
 國際研討會論文 : M.H. Chou, J.C. Hsu and Chauchin Su, “A Digital BIST 
Methodology for Spread Spectrum Clock Generators” The Fifteenth Asian Test 
Symposium, Nov. 2006.  
 
 
 
 附 錄 
 期刊論文 : J.C. Hsu and Chauchin Su, “Timing Jitter and Modulation Profile 
Extraction for Spread-Spectrum Clocks,” IEEE Trans. On Instrumentation and 
Measurement, (Accepted) 2009. 
 
 
