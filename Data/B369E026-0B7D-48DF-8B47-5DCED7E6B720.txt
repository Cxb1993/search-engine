  
前言 
 自 1950 年起，非同步電路(asynchronous circuits)[1][2][3]的設計概念逐漸起
步，與同步電路相較之下，非同步電路不需全域時脈(global clock)來協同整個電
路運作，是靠著控制器與各模組之間經由交握訊號(handshaking signals) [3][4]來
溝通。交握訊號可分為二相式(two-phase)與四相式(four-phase)兩種[3]，對一般非
同步電路設計而言，四相式通訊協定是一絕佳的選擇，因四相交握設計上較易合
成且電路簡單，一個完整的四相通訊協定週期，是由運算週期與歸零週期所組
成，當運算週期結束時，四相式主動元件會送出資料訊號，在歸零週期間所有的
交握訊號須重置到先前的初始狀態，而歸零週期會產生多餘的運算時間，為了提
昇效能，我們針對非同步控制器提出一個最佳化的技術。 
 
 
1. 研究目的 
 在非同步電路設計中，控制器是一個重要的元件，根據交握協定(handshaking)
的方式，可分為爆發模式與延伸爆發模式 [5][6][7]，這兩種控制器可用二相式
(two-phase)與四相式(four-phase)通訊協定來描述。二相式通訊協定是採用訊號轉
態(signal transitions)來轉譯，藉由兩條訊號轉態來完成交握動作；四相式通訊協
定則是採用訊號準位(level signals)來達到交握通訊，不同於訊號轉態的是，訊號
準位需要有歸零(reset)的過程才能完成通訊迴圈。本計畫採用四相式通訊協定來
描述控制器，因為以事件觸發來實作遠比準位觸發困難，因此在四相式的非同步
電路裡，控制器透過交握訊號來控制所有的電路元件，且在歸零週期下，電路是
處於等待交握訊號歸零的狀態，而交握訊號必須歸零後才可以進行下一個運算，
因此歸零週期會使電路產生多餘的等待時間，為解決此問題，本計劃開發並實作
四相式非同步控制訊號重組工具，改進因四相交握通訊協定重置週期所形成的延
遲時間，藉以提升非同步控制器的運作效能。 
 
 
2. 研究方法 
 本次計劃針對四相式爆發/延伸爆發模式控制器，提出一個歸零週期搬移技
術，以此方法提升控制器的效能，同時增加電路執行的速度，最佳化的方法分為
三個步驟來處理。第一步搜尋控制器中所有的歸零週期、第二步將合併狀態(join 
state)與歸零週期做分割處理、第三步將歸零週期搬移至鄰近狀態中，由以上步
驟處理後，即完成非同步控制器的訊號重組。 
 最後以 五個測試範例來驗證最佳化前/後控制器的效能差異，將測試電路實
做於 FPGA 板上，並使用硬體描述語言搭配 3D 合成後所產生的控制器進行模擬
與驗證，並証明最佳化方法能夠有效提升運算速度與效能。 
  
3.2 非同步控制器最佳化 
 
3.2.1 搜尋歸規零週期狀態 
 我們簡單的描述歸零週期的定義：當檢知訊號有效(準位由 0 到 1)到檢知訊
號回到初始值(準位由 1 到 0)，為所有控制器歸零的時間，我們用例子來補充說
明，圖 2 延伸爆發模式控制器狀態圖中的 cnt.ack 與 add.ack 的初始值皆為 0，
狀態 2 到狀態 3 包含了 cnt.ack-與 add.ack-；因此，狀態 2 到狀態 3 我們稱為歸
零週期。反之，如果 cnt.ack 與 add.ack 的初始值為 1，那程序將改為搜尋 cnt.ack+
與 add.ack+的相反值，圖 3 為其演算法描述。 
 
 
1
2
3
45
9
8
7
6
0RESET
req+ | 
cnt.req+ add.req+
cnt.ack+ add.ack+ | 
cnt.req- add.req-
cnt.load- add.rst-
cnt.ack- add.ack- [cnt.zero-] | 
mul.req+
mul.ack+ | mul.req-
mul.ack- | add.req+
add.ack+ | add.req-
add.ack- | cnt.req+
cnt.ack+ | cnt.req-
cnt.ack- [cnt.zero-] | 
mul.req+
cnt.ack- [cnt.zero+] | 
ack+
req- | 
ack-  cnt.load+  add.rst+
cnt.ack- | 
add.ack-  [cnt.zero]+  ack+
10%
90%
90% 10%
 
圖 2 延伸爆發模式控制器狀態圖 
 
 
 3.2.3 移除歸零週期狀態 
 在檢查訊號重組歸零週期方法之前，我們必須先定義歸零週期的種類，每一
個爆發模式與延伸爆發模式的轉態皆包含一對輸入及輸出狀態(現在狀態與下個
狀態)，根據"現在狀態"或"下個狀態"的輸入轉態或輸出轉態情況來區別歸零週期
的種類，主要分為以下六種類型： 
 
類型一：目前狀態只有一個輸入轉態，下個狀態只有一個輸出轉態。 
 
類型二：目前狀態有多個輸入轉態，下個狀態只有一個輸出轉態。 
 
類型三：目前狀態有多個輸出轉態，下個狀態只有一個輸入轉態。 
 
類型四：目前狀態有多個輸入轉態，下個狀態有多個輸出轉態。 
 
類型五：有多個歸零週期分享目前狀態，目前狀態只有一個輸入轉態。 
 
類型六：有多個歸零週期分享目前狀態，目前狀態有多個輸入轉態。 
 
我們將類型一、類型二及類型三視為類型四的衍生類型，類型四移除歸零週
期的方法是將輸出訊號移動到所有下個狀態的輸入轉態，並將輸入訊號移動到所
有下個狀態的輸出轉態，而歸零週期就可以移除。訊號重組類型五的程序需要兩
個步驟，第一步先將歸零週期轉態的輸入訊號，移至下個狀態的輸出轉態，歸零
週期的輸入訊號必須移動到轉態的輸入訊號。第二步再將現在狀態中輸入轉態的
所有輸入(輸出)訊號，移動到歸零週期的輸入(輸出)，執行完所有步驟後，歸零
週期轉態將會沒有輸入訊號及輸出訊號，而歸零週期轉態也可以被移除。類型六
是所有歸零週期類型裡最複雜也是最罕見的，解決類型六的歸零週期需先分割多
個輸入轉態，藉由這樣可以將一個類型六的狀態機轉換成多個類型五的狀態機，
然後再透過類型五的訊號重組處理方法就可以移除類型六的歸零週期轉態。圖 5
為訊號重組類型四與類型五的演算法。 
 Implementation
Behavioral
Simulation
Post-Route
Simulation
error
error
 
圖 6 ISE 電路設計驗證流程圖 
 
電路設計方面採用 Verilog 硬體描述語言來設計電路，設計完成後再經由行
為描述模擬來驗證其功能的正確性，如不正確就必須返回上一層重新設計，此模
擬不會加入任何的延遲時間，但可以手動加入自訂的延遲時間進行模擬，等到功
能驗證正確後，再進一步進行繞線後的模擬，為了要模擬真實環境，會將所有自
行加入的延遲時間忽略掉，並依照電路特性來模擬延遲時間。由於 FPGA 特性的
關係，此運算時間會比全客製化來的大，也比較不接近真實的電路情況。 
 
4.2 實驗流程 
 圖 7 為自我時序電路驗證流程，首先將電路分成控制器與資料路徑元件兩個
部分來實做，實做完再分別做功能驗證，確定設計正確後，最後再合起來做功能
驗證以及效能的分析，下面分別針對控制器及資料路徑元件講解其驗證流程： 
 
 控制器：首先由“3D”的格式來設計未經訊號重組以及經過訊號重組的控制
器描述，再經由控制器合成工具“3D”轉譯成邏輯方程式，同時也經由我們設
計的工具轉譯出鏡像控制器，由“3D”轉譯出來的方程式使用 Python 轉譯為
Verilog 碼，最後將剛剛轉譯出來的鏡像控制器與我們的控制器作功能驗證，如
果其動作不是我們想要的，則需重覆上述動作直到功能正確為止。 
 
 資料路徑元件：首先要先設計所需功能的演算法，接著將演算法轉譯成Verilog
的描述方式，再將資料路徑元件所需要的延遲元件加入，最後做功能的驗證，如
果功能錯誤則可能會有兩個原因，一是演算法或者轉譯錯誤，再者就是延遲時間
不足，無法在時間內執行一個完整的四相式交握週期。 
 DATA_OUT=(A*B)+DATA_OUT，首先將 A 輸入與 B 輸入做相乘後，再將
Register3 的資料做加法運算才將資料輸出。電路的動作流程如下：(1)當控制器
REQ 訊號有效時，控制器先將訊號 reg1.req、reg2.req 送至暫存器 Register1
與 Register2 中並讀取資料，同時 req.rst 訊號為 1 將 Register3 內容清除為零。(2)
當控制器檢知訊號 reg1.ack、reg2.ack為 1時，表示暫存器 Register1、Register2
數值接收完成，接著控制器送出 mul.req 至乘法器進行運算。(3)當 mul.ack 為 1
時表示乘法器運算完成，接著控制器送出 add.req 至 ADD 執行加法運算。(4)控
制器接收到 add.ack 為 1 時表示與前一級相加完成，同時控制器送出 reg3.req 至
暫存器，以儲存執行完加法運算的訊號並等待輸出。(5)當資料輸出後將 reg3.ack
設定為 1，當控制器接收到以後，即設 ACK 訊號有效，完成一個完整的週期運
算。 
 
 
Register1
Register2
Register3
REQ ACK
MUL
ADD
B[7:0]
A[7:0]
DATA_OUT[16:0]
XBM Asynchronous Controller
re
g
2
.r
eq
re
g
2
.a
ck
re
g
1
.r
eq
re
g
1
.a
ck
m
u
l.
re
q
m
u
l.
ac
k
ad
d
.r
eq
ad
d
.a
ck
re
g
3
.r
eq
re
g
3
.a
ck
re
q
.r
st
 
圖 8 算數電路架構圖 
 
 
 
4.3.2 控制器描述 
圖 9、10 分別為最佳化控制器前、後的延伸爆發模式狀態機描述，相較之下
最佳化後控制器減少了 7 個狀態。 
  
4.2.3 模擬結果 
 我們以執行全模擬的方式來評估電路效能。下圖 11、12 為最佳化控制器前、
後的波形，我們可以得知，未最佳化的波形圖在執行全模擬的情況下，所需花費
時間為 16,451,537ns，經過我們所設計的非同步控制器最佳化技術後，執行所花
費時間為 10,708 ,854ns，因此得以證明我們非同步控制器最佳化技術能夠有效改
善效能，並且簡化狀態數。 
 
 
圖 11 算術邏輯運算波形圖(未最佳化) 
 
 
圖 12 算術邏輯運算波形圖(最佳化) 
 
4.3 執行效能分析 
我們透過測試範例的結果可以觀察出，當控制器最佳化後效率有著明顯的改
善。表 1 為控制器效能比較表，由表中數據的統計中我們可看出，經過最佳化後
的控制器至少都有達到一定的效率的提升。 
  
[1]. Scott Hauck, “Asynchronous design methodologies: An overview,” In Proc. 
IEEE, Vol. 83, No. 1, pp 69- 93, January 1995. 
[2]. A. Davis and S.M. Nowick., "An Introduction to Asynchronous Circuit Design," 
Technical Report UUCS-97-013, Computer Science Department, University of 
Utah, Sep. 1997. 
[3]. J. Spars_ and S. Furber, eds., Principles of Asynchronous Circuit Design:A 
Systems Perspective. Kluwer Academic Publishers, 2001. 
[4]. Jung, E.-G., Choi, B.-S., Won, Y.-G., Lee, D.-I., “Handshake protocol using 
return-to-zero data encoding for high performance asynchronous bus,” In Proc. 
IEE Computers and Digital Techniques, July. 2003, pp.245 – 251. 
[5]. Mark Balch., Complete Digital Design. McGraw-Hill, 2003. 
[6]. Yun, K.Y., Dill, D.L., ”Automatic synthesis of 3D asynchronous state machines,” 
in Proc. IEEE/ACM International Conference Computer-Aided Design(ICCAD), 
pp.576 – 580 , Nov. 1992.1 
[7]. K. Y. Yun and D. L. Dill, “Automatic synthesis of extended burstmode circuits: 
part I (specification and hazard-free implementation),” IEEE Transactions on 
Computer-Aided Design of Integrated Circuits and Systems, Vol.18, Iss.2, 
pp.101-117, Feb. 1999. 
[8]. Altera Corporation, Introduction to the Quartus II Software, 101 Innovation 
Drive, San Jose, CA 95134, 2007. 
 
98年度專題研究計畫研究成果彙整表 
計畫主持人：楊榮林 計畫編號：98-2220-E-218-001- 
計畫名稱：基於四相交握通訊協定的非同步控制器最佳化技術 
量化 
成果項目 實際已達成
數（被接受
或已發表）
預期總達成
數(含實際已
達成數) 
本計畫實
際貢獻百
分比 
單位 
備 註 （ 質 化 說
明：如數個計畫
共同成果、成果
列 為 該 期 刊 之
封 面 故 事 ...
等） 
期刊論文 0 0 100% 無 
研究報告/技術報告 0 0 100% 無 
研討會論文 1 1 100% 
篇 
義守大學 2010 電
子工程技術研討
會 
題目:最佳化非同
步控制器演算法 
論文著作 
專書 0 0 100%  無 
申請中件數 0 0 100% 無 專利 已獲得件數 0 0 100% 件 無 
件數 0 0 100% 件 無 
技術移轉 
權利金 0 0 100% 千元 無 
碩士生 0 0 100% 3 人:盧欣農、魏兆成、蔡安泰 
博士生 0 0 100% 無 
博士後研究員 0 0 100% 無 
國內 
參與計畫人力 
（本國籍） 
專任助理 0 0 100% 
人次 
無 
期刊論文 0 0 100% 無 
研究報告/技術報告 0 0 100% 無 
研討會論文 0 0 100% 
篇 
無 論文著作 
專書 0 0 100% 章/本 無 
申請中件數 0 0 100% 無 專利 已獲得件數 0 0 100% 件 無 
件數 0 0 100% 件 無 
技術移轉 
權利金 0 0 100% 千元 無 
碩士生 0 0 100% 無 
博士生 0 0 100% 無 
博士後研究員 0 0 100% 無 
國外 
參與計畫人力 
（外國籍） 
專任助理 0 0 100% 
人次 
無 
 
