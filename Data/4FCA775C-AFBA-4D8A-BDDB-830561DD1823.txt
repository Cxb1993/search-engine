 
-1- 
目  錄 
 
 
一、中英文摘要 ..........................................................................................2 
二、前言與研究目的 ..................................................................................3 
三、文獻探討 ..............................................................................................3 
四、研究方法 ..............................................................................................5 
五、中文化安全即時通訊系統的實現 ......................................................6 
六、結果與討論 ..........................................................................................7 
七、參考文獻 ..............................................................................................7 
 
附錄一：可供推廣之研發成果資料表 ......................................................9 
 
 
-3- 
 
二、前言與研究目的 
即時通訊(Instant Messaging，IM) [3]為
一種提供即時交換文字訊息、語音或視訊等
媒體的服務。隨著網路技術進步，架構在網
際網路上的IM服務也越來越熱門，不論一
般公眾或企業界的個人通訊與協同工作，
IM都具有應用價值。目前幾種公眾IM系統
如MSN Messenger、Yahoo! Messenger、
ICQ、AOL、Skype…等各自有著大量使用
者。然而隨著IM越來越被廣泛使用，也突
顯許多安全問題，譬如Phishing與Hijacking
攻 擊 [10] 。 大 部 份 IM 系 統 如 MSN 
Messenger、Yahoo! Messenger、ICQ、AOL，
在使用者成功登入系統後皆以明文通訊，未
有妥善保護。以MSN Messenger 8.0為例，
使用MSN Sniffer [9]或Wireshark [14]即可輕
易竊聽通訊。 
IETF於西元2000年所提出的RFC 2778 
[4] 標準裡定義IM系統由兩種服務構成，分
別為 Presence Service與 Instant Messaging 
Service，如圖1所示。Presence Service負責
狀態訊息交換，Watcher可以透過Presence 
Service得知Presentity的狀態資訊。另一方
面，Instant Messaging Service負責用戶間即
時訊息交換，Sender欲傳送訊息予接收者，
由Instant Messaging Service將即時訊息轉寄
至接收者的Instant Box，接收者再透過IM 
Client軟體接收儲存於Instant Box上的即時
訊息。 
 
 
 
 
 
 (a) Presence Service 
PRESENTITY WATCHER 
PRESENCE SERVICE 
(b) Instant Messaging Service 
INSTANT MESSAGING SERVICE
SENDER INSTANT BOX
 
圖1：RFC 2778定義的IM系統兩種服務模型 
 
即時通訊服務Client之間通訊需透過
Server，如圖2所示，線上狀態(presence)與
聯絡人名單(contact list)皆須自IM Server取
得。Client之間可傳送文字、語音、影像、
檔案等，所以IM本質上需考量三方(兩使用
者與一伺服器)通信。若僅確保Client-Server
通訊安全，會忽略Client之間傳遞至Server
後的訊息隱私與安全[6]。IM系統的主要安
全 問 題 在 於 如 何 確 保 Client-Server 、
Client-Client通訊的確認性(authentication)、
機密性(confidentiality)、與完整性(integrity)。 
 
IM Server S
IM Client A IM Client B
text
audio
video 
file
presence
contact list
 
圖2：IM服務的三方通信模型 
 
目前 IM 協定標準主要有兩個：
SIMPLE 與 XMPP。SIMPLE 是一個以 SIP 
(Session Initiation Protocol)為基礎的 IM 協
定，採用點對點(P2P)架構進行即時訊息交
換方式，且廣泛應用於多媒體 (如 VoIP、視
訊)通訊。XMPP 標準[11,12]則是以 XML 
(eXtensible Markup Language)為通訊資料格
式，採用主從式架構進行即時訊息交換方
式，早期是 Jabber [13]系統使用的通訊協定。 
 
三、文獻探討 
加強現有IM系統的安全性可採用外掛
軟體(如IMSecure、Trillian、SimpLite)或替
代軟體(如Gaim-encryption)或用SSL/TLS，
然而這些方案仍有不足處─無法兼顧
Client-Server、Client-Client通訊安全、或是
造成伺服器計算負擔過重。目前安全IM系
統設計研究[2,6,8]傾向將IM Server假設為
可信賴的公開金鑰(public key)分送中心，當
Client登入系統且與Server建立安全通道後
藉由Server分送Client公開金鑰，IM Client
再與通訊對象協議會談金鑰，藉此避免
Server取得Client-Client通訊會談金鑰。 
為防止惡意網管竊聽 Client-Client 通
訊，Kikuchi、Tada、Nakanishi [6]於 2005
年設計以 Diffie-Hellman 演算法為基礎的安
全 IM 協定(以下簡稱 KTN 協定)。KTN 設
計如圖 3 所示，主要分成兩階段：①註冊
(registration) ，②點對點共通金鑰建立。使
用 者 Ui 註 冊 時 ， 與 IM Server 以
Diffie-Hellman 演算法協議出共同參數 yi。
當使用者 Ui與 Uj同意將對方加入好友名單
時，IM Server 會將雙方於註冊時協議的參
數 yi與 yj傳給對方。當 Ui與 Uj 雙方欲通訊
時，再透過 IM Server 進行 Diffie-Hellman
 
-5- 
({RB}EA)；計算 f6(RA)且以 KAB加密
({f6(RA)}KAB)。B 回應密文{RB}EA
與{f6(RA)}KAB傳給 A。 
z A 收到且解密後，計算 f6(RA)且與
收到的 RA 雜湊值比對是否吻合。
若吻合，計算且回應 f7(RA, RB) 給
B。 
z B收到後A的回應後，計算 f7(RA, RB)
且與收到的 RA、RB 雜湊值比對是
否吻合。若吻合，A 與 B 計算加密
會談金鑰 KS AB = f8(KAB, RB)與訊息
認證碼金鑰 Km AB = f9(RB, KAB)。往
後 A 與 B 的通訊皆以 KS AB加解密且
以 Km AB訊息認證。 
 
本研究探討的即時通訊安全並非非對
所有網路攻擊皆有防治之道，諸如木馬蠕蟲
等導致攻擊者竊聽、竄改與偽造等威脅的問
題並不在本研究的範圍，我們將安全即時通
訊 目 標 設 定 在 滿 足 Client-Server 、
Client-Client 通訊安全性。 
 
四、研究方法 
本研究目標在降低安全即時通訊系統
的Server負擔，讓IM Server不至於因為提供
安全的功能而須採用昂貴的安控硬體加速
器。我們選用橢圓曲線密碼系統 (Elliptic 
Curve Cryptosystem，ECC) [1,5]實現安全即
時通訊系統，ECC安全性依賴橢圓曲線離散
對數問題(Elliptic Curve Discrete Logarithm 
Problem)─攻擊者就算取得ECC基點 (base 
point) G與公開金鑰P = r˙G，其中r為私密
金鑰(private key)，也無法在有限時間內破解
算出r。 
IM Server與所有IM Client使用相同且
公開的基點G，Server隨機選擇小於基點級
數(order) n 的正整數KRS為私密金鑰，計算
Server公開金鑰KUS = KRS˙G，系統假設(與
[8]相同)所有使用者都得知KUS。 
本研究設計的 SIMPP (Secure Instant 
Messaging & Presence Protocol)有三個階
段：①使用者註冊②Client-Server 金鑰交換
與通訊③Client-Client 金鑰交換與通訊。協
定設計所使用的符號定義於表 2。 
 
表 2：本研究使用的符號 
A, B, S User A, B and server S. 
IDA A’s ID. 
pwA A’s password. 
RS Random string generated by S. 
KUA, KRA A’s public key KUA and private 
key KRA  
KA, KB Master key sharing between A 
(B) and server S 
{data}KAS Encrypt data with symmetric key 
KAS. 
[data]KAS HMAC of data with key KAS. 
[data]signA Sign data with A’s private key 
KRA. 
h One-way hash function. 
 
4.1  使用者註冊 
使用者註冊階段僅需執行一次，註冊完
成後，Server 儲存使用者的公開金鑰與雙方
共享的主金鑰(master key)。使用者僅需記憶
選擇的通行碼(或將對應的私密金鑰儲存至
智慧卡中)。SIMPP 的使用者階段註冊步驟
如圖 5 所示，說明如下。 
1. A 選擇代號 IDA 將通行碼 pwA 直接轉換
成整數當作私密金鑰 KRA = h(pwA)，計算
橢圓曲線公開金鑰 KUA = KRA˙G。A 計
算與 Server 共享的主金鑰(master key) 
KA，KRA˙KUS 座標值即 KA，我們用下
列公式代表 
        KA = KRA˙KUS               (4.1) 
A 將 IDA與 KUA傳送至 S (訊息 R1)。 
2. S 收到訊息 R1 後，以私密金鑰 KRS 及收
到的 KUA 計算與 A 共享的主金鑰，
KRS˙KUA 座標值即 KA 
KA = KRS˙KUA               (4.2) 
   S再產生隨機字串 RS回應(訊息 R2)至 A。 
3. A 以 KA解密訊息 R2，計算 h(IDA, KUA)
是否與訊息 R2 中的雜湊值一致。如果一
致，回應訊息 R3 至 S；否則中斷連線。 
4. S 檢驗訊息 R3 簽章是否為 A 產生的
ECDSA 簽章。如果正確，儲存 IDA、KA
與 KUA；否則中斷連線。 
 
 
-7- 
    
 
圖 8：本研究開發的 IM Client 使用者介面 
 
本 研 究 以 iksemel 
(http://iksemel.jabberstudio.org/)分析與處理
XMPP 協定，安全 IM Server 軟體修改自
jabberd (http://jabberd.jabberstudio.org/)，運
作 於 FedoraCore Linux 平 台 ， DBMS 
(Database Management System) 則 使 用
MySQL 儲存使用者驗證資料。我們使用
Borland C++ Builder 開發用於 Windows XP
平台的安全 IM Client 軟體。表 3 為本研究
的安全即時通訊系統密碼學演算法規格。 
 
表 3：密碼學演算法規格 
公開金鑰密
碼系統 
GF(p)橢圓曲線 (y2=x3 - 3x+b 
mod p)，Server 224 位元，
Client 192 位元 
金鑰交換方
法 
ECDH (Elliptic Curve 
Diffie-Hellman) 
數位簽章演
算法 
ECDSA (Elliptic Curve Digital 
Signature Algorithm) 
訊息加解密 128 bits AES，CBC 模式 
單向雜湊函
數 
SHA-256 
 
本研究 Server 與 Client 橢圓曲線
皆為質數體，Client用 192位元，Server
則為 224 位元，橢圓曲線參數採用美
國國家標準技術局 (NIST)在 FIPS 
186-2 標準文件的推薦。這些 NIST 所
推薦的橢圓曲線質數體都是某種特別
形 式 質 數 ， 稱 為 廣 義 梅 森 數
(generalized Mersenne number)，這種
質數可加速橢圓曲線相關的計算
[1]，猶如我們常用中國剩餘定理加速
RSA 相關的計算。本研究密碼學演算
法函數庫則採用開放原始碼軟體
MIRACL (http://www.shamus.ie/)。 
 
六、結果與討論 
IM服務越來越熱門，然而大部份IM系
統通信有安全問題。本研究設計以橢圓曲線
密碼學為基礎的安全即時通訊系統，確保IM
的Client-Server、Client-Client通訊安全。我
們也實際開發安全即時通訊系統的圖形化
介面IM Client軟體與伺服器端軟體，依據
RFC 3920的XMPP協定安全傳送文字訊息
與檔案。 
我們的研究論文已於2007年6月發表
於第17屆全國資訊安全會議(國立嘉義大
學)，也將發表於財團法人國家實驗研究院
科技政策研究與資訊中心的「資通安全專論
彙編」，以及電腦學刊的『網路安全』特刊。 
 
七、參考文獻 
1. 楊中皇，網路安全理論與實務，金禾資
訊，2006年。第六章:橢圓曲線密碼系統
。 
2. T. Berson, "SKYPE Security Evaluation," 
Oct. 2005, 
http://www.skype.com/security/files/2005
-031%20security%20evaluation.pdf 
3. S. Chatterjee, T. Abhichandani, L. Haiqing, 
B. TuIu, and B. Jongbok, "Instant 
messaging and presence technologies for 
college campuses," IEEE Network, Vol. 
19, No. 3, May-June 2005, pp. 4 - 13.  
4. M. Day, J. Rosenberg, and H. Suugano, “A 
Model for Presence and Instant 
Messaging,” IETF RFC 2778, Feb. 2000. 
5. D. Hankerson, A. Menezes, and S. 
-9- 
附錄一：    可供推廣之研發成果資料表 
J 可申請專利  J 可技術移轉                                      日期：96 年 10 月 30 日 
國科會補助計畫 
計畫名稱：結合 IC 卡與橢圓曲線密碼學的安全即時通訊系統設計
與具體實現 
計畫主持人：楊中皇        
計畫編號：NSC 95-2221-E-017-007     學門領域：資訊學門一
技術/創作名稱 安全即時通訊系統的實現 
發明人/創作人 楊中皇 
中文：現有大部份即時系統沒有提供通信安全。我們設計與開發具
有強化安全功能的 IM 雛型系統。安全 IM 伺服器在 Linux 平台實
現，而安全 IM 用戶端則於 Windows 平台以 C++Builder 發展工具實
現。為了更進一步確保 IM 的整體安全性及增強金鑰管理功能，我
們的 IM 用戶端的軟體可搭配 USB 讀卡機介面的 Java IC 卡。 
技術說明 英文： Most existing IM (Instant Messaging) services don’t provide 
communication security.  We designed and implemented an IM 
prototype system with enhanced security measures. The secure IM 
server software is implemented on Linux platforms while the secure 
IM client software is implemented on Windows platforms using 
C++Builder tool.  To provide better security and enhanced key 
management capability, our IM client is optionally equipped with an 
USB reader and an off-the-shelf Java IC card.  
可利用之產業 
及 
可開發之產品 
資訊業、網路服務業 
技術特點 
中文化安全即時通訊系統，符合 IETF 網際網路即時通信標準，且
可任意修改即時通訊軟體介面與登入時個人化訊息。 
推廣及運用的價值 
即時通信系統為網際網路的重要應用，即時通信系統的協定與安全
設計為關鍵技術。 
※ 1.每項研發成果請填寫一式二份，一份隨成果報告送繳本會，一份送 貴單位
研發成果推廣單位（如技術移轉中心）。 
※ 2.本項研發成果若尚未申請專利，請勿揭露可申請專利之主要內容。 
※ 3.本表若不敷使用，請自行影印使用。 
  
  
 
