 II
 4.1 SIP Analyzer ⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯28 
  4.1.1 SIP Analyzer 系統測試 ⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯ 28 
  4.1.2  SIP Analyzer 結論與心得⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯ 30 
 4.2 SIP Analyzer 應用於格網架構⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯ 31 
 4.3 3G 市場調查報告分析⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯ 32 
計畫成果自評⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯ 38 
參考文獻⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯ 39 
附件一 本計畫發表論文：整合感測器格網及知識格網之應用–SIP 行為
分析 
附件二 本計畫發表論文：探討 3G 手機設計功能面與電信市場區隔面 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 IV
 
英文摘要 
SIP (Session Initiation Protocol) is a signaling protocol for typical mobile applications such 
as Internet conferencing, telephony, presence, events notification, and instant messaging. It 
connects the mobile device or any kind of client with the server. SIP has initially been developed 
and proposed within the IETF MMUSIC (Multiparty Multimedia Session Control) working group. 
Several wireless technical forums, such as 3GPP, 3GPP2 and MWIF, have agreed on SIP as the 
basis of the session management of the mobile Internet. 
SIP ensures an integrated IP environment for mobile devices. As a protocol, it is standardized 
by the IETF (Internet Engineering Task Force), while 3GPP is standardizing the way SIP is used 
in mobile networks. 
As more and more internet telephony services developed depend on the users’ demand, the 
VoIP application is being substitute for traditional communication like PSTN. We proposed a 
distributed SIP Analyzer to help manage the SIP-based VoIP system. The SIP Analyzer can 
resorted the distributed SIP signals to understand how the SIP-based internet telephony situation. 
The SIP Analyzer, beside, can be a service interoperability testing tool.  
To implement a real-time distributed SIP internet telephony manage system, we use the idea 
of Grid computing to collect the distributed SIP message. By coordinate the captured SIP 
message, we can helped to understand the SIP message flow and behavior by the distributed 
information captured by the SIP Analyzer. 
While this project is proceeding, we consider who will acceptant to the revolutionary 
communication technology. We focus on the breakdown of 3G customers, separate whom were 
the mostly users of the 3G service, then what kind new service should be consider to 
implemented. A marketing research for the Taiwan 3G customers was provided in this report.  
 
Keyword : SIP(Session initiation protocol)、3G、SIP Analyzer、
Marketing research  
 
 
 
 
 
 
 2
可以透過我們開發的操作介面使能完整的監測SIP訊息在各個SIP Server之間的流程，提供
正確的分析資訊。應用分散式監測及結合格網式分散式計算方式計算，未來可望整合政府
各機關或是電信企業內部計算機運算能力。這個部分，等於是進一步的實現SIP Analyzer
在分散式的電信架構下的監聽功能。 
此外，針對使用者對於新一代通訊技術的接納程度，也是我們有興趣的部分，由於目
前的應用技術開發部分強調使用者取向，對於那些人為目前新一代通訊技術大宗的使用
者，我們也感到興趣，並特別與輔仁大學資訊統計系的謝邦昌教授合作，做了調查與相關
方面的統計，並於 2006 年 ICIM 研討會發表「從台灣地區消費者的認知與接受程度探討 3G
手機設計功能面與電信市場區隔面」[3]。這些沿著主軸發展的研究成果，也將在下面報告
中揭露。 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
該封包，否則丟棄。 
如果區域網路中某台機器的網路介面處於雜收（promiscuous）模式，那麼它就可以不
影響網路環境下擷聽網路上所有的封包資訊，這就是封包監聽的工作原理。 
 
2.1.3  Linux 擷取網路封包方式 
 
在 Linux 作業系統中，為了從資料連結層(Data Link Layer)接收所有的封包[5]，我們要
使用 SOCKET_PACKET 類型的 socket，使用這種程式必須是 Superuser 的權限使用者才能
執行，而 socket 的第三個參數則是指定要接收的封包格式，例如接收資料連結層所有的封
包的程式碼如下圖 2 所示。 
 
fd  =  socket (A F_IN ET ,  SO C K _PA C K ET , h tons(ET H _P_A LL ));
 
圖 2 設定接收資料連接層所有封包程式碼 
 
這段程式碼會傳回資料連結層收到的所有協定的封包，當然也有其他參數可以指定想
要擷取的封包，例如 ETH_P_IP 為指定收取 IPv4 的封包，其他還有 ETH_P_ARP、
ETH_P_IPv6 等。除了設定 socket 函式接收的封包種類，也必須要設定網路卡在雜收
（promiscuous）模式，這可以藉由使用 SIOCGIFFLAGS 的 ioctl 來存取網路卡旗標如圖 3
所示，設定旗標參數為 IFF_PROMISC，然後利用 SIOCSIFFLAGS 儲存該旗標。 
 
strncpy(ethreq.ifr_name,"eth0",IFNAMSIZ);
struct ifreq ethreq;
ioctl(sock,SIOCGIFFLAGS,&ethreq)  //取得網路卡旗標
ethreq.ifr_flags|=IFF_PROMISC;    //設定為promiscuous模式
ioctl(sock,SIOCSIFFLAGS,&ethreq)  //儲存網路卡旗標
 
圖 3 設定網路卡為 promiscuous 模式程式碼 
 
在 Linux kernel 2.4 以後的版本，加入了 BSD Packet Filter(BPF)封包過濾器功能，如圖
4 所示。當網路卡傳送封包之前或是接收之後，會呼叫 BPF。經由 BPF 過濾封包在傳送給
應用程式。使用 BPF 的好處在於它的過濾能力，每個開啟 BPF 裝置的應用程式可以設定自
已的過濾器，例如只接收 UDP 或 TCP 或是封包標頭中的欄位符合某個特定值。我們所設
計的分散式 SIP Analyzer 在擷取封包的部份是利用 BPF 封包過濾器，其優點就是對應用程
式負荷小，可以依使用者需要設定，過濾出想要擷取的封包。 
 4
 6
去 6 年來的發展與實例，可以說網格技術已成為資訊技術未來發展的重點之一。 
網格技術發展的同時，通訊技術也蓬勃的發展，無線傳輸技術如微波、GSM、GPRS、或
通訊衛星的傳輸技術不斷開發，不但結合資訊科技，更結合了各式各樣的儀器，把儀器所
偵測到的資料，大量、密集、快速的傳送到實驗室，讓科學家或資源管理者可以更迅速的
掌握資訊。結合儀器、通訊、與網際網路形成一個可以即時傳遞、分析原始資料的網路系
統，即稱之為 sensor network。這樣的系統打破傳統的資料蒐集方法論，已成為一個新的
研究方法論。 
 
2.2.2  Grid Architecture 
 
 目前各國研究人員對格網研究重點和內容的認識也不盡相同。有人把格網看成是未來
的網際網路技術，稱之為「下一代網際網路(NGI)」、「Internet 2」、「下一代 Web」等等；還
有另外一類的研究重點是智慧資訊處理，它關注的是如何消除資訊孤島和知識孤島，實現
資訊資源和知識資源的智慧共用，常見的名詞包括語義網（Semantic Web）、知識管理
（Knowledge Management）、知識本體（Ontology）、智慧主體（Agents）、資訊格網、知識
格網、一體化智慧資訊平臺等等。企業界的研究則大多集中儘量利用現有的 Internet/Web
技術，將網際網路上的資源整合成一台超級伺服器，有效地提供內容服務、計算服務、儲
存服務、交易服務等，內容分發（Contents Delivery）、服務分發（Service Delivery）、電子
服務（e-service）、即時企業計算（Real-Time Enterprise Computing，簡稱 RTEC）、分散式計
算、Peer-to-Peer Computing (P2P)、網際網路服務（Web Services）等名詞都屬於這一範疇。
這些名詞所代表的技術都有一個共同點，即將網際網路上的資源整合成一台超級伺服器，
有效地提供內容服務、計算服務、儲存服務、交易服務等。另一個共同點是這些技術會儘
量利用現有的 Internet/Web 技術，以便能快速推出產品。當然這些技術也各有小的區別，例
如 P2P 強調打破 Client/Server 或 Browser/Server 的主從模式，用對等模式（或無伺服器模式）
實現超級伺服器的功能；RTEC 則強調對企業級在線上交易等的即時支援。 
 由於網路的頻寬與品質的大幅提昇，加上光纖的普及，使得過去認為是不同類別的通
訊與計算應用，如電信，多媒體、資訊、工程模擬、甚至儀器與設施之觀測等得以整合，
進而使得分散之計算能量、資料庫、儀器與設施、以及專業人才等各項異類資源，也都可
以透過網路及中介軟體 (Middleware) 有效的進行整合與溝通，此項透過超寬頻網路非常
有效率的銜接各種異類資源的系統，即為國際間先進國家如美、歐、日等國積極推動之格
網 (Grid)，若此格網以共用方式提供服務，並以知識創新及務實應用為導向，即可構成一
知識格網。 
 而知識格網以資料格網的基本架構為主，其分為以下五種層次之服務系統 
 8
應用上，我們則加進了本節所提到的知識格網，希望將分散式的的 SIP 通訊協定信號整合
並分析其特性，提供有效、更即時的網際網路電話管理系統。 
 
2.3 使用者對於新一代網際網路應用的接受程度 
 
2.3.1 前言 
 
在我們不斷開發、研究新一代的服務同時，我們不禁自問：「究竟這樣多功能、多樣化
的服務實用嗎?這樣的發展可以為人類帶來怎樣的貢獻?」。翻開近代歷史，發明一直跟著人
類需求的大方向走，發明家愛迪生就提出這樣的論調：「我並不想浪費太多時間在有趣的物
理現象但不能為人類帶來實質效益的」。因此，在研究的同時，我們也思考到究竟太多的科
技發展是否必要，我們所投入的成本和帶給人們的利益是否成正比。因此，我們特地與輔
仁大學的謝邦昌老師以目前在台灣地區，究竟大多數使用、接受新一代通訊技術的是哪些
使用者，對於瞭解使用者的分佈，例如年輕族群、抑或銀髮族，工業界服務人士接受度高
或是商業人士等等。由於通訊服務具有使用者取向的特性，因此瞭解新一代通訊服務的使
用者分佈有助於我們開發新應用時候的考量。 
台灣從過去到現在，已經發展出具有競爭力的網通硬體產業，但是仍舊缺乏在電信產
業方面的關鍵技術。從韓國的發展經驗來看，設備廠商與電信營運商的結合十分重要，三
星（Samsung）有半導體和電信系統的能力，加上韓國電信（KT）的營運商需求，由韓國
電信告訴三星要發展哪些應用，三星來開發這些技術。見賢思齊，台灣現階段需要電信營
運商與設備廠商的結合，彼此互補來發展出台灣在電信產業的實力。真正了解技術與發展，
用消費者行為去建構真正的手機功能面，台灣手機產業才能真正找到自己的切入點，這樣
才有可能發展出自己的產業。從發展性來看，台灣若能掌握關鍵技術，並且針對不同的市
場給予最棒的行銷方案，未來的發展前景非常看好。台灣在 2002 年開放拍賣五張第三代
行動通信頻譜執照，分別由遠致電信、威寶電信、台灣大哥大、中華電信以及亞太行動寬
頻得標，總標金達四百八十九億，象徵台灣電信市場慢慢跨入 3G 通訊時代。去年年底，
最後一家開台的威寶電信拉開了 3G 戰場的序幕，而西元 2005 年也被稱為台灣 3G 元年。
本文從電話訪查分析和極為嚴謹的統計演算法來探討國內手機 3G 市場之未來趨勢，了解
台灣手機消費者對 3G 手機的需求性，以及對 3G 手機有何訴求，進一步對消費者做市場
區隔並從科技管理的方向來做探討。期望從學術界的理論和調查中，提供產業界一些電信
管理和技術設計上的思維。 
 
2.3.2 市場區隔 
 
市場區隔（market segmentation）是指運用適當的市場區隔變數，將原來的整體市場區
分成多個具有相同屬性的不同群體，業者再根據自己產品或服務的定位，找尋目標市場。
市場區隔的目的在於使消費者在所屬的群體內差異最小，群體間差異最大，以確認出行為
相似的市場區隔，發展出符合該群體消費者所偏好的產品或服務，並設計有效的行銷策略，
以創造更多的利潤。一般市場區隔之基礎變數可分為地理、人口、心理和行為等四類變數：
1 人口統計區隔（Demographic Segmentation），根據各種人口統計變數來區隔市場。銷售者
第三章  研究方法 
3.1  SIP Analyzer 實作過程 
3.1.1  SIP Analyzer 架構 
 
圖 7 是本系統的架構圖，為了擷取完整的 SIP 封包，我們在每個 SIP 訊息會經過的網
路放置了 SIP 封包擷取程式 Capture Agent (簡稱 Agent)，並且使用一台電腦當做 Analyzer 
Server 收集分析各個 Agent 所擷取到的 SIP 訊息。 
 
 
 
SIP UA
SIP Proxy
SIP Proxy
Analyzer Server
使用者
經由瀏覽器查詢資料
HUB
SWITCH
Agent
SWITCH SIP UA
Agent
Agent
網際網路
收集的資料
 
圖 7：分散式 SIP Analyzer 系統架構圖 
 
由於使用分散式 SIP 封包擷取程式來收集 SIP 訊息， SIP 封包被多個 Capture Agent 收
集後傳送到 Analyzer Server，Analyzer Server 在分析 SIP 封包時必須要處理每個 SIP 封包對
時及重覆封包問題。只有正確的排序好 SIP 封包順序，才能完整的知道 SIP 的流程(Call 
Flow)，也才能分析 SIP Session 的相關訊息及提供正確的資訊例如計算通話時間、Session
的分類(註冊或是通話)、SIP 流程除錯監視等。 
 
1.1.2 SIP 封包排序方法設計 
 
我們設計一套簡單又有彈性的系統，讓每個 Capture Agent 之間不需要互相傳遞訊息，
這樣在增加 Agent 數量時較有彈性，同時也使用簡單的演算法，從每個 Agent 傳回來的資
 10
F18F16F14 F17 F19F13F12F11F9F8F4F3F2F1Agent(a)
F15F14F11F10F8F7F6F5F4F3Agent(b)
F19F16F15F10F7F6F5Agent(c) &
* ***
*
*
* * * *
# #
# #& & & &
& & & & &
*  (a)<-->(b)
& (b)<-->(c)
#  (a)<-->(c)
0       1   …… N
 
圖 9: 依各個 Agent 排序好的 SIP 資料串列 
Merge sort 的排序內容為數值串列，將指標所指到的二個數值做比較，較小的就放入
sorted 串列中，如果是多個數值串列，就要進行多次合併，先將二個串列合併在一起，在將
已合拼的串列和第三個串列合拼，重複此步驟。 
在 SIP 串列當中因為不是數值串列，是資料串列，所以我們不用比較數值大小的方法
排序，我們修改了一下 Merge Sort 的比較方法，利用記號封包處理排序問題。假設 Agent(A)
的串列為(list[i]，….，list[m])而 Agent(B)的串列為(list[m+1]，…，list[n])。合併成一個排序
好的串列(sorted[i]，…，sorted[n])。程式虛擬碼(Pseudo Code)如圖 10 所示。同樣如果是多
個串列，也要經過多次排序，依圖 9 的 SIP 串列經過計算後，最後會得到 sorted 串列如圖
11，在將重覆的封包去除就可以得到正確的 SIP 順序串列。 
 
i n t j , k , t ;
j  =  m + 1 ;     / *  i n d e x  f o r  t h e  s e c o n d s u b l i s t * /
k  =  i ;         / *  i n d e x  f o r  t h e  s o r t e d  l i s t  * /   
w h i l e  ( i < = m  & &  j < = n )  
{
i f  ( l i s t [ i ] .p a c k e t  = =  * )
{
i f  ( l i s t [ j ] . p a c k e t  = =  *   & &  l i s t [ j ] . d a t a  = =  l i s t [ i ] . d a t a )
{
s o r t e d [ k + + ] = l i s t [ i + + ] ;
s o r t e d [ k + + ] = l i s t [ j + + ] ;  
} e l s e
s o r t e d [ k + + ] = l i s t [ j + + ] ;
}
e l s e
s o r t e d [ k + + ] = l i s t [ i + + ] ;
}
i f ( i > m )
/ *  s o r t e d [ k ] , . . . . ,  s o r t e d [ n ] =  l i s t [ j ] , . . . . . . , l i s t [ n ]  * /
f o r  ( t = j ;  t < = n ; t + + )
s o r t e d [ k + t - j ] = l i s t [ t ] ;
e l s e   
/ *  s o r t e d [ k ] , . . . . ,  s o r t e d [ n ] =  l i s t [ j ] , . . . . . . , l i s t [ n ]  * /
f o r  ( t = i ; t < = m ; t + + )
s o r t e d [ k + t - i ] = l i s t [ t ] ;
 
圖 10：修改過的合併排序虛擬碼 
 
 12
用 tcpdump 語法範例如圖 13。經由 BPF 過濾器擷取得到的封包還不能確定是我們所想要的
SIP 封包，因此 Agent 程式必須加以判斷，再 SIP 訊息的第一行除了請求的方法(Request 
Method)或是回應(Request)，還會包含 SIP 版本的字串，所以程式判斷的方法是檢查
TCP/UDP 的資料(payload)第一行是否有 SIP/2.0 字串。如果有此字串則為 SIP 訊息，就將擷
取到的相關資料傳送到 Analyzer Server。 
 
tcpdump -dd udp and port 5060
(只擷取UDP封包，並且Port為5060的封包)
tcpdump –dd tcp –s 1600
(擷取所有封包，並且設定緩衝器大小寫 1600 bytes )
 
圖 13： tcpdump 查詢 BPF 參數範例 
 
 
目前實作上為了簡化設計及不考慮資料庫的負載狀況下，Agent 將資料傳回 Analyzer 
Server 是直接使用 MySQL Client API 將資料存入 MySQL 資料庫中。由 Agent 傳送回 Server
端的資料如表格 1 所示。 
 
表 1：Agent 傳送資料至 Server 一覽表 
 14
 
圖 14：封包顯示列表畫面&封包內容顯示畫面 
 
 
 
1.1.6 SIP Session內容顯示與繪製流程圖實作 
 
除了單純的封包顯示外，因為 SIP 主要是建立通話的通訊協定，因此建立一個會議
(Session)必須傳遞一些控制信令，控制信令繞送會經過一些 SIP Server，所以將這些信令交
換的訊息顯示並繪製出來，有助於使用者瞭解 SIP 運作的情形。圖 15 為繪製 SIP Call Flow
畫面 
 
 16
 
圖 17：Java 動態看版畫面 
 
 
圖 18：Java 動態看版畫面 
 
1.2 以分散式 SIP Analyzer 實作網路電話管理系統 
3.2.1 Sensor Grid and Knowledge Grid 
 
在網際網路的基礎上，1985 年資訊界提出格網運算（Grid computing）概念，突破了
網際網路的功能限制，以強調結合所有電腦成為虛擬的超級電腦，應用格網(Grid)技術讓資
源管理上的困難，如跨地蒐集資料、使用儀器、分析資料變的更為容易。而本篇論文在收
集分佈於 SIP 傳送路徑上的 SIP 封包，也正符合了跨地蒐集資料的需求，故此應用了感測
器格網(Sensor Grid)的想法，將負責收集封包的 Capture Agent 佈置於 SIP 封包必經的網路
節點。而利用知識格網(Knowledge Grid)的架構處理分散於網際網路所蒐集的資料。 
1) Sensor Grid  
 18
 20
以前的網路環境大部份是使用 HUB。HUB 是單純的一個 repeater，當它從一個網路線的連
接埠(Port)接收信號進來之後，會將這個信號原原本本的送到所有其它連接埠(Port)上，不管
哪些 Port 是接到哪一台機器。因此使用 Sniffer 就可以擷聽到位於相同 LAN 上機器的所有
封包，但是隨著網路設備的進步，目前大部份的網路環境架設已改為 Switch 架構，Switch
自已有一份 MAC Table 會記錄每個連接埠的 MAC 位址，當信號從一個 port 進來之後，會
檢查這個封包的目的 MAC 位址，然後依 table 內容找到這個 MAC 位址對應的 port ，而
僅將信號往這個 port 送，其它的 port 就不送了。因此除了廣播封包外，其餘不相關的封
包不會傳送到每個連接埠。所以當一台電腦使用監聽程式抓取封包時，只能截取到自己電
腦本身以及目前和這台電腦建立連線的封包資料，無法監聽網路上其他電腦的資料。 由於
SIP 的信令交換過程會經過許多 SIP Proxy、redirect Server 做路徑的選擇與繞送，而且這些
Server 可能位於不同的區域網路上，更增加了監測 SIP 訊息的困難度。 
 
3.2.3 分散式 SIP封包擷取的實作及 SENSOR GRID 和 KNOWLEDGE GRID架構整合  
 
經由上一節對於 SIP 協定特性的簡介，不難理解從巨觀的角度來分析 SIP 協定訊息的
困難處。為了解決這個問題，只有使用分散式的分析器，加上分散式的封包擷取程式，在
每個網路節點擷取到封包後，傳送到特定的分析 Server 做資料彙整及分析，且這些資料也
可以作為 Knowledge Grid 做 Data Mining 的資料母體，倘若有強大運算能力作為背景，甚
至大量的資料湧進也可以提供即時的分析和監測結果，利用格網式計算(Grid computing)的
特性正好可以解決這項問題。 
 而在此，問題又可分為兩大點，分別為「分散式的 SIP 封包擷取」與「SIP 封包擷取
架構」，關於分散式的 SIP 封包擷取方式已於前一節討論，在此便不再贅述。以下將討論，
這樣的擷取架構該如何實現。 
 由於我們希望可以擷取到完整的SIP封包流程，故只是在單一的點上擷取，並無法觀察
完整的SIP封包傳送流程。故我們設計了如圖20的SIP分散式封包擷取架構。如圖20所示，
我們在每個SIP封包會經過的SIP Server安裝了Capture Agent，並將收集到的封包資料送到
Data Base，同時控管中心可以控制特定的Capture Agent開始或停止擷取封包。圖中Capture 
Agent的功能主要負責擷取網路上的所有封包，並判斷是否為SIP封包，如果是則暫存於
Sensor Grid的資料庫中(見圖21)。此外，Sensor Grid 和Data mining Layer也均會回傳index
到控管中心。以供控管中心對特定SIP信令監測，控管中心將欲觀察的SIP資訊送到Service 
configuration，再經由index檢視該SIP封包是由哪一Capture Agent監視，需要index單元主要
是因為使用者有時僅需對某些行為異常用戶發出SIP信令監測，而非整體網際網路環境，此
時藉由控管中心比對該SIP flow與index，便可由大量資料中抽取出該特定SIP信令資料。  
 
在我們的實作中，每個單位都是獨立設計，且多層式的架構可方便未來彈性增加功能。
例如感測器(Capture Agent)目前支援IPV4/TCP/UDP，未來會增加SCTP及IPV6，同時還可以
加上遠端監聽RTP的功能。而顯示資料供使用者操作的Graphical User Interface可以依需要
設計，如使用Web-based的html顯示或是Windows/Linux視窗平台。目前在實作中是採用
Web-Based的方式來操作控管中心及接收由感測器格網回傳的Capture Agent index和知識格
網回傳的Data mining index。 
 
3.3 3G 市場調查方法與報告 
 
3.3.1 3G 市場調查方法 
 
本研究是針對台灣地區3G 行動通訊市場調查為主，並對其做市場區隔。由人口統計變
數、現階段GSM 手機的使用狀況、對3G 手機的認知與需求等這幾個方面著手，提出本研
究之架構圖，如圖22： 
 
 
圖 22:研究架構圖 
 
本研究之研究對象以台灣地區十八歲以上之一般民眾為研究對象(依行政院主計處公
佈之民國九十三年全國人口概況為標準)，針對其現階段使用手機的狀況及對於3G 手機的
接受程度、功能要求為研究內容，做3G 手機的市場區隔分析。根據前面的研究架構圖所示，
為了使研究中所使用的重要變數能定義明確，以下將其個別分類並詳細說明： 
 
台灣地區定義：本研究所指台灣地區包括臺灣本島、澎湖群島，其中居住地分為北中
南東四個區域(統計區域依據行政院主計處八十二年七月頒訂「中華民國統計地區標準分
類」報告分類。 
 
3G 手機定義：本研究所指3G 手機為第三代行動通訊系統及其所配合使用之手機，以台灣
地區目前五家3G 系統業者所推出之通訊系統為例。 
 22
表3：居住地區在母體結構與實際回收之檢定 
 
 
表4：居住地區之母體樣本結構檢定 
 
 
3.3.2 統計演算法 
 
1. Chi-Square Test：用以檢定類別資料兩者之間有無差異性。本研究使用Chi-Square Test 
探查個人基本資料部份在現階段手機使用狀況、3G 認知與購買行為等方面的差異性。 
 
 
2. Scheffe Test：Scheffe 多重比較法是用來了解每個樣本群體之間的相互關係。本研究為
輔助One-Way ANOVA，使用多重比較進行事後的檢定來觀察在使用不同的實驗變數水準
下，是否會導致不同的結果，若為顯著則繼續以Scheffe 多重比較法進行檢定，以找出顯著
影響的來源。Scheffe 檢定的臨界值是單因子變異數分析組間變異的自由度。我們在此簡化
為: CV = (k-1) F(k-1,N-k,alpha) 
此檢定統計量在計算上有些許的難度。由於它沒有F 分配，純數學者主張此不能被稱
作F，但我們仍會留存此檢定。當F 值>CV 時，拒絕Ho。（此為右尾檢定。當平均值無任何
差異，分子將趨近於0，且為左尾檢定也無法顯示任何結果。） 
 
3.  Kruskal-Wallis：在單因子變異數分析不適用的情狀下，即變異數不相等，本研究以
Kruskal-wallis 檢定瞭解三個或三個以上之母體平均數是否具有差異存在，並再使用獨立樣
本T 檢定，檢定各類別間之差異程度。令  為每k 群資料中的樣本大小，接著將整組樣
本分類。計算i 群的秩和，則 Kruskal-Wallis 檢定為: 
ni
 24
一點，對每個變數都可以算出它到各群體的距離，然後將此群體區分到最接近之群體，再
與集群分析法的結果對照，可得知集群分析的正確率。 
假設我們有兩個母體，設 為 個觀察值來自第一個母體， 而
為 觀察值來自第兩個母體。注意 和 為
Px1的向量。Fisher's 的區別分析方法為投影這些p 維向量經由一個迴歸函數 到
實際值，試著去分割這兩個母體，在這裡 a 是一個Px1的向量，找到向量
xxx n121 ,, L n1
xxx nnnn 212111 ,, +++ L n2 xxx n121 ,, L xxx nnnn 212111 ,, +++ L
ktxl a
t=)(
a 使的分離函數
|S(a)| 為最大Fisher's 區別分析方法的概念： 
 
找到 a 使此距離盡可能為大 
直覺的，
S
YY
r
aS 21 )(
−= 在測量轉換的平均 YY 21− 相對於樣本標準差 。如果這轉換的
兩群資料觀察值 和 被完全分開，會導致|
S y
YYY n121 ,, L YYY nnnn 212111 ,, +++ L YY 21− |的值是
很大的，即使當這個轉換資料的隨機誤差 也被考慮。重要的結果如下： Sr
 
假設我們有一觀察值 X 0 ，然後根據我們得到的區別函數 Xaxl
2
)( = ，我們可以分配這個
觀察值到一個類別。 
本研究架構圖將問卷區分為四大部分，分別為「現階段手機使用狀況」、「3G 手機的
 26
 28
例如在搖晃的捷運車廂中能夠以低解析度的PDA 看電子書而絲毫不覺得眼花，也樂在其
中。與這群人保持高度的良好關係非常重要，因為這群人會左右其他後面消費者的採購決
定。也許經由口耳相傳，也許經由網站論壇、BBS，也許本身就是老師或是主管，常有分享
消費知識的機會等等。但是這群人也不笨，他們會為良好的產品背書，並維持極高的品牌
忠誠，也因此行銷的重心常常在產品本身的規格上面。佔了34% 的早期多數（Early 
Majority），就呈現出完全不一樣的性格基調。對於這種人，在行銷上請不要談太多的規
格，也請不要談專有名詞。這群人容易被簡單的訴求打動，或者明顯而多樣化的功能需求。
譬如大陸個人電腦的第一品牌聯想科技，在銷售電腦這種高科技產品時的訴求只有一個，
「別讓自己的寶貝孩子輸給別人」。後面佔了34% 的晚期多數（Later Majority），是更
後知後覺的人。他們往往發現社會上大部分的人都已經在使用某種高科技產品了，才開始
想要使用。「只要有就好」是這種人的心態，所以當家裡的長輩要我們幫他們買支行動電
話時，往往會交代「買最便宜的就好」。運用社會壓力的行銷訴求在這個時候會相當有效，
例如：「你還沒擁有一隻3G手機嗎？試試這隻，便宜又好用」之類的訴求。到了後期，科
技產品往往已經陷入成熟市場的價格戰當中，各種行銷訴求可能都已經比不上低價格訴求
來得有效。科技產品的發明者如果不趕快推動新一波的創新，也就是改良功能或者推出全
新產品，產品的生命週期就快到盡頭了。「價格一樣，功能卻最多的3G 手機」可能就是有
效的訴求了。科技行銷的精神在於，能針對每個階段的使用者以不同的行銷包裝與訴求，
定價，通路，客戶服務等等，將產品的普及率拉抬到最終讓主流大眾接受的程度。然後在
市場將近飽和之前，引動另一波創新。而這個科技行銷模式告訴我們，針對這16%的先知先
覺者的一切行銷方式，與針對後面主流大眾的行銷方式，完全不同。值得注意的是，在先
知先覺者與後知後覺者中間，有一個明顯的斷層（Gap）。這正是這個模式最生動有趣的地
方。這個斷層說明了新科技要從先知先覺者擴散到後知後覺者的過程中，存在著龐大的斷
層需要去克服。而這個斷層能否被克服，正是這個新科技最後能否被主流大眾接受的關鍵。
而歷史上充滿了太多科技產品，因為無法跨越這關鍵的16%門檻，最後只能淪為小眾的應用
無法成為主流，甚至消失在歷史的舞台上。本研究即是找出了一些重要的pattern，分別符
合這些早期採用的16%族群，以及部分早期多數的34%族群和部分的晚期多數34%族群。 
 
第四章 成果與討論 
4.1 SIP Analyzer 
4.1.1 SIP Analyzer 系統測試 
 
 測試環境如表格?設備，利用二台電腦做為 SIP Proxy，並且 DNS 註冊不同的 domain 
name，SIP UA 1 為 client 端，其 outbound proxy 為 SIP Proxy 2，SIP UA1 撥打電話給
SIP:apple@foolfish.idv.tw (SIP UA 2)，Proxy 1 會經由 DNS 查詢得知 foolfish.idv.tw 
的 SIP Proxy 為 140.123.20.90 的機器，將 SIP 訊息繞送到 SIP Proxy 2，最後會傳送到 SIP 
UA 2。整個網路環境是 Switch 架構(如圖?所示)，因此我們將 Agent 安裝在二台 Proxy 上
測驗。 
 
 
 圖 26:系統運作統計資料圖 
 
4.1.2  SIP Analyzer 結論與心得 
 
在本計畫中設計實作了一套分散式的 SIP Analyzer，不但可以解決使用單一 Analyzer
所擷取的封包資訊不足問題，而且提供完整的封包擷取以及 SIP 流程展示功能。我們利用
比較 SIP 事件發生的順序來解決分散式環境下擷取封包的排序問題。在開發的過程當中我
們選擇使用 Web 化的介面設定方式，使得分散式的 SIP Analyzer 無論在何處皆可以使用，
讓對 SIP 有興趣或者相關研究人員能更進一歩了解 SIP Session 的建立，並且具體地觀察實
際的 Call Flow。而且因為我們使用資料庫儲存封包訊息，因此有完整的歷史資料查詢。期
望這套 SIP Analyzer 對推動 SIP 的研究能有所貢獻。表 6 為本系統與其他分析器功能比較
表。 
 
 
 
 
 
 
 30
 32
的名片上會多上一欄個人網路電話號碼。然而，許多現象將因而產生，例如，網路電話盜
打、廣告電話等等，需多諸如此類活動將隨之增加，而目前也尚無一套可以真正監視、觀
察網路電信的解決方法，因此我們提出可以追蹤與監視的SIP信令觀察環境。 未來，完全
整合格網計算後，將可以從網際網路湧入的大筆資料中，更加即時且依使用者要求，淬取
使用者想觀察的特定網路電信行為，無論在防堵電信犯罪，或是電信業者維持網路電信品
質以及研究團體有意相關研究均可自由使用。 
 
4.3  3G市場調查分析報告 
 
本研究以台灣地區消費者為對象，在本研究所有的受訪者中，其職業以服務工作人員
及售貨員、技術員及助理人員為最多，約佔所有受訪者的35%；而血型的部份以O 型者為最
多，為40.8%；受訪者年齡以45~54 歲為最多，佔24.4%；在學歷方面以高中職為最多，佔
所有受訪者的37.6%；在每月可支配所得方面，有33.1%的受訪者為5000 元以下。在現階段
手機使用狀況的部份，有高達96.3%的受訪者都有使用手機，且以擁有一個門號為最多，為
88.9%；且每月通話費以1000 元以下為最多，約為52%；且其更換手機的頻率以一年到兩年
為最多數，有38.3%；更換手機的原因以看到有功能更好的手機為最多；對目前手機的滿意
度以普通及滿意為主，各佔34.7%、25.6%；而目前沒有手機的受訪者也有59.3%有意願申辦
手機；而所有受訪者申辦手機的動機以方便連絡為最主要理由，其次是工作需要。 
在3G 手機的認知與購買部份，目前有將近43.9%的受訪者知道3G 手機為何，而也有
34.5%的受訪者聽過3G 手機，顯示大部分的受訪者都已經知道有3G 手機這項產品；而他們
最主要獲得資訊的管道為電視，其次是網路；而目前有3G 手機及門號的受訪者只有5.6%，
表示使用率還不高；而有3G 手機及門號的受訪者以使用中華電信及台灣大哥大這兩家電信
業者的系統為最多，各為49.0%及30.2%；而受訪者願意支付用來購買3G 手機的價格最主要
為5001~10000 元，佔37.9%；而每月願意支付在3G 手機月租費的價格以1001~1500 元為
主，約佔40%；在是否會購買符合需求的3G 手機部分，有近五成的受訪者都表示會購買，
而不知道(還在考慮)的受訪者也有18.8%；購買時間在一年以上為多數，佔64.8%；而會影
響購買3G 手機意願的因素比例差距不大，最主要為手機價格及手機功能，各是52.2%與
48.7%。由於受訪者大多採用3G 手機的時間都為一年以上，可能是由於3G 手機目前在市場
的知名度還不夠，一般民眾還是沒有非常了解其與現在市場2G、2.5G 手機的不同，造成民
眾雖然願意購買的比例有五成，但都還是想再觀望一段時間，大多不會有立即購買的欲望，
而在手機價格上傾向購買中高價位的手機，月租費接受程度也偏高，顯示受訪者對於3G 手
機在認知上是屬於高消費的產品，這也多少可以解釋雖然接受度高，但卻不會立刻購買的
情況。在關於3G 手機道德的部份，有59.7%的受訪者認為3G 手機影像電話及定位功能會影
響個人隱私；而也有70.8%的受訪者會擔心3G 手機提供的網路服務及線上交易功能會造成
個人資料的外洩。 
本研究將基本資料與現階段手機使用狀況和3G 手機的認知與購買行為三部份交叉比
較後發現，會影響購買意願的因素有「知不知道3G 手機為何?」、「目前擁有幾隻手機?」，
知道3G 手機的受訪者相對於不知道3G手機的受訪者會購買3G手機的比例較高，而擁有一~
兩支手機的受訪者會購買3G 手機的意願較有三支以上手機的受訪者比例為高。受訪者職業
為農林漁牧業在三個月內更換一次手機的比例較高；且更換手機的頻率也和有沒有3G 手機
有顯著的相關，資料顯示有3G 手機及門號者，在三個月內更換一次手機的比例較高；而學
 
圖 27：功能需求比較圖 
 
在功能需求變數的部份，本研究將其與現階段手機使用狀況、3G 手機的認知及購買、
基本資料比較之後發現，有手機的受訪者對於手機電視有較高的需求；而每「三個月內」
及「一年到兩年」更換一次手機的受訪者較「三個月到半年」的受訪者對電話會議功能的
需求高；「兩年以上」更換一次手機的受訪者較「半年到一年」更換一次手機受訪者對定
位功能的需求高；「知道」3G 手機的受訪者較「不知道」3G 手機的受訪者對電話會議的
需求高；不知道血型的受訪者較其他血型受訪者對於電話會議功能的需求為低；「25~34 歲」
的受訪者較「35~54 歲」、「18~24 歲」的受訪者對新聞類資訊的需求高；在企業網路功
能需求的部份，「18~24 歲」的受訪者較「35~44 歲」、「55~64 歲」受訪者對於企業網
路功能需求高，女性受訪者對於企業網路功能需求相對於男性為較高；相反的南部地區的
受訪者相對於其他地區與55~64 歲相對於其他年齡層的受訪者對於企業網路功能需求都相
對較低。 
 
表 9：交叉比較表三 
 
 34
類資訊、電子商務，較不需要網路遊戲這項功能。但整體而言，此群對於各項需求的程度
都較其他群高。此群在人口統計變數上，職業以事務工作人員及家管相對其他職業所佔比
例高，年齡在18~34 歲、居住地為東部、學歷為大專、每月可支配所得為50000 元以上、
性別為女性、血型為B 型者相對其他層面比例為多。 
集群二為網路資訊科技群，此群的特性是對於網頁瀏覽功能有高度需求，其次為音樂
下載與播放；較不需要企業網路這項功能。此集群在人口統計變數上，職業以農林漁牧、
勞工技工、學生比例為高，年齡在45~64 歲、居住地為南部、學歷為碩士以上或國中、每
月可支配所得為30001~50000元、性別為男性、血型為AB 型者相對於其它比例為高。 
集群三為一般顧客群，此群相對於其他兩群是使用各項功能服務較少的一群，但在定
位功能需求上卻較其他兩群有較高的需求量，其最不需要的功能需求為網路瀏覽的功能。
此集群在人口統計變數上，職業以退休者比例為高，年齡為35~44 歲、居住地為南部、學
歷為國中、每月可支配所得為5000元以下、性別為男性、血型為不知道者相對於其他選項
比例為高。表11 為三種集群的需求表。 
 
表 11：三種集群需求表 
 
 
3G 手機的出現，使得全球的通訊業者面臨全新的挑戰，目前在台灣地區已經有五家行
動通訊業者表現出積極的企圖心，想在3G 這塊大餅中取得先機，不過正式的營運，卻不一
定保證能像3G 手機一樣前景看好，所以在投入大量成本之前，應該先仔細的評估整體發
展、擬訂策略，才能達成目標。 
從本研究對於3G 手機的認知及購買部份之分析發現，目前台灣地區約有七成五的民眾
聽過3G手機，且也有五成民眾表示會購買，但是購買的時間卻會延遲至一年後，建議業者
可以在這段期間利用電視及網路這兩種主要媒體大量曝光，增加消費者的印象，打開知名
度，並與大牌手機廠商合作，發展實用且具品質保證的3G 手機，提升民眾的認同度，以便
在下一波3G 熱潮中佔得領先地位。 
如同前文所言，3G 手機較GSM 系統有更多樣化的功能，除了一般的通話服務，更增加
了許多生活化、娛樂化、多元化的服務功能，綜合國內外各系統業者推出的服務，整個3G 服
 36
 38
計畫成果自評 
在本年度的計畫中共有三項主要的工作成果： 
1. 分散式的SIP協定分析系統 
2. 提出一個應用分散式的SIP協定分析系統而成的SIP-based網路電話管理架構 
3. 針對目前台灣3G環境的使用者與使用情況做出市場調查與分析 
 
在第一項「分散式的SIP協定分析系統」，也就是我們所提出的計畫主題，已經依照計
畫書中內容完成，並採用open source環境開發本系統，希望可以提供需要相關研究的機關
團體一個免費的研究工具。目前該程式已公開於sourceFORGE網路平台[18]，所以這個本計
畫的主軸的完成度是100%，更期待開放源碼後可以與更多同好討論與改進。 
而利用「分散式的SIP協定分析系統」所提出的SIP-based網際網路電話管理架構，目
前由於尚未看見類似的主題與研究，故為一嶄新的領域，這也是本計畫衍生出的額外成果。
我們也相信未來使用者的通訊服務將會著重在成本更低廉、語音品質有保障的網路電話，
因此，有一套妥善的網際網路電話管理系統勢必不可或缺。為了提供有效的管理系統，同
時也為了防範一些不法的網際網路電話行為，如電話盜打、垃圾電話等情況發生，提出一
個網際網路電話乃是必然的措施。由本計畫我們衍生出一個更大、更前瞻的網路電話管理
架構。 
最後，我們特地與輔仁大學謝邦昌教授合作，完成一份「從台灣地區消費者的認知與
接受程度探討3G手機設計功能面與電信市場區隔面」的市場調查報告。我們希望優先瞭解
願意以及已經正在使用嶄新通訊技術的族群分佈，進一步討論未來更客戶化的網際網路電
話應用發展。正所謂知己知彼、百戰百勝，鎖定使用者、針對使用者需求開發應用程式才
能真正免除紙上談兵的疑慮，我們希望可以據此提供更美好的網路服務願景，此份報告也
已經將問卷回應整理過後，將詳細分析結果呈現於該市場調查結果中。 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 整合感測器格網及知識格網之應用 – SIP行為
分析 
胡維峰            陳怡碩            潘仁義  
國立中正大學通訊工程研究 國立中正大學通訊工程研究
所
國立中正大學通訊工程研究
所所
摘要  
 
 
目前，多媒體應用(Multimedia Application)是網際網路
最重要的應用之一。其中，大部分多媒體傳輸應用的SIP
協定(Session Initiation Protocol)尚無免費監測分析軟體，
且SIP協定的交換路徑會經過不同區域網路繞送，如果只
使用單獨的網路分析儀將無法監測到完整的SIP訊息。本
篇論文提出一整合架構, 採用了感測器格網(Sensor Grid)
實作分散式SIP訊息收集，並利用知識格網(Knowledge 
Grid)架構處理SIP封包資訊。 
 
關鍵字 — SIP(Session Initiation Protocol)，感測器格網
(Sensor Grid)，知識格網(Knowledge Grid) 
 
I. 前言 
 
由於網際網路的普及化、多媒體技術的進步，使得網
路電話的應用蓬勃發展，網路語音(VoIP)[1]讓網際網路由
單純的資料訊息交換，提昇到即時語音傳遞。使用網際網
路語音技術來代替傳統的電話網路，可以有效節省費用、
並且擁有許多額外功能例如傳遞影像、即時文字訊息等。 
目前網際網路傳送語音的通訊協定有國際電信標準部
門 International Telecommunication Union– 
Telecommunication Standardization Sector(ITU-T)所制定的
H.323以及由Internet Engineering Task Force (IETF)所制定
的SIP協定，。而SIP協定因為較為簡單，是針對網際網路
所設計，因此被Third Generation Partnership Program(3GPP)
所採用，成為未來3G網路中通話協定的標準。 
從網際網路發展開始，就有許多的網路監測工具
(Sniffer/Analyzer)被網路設備研發人員所採用，使用網路監
測工具是為了瞭解所設計的產品及網路協定的規格是否相
容於業界標準而普遍採用的技術。Analyzer不但能收集網
路傳輸的資料，更可以用來做企業或校園網路相關問題的
診斷及分析。 
目前想要瞭解、分析網路上封包的方式大致上可分為
硬體的協定分析儀(Protocol Analyzer)與軟體的封包截錄程
式。硬體的分析儀價格上較為昂貴，一般只有固網通訊業
者與大型研發單位才有能力購買。例如RadCOM[2]與
Tektronix[3];大部分的網路開發者比較常使用的是封包截
錄程式如Sniffer Pro[4]、Netxray[5] 與Ethereal[6]，但這些
都不是針對SIP通訊協定所設計的網路分析器。 
由於SIP的信令交換過程會經過許多SIP Server，而且
這些SIP Server可能都位於不同的區域網路上，例如3GPP
的 Internet Multimedia Subsystem(IMS)環境下，SIP User 
Agent(UA)因為漫遊，在傳送SIP信令時會經過不同系統服
務商的Call State Control Function(CSCP) ，如果要追蹤監
測這些SIP訊息，使用單機式的VoIP Analyzer軟體只能擷
取到片斷的資訊，例如只能擷取SIP UA到Outbound Proxy
的訊息，而SIP Proxy之後的SIP流程就無法擷取得到。對
於需要除錯和監測的工程人員可能就必須要在每個需要檢
測的地方各別的檢查，因此會較沒有效率。 
本篇論文除了利用感測器格網(Sensor Grid)在網路上
分佈專責收集SIP信令封包的Capture Agent，以實作SIP專
屬協定的分析軟體環境外，更利用知識格網(Knowledge 
Grid)的概念，以解決使用單一Analyzer所擷取的封包資訊
不足問題，讓使用者可以透過我們開發的操作介面使能完
整的監測SIP訊息在各個SIP Server之間的流程，提供正確
的分析資訊。應用分散式監測及結合格網式分散式計算方
式計算，未來可望整合政府各機關或是電信企業內部計算
機運算能力，進一步對收集來的大量資料做特定目的或即
時的分析(在本篇論文所指的大量資料指的是各個Capture 
Agent所蒐集的SIP信令Log檔案)。 
本篇論文的結構如下，第一節前言介紹本篇論文大綱
及方向，第二節介紹本篇論文的主要對象SIP和整體架構: 
Sensor Grid及Knowledge，第三節為整合Sensor Grid和
Knowledge的架構與實作介紹，最後是總結及未來工作。 
II. SIP協定規格與GRID簡介 
 
A. SIP通訊協定 
 
SIP是由IETF所制定，用來建立、修改、終止網際網
路電話或會議(Session)的一種信令傳輸協定。目前SIP協定
已經漸漸被發展IP電話的廠商所採用，並且有許多學術團
體正在持續地做相關研究。其中一個最主要的發展是規範
3G網路的3GPP組織在2000年選擇了SIP當做IP行動網路的
連線控制協定(3GPP Release5)[7]。 
jypan@comm.ccu.edu.tw trouble@ant.comm.ccu.edu.tw yschen@net.nthu.edu.tw
 在正常情況下，網路上所有的機器都被可以聽到所有
通過該網路卡的封包訊息，但對於不屬於自己的封包則不
予回應。但是如果區域網路中某台機器的網路介面處於雜
收（promiscuous）模式，那麼它就可以不影響網路環境下
擷聽網路上所有的封包資訊，這就是封包監聽的工作原理。 
以前的網路環境大部份是使用HUB。HUB是單純的一
個 repeater，當它從一個網路線的連接埠(Port)接收信號進
來之後，會將這個信號原原本本的送到所有其它連接埠
(Port)上，不管哪些 Port 是接到哪一台機器。因此使用
Sniffer就可以擷聽到位於相同LAN上機器的所有封包，但
是隨著網路設備的進步，目前大部份的網路環境架設已改
為Switch架構，Switch自已有一份MAC Table會記錄每個連
接埠的MAC位址，當信號從一個 port 進來之後，會檢查這
個封包的目的MAC位址，然後依table內容找到這個 MAC 
位址對應的 port ，而僅將信號往這個 port 送，其它的 port
就不送了。因此除了廣播封包外，其餘不相關的封包不會
傳送到每個連接埠。所以當一台電腦使用監聽程式抓取封
包時，只能截取到自己電腦本身以及目前和這台電腦建立
連線的封包資料，無法監聽網路上其他電腦的資料。 
由於SIP的信令交換過程會經過許多SIP Proxy、
redirect Server做路徑的選擇與繞送，而且這些Server可能位
於不同的區域網路上，更增加了監測SIP訊息的困難度。 
III. 分散式SIP封包擷取的實作及SENSOR GRID
和KNOWLEDGE GRID架構整合 
 
經由上一節對於SIP協定特性的簡介，不難理解從巨觀
的角度來分析SIP協定訊息的困難處。為了解決這個問題，
只有使用分散式的分析器，加上分散式的封包擷取程式，
在每個網路節點擷取到封包後，傳送到特定的分析Server
做資料彙整及分析，且這些資料也可以作為Knowledge 
Grid做Data Mining的資料母體，倘若有強大運算能力作為
背景，甚至大量的資料湧進也可以提供即時的分析和監測
結果，利用格網式計算(Grid computing)的特性正好可以解
決這項問題。 
A.  分散式的SIP封包擷取架構 
 
由於我們希望可以擷取到完整的SIP封包流程，故只是
在單一的點上擷取，並無法觀察完整的SIP封包傳送流程。
故我們設計了如圖2的SIP分散式封包擷取架構。如圖2所
示，我們在每個SIP封包會經過的SIP Server安裝了Capture 
Agent，並將收集到的封包資料送到Data Base，同時控管中
心可以控制特定的Capture Agent開始或停止擷取封包。 
右圖 2便是SIP的架構及我們佈置感測器 (Capture 
Agent)的示意圖。圖中Capture Agent的功能主要負責擷取
網路上的所有封包，並判斷是否為SIP封包，如果是則暫存
於Sensor Grid的資料庫中(見圖3)。此外，Sensor Grid 和Data 
mining Layer也會均會回傳index到控管中心。以供控管中心
對特定SIP信令監測，控管中心將欲觀察的SIP資訊送到
Service configuration，再經由index檢視該SIP封包是由哪一
Capture Agent監視，需要index單元主要是因為使用者有時
僅需對某些行為異常用戶發出SIP信令監測，而非整體網際
網路環境，此時藉由控管中心比對該SIP flow與index，便
可由大量資料中抽取出該特定SIP信令資料。 
 
 
 
 
 
 
 
 
 
 
 
 
圖 2 : SIP封包傳送示意圖及Capture Agent佈置位置 
 
 判斷是否為SIP封包的依據是檢查TCP/UDP的資料框
(Payload)第一行資料是否有SIP/2.0字串，如果有則為SIP訊
息。目前網路環境大部分是Switch的架構，Capture Agent
可以安裝在SIP Proxy或是SIP UA節點，也可以在同個
Subnet環境下，串接Hub以方便擷取封包。 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
圖 3：整合感測器格網(Sensor Grid)及知識格網(Knowledge 
Grid)架構圖，其中資料探勘層(Data Mining Layer)及Sensor 
Grid均會回傳index到控管中心，供控管中心，查詢特定SIP 
封包flow。 
 
在我們的實作中，每個單位都是獨立設計，且多層式
的架構可方便未來彈性增加功能。例如感測器(Capture 
Agent)目前支援 IPV4/TCP/UDP，未來會增加 SCTP及
IPV6，同時還可以加上遠端監聽RTP的功能。而顯示資料
Proxy Server Proxy Server 
Proxy Server 
User Agent 
Client (Caller) 
SIP Response 
SIP Request 
Location 
Server 
HUB 
CaptureAgent 
CaptureAgen
CaptureAgen
Agent 
CaptureAgen
CaptureAgen
Redirect Server 
User Agent 
Client (Callee) 
控管中心 
Graphical User Interface 
Data mining services Get data and integration 
資料探勘層 
Knowledge IndexService configuration 
Sensor Grid 
Data Base 
Sensor Sensor Sensor
 間順序是正確的，而多個Agent之間我們只能判斷每個SIP
封包之間的相對時間來決定SIP封包的順序了。 
 
 
圖 6：Capture Agent擷取封包順序圖 
 
例如Agent(a)收到編號F4封包，下一個是F8封包，而
Agent(b)收到F4封包後依序是F5,F6,F7，接著收到F8封
包，所以可以判斷F5,F6,F7封包是介於F4和F8之間。綠色
的方塊表示這個SIP封包有連至其他Capture Agent上，屬於
重覆性質的封包。圖下是程式設計時的演算法，當遇到重
覆的封包時(綠色)，依Capture Agent ID(Capture Agent IP 
address)至Data Base檢查另一個Capture Agent上所蒐集相
同Call-ID的封包，依序檢查就可以得到SIP事件流程了(如
圖7)。 
 
圖7: 利用Agent之間資料對比得到正確的SIP事件順序 
 
Capture Agent在擷取封包後，會在每個SIP封包加上
該Capture Agent的編號，並存入資料庫，Capture Agent的
編號為該Agent的IP Address。程式在設計的時候先分析SIP
封包，將相同CALL-ID分類為同一個SIP Session，然後比
對每個封包的Source IP和Destination IP和所有此Session所
記錄到的Capture Agent編號，可以查詢哪些封包會被重複
的Capture Agent擷取到，這就是前面所介紹的綠色重複封
包。 
如果有SIP封包重送或是遺失，導致在多個Capture 
Agent在收集資料後，Data Mining Layer無法判斷每個Agent
之間的SIP事件相依性，則系統會依現有資料畫出Call Flow
圖，但是會提醒使用者這個SIP Session發生封包遺失，重
送事件，因此繪製出的流程圖不一定正整，但是可以針對
單獨Agent所收集的資料繪出各別流程圖比對。單獨Agent
所繪製的流程圖仍然是正確的。 
IV. 實作應用與未來工作 
 
我們所設計的所有程式皆是在Linux作業系統下開
發，並且選用Open Source的套件為程式開發方案，未來希
望可以題供一個免費、開放的環境供使用者使用。開發環
境如下: 
作業系統：Red Hat 7.3 
資料庫：MySQL Server 3.23.55 
網頁程式：Apzche Server PHP 4.3 
程式語言：C，Java 1.14 
溝通協定：HTTP，XML，OLAP 
F14F13F12F11F9F8F4F3F2F1Agent(a)
F15F14F11F10F8F7F6F5F4F3Agent(B)
time
在設計Data Mining Layer分析SIP流程時，採用相對SIP事件
比較排列的方法來求出正確的SIP流程，為每個Agent之間
擷取到SIP的事件找出相似性，比較其發生的順序並排列出
計算後的結果。 
     在網際網路應用程式快速發展的今日，這些應用程式
也慢慢改變了使用者的使用習慣。在今日，許多人的名片
上會印上自己的E-MAIL ADDRESS﹔未來，我們可以預見
人們的名片上會多上一欄個人網路電話號碼。然而，許多
現象將因而產生，例如，網路電話盜打、廣告電話等等，
需多諸如此類活動將隨之增加，而目前也尚無一套可以真
正監視、觀察網路電信的解決方法，因此我們提出可以追
蹤與監視的SIP信令觀察環境。 
未來，完全整合格網計算後，將可以從網際網路湧入
的大筆資料中，更加即時且依使用者要求，淬取使用者想
觀察的特定網路電信行為，無論在防堵電信犯罪，或是電
信業者維持網路電信品質以及研究團體有意相關研究均可
自由使用。 
F14F13F12F11F9F8F4F3F2F1Agent(a)
F15F14F11F10F8F7F6F5F4F3Agent(B)
V. 參考文獻 
 
[1] J. Ronsenberg and et al, “SIP : Session Initiation Protocol.,” IETF 
RFC 3261, June 2002. 
[2] http://www.radcom.com. 
[3] http://www.tektronix.com 
[4] http:// www.asl-sniffer.co.uk 
[5] http://www.netxray.co.uk 
[6] http://www.ethereal.com 
[7] 3GPP TS 22.140 V5.1.0 (2002-03),” Stage 1 Multimedia 
Messaging Service (Release 5).” 
[8] M. Handley,V. Jacobson,ISI/LBNL. "SDP: Session Description 
Protocol". RFC 2327, Internet Engineering Task Force, April 
1998. 
[9] Mehmed Kantardzic “DATA MINING 
Concepts,Models,Methods,and Algorithms/HAND BOOK,” 
WILEY-INTERSCIENCE, 2003, pp. 341-358/[Dig. 9th Annu. 
Conf. Magnetics Japan, 1982, p. 301]. 
[10] Olivia Parr Rud“Data Mining Cookbook/Modeling Data for 
Marketing, Risk,and Customer Relationship Management,” 
WILEY - INTERSCIENCE,2001, pp. 304–322,. 
[11] 林朝欽、陸聲山”Sensor Network 在生物與環境監測之應
用”pp237-254 
 
 
 
 
 
 
 
大小、其購買力可被行銷人員衡量的程度。 
二、可接近性（Accessibility）指市場區隔能夠有效
的接觸和服務之程度。 
三、足量性（Substantiality）指市場區隔的規模夠
大或其獲利性夠高，值得去開發。 
四、可行動性（Actionability）指針對形成之市場區
隔擬定有效的行銷方案，以吸引及服務其市場區隔
的程度。區隔市場程序包括四個步驟，如圖 1： 
 
 
圖 1  市場區隔之程序圖 
 
目前較常使用的市場區隔模型，一般可分為以
下兩類：A 事前區隔法（Prior segmentation model）：
事前區隔法是事前先決定區隔變數，以便能立即得
知區隔之數量及型態。事先選定某些區隔標準，
如：人口變數、品牌忠誠度等，來作為市場區隔的
依據，通常使用方法有歸類法、交叉列表法 Cross 
tabulation）等。B 事後區隔法（Posterior segmentation 
model ）：此一模型又稱為集群基礎區隔法
（Clustering-based Segmentation），即事先不知道區
隔的數量及型態，必須依據一組有關聯的變數，將
消費者利用集群分類後，才決定的過程。常用的區
隔基礎變數為需求、態度、或其他心理變數。常用
的 方 法 有 Cluster Analysis 、 Multidimensional 
Scaling。 
 
3. 研究架構與方法 
 
本研究是針對台灣地區 3G 行動通訊市場調查
為主，並對其做市場區隔。由人口統計變數、現階
段 GSM 手機的使用狀況、對 3G 手機的認知與需求
等這幾個方面著手，提出本研究之架構圖，如圖 2： 
 
圖 2  研究架構圖 
 
    本研究之研究對象以台灣地區十八歲以上之
一般民眾為研究對象(依行政院主計處公佈之民國
九十三年全國人口概況為標準)，針對其現階段使用
手機的狀況及對於 3G 手機的接受程度、功能要求
為研究內容，做 3G 手機的市場區隔分析。根據前
面的研究架構圖所示，為了使研究中所使用的重要
變數能定義明確，以下將其個別分類並詳細說明： 
台灣地區定義：本研究所指台灣地區包括臺灣
本島、澎湖群島，其中居住地分為北中南東四個區
域(統計區域依據行政院主計處八十二年七月頒訂
「中華民國統計地區標準分類」報告分類。 
3G 手機定義：本研究所指 3G 手機為第三代行
動通訊系統及其所配合使用之手機，以台灣地區目
前五家 3G 系統業者所推出之通訊系統為例。 
現階段手機使用狀況：指研究對象現階段使用
手機的各種條件，包括持有度、使用度、更換頻率、
滿意度、使用動機這幾個方面。 
3G 手機的認知與購買行為：包括對 3G 手機的
產品知覺、產品接受度、價格接受度、購買因素。 
產品知覺的在每一位消費者心中都有不同定義，本
研究將此認知程度的衡量分為 3 種程度，即為知道
3G 手機、聽過但並不了解、不知道三種。 
3G 手機的功能需求：指目前第三代行動電話
所提供之服務，是以寬頻和整合多樣化功能為主的
項目，可歸為四類：1.通訊功能：影像電話、網頁
瀏覽 2.娛樂功能：音樂下載、網路遊戲、手機電視
3.商務功能：電話會議、電子商務、企業網路 4.生
活功能：定位資訊、新聞類資訊。 
人口統計變數：指研究對象的基本資料，本研
究將性別、年齡、職業、血型、居住地、教育程度、
每月可支配所得作為人口統計變數。 
本研究是以台灣地區一般民眾為母體，採用隨
機抽樣之分層隨機抽樣法，以電話訪問的方式，利
用 CATI 系統進行資料蒐集。以下將就抽樣設計加
以說明：(調查範圍)=>本研究以台灣地區為調查範
圍，並分成北、中、南、東四個區域，其分類方法
為表 1。 
表 1  區域涵蓋表 
區域 北部 中部 南部 東部 
包含縣市 台北縣、
桃園縣、
新竹縣、
基隆市、
新竹市、
台北市 
苗栗縣、
台中縣、
彰化縣、
南投縣、
雲林縣、
台中市 
嘉義縣、
台南縣、
高雄縣、
屏東縣、
澎湖縣、
嘉義市、
台南市、
高雄市 
台東縣、
花蓮縣、
宜蘭縣 
 
(調查對象) =>本研究以台灣地區十八歲以上
的一般民眾為調查對象。(抽樣方法) =>本研究是以
台灣地區一般民眾為母體，採用隨機抽樣之分層隨
機抽樣法，將台灣地區分為北、中、南、東四個區
域，利用 CATI 系統(Computer-Assisted Telephone 
Interviewing)，採電話調查的方式抽樣。(樣本結構) 
=>本研究根據實際回收狀況對母體結構進行檢
定，表 2 為居住地區在母體結構與實際回收之檢
定，在表 3 中可得知顯著水準大於 0.05，表示樣本
回收結果與母體結構具一致性。 
 
表 2  居住地區在母體結構與實際回收之檢定 
 
 定義及 
描述市場  
選擇 
區隔變數  
 分析 
顧客資料  
發現區隔  
 評估 
市場區隔
效果  
1×p 向量。找到向量 aˆ 使得分離函數 )(aS 為最大 
Fisher's 區別分析方法的概念： 
 
找到 aˆ 使此距離儘可能為大 
直覺的，
YS
YYaS 21)( −=  在測量轉換的平均
21 YY − 相對於樣本標準差 YS 。 
如果這轉換的兩群資料觀察值 121 ,...,, nYYY 和
212111 ,...,, nnnn YYY +++ 被完全分開，會導致 21 Y-Y
的值是很大的，即使當這個轉換資料的隨機誤差 
YS 也被考慮。重要的結果如下： 
向量 aˆ 使得距離 
YS
YYaS 21)( −= 為最大是 
)( 21
1 XXS pooled −−  
2
)1()1(
21
2211
−+
−+−=
nn
SnSnS pooled ……………(7) 
⎪⎪
⎪
⎩
⎪⎪
⎪
⎨
⎧
−
−−
=
−
−−
=
∑
∑
+
+−
−
1
))((
1
))((
2
1
2
22
2
1
1
2
11
1
21
1
1
n
XXXX
S
n
XXXX
S
nn
ni
ii
n
i
ii
其中
 
且
1
1
1
1
n
X
X
n
i
i∑
−= and 
2
1
2
21
1
n
X
X
nn
ni
i∑+
+== ……………(8) 
假設我們有一個觀察值
0X ，然後根據我們得
到的區別函數 XaXl 2ˆ)( = ，我們可以分配這個觀
察值到一個類別。 
 
 本研究架構圖將問卷區分為四大部分，分別為
「現階段手機使用狀況」、「3G 手機的認知與購買
行為」、「3G 手機的功能需求」、「個人基本資料」，
其分析方法首先將四個部份進行簡單的描述性統
計，並以次數分配表呈現，觀察樣本分布情況，再
以交叉表的方式針對「現階段手機使用狀況」、「3G
手機的認知與購買行為」、「個人基本資料」三部份
進行交叉分析，找出具顯著性的問項，並研究無顯
著差異者有無其特徵或理由。接下來再以 One-Way 
ANOVA，探討「現階段手機使用狀況」、「3G 手機
的認知與購買行為」、「個人基本資料」這三部份的
變數與「3G 手機的功能需求」變數的關係，並使
用無母數分析及 Scheffet Test 加以幫助比較。之後
使用集群分析以 3G 手機的功能需求變數對樣本分
群，並在分群之後將集群和其他部分的問項進行交
叉分析，觀察集群是否有不同的特性，同時進行
Discriminant Analysis，檢驗分群的正確性，最後利
用 Cluster Analysis 的結果做市場區隔的工作。 
 
5. 科技管理 
 
3G 手機的推出，剛開始的時候必然是所謂的
創新者（Innovator）首先採用，這部分人的比例約
略是 2.5%。接下去會跟著採用的人，是所謂的早期
採用者（Early Adopter），約佔 13.5% 。這兩種人
相加起來佔有比例達到 16%。（見圖 4）（黃彥達，
科技行銷的運作模式，2001）  
 
圖 4  科技管理行銷模型 
 
接下來依照採納新科技的時間先後分為早期多
數（ Early Majority ），以及晚期多數（ Later 
Majority），各佔 34% 左右。最後才是死硬派堅持
不採用的，約佔 16% 。 每一樣新科技產品的誕生，
大都經歷過這樣的演進才達到全面的普及。 
    以 3G 手機的例子來看，第一批使用 3G 手機的
人就是發明 3G 手機的人。這些人就是最前頭的
2.5%。他們的工作本身就在於催生新科技，所以常
常會用到新科技本身。接下去是生活或者工作上極
度需要，或者是天性對於新科技極力擁抱的族群，
會開始採納新的科技，這些人就是佔 13.5% 的那批
人。從使用行為上可以明顯看出這種玩家型的消費
者，這種人大多會自己採購零件組裝電腦，對於新
的技術津津樂道。  
    這些極度狂熱，對於規格瞭若指掌的消費者，
使用行為易於常人，往往能忍受不成熟的新科技所
帶來的極度不方便與高價，例如在搖晃的捷運車廂
中能夠以低解析度的 PDA 看電子書而絲毫不覺得
眼花，也樂在其中。 
    與這群人保持高度的良好關係非常重要，因為
這群人會左右其他後面消費者的採購決定。也許經
由口耳相傳，也許經由網站論壇、BBS，也許本身
就是老師或是主管，常有分享消費知識的機會等
等。但是這群人也不笨，他們會為良好的產品背
書，並維持極高的品牌忠誠，也因此行銷的重心常
常在產品本身的規格上面。 
    佔了 34% 的早期多數（Early Majority），就呈
現出完全不一樣的性格基調。對於這種人，在行銷
上請不要談太多的規格，也請不要談專有名詞。這
群人容易被簡單的訴求打動，或者明顯而多樣化的
功能需求。譬如大陸個人電腦的第一品牌聯想科
技，在銷售電腦這種高科技產品時的訴求只有一
個，「別讓自己的寶貝孩子輸給別人」。 
    後面佔了 34% 的晚期多數（Later Majority），
是更後知後覺的人。他們往往發現社會上大部分的
例較高 高 料外洩
比例較
高 
 
表 5  交叉比較表二 
交叉題項 可支配
所得
*3G 手
機會不
會造成
個人資
料外洩 
有沒有
使用手
機*知
不知道
3G 手
機 
多久更
換一次
手機*
有沒有
3G 手
機 
多久更
換一次
手機*
有沒有
3G 門
號 
特徵 5000元
以下認
為會造
成個人
資料外
洩的比
例較高 
有使用
手機者
不知道
3G 手
機比例
較高 
有 3G
手機者
在三個
月內更
換一次
手機比
例較高 
有 3G
門號者
在三個
月內更
換一次
手機比
例較高
 
 
3G 手機為一項新推出之產品，一般大眾對於其
功能可能無詳細深入的了解，因此在功能需求的問
項上大多偏向普通這一個選項，但本研究將其以平
均數來觀察，試圖了解受訪者需要程度之趨勢。由
表 5-3 可觀察出受訪者最想透過 3G 手機得到的服
務功能，依次為音樂下載與播放、新聞類資訊、影
像電話、電子商務、定位資訊、電話會議、網頁瀏
覽這幾項服務，而對於網路遊戲、手機電視、企業
網路應用這三個項目是偏向較不需要的。(見圖 5) 
 
 
 
圖 5  功能需求比較圖 
 
(四)在功能需求變數的部份，本研究將其與現
階段手機使用狀況、3G 手機的認知及購買、基本
資料比較之後發現，有手機的受訪者對於手機電視
有較高的需求；而每「三個月內」及「一年到兩年」
更換一次手機的受訪者較「三個月到半年」的受訪
者對電話會議功能的需求高；「兩年以上」更換一
次手機的受訪者較「半年到一年」更換一次手機受
訪者對定位功能的需求高；「知道」3G 手機的受訪
者較「不知道」3G 手機的受訪者對電話會議的需
求高；不知道血型的受訪者較其他血型受訪者對於
電話會議功能的需求為低；「25~34 歲」的受訪者較
「35~54 歲」、「18~24 歲」的受訪者對新聞類資訊
的需求高；在企業網路功能需求的部份，「18~24 歲」
的受訪者較「35~44 歲」、「55~64 歲」受訪者對於
企業網路功能需求高，女性受訪者對於企業網路功
能需求相對於男性為較高；相反的南部地區的受訪
者相對於其他地區與 55~64 歲相對於其他年齡層的
受訪者對於企業網路功能需求都相對較低。（見表
6、7） 
表 6  交叉比較表三 
交叉題
項 
是否有
使用手
機*手
機電視
功能需
求 
多久更
換一次
手機*
電話會
議功能
需求 
多久更
換一次
手機*
定位資
訊功能
需求 
知不知
道 3G
手機*
電話會
議功能
需求 
血型*
電話會
議功能
需求 
特徵 有手機
的受訪
者對於
手機電
視有較
高的需
求 
「三個
月內」
及「一
年到兩
年」更
換一次
手機的
受訪者
較「三
個月到
半年」
的受訪
者對電
話會議
功能的
需求高
「兩年
以上」
更換一
次手機
的受訪
者較
「半年
到一
年」更
換一次
手機受
訪者對
定位功
能的需
求高 
「知
道」3G
手機的
受訪者
較「不
知道」
3G 手
機的受
訪者對
電話會
議的需
求高 
不知道
血型的
受訪者
對於電
話會議
功能的
需求相
對較低
 
表 7  交叉比較表四 
交叉題項 年齡* 新
聞類資訊
功能需求
年齡*企
業網路功
能需求 
居住地區
*企業網
路功能需
求 
性別*企
業網路功
能需求 
特徵 「25~34
歲」的受
訪者較
「35~54
歲」、
「18~24
歲」的受
訪者對新
聞類資訊
的需求高
「18~24
歲」的受
訪者較
「35~44
歲」、
「55~64
歲」受訪
者對於企
業網路功
能需求高 
南部地區
的受訪者
對於企業
網路功能
需求相對
較低 
女性受訪
者對於企
業網路功
能需求相
對較高 
 
 (五)本研究以功能變數作為 Cluster Analysis 的
基礎，將受訪者分為三群，經由 Discriminant 
Analysis 得知其集群區別的正確率達 99.3%，由此
可知功能變數能有效區隔 3G 手機消費者。（見圖 6） 
 
