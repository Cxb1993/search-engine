2“延伸型寬頻調適性多位元率”(extended
adaptive multi-rate wideband， AMR-WB+)
作為多媒體服務之推薦音訊編碼標準[2]。
AMR-WB+編碼器採用複合式編碼
(hybrid coder)架構，對語音或音樂訊號分別
採用時域編碼之“代數型碼激式線性預估” 
(algebraic CELP, ACELP)及頻域編碼之“轉
換 編 碼 激 發 訊 號 ”(transform coding
excitation，TCX)兩個編碼核心，由於語音、
音樂或混合音訊信號之特性差異，在編碼
時需具備時域及頻域編碼模式選擇機制，
針對不同類型訊號採用合適之編碼核心作
編碼，使得編碼後之訊號品質為最佳。
本研究計畫主要針對 AMR-WB+編碼
模式選擇機制作研究，提出低複雜度的編
碼 模 式 選 擇 機 制 ， 以 進 一 步 降 低
AMR-WB+之計算複雜度。由先前研究計畫
之實驗分析得知，在 AMR-WB+編碼時，
為作出正確之編碼模式判斷，以“閉迴路
方式”嘗試各種可能之編碼模式組合，然
後依據編解碼後之音訊信號，以“最佳訊號
雜訊比準則”決定合適的編碼模式[2]，因此
其 ACELP/TCX 編碼佔用整體編碼時間約
61%；若能以較簡易之方式作編碼模式之
判別，將可有效降低編碼之計算複雜度。
三、AMR-WB+編碼模式選擇機制之
研究與評估
3.1 AMR-WB+閉迴路模式選擇機制
AMR-WB+針對每一組1024取樣點之
超音框(superframe)音訊，等分成四個256
取 樣 點 之 音 框 (frame) ， 每 一 音 框 由
ACELP/TCX兩個編碼核心擇一進行信號
編碼。若相鄰之音框均為TCX模式，則進
一步判斷是否採用256/512/1024取樣點之
TCX編碼，因此每一超音框可以有如附表
一所示26種可能之組合模式，以(m0, m1, m2,
m3)表示，其中mk代表該超音框之第k個音
框之操作模式，意義分別敘述如下：
 mk = 0 表示256取樣點ACELP編碼
 mk = 1 表示256取樣點TCX編碼
 mk = 2 表示512取樣點TCX編碼
 mk = 3 表示1024取樣點TCX編碼
表一 AMR-WB+編碼模式組合
(0, 0, 0, 0) (0, 0, 0, 1) (2, 2, 0, 0)
(1, 0, 0, 0) (1, 0, 0, 1) (2, 2, 1, 0)
(0, 1, 0, 0) (0, 1, 0, 1) (2, 2, 0, 1)
(1, 1, 0, 0) (1, 1, 0, 1) (2, 2, 1, 1)
(0, 0, 1, 0) (0, 0, 1, 1) (0, 0, 2, 2)
(1, 0, 1, 0) (1, 0, 1, 1) (1, 0, 2, 2)
(0, 1, 1, 0) (0, 1, 1, 1) (0, 1, 2, 2) (2, 2, 2, 2)
(1, 1, 1, 0) (1, 1, 1, 1) (1, 1, 2, 2) (3, 3, 3, 3)
表二 超音框之編碼模式嘗試
frame 0 frame 1 frame 2 frame 3
1 ACELP
2 TCX256
3 ACELP
4 TCX256
5 TCX512 TCX512
6 ACELP
7 TCX256
8 ACELP
9 TCX256
10 TCX512 TCX512
11 TCX1024 TCX1024 TCX1024 TCX1024
為了對編碼模式作出正確的判斷，平
均每一段音框訊號均被編解碼四次，產生
對應之合成訊號，將合成訊號以“分段訊雜
比”(segmental signal to noise ratio, SEGSNR)
作客觀品質量測，以作為閉迴路編碼模式
選擇之依據。
若以 wx 表示以聽覺加權後之原始音
訊信號， wxˆ 表示聽覺加權後之合成音訊信
號，量測SEGSNR是以音框為單位，並求
得平均之SEGSNR，計算公式如下：
 


















1
0
2
1
0
2
10
)(ˆ)(
)(
log20 N
n
ww
N
n
w
i
nxnx
nx
SEGSNR
(1)




1
0
1 FN
i
i
F
SEGSNR
N
SEGSNR (2)
其中SEGSNRi代表第 i個音框之量測
值，N代表音框之取樣點數，NF代表音框之
數量。
26種不同組合模式可以透過11個不同
之嘗試結果，決定最終之使用模式，如附
表二所示，為完成模式判斷，每一256點音
框平均需進行四次嘗試。
3.2開迴路編碼模式選擇機制
4採用此模式編碼之音框比率最高，但由圖
一 得 知 ， 純 音 樂 類 型 信 號 若 使 用
TCX-medium 編碼模式其訊號品質與
TCX-long 模式差異性不大。而“語音混合
音樂”(speech over music)信號其信號特性
不如純音樂具備較長時間之穩定性，因此
會有較多比例之音框使用 TCX-medium 模
式，但由圖一得知，強制使用 TCX-medium
及 TCX-long 模式作編碼，其信號品質差異
亦不大。另外，TCX-short 模式適用於音樂
信號特性變化較快之音框，屬於該編碼模
式之音框之比例較低，因此由實驗結果可
以看出，若強制使用 TCX- short 模式作編
碼，其客觀訊號品質不佳。
表五 信號樣本之音框編碼使用模式統計
content
mode music
speech
over
music
speech
betwee
n music
speech
ACELP 0.83 5.42 42.71 68.62
TCX-short 3.33 5.42 4.79 13.39
TCX-medium 7.51 35.83 6.67 12.25
TCX-long 88.33 53.33 45.83 5.74
Music Speech Speech between music Speech over music
0
1
2
3
4
5
6
7
8
9
10
S
E
G
S
N
R
,
dB
10.4 kbps mode
ACELP
TCX short
TCX medium
TCX long
3GPP Opt.
(a)
Music Speech Speech between music Speech over music
0
2
4
6
8
10
12
14
16
S
E
G
S
N
R
,
dB
24 kbps mode
ACELP
TCX short
TCX medium
TCX long
3GPP Opt.
(b)
圖一 不同編碼模式下之音訊壓縮品質
對純語音(speech)信號而言，ACELP
模式可以得到最佳之訊雜比，3GPP opt.對
語音樣本使用 ACELP 模式之比率最高，在
語音信號中之背景雜訊之音框可能採用
TCX 模式作編碼，使得在表五中，該組信
號有若干比例音框採用 TCX 模式。但值得
注意的是背景雜訊音框若使用 ACELP 模
式，對聲音主觀聽覺之品質影響不大，且
由圖一得知，對語音訊號若誤判為 TCX 模
式，其客觀品質量測之數據大幅降低，因
此對於語音類型之訊號盡可能使用ACELP
編碼模式。
對 於 “語音穿插音樂” (speech
between music)信號類型，語音信號與音樂
信號在時間上穿插出現，在語音與音樂信
號鄰接處，會混和著音樂與語音兩種不同
特性之信號，類似“語音混合音樂”信號類
型，由表五得知，ACELP 與 TCX-long 編
碼模式，分別有較多比例之音框使用，圖
一顯示，ACELP 與 TCX-medium/long 分別
得到相對較佳之訊噪比。
透過本實驗得知，若能在編碼之前，
依據信號特性參數作語音或音樂信號之正
確判別，可以維持其訊號品質。若為信號
特性與語音特性強烈相關，則直接採用
ACELP 模式，否則以 TCX 模式編碼。
4.2 訊號分類使用參數
開迴路編碼模式選擇機制，從訊號找
出若干個參數，利用不同編碼模式類型之
訊號參數值具備差異性，使得我們可藉由
參數之判別應採用之編碼模式。在本計畫
中採用之參數分別敘述如下：
a.訊號能量：背景雜訊或若干音樂片段時
間，具備相對較低之能量，此時大多使
用 TCX 模式。
b. 高低頻帶之能量比：將訊號通過非均
勻分割之濾波器組後，計算各個頻帶之
能量準位，再依頻率高低分別計算低頻
帶與高頻帶之能量和，計算高低頻能量
之比值。
c. 低頻帶之能量比：將低頻帶能量以該
音框能量作正規化。
d.頻帶能量之標準差：計算全部頻帶能
量，並統計各個頻帶能量之標準差。
e.正規化基週差：將各音框求得之基週
值，計算前後兩個音框之基週值差，並
以基週值作正規化。
f.基週增益：各音框求基週值過程中所
得到之預估增益(prediction gain)。
6class 0 class 1 class 2 class 3
0
20
40
60
80
100
pe
rc
en
ta
ge
,
%
proposed scheme
class 0 class 1 class 2 class 3
0
20
40
60
80
100
pe
rc
en
ta
ge
,
%
3GPP open-loop scheme
class 0
class 1
class 2
class 3
class 0
class 1
class 2
class 3
圖二 編碼模式判別之差異分析圖
為比較編碼模式選擇機制之模式判別
結果之差異，我們將 3GPP opt.機制之判別
結果視為正確之編碼模式，與快速模式選
擇法之編碼模式判別結果作比較分析，其
結果如圖二 所示。由圖二得知，本計畫所
提之方法與 3GPP 開迴路方法，對 ACELP
音框之判別正確率相等(91%)；對 TCX-long
音框，本計畫所提方法之判別正確率高於
3GPP 開迴路方法，開迴路方法有較多比例
之 音 框 被 誤 判 為 ACELP 模 式 。 對
TCX-short 音框，兩種快速法判別正確率均
偏低，我們對編碼後各音框之訊雜比作分
析，發現 TCX-short 音框若以 ACELP 模式
下作編碼，其訊噪比平均由 9.05dB 降為
8.46dB。對 TCX-medium 音框，3GPP 開迴
路方法判別正確率高於本計畫所提之方
法，但由圖四得知，本計畫所提之方法將
此種音框判定為 TCX-long 與 TCX-medium
之比例合計為 54%，高於 3GPP 開迴路方
法的 46%，後者有較多比例之音框被誤判
為 ACELP 模式。由先前之分析得知，
ACELP 模 式 之 信 號 若 被 誤 判 為
TCX-medium 或 TCX-long，其編碼後之訊
雜比差異較顯著，反之亦然，因此由表五
之實驗結果顯示，本文所提之方法，其訊
號品質優於 3GPP 開迴路方法。
在計算複雜度方面，3GPP opt. 選擇機
制為完成編碼模式選擇，每一音框平均需
進行四次嘗試，包含一次 ACELP 編碼與 3
種 TCX 編碼。3GPP 開迴路編碼模式選擇，
每一音框至少一次 TCX 或 ACELP 編碼，
最多需以 TCX 編碼核心編解碼兩次，以決
定出最終之編碼模式，為滿足實際應用時
之即時編碼需求，DSP 運算器需考量最差
狀況，因此，3GPP 開迴路編碼模式選擇需
考量一次 ACELP 編解碼或兩次 TCX 編解
碼所需之計算量。
相對的，本文所提之方法，只需進行
一次 TCX 或一次 ACELP 編碼，而輸入類
神經網路所需之參數，也取自原本編碼過
程中，已預先求得之參數，因此不需額外
增加計算量去取得所需參數；由於使用單
一隱藏層之類神經網路，輸入參數作編碼
模式鑑別時，也只需少量之計算。因此，
本文所提之方法，在計算複雜度降低之幅
度優於標準中所建議之開迴路編碼選擇機
制，後者計算複雜度降低約 50%。本文所
提之方法，相對於閉迴路編碼模式選擇機
制，計算複雜度大幅降低約 75%。
整體而言，本文所提之方法，無論在
訊號品質及計算複雜度下降之幅度，均優
於標準文獻中所提推薦之開迴路編碼模式
選擇法。藉由客觀之品質量測比較得知，
在編碼位元率為 24 kbps 情況下，分段訊號
雜訊比下降約為 0.35dB，經由非正式之聽
覺測試，不易分辨其音訊品質之差異。
五、即時音訊編解碼系統於嵌入式
多媒體應用平台之實現
在完成 PC Windows 平台下之編碼演
算法研究與模擬之後，我們嘗試將修改後
之 AMR-WB+音訊編碼器，移植到個人數
位助理(PDA)上，可攜式裝置之作業系統為
Windows Mobile 6 作業系統，視窗介面程
式語言以 C#程式語言設計。我們以讀檔之
方式讀取 wav 格式之聲音檔，在 Microsoft
Visual Studio 2008 開 發 環 境 ， 安 裝
Windows Mobile 6 軟 體 發 展 工 具 體
(software development kit, SDK)，將局部改
寫後之 AMR-WB+程式先行編譯成 DLL 動
態連結檔，將讀檔所得到之每一音框信
號，提供給 AMR-WB+程式作編解碼，並
將輸出合成語音透過聲音播放介面播放。
利用 PDA 觸控面板選擇編碼程式之位元
率，啟動或停止編碼程式。
六、結果與討論
本年度計畫針對 AMR-WB+音訊編解
碼器模式選擇機制之演算法進行研究，提
出快速演算法以降低低頻編碼核心，執行
模式選擇與編解碼所需之計算量。由實驗
證實，本計畫所提出的“基於類神經網路
之開迴路編碼模式選擇法”，相對於 3GPP
