 I
目錄 
目錄.......................................................................................................................................................I 
摘要......................................................................................................................................................1 
Abstract ................................................................................................................................................1 
一、前言..............................................................................................................................................1 
二、以區域對比估測及攝影色調重現的高動態範圍影像處理......................................................1 
2.1 系統架構.............................................................................................................................1 
2.2 雙邊濾波器(bilateral filter) ................................................................................................3 
2.3 區域對比估測(local contrast map evaluation) ...................................................................4 
2.4 攝影色調重現(photographic tone reproduction)................................................................5 
2.5 以影像處理為基礎應用於視訊處理.................................................................................6 
2.6 實驗結果.............................................................................................................................6 
三、應用區域對比增強於不均勻光源下之人臉辨識....................................................................10 
3.1 系統架構...........................................................................................................................10 
3.2 影像的前置處理............................................................................................................... 11 
3.3 人臉特徵抽取...................................................................................................................12 
3.4 使用 SVM 的人臉辨認系統 ............................................................................................14 
3.5 實驗結果...........................................................................................................................17 
四、利用短時傅立葉轉換及支持向量機對心音訊號做自動分析及以適應性特徵擷取............21 
4.1 系統架構...........................................................................................................................21 
4.2 心音圖切割方法...............................................................................................................21 
4.3 STFT 和 2D-DCT 特徵擷取法 ........................................................................................24 
4.4 特徵值的統計分析...........................................................................................................26 
4.5 心音辨識...........................................................................................................................27 
4.6 心音辨識結果...................................................................................................................27 
五、以適應性特徵擷取及改進支持向量機檢測心電圖心律不整................................................29 
5.1 系統架構...........................................................................................................................29 
5.2 心搏偵測...........................................................................................................................31 
5.3 次級分類演算法...............................................................................................................32 
5.4 心電圖訊號候選特徵擷取...............................................................................................34 
5.5 心電圖之生理特徵統計...................................................................................................35 
5.6 適應性特徵擷取系統.......................................................................................................36 
5.7 改良式支持向量機...........................................................................................................37 
5.8 心電圖之心臟疾病辨識...................................................................................................37 
5.9 辨識結果...........................................................................................................................38 
六、結論............................................................................................................................................39 
REFERENCE.....................................................................................................................................40 
 
 2
Photographic
tone reproduction
Local contrast
map evaluation
Bilateral filter
RGB to Yxy
Yxy to RGB RGBnormalization
Initial scaling
Tone
mapping Gamma
R
G
B
x   y
YL
YA
R
G
B
YS
Local contrast
extraction
Histogram
equalizationSimilar filter
R G B
R G B
x   y
YBY
Inverse
gamma Y
R
G
B
YHYG
Input image
Output image
Y adjustment
Y
YT
圖 1 高動態範圍影像處理流程 
 
假設輸入的影像是由消費型的數
位相機(digital still camera, DSC) 拍攝
而得，因此，影像資料應該被存成標準
的 RGB(sRGB)色彩空間並經過伽瑪校
正(gamma correction)，故輸入影像要做
反伽瑪校正(inverse gamma correction)
轉換成線性 sRGB 色彩空間，使得在之
後的高動態範圍處理流程可以維持住
顏色的正確性。 
第二步驟，為了代表亮度(Y)和彩度
(xy)將影像轉換成 CIEXYZ 色彩空間。
接下來的過程是重新調整Y成分以提高
視覺品質的兩種方法：局部對比映射圖
評估(local contrast map evaluation)以及
攝 影 色 調 重 現 (photographic tone 
reproduction)。 
用區域對比映射圖代表一張影像
可以大大減低動態範圍，因為像素對比
值是以中心像素與其相鄰像素的相對
強度比率為基礎所偵測到的。由於自然
界低通的特性，一般相對比率遠小於整
體影像原來的動態範圍。不過使用像素
梯度來代表影像對隨機雜訊而言是相
當敏感的，因此，在估測每一像素的區
域對比值之前，影像的亮度值要通過強
健的雜訊濾波器。如此一來，影像紋理
就變得顯而易見，尤其是在暗處的像
素。為了使影像內的紋理更加顯著，透
過 統 計 直 方 圖 等 化 (histogram 
equalization)的過程讓對比值範圍進一
步延伸。經由上述步驟，雖然整體對比
提高了，但如果原始影像是由典型的數
位相機拍攝得到，那麼輸出的影像可能
仍然會有許多雜訊。我們提出一個相似
濾波器(similar filter)使對比映射圖平滑
化，該濾波器檢查相鄰像素的顏色跟中
央像素相似才做亮度值的平均。這種平
滑化後對比映射圖可以減低不想要的
人造影像，如光環或相反的對比值。 
繼區域對比圖評估之後，像素的亮
度值被原始亮度和平滑化後對比值的
幾何平均數所取代。影像的對比得到了
加強後，新的亮度圖保持更好的可見
性，然後色調重現重新調整像素亮度值
以進一步增強影像。 
色調重現流程經由利用時間考驗
的攝影實踐技術被設計產生[1][2]，它
由初始調整(initial scaling)、色調映射
(tone mapping)、色彩空間轉換 (color 
space conversion)及數據正規化 (data 
normalization)等階段所組成。在初始調
整階段，輸出的色調範圍是首先被正規
化，使得影像亮度對數值的平均大約為
18%的灰階色調(18% gray tone)。色調
映射過程非線性地調整亮度值，使得亮
度在明亮區域衰減，以減少整個動態範
圍，同時提高了較暗區域的相對亮度。
透過傳遞原始彩度值(xy)到最後影像合
成階段，讓顏色恆定可以保留下來。在
高動態範圍影像中所採用的策略是用
較低曝光的方式拍攝影像以減少過度
曝光像素的數量，並採用綜合色調重現
方法恢復像素的亮度以及顏色。原始影
像在曝光不足和過度曝光的區域看起
來顏色黯淡，藉著整合已縮放過亮度值
 4
處理之後所產生的濾波效果。 
 
2.3 區域對比估測(local contrast map 
evaluation) 
在過去十年，許多基於梯度的對比
增強演算法陸續被提出來，當原始影像
的雜訊程度很低時，多數大有可為的結
果已被證明。不過，如果影像是由一個
普通的數位相機所拍攝而得，那麼基於
梯度的對比增強演算法之效能將大大
降低。影像感測器的信號雜訊比(SNR)
以及 A/D 轉換器的精確度常遠遠低於
規格要求。應用基於梯度增強影像對比
演算法的關鍵在於如何處理雜訊問
題，同時改善重現後影像的視覺品質。 
如圖 1 所示，在計算中心像素和鄰
近像素的梯度之前，中心像素 ),( ji 的亮
度值 ),( jiY 先由眾所周知的雙邊濾波器
(bilateral filter)濾波，完成雙邊濾波器
(bilateral filter)後的像素亮度值定義為
),( jiYB 。 
接下來的步驟是計算區域對比圖
),( jiYL ，區域對比表示某一像素和鄰近
像素的相對強度比率，如式(7)所定義。 
⎟⎟⎠
⎞
⎜⎜⎝
⎛ ++= 11),(
),(log),(
jiY
jiYjiY
V
B
L
 (7)
其 中 ),( jiYV 代 表 一 個
)12()12( +×+ nm 的視窗內的平均亮度
值，中央像素為 ),( ji ，且 ),( jiYV 可以
定義為式(3-8)。 
∑ ∑+
−=
+
−=+×+=
mi
mip
nj
njq
V qpYnm
jiY ),(
)12()12(
1),( (8)
既然鄰近像素的照明相似，代表影
像像素梯度的區域對比圖，可以有效地
補償照明的效果，然而，少數被雜訊破
壞的像素仍可能會主導區域對比圖的
動態範圍。解決這個問題的方法是拉伸
區域對比圖讓區域對比圖可以充分利
用影像所表示的動態範圍，最有效拉伸
區域對比圖的方法是直方圖等化
(histogram equalization)，該方法有助於
對高密集區域分配更大的動態範圍。區
域對比值 ),( jiYL 首先被分配到的 M 階
(bins)的統計直方圖 MkHBk ≤≤1, 。累
積頻率分佈函數(cumulative frequency 
distribution function, Mjjt ≤≤1),( )由
式(9)構成，其中 Mkkh ≤≤1),( ，代表
k 階(bin)的統計值。 
∑∑ ≤≤<= Miji ihihjt 1 )()()(  (9)
對於一個像素 ),( ji 具有區域對比
值與該像素的對比度值 ),( jiYL ，
)()1()( MjLMj x Ω×+<≤Ω× ，最初
被分配到第 j 階(bin)，目標值應該被移
至到第 p 階(bin)，其中 p 由 )( jtMp ×=
計算得到。等化後的區域對比圖定義為
),( jiYH 。雖然區域對比圖 HY 顯示更多
增強後的影像紋理，但是隨機雜訊
(random noise)也一樣會被增強，這也是
對比增強後所衍生的問題。解決這個問
題的方法就是使用相似濾波器(similar 
filter)，該方法是檢查相鄰像素的顏色，
當相鄰像素具有相似的顏色時就取平
均，該方程式可檢查兩個像素 ),( 11 ji 和
),( 22 ji 的顏色是否相似，如式(10)所定
義。 
1 1 2 2
1 1 1 2 2 2 1 1
( , , , )
1 ( , ) ( , ) ( , )
0
H H H
s i j i j
if Y i j Y i j Y i j
otherwise
α α
=
≤ ≤⎧⎨⎩
 
(10)
其中參數 1α 和 2α 分別設為 0.9 和
1.1，對於每個像素，相似像素的平均值
可以由式(11)和式(12)計算得到。亦即，
當周圍像素的顏色在中心像素顏色的
負 10%與正 10%之間時，鄰近像素的顏
色才算是與中心像素相似，目的是排除
顏色差異大的像素。 
2 2 1 1
1 1
1 1 2 2 2 2( , ) ( , )
1 1
( , )
1 ( , , , ) ( , )
( , )
A
Hi j w i j
Y i j
s i j i j Y i j
c i j ∈
=
∑
 
(11)
 6
2.5 以影像處理為基礎應用於視訊處
理 
一般而言，視訊處理流程是使用
YCbCr 或 YUV 的格式，因此，輸入及
輸出訊號的色彩空間不再是高動態範
圍影像處理流程內所標示的 RGB，而是
修改為 YCbCr。 
視訊處理流程，中間會經過離散餘
弦 轉 換 (discrete cosine transform, 
DCT)、量化(quantization)、可變長度編
碼 (variable length coding, VLC)等步
驟，一直都是 YCbCr 的串流格式，所
以，用 YCbCr 取代原來的 RGB，這樣
一來色彩空間轉換的步驟就可以省略。 
另外，高動態範圍視訊處理流程亦
省略伽瑪校正(gamma correction)及反
伽瑪校正(inverse gamma correction)。視
訊資料的亮度成分直接輸入給區域對
比評估(local contrast map evaluation)和
色調重現(tone reproduction)的步驟，經
過調整後的亮度值，再依其亮度的調整
比率，重新調整 CbCr 值，最後，輸出
處理完成的 YCbCr。 
對於整體視訊畫面為了恢復像素
的亮度及顏色所提出的高動態範圍攝
影系統運行在一完整的色調重現流
程。重現後的視訊與原來的影像比較，
在曝光不足的區域具有更好的可見
性。此外，因為像素的等效曝光被調整
到一個更好的設定，合成後視訊的色彩
看起來更加豐富。基本上，這部分的演
算法主要是依據影像演算法再加以修
改調整衍生出來的高動態範圍視訊處
理流程，如圖 3 所示。顯示提出的色調
重現訊號處理流程，為了改善可見性該
方法重新調整高動態範圍情景所錄到
的影像強度資料。假設輸入的影像是由
消費型數位攝影機所錄製，因此影像資
料一般都錄製在 YCbCr 的色彩空間
下。提出的系統重新調整 Y 成分，以兩
種技術提高視覺品質：對比圖估測和色
調重現。首先估測每一像素的對比度提
取出影像細節，然後將對比度整合到亮
度成分。最後，彩度成分 Cb 和 Cr 再進
一步調整成與像素亮度成分(Y)相同的
比例倍數。 
Contrast
map evaluationTonereproduction
Noise filter
CbCr
normalization
Initial scaling
Tone
mapping
Cb Cr
YL
YA
YT
Contrast
extraction
Histogram
equalizationY adjustment
Cb Cr
YB
YHYG
Input
video
Output
video
Cb
Y
Cr
Y
Y
Y
Y
Similar filter
YS
圖 3 高動態範圍視訊處理流程 
在最後階段，基於重建後的亮度值
),( jiYT 及原來的彩度值，視訊畫面被合
成出來。如同亮度成分以同樣的倍數調
整彩度值，如式(18)和式(19)所示。 
128
),(
),()128),((),( +×−=
jiY
jiYjiCbjiCb TT  (18)
128
),(
),()128),((),( +×−=
jiY
jiYjiCrjiCr TT  (19)
最後，彩度(CbCr)依照亮度所改變
的比率，乘上相同的倍數，也就是同時
調整 YCbCr，讓三個成分都是調整一樣
的倍率，以維持顏色的正確性。 
 
2.6 實驗結果 
我們假設輸入的照片原本是以
sRGB 色彩空間的儲存格式，而且每一
種 顏 色 通 道 的 深 度 為 8 位 元 (8 
bits/channel)。正如之前所討論的，當未
處理過的輸入影像有較高的顏色深度
(color depth)和訊雜比 (signal-to-noise 
ratio, SNR)時，當原始輸入影像具有更
高的顏色深度和訊雜比，許多廣泛性的
 8
圖 6 室內測試影像(攝影色調重現) 
圖 7 室內測試影像(適應性 retinex 濾波) 
圖 8 室內測試影像(感光色調重現) 
圖 9 室內測試影像(提出的方法) 
圖 10 戶外測試影像(攝影色調重現) 
圖 11 戶外測試影像(適應性 retinex 濾波) 
圖 12 戶外測試影像(感光色調重現) 
圖 13 戶外測試影像(提出的方法) 
值得注意的是我們提出的方法能
大大地增強黑暗處的亮度，同時防止影
像有太多過曝像素。我們考慮區域像素
對比並在區域對比圖上使用平滑濾波
器以減少不想要的人造影像產生，整合
這些原因就可以讓影像獲得改善。 
為了進一步檢查提出方法的優
勢，區域對比增強處理過程的中間結果
如圖 14、圖 15、圖 16 所示。圖 14 及
圖 15 分別顯示區域對比抽取的初始結
果和經由相似濾波器(similar filter)和統
 10
(a)直方圖等化後的對比圖 
(b)直方圖等化和相似濾波器平滑化的對比圖
圖 17 局部區域對比圖(室內) 
(a)直方圖等化後的對比圖 
b)直方圖等化和相似濾波器平滑化的對比圖
圖 18 局部區域對比圖(戶外) 
 
三、應用區域對比增強於不均勻光源下
之人臉辨識 
3.1 系統架構 
整個人臉辨識系統的處理流程如
圖 19 所示，當人臉資料輸入之後，將
分為三大部份作處理。首先利用區域對
比增強（local contrast enhancement）的
方式，來處理每張影像被拍攝的光線不
均勻的問題，而經過此處理後，可將影
 12
430-680nm ，藍光的波長範圍為：
310-560nm；在可見光與 R、G、B 波長
範圍對人眼的感應，得知人眼對藍光比
較不靈敏。 
 
3.2.2.2 YCbCr 
YCbCr 色彩空間用於數位視訊
中，其中 Y 代表亮度成份，Cb 代表是
藍色成份與參考值的差距、Cr 代表是紅
色成份與參考值的差距。如 20 式為
RGB 與 YCbCr 色彩空間轉換公式。 
0.299 0.587 0.114 0
0.1687 0.3313 0.5 128
0.5 0.4187 0.0813 128
Y R
Cb G
Cr B
⎡ ⎤ ⎡ ⎤ ⎡ ⎤ ⎡ ⎤⎢ ⎥ ⎢ ⎥ ⎢ ⎥ ⎢ ⎥= − − +⎢ ⎥ ⎢ ⎥ ⎢ ⎥ ⎢ ⎥⎢ ⎥ ⎢ ⎥ ⎢ ⎥ ⎢ ⎥− −⎣ ⎦ ⎣ ⎦ ⎣ ⎦ ⎣ ⎦
(20)
 
3.2.3 區域性對比增強 
由於每張影像被拍攝的光線常
常是不均勻的，而眼睛對亮度相對之
間的感覺較亮度之間的絕對差值有
較大的靈敏度，與真實的亮度強度絕
對值沒有關聯。若光以亮度來看，並
不是整張影像都一樣，而是根據亮度
強度的變化會群聚成小塊區域來分
佈。如圖 20 所示，我們對影像以區
域性的 contrast enhancement，可以增
強區域性的影像對比，若以 5×5 像
素為一個區塊，計算此區塊的平均亮
度（ Lavg ）如 21 式，為了避免 22
式的分母為 0，若是小於θ則將value
設為 0。否則可以利用 22 式算出平
均值與中心點（ Li ）的差異，為了
不讓亮暗差異過大，可以選在
logarithm domain 下做處理，最後將
結果正規化回來之後，可將影像的細
節保存下來。因此前處理可以將這些
可能影響辨識結果的變因做某個程
度的去除，可以強化對於辨識有幫助
的特徵且能夠在訓練工作執行時更
容易把我們所要的特徵取出來，因此
可以使辨識的效果更好。 
∑∑
= =
=
5
1
5
1i j
ijLLavg  (21)
)/log( LavgLivalue =  (22)
其中 為中心點的亮度， 為 5×5 區
塊的平均亮度 
threshold
NoYes
Log(center/avg) 0
Normalize local contrast
Li
Size：5 x 5……… .
…
…
…
…
…
…
....
Image Width
Image
Height
…
…
…
…
…
…
....
Li
θ>Lavg
)/log( LavgLi
…
…
…
…
…
…
....
…
…
…
…
…
…
....
圖 20 區域對比增強流程示意圖 
 
3.3 人臉特徵抽取 
3.3.1 DCT 簡介 
離 散 餘 弦 轉 換 (Discrete Cosine 
Transform，DCT)是將影像資料經過數
學的運算，從空間域轉換成頻率域的表
示方式，經過轉換後的訊號能量會比原
先的訊號更加集中，而大部份的能量可
以集中在某些係數上，因此具有高度緊
束能量的特性，因此常被使用在人臉辨
識特徵抽取，以減少資料量。而一個
M×N 二維 DCT 轉換公式如 23 式所示： 
1 1
( , )
1 (2 1) (2 1)( ) ( ) ( , ) cos[ ]cos[ ]
2 2
M N
x y
F u v
x u y vu v f x y
M NMN
π πα α
= =
=
+ +×∑∑
其中， 1 1
( ) 2
1,
w
w
otherwise
α
⎧ =⎪= ⎨⎪⎩
，  
(23)
故 DCT 轉換是將區塊內的資料依
空間頻率來分解，再將相同頻率部份相
加，因而形成一個矩陣，矩陣內的係數
為其相對位置所代表頻率的振幅，左上
角為低頻係數，越往右下角頻率越高，
 14
間差異的 d 向量，如圖 3-5 所示，其中
k 表示所屬的特徵維度，下標的兩個數
字 m、n 表示所要分類的兩個類別。其
中 d 的計算方式由 23 式得到： 
nmnm
kd kn
k
m
k
nm
≠≤≤
=−=
 ,10,1
1,...616for  ,)( 2, μμ  (23)
 
.
.
.
1
1,2d
2
1,2d
3
1,2d
4
1,2
614
1,2
615
1,2
616
1,2
616
.
.
.
1
1,3
2
1,3
3
1,3
4
1,3
614
1,3
615
1,3
616
1,3
.
.
.
1
1,4
2
1,4
3
1,4
4
1,4
614
1,4
615
1,4
616
1,4
45
.
.
.
1
9,10
2
9,10
3
9,10
4
9,10
614
9,10
615
9,10
616
9,10
. . . .
d
d
d
d
d
d
d
d
d
d
d
d
d
d
d
d
d
d
d
d
d
d
d
d
d
 
圖 23 兩兩之間平均值差異平方的向量示意圖
計算完 ,km nd 後，就可以利用剛剛產
生的 ,km nd 與之前計算的變異數來計算
可以用來區別兩類的特徵區別值 ω。計
算方法如 24 式。根據公式來看，若是
同類之間的變異數越小，表示兩類之間
自己與自己類越相像。而兩類間的 ,km nd
越大就表示這兩類越不像。因此，若是
所計算出來的 ω值越大，表示這個值越
可以區分出這兩類，這個特徵越重要。 
nmnm
kd kn
k
m
k
nm
k
nm
≠≤≤
=+=
 ,10,1
1,...616for  ,)/(,, ννω (24)
 
.
.
.
1
1,2ω
2
1,2ω
3
1,2ω
4
1,2ω
614
1,2ω
615
1,2ω
616
1,2ω
616
.
.
.
1
1,3ω
2
1,3ω
3
1,3ω
4
1,3ω
614
1,3ω
615
1,3ω
616
1,3ω
.
.
.
1
1,4ω
2
1,4ω
3
1,4ω
4
1,4ω
614
1,4ω
615
1,4ω
616
1,4ω
45
.
.
.
1
9,10ω
2
9,10ω
3
9,10ω
4
9,10ω
614
9,10ω
615
9,10ω
616
9,10ω
. . . .
 
圖 24 兩兩之間特徵區別值的向量示意圖 
 
計算完兩類與兩類之間的特徵區
別值 ω後，我們就可以知道針對不同的
兩個類別，哪一個特徵維度的特徵值是
對於分辨這兩類有幫助的，值越大表示
對於分類越有利。經過排序後我們就可
以知道，使用哪幾個特徵維度是這兩類
的最佳辨識。由於是兩類與兩類之間的
辨識，針對不同的兩個類別取相對應此
兩類的最佳分類特徵維度的做法就會
比一般將所有類別一起訓練出一個分
類模型的分類效果來的好，而且可以用
到更少的特徵。取多少特徵維度來辨認
則是取決於當初訓練時最佳的辨識率
是落在哪一個維度。若都很好時則取最
少維度以減低計算量。 
 
3.4 使用 SVM 的人臉辨認系統 
3.4.1 SVM 簡介 
支 持 向 量 機 (Support Vector 
Machine，簡稱 SVM)是 1998 年以統計
理論為基礎所提出的機器學習理論，有
別於傳統的類神經網路的經驗之風險
最 小 化 (Empirical Risk Minimization 
Principle, ERM)，而是一種結構風險最
小化原理(Structural Risk Minimization 
Principle, SRM) 的統計學習理論，用於
分類與迴歸的問題。SRM 使 VC(Vapnik 
Cherovnenkis) 維度數上限最小化，這
使得 SVM 的方法比使用類神經網路具
有更好的泛化能力。此外，SVM 的一
般化錯誤與其它機器學習的方法不同
在於：SVM 的一般化錯誤與資料的維
度無關，而是視不同類別資料之間分離
的程度而定，因此只要資料的分離程度
越好，則 SVM 的分類效果也越好，這
也證明了 SVM 在處理大量資料時，能
達到很好的分辨能力。 
SVM 的分辨效果與資料間的分離
 16
3.4.1.2 線性不可分離 
 線性可分離是描述所有的資
料都沒有落在間距內的情形，但在實際
上，資料有可能會落在空間上的任何一
個位置，因此很難使兩群不同的類別的
資料完全分離，所以加入了間隔鬆弛變
量 (Margin Slack Variable)ξ ，
i=1,2,…,N，目的是加入 slack variable
後，能使得所有的資料都能落在間距之
外，所以 slack variable 可視為資料的分
佈狀況，當 slack variable 的總和越小，
代表資料越符合 SVM 的準則；當 slack 
variable 的總和越大，代表我們需要對
資料作越大的調整，才能使所有的資料
都符合分離的情況，因此 slack variable
的總和越小越好。以物理意義來說，當
資料分佈與正確位置間的錯誤小於
slack variable 時，則原本的式子可表示
成 30 式，而最佳分類面可表示成 31 式。 
nibxwy iii ,...,2,1,1)( =−≥+⋅ ξ  (30)
∑
=
+=
n
i
ii Cwwj
1
2
2
1),( ξξ  (31)
其中 C 是一個衡量訓練錯誤，代表
當 C 越大時，SVM 的模型對於錯誤就
越敏感，反之當 C 越小時，間距最大化
的重要性也就越大，所以 Lagrange 函數
為成 32 式： 
1 1 1
1
1( ) ( )
2
, 0 , 0
N N N
d i i j i j i j
i i j
N
i i i
i
L y y x x
C y
α α α α
α α
= = =
=
= − ⋅
≤ ≤ =
∑ ∑∑
∑
 
(32)
求 解 Lagrage 函 數
(Lagrangian) ( )dL α 之最大值就可以得
到最佳分類平面 (Optimal Separating 
Hyperplane)。 
 
3.4.1.3  非線性可分離 
然而有很多情況，SVM 的線性分
離限制對於原始維度的資料而言是過
於嚴格的，因此若當兩類資料重疊的情
形很嚴重，以致不能很容易用最佳分類
面將資料分類，所以在尋找最佳分類面
之參數前，可以先將資料利用 φ函數 33
式，將原本的空間投影到某個高維的空
間： 
)(xx φ→  (33)
此高維空間稱做特徵空間，所有原
始的資料投影到特徵空間後(如圖 26)，
能改善原本不同類別的資料分佈重疊
的情況，因此能將類別與類別間分離，
然後再取得最佳化平面的最佳化參數
值。 
Φ(.)
Original space Feature space  
圖 26 kernel function 示意圖 
而這些核函數比較著名的有下列
公式 34、35、36、37： 
Linear kernel function： 
( , )i j i jK x x x x= ⋅  (34)
Polynomial kernel function： 
d
jiji xxxxK )(),( βγ +⋅=  (35)
RFB kernel function： 
( ) ( )2, expi j i jK x x x xγ⎛ ⎞= − −⎜ ⎟⎝ ⎠JJG JJG JJG JJG  (36)
Signoid kernel function：  
)tanh(),( βγ +⋅= jiji xxxxK  (37)
其中的 d、γ與 β 皆為常數參數值。 
SVM 理論只考慮高維特徵空間的
內積運算 ( ) ( ) ( ),i j i jK x x x x= Φ ⋅ΦJJG JJG JJG JJG ，而
不直接使用函數Φ，從而巧妙地解決了
因Φ未知而 W 無法顯示表達的問題，
稱 ( ),i jK x xJJG JJG 為核函數。經由文獻証明，
只要滿足 Mercer 條件的對稱函數即可
作為核函數。 
 18
之人臉資料庫，包含 Yale 與 Yale B。 
Yale 人臉資料庫 
這個人臉資料庫是由耶魯大學所
收集的。可免費使用於學術用途上。資
料庫中有十五個不同的人，每人十一張
照片，共有一百六十五張影像。每個人
的十一張影像各有不同的情緒與光照
條件，分別有中央打光、戴眼鏡與不戴
眼鏡、快樂表情、左邊打光、正常表情、
右邊打光、難過表情、想睡覺的表情、
驚訝表情與眨眼表情。如果需要有關此
人臉資料庫的進一步資料，請參考網頁
http://cvc.yale.edu/projects/yalefaces/yale
faces.html  
Yale_B 人臉資料庫 
這個資料庫是由耶魯大學所收集
的。可免費使用於學術用途上。 
資料庫中有十個不同的人，每人有九種
姿勢，並在不同角度的光源下做變化，
所以每人有四百零五張，總共有四千五
十張。 
 
3.5.2 Yale 實驗結果 
根 據 人 臉 辨 識 演 算 法 經 由
Adaptive Feature Selection 的 SVM 辨識
系統的處理，針對 Yale Database 的人臉
資料庫做統計分析，此人臉資料庫的樣
本數有十五個人共一百六十五張。表 1
為每個人選出三張（共 45 張）來訓練，
其餘的 120 張影像來測試所得到的結
果，下表 2 為 Adaptive Feature Selection
的統計圖，表 3 為 Adaptive Feature 
Selection 的支持向量統計圖。如圖 28
所示，未經區域對比增強的影像，其辨
識率為 93.33%。而經過區對比增強之
後的影像 ( 如圖 29) ，其辨識率為
98.33%。 
 
圖 28 未經區域對比增強 
圖 29 經區域對比增強的結果 
 
表 1 人臉辨識的結果 
Without LCE With LCE Without LCE With LCE
8 21 15 82.5 87.5
10 22 14 81.67 88.33
12 19 9 84.17 92.5
14 19 9 84.17 92.5
16 16 9 86.67 92.5
18 15 11 87.5 90.83
20 15 5 87.5 95.833
22 15 9 87.5 92.5
24 13 8 89.17 93.33
26 13 7 89.17 94.17
28 17 8 85.83 93.33
30 16 6 86.67 95
32 12 8 90 93.33
Adaptive Feature
Selection 8 2 93.33 98.33
Recognition Rate (%)Number of the MisrecognizedImagesThe Number of
Feature values
 
表 2 特徵選取數量的統計表 
8 67 69
10 11 8
12 10 6
14 5 3
16 1 2
18 4 6
20 3 3
22 1 3
24 0 3
26 0 1
28 1 0
30 1 1
32 1 0
Total Number of
Hyperplanes 105 105
The Average Number
of Feature values 10.438 10.857
The Number of Feature
values
The Number of Hyperplanes
W ithout LCE W ith LCE
 
 
 
 
 
 
 
 20
表 7 人臉的辨識結果 
8 289 91.55
10 234 93.16
12 182 94.68
14 166 95.15
16 167 95.12
18 153 95.53
20 131 96.17
22 133 96.11
24 114 96.67
26 94 97.25
28 82 97.6
30 85 97.51
32 75 97.8
Adaptive Feature
Selection 51 98.51
The Number of
Feature values
Recognition
Rate (%)
Number of the
Misrecognized
Images
 
表 8 為從每個 subset 挑出二張(共
720 張)來訓練，其餘的 3330 張影像來
測試所得到的結果，下表 9 為 Adaptive 
Feature Selection 的統計圖，由此表可看
出大部份的 Feature Number 小於 12，而
且平均值為 10.8，代表出大部份的
Feature Number 都沒有很大，表示選用
的 Feature 皆為少數。表 10 為 Adaptive 
Feature Selection 的支持向量統計圖，由
此表可看出大部份的 SV Number 小於
10，而平均值為 9.578，因此可以分析
出大部份的 SV Number 都沒有很大，表
示大部份的 hyper-plane 可以容易分
類。如圖 30 所示，未經區域對比增強
的影像，其辨識率為 94.02%。而經過
區域對比增強之後的影像(如圖 31)，其
辨識率為 99.13%。由此可知，經過我
們建議的方法之後，其辨識率大大的提
升，並且有效的解決光源變化的問題。 
表 8 人臉的辨識結果 
Without LCE With LCE Without LCE With LCE
8 336 101 89.91 96.97
10 300 87 90.99 97.39
12 307 62 90.78 98.14
14 281 50 91.56 98.5
16 273 41 91.8 98.77
18 271 47 91.86 98.59
20 252 49 92.43 98.53
22 253 50 92.4 98.5
24 233 51 93 98.47
26 231 45 93.06 98.65
28 223 34 93.3 98.98
30 207 34 93.78 98.98
32 230 30 93.1 99.1
Adaptive Feature
Selection 199 29 94.02 99.13
Number of the Misrecognized
Images Recognition Rate (%)The Number of
Feature values
表 9 特徵選取數量的統計表 
8 22 29
10 6 2
12 2 4
14 3 3
16 0 1
18 1 3
20 0 1
22 2 1
24 4 0
26 1 0
28 3 0
30 0 0
32 1 1
Total Number of
Hyperplanes 45 45
The Average Number
of Feature values 13.378 10.8
The Number of
Feature values
The Number of Hyperplanes
W ithout LCE W ith LCE
 
 
表 10 支持向量的統計表 
1 0 0
2 0 0
3 6 0
4 6 0
5 7 1
6 2 6
7 3 6
8 5 7
9 1 8
1 0 3 3
1 1 2 3
1 2 1 3
1 3 3 4
1 4 0 0
1 5 2 0
1 6 1 0
1 7 1 3
1 8 0 1
1 9 0 0
2 0 2 0
T o ta l N um b er o f
H yp e rp la ne s 4 5 4 5
T h e  A ve rag e  N um b er
o f S up p o rt V eco trs 8 .11 9 .57 8
T he  N u m b er o f
S up p o rt V ec to rs W ith ou t L C E W ith  L C E
 
 
圖 30 未經區域對比增強 
圖 30 經區域對比增強 
 22
( ) ( ) ( ) ( ) ( )ACF t x t x t x x t dτ τ τ∞−∞= ⊗ = ⋅ +∫ (39)
 
4.2.2 資料降取樣數 
由於一筆心音資料動輒上百萬
筆，對於資料處理來說數量過於巨大，
因此我們在不影響特徵的情況下將資
料數目降低八倍，而且降低八倍對於硬
體晶片實現上面僅須將資料平移三位
元，不需要使用架構龐大的除法器，(如
圖 31 所示)為未經過凸顯的心音。 
0 1 0 0 0 2 0 0 0 3 0 0 0 4 0 0 0 5 0 0 0 6 0 0 0 7 0 0 0 8 0 0 0 9 0 0 0 1 0 0 0 0- 4
- 3
- 2
- 1
0
1
2
3 x  1 0
4
N u m b e r  o f  s a m p l e s
A
m
pl
itu
de
圖 31 心音辨識系統處理流程 
 
4.2.3 心音峰值的凸顯 
Histogram 原理是利用統計方法，
先找出最大的能量範圍，之後分別統計
出各能量值的樣本個數，並且把樣本個
數做累加，可以由總樣本數中設定一個
門檻值找出我們要過濾的能量強度，接
下來我們將心音疾病經過 Histogram 
計算取得心音資料中，數值分布範圍，
其步驟如下，我們以急性心包炎(Acute 
Pericarditis)這疾病為範例。 
(1)對心音取絕對值，結果如圖 32。 
(2)找出心音強度最強的值 Λ。 
(3)統計各強度個數，結果如圖 33。 
(4)各強度個數的累計如 39 式，結果如
圖 34。 
 
0
( ) ( ), 0k
x
AH k H x k== ≤ ≤ Λ∑  (39)
(5)設定一個門檻值，來選擇要保留門檻
值以上的訊號，不到的補零如 40 式： 
[ ][ ]
[ ]
0
DA D
D
if X t kX t
X t
otherwise
′≥⎧= ⎨⎩
 (40)
我們選擇保留 Histogram 數值比率
0.97 以上的部分，以凸顯心音中能量較
高的部分，圖 35 為經過 Histogram 凸顯
的心音資料。 
0 1 0 0 0 2 0 0 0 3 0 0 0 4 0 0 0 5 0 0 0 6 0 0 0 7 0 0 0 8 0 0 0 9 0 0 0 1 0 0 0 00
0 . 5
1
1 . 5
2
2 . 5
3
3 . 5 x  1 0
4
N u m b e r  o f  s a m p l e s
A
m
pl
itu
de
圖 32 心音取絕對值 
0 0 . 5 1 1 . 5 2 2 . 5 3 3 . 5
x  1 0
4
0
5 0
1 0 0
1 5 0
A m p l i t u d e
N
um
be
r o
f s
am
pl
es
圖 33 統計各強度個數 
0 0 . 5 1 1 . 5 2 2 . 5 3 3 . 5
x  1 0
4
0
1
2
3
4
5 x  1 0
4
A m p l i t u d e
N
um
be
r o
f s
am
pl
es
圖 34 各強度個數的累計 
0 1 0 0 0 2 0 0 0 3 0 0 0 4 0 0 0 5 0 0 0 6 0 0 0 7 0 0 0 8 0 0 0 9 0 0 0 1 0 0 0 0- 4
- 3
- 2
- 1
0
1
2
3 x  1 0
4
N u m b e r  o f  s a m p l e s
A
m
pl
itu
de
圖 35 Histogram0.97 凸顯的心音 
 
4.2.4 自相關函數 
自相關函數是一個基於時域的音
高追蹤方法，由 Lawrencer R. Rabiner 
所提出，將音框(frame)每次都向右平移
一點，然後將其與原音框重疊的部份作
內積，重複作數次所得的這些內積值便
是 ACF 向量(ACF Vector)，而自相關函
數以離散數列的表示如 41 式，N 為音
框內取樣總數，n 為音框內之取樣點。 
- -1
0
( ) ( ) ( )
N n
k
ACF n X n X n k
=
= +∑  (41)
圖 36 為音框範圍取 10240 筆取樣
點所產生的結果。原音框與剛好平移了
一個週期之音框做內積，而此規律曲線
即此音框之 ACF。 
0 1 0 0 0 2 0 0 0 3 0 0 0 4 0 0 0 5 0 0 0 6 0 0 0 7 0 0 0 8 0 0 0 9 0 0 0 1 0 0 0 00
2
4
6
8
1 0
1 2
1 4 x  1 0
6
N u m b e r  o f  s a m p l e s
A
m
pl
itu
de
圖 36  ACF 後的心音圖 
 24
都為零時，切割週期的動作就停
止，得到圖 42 的結果[13][14]。 
0 500 1000 1500 2000
-2
0
2
x 10
4
0 500 1000 1500 2000
-2
0
2
x 10
4
0 500 1000 1500 2000
-2
0
2
x 10
4
0 500 1000 1500 2000
-2
0
2
x 10
4
圖 42 心跳切割 
4.2.8 心跳重疊修正 
由於切割完的心音不一定完整，所
以利用相關係數(correlation)的概念去
比對，當心跳後半段與下一心跳有重疊
的部份時，將重疊部份設為零進行修正
的動作，圖 43 為流程圖，結果如圖 44。 
輸入：切割後的目前心跳 XD，下一心跳 XA，
心跳週期長度 Period 
輸出：修正後的心跳 XT 
for(i = 1; i <= Period/2; i++) { //i 為比較取樣數
的個數 
    j= 0;  //j 為下一心跳的比對點 
    Counter = 0;  //Counter 累計重疊取樣數 
 for(k = i; k > 0; k--) {  //k 為比較次數 
  if(XD[Period - k] ==XA[j])  // Period 
- k 為目前心跳的比對點 
    Counter++;  
     j++;  
 } 
 if(Counter > CounterReg) 
   CounterReg = Counter;  //記錄最大的
重疊範圍 
} 
for ( i = 0; i < Period ; i++)  //將目前心跳重疊
部份濾除 
 if(i > (Period - CounterReg)) 
   XT [i] = 0;  
 else  
   XT [i] = XD[i];  
圖 43  心跳重疊修正流程圖 
0 500 1000 1500 2000
-2
0
2
x 104
0 500 1000 1500 2000
-2
0
2
x 104
0 500 1000 1500 2000
-2
0
2
x 104
0 500 1000 1500 2000
-2
0
2
x 104
 
圖 44 心跳修正 
 
4.2.9 心跳置中修正 
為了要統一所有切割出來的心音
格式，我們利用心跳置中的方式來做心
音的規格統一，其方法如下將 4.1.7 小
節步驟修正過的心跳做強度平方的累
加，記錄累加平方強度一半值對應的取
樣點 t 如 44 式，由 t 為中心向左右擴張，
其資料長度固定為最大週期的長度，不
足的資料補零(如圖 45)。 
1 1
( ) ( ) 1/ 2 ( ) ( )
t
T T T TX X X X
τ τ
τ τ τ τΩ
= =
=∑ ∑  (44)
0 1 0 0 0 2 0 0 0 3 0 0 0 4 0 0 0
- 2
0
2
x  1 0
4
0 1 0 0 0 2 0 0 0 3 0 0 0 4 0 0 0
- 2
0
2
x  1 0
4
0 1 0 0 0 2 0 0 0 3 0 0 0 4 0 0 0
- 2
0
2
x  1 0
4
0 1 0 0 0 2 0 0 0 3 0 0 0 4 0 0 0
- 2
0
2
x  1 0
4
圖 45 心跳置中修正 
 
4.3 STFT 和 2D-DCT 特徵擷取法 
擷取特徵我們使用短時傅立葉轉
換及二維離散餘弦轉換，這兩種方法對
心臟週期去做特徵擷取，主要是因為短
時傅立葉轉換會同時考慮到時域及頻
域的特性，而二維離散餘弦轉換會將高
相關性的信號內容，集中在少數低頻係
數上，最後將特徵擷取結果交由分類器
去做辨識。 
( , ) ( ) ( ) iwtSTFT f t g t e dtτ ω τ∞ −−∞= −∫  (45)
STFT 為短時傅立葉轉換 (Short-Time 
Fourier Transform)，利用τ的移動去涵蓋整個時
間軸，以取得訊號的區域資訊。將非平穩訊號
分成許多區段，並假設在每一區段之中訊號是
 26
示)[17]，其數學式如 46 式[18]，結果如
圖 51。 
20.54 - 0.46cos( ),    0 -1
( ) -1
0,      
n n N
w n N
otherwise
π⎧ ≤ ≤⎪= ⎨⎪⎩
(46)
DFT 的公式如 47 式，x(n)為音框乘
上漢明窗後的數值，N 為音框大小 128
個點，46 個音框代入上式，結果如圖
52，為一個 M*N 的矩陣，而 STFT 結
果是對稱的情形[19][20]，圖 53 為區域
放大圖。 
2-1 -
0
( ) ( ) ,       0 -1
N j kn
N
n
X k x n e k N
π
=
= ≤ ≤∑ (47)
圖 52 經 STFT 後的結果 
圖 53 經 STFT 區域放大圖 
我們取一半的 STFT 後 M=46、
N=64 代入 2D-DCT 結果為圖 54，而圖
55 為 2D-DCT 直流區域放大圖，其中一
維的特徵共 2944 個元素。 
圖 54 2D-DCT 結果 
圖 55 2D-DCT 直流區域放大圖 
 
4.4 特徵值的統計分析 
接下來是特徵的統計分析，由於
SVM 的最大的特色就是能對兩個類別
的特徵映射到高維度後，以線性切割方
式辨認出兩個類別。所以必須先計算每
個類別每個特徵維度的平均值，其中德
州心臟學會共有 20 類的病症，分為 44
個次類別，由 2D-DCT 擷取出的特徵向
量有 2944 個。首先本研究定義一個評
估特徵值方程式如 47 式： 
2
, ( ) , 1, ,2944
1 , 44,
k k k
m n m nd u u for k
where
m n m n
= − =
< ≤ ≠
"  
(47)
圖 56 兩兩之間平均值差異的平方向量示意圖
計算完 ,km nd 後，就可以利用剛剛產
生的 ,km nd 與之前計算的變異數來計
算，可以用來區別兩類的特徵區別值
σ。計算方法如 47 式。根據公式來看，
若是同類之間的變異數越小，表示兩類
之間自己與自己類越相像。而兩類間的
,
k
m nd 越大就表示這兩類越不像(如圖 56
所示）。因此，若是所計算出來的 σ 值
越大，表示這個值越可以區分出這兩
 28
樣本，480 個心跳去做測試樣本去做辨
識，其結果如表 10，最後經由 Adaptive 
Feature Selection 的辨識率為 94.79%，
如表 11特微選取數量的統計表，Feature 
Number 大部份在 32 以下平均值為
6.49，因此可以分析出大部份的 Feature 
Number 都沒有很大，表示我們選用的
Feature都沒有很大，而表 12為Adaptive 
Feature Selection 的支持向量統計表，由
此表可看出大部份的 SV Number 小於
6，而平均值為 3.18 因此可以分析出大
部份的 SV Number 都沒有很大，表示大
部份的 Hyper-plane 可以容易分離，由
此可知，心音經由我們提出的自動分析
系統分析之後，可以達到不錯的辨識效
果。 
表 10 STFT 及 2D-DCT 後的辨識結果 
The Number of 
Feature values 
Number of the 
Misrecognized 
Beats 
Recognition 
Rate(%) 
2 65 86.45
4 58 87.91
8 57 88.13
16 49 89.79
24 43 91.04
32 46 90.42
40 48 90
48 47 90.2
64 42 91.25
72 44 90.83
80 45 90.63
88 44 90.83
96 46 90.42
104 45 90.63
112 46 90.42
120 48 90
128 50 89.58
Adaptive Feature 
Selection 25 94.79 
 
 
 
 
 
表 11 特微選取數量的統計表 
The Number of Feature 
values The Number of Hyperplanes
2 759 
4 57 
8 37 
16 34 
24 9 
32 10 
40 4 
48 7 
64 11 
72 2 
80 3 
88 3 
96 0 
104 2 
112 3 
120 1 
128 4 
Total Number of 
Hyperplanes 946 
The Average Number of Feature 
values 6.496829 
 
表 12 支持向量的統計表 
The Number of Support 
Vectors The Number of Hyperplanes
1 0 
2 227 
3 421 
4 172 
5 56 
6 22 
7 12 
8 7 
9 12 
10 9 
11 1 
12 1 
13 3 
14 1 
15 0 
16 1 
17 0 
18 1 
Total Number of Hyperplanes 946 
The Average Number of 
Support Vectors 3.451374 
 
 30
驗證。心電圖的辨識系統首先在第一階
段進行單一心電圖訊號切割、心電圖訊
分群、特徵值擷取，接著第二階段為學
習訓練，最後第三階段則完成分類網路
決策。心律不整辨識系統的處理流程如
圖59所示，未知的心電圖訊號通過輸入
端之後，會將心電圖訊號分為四大區塊
處理。 
 
圖59 心電圖辨識系統流程圖 
心電圖辨識系統中，具有高量的R
波是第一個偵測的重點；由於各類病症
的心電圖中QRS波是差異最為明顯的
部位，所以區域的搜尋上相對容易偵測
出來。在切割完病症資料後，由於資料
十分龐大，因此需要對病症資料做分群
的動作，並且利用小波分解和分析波形
來抽取各個病症的特徵值，最後經由分
類網路判斷出病症種類。以下將針對每
個處理的區域作簡單介紹： 
Beat Detection & Segmentation： 
關於心電圖QRS波偵測，早在1985
年就有相關文獻探討。對於一般正常的
心跳而言，每一個心電圖都有明顯的
QRS波形，也是心電圖上最為顯著的波
形訊號，其具備著高聳尖銳的高頻特
性。在時域(Time domain)中，QRS波可
以很容易的由肉眼所查覺到並且明確
的指出，其原因就是QRS波有明顯突
波。但從訊號處理的觀點而言，心電圖
的偵測卻不是一項簡單的任務，其遭遇
的主要問題點就是在訊號源；不論是量
測上的疏失亦或是儀器所產生的誤
差，都會影響心電圖的完整度。在偵測
心電圖的過程中，由於心電圖訊號會含
有多種不相同的雜訊誤差，導致波形呈
現不規則狀外，還會添加許多不屬於正
常心電圖所有的波形，如此一來偵測的
問題也就變得複雜許多，更遑論不明顯
的P波和T波。為解決這個問題，最常使
用的方法就是所謂的濾波，利用濾波器
排除外在的干擾雜訊，並且使得原訊號
中重要的資訊得以保留，同時在高頻訊
號和雜訊之中取得平衡。得到乾淨的波
形後，經由偵測QRS波與切割演算法，
將完整的週期性心電圖訊號傳至下一
階段。 
Data Clustering： 
龐大的心電圖資料樣本是由Beth 
Israel Deaconess Medical Center耗費四
年的時間，集結門診與住院病患的病歷
資料所彙整構成的，其資料的多樣性增
加了我們在辨識時的難度。再者，心電
圖在同一個類別中可能存在較大差異
的訊號，由於分類器本身有其故有的侷
限性，導致這些差異可能無法經由一套
簡單的分類網路學習系統得到良好的
實驗結果。在心律不整的心電圖訊號
中，不同類型信號的特徵向量關係是非
常密切且重疊的，這類高維度非線性的
分類問題，幾乎不可能找到一個理想的
分類器或是演算法來符合所其需求。為
了順利完成任務，我們選擇利用次級分
類演算法來對龐大的心電圖資料樣本
進行分類的動作。因為資料的多樣性，
在相同的病症中還是會保有多種不同
的變化，故本論文使用k-means分群法
來分析並分類，其分析的主要目的在於
標示相關病症中所有相似及相異的特
 32
胸腔阻抗的改變，心電圖會呈現上下起
伏的漂移情況；亦或由於身體狀況的不
穩定，心跳的週期與強度也會有所差
異。基於上述原因，偵測心電圖的QRS
波形位置時，必須使心電圖基於同一單
位的基準上。主要流程如圖60所示。 
 
圖60 偵測峰值 ( R ) 流程圖 
QRS波的位置是每個心跳週期中
最為重要的部份，因為QRS波具有較高
的能量，所以心電圖訊號分割的過程中
必須將QRS波的位置置於每一個週期
的中心點。一般來說，每一段正常心跳
週期中的P波至T波經過時間大約介於
0.5到0.8秒間。典型的心律不整心電圖
資料庫每秒鐘取樣率為360個樣本數，
如MIT-BIH心電圖資料庫。由於大多數
的重要特點是集中於 PQRST波，因此
心電圖識別系統每一段心跳需要至少
192個樣本數，耗費時間大約為0.52秒，
故MIT-BIH心電圖訊號的長度可覆蓋整
個 PQRST波的範圍。 
連續心電圖訊號是由許多的QRS
複合波組合而成，如圖61(a)，並且可能
有雜訊包含於其中。這些雜訊會影響波
形在偵測的準確度，所以利用低通濾波
器加以濾除不需要的雜訊，並設定所需
要的截止頻率以去除訊號中的高頻成
份，結果如圖62(b)。為了判斷訊號與空
間的相關性，我們在通過濾波器後的心
電圖訊號中加上了時間延遲，並映射到
二維空間中，紀錄訊號的空間速率
(Spatial Rate)。空間速率定義為位移後
的訊號速率與原始訊號之間的差異
量，由此差異量可以觀察出訊號對於空
間以及速率的影響。依據上述方法，
QRS偵測流程圖所實驗的結果如圖
62(c)，表示原始和位移之後訊號的差異
量，圖中訊號較明顯突出的部份則是峰
值位置，並且由圖62(c)可以發現，峰值
的位置對映到其原始波形中的R波位置
(圖62(a))為一致，不會受到平移及濾波
的影響。醫護人員在辨識心電圖波形
時，除了QRS複合波形以外，也會參考
比峰值位置較早出現的P波和較晚出現
的T波，這些波形也都值得作為判斷的
準則，所以我們將樣本的切割量設定為
200點，由所偵測的峰值位置取±100為
標準，目的就是為了包含P波及T波等其
他具參考價值的波形。 
265 266 267 268 269 270 271 272 273 274 275
-500
0
500
原訊號 x[n]
265 266 267 268 269 270 271 272 273 274 275
-500
0
500
濾波器輸出訊號 y[n]
265 266 267 268 269 270 271 272 273 274 275
-1000
-500
0
500
1000
Shift Signal
圖61 R波偵測結果 
 
5.3 次級分類演算法 
k-means 分 群 演 算 法 (k-means 
clustering algorithms)能有效的解決分群
的相關問題，是一種最簡單的無監督式
學習演算法，透過簡單的程序及方法，
將給定的向量作為分群的母樣本。
k-means主要的想法是在每一類的群集
中設定一個群集中心(cluster centers)，
 34
基於以上的觀念，我們設計了次級
分類演算法。在分類的階段，其每個子
類的最初數量設定為一類的母樣本。待
分群的樣本透過幾何距離的關係，統計
輸入待分群的樣本與母樣本的幾何距
離，當所輸入的心搏訊號與兩個子類的
母樣本差異大於所設定的門檻值，則將
輸入的心搏作為新一子類的母樣本，成
為一個新的子類的母樣本。次級分類演
算法中我們假設需要分類的樣本數共
有 n  項，分別為 1,..., nx x ，則次級分類
演算法敘述如下： 
1q =     // 子類數量初始設定為 1 
1{ }qT x=     // 將樣本 1x 分配至子類 qT
Repeat  
NewSubclass = False  
For 2i =  to n   //將樣本分配至最接近的子類
 Find 
1
: ( , ) arg min ( , )k i k i jj mT d x T d x T≤ ≤=  
// ( , )i jd x T 表示 ix 與子類 jT 中心點的幾
何距離 
 If ( ( , )i kd x T θ> ) Then   // θ  表示預
先定義的門檻值 
  1q q= +   // 產生新子類 
  { }q iT x=    // 將樣本
加入此一子類中 
  NewSubclass = True 
 Else 
   { }k k iT T x= ∪   // 將樣本  ix 分
配至子類 kT   
  Update the mean vector of the class kT
 Endif 
 EndFor  
Until NewSubclass == False 
我們所提出的次級分類演算法改
進 k–means分群演算法[21]來分割成較
小的類別。該演算法檢查給定的子集合
樣本與每一類之間的距離，如果在一個
類別中的變化比預設的門檻值大，就可
將此類別分為一個或多個次級類別。門
檻值對於各個類的子類可以自動確
定。結果如圖63(b)、圖63(c)及圖63(d)
可以觀察到，在正常心電圖訊號中，經
過次級分類後由於樣本在同一類具有
較高的相似性，有效地彌補了上述分類
的問題。經由上述的演算法，有效的將
MIT-BIH心律不整資料庫自動地分為
42類(如表14)。 
表 14 病症分類統計 
MIT/BIH annotation 
symbol The number of subclass
N 13 
L 3 
R 4 
a 1 
V 7 
F 2 
J 1 
A 4 
E 1 
j 1 
/ 3 
F 2 
Total 42 
 
5.4 心電圖訊號候選特徵擷取 
良好的特徵擷取演算法不僅只對
原來的訊號參數壓縮做處理，還要具備
保留高鑑別度的特徵，接下來根據所分
群的病症資料進行特徵擷取的工作，其
計算特徵值的流程如圖64所示： 
 
圖64 特徵擷取流程圖 
在辨識系統中我們使用六階頻帶
的小波轉換。六階頻帶小波轉換分解如
圖65所示，利用小波的連續性多重解析
度(Multi-Resolution)特性，藉由兩個數
位濾波器產生兩組分解後的小波訊
 36
關係，包括心電圖中週期的關連性、R-R
之間的波形所經歷的時間、波形振幅、
心電圖的週期的一致性、前五筆資料週
期的平均、前後心電圖時間的比值及週
期的正規化共 68 個必需的特徵參數
集，標記為 [68]P ，並完整記錄每一種
類的特徵差異性，如表15。結合上述之
小波轉換係數後特徵共有低頻係數與
高頻係數及特徵參數共446個。 
表 15 特徵參數集 
The Feature Type The Number of Feature Values 
The mean values of the absolute values 
of the coefficients in each sub-band 12 
The maximum values of the absolute 
values of the coefficients in each 
sub-band 
12 
The average energy of the wavelet 
coefficients in each sub-band 12 
The standard deviation of the 
coefficients in each sub-band 12 
The ratio of the absolute mean values 
of adjacent sub-bands 11 
The R-R interval of the beat 1 
The average R-R interval of five last 
beats 1 
The R-R interval ratio between the 
previous beat and next beat 1 
The R-R interval ratio between the 
normal one and the current beat 1 
The ratio of P and R wave 1 
The amplitude of R and S wave 1 
The ratio of the R-R interval and R-S 
interval 1 
The ratio of the R-R interval and P-R 
interval 1 
The distance of R and S wave 1 
Total 68 
 
5.6 適應性特徵擷取系統 
小波擷取係數或是特徵結構常常
用於一些心臟相關疾病的鑑別，但對於
辨識心電圖等疾病並不全然有效
[24][25][26]。事實上，醫療人員診斷心
臟疾病時，只需要觀察兩種或多種症狀
中少數的幾個特定特徵。舉例來說，S-T
區段在心室表面誘導產生明顯 “凹陷”
升高等特徵變化，醫療人員會根據此一
特徵狀況診斷為心囊炎(Pericarditis)。但
是對於 S-T 區段產生明顯 “凹陷”升高
的特徵卻不適用於其他的病理症狀。然
而，增加特徵的數量時，有可能因為是
同類的特徵而造成信任度不足，降低了
辨識率。雖然這只是個簡單的觀念，但
詳細記載這個問題並解決的文獻卻還
沒出現。 
針對上述的問題，最好的解決方式
就是在每個類別中適應性地選擇實用
的超平面。另外，針對支持向量機高維
度特徵映射的特性，我們設計一套特徵
評估演算法，統計每個類別中每一項特
徵維度的平均值。以本論文為例，心電
圖共分為 12 種類型的病症，共分為 42
組次級類別，每一個心搏含有 446 個特
徵向量。特徵評估方程式定義為 49 式： 
2 2 2
, ( ) /(( ) ( ) ), for 1,...446
where 1 , 42, 
k k k k k
m n m n m mv v k
m n m n
ω μ μ= − + =
≤ ≤ ≠
 (49)
其中 kmμ 表維度的平均值，m 代表維度，
k 表示類別。 kmν 則表示變異數。 
演算法首先統計類別之間的差異
值，差異值越大表示兩類之間差別越明
顯。50 式為差異值統計演算式，其中
,
k
m nd 表示平均值相減的平方，k 表示所
屬的特徵維度，m、n 表示受比較的兩
個類別。以本論文為例，共有 42 項次
級 類 別 ， 產 生 的 差 異 量 總 共 有
(42×41)/2=861 個比較值。 
2
, ( ) , for 1,...446
where 1 , 42, 
k k k
m n m nd k
m n m n
μ μ= − =
≤ ≤ ≠
 (50)
下一個步驟是特徵評估值 ω，其意
義代表兩類之間的相似度，若是同類之
間的變異數越小，表示兩類之間的差異
度越小，相對的來說相似性也比較高，
而兩類之間的差異值越大就表示這兩
類相似度非常低。因此，ω值越大，表
示這兩類分開的機率越高，這個特徵相
對的更重要，計算過程如圖 67 所示。 
 38
測試資料經過之前訓練的模型與支援
向量的運算後，即可以再每一個超平面
中判斷出所屬的類別。MIT-BIH 心律不
整資料庫經由次級分類演算法後，12
種病類被分為 42 種子樣本，則在此系
統中則有共 422 861C = 個超平面，藉由投
票機制，這些超平面的投票將決定正確
的類別。經過 861 個超平面的比較後，
累計票數最高的則是系統最後輸出的
辨認結果。經由此投票機制，我們即可
統計出每一類中被辨識錯誤的數量。 
圖71 權重加強之超平面分類示意圖 
文獻至今尚未有相關研究提出完
整的MIT-BIH心律不整資料庫完整使
用的紀錄，大多數已發表的論文中，皆
只用部分樣本來評估其分析的結果。本
論文將是第一份以完整MIT-BIH心律
不整資料庫作為測試樣本的心電圖分
析系統，選擇MIT-BIH心律不整資料庫
採用所有46筆記錄中Lead II部分的數
據作為心電圖心律不整資料庫分析系
統開發和評估的依據。本實驗所使用的
樣本紀錄如表16： 
表 16 MIT-BIH 心律不整資料庫樣本 
100 111 119 203 214 228
101 112 121 205 215 230
103 113 122 207 217 231
105 114 123 208 219 232
106 115 124 209 220 233
107 116 200 210 221 234
108 117 201 212 222  
109 118 202 213 223  
5.9 辨識結果 
支持向量機的設定參考文獻所使
用的參數 C 為 100[27]。根據我們所提
出的特徵擷取演算法，使用適應性特
徵擷取演算法選取有效特徵，經由
k-means 分群法完成次級分類，最後
配合適應性特徵擷取進行支持向量
機的辨識系統，並且我們重複訓練樣
本數較少的類別來平衡每個超平面
的數目。 
為了解重複部份訓練樣本對辨識
系統的影響，其實驗結果記錄於表17，
且各別辨識率皆提升至90%以上。由結
果而言，學習時樣本數量較少的子類經
由改良式的支持向量機，可以彌補其權
重較為不足的缺失，有效的平衡兩類之
間分割的超平面，並且實驗結果觀察
出，辨識系統都能有效的將大多數的特
徵維度降至最低，平均維度以每一類取
1/2作為學習樣本時為最小，平均為
69.31個(表17)，支持向量的平均各數為
26.82個(表19)。 
表 17 實驗結果 
Type of 
Disease
Total of 
Beat 
the 
Learning 
Beats
the 
Testing 
Beats 
the error 
Beats 
Rate 
(%)
N 71673 35837 35836 795 97.78
L 7868 3934 3934 29 99.26
R 7058 3529 3529 19 99.46
a 120 60 60 5 91.67
V 6452 3226 3226 68 97.89
F 762 381 381 22 94.23
J 78 39 39 2 94.87
A 2384 1192 1192 67 94.38
E 100 50 50 2 96.0
j 220 110 110 8 92.73
/ 3504 1752 1752 4 99.77
f 222 111 111 4 96.40
Total 100441 50221 50220 1025 97.96
 
 
 
 
 40
容易地由一般唾手可得的攝影原件來
實現。除此之外，實現色調重現的同
時，對於雜訊問題也能夠處理得非常
好，並且可以維持色彩的恆定性。 
應用區域對比增強於不均勻光源
下之人臉辨識改善了辨識的過程中，常
常受到環境光源改變，使得同一張人臉
會有很大的不同，因而導致人臉的辨識
率大幅下降，並提出了一個有效解決光
源不均勻照射下的影響，由最後的實驗
結果顯示，我們人臉辨識結果的正確率
非常的高，表示我們的系統是很可靠與
所使用的投票機制與SVM辨識核心策
略都是非常正確的。 
利用短時傅立葉轉換及支持向量
機對心音訊號做自動分析及以適應性
特徵擷取是利用切割心音演算法及
SVM分類器去對Texas Heart Institute 
網站的20種類型心音疾病去做辨識，與
之前的差異是原本抽特徵的方法是用
DWT，而現在抽特徵的方法是利用了
STFT和2D-DCT可有效的對切不好的
心音去做辨別，有效切割心臟週期及特
徵的擷取的演算法，交由SVM來做辨
識，最後的實驗心音圖疾病辨識結果可
以達到94.79%，表示我們的系統是可靠
的辨識系統。 
以適應性特徵擷取及改進支持向
量機檢測心電圖心律不整中，使用了次
級分類演算法來改善對於每一類病症
差異度過大的缺點，並且利用適應性特
徵選取演算法達到辨識系統整體降低
計算複雜度的目的，最後則改良支持向
量機中對於數量較少的樣本齊權重較
小的缺失。本系統對於MIT-BIH心律不
整資料庫所提供的心臟疾病的分類，其
正確性可以達到97.96%，是目前相關文
獻中樣本數量最大且疾病最多的實
驗，顯示我們所提出的演算法改善了辨
識率的效能，使系統能夠達到即時
(Real-time)且可靠性高的系統。 
光源不足及高動態範圍影像處理
等系統開發已行之有年，利用心音及心
電圖對於心臟疾病的判斷應用也已經
相當廣泛，有效的結合即時心臟疾病檢
測系統和高動態範圍影像的機器人視
覺及辨識系統，可以對於較為偏遠的地
區或是行動不便的老年人口，輕易的在
家中檢測心電圖訊號，提供較為正確的
診斷以及較為安全的防護工作，提供專
業了醫療人員照護上的協助。 
 
REFERENCE 
[1] E. Reinhard, “Parameter estimation for 
photographic tone reproduction,” Journal of 
Graphics Tools, vol. 7, no. 1, pp. 45-52, 
2002. 
[2] E. Reinhard, M. Stark, P. Shirley, and J. 
Ferwerda, “Photographic tone reproduction 
for digital images,” ACM Trans. on Graphics, 
vol. 21, no. 3, pp. 267-276, 2002. 
[3] W. C. Kao and Y. J. Chen, “Multistage 
bilateral noise filtering and edge detection 
for color image enhancement,” IEEE Trans. 
on Consumer Electronics, vol. 51, no. 4, pp. 
1346-1350, Nov. 2005. 
[4] C. Tomasi and R. Manduchi, “Bilateral 
filtering for gray and color images,” in Proc. 
IEEE Int. conf. Computer Vision, India, Jan. 
1998, pp. 839-846. 
[5] W. C. Kao, “High dynamic range imaging by 
fusing multiple raw images and tone 
reproduction,” IEEE Trans. on Consumer 
Electronics, vol. 54, no. 1, pp. 10-15, Feb. 
2008. 
 42
Algorithm,” in Proc. IEEE Engineering in 
Medicine and Biology Society, vol. 4, Nov. 
1996, pp. 1396-1398. 
[22] T. Stamkopoulos, K. Diamantaras, N. 
Maglaveras, and M. Strintzis, “ECG analysis 
using nonlinear PCA neural networks for 
ischemia detection,” IEEE Trans. Signal 
Processing, vol. 46. no. 11, pp. 3058-3067, 
Nov. 1998. 
[23] N. Sivannarayana and D. C. Reddy, 
“Biorthogonal wavelet transforms for ECG 
parameters estimation,” Medical Engineering 
& Physics, vol. 21, no. 3, pp. 167-174, April 
1999. 
[24] I. Guler and E. Ubeyli, “Feature saliency 
using signal-to-noise ratios in automated 
diagnostic systems developed for ECG 
beats,” Expert Systems with Applications, 
vol. 28, no. 2, pp. 295-304, Feb. 2005. 
[25] I. Guyon, “An Introduction to Variable and 
Feature Selection”, Journal of Machine 
Learning Research, vol. 3, pp. 1157-1182, 
Mar. 2003. 
[26] W. C. Kao, M. C. Hsu, and Y. Y. Yang, 
“Local contrast enhancement and adaptive 
feature extraction for illumination-invariant 
face recognition,” Pattern Recognition, vol. 
43, no. 5, pp. 1736 - 1747, May 2010. 
[27] C. W. Hsu and C. J. Lin, “A comparison of 
methods for multi-class support vector 
machines,” Nat. Taiwan Univ. Taiwan. 
Available: http://www.csie.ntu.edu.tw/~cjlin 
[online]. 
 
 1
 
國科會補助專題研究計畫項下出席國際學術會議心得報告 
                                     日期：99 年 7 月 31 日 
一、參加會議經過 
本人將執行 ｢居家型護理機器人系統設計 - 智慧型即時診斷系統晶片平台設計｣的部份研發成果
投稿至本會議，幸獲大會所接受。此國際會議為 IEEE Circuits and Systems Society 所舉辦的第一
屆有關綠色電路與系統的研討會，並配合世界博覽會於中國上海舉行。 
由於這是第一屆會議，兩位主持人特地邀請在此領域的傑出學者共襄盛舉，因此大多數的 sessions
都是 invited sessions，其論文品質亦高，我所參加的 sessions 亦為其中被邀請的 session。我將
適用於居家型護理機器人系統設計之高動態影像範圍處理技術，發表於本會議。我也參加了許多有趣
的前瞻議題的 session. 與會學者從各種角度提出各種節能與蒐集大自然能量的電子系統，也算是為
此新興領域，開創一個聚集全球知名學者的園地。 
 
計畫編號 NSC 96-2221-E-003 -013 -MY3  
計畫名稱 居家型護理機器人系統設計－子計畫二：智慧型即時診斷系統晶片平
台設計 
出國人員
姓名 高文忠 
服務機構
及職稱 
國立臺灣師範大學應用電子科技學系 
副教授 
會議時間 99年 6月 21日至 23日 會議地點 
中國上海 
會議名稱 
(中文) 
(英文) IEEE International Conference on Green Circuits and Systems 
發表論文
題目 
(中文) 
(英文)  Video recording in high dynamic range scenes 
附件四 
 3
 
 
一、參加會議經過 
此國際會議為 IEEE Consumer Electronics Society 的年度大會，並配合 2010 年國際消費性電
子大展在拉斯維斯舉行，每年研討會吸引世界各地卓越的業界人士與相關學者將其優良的研究成果
發表到此一會議。 
延續以往的嚴格審查標準，本研討會的委員會成員多為業界的主管，所以特別注重實務開發與
實用性，與會論文經過來自業界評審的嚴格審查，包含產業界最新或是最受注目的技術。自加入學
界執行計劃以來，這是我是第三次參加此一國際會議，因為本校應用電子系特別強調實用的電子系
統開發，所以參家本會與其它國家的學者與業界專家分享研究成果，讓我對於產業界的趨勢有一些
新的想法與體悟，也藉以引發新的研發創意與想法。 
 
二、與會心得 
我們所提出新一代的電泳顯示控制器，主要是用根據其內部可調式的對照表來送出適當的時序
控制訊號去驅動面板，此架構可細分成三個主要的操作模式：(1) 從儲存裝置內讀取波形資料，(2) 
當讀取影像資料的時候即時對影像做半色調處理，(3) 產生時序訊號給面板上的資料(Source)以及
開關(Gate)驅動 IC。 
在模式(1)中，電泳顯示控制器從儲存裝置中讀取波形資料並將這些資料寫入到對照表中，驅
計畫編號 NSC 96-2221-E-003 -013 -MY3  
計畫名稱 居家型護理機器人系統設計－子計畫二：智慧型即時診斷系統晶片平
台設計 
出國人員
姓名 高文忠 
服務機構
及職稱 
國立臺灣師範大學應用電子科技學系 
副教授 
會議時間 99 年 1 月 9 日至 13日 會議地點 
拉斯維加斯 
會議名稱 
(中文) 
(英文) IEEE International Conference on Consumer Electronics 
發表論文
題目 
(中文) 
(英文) Design of flexible electrophoretic display controller with reduced 
waveform lookup tables 
國科會補助計畫衍生研發成果推廣資料表
日期:2010/10/29
國科會補助計畫
計畫名稱: 子計畫二：智慧型即時診斷系統晶片平台設計
計畫主持人: 高文忠
計畫編號: 96-2221-E-003-013-MY3 學門領域: 智慧型照護系統
無研發成果推廣資料
其他成果 
(無法以量化表達之成
果如辦理學術活動、獲
得獎項、重要國際合
作、研究成果國際影響
力及其他協助產業技
術發展之具體效益事
項等，請以文字敘述填
列。) 
無 
 成果項目 量化 名稱或內容性質簡述 
測驗工具(含質性與量性) 0  
課程/模組 0  
電腦及網路系統或工具 0  
教材 0  
舉辦之活動/競賽 0  
研討會/工作坊 0  
電子報、網站 0  
科 
教 
處 
計 
畫 
加 
填 
項 
目 計畫成果推廣之參與（閱聽）人數 0  
