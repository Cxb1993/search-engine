 ?   ? 2
??????????????????  
????????????  
Design and Implementation of Multi-Channel Mechanism and Scheduling Protocol for 
Improving Throughput in Bluetooth Radio Networks  
?? ???NSC 94-2213-E-032-012 
?? ???94/08/01 ~ 95/07/31 
? ? ?????  ??????????? 
E-mail: cctas@tcts.seed.net.tw 
   
?????? 
Bluetooth(??)????????????
?????????????????????
??? Bluetooth ?????????????
?????????????????????
? piconet????? Active Bluetooth Devices?
???????? master ????? Active 
slaves????????? piconets ? Mobile 
Device?? bridge???? piconets??????
?????? piconet ????????
scatternet????? bridge???? piconet??
????? Bluetooth device?????????
???? piconet ???????????
scatternet?? 
Bluetooth?????? piconet?scatternet?
?????????????????????
?????????????????????
??? multi-slot packet???????????
?? time-slot leasing ?????????
multi-channel ???????????????
multi-channel ? ? ? Intra-piconet Scheduling 
Protocol ? Inter-piconet Scheduling Protocol??
Intra-piconet? scheduling?????piconet??
Bluetooth device??????????????
???? device pair ????????????
??????????????? buffer???
??????????? polling ??????
Inter-piconet ? scheduling ????????
bridge ??????? piconet ????? bridge
???????? delay time??? packet lost?
?????????? QoS?????????
???????????Bluetooth ????
piconet? scatternet?multi-channel??????
???? multi-slot packet??????????
?????????????????????
????????????????? device 
pair?????piconet? scatternet??????
???????? 
???? Bluetooth ? Piconet ? Scatternet ?
Bridge?Multi-channel?Scheduling 
???? 
Bluetooth  is  a  low cost  and low power  
communicat ion technology that  can be  
appl ied in  e lectr ic  appl iances  and 
computer  per ipheral .  A piconet  consis ts  of  
one master  and a t  most  seven act ive  s laves .  
A Bluetooth  device  that  jo ins  two or  more  
piconets  is  def ined as  br idge,  del iver ing 
messages  among piconets  so  that  the  
resources  or  services  wil l  not  be  res t r ic ted  
due to  the  maximum number  of  act ive  
members  in  a  piconet .  The packet  
t ransmiss ion among piconets  can be  
achieved by their  common re lays .  
This  repor t  proposes  a  one-year  
project  that  mainly a ims a t  providing 
mult i -channel  communicat ion environment  
and developing in tra-piconet  and 
in ter-piconet  schedul ing mechanisms.  
Based on the provided mult i -channel  
environment ,  the  developed in tra-piconet  
schedul ing scheme wil l  enable  mult ip le  
pairs  of  devices  proceeding their  data  
communicat ion s imultaneously,  achieving 
goals  including fa irness ,  non-s tarvat ion,  
h igh ut i l izat ion of  bandwidth ,  eff ic ient  
use  of  buffer ,  maximum throughput  and 
avoiding nul l  pol l ing.  In  addi t ion,  we wil l  
develop an in ter-piconet  schedul ing 
mechanism that  u t i l izes  the mult i -channel  
resource  and proper ly switches  br idge 
among the  par t ic ipated piconets ,  reducing 
the t ransmission delay,  a l leviat ing packet  
los t  phenomenon,  and suppor t ing QoS 
requirement  for  data  t ransmiss ion.  
Based on the  proposed mult i -channel  
environment ,  we expect  the  developed 
in tra-piconet  and in ter-piconet  schedul ing 
mechanisms wil l  eff ic ient ly  u t i l ize  
channel  resources  and dynamical ly 
 ?   ? 4
?????????????????????
????????? 
??????????? piconet scheduling 
? performance???????????????
?????? polling ????? piconet 
scheduling ? performance????? round robin 
? ? ? ? ? ? ? ? ? ? ? ? piconet ?
performance [5][6][7][8][9][10] ? ? ? ? ? ?
time-slot leasing ?????? slave ? master ?
??????? slave ???????????
???? master ?????????? piconet 
? throughput[2][3][4]? 
??????????????????
piconet ??? scheduling protocol??????
piconet ?? master ? slave ?????????
????????????[5][6][7][8][9][10]??
? Bluetooth ?????master ????? 7 ?
active slaves?? master ???????????
slave????[5][7][8][9][10]?????????
? polling schemes???? Bluetooth device ?
buffer ???????master?? slave ????
??master????????????? slave ?
????????????? delay time ???
????????????????????
???? DH5 ???? DH3?DH1 ?????
?? 
?[6]?????????????????
?????????????????????
?????????????????????
?? Packet ??(? DH1 Packet)???????
?????????????????????
Packet ???(? DH5 Packet)????????
??????? 
s1,6
s1,5
s1,3
m1
s1,2
s1,1
s1,4
s1,7
P1
master slave
temp-piconet
 
?(?)? ? Piconet P1 ? ? ? ? time-slot 
leasing(TSL)??? slave-slave??????? 
?????????[2][3][4]??? time-slot 
leasing ?????????? slave ?????
??master???????????? slave??
????? temp-piconet???(?)??????
? piconet ??slave s1,2? slave s1,3??????
????? master m1 ?????slave s1,2? slave 
s1,3 ???? temp-piconet?? temp-piconet ??
????????? piconet ???????
temp-piconet ??slave s1,2? slave s1,3?????
?????? time-slot leasing ???????
master ??? schedule???? static time-slot 
leasing[2]? dynamic time-slot leasing[3][4]??
static time-slot leasing ??master ??????
slave ????????????master ????
????? slot ??????????????
?? slave???? dynamic time-slot leasing??
master ??????? slave ???????
master ??????????????????
?? QoS ??????master ?? schedule ??
??????? slave??? 
??????????????? scheduling 
protocol ????????????? scheduling 
protocol???????? piconet ??????
bridge ? piconet ????????? multi-slot 
packet ???????????? multi-slot 
packet ??????? multi-slot packet ????
???? 
? ? ? ? ? multi-channel ?????
multi-channel ????????? Intra-piconet 
? Inter-piconet ? scheduling ????????
??? Bluetooth ??? Linux ???? time-slot 
leasing?????? scheduling????????
??????????????????? 
 
?? ??????? 
4.1 ?????? 
? ? ? ? ? ? ? ? ? ? ? Efficient 
Multi-channel Schedling Protocol (EMSP) ????
??????? piconet? master?slave? bridge
???????????? bridge? scatternet ?
?????? 
Channel Assignment Window
Schedule Interval
Request Collection Window Data Transmission Window
B CAP
?(?)? EMSP ??Schedule Interval ?????
?? 
??????? piconet ??????
Schedule Interval???(?)????? Schedule 
Interval ???? Request Collection Window?
Channel Assignment Window ? Data Transmisson 
Window?????????????EMSP??
? ? ? Request Collection Phase ? Channel 
Assignment Phase? Data Transmission Phase??
???Window?????? phase? 
A. Intra-Piconet Multi-channel Scheduling Protocol 
 ?   ? 6
????????????(?)(b)???(b1,2, s1,4)
???? bridge queue??(s1,1, m1)?(s1,2, s1,3)?
(s1,6, s1,5)???? non-bridge queue??????
??? weight ???????? device pair ?
priority??? 
01100000000s1,6
00000000s1,5
0000000850s1,4
0000300000s1,3
00013000000s1,2
0000009000s1,1
0000070000m1
00100000000b1,2
s1,6s1,5s1,4s1,3s1,2s1,1m1b1,2
D 
S
BA-Matrix
 
(a)BA-Matrix???? 
s1,2 s1,1
bridge queue
non-bridge queue s1,3 s1,6 s1,5m1
b1,2 s1,4
(b)Device pair??????? priority queue? 
?(?)? Master?? device pair???? 
? Request Collection window ??????
master ? ? BA-Matrix ? bridge queue ? 
non-bridge queue ????????Phase I???
???????? devices????? Phase II?
??? 
Phase II?Channel Assignment Phase 
Phase II ?????? master ???????
???? bridge queue ? non-bridge queue ??
????EMSP??? select algorithm?????
?? device pair????? device pair?????
?????????? select algorithm ????
?piconet???????????????mater
????? bridge queue?? device pair????
?? non-bridge queue?? device pair? 
?? master??? weight ??? device pair?
?????? bridge queue ?? device  pair??
??? priority ????? non-bridge queue ??
device pair??? priority???????? 5-1?
????? 5-5 ????????????
multi-channel?????????? device pair?
?????????????????????
?? priority?5-1?????? 5-5? 5-5Æ5-1?
?? 5-5???? multi-channel????????
? device pair? brige queue? device pair????
???????master??? bridge queue???
device pair???? queue? device pair????
???? device pair???????(b1,2, s1,4)??
master???????????????? device 
pair??? priority???????? priority??
(s1,1, m1)? priority ? 5-5 ???(b1,2, s1,4)???
priority 5-5Æ5-1??? (b1,2, s1,4)?????
priority ?? 5-5?PT(b1,2, s1,4)={(5, 5), (5, 5), (5, 5), 
(5, 5)}? 
master ???(b1,2, s1,4)??????????
master? assign??? time-slot?(b1,2, s1,4)???
?US(m, n) = {us1, us2,…, usu}?? device pair??
???? u ? channel???(?)(a)???UC(b1,2, 
s1,4) = {2, 11, 9, 26, 62, 38, 68, 64}? 
23
44 29 1763 17 5313 32 52 11 9
b1,2↔s1,4
1 3 84 962 70 5 11 1210time slot
hopping 
sequence
14 1513 17 1816 19
26 4231 2820 1835 62
38 45 5419 668 6419 10 1567 24 3
b1,2↔s1,4
25 27 3228 333026 3124 29 35 3634time slot
hopping 
sequence
38 3937 38 3940 4140
46 5127 4934 5312 65
20 21 22
b1,2?s1,4
s1,4?b1,2
b1,2?s1,4
s1,4?b1,2
b1,2?s1,4
s1,4?b1,2
b1,2?s1,4
s1,4?b1,2
43 4442
37 48 55
16 32 25
s1,1?m1
m1?s1,1
s1,1?m1
m1?s1,1
s1,1?m1s1,1↔m1
m1?s1,1
s1,1↔m1
s1,2?s1,3
s1,3?s1,2
s1,2?s1,3 s1,2?s1,3s1,2↔s1,3
s1,2?s1,3s1,2↔s1,3
s1,2?s1,3
(a)??(b1,2, s1,4)?(s1,1, m1)?(s1,2, s1,3)???? 
23
44 29 1763 17 5313 32 52 11 9
b1,2↔s1,4
1 3 84 962 70 5 11 1210time slot
hopping 
sequence
14 1513 17 1816 19
26 4231 2820 1835 62
38 45 5419 66819 10 1567 24 3
b1,2↔s1,4
25 27 3228 333026 3124 29 35 3634time slot
hopping 
sequence
38 3937 38 3940 4140
46 5127 4934 5312 65
20 21 22
b1,2?s1,4
s1,4?b1,2
b1,2?s1,4
s1,4?b1,2
b1,2?s1,4
s1,4?b1,2
b1,2?s1,4
s1,4?b1,2
43 4442
37 48 55
16 32 25
s1,1?m1
m1?s1,1
s1,1?m1
m1?s1,1
s1,1?m1s1,1↔m1
m1?s1,1
s1,1↔m1
s1,2?s1,3
s1,3?s1,2
s1,2?s1,3s1,2↔s1,3
s1,2?s1,3s1,2↔s1,3
s1,2?s1,3
64
s1,2?s1,3
(b)??(s1,2, s1,3)collision???? 
?(?)? Master??????(b1,2, s1,4)?(s1,1, m1)
?(s1,2, s1,3)? 
??master??????active slaves????
????? device pairs??????? master?
?? non-bridge queue ?? device pair ?????
???-???? device pair ?????????
device pair?? 1??? master??? non-bridge 
queue ????? device pair?????? device
?????????? device ????? master
? non-bridge queue?????? device pair??
?????? device pair ????? non-bridge 
queue?????? device pair????????
? master??? non-bridge queue?? device pair
??master ????? non-bridge queue ??
device pair???????(b1,2, s1,4)??????
??????? device pair?master??????
?device pair????non-bridge queue??device 
pair ??????????? temp queue ???
device pair ??? priority ???????
multi-channel ???????? (? )????
temp queue?????(s1,1, m1)?(s1,2, s1,3)? (s1,6, 
s1,5)? 
 ?   ? 8
??? device pairs?????????????
???????? 
23
44 29 1763 17 5313 32 52 11 9
b1,2↔s1,4
1 3 84 962 70 5 11 1210time slot
hopping 
sequence
14 1513 17 1816 19
26 4231 2820 1835 62
38 45 5419 66819 10 1567 24 3
b1,2↔s1,4
25 27 3228 333026 3124 29 35 3634time slot
hopping 
sequence
38 3937 38 3940 4140
46 5127 4934 5312 65
20 21 22
b1,2?s1,4
s1,4?b1,2
b1,2?s1,4
s1,4?b1,2
b1,2?s1,4
s1,4?b1,2
b1,2?s1,4
s1,4?b1,2
43 4442
37 48 55
16 32 25
s1,1?m1
m1?s1,1
s1,1?m1
m1?s1,1
s1,1?m1s1,1↔m1
m1?s1,1
s1,1↔m1
s1,2?s1,3
s1,3?s1,2
s1,2?s1,3 s1,2?s1,3s1,2↔s1,3
s1,2↔s1,3
64
s1,6?s1,5 s1,6?s1,5s1,6↔s1,5
s1,6↔s1,5
s1,2?s1,3 s1,2?s1,3
s1,6?s1,5 s1,6?s1,5
(a) Master?? Rule 2????(s1,6, s1,5)collision?
??? 
23
44 29 1763 17 5313 32 52 11 9
b1,2↔s1,4
1 3 84 962 70 5 11 1210time slot
hopping 
sequence
14 1513 17 1816 19
26 4231 2820 1835 62
38 45 5419 66819 10 1567 24 3
b1,2↔s1,4
25 27 3228 333026 3124 29 35 3634time slot
hopping 
sequence
38 3937 38 3940 4140
46 5127 4934 5312 65
20 21 22
b1,2?s1,4
s1,4?b1,2
b1,2?s1,4
s1,4?b1,2
b1,2?s1,4
s1,4?b1,2
b1,2?s1,4
s1,4?b1,2
43 4442
37 48 55
16 32 25
s1,1?m1
m1?s1,1
s1,1?m1
m1?s1,1
s1,1?m1s1,1↔m1
m1?s1,1
s1,1↔m1
s1,2?s1,3
s1,3?s1,2
s1,2?s1,3 s1,2?s1,3s1,2↔s1,3
s1,2↔s1,3
64
s1,6?s1,5 s1,6?s1,5s1,6↔s1,5
s1,6↔s1,5
s1,2?s1,3 s1,2?s1,3
s1,6?s1,5
s1,6?s1,5
(b) Master??? Rule 1????(s1,6, s1,5)collision
???? 
?(?)? Master ?????? (s1,6, s1,5)????
Rule 2??? Rule 1??????? 
 
B. Inter-Piconet Multi-channel Scheduling Protocol 
? Inter-Piconet Multi-channel Scheduling 
Protocol ????????????????? 
(HTTH)”????? bridge ?????? piconet
? Request Collection Window? Data Transmission 
Window??????? piconet P1? P2????
b1,2? P1? P2? bridge?m1? m2??? P1? P2
?master???? EMSP???? Phase????
??? 
Phase I?Request Collection Phase 
?? Phase ????(?)????? P1 ??
???? b1,2 ???? P1 ? Request Collection 
Window?????? piconet ?? P2? Request 
Collection Window??????b1,2? P1?P2??
?????”?????(HT)”????????
? piconet ? Request Collection Window?? P1
??m1 ?????????? b1,2, s1,1, s1,2,…, 
s1,6??? b1,2 ???????????????
????????bridge ??? request packet ?
?????????? P2 ? Request Collection 
Window?????? bridge ???? P2 ?
Request Collection Window???m2??????
???? s1,1, s1,2,…, s1,6, b1,2?bridge?????
????? b1,2????????? P2? Request 
Collection Window ?????????????
??????????????? 
m1? m2??????? device ??????
? Intra Piconet Multi-channel Scheduling Protocol?
????m2??? bridge queue?? device pair?
??? non-bridge queue?? device pair ?? m1
???????? non-bridge queue ?? device 
pair???? bridge queue?? device pair ???
bridge? P2?Data Transmission Window????
?????P1?Data Transmission Window???
????????  
b1,2
Schedule Interval
Request Collection Window Data Transmission Window
B CAP
Channel Assignment Window
B CAPP2
P1
b1,2 b1,2
b1,2
?(?)? EMSP ????“?????????”?
??????? 
 
Phase II?Channel Assignment Phase 
??Phase????P1?P2?Schedule Interval
???????? P1? P2????? P1?? P2
??? Phase II??? b1,2 ??? P2 ? Request 
Collection Window ?????? P2? Phase I ?
?????? P2? Channel Assignment Window?
?? m2?? Channel Assignment Packet(CAP)??
???? b1,2???? P1? Channel Assignment 
Window????????? master ? bridge ?
channel assignment ?????? Intra-Piconet 
Multi-channel Scheduling Protocol?Phase II???
???? m1??? bridge????? device pair
???Data Transmission Window???????
???b1,2???? P1? Phase II???????
b1,2? P2?? Data Transmission Window????
??????P1?Data Transmission Window??
??? P1?? device??? 
Phase III?Data Transmission Phase 
??? bridge???????? piconet?Data 
Transmission Window?????? piconet???
??? delay time?????P1????P2???
???????(?)???b1,2 ?? Phase ???
?? P1? P2????”?????(TH)”????
????? piconet?Data Transmission Window?
?????b1,2??? Phase II ????????
P2 ? Data Transmission Window???????
 ?   ? 10
?(??)??? HCI ????? Bluetooth chip?
????? 
?(??)?Bluetooth device?????? 
?? slave? slave?????????? slave
?????? piconet???? role switch HCI ?
???????????????piconet ???
? role switch ?????? Create Connection?
Disconnect? Switch Role???? HCI????
????????????????? HCI 
Command?HCI Event?ACL Data??? SOC 
Data??(??)????? piconet? role switch?
??? HCI ?????????? Inquiry?
Create Connection?Data Transfer?Switch Role?
Data Transfer ? Disconnection ????????
?????????????????????
?????????????? 
¾ Write Scan Enable?Slave ?? Inquiry Scan 
Status????? Inquiry ??? Page Scan 
Status? 
¾ Inquiry?Master?? Inquiry Status? 
¾ Create Connection?Master?? Page Status? 
¾ Accept Connection?Master? Slave????
Connection Status? 
¾ Disconnection?Master ?? Standby Status?
Slave?? Inquiry Scan Status? 
Write Scan Enable
Command Complete
Command Status
Inquiry Result
Inquiry Complete
Inquiry
Create Connection
Command Status
Connection Request
Accept Connection
Connection complete Connection Complete
Data
Switch Role
Role changeRole change
Data
Disconnection
Command Status
Disconnection 
Complete
Disconnection 
Complete
Command Status
Computer Computer
Bluetooth 
Chip
Bluetooth 
Chip
Change
Role
?(??)? HCI ?? Create Connection?Switch 
Role? Disconnection???? 
char btdev[IFNAMSIZ] = "bt0" ;  
char* getLocalClassStr() { 
  int err, fd; 
  char* strPtr = NULL; 
  __u32 Class_Of_device; 
  fd = hci_open(btdev);   
if (fd >= 0) {  
    err=HCI_ReadClassOfDevice(fd,&Class_Of_device); 
    hci_close(fd); 
strPtr=getClassString(Class_Of_device);      
} 
return(strPtr); 
} 
char *getLocalAddressStr() { 
int err, fd; 
BD_ADDR bda; 
char buf[20], *strPtr = NULL; 
fd = hci_open(btdev); 
if (fd >= 0) { 
err = HCI_ReadBDAddr(fd, &bda); 
bda2str(buf, &bda);  
hci_close(fd); 
strPtr = strdup(buf);  
} 
return(strPtr); 
} 
 
BD_ADDR getLocalAddressBda() { 
int err, fd; 
BD_ADDR bda; 
fd = HCI_Open(btdev); 
if (fd >= 0) { 
err = HCI_ReadBDAddr(fd, &bda);  
HCI_Close(fd); 
} 
return(bda); 
} 
 
char *getLocalName() { 
int err, fd; 
char name[248], *strPtr=NULL; 
fd = HCI_Open(btdev); 
if (fd >= 0) { 
err = HCI_ReadLocalName(fd, name);  
HCI_Close(fd); 
strPtr = strdup(name); 
} 
return(strPtr); 
} 
 ?   ? 12
?????????????? Inter-piconet 
Multi-channel protocol?????Scatternet???
? bridge?????? bridge ??????
scatternet???? piconets????  
???????????????(??)?
???????? bridge ??????? piconet 
? scheduling ?????????????
Inter-piconet Multi-channel protocol ??????
?? piconet ? bridge??????????
piconets? 
???????????????????
?????????????????? Linux
????????Bluetooth ?????????
??????? Performance Improvement ??
?????????????????????
?????????????????????
?????????????????????
? scheduling protocols? 
?(??)??? bridge???? piconets? 
 
?(??)??? bridge???? piconets? 
 
???????? 
? SCI ?????(?????) 
[1] C. Y. Chang and C. T. Chang, “Hierarchical 
Cellular-Based Management for Mobile Hosts in 
Wireless Ad Hoc Networks,” Computer 
Communications Journal, vol. 24, pp. 1554-1567, 
2001. (SCI) 
[2] C. Y. Chang, C. T. Chang, and S. C. Tu, 
“Obstacle-Free Geocasting Routing Protocol for 
Ad-Hoc Wireless Networks,” in ACM/Baltzer 
Journal of Wireless Networks, vol. 9, pp. 143-155, 
2003. (SCI) 
[3] C. Y. Chang, P. C. Huang, C. T. Chang, and Y. S. 
Chen, “Dynamic Channel Assignment and 
Reassignment for Exploiting Channel Reuse 
Opportunities in Ad Hoc Wireless Networks, ” in 
IEICE Transactions on Communications, vol. 
E86-B, no. 4, pp. 1234-1246, 2003. (SCI) 
[4] C. T. Chang, C. Y. Chang and J. P. Sheu, 
“BlueCube: Constructing a Hypercube Parallel 
Mobile Computing and Communication 
Environment over Bluetooth Radio Systems,” to 
appear in Journal of Parallel and Distributed 
Computing. (SCI) 
 
??????(?????) 
[1] C. Y. Chang and C. T. Chang, “Hierarchical 
Cellular-Based Management for Mobile Hosts in 
Wireless Ad Hoc Networks,” in The IEEE 15th 
International Conference on Information 
Networking (ICOIN), pp. 843-848, Beppu, Japan, 
Jan., 2001. 
[2] C. Y. Chang, C. T. Chang, and T. T. Hsieh, 
“Active Route-Maintenance Protocol for 
Signal-Based Communication Path in Ad Hoc 
Networks,” in The 9th IEEE International 
Conference on Networks(ICON), pp. 843-848, 
Beppu, Japan, Jan. 2001. 
[3] C. Y. Chang, P. C. Huang, C. T. Chang, and Y. S. 
Chen, “Dynamic Channel Assignment and 
Reassignment for Exploiting Channel Reuse 
Opportunities in Ad Hoc Wireless Networks,” in 
The 8th IEEE International Conference on 
Communication Systems (ICCS'2002), Singapore, 
Nov., 2002. 
[4] C. T. Chang, C. Y. Chang, J. P. Sheu, 
“BlueCube:Constructing a Hypercube Parallel 
Computing and Communication Environment over 
Bluetooth Radio System, " in 2003 International 
Conference on Parallel Processing (ICPP2003), 
pp. 447-454, Kaohsiung, Taiwan, Oct., 2003. 
[5] C. T. Chang, C. Y. Chang and J. P. Sheu, “TARP: 
A Traffic-Aware Restructuring Protocol for 
Bluetooth Radio Networks,” The 16th Annual 
IEEE International Symposium on Personal 
Indoor and Mobile Radio Communications 
(PIMRC2005), Berlin, Germany, September, 2005. 
 
?? ????? 
? ? ? ? ? ? ? Piconet Multi-channel 
Scheduling Protocol?????? piconet????
master ???? slot ????? device ????
device???????????????? device 
pairs??????????? device pairs???
