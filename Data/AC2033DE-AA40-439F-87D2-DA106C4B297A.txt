 壹、 前言 
一、背景介紹 
隨著工藝技術的進步，各種組件微小化的程度已達微米,甚至奈米的等級。為因應物
件的微小化，觀察及檢測方式也相應的產生，其中光學檢測有速度快、成本低的優點。
但受限於高倍率顯微鏡的微小景深，微小組件的定位對於光學觀察頗為困難。若能利用
影像處理技術測量物件在空間中六自由度的位移量，進而控制光學系統的位置，維持觀
測物在畫面中正確的 3D 位置，對於生物科技，微機電晶圓製造時所需的微小物件定位、
檢及測裝配技術都是關鍵性的技術。 
二、問題說明 
一般的影像追蹤技術可以藉著觀察連續的影像，推算目標物的平面位移，如位置、
旋轉角度等。但僅靠數位影像，推算目標物的六個自由度位移量則十分困難，尤其是目
標物的物距資訊(即 z 軸方向的自由度)。上述的問題在顯微鏡的場合下，更為困難。因為，
影像追蹤技術是建立在影像清晰可見的條件下。 在僅有數微米景深的顯微鏡下，觀測物
物距的微小改變即可造成目標物偏離對焦平面，產生模糊影像的失焦現象。傳統的自動
對焦技術在速度及精確度上，無法達到同時維持清晰影像與追蹤的要求。本文的目標在:
建立能直接獲得觀測物體的六個自由度位移量的精密影像追蹤關鍵技術。 
三、本文方法 
本研究應用 feature-based 的影像追蹤技術於顯微環境下。基於特徵偵測法 Scale 
Invariant Feature Transform(SIFT)技術，搜尋連續影像中相同特徵點的變化，並以 RANSAC
技術過濾而獲得目標物精確的平面位置、旋轉角度及 Scale 資訊。本文創新之處在:經過
實驗證明:在光學顯微鏡頭下 20 倍景深物距範圍內，影像 Scale 的變化與物距間存在極佳
的線性關係。根據此關係，以 SIFT 技術為基礎，經過 affine transform 計算，可獲得目標
物的六自由度位移量。與運用於一般影像環境下的 SIFT 技術的差異在於，作者針對顯微
環境，提出 SIFT 適應參數法，能即時調整計算中的參數範圍，達到即時計算的速度，以
適應影像易失焦的顯微環境。 
變化的模擬(詳述請參照第參章)，scale 模擬與失焦影像有著相同的原理。再透過本研究
的 SIFT 參數動態適應法，對失焦影像將擁有良好的強健性。 
參、設計原理分析 
影像追蹤的工作原理是在連續的影像中，尋找(計算)具有高對比度的所謂特徵點
(feature points)，以特徵點代表畫面中值得注意的物體。然後比對每幅畫面出現的特徵點，
找出相同特徵點出現的畫面位置，便可以推算物體的位移。計算特徵點的方法雖然繁多，
但多半容易受到光影與相對位置改變，所造成的形狀及尺寸(scale)變化而失誤。現存 
一、特徵轉換-SIFT 
特徵點已成為影像追蹤領域中重要的工具之一。特徵點的優劣足以決定影像追蹤的
成果。SIFT[4]提供豐富的特徵點影像資訊，使特徵點擁有高度獨特性(distinction)，不受
物體旋轉及 Scale 改變的影響，且能部份的忍受形變、雜訊、3D 視角改變及亮度的改變，
以下是 SIFT 特徵偵測法原理的介紹。 
(一)、Scale Space Transform 
Feature-based 影像辨識最常遇到的問題就是攝影機與目標物的物距改變，而引起的
特徵尺寸(Scale)變化，導致無法判斷出不同畫面的同一特徵。為解決上述問題，SIFT 是
預先計算(模擬)影像在不同 Scale 變化時的結果。因為計算所有可能發生的 Scale 變化需
要難以負荷的計算量，所以改用特徵影像與高斯平滑函數(1)式的 convolution 計算(2)式，
以近似尺度變化。而高斯函數的參數 σ，代表尺度值。我們僅模擬某些預設 Scale 變化值
進行估測計算，取代所有 Scale 的變化。 
利用計算Gauss函數的 convolution對影像進行模糊化的處理，而Gauss函數中的 σ值
代表模糊化的程度， σ值越大，表示其計算 convolution 的面積也隨之擴大(越模糊)。為
降低在高σ值時的龐大的運算量，我們透過影像壓縮的方式，以壓縮過的畫面計算 Gauss
函數的 convolution。 
 ( , , ) ( , , )* ( , )L x y G x y I x yσ σ=  (1) 
 
2 2 2-( ) / 2
2
1( , , )
2
x yG x y e σσ πσ
+=  (2) 
在盡量維持固定計算量的前提下，調整影像壓縮的比例，例如在模擬到σ為最初的
兩倍時，採用壓縮為原來一半尺寸的影像。若在原有的二維像素座標，加入 Scale(亦為σ )
成為第三個影像座標的話，則 SIFT 的“Scale Space”將呈現金字塔的形式(圖 1)，因此 Scale 
Space 也稱為高斯金字塔。 
 
圖 3 特徵點抽取 
為使選擇的特徵點座標能準確地代表影像特徵在畫面中的位置。Brown and Lowe[7]
以二次多項式近似 scale-space 中特徵點的 DoG 值的分布，並以泰勒展開式: 
2
2
1ˆ ˆ ˆ ˆ( ) ( )
2
T
T
X X
D DD X X D X X X X
X X
∂ ∂+ = + +∂ ∂  (4) 
近似單一特徵點附近的 DoG 變化。其中 ( , , )Tx y σ=X 是特徵點的位置，而 Xˆ 代表距離特
徵點 X 的位置偏移量(offset)，當 DoG 達到局部最大/小值的 Xˆ 值， Xˆ 可自下式獲得: 
 12
2
0
ˆ -
D
X
D DX
X X
−
∂ =∂
∂ ∂= ∂ ∂
 (5) 
理論上，我們可以獲得解析度高於 1 個像素(sub-pixel)的特徵點位置。而求出的最佳特徵
點偏移向量 Xˆ 為最佳化結果(5)式代入公式(4)式，可以得到對應的局部最大或最小值
ˆ( )D X X+ : 
 1ˆ ˆ( ) ( )
2
TDD X X D X X
X
∂+ = + ∂  (6) 
因為 ˆ( )D X X+ 值與局部影像特徵的對比度成正比，我們可以根據 ˆ( )D X X+ 值，剔除對
比度過低的特徵點，以提高所得特徵點的重現性。除剔除低對比度的特徵點之外，還需
要排除位於輪廓邊緣的特徵點。因為在輪廓邊緣的影像特徵相似度較高，若納入特徵點
容易誤判，而且易受照明改變及雜訊影響。我們使用 DoG(x, y, σ)分佈函數的 Hessian 
matrix 矩陣 H:  
 xx xy
xy yy
D D
H
D D
⎡ ⎤= ⎢ ⎥⎣ ⎦
 (7) 
判斷特徵點為邊緣點的方法是以 Hessian matrix 的兩特徵值 α及 β比值 r 為依據。因兩者
特徵點 
Difference of Gaussian (DoG)
增 
加 
σ
 圖 4 Orientation assignment 
在實際的應用中可將輔助方向視成一獨立特徵點，而賦予該位置兩個特徵點。其目
的是避免特徵點在主方向強度不足時，易受照明等影響，致使輔助方向成為主方向，而
造成特徵點錯誤或無法匹配。 
影像描述(descriptor)的用途是在連續的影像中，根據 descriptor 找出相同的特徵影
像，進而辨識各畫面中相同物體的各種變化。SIFT 所賦予的特徵點 descriptor 是以簡短
的方式代表特徵影像，降低篩選相同特徵的計算量，使電腦程式僅需比對代表兩個特徵
點少量的 descriptor 內容，即可判斷特徵點間的相似度。 
SIFT 的 descriptor 計算方式是紀錄特徵點附近各像素點在 Scale Space 中的梯度向
量，為消除旋轉所造成的影像差異，藉由特徵點 orientation assignment，將各點的梯度向
量皆旋轉至該特徵點主方向上，再根據各像素點與特徵點的相對位置記錄下來。示意圖
如圖 5 所示。梯度向量分佈中心點為該特徵點位置。 
 
圖 5 Descriptor 示意圖 
對特徵點附近的梯度分佈(圖 5)根據梯度方向，合併成一個 8 方向的向量集合，同
時根據該點與特徵點的相對位置，合併至 2x2=4 個獨立空間中(如圖 5 最右邊)，所以共
2*2*8=32 個特徵點描述向量用以描述該特徵點，即為該特徵點的 descriptor。 
實際上，因為 32 個分量的描述向量獨特性不足，SIFT 作者 Lowe 建議計算特徵點附
特徵點主方向 特徵點主方向
Descriptor 
0
5
10
15
20
25
1 2 3 4 5 6 7 8
1
M
ag
ni
tu
de
 
Orientation
特徵點
統計各點梯度
方向及大小 
Scale Space L(x, y) 
 i
i
min(E ) <  0.6
submin(E )
 (15) 
若滿足(15)式則 1a 的匹配點為 min( 1E )所代表的b 點。例如， 1 1,9min(E ) = e ，則 1a 與 9b
互為匹配點；若不滿足，則 1a 無匹配點。至此已完成 1a 的 matching，接著以 2a 為主，重
複與 1a 相同的步驟，找出 2a 的匹配點，接著 3a 、 4a 、 5a 、…直至所有的特徵點皆計算過，
便完成影像 A 與影像 B 的 matching。 
三、物件辨識 
在任意環境中尋找特定物件影像，並獲得物件位置、姿態等資訊，即為物件辨識。
舉例:目標物件影像令為影像 A，欲在影像 B 中尋找目標物件(影像 A)，首先，將影像 A
與影像 B 做特徵點 matching，matching 結果如圖 6 所示。 
影像A 影像B  
圖 6 matching 範例 
由 matching 結果可以看到目標物件上的特徵點與追蹤環境(影像 B)中相類似的特徵
點已做匹配(連線)，經由連線已能看出在追蹤環境中目標物件的大致位置。而實際的物
件辨識資訊可由 affine transform 參數來獲得。 
(一)、Affine transform 
Affine transform 是在座標系統中一種座標轉換方法。而轉換前與轉換後兩組座標之
間的關係(如位移、旋轉、Scale 等)是由 Affine transform 參數所決定，(16)式為轉換前與
轉換後的座標集合，(17)式為 Affine transform 的計算式，並進一步表達成(18)式。 
 
1 2 3
1 2 3
1 2 3
1 2 3
x x xX
=
y y yY
u u uU
=
v v vV
⎡ ⎤⎡ ⎤ ⎢ ⎥⎢ ⎥⎣ ⎦ ⎣ ⎦
⎡ ⎤⎡ ⎤ ⎢ ⎥⎢ ⎥⎣ ⎦ ⎣ ⎦
…
…
…
…
 (16) 
 
cos sin
sin cos
x y x
x y y
U S S X t
V S S Y t
θ θ
θ θ
−⎡ ⎤ ⎡ ⎤ ⎡ ⎤ ⎡ ⎤= +⎢ ⎥ ⎢ ⎥ ⎢ ⎥ ⎢ ⎥⎣ ⎦ ⎣ ⎦ ⎣ ⎦ ⎣ ⎦  (17) 
 圖 8 RANSAC 示意圖 
若 A’、B’、C’三組皆為正確的 match 點，所求得的轉換矩陣可使其他正確的 match
點轉換至各自匹配的位置上。未重疊的點可視為錯誤的匹配點。稱重疊的點為 Inliers，
未重疊的點為 Outliers。當 Inliers 為最大時，可視其轉換矩陣的正確率最高。RANSAC
以不斷的隨機選取三個匹配點計算轉換矩陣與 Inliers。Inliers 最多的轉換矩陣即視為最佳
解。假設每次隨機選取 s 個樣本點(此例 s = 3)；重複選取計算 k 次；而每點為 Inliers 的
機率為 p，且計算 k 次後得到正確轉移矩陣的機率為 P(例如 P=0.99)，統計公式為(22)式。 
 s kP = 1 - (1 - p )  (22) 
其中 k 值即所須計算的次數。將(22)式整理一下，可得 k 值大小。如(23)式所示。 
 s
log(1 - P)k = 
log(1 - p )
 (23) 
四、3D 追蹤 
本章說明如何從影像的 Scale 資訊，計算顯微鏡物距的方法，以及設計 SIFT 參數達
到能忍受高失焦度及即時 3D 追蹤的方法 
(一)、物距與 Scale 
顯微鏡是由透鏡組所構成，根據幾何光學原理，凸透鏡的光學成像原理 f 為凸透鏡
的焦距、u 為物距、v 為像距。原理可由(24)式的成像公式得知。 
 1 1 1+ =
u v f
 (24) 
由(25)式中顯示，成像的大小是由物距及像距所決定的，因此根據幾何光學公式，凸透
鏡成像的放大率為 
 v=  
u
放大率  (25) 
A’ 
B’
Inliers
C’
錯誤的match
 
圖 10 Scale 實驗結果 
實驗結果顯示先前的假設是成立的。藉由其線性關係可將 Scale 資訊精確的轉換成
目標物的物距資訊。 
(二)、SIFT 參數動態適應法 
所謂的“失焦”(defocus)是指固定像距的顯微鏡下，當觀測物的物距偏離對焦平面所
產生的影像模糊現象。現存的 SIFT 特徵偵測法是針對在一般室內及戶外環境下,具有大
幅度物距變化的清晰影像而設計。無法適用於失焦的影像。本文提出一套 SIFT 參數動態
適應法，使 SIFT 特徵偵測法能適用於顯微環境中。該法能自動地依當時的情況隨時調整
SIFT 參數，使它在任何情況下都能穩定且精確的抽取出特徵點。 
因為實際的追蹤時無法預知物體的 Scale 變化範圍，所以 SIFT 對影像做各種 Scale
變化的模擬。但由 3.1 節實驗的結果中得知，在顯微鏡下物體的 Scale 變化範圍非常小。
圖 11 為 Scale 變化模擬時的高斯金字塔(Scale Space)，並加上模擬的 Scale 範圍。 
物距 μm
放大率
 
-50 -40 -30 -20 -10 0 10 20 30 40 500.99
0.995
1
1.005
1.01
中仍能穩定出現“相對”較高對比度的特徵點。圖 13 為相同失焦影像對比度門檻值影像測
試結果。 
 
圖 13 對比度門檻值對失焦影像的影響 
综合上述各點可得一結論:  
1. 目標物影像清晰時: 
z 計算 Scale Space 第一層模擬 
z 增加起始σ值及對比度門檻值 
2. 目標物影像模糊時: 
z 提高 Scale Space 的模擬層數 
z 降低起始σ值及對比度門檻值 
SIFT 參數動態適應法能在不影響精確度的情況，提高系統效率及失焦情況下的強健性。 
肆、軟硬體系統 
實驗設備共分為三個部份: 硬體設備、軟體部分、測試元件。 
一、硬體設備說明: 
A. Z 軸 Mitsubishi AC Servo 馬達 (精度 1 mμ ) 
B. Sony XC-73 黑白 CCD: 有效像素:  768(H) x 494(V)， 感光元件尺寸: 6.00mm(H) 
x 4.96mm(V) 
C. Nikon CFI 10X 光學鏡頭 Nikon CFI PLAN ACHROMAT 
光學物鏡 Working 
Distance 
Objective 
Magnification
Numerical
Aperture
Resolving Power 
Depth of 
Focus 
10X 10.50 mm 10X 0.25 1.10μm  4.40μm  
原始對比度門檻值 降低對比度門檻值 
伍、研究成果 
實驗的基本方法是以 Mechonics MX25(XYZ Positioner)壓電平台控制目標物:陶瓷電
容在空間實際的路徑。而 Z 軸 Servo 馬達及壓電顯微物鏡 translatorMIPOS 100 改變物鏡
位置。在實驗的過程中,我們任意地改變平台的 3D 位置,經由影像追蹤的計算獲得陶瓷電
容的 3D 移動距離控制壓電 translator MIPOS 100 即時移動以維持兩者固定的物距，及維
持清晰的影像。 
圖 17 為 3D 影像追蹤的硬體示意圖。以陶瓷電容的部份影像作為目標，在追蹤環
境中尋找與目標相同的影像範圍。 
圖 18 展示在失焦情況下目標與追蹤環境的特徵點 matching 結果並進一步框出正確
的目標範圍(方框)，方框內的影像與目標影像相同。而且圖中不論影像是否清晰，皆能
準確的追蹤到目標位置。即使物體偏離對焦點達 30 倍的景深，仍能有效的追蹤目標。 
第二個實驗是定位準確度實驗。僅改變陶瓷電容的物距進行追蹤。控制 z軸AC Servo
馬達改變電容的物距，影像追蹤法計算物距的變化量,直接控制 MIPOS 100 z 軸位移平
台，追蹤結果如圖 19 所示。 
   
圖 17 實驗示意圖(左圖為電容位移的控制方式，右圖為影像追蹤驅動壓電 translator,維持物距.) 
 
Piezo drive XYZ translation
Servo Motor
Z translation
Light Source MIPOS 100 
Depth tracking
650 700 750
800 850400
500
600
0
20
40
60
80
100  
x軸(μm)
 
y軸(μm)
z軸
 (
深
度
μ m
)
陶瓷電容路徑
3D追蹤路徑
 
圖 20 3D 追蹤–立體視角 
660 680 700 720 740 760 780 800 820 840
420
440
460
480
500
520
540
560
580
600  
x軸(μm)
 
y軸
(μ
m)
陶瓷電容路徑
3D追蹤路徑
 
圖 21 3D 追蹤–XY 平面 
 
圖 22 3D 追蹤–XZ 平面 
無論從任何方向觀察追蹤結果，陶瓷電容的路徑與 3D 追蹤的路徑皆吻合。此點顯
示: 所提的 3D 追蹤法能夠以接近即時的速度, 在顯微鏡下準確地求出目標物在空間中的
660 680 700 720 740 760 780 800 820 840
0
10
20
30
40
50
60
70
80
90
100  
x軸(μm)
 
z軸
 (
深
度
μ m
)
陶瓷電容路徑
3D追蹤路徑
