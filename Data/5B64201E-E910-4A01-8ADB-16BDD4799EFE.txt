 2
弦分量投影信號，如此可得出 n 階次電壓與電流諧波分
量的瞬時電壓和電流的均方根值，如(7)和(8)示。 
 
( ) ( ), , sin( )=n n t v,ns n rms +1V θ = V θ V θ θ2    (3) 
( ) ( ), , sin( )=n t v,nn s n rms i,n+1I θ = I θ I θ θ +θ2     (4) 
( )' , ,sin cos( )⎛ ⎞⎜ ⎟⎝ ⎠π =n v,n t v,nn rms t n rms +V θ =V θ +θ + V θ θ2   (5) 
( )' , sin ⎛ ⎞⎜ ⎟⎝ ⎠πn v,nn rms t i,nI θ = I θ +θ +θ + 2   
    
, cos( )= t v,nn rms i,n+I θ θ +θ                  (6) 
( ) ( ) 122 2', ⎡ ⎤⎢ ⎥⎣ ⎦+n nn rmsV = V θ V θ          (7) 
( ) ( ) 122 2', ⎡ ⎤⎢ ⎥⎣ ⎦+n nn rmsI = I θ I θ          (8) 
 
進一步由簡單的計算得到各級電壓與電流諧波分
量實功率和虛功率，如(9)和(10)。由均方根電壓和電流
值的量測結果或由實功率及虛功率的運算可得到複數
功率，如(11)所示。 
 
( ) ( ) ( ) ( )' '⎡ ⎤⎣ ⎦⋅ + ⋅n n n n nP = V θ I θ V θ I θ             (9) 
    ( ) ( ) ( ) ( )' '⎡ ⎤⎣ ⎦⋅ − ⋅n n n n nQ = V θ I θ V θ I θ            (10) 
2 2
,⋅ = +n n nn,rms n rmsS =V I P Q         (11) 
 
2.2 各級電壓與電流諧波分量之濾出與餘弦函數之取得 
 
由於前述各階次諧波之有效值與各式功率計算
式，均使用正弦與餘弦函數計算，因此接下來將討論輸
入訊號各階諧波正弦與餘弦函數之取得。若電壓與電流
訊號以(12)示，可由離散式傅立葉濾波器取得各次諧波
訊號的正弦與餘弦分量，如(13)與(14)示，即可完成各
級電壓與電流諧波分量之濾出與餘弦函數之取得。因
此，前述的各級諧波與基本波電力參數即可由後續計算
得到。 
 
( ) ( )0
1
sin cos
∞
=
= + ω + ω∑ n n
n
y t a a n t b n t      (12) 
1
,
0
2 2sin
−
=
⎛ ⎞⎜ ⎟⎝ ⎠
π= ∑Nn k k
k
a y nk
N N
           (13) 
1
,
0
2 2cos
−
=
⎛ ⎞⎜ ⎟⎝ ⎠
π= ∑Nn k k
k
b y nk
N N
              (14) 
其中: 
 n=1,2,…諧波階次, fs=取樣頻率, yk=輸入訊號序列, 
   k=取樣順序, f=基本波頻率, N=fs/f=取樣率。 
 
以基頻的正、餘弦分量 a1,k 與 b1,k 的分離為例，假
設一週期取樣 90 點，可將正弦與餘弦分量表成(15)與
(16)，進一步以矩陣表示成(17)。以移動性視窗方法可
將(17)作運算，視窗每移動一步只需加入一個新的取樣
點，並將最舊的取樣點移除即可，如此可將運算量大幅
減少。高次諧波分量可以相同方法計算得到所需的正弦
與餘弦分量，諧波電力參數即可由後續計算得到。 
 
89
1,
0
1 sin
45 45=
⎛ ⎞⎜ ⎟⎝ ⎠
π= ∑k k
k
a y k         (15) 
89
1,
0
1 cos
45 45=
⎛ ⎞⎜ ⎟⎝ ⎠
π= ∑k k
k
b y k         (16) 
 
0
1
89
1, 89
1, 89
2 89*2sin(0) sin( ) sin( )1 90 90  
45 2 89*2cos(0) cos( ) cos( )
90 90
=
=
=
=
=
⎡ ⎤⎡ ⎤ ⎢ ⎥⎢ ⎥⎡ ⎤ ⎢ ⎥⎢ ⎥⎢ ⎥ ⎢ ⎥⎢ ⎥⎢ ⎥⎣ ⎦ ⎢ ⎥⎢ ⎥⎣ ⎦ ⎢ ⎥⎣ ⎦
π π
= π π
k
k
k
k
k
y
a y
b
y
"
#"
           
                                           (17) 
 
接著介紹以移動性視窗的概念為基礎，推導一適合
即時諧波計算之演算法。以基頻為例的正弦分量離散化
方程組如(18)所示。 
 
   
1 0 1 89
89( ) sin(0) sin ..... sin
45 45
a k y y yπ π= + + +          
   
1 1 2 90
89( 1) sin(0) sin ..... sin
45 45
a k y y yπ π+ = + + +     
   
1 2 3 91
89( 2) sin(0) sin ..... sin
45 45
a k y y yπ π+ = + + +        
     (18) 
將(18)中 1( 1)+a k 項同乘 45cos
π 整理後可得(19)。 
 
1 1 2 89
1 2 89( 1) cos sin sin ..... sin
45 2 45 45 45
a k y y y⎡ ⎤⎢ ⎥⎣ ⎦
π π π π+ ⋅ = + + +           
        ( )2 3 89 11 89sin 0 sin ..... sin2 45 45y y y +⎡ ⎤⎢ ⎥⎣ ⎦
π π+ + + +  
        
89 2 1
89 1sin sin
45 2 45
y y+
π π− −             
    (19) 
 
將方程組(18)代入(19)可得(20)，其中 N 為一視窗
取樣點數，T 為視窗取樣週期。 
 
 ( ) ( ) ( )1 1 1 1 ( 1)2 22 2 1 sin ( )sin+π π+ = ⋅ + ⋅ − + − NTa k a k a k y yN N            
                              (20) 
 同理，以基頻為例的餘弦分量離散化方程組如(21)
所示。 
 
   
1 0 1 89
89( ) cos(0) cos ..... cos
45 45
b k y y yπ π= + + +           
   
1 1 2 90
89( 1) cos(0) cos ..... cos
45 45
b k y y yπ π+ = + + +           
   
1 2 3 91
89( 2) cos(0) cos ..... cos
45 45
b k y y yπ π+ = + + +        
                                           (21) 
將(21)中 1( 1)+b k 項同乘 45cos
π 整理後可得(22)。 
 
1 1 2 89
1 2 89( 1) cos cos cos ..... cos
45 2 45 45 45
b k y y y⎡ ⎤⎢ ⎥⎣ ⎦
π π π π+ ⋅ = + + +          
            ( )2 3 89 11 89cos 0 cos ..... cos2 45 45y y y +⎡ ⎤⎢ ⎥⎣ ⎦
π π+ + + +  
        
89 1 89 1
1 89 1 1cos cos
2 45 2 45 2
y y y ++π π− +     
(22) 
將方程組(21)代入(22)可得通式(23)。  
 4
 
(a) 七次諧波電壓及電流有效值。 
 
(b) 七次諧波的各式功率。 
圖 4 七次諧波電力參數量測模擬結果。 
 
 
四、實作驗證 
 
本計畫採用德州儀器 (TI)公司的單晶片型 DSP 
TMS320F2812A 作為核心計算器，以實現本文所提出的
電力參數偵測器之硬體實現。由於 TMS320F2812A 具
有高速的定點運算能力，非常適合運用於需要大量計算
與快速響應之各式工業控制器。在實測驗證中，使用可
程式型訊號產生器，以輸出具步階變化的諧波電壓與電
流訊號作測試，如此可確認其實測精確度與響應速度。 
在本計畫中傅立葉濾波器每週期取樣為 90 點，因
此取樣頻率為 5.4kHz。因實際電力系統之基頻頻率有
漂移現象，會影響高次諧波計算之正確性，因此採用
Timer 中斷的方式設定系統取樣頻率，首先偵測輸入訊
號之基頻頻率，再根據頻率的變化隨時作取樣頻率之微
調 ， 將 基 頻 頻 率 漂 移 的 影 響 降 至 最 低 。 由 於
TMS320F2812A 屬於定點型算術 DSP，因此在偵測程
式中一律宣告使用定點運算，而在最後計算完成時，再
將結果轉變為浮點數，以避免因使用過多的浮點運算指
令，給 DSP 造成額外的計算負擔。 
圖 5 為實現的偵測器對基頻電力參數的量測結
果，圖 5(a)、(b)為電壓與電流訊號及其分離出之正弦與
餘弦成份。由圖 5(c)可發現基頻變動發生於 0.033 秒
時，其電壓與電流有效值在 0.05 秒時即到達穩定，與
模擬之響應特性相符。基頻各式功率的量測結果，如圖
5(d)所示，與基頻電壓電流有效值相同，約在 0.0167 秒
後同時收斂至穩定狀態。 
 
 
 
(a) 電壓訊號及濾出之基頻電壓波形。 
 
 
 (b) 電流訊號及濾出之基頻電流波形。 
 
 
 (c) 基頻電壓及電流有效值。 
 
 
 (d) 基頻成份之各式功率。 
圖 5 基頻分量電力參數量測結果。 
 
圖 6(a)與圖 6(b)為五次諧波電壓、電流有效值與各
式功率參數的實際量測結果，圖 6(c)與圖 6(d)為七次諧
波電壓、電流有效值與各式功率參數量測結果。由圖中
可發現，五次與七次諧波成份於 0.033 秒時發生變化，
大約在 0.05 的時後便已收歛，其響應速度約為 0.0167
秒，與模擬結果相符。另外，比較圖 5 與圖 6 實測結果
中可發現，偵測高階次諧波時，當諧波成份變動時，其
收斂過程的震盪幅度較低次諧波大，越高次諧波越為明
顯。這是由於使用傅立葉濾波器在一個週期計算完成
前，無法將低次諧波完全濾除，因此計算越高次諧波
時，在收斂過程中的振盪幅度則越大，此現象可由設計
一個適合的濾波器克服。 
 
 
 (a) 五次諧波電壓及電流成份的有效值。 
 
 
 (b) 五次諧波成份之各式功率。 
