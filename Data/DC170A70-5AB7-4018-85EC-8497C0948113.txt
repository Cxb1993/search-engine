2行政院國家科學委員會專題研究計畫期末報告
模糊控制器應用於 PC-Based車用故障診斷系統之設計與製作
The Design and Manufacture of PC-Based Automotive Fault Diagnostic
System by Using Fuzzy Logic Control
計畫編號：NSC94-2213-E-150-034
執行期限：94 年 8 月 1 日至 95 年 7 月 31 日
主持人：褚文和 國立虎尾科技大學車輛工程系
4儀表板產生故障燈號，或是當維修人員使用診斷儀器與
引擎電腦連線後，顯示出感知器狀態的故障碼，讓車主
或是維修人員去檢查故障碼所代表的感知器，查出正確
的故障來源，進行維修作業。因此，引擎電子裝置所延
伸的效益，除了有更好的廢氣排放控制及引擎馬力的最
佳輸出控制外，更重要的是具有引擎故障輔助診斷的功
能，可以讓車主更完整的掌握車輛性能，對於維修人員
而言，更是一個不可或缺的好幫手。
近年來，由於環保意識抬頭及能源價格居高不下，
使得汽車電子及控制系統蓬勃的發展，尤其是在引擎的
控制系統、診斷系統等方面，國內外學者也提出很多相
關的研究。
有關引擎故障診斷方面，在 1994 年 Minghui Kao [1]
等人使用非線性觀測器來偵測引擎運轉時是否有失火
(MissFire)的現象，方法是使用壓力感知器直接偵測引擎
氣缸內的壓力狀態，主要是應用引擎氣缸中正常燃燒與
異常燃燒的壓力差異，進行偵測與判斷。1995 年 E.G.
Laukonen [2] 等人針對引擎作動器及感知器來作偵
測，並使用模糊理論之模糊識辨別 (fuzzy identification)
系統，尋找引擎作動器及感知器的故障源；另外，Janos
Gertler [3]等人使用偵測引擎排放廢氣時壓力之變化，在
排氣管裝置壓力感知器，偵測引擎的運轉狀態，並使用
模糊理論之資料庫診斷方式，來診斷引擎的故障問題。
1995 年，Ching Yu Tyan [4]等人，亦利用模糊理論應用
在磁浮列車上，偵測磁浮列車行駛中的系統狀態，可針
對故障狀態進行反映與修正，以維持列車的行駛安全。
1999 年，Fengzhi Dai [5]等人是利用模糊理論，來診斷
引擎故障狀態，以此建構的模糊關係矩陣表，作為故障
判斷準則，以判斷引擎系統的故障來源，此稱之為模糊
故障詢問法。
至於國內相關的研究，包括有 2001 年陳聖洲[6]，
以模糊理論的模糊法則庫所建構的語意法則，來推論引
擎的噴油嘴及含氧感知器的作動狀態，他主要以模糊理
論為其基本架構，並以類神經網路來做自我學習，以提
高系統的準確性。在 2003 年，張志瑋[7]利用頻譜分析
儀去測量引擎運轉時所產生的振動及噪音，再使用類神
經網路來研判引擎的噴油嘴與火星塞的故障狀態；鄭國
璽[8]則使用失效樹分析法的邏輯判斷，去自動偵測列車
的系統故障。
而本文主要目的則是在發展智慧型車用電腦診斷系
統，此系統是由 OBD II 通訊介面及智慧型故障診斷程
式組成，藉由模糊理論建構的智慧型診斷系統，進行故
障診斷。以下就人機介面的建構與結果進行說明之。
三、 研究方法與討論
本研究使用 Visual C++ 6.0 軟體來建構智慧型車用
電腦診斷系統。系統分成三大部分，包括診斷系統與引
擎電腦間之連線系統，此部分主要是要用來與引擎電腦
做連線初始化，並且偵測引擎故障碼或是引擎運轉的動
態數據；第二部分則是引擎故障診斷系統，此一部份是
要用來診斷引擎發生無法正常輸出動力時，找出可能的
故障源。而這一部份所需要的參數都是由連線系統所叫
出的引擎運轉動態數據提供。最後一部份是把車輛修護
手冊裡的維護步驟及步驟圖示建構在裡面的修護系
統，這部份是提供維修人員在找出引擎故障點後，維修
此一故障時所需要的步驟及正確的引擎系統運轉動態
數據。
(一) 連線系統
此部分依照車輛 OBD II(On-Board Diagnostic)所採
用 OSI 模型的七層網路通訊協定[9]，來設定程式內部傳
送的參數、延遲時間等等。OSI 模型分別是為應用層
(Application Layer)、表達層(Presentation Layer)、會議層
(Session Layer)、傳輸層 (Transport Layer)、網路層
(Network Layer)、資料鏈結層(Data Link Layer)、實體層
(Physical Layer)。每一層都有各自的功用，但是由於
OBD II 所要傳送的資料訊息並不需要如此複雜的架
構，所以只使用 OSI 模型之中的其中三層架構，分別是
為：實體層及資料鏈結層是依據 ISO 9141 及 9141-2 的
規範；應用層是依據 SAE-J1979 的規範。
連線的第一步驟為連線初始化，連線初始化是依據
ISO 9141 及 9141-2 兩種通訊協定的規範來設定相關參
數。程式中需設定的相關參數有傳送與接收的鮑率(baud
rate)、Byte 的資料及每一 Byte 之間的延遲時間(ms)，如
圖 1 所示。箭頭方向代表傳送或接收，W0~W5 及 P3 延
遲時間，16 進位的數字是為 Byte 的資料，英文字串為
訊息描述。通訊協定同時也規範數位訊號的邏輯準位、
6可以更改的，這樣才有辦法提高故障診斷的準確性。
6. 進行故障診斷，計算每一個故障源是為故障的機率
大小。
至於演算法部分，首先假設一個傳統的故障源
iA ，
去取得一個符合故障現象的式子  pj XXXX ,,, 210  。
其次，給予每個故障現象一個權重 i（一個合理的權
重，或是一個正確的而且被診斷過的故障源），定義 0
iA
P
為符合所有故障現象 iX 的權重總和，亦即



P
r
rrA xP i
1
0  (4)
其中每一  prxr ,,2,11  。在所有的故障源 iA 中， r
是 rx 的權重大小。
接 著 ， 我 們 對 故 障 現 象 做 一 定 義 ， 例 如
 qj XXXX  ,,, 21  ，而 iAP 則為符合單一故障現象 iX
或是符合多組故障現象
iX 的權重總和



q
r
rrA xP i
1
 (5)
上式中，假如
jr xx  ，則 1rx ，表示檢測出故障狀態；
若
jr xx  ，則 0rx ，代表檢測結果正常。此外，如
 pj XXXX ,,, 210  時 ，  qrxr ,,2,11  ， 則
rr   且 0rx 。
接著，我們針對故障現象  qj XXXX  ,,, 21  ，計算每
個故障源對於所有故障現象的可能性
  0
i
i
i
A
A
jA
P
P
X  (6)
這個方法最主要的工作是建構系統故障樹，將故障
源與故障現象作合理的分類，如此我們便能整理出 0
jX
與
iA 之間關係的資料庫，然後能快速又準確的診斷出故
障。
(三) 診斷程式系統架構
本研究設計完成的智慧型車用電腦診斷系統架構如
圖 4 所示，分為基本連線、引擎動態數據偵測、故障碼
偵測及消除故障碼四大部分。OBD II 通訊介面在與引擎
電腦完成連線初始化後，由基本連線來維持兩端連線狀
態；引擎動態數據偵測則是偵測引擎各感知器的操作數
據；故障碼偵測與消除故障碼主要功能則是顯示引擎各
感知器故障時的故障代碼，及消除引擎電腦中儲存的故
障代碼。
(四) 研究結果
依前述方式建構完成的智慧型 OBD II 診斷系統，可
以順利與特定 TOYOTA Corolla 引擎電腦做初始化連
線，並且可以完成訊號量測。依使用者之設定需求，包
括引擎動態數據等，分別顯示在個人電腦的視窗上，如
圖 5 所示。這些連線後所讀取的數據，亦可以圖型方式
顯示。
而在故障診斷功能方面，以模糊理論所建構的智慧
型車用電腦診斷系統，是以引擎電腦故障碼為輸入的參
數，來計算出單一故障類型(例如加速不良)中，每一個
故障源相對應於故障產生機率之大小，以提供診斷系統
使用者在判斷引擎故障時的一種重要參考數據。舉例來
說，我們假設可能的故障源為進汽歧管絕對壓力感知器
故障(P0105)、進氣溫度感知器故障(P0110)與節氣門絕
對位置感知器故障(P0120)等三個狀態；且造成的故障為
引擎加速不良，欲藉由此智慧型車用電腦診斷系統，來
計算每個故障源的機率大小。參考圖 6 所示，左方表格
顯示出每一組故障源可能造成故障的機率大小，右方表
格所顯示的是引擎故障碼；系統的輸入參數一是故障
碼，輸入參數二是引擎可能的故障狀態（本例為引擎加
速不良）。再經由模糊診斷系統計算結果，可以得知可
能的故障源以進氣歧管漏氣的機率為最大；維修技師根
據此智慧型車用電腦診斷系統之連線與診斷，即可快速
進行相關維修作業，可大大的節省時間與人力。
本文受時間所限，無法建構完善的故障碼、故障源
相關資訊與模糊關係資料庫，提供更多車型或車種使
用，此有待後續研究者加以補實，以成為一個完善實用
的智慧型車用電腦診斷系統。
四、 成果與自評
本計劃之執行，除了搜集完整相關文獻資料，也完
成前述之診斷系統，藉由此診斷系統與引擎電腦連線
後，引擎電腦之基本設定資料、故障碼及動態運轉數據
