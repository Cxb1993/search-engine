 2
(b) 神經原細胞樹突生長觀測與紀錄 
  (b-1) 影像強化 
  (b-2) 二值化 
  (b-3) 去除雜訊 
  (b-4) 改良式細線化 
  (b-5) 二維樹狀搜尋 
 
(a)生物細胞影像定位與細胞移動軌跡追蹤 
在生物細胞影像定位與細胞移動軌跡追蹤這部份，主
要包含前述的四項重要工作：(a-1)顯微影像前處理與顯微
影像品質分析。(a-2) 細胞影像分割。(a-3) 細胞影像定位
與數量估測。(a-4) 特定細胞移動軌跡之追蹤。以下針對
這四項工作做進一步的介紹。 
 
(a-1)顯微影像前處理與顯微影像品質分析 
一般數位影像的取得，往往會受到來自環境與攝影機
本身的雜訊影響，例如光線、CCD 雜訊或傳輸過程造成影
像品質不佳的情況。在顯微影像的取得過程中，造成影像
品質不佳的情況主要有兩項：背景光源是否充足與成像是
否準焦。前者主要發生在顯微鏡的背光調整不正確，或是
CCD 攝影機曝光不正確所造成，使得影像的對比度較低，
物體不容易識別；後者則是因為顯微影像的景深非常淺，
只要不在焦平面(focal plane)上的物體均模糊。當焦距調整
不正確時，會使物體影像模糊而不易辨識。因此，針對這
兩個現象，在實際處理顯微影像之前，必須進行影像的品
質分析與影像前處理。 
影像品質分析的主要目的，是在分析影像的成像品質
相對於人眼的認知，是否達到足夠的標準，例如清晰程
度、影像對比度等等。但是，人眼評斷影像品質是相當主
觀的，對於要進行自動分析的處理過程，不容易量化與實
現。一個好的客觀影像品質量測(image quality measure)
法，可以反映不同情況的失真程度，如模糊、有雜訊等等。
Avcibas 等人[4]將 26 種影像品質計算的方法分成六大類，
有許多廣為人知的量測方法，像是平均平方誤差(mean 
square error)與峰值信噪比(peak signal-to-noise ratio)等，最
常被用在影像壓縮的品質比較上。但是，這些評斷標準並
不適用在影像的清晰程度。更重要的，這類量測方法須要
有基準影像來做比較。對於持續拍攝的連續顯微影像來
說，要取得一張基準影像並不容易。Nill 與 Bouzas[5]提出
一個基於影像功率頻譜(power spectrum)的影像品質量測
方法。這個方法主要用來計算單張影像的品質，不需要其
他的參考影像。因此，本計畫採用以影像內容為主的品質
量測法，作為分析顯微影像品質的依據，並提供兩個客觀
的指標決定取得的顯微影像是否符合所需要的品質。 
第一個指標是影像銳利程度(sharpness index, SI)，用
來表示顯微影像的成像是否準焦。影像的銳利度越高，表
示高頻成份較多；反之，影像模糊的時候，高頻成份較少。
對一張品質良好的顯微影像來說，影像內容通常是單純背
景，且物體在影像中以明顯的輪廓邊緣呈現，因此影像中
高頻成份的比例可以判斷顯微影像的銳利度。首先，將輸
入的影像經過快速傅立葉轉換(fast Fourier transform, FFT)
轉為頻率域，計算其頻域強度並取對數值，如下式： 
 ( , ) log ( , ) ,M u v I x y= F  (1) 
其中 F表示 FFT 轉換， ( , )I x y 為輸入的灰階影像 I 在 ( , )x y
的灰階值， ( , )M u v 為對應的對數頻域強度值，如圖 1.(a)
所示。將整個頻率域 F 分為 b 個頻帶， 
 1{ , , }bF f f= "  (2) 
頻帶的劃分如圖 1.(b)所示。接著，統計各頻帶的強度平均
值， 
 
( , )
1 ( , ), 1, ,
i
i
u v fi
m M u v i b
N ∈
= =∑ "  (3) 
式中 iN 為第 i 個頻帶的強度值數量， im 表示第 i 個頻帶的
強度平均值。圖 2 是同一顯微影像在不同清晰程度下，經
由(1)~(3)式所得到的影像頻率分佈。實線是對焦正確的頻
域分佈；虛線是影像稍微模糊的頻域分佈。可以清楚的看
出來，在低頻部份兩張影像相差不大，但是中高頻部份卻
能清楚的分辨出準焦與對焦不正確的情形。依照頻帶強度
曲線分佈的情形，在中高頻帶的曲線斜率變化會因為影像
的清晰度而有所不同，因此可將影像銳利程度指標(SI)定
義為： 
 SI ( )i
i
slope m= −∑  (4) 
其中 ( )slope ⋅ 表示取斜率的函數。根據顯微影像的特性與
實驗結果，i 的選擇範圍由 8b 到 3 / 4b 為最佳。當 b=32，
SI 的值小於 1.5 時，就判定該顯微影像的銳利程度符合需
求，否則就需要重新調整對焦。 
  
 (a) (b) 
圖 1. 顯微影像轉換為對數頻域強度值的結果。(a) 對數
頻域強度值影像，(b)圖(a)經過劃分頻帶的示意圖，圓形
的帶狀區域表示同一個頻率值。 
 
0 5 10 15 20 25 30
0
1
2
3
4
5
6
7
8
9
10
 
圖 2. 同一顯微影像在不同清晰程度下的頻域分佈圖。 
 
 4
0 0 1 1 1 1 1 0 0
0 1 1 0 1 0 1 1 0
1 1 0 1 1 1 0 1 1
1 0 1 1 2 1 1 0 1
1 1 1 2 2 2 1 1 1
1 0 1 1 2 1 1 0 1
1 1 0 1 1 1 0 1 1
0 1 1 0 1 0 1 1 0
0 0 1 1 1 1 1 0 0
maskF
− − − − −⎡ ⎤⎢ ⎥− − − −⎢ ⎥⎢ ⎥− − − −⎢ ⎥− −⎢ ⎥⎢ ⎥= − −⎢ ⎥− −⎢ ⎥⎢ ⎥− − − −⎢ ⎥− − − −⎢ ⎥⎢ ⎥− − − − −⎣ ⎦
 (9) 
    因此，一張原始球型微粒子在顯微鏡下的影像，經過
圓形遮罩的處理後，在中心位置會獲得較高的值，再設一
定一個閥值(threshold)，將超過閥值的設為 1，也就是代表
圓型微粒子的中心，低於閥值得設為 0，則可得到圓形微
粒子中心的二值化圖，如圖 4 所示。 
 
圖 4. 球型微粒子在顯微鏡下經過圓形遮罩處理過後的二
值化影像。 
 
    由於球型微粒子在培養皿中是在一個三微的空間，且
會根據一些震動、凡得瓦力(Van der Waals force)或是水面
介面液體的流動等，造成此微粒子可能會些微移動震動，
或是不在顯微鏡的焦平面(focal plane)上，導致球型微粒子
影像邊緣會模糊化，此外，也由於次像素(sub-pixel)的影
響，球型微粒子的邊緣或中心不一定都剛好落在像素上，
因此一個球型微粒子經過遮罩處理後，可能會造成多個中
心點，再經由種子區域成長法(SRG: Seed Region Growing)
將相連的中心點集合，取平均後獲得最後的中心點位置。
將原圖處理過後，以中心位置畫半徑為 5 pixel 的圖形結果
如下圖 5 所示： 
  
圖 5. 球型微粒子偵測結果。 
 
    以圓形遮罩作為偵測球型微粒子，再加上種子區域成
長法，可將布必要的雜訊去除，此外，利用已知的資訊，
微粒子的直徑約在 10 個像素左右，因此我們可以將微粒
子精確的抓出來，而一些模糊的雜訊，如培養皿或是顯微
鏡上的鏡片髒痕，都可藉由遮罩的方式加以去除。而當微
粒子不在焦平面上時，其呈現的方式為一模糊圓球狀，因
為不在焦平面上，因此我們也不將其列入考慮。 
    在將球型微粒子的分割出來後，我們就可以獲得每一
個球型微粒子的中心座標，也可以獲得這張影像中微粒子
總數，座標的資訊將可以提供移動軌跡追蹤作為使用，而
微粒子的數量則可提供作為總數量的一個比例參考。當考
慮是活體細胞均勻分散在培養皿中時，我們就可以將數個
小畫面所獲得的數量，去推測在整個培養皿中，所有細胞
的數量，許多疾病的判定都是借由某些特殊細胞的數量決
定的，因此位置的資訊和數量的資訊在活體細胞的觀測實
驗中是必要的。 
 
(a-3)特定細胞移動軌跡之追蹤 
特定細胞移動軌跡追蹤的目標，在於追蹤顯微影像中
的特定細胞，並紀錄其移動軌跡。其目的有兩個：第一，
細胞在顯微視野中的活動情況，若要以人眼觀測，有時候
會受到周遭其他細胞的影響而不易觀測。若能利用影像處
理的技術，追蹤特定細胞並標示，可以大幅降低觀測的困
難。第二，受到追蹤的細胞，可以紀錄其運動軌跡，一方
面能實現自動顯微影像觀測系統的開發，另一方面運動軌
跡可以提供為預測的資料，作為以影像進行奈米壓電平台
回授控制、以及發展光鉗系統的先期準備。 
利用視覺影像追蹤物體，在影像處理與電腦視覺的領
域一直是相當熱門的問題。過去十幾年來，有許多追蹤物
體的方法被提出。但在顯微影像的物體追蹤上，仍有許多
問題與困難的地方。最主要的原因是，顯微影像的本質與
其他視覺追蹤技術使用的影像，有相當大的差異與限制。
顯微影像本身不具彩度，換言之，是僅有亮度的灰階影
像。其次，顯微影像有效的成像，僅止於正確對焦的焦平
面，一旦超出焦平面，物體便會模糊。而顯微影像也無法
做到像一般攝影機拍攝，允許有不同的角度與方向。再來
是物體在影像中的呈現，通常只具有邊緣，物體中間的部
 6
長時間的對神經細胞觀察與紀錄，一個全自動化的觀察與
記錄系統，可以減少人為的疏失，與降低誤差。在自動化
的觀察系統中，建立一個可靠的影像處理系統來作分析是
相當重要的，所以本計畫提出一個可靠度高的影像向處理
系統，來提供後從事神經細胞長期觀察者使用，本研究系
統針對於神經細胞的樹突生長觀察與紀錄，設計了一個自
動化觀察與紀錄的系統，針對觀察神經細胞的顯微影像，
我們進行了影像強化、二值化與去除雜訊，並再利用了改
良式的細線化法來找出樹突，並使用二維樹狀(2D tree)[11]
搜尋找出各個樹突的端點位置，如此一來就可以觀察與記
錄到每一個時間點的樹突狀況。 
 
(b-1)影像強化法 
     在一般的顯微影像中，因為取樣樣本的透光度與光
源亮度的影響，會造成相當程度的有效影像遭到隱藏，所
以在處理前必須先將神經原細胞影像強化，其目的是將影
像取樣時被隱藏有效資訊給找出來。在本計畫中我們採用
了直方圖等化(histogram equalization)的方法，來調整暗部
的隱藏部份並獲得更多的有效資訊。 
 
(b-2)二值化 
在影像強化後，首先要做的就事先將所獲得的神經
細胞影像二值化，二值化的目的在於將影像分割成兩個不
同的屬性，因此閥值的決定會影響分割結果的好壞，二值
化處理決定了影像中神經細胞邊界分割能否成功。閥值的
選取方法有很多種，本研究採用Nobuyuki Otsu [12]於 1979
年所提出的全域閥值法。 
 
(b-3)去除雜訊 
因細胞顯微影像在經二值化處理後，有許多不必要之
雜訊，除大部分為背景雜訊外，還包括細胞內部之雜訊，
在此我們針對二值化後影像，利用形態學的集合論所發展
出能自動將細胞內部及背景雜訊去除的方法。形態學主要
用途是在於獲取物體拓撲和結果資訊，它在影像處理中的
應用主要是： 
1. 利用形態學的基本運算，對影像進行處理，從而達
到改善影像的目的； 
2. 描述和定義影像的各種幾何參數和特徵，如面積，
周長，連通度，顆粒度，骨架和方向性。 
通常形態學影像處理爲一種鄰域運算形式，在每個像
素位置上它與二值影像對應的區域進行特定的邏輯運
算，邏輯運算的結果爲輸出影像的相應像素。形態學運算
的效果取決於結構元素（structure element）的大小、內容
以及邏輯運算的性質。本文在去除雜訊的方法上，就是利
用形態學運算中的侵蝕(erosion)與膨脹(dilation)，將背景及
細胞內部一些不必要的圖點資訊濾除。 
  
(a) (b) 
  
(c) (d) 
圖 8. 神經細胞影像處理。(a)灰階原始影像，(b)影像強
化，(c)二值化影像，(d)去除雜訊。 
 
(b-4)改良式細線化法 
使用細線化法的目的是要得到樹突的分布狀態，因此可以
觀察與記錄樹突的生長狀態。細線化法是以迭代方式一層
一層刪除物件邊界的像素，根據其與鄰近像素的關係，並
利用演算法計算每一個像素是否去除或保留，經過多次的
迭代後，最後所保留的就是中心的骨架(skeleton)。 
 
P8 P1 P2 
P7 C P3 
P6 P5 P4  
圖 9. 細線化法中相鄰八個像素點的示意圖。 
 
細線化法中相鄰八個像素點的位置，如圖 9，C 是為待處
理之像素，而 P1至 P8 為其相鄰像素。物件像素值為 1，
背景像素值為 0。  
任何一個迭代刪除方式的細線化演算法必須滿足以下需
求：  
(a) 刪除的點不會消去端點；  
(b) 刪除的點不會中斷連結；  
(c) 不會引起區域的過度浸蝕。  
細線化法相關的研究有很多，其中 Zhang[13]提出一個平
行偵測刪除邊緣的細線化方法，利用相鄰的八個像素點的
關係，活化點(active point)數與反向(inverse)次數，並利用
演算法規則判斷該點是否為邊際點，如果為邊際點則將該
點反向為非活化點(inactive)，反之，該點保留為活化點。
但是大部分的細線化演算法都會將大區域的部份保留過
多的細線情形出現，本研究提出了改良 Zhang 的演算法，
算法如下: 
 
步驟(一)  
 8
3.2 實驗結果 
    實驗結果的部份，我們將分以下三點來討論，分別是
影像分割定位與數量估測、特定細胞移動軌跡之追蹤和神
經細胞樹突觀察與紀錄。在第一個部份，我們將針對分割
定位的中心點和整體數量的估測，討論其誤差及發生原
因。第二部份則著重是細胞追蹤的正確度，最後是神經細
胞數量及生長的追蹤。 
 
3.2.1 細胞影像分割定位與數量估測 
在細胞影像分割定位與數量估測這一個部份，由於我
們沒有活體細胞可供觀測，因此我們使用 2.47um 球型塑
膠微粒子作為代替。我們針對一段影像中，任意取出總共
1000 張的圖片作為分割定位和數量估測的實驗。 
在定位方面，由於塑膠微粒子並無法被控制在空間的
某一處，因此只能用眼睛和圓型逼近的方式去判定其精確
度，對於數張影像共 100 個塑膠微粒子，已知 2.47um 球
型塑膠微粒子在影像中之直徑約佔 10 像素的情況下，經
過圓形遮罩和種子區域成長法所獲得的中心，與用眼睛和
圓形逼近的方式所獲得的中心，平均誤差約為 0.92 個
pixel，標準差為 0.9713 個 pixel，而誤差的發生，通常在
於影像品質，由於我們並沒有光學桌，因此並沒有辦法維
持影像不要晃動，些微的振動都會造成影像的糢糊化，因
此在微粒子的邊緣就會有模糊的情況。此外，也由於塑膠
微粒子在培養皿中是在三維空間中，不一定完全落在顯微
鏡的焦平面上，因此其邊緣也會有模糊化的情況，最後就
是雜訊，也就是鏡頭或是培養皿的汙垢影響。這些影響都
會造成在邊緣上判斷的一些誤差，而導致最後中心點的誤
差。 
另外，在數量估測的部份，所取出來的 1000 張影像，
球型微粒子的數量都約在 100 個上下，由實驗結果所得的
數據和人眼去觀察粒子的數量做比較，平均誤差約為
2.837 個，標準差為 2.132 個，也就是在一張影像中，數量
的誤差約在 2%左右。 
 
3.2.2 特定細胞移動軌跡之追蹤 
在特定細胞移動軌跡追蹤的實驗項目中，針對取得的
顯微影像序列，進行特定微粒子的追蹤。首先由細胞定位
的方法，分割出在顯微影像中的微粒子。接下來由人工指
定某個粒子開始進行移動軌跡的追蹤。 
實驗使用三段顯微影片來做追蹤，實驗結果如表 1 所
示。在一般影片清晰度足夠的情況下，追蹤的正確率可以
達到九成以上。由於沒有光學桌設備，因此粒子在影像中
會有較不規則的振動，影響追蹤的效果。圖 7 就是一個典
型因為外在振動，導致顯微影像振動後影響追蹤的情形。
該為例子就算靜止不動，也會受到影像振動的影響。另一
個造成追蹤率不高的情況，是微粒子的移動離開焦平面，
導致影像特徵消失而追蹤失敗，如編號 3 的影片，微粒子
稍微離開焦平面而導致追蹤失敗。 
 
3.2.3 神經細胞樹突觀察與紀錄 
在神經細胞觀察與紀錄實驗裡，我們著重於神經細胞
樹突數目與位置的精確度，測試影片長度為 1 分 20 秒，
取樣頻率為每秒 20 張，測試影像一共 1600 張，每張影像
平均處理時間 1’15”，本實驗準確率量測分為兩個，一個
是樹突數量正確率(Rcn)，另一個是樹突位置正確率(Rcp)。
正確率定義為: 
 
 _
_
EN Dendrite
cn
TN Dendrite
R
ε
ε=  (12) 
 _
_
CPN Dendrite
TN Dendrite
cpR
ε
ε=  (13) 
 
_EN Dendriteε 為經過本系統所偵測出來的神經細胞樹突總
數， _TN Dendriteε 為手動計算出來的神經細胞樹突總數，
_CPN Dendriteε 為經過本系統所偵測出來位置正確的神經細胞
樹突總數。錯誤率的計算也是分為兩個部份，一個是樹突
數量估測的錯誤率(Ren)，另一個是樹突位置偵測的錯誤率
(Rep)，相關定義為: 
 
 _ _
_
Err EN Dendrite
en
TN Dendrite
R
ε
ε=  (14) 
 _ _
_
Err CPN Dendrite
TN Dendrite
epR
ε
ε=  (15) 
 
_ _Err EN Dendriteε 為經過本系統所未偵測出來或偵測錯誤的神
經細胞樹突總數， _ _Err CPN Dendriteε 為經過本系統所偵測出來
位置不正確位置的神經細胞樹突總數。 
 
表 1. 特定細胞移動軌跡追蹤的結果。 
影片編號 影像張數 追蹤正確張數 正確率 
1 756 716 94.7% 
2 733 663 90.4% 
3 548 421 76.8%  
 
表 2. 神經細胞樹突偵測準確率與錯誤率。 
樹突數量
正確率 
樹突位置
正確率 
樹突數量
錯誤率 
樹突位置
錯誤率 
95.26% 93.18% 7.11% 8.54% 
 
 
3.3 實驗結果討論 
在神經細胞觀察與紀錄實驗裡，證明了我們所提出來
的系統，能正確的計算出神經細胞樹突數量與位置，如圖
13(a)~(d)，分析錯誤判斷的影像，我們可以發現大部分誤
差的都是出現在樹突末端的突觸，因為這些容易造成誤判
的突觸都是在細胞核附近剛形成的突觸芽，這些突觸芽由
於是屬於初生的突觸，透光度相當高，又因其與核本身距
離並不遠所以容易造成系統的誤判，如圖 13(e)白色圈圈
處，又一個容易造成錯誤的原因在於本身細線化的演算法
中，由於演算法無法絕對正確的判斷邊緣保留點與側芽凸
點所造成地不正確保留，因此產生錯誤的樹突判斷，如圖
13(f) 白色圈圈處。 
 
出席國際學術會議心得報告 
                                                             
計畫編號 NSC 96-2221-E-009-238 
計畫名稱 基於光鉗系統之顯微影像觀測系統之設計與研發 
出國人員姓名 
服務機關及職稱 
姓名:徐永吉 服務機關:國立交通大學電控系 職稱:博士生 
會議時間地點 時間: 97/4/21-97/4/24 地點:中國大陸，四川 
會議名稱 
（中文）IEEE 工業技術國際研討會 
（英文）IEEE International Conference on Industrial Technology (ICIT) 
發表論文題目 
（中文）增強式自我適應進化學習模糊系統 
（英文）Reinforcement Self-Adaptive Evolutionary Algorithm for Fuzzy 
Systems Design 
 
一、參加會議經過 
這次的ICIT會議是在中國四川舉辦，為期共4日(4/21-4/24)。而其中有三天的會議議程，
會議議程都是在四川的希爾頓飯店舉辦。 
由於擔心到了四川人生地不熟，所以我連絡旅行社，請旅行社代訂機票，並安排相關食
宿，以及詢問當地相關的風俗人情和交通資訊。在完成了相關準備事項後就準備出發了，因
為我的議程是在4/21的早上，所以我將出國日期訂在4/20的早上希望可以有充足的時間到會
場，我的飛機是4/20的9點15分，所以到中國時是當地的14點多，入住的是世纪城假日酒店由
於當天並無議程，所以就是安頓行理和準播明天要報告的相關事宜。 
會議的第一天，也就是我到四川的第二天，由於在這天上午的11:30-12:30是我的議程，
所以時間非常得充裕，吃過早飯後就搭車前往這次會議的地點希爾頓飯店，因為塞車的關係
到會場已經10點多了，辦理好註冊事宜後，接著就是準備報告的內容了，我所屬的議程是
Optimization而我的論文是增強式自我適應進化學習模糊系統，主要的報告內是:簡介研究動
機、模糊模型的介紹、自我適應進化演算法架構、增強式學習架構以及實驗結果的分析。在
過程中反應都很正面，有來自中國大陸的哈爾濱大學的學者問及模糊控制器的實作問題、重
慶大學學者對進化演算法架構上針對自我適應性中權重值設定以及四川大學學生的意見…等
等問題都對我有不少的助益。在下午則是聽了幾場有興趣的報告，其中最有趣得是A Jumping 
Gene GA for Multi-objective Voltage Control的報告中，說明了一個彈性的電壓控制方法，透過
