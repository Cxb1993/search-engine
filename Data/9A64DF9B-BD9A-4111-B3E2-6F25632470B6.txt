1 
 
一、 中文摘要 
本計畫旨在開發以慣性感測元件為基礎之人機互動介面，此介面之主要功能為將人類肢
體動作所產生的慣性訊號透過訊號處理及相關演算法，進行肢體動作的動作辨識或軌跡重
建，並將辨識所得之動作或重建之軌跡映射至對應的電腦指令，達到以肢體動作來操控電腦
之目的。此研究的首要工作為開發高效能、低誤差的人類肢體動作辨識及軌跡重建演算法；
接著，利用硬體電路架構將開發之動作辨識及軌跡重建演算法實現軟硬體混合系統；最後，
利用軟硬體混合系統來實現人機互動介面。本計畫執行重點為(1)具人類肢體動作辨識之互動
式遊戲操控系統，及(2)具動作軌跡重建之慣性雷射簡報筆。在具人類肢體動作辨識之互動式
遊戲操控系統方面，此系統旨在開發一具人類肢體動作姿態辨識技術及肢體轉向估測技術之
人類肢體感測演算法，並結合軟硬體混合系統技術來實現一個具備人類肢體動作慣性感測之
互動式遊戲操作介面。在具動作軌跡重建之慣性雷射簡報筆方面，此系統旨在開發人類肢體
動作軌跡重建演算法來加以偵測人類手部在三維空間中的動作，並結合嵌入式系統來實現具
有手寫字元輸入、網頁瀏覽器操控及螢幕游標操控等功能之可攜式人機互動介面系統，有效
地取代鍵盤、滑鼠及手寫板等人機介面輸入裝置。 
關鍵詞：人類肢體動作感知、慣性感測、體感演算法、軌跡重建演算法、軟硬體混合系統、
人機介面、互動遊戲、慣性雷射簡報筆。 
 
計畫執行至今，我們將研究成果已/將發表下列期刊與研討會論文、參加競賽及申請專
利。其成果如下： 
期刊與研討會論文： 
1. Jeen-Shing Wang, Yu-Liang Hsu, and Jiun-Nan Liu, “An Inertial-Measurement-Unit- 
Based Pen with a Trajectory Reconstruction Algorithm and Its Applications,” IEEE 
Trans. Industrial Electronics, vol. 57, no. 10, pp. 3508-3521, 2010. 
2. 王振興、許煜亮、劉俊男、莊芳甄，“利用微慣性感測訊號進行手寫軌跡重建，” 
自動化科技學會會刊, pp. 22-29, September, 2009. 
3. Jeen-Shing Wang and Tzu-Ping Kao, “Development of Human-Computer Interaction 
with ARM-Based Embedded System and Its Application on Portable Handwritten 
System,” in preparation to submit to IEEE Trans. Industrial Electronics. 
4. Jeen-Shing Wang and Fang-Chen Chuang, “Physical Activity Classification and MET 
Mapping Model Construction Using Accelerometers,” in preparation to submit to 
Journal of Applied Physiolog. 
5. Jeen-Shing Wang and Fang-Chen Chuang, “Handwriting/Gesture Classification Based 
on Probabilistic Neural Network by Using a Pen-Type Portable Device,” in preparation 
to submit to Pattern Recognition Letters. 
6. Jeen-Shing Wang, Yu-Liang Hsu, and Jiun-Nan Liu, “3D Hand Motion Trajectory 
Reconstruction based on Inertial Measurement Unit,” in preparation to submit to IEEE 
Trans. Industry Applications. 
7. Jeen-Shing Wang and Jhih-Wei Wu, “An Intelligent Vehicle with Posture Estimation 
based Remote Monitoring/Control and Parking Assist Function,” in preparation to 
submit to IEEE Trans. Vehicular Technology. 
8. Jhun-Ying Yang, Jeen-Shing Wang and Yen-Ping Chen, “Using Acceleration 
3 
 
二、 報告內容 
(一) 前言 
近年來，由於微型慣性感測器在微機電製程的突破技術上已臻成熟，因此造就了慣性感
測器在穩定度大幅地提升、體積縮小及價格降低。因為微型慣性感測器的低成本、小體積、
輕重量及低耗能等特性，微型慣性感測器現今已成功地應用於各種不同的產品，如：1)振動
感測、2)姿勢輸入、3)硬碟磁頭損毀保護、4)導航系統、5)顯示器定位、6)影像穩定、7)生物
監測及 8)人類肢體動作辨識等。另外，在我們日常生活中許多家用電子不乏有微型慣性感測
器的存在，例如：計步器、iPhone 手機、任天堂 Wii、電腦硬碟及汽車安全氣囊中的加速度
計等。在這些成功的應用中，人類肢體動作辨識是目前相當新興的議題。在上述基於人類直
覺行為的新穎人機介面方法中，動作姿勢及手寫文字辨識技術皆是利用辨識人類肢體的動作
來進行人機互動或操控。然而，一般而言人類動作姿勢或手寫文字人機互動介面大多是藉由
影像處理技術來進行辨識，如此一來將消耗大量的硬體資源及增加軟體運算複雜度。因此，
如何直接利用慣性感測器擷取人類肢體動作訊號來形成新穎式人機互動介面，進而取代傳統
以影像處理為主的人類動作姿勢或手寫文字人機互動介面是當前極熱門的議題[1],[3]。此
外；雖然以慣性感測器為主的人機互動介面若以電腦軟體平台來實現，其具有整合特定演算
法機制的彈性來滿足各應用層面的需求；但是，過於緩慢的計算速度將嚴重地妨礙此有效工
具應用於即時系統上。因此為了增加產品可攜性、功能性及多樣化，研究發展出高效能的策
略來結合慣性感測器及其本身的演算法於硬體裝置上是本計畫研發的主軸。 
本計畫之執行重點為(1)具人類肢體動作辨識之互動式遊戲操控系統，及(2)具動作軌跡
重建之慣性雷射簡報筆。在具人類肢體動作辨識之互動式遊戲操控系統方面，其包含以下 4
個子研究主題：(1)慣性感測電路設計：整合加速度計及磁力計等相關電路設計，加速度計主
要用來量測使用者手腕部位的動作加速度訊號，而磁力計則是用來量測使用者頭部轉向的方
位角；(2)人類肢體感測演算法開發(以下將簡稱為“體感演算法”)：其包含了人類肢體動作姿
態辨識演算法及肢體轉向估測演算法，來判斷使用者的動作種類及肢體轉向；(3)人類肢體感
測軟硬體混合系統開發：ARM 嵌入式系統負責擷取訊號之特徵值與特徵維度降維等的訊號
資料前處理的工作，再透過資料、位址匯流排將經過前處理後的訊號特徵向量(feature vector)
傳遞給建構於場效可程式邏輯閘陣列(field programmable gate array, FPGA)中的模糊基底辨
識器進行人類行為辨識；及(4)互動式遊戲操控系統實現：最後利用馬力歐賽車遊戲及利用
Quest3D 系統設計出一互動式鹽水蜂炮遊戲來加以驗證其有效性。在具動作軌跡重建之慣性
雷射簡報筆方面，其包含以下 4 個子研究主題：(1)慣性雷射簡報筆電路設計：整合加速度計、
陀螺儀及雷射光之相關電路，加速度計及陀螺儀用以偵測使用者手部運動之加速度及角速度
訊號，而雷射光電路則是用以產生雷射光點；(2)手寫文字軌跡重建演算法開發：其包含了軌
跡重建演算法及動作姿態辨識演算法，分別用來重建使用者手寫時手部運動之軌跡及辨識手
部運動之姿態；(3)軌跡重建可攜式系統開發：利用 ARM 嵌入式系統來實現手寫文字軌跡重
建演算法以形成可攜式慣性雷射簡報筆；及(4)慣性雷射簡報筆系統實現：最後利用手寫字元
輸入、網頁瀏覽器操控及螢幕游標操控等三種人機介面來加以驗證其有效性。 
 
(二) 研究方法 
研究子題一：具人類肢體動作辨識之互動式遊戲操控系統 
 本研究子題旨在將人類肢體動作姿態辨識結合肢體轉向估測技術，並研發一個具備人類
肢體感測演算法之互動式遊戲操作介面，希冀本互動式遊戲系統能推廣與應用到更多元化的
5 
 
(4) nRF2401無線射頻傳輸模組：用於將慣性感測訊號以無線傳輸的方式傳輸到接收端之
電腦系統。 
(5) CP2102橋接器：在慣性感測訊號接收端，利用 C8051F206微處理器進行UART傳輸，
然後透過 USB 至 UART 橋接器 CP2102，將資料傳輸至電腦系統端。 
 
 
1.2 人類肢體感測演算法 
人類肢體感測演算法包含了人類肢體動作姿態辨識及肢體轉向估測兩種演算法，其流程
圖如圖 3 所示。圖 4 為互動式遊戲操控之體感演算法系統架構圖，一旦加速度計模組與磁力
計模組分別量測到人類肢體動作慣性感測訊號與轉向資訊後，會經由無線傳輸模組將資料傳
輸至電腦端進行訊號處理。接著，慣性感測訊號與磁力計訊號會分別進行人類肢體動作姿態
辨識演算法及肢體轉向估測演算法，來判斷使用者的動作種類及肢體轉向，並進行軟體驗
證。最後，我們將結合以上的軟硬體架構並整合動作姿態辨識及轉向估測之相關資訊，來進
行互動式遊戲系統的操作與控制。 
 
 
慣性感測
模組 特徵擷取 特徵降維 辨識器 動作辨識系統
特徵向量
資料收集
特徵處理程序
運動動作種類
資料前處理
姿態估測
人類肢體轉向偵測
訊號前處理
磁力計
模組
資料收集
濾波 遊戲控制
 
圖3 人類肢體體感演算法流程圖。 
 
                      
(a)                             (b) 
圖1 本研究子題之感測器電路。(a) 腕錶式無線三軸加速度計。(b)具磁力計之遊戲頭盔。 
 
 
圖2 慣性感測模組電路實體圖。 
 
7 
 
率皆小於 12 赫茲(Hz) [9]，因此只需要將以上的低通濾波器的截止頻率(cutoff frequency)設定
為 20 赫茲(Hz)，就足以濾除人類肢體動作慣性感測訊號中的高頻雜訊。 
 資料前處理 
    由於加速度計訊號是屬於時序訊號，因此若不經過任何資料取樣或前處理程序，而直接
處理人類肢體動作加速度訊號，會有一定的困難。在文獻中較適當的作法是將加速度計的訊
號序列切分為數個等長並部分重疊的視窗，以方便擷取視窗中重要特徵[2], [11]。在此，我
們以 50%重疊的方式切割視窗。在正式處理訊號辨識問題之前，訊號如何收集以及轉換是第
一個要面對的問題，在此我們將說明如何處理有關訊號收集以及訊號資料格式轉換的問題。
三軸加速度計的資料格式如下所述： 
 
 
“Bxxxxyyyyzzzz”
 
(2) 
 
因此，每次取樣所收集到的訊號為一組由十三個字元所組成的字串，其中開頭字元 “B” 是
用來標記一組資料字串的開始，而接下來的字串“xxxx” 代表 x 軸的加速度值，其範圍為
“0001”到“1024”，可表示-4g 到+4g 的加速度的變化。同理，字串“yyyy”與“zzzz”分別代表 y
軸與 z 軸的加速度值。在這樣的訊號資料格式底下，必頇設計一程式負責資料格式轉換的工
作，將轉換完成的訊號用於後端的特徵處理及訊號辨識。另外所使用的加速度計接收端是利
用序列傳輸給電腦系統，在接收端與電腦系統之間並沒有任何的交握訊號，因此加速度計訊
號一直持續不間斷地送入電腦系統中。然而系統在執行訊號處理與行為辨識時，接收資料的
程式會被中斷，所以假如我們的程式設計流程是採用迴圈的模式的話，就會發生兩種不同的
訊號取樣結果：(1)當訊號收集還沒有累積到一個視窗時，每一次取樣都只是單純將資料格式
轉換後就執行下一次的迴圈工作。(2)當所收集的訊號筆數已經累積到一個視窗時，在這次的
迴圈中除了要做資料格式轉換外，還要從此視窗擷取特徵與做特徵降維，再送入行為辨識器
辨別動作種類。以上的程式設計流程會造成電腦系統於加速度計訊號取樣時不同步，因此在
本研究子題中採用另一種不同的程式設計流程：利用計時器(timer)的方式收集訊號。我們在
程式中設定一個固定的計時裝置，當每次到達預設的計時時間時，就會產生一個軟體上的中
斷。在處理中斷的回應函式中會執行所有的工作，包括訊號資料格式轉換、視窗擷取、特徵
擷取、特徵降維與辨識的工作。這樣的設計概念只要計時裝置的時間設定恰當便可以達成迴
圈的工作效果，同時也可以避免訊樣取樣不同步的狀況發生。 
 特徵擷取 
    由每一取樣視窗中擷取以下八種特徵[4],[13]，其各別定義分述如下： 
(1) 平均值(mean)：單一取樣視窗中加速度訊號的平均值，即訊號的直流成分。 
 
 1
1
mean ,
n
i
i
X
n 
 
 
(3) 
 
(2) 軸向間相關性(correlation between axis)：由於本研究子題之動作姿態辨識系統採用三軸加
速度計，每個軸所量得的加速度訊號之間的相關性，即為共變異數與單一頻道內標準差
內積值的比例。例如 x 軸加速度的變數 X 和 y 軸加速度的變數 Y，其標準差為 σX 和 σY，
則軸間相關性表示如下： 
 
9 
 
別分析是一個有效的特徵降維方法，其目標主要是分離不同的資料群組，並將同一資料群組
分佈空間縮到最小。以下說明線性識別分析的概念，首先定義兩個散佈矩陣，SW 是在群組
內散佈矩陣(within-class scatter matrix)，SB 則是在群組間散佈矩陣(between-class scatter 
matrix)。 
 
 
( ) ( )
1
1
( )( ) ,
in
i i T
Wi j i j i
jin 
  S x m x m
 
(10) 
 
( ) ( )
1 1 1
( )( ) ,
inN N
i i T
W i Wi j i j i
i i j
n
  
     S S x m x m
 
(11) 
 1
( )( ) .
N
T
B i i all i all
i
n

  S m m m m
 
(12) 
 
其中，ni 是第 i 個類別的資料個數，
( )i d
j x 代表第 i 個類別的第 j 個樣本，d 是特徵空間的
維度，n 是樣本數，而 N 是類別個數，mi是第 i 個類別的平均值，而 mall是所有類別的平均
值。另外，SWi等同於第 i 個類別的共變異數矩陣，而 SW是所有共變異數矩陣的總和，SB是
各個類別的距離平方總和。線性識別分析的概念是找一個有效的投影矩陣 W 使得以下的
Fisher Criterion 最大化： 
 
 
( ) ,
T
B
T
W
J =
W S W
W S W
W
 
(13) 
 
轉換矩陣 W 被用在最大化類別間距離，以及最小化類別內距離；這是為了找到在新的特徵
空間中最大的辨識度。新的特徵向量 y 可以由 y = WTx 找到，x 是原始的特徵向量。一般來
說，W 在(13)式中的最佳解，會滿足下列的等式： 
 
 
.B WS W S W
 
(14) 
 
因此，若 SW的反矩陣存在，W 可由(SW
-1
SB)的特徵值分解中取得。一般來說，高維資料空間
可以降維到較低維的空間中，其方法是移除特徵值較小的特徵向量。由於類別間的散佈矩陣
是由 N 個秩(rank)等於 1 的矩陣相加起來，因此只有 N-1 個行向量是線性獨立的，所以最多
會有 N-1 個非零特徵向量。也就是說，W 的行向量等於(14)式中前 N-1 個特徵行向量。 
 動作姿態辨識器 
    經過特徵降維後，我們就可以依據降維之後的特徵向量來建構動作姿態辨識系統的辨識
器以進行辨識動作類別的任務。為了辨識出各種不同動作所產生的訊號，我們利用一個基於
模糊基底函數網路為基礎的辨識器[4],[10]。此辨識器的架構如圖 6 所示，包含了五層。以下
將詳述各層的運算。 
11 
 
 
由圖 6 與圖 7 可以清楚瞭解模糊基底函數辨識器的架構與其所使用的歸屬函數。由於歸屬函
數為高斯函數(Gaussian membership function)，所以在建立模糊基底函數辨識器的過程中如何
決定第二層的高斯函數的寬度與中心點的位置就是一個很重要的工作。在統計上對於高斯函
數的寬度與中心點的定義分別就是平均值(mean)與變異數(variance)。對於資料做特徵值擷取
與資料降維後的特徵值空間向量 y 作為模糊基底函數辨識器的輸入，其中 y 可以由 y = WTx
找到，x 是原始的特徵向量，並且我們希望在建立模糊基底函數的過程中不要對原始的訓練
資料降維後作平均值(mean)與變異數(variance)的計算。為了要解決這樣的問題於是我們利用
線性識別分析計算出的轉換矩陣 W 與每類動作的平均值平均值 m (mean)與共變異矩陣 SW 
(covariance matrix)求取所需要的高斯函數的參數： 
 
 
' ( ) ( ) ( )
1 1 1
1 1 1
,
i i in n ni T i T i T
i j j j ij j j
i i in n n
  
     m y W x W x W m
 
(17) 
 
' ( ) ' ( ) '
1
1
( )( ) .
i
i i
n i i T T
W j i j i Wj
in

   S y m y m W S W
 
(18) 
由 '
im 與
'
iW
S 的對角線的值就可以找出要建立模糊基底函數的歸屬函數的參數值。 
 1.2.2 人類肢體轉向估測演算法 
    人類肢體轉向估測主要針對磁力計模組訊號來進行轉向估測，其基本流程如圖 8 所示，
包括訊號前處理、資料前處理與轉向估測等三個部分。在訊號前處理方面，與動作姿態辨識
系統一樣，使用移動平均濾波器(moving average filter)進行高頻雜訊濾除。接著利用磁力計
模組所提供之磁力計與加速度計資訊計算出人體在空間中的姿態。透過加速度計來估測肢體
在三維空間中的姿態，我們可以不需經過積分程序而是直接利用加速度計所量測到的感測訊
號分量來計算尤拉角表示法中的滾轉角( )及俯仰角(θ)。以下我們將利用加速度計量測三維
空間中姿態來加以說明直接式感測模式之姿態估測演算法。 
    當加速度計靜置時，加速度計只會量測到重力加速度，而重力加速度的方向正好與參考
座標中的第三個基底平行。因此我們可以利用這樣的關係找出加速度計相對於參考座標系的
兩個姿態角。根據感測器座標轉換至參考座標的旋轉順序為( →θ→ψ)，我們可先求得滾轉
角( )再求得俯仰角(θ)。由於反正切函數(arctan)的值域限制，因此我們必頇考慮以下三種情
形來計算滾轉角( )： 
(1) 當加速度計 Z 軸讀值(Abz)小於零時，滾轉角( )可藉由加速度計 Y 軸讀值(Aby)與 Z 軸讀
值(Abz)來加以求得： 
 
 
圖 7 (a)兩種類別的二維分佈。(b)相對應的模糊基底函數辨識器。 
 
13 
 
最後將辨識結果傳回 ARM 嵌入式系統。 
 
 
 1.3.1 實現特徵值擷取與特徵維度降維於 ARM 嵌入式系統 
利用 ARM 嵌入式系統，我們可以將人類肢體動作姿態辨識演算法中八種特徵擷取的方
法一一實現。此外，在特徵維度降維方面，因為有運用到線性識別分析法的關係，所以在實
作線性識別分析法演算法的過程中遭遇解特徵向量(eigenvector)的問題，這是高度複雜的運
算而且不易實現於 C 語言中。因而我們利用 GNU Scientific Library (GSL)函式庫來解決解特
徵向量的問題。在此函式庫中包含有很多數學與科學運算的函式庫，而其中特徵值問題
(eigenproblem)的函式庫也包含在其中。在引用 GSL 函式庫前我們先取得 GSL 原始碼，我們
採用的是 1.10 版本。最後利用跨平台編譯器(cross-compiler)編譯出能在 ARM 嵌入式系統平
台上使用的動態函式庫，即可依照(10)-(12)式的步驟，實現線性識別分析法。 
 1.3.2 實現模糊基底函數辨識器於 FPGA 
為了辨識出各種不同動作所產生的訊號，我們提出一個基於模糊基底函數網路為基礎的
辨識器，並將其實現於 FPGA。此辨識器的架構如圖 6 所示，而在硬體實現中，為了減少硬
體的使用量，我們將第四層的正規化層省略不做，並利用三角波函數來近似高斯歸屬函數，
以簡化電路設計，但亦能保有相同的辨識效果。首先透過人機互動介面，導引使用者將所要
辨識的動作（亦即不同的群組資料），都儲存在 ARM 嵌入式系統中。接著，利用線性識別
分析，拉近類別間的資料分佈，同時使各類別之間的距離離得愈遠愈好。接著，以新空間中
的資料分佈統計資訊(如平均值與變異數)來建構模糊基底函數辨識器。利用資料分佈資訊建
立模糊基底函數的過程可透過圖 7 來說明，若以圖 7(a)表示兩個類別(A 及 B)的分佈，而圖
7(b)是利用在圖 7(a)中的類別在新空間的分佈資訊建構出相對應的模糊基底函數網路。最
後，我們希望可藉由此辨識器區分出待辨識的動作。 
在 FPGA 的設計中，我們以控制電路(control circuit)的設計以及資料路徑(data-path)的設
計兩方面來說明辨識器硬體電路設計理念： 
 控制電路(control circuit)的設計 
    由於在模糊基底函數辨識器運作過程中，主要有以下幾項工作：接收辨識器的輸入、模
糊基底函數運算、模糊推論、競爭比較、輸出結果。因此控制電路以有限狀態機實現，其狀
態如圖 10 所示： 
 
資料、位址
匯流排
串列傳輸
（RS232）
三軸加速度計
（肢體行為）
嵌入式系統
（ARM CPU） FPGA
 
圖9 人類肢體感測軟硬體混合系統。 
15 
 
 1.3.3 ARM 嵌入式系統核心與週邊硬體之溝通 
將特殊的辨識器架構實現成特殊用途積體電路(Application Specific Integrated Circuit, 
ASIC)，並實現於 FPGA 可加速辨識的速度。若要整合 ARM 嵌入式系統與 FPGA 共同運作，
則需要建立 ARM 嵌入式系統與 FPGA 溝通的管道。我們預計以 ARM 嵌入式系統當中的
AHB-BUS(Advanced High-Performance Bus)來作為溝通的管道，然後將 FPGA 實現為一個
AHB-Slave，其示意圖如圖 12 所示，此介面為 ARM 嵌入式系統透過 AHB-BUS 與數位電路
溝通的標準介面。AHB-Slave 內包含 AHB-BUS 與特殊用途積體電路的介面 Wrapper，負責
將 ARM 嵌入式系統傳入的資料轉換成輸入到 ASIC 的訊號。 
我們將以一個九個輸入，五個輸出的模糊基底函數辨識器作為說明 ARM 嵌入式系統與
FPGA 溝通的範例。此架構實現於 ASIC 後的輸出輸入如圖 12 中內部的 FBF 所示，此 FBF
模組共有六個輸入以及六個輸出；啟動的方法為：先由寫入訊號 (write)配合寫入地址
(write_addr)以及資料(data)對此系統寫入資料（辨識器的九個輸入數值），然後拉起開始(start)
訊號啟動系統執行運算；在系統完成運算後，後端的完成(rdy)訊號會升起，五個輸出值也會
輸出，等待使用者讀取。當使用者拉起重置訊號或者是再次以開始訊號啟動運算時，完成訊
號就會降下來。在此範例中，Wrapper 以一個有限狀態機的形式實現。ARM 嵌入式系統的
AHB-Slave 的標準輸入全部輸入到 Wrapper 中，然後以 Wrapper 的輸出作為辨識器的輸入。
每當 ARM 嵌入式系統透過 BUS 對此 AHB-Slave 寫資料時，Wrapper 中的有限狀態機的狀態
就會變換。當系統開啟時，Wrapper 會處在閒置狀態，然後接下來 ARM 嵌入式系統對此
AHB-Slave 寫入的九筆資料，即為 ARM 嵌入式系統要輸入到模糊基底函數辨識器的輸入資
料，因此在此九個狀態變化時，輸入到模糊基底函數辨識器的寫入地址(write_addr)、寫入資
料就會順序改變，同時寫入訊號也會拉起，完成 ARM 嵌入式系統將資料輸入到辨識器的工
作。接下來 ARM 嵌入式系統對 AHB-Slave 寫入時，即為啟動模糊基底函數辨識器運作，此
時 start 就會升起，使得此模糊基底函數辨識器開始運算。待 HREADY 拉起時，ARM 嵌入
式系統即可以將系統運算的值讀取回進入 ARM 嵌入式系統的記憶體當中。 
 
 
HCLK
Transfer
response
AHB
slave
All of input 
from outside
HADDR[31:0]
HWDATA[31:0]
HWRITE
HTRANS[1:0]
HSIZE[2:0]
HBURST[2:0]
HRESETn
HSELx
HRDATA[31:0]
HREADY
HRESP[1:0]
Data
FBF
Wrapper
out_1
out_2
out_3
out_4
out_5
rdy
clk
rst
start
write
write-addr
data
 
圖12 AHB-Slave內部架構圖。 
17 
 
 
2.2 手寫文字軌跡重建演算法 
 2.2.1 軌跡重建演算法 
軌跡重建演算法包含了慣性感測器校正、慣性感測訊號濾波、姿態估測、座標轉換、重
力補償與軌跡估測等工作來進行重建使用者在三維空間中書寫或繪畫的軌跡，軌跡重建演算
法流程，如圖 14 所示。 
 慣性感測器校正 
在慣性感測器的校正方面有兩個重要的參數，分別為比例因子(scale factor)與偏差值
(bias)。比例因子的定義為慣性元件所受的物理量(加速度、角速度)變化時與相對應的輸出電
壓變化之比值；偏差值的定義為某一特定時間的感測器平均輸出並且與輸入沒有關係。在三
軸加速度計的校正方面，我們直接參考加速度計出廠時產品規格表中每一軸向的比例因子及
偏差值數值來當加速度計校正中的比例因子(SFacc)及偏差值(Bacc)，其中 SFacc 的單位為每重
力加速度所對應之電壓(V/g)，Bacc 的單位為電壓(V)。最後，可以經由一線性方程式來加以
校正加速度計： 
 
 
,acc accc
acc
V B
A
SF


 
(24) 
 
其中，Vacc為加速度計每一軸向的電壓輸出值，單位為電壓(V)；Ac為加速度值，單位為重力
加速度(g)。在陀螺儀的校正方面，由於其比例因子仍頇依靠外部感測器(例如：傾斜計或磁
力計)提供參考輸出值而求得，而且在陀螺儀方面其主要的誤差來源為偏差值的漂移量。因
此，我們可以直接參考陀螺儀感測器出廠時產品規格表中每一軸向的比例因子數值來當作陀
螺儀校正中的比例因子參數(SFgyro)，其單位為每角速度所對應之電壓(V/°/s)。接著，每一軸
向的偏差值(Bgyro)可以經由當陀螺儀靜止平放時的某一時間區間的角速度平均讀值而得知，
其單位為電壓(V)。最後，可以經由一線性方程式來加以校正陀螺儀： 
 
 
,
gyro gyro
c
gyro
V B
SF



 
(25) 
 
 
圖13 慣性雷射簡報筆之電路實體圖。 
 
19 
 
 
2 2 2( ) ( ) ( ) ( ) 1 ,Ab bx by bzE k A k A k A k   
 
(27) 
 
2 2 2( ) ( ) ( ) ( ),b bx by bzE k k k k     
 
(28) 
 
其中 EAb(k) 和 Eωb(k)分別代表時間 k 的加速度及角速度訊號振幅；Abi和 ωbi分別代表前處理
後感測器座標中的加速度和角速度(i 代表 x，y 或 z 軸)。一旦判斷出慣性雷射簡報筆為靜態
或動態狀況後，我們即可分別利用靜態及動態姿態估測演算法來估測慣性雷射簡報筆在三維
空間中的姿態。 
靜態姿態估測： 
    當慣性雷射簡報筆靜置時，加速度計只會量測到重力加速度，而重力加速度的方向正好
與參考座標中的第三個基底平行。因此我們可以利用這樣的關係找出加速度計相對於參考座
標系的兩個姿態角。根據感測器座標轉換至參考座標的旋轉順序為( →θ→ψ)，我們可先求
得滾轉角( )再求得俯仰角(θ)。由於反正切函數(arctan)的值域限制，因此我們必頇考慮以下
三種情形來計算滾轉角( )： 
(1) 當加速度計 Z 軸讀值(Abz)小於零時，滾轉角( )可藉由加速度計 Y 軸讀值(Aby)與 Z 軸讀
值(Abz)來加以求得： 
 
 1tan ( ).
by
bz
A
A
   (29) 
 
(2) 當加速度計 Z 軸讀值(Abz)大於零且 Y 軸讀值(Aby)大於零時，滾轉角( )為 
 
 1tan ( ).
by
bz
A
A
      (30) 
 
(3) 當加速度計 Z 軸讀值(Abz)大於零且 Y 軸讀值(Aby)小於零時，滾轉角( )為 
 
 1tan ( ).
by
bz
A
A
     (31) 
 
求得滾轉角( )後，反正切函數的值域便足夠用來計算俯仰角(θ)，其計算式如下： 
 
 
1
2 2
tan ( ).bx
by bz
A
A A
 

 (32) 
 
但是由於利用加速度計來估測姿態角時，並無法得知偏航角(ψ)。因此，通常皆會將偏航角(ψ)
設定為零。接著我們透過(33)式將姿態表示法轉換為四元素表示法以利後續計算。 
 
21 
 
 ,r A A G  (37) 
 
其中 A = [Ax, Ay, Az]
T重力補償後的加速度值，G = [0, 0, -1]T為參考座標中的重力加速度值。 
 軌跡估測 
    感測器在運動中的速度及位置(或軌跡)是隨著時間而改變，重力補償後的加速度可經由
一次及兩次積分分別得到其速度及位置(或軌跡)，如(38)及(39)式所示。 
 
 
0
( ) (0) ( ) ,
t
t
t d   V V A  (38) 
 
0
( ) (0) ( ) ,
t
t
t d   P P V  (39) 
 
其中t代表終止時間，t0代表起始時間，A為重力補償後加速度值，V為一次積分後的速度及P
為兩次積分後得到的位置或軌跡。 
 2.2.2 動作姿態辨識演算法 
此動作姿態辨識演算法利用了慣性雷射簡報筆所感測到的加速度值來實現游標速度控
制及滑鼠點擊與視窗切換等兩個功能，以下就這兩功能進行介紹。 
 游標速度控制 
    游標速度(Ｖcursor)是利用慣性雷射簡報筆本身的俯仰角( ' )及滾轉角( ' )來進行控制，其
中俯仰角是用來控制游標的上下移動，而滾轉角則是用來控制游標的左右移動；角度的大小
與否則決定游標移動的速度。(40)及(41)式分別代表利用加速度值來求得俯仰角及滾轉角。 
 
 
1
2 2
( )
( ) tan ( ),
( ) ( )
by
bx bz
A k
k
A k A k
  

 (40) 
 
1
2 2
( )
( ) tan ( ),
( ) ( )
bx
by bz
A k
k
A k A k
  

 (41) 
 
待角度大小計算完成後，透過(42)式我們將角度的大小對應到相對的游標移動速度。當計算
的角度小於十度時，游標速度(Ｖcursor)被設定為零，以方便使用者在螢幕上固定游標位置；
另一方面，當計算的角度大於十度時，游標速度(Ｖcursor)與角度的平方成正比，其目的在於
讓使用者得以迅速地將游標移動至目的地，更能準確地點擊目標物。 
 
 , 2
0,       if <10 ,
,    if 10 ,
cursor iV
c

 

 

 (42) 
 
其中Ｖcursor為游標移動的速度，其單位為 pixels/Ts，i 為螢幕上 x 或 y 方向，φ可為俯仰角或
滾轉角，而 c 為常數。 
23 
 
 
 
(三) 結果與討論 
研究子題一：具人類肢體動作辨識之互動式遊戲操控系統 
現今娛樂遊戲可分成動作、冒險、益智、角色扮演、模擬運動及混合型等多種類型，而
每一種類型的遊戲皆有專屬於他們的遊戲風格及玩法。遊戲機的發展可由早期的日本任天堂
所開發的任天堂紅白機(family computer)、超級任天堂(super famicom)到任天堂 64 (Nintendo 
64)；日本新力(SONY)所開發之 PlayStation (PS)、PlayStation 2 (PS2)到 PlayStation 3 (PS3)；
及微軟所開發之 Xbox 360。但是以上這些遊戲機皆還是以雙手操控的搖桿為主。近來相當
熱門的日本任天堂 Wii，是一個相對於人類較為直觀的操控方式，玩家只需單手握著一支以
加速度計及紅外線無線傳輸整合的手把，即可進行遊戲操控。然而，目前的 Wii 遊戲僅針對
慣性訊號進行簡易的門檻值進行動作之判斷，並未使用動作或姿態之慣性訊號辨識技術來進
行遊戲操控。本研究子題除了使用動作姿態辨識的觀念外，更進一步地利用自行開發之人類
肢體轉向估測演算法系統來重建玩家在運動時在三維空間中所產生的身體姿態及動作變
化，比 Wii 的操控更直觀也更具三維空間的真實性。我們冀望能夠將本研究子題的慣性感測
電路模組及體感演算法利用軟硬體混合系統整合成單一模組並應用於遊戲系統中。接下來我
們將以圖形化驗證平台呈現所開發的人類肢體動作姿態辨識系統，同時本研究子題將結合人
 
慣性感測模組接收端
USB
RF
慣性感測傳送端
ARM嵌入式系統
驅動程式
Linux作業系統
USB
軌跡重建演算
法之應用程式
人機介面操作模組
無線網路
數學函式庫
動作姿態演算
法之應用程式
 
圖16 ARM嵌入式系統架構圖。 
 
 
圖15 軌跡重建可攜式系統之架構圖。 
25 
 
 
 互動式鹽水蜂炮 
    互動式鹽水蜂炮遊戲畫面如圖 19 所示。在本研究子題中我們利用 Quest3D 系統設計出
一互動式鹽水蜂炮遊戲系統，互動式遊戲背景設定於台南鹽水街景，並設計成單一環狀街
道。街道上擺放了數十座會不斷發射出蜂炮的炮城，玩家可操控互動式遊戲場景的虛擬人物
來閃避蜂炮或被蜂炮撞擊。玩家操控互動式遊戲中的虛擬人物是以第三人稱的方式控制，虛
擬人物依照玩家的操控，能做左右旋轉或前進後退的動作。在互動式鹽水蜂炮遊戲中玩家只
要在鍵盤按向上鍵虛擬人物即可向前走、按 1 鍵虛擬人物會向前慢跑、按 2 鍵虛擬人物會向
前快跑而按左右鍵可以控制虛擬人物的旋轉方向。經由前述以慣性感測電路模組玩馬力歐賽
車的概念，玩家可以做出走路、慢跑與快跑等動作，然後利用配戴於玩家身上的慣性感測模
組後做出動作姿態辨識後以決定互動式遊戲場景中的虛擬人物應該是要做出走路、慢跑或快
跑哪一種動作。而配戴於玩家頭部的磁力計模組做出玩家頭部的肢體轉向估測，如此可以控
制互動式遊戲中虛擬人物行進方向的控制。 
 
 
研究子題二：具動作軌跡重建之慣性雷射簡報筆 
藉由完成本慣性雷射簡報筆系統，本研究團隊已開發以下三種功能模式：(1)手寫字元輸
入模式、(2)網頁瀏覽器操控模式及(3)螢幕游標控制模式。 
(1) 手寫字元輸入模式：使用者在不受限制的空間中，可以凌空使用慣性雷射簡報筆書寫任
意字元，其軌跡會經由 ARM 嵌入式系統內建的軌跡重建演算法來加以重建。結合微軟
 
圖19 互動式鹽水蜂炮遊戲場景畫面。 
 
圖18 馬力歐賽車遊戲場景畫面。 
27 
 
六自由度運動平台之移動軌跡重建： 
    在此實驗中我們以重建一圓形軌跡為例。首先，我們將對六自由度運動平台輸入一圓形
軌跡；接著，我們將所收到的訊號利用軌跡重建演算法進行重建。圖 21 為軌跡重建演算法
之過程結果圖。 
 
手寫數字軌跡重建與辨識： 
    此實驗中，總共有 10 位受測者參與實驗。每位受測者被要求寫 10 個不同的阿拉伯數字
(由“0”到“9”)，並且每個數字皆頇寫 10 次。因此經由軌跡重建演算法後，總共會產生
1000 個重建的數字軌跡，其重建後的數字軌跡如圖 22 所示。接著，每個重建後的數字軌跡
皆會被傳送至微軟系統的文字符號辨識器(Windows Tablet PC 文字輸入面板)進行辨識，其辨
識達到 94.6%的準確性。 
 
(a)                                      (b) 
 
(c)                                       (d) 
 
(e) 
圖21 圓形軌跡重建演算法之過程結果圖。(a)原始加速度訊號，(b)感測器座標系上已濾波之
加速度訊號，(c)參考座標系上已濾波之加速度訊號，(d)重力補償過後的加速度訊號，(e)重
建之移動路徑軌跡。 
 
29 
 
[6] Z. Liang, Y. Li, and P. Shi, “A note on two-dimensional linear discriminant analysis,” Pattern 
Recognition Letters, vol. 29, no. 16, pp. 2122-2128, 2008. 
[7] C. H. Park and M. Lee, “On applying linear discriminant analysis for multi-labeled 
problems,” Pattern Recognition Letters, vol. 29, no. 7, pp. 878-887, 2008. 
[8] A. Tsymbal, S. Puuronen, M. Pechenizkiy, M. Baumgarten, and D. Patterson, 
“Eigenvector-based feature extraction for classification,” in Proc. of the Fifteenth 
International Florida Artificial Intelligence Research Society Conference, 2002, pp. 354-358. 
[9] C. Verplaetse, “Inertial proprioceptive devices: Self-motion-sensing toys and tools,” IBM 
Systems Journal, vol. 35, no. 3-4, pp. 639-650, 1996. 
[10] L. X. Wang and J. M. Mendel, “Fuzzy basis functions, universal approximation, and 
orthogonal least-squares learning,” IEEE Trans. Neural Networks, vol. 3, no. 5, pp. 807-814, 
1992. 
[11] S. Wang, J. Yang, N. Chen, X. Chen, and Q. Zhang, “Human activity recognition with 
user-free accelerometers in the sensor networks,” in Proc. of IEEE Int. Conf. Neural Networks 
and Brain, vol. 2, 2005, pp. 1212-1217. 
[12] J.-S. Wang, Y.-L. Hsu, and J.-N. Liu, “An Inertial-Measurement-Unit-Based Pen with a 
Trajectory Reconstruction Algorithm and Its Applications,” IEEE Trans. Industrial 
Electronics, vol. 57, no. 10, pp. 3508-3521, 2010. 
[13] H. Zheng, N. D. Black, and N. D. Harris, “Position-sensing technologies for movement 
analysis in stroke rehabilitation,” Medical and Biological Engineering and Computing, vol. 
43, no. 4, pp. 413-420, 2005. 
 
四、 計畫成果自評 
計畫執行至今，已有四篇期刊論文及兩篇研討會論文被接受，另有六篇專利正在申請當
中，並已著手撰寫投稿五篇期刊論文於國際期刊；並預計將嵌入式系統實作成果投稿至國際
研討會以及國際期刊論文。本研究團隊報名參加近三年之全國競賽，皆屢獲佳績。並且於「旺
宏金矽獎」半導體設計與應用大賽中榮獲評審團鑽石大賞、最佳指導教授獎及最佳創意獎、
「2009 ARM Code-O-Rama 設計大賽」中榮獲冠軍、「中華電信 2009 電信加值應用大賽」中
榮獲亞軍。本研究團隊將持續將相關之研究成果實現於硬體並持續參加國內競賽，並發表論
文於國際期刊及研討會。 
 
 
98年度專題研究計畫研究成果彙整表 
計畫主持人：王振興 計畫編號：98-2221-E-006-193- 
計畫名稱：以慣性感測元件為基礎的動作辨識與軌跡重建之演算法開發：實現互動式遊戲操控平台與
慣性雷射簡報筆 
量化 
成果項目 實際已達成
數（被接受
或已發表）
預期總達成
數(含實際已
達成數) 
本計畫實
際貢獻百
分比 
單位 
備 註 （ 質 化 說
明：如數個計畫
共同成果、成果
列 為 該 期 刊 之
封 面 故 事 ...
等） 
期刊論文 1 1 100%  
研究報告/技術報告 0 0 100%  
研討會論文 0 0 100% 
篇 
 
論文著作 
專書 0 0 100%   
申請中件數 5 5 100%  專利 已獲得件數 0 0 100% 件  
件數 0 0 100% 件  
技術移轉 
權利金 0 0 100% 千元  
碩士生 1 1 100%  
博士生 1 1 100%  
博士後研究員 0 0 100%  
國內 
參與計畫人力 
（本國籍） 
專任助理 0 0 100% 
人次 
 
期刊論文 1 3 100%  
研究報告/技術報告 0 0 100%  
研討會論文 0 0 100% 
篇 
 
論文著作 
專書 0 0 100% 章/本  
申請中件數 0 0 100%  專利 已獲得件數 0 0 100% 件  
件數 0 0 100% 件  
技術移轉 
權利金 0 0 100% 千元  
碩士生 0 0 100%  
博士生 0 0 100%  
博士後研究員 0 0 100%  
國外 
參與計畫人力 
（外國籍） 
專任助理 0 0 100% 
人次 
 
 
