II 
 
 
摘要  
肝癌不僅是全世界最常見的癌症之一，根據衛生署的統計，過去二十多年來，肝癌一
直高居國內癌症死亡原因第一、二名。而肝臟中的腫瘤可分成惡性和良性。惡性腫瘤又包
括很多種，如：肝癌、膽管癌、淋巴癌、惡性肉瘤…等；而良性的腫瘤也有很多種，如局
部結節性增生、腺瘤、囊腫、血管瘤再生性結節…等。不同的狀況其治療方式與疾病預後
會有相當大的差異，因此必須利用各種方式來做最正確的鑑別診斷。雖然超音波、X 光和
核磁共振等的檢測方法可以檢測出肝臟病變，然而肝臟的病理切片卻能提供肝癌最準確的
資訊。而其中腫瘤細胞分級結果對於肝癌治療和預後尤其具有很大的影響。然而分級的標
準是主觀的、非量化的，因此常會因主觀的認定而出現不一致的結果，尤其是在一些非典
型分級的肝癌細胞更是容易有分歧的意見。因此我們針對腫瘤病理切片的影像建立一個快
速相似性比對機制，使醫師做診斷有必要時可以針對有疑慮的幾個切片影像進行以內容為
基礎的類似性快速比對，自以往病例中搜尋出較類似的切片影像，檢視其診斷結果和相關
診療過程作為參考，讓醫師可以更快速而正確的進行診斷。利用相似性比對的技術，自資
料庫中擷取出相似特徵的切片影像以及其病歷，藉此來輔助醫師進行判讀。  
 
關鍵字：肝臟病理切片，相似性擷取，支持向量機，肝癌病理分級 
IV 
 
目錄 
一、前言 ........................................................................... 1 
二、研究目的 ....................................................................... 1 
三、文獻探討 ....................................................................... 2 
四、研究方法 ....................................................................... 2 
1、肝腫瘤切片影像收集和影像特徵分析 .............................................. 2 
2、各項分級標準的特徵抽取 ........................................................ 3 
3、分級、可靠度分析及相似性擷取 .................................................. 5 
五、結果與討論 ..................................................................... 7 
1、分類的效率評估 ................................................................ 7 
2、查詢範例 ...................................................................... 8  
參考文獻 .......................................................................... 11  
計畫成果自評 ...................................................................... 13 
 
2 
 
這兩種輔助的方式，首先進行分類，再執行分類結果的可靠度分析，提供醫師這個分類結
果的可信賴程度，讓醫師決定是否採用，如果不採用分類結果則執行相似性擷取，作影像
比對及病歷參考，由此可以改進輔助診斷的效率，兼顧便利性和正確性。 
 
三、文獻探討 
近幾年有相當多的病理切片影像分析方法被提出來，Michael [8]使用紋理特徵來分析
細胞影像。Jean[9]提出一個以形狀和大小為基礎的癌腫瘤組織自動辨識系統。Frank 則提
出一個系統稱為 Biopsy Analysis Support System (BASS) [10]，它能偵測以 monclonal 
antibodies 染色的乳癌的細胞核。 
Abdeltahim[11]則發展了一個以紋理特徵區分正常以及癌化的結腸黏膜。Barbara et 
al. [12]則採用 Syntactic structure analysis 來進行自動化分析。Kourosh[13]則針對
整張影像抽取小波特徵來進行分析。以上的研究多著重在影像分析後直接進行分級，將結
果提供給醫師作為參考，而醫師必須決定採用或拒絕其所產生的分級結果。因此分級診斷
結果的正確與否仍和醫師的經驗有很大的的關係。因此比較合適的輔助方式是將醫院所有
的歷史影像加入影像資料庫，利用 Query-by-example 的查詢方式擷取出相關的影像，再參
考其病歷以及其後來病情的發展來做一個更正確的分級。尤其是在具爭議性的影像中，例
如某些分級標準已經可以分到等級 4，可是其他分級標準卻被認為是正常，這個輔助方法
會更具實用性。 
 
四、研究方法 
1. 肝腫瘤切片影像收集和影像特徵分析 
我們實驗中所有使用的影像都是經由下面的過程取得：肝組織可用細針抽取或手術取
得，經過福馬林固定和化學藥水處理後，以蠟塊包埋，再切成非常薄的薄片並固定在玻片
上，以 Hematoxylin & Eosin(H&E)染色後，置於 400 倍的顯微鏡下以 4080×3072 的高解析
度取像。最後再由資深病理醫師參考其病歷給予正確的分級。前述的 6 項分級標準都是和
細胞核相關，所以細胞核含有主要的辨識特徵，因此系統的第一個步驟是細胞核切割。如
圖 1 所示，細胞核在 H&E 染色後輪廓和核仁會吸收 Hematoxylin 而呈現藍色，但因細胞垂
   
         (a)                   (b)                   (c) 
   
         (d)                   (e)                   (f) 
圖 1、使用 DMR 進行細胞核輪廓增強的範例 
4 
 
  
Cell size (F3): 
( )_ ( ) _ ( )
v T
area n v area c v V∈
+∑      (3) 
 
y Criteria 2:核形狀的不規則性 
細胞核的形狀是另一項重要的資訊，在等級 0 中核的形狀是非常接近正圓。等級越高，
核的形狀就越不規則，例如，在等級 2 中，核會呈現橢圓，而等級 3 則會有尖銳的夾角出
現等等。因此針對這個標準我們使用了三個特徵:似圓性(Circularity)[16]、面積不規則性
(Area irregularity)輪廓不規則性(contour irregularity)。似圓性將圓和欲檢視形狀的差距量
化，可以檢測出核大致的形狀的差異，其公式如下: 
 
Circularity (F4) : 
24
Area
Circumference
π× ×       (4) 
 
但是似圓性只比較面積的不同，對於其外形的
變化，並不能完全正確的比對出來。而面積不規則
性可以處理面積和圓形接近，但外形有明顯差異的
核。如圖 3 所示，首先以 Minimum Bounding 
Rectangle (MBR)框住細胞核，四邊和核相接的點各
以水平和垂直的方向將核切成 4 個區域，分別是
S1、S2、S3 和 S4，再以下面公式計算其各區域差
異最小值，如果形狀越不規則，則值會越大。 
 
Area irregularity (F5):  
4
1...4,1
1 min ( ) ( )
4 j j ii
area Si area Sj= ≠=
−∑    (5) 
  
另外尖銳角度的出現暗示著更高的分級，可是輪廓出現尖角會使面積不規則性的區分能
力不穩定，所以直接以曲線弧度來偵測輪廓短距離間角度劇烈的變化會是一個很有用的特
徵。將輪廓上的像素依序的表示為{p0 p1 p2 ... pj-w … pj …pn-1}，其中 pt=pt+n ，t=... -1 0 1….，
則輪廓上的一的點 pj=(xj yj)的在一個視窗 w 內的曲度可以表示為[17] 
1 11 1
1 1
tan tanj j w j j wj
j j w j j w
y y y y
d
x x x x
− − − −− −
− − − −
− −= −− − .    (6)  
 
Contour irregularity (F6): 
1
1
0
n
j j
j
d d
−
−
=
−∑             (7) 
 
y Criteria 3:核濃染(Hyperchromatism) 
細胞核內的染色質會隨著等級的增高而增加染色的程度，在正常的細胞內則不會有過染的
情形發生， 因此我們採用兩種特徵來表示：平均亮度(average intensity)、B/D spot ratio。 
 
P4
S1
S2 S3
S4
P1
P2
P4
P3
S2
S1
S4
S3
P1
P2
P3
   (a)圓形核        (b)形狀不規則的核 
圖 3. 面積不規則性的範例
6 
 
各個分級資料產生設定一組權重，對於同一分級的任兩組特徵向量 x,y ∈ Rn，令轉換矩陣
W如下， 
⎥⎥
⎥⎥
⎥⎥
⎦
⎤
⎢⎢
⎢⎢
⎢⎢
⎣
⎡
=
nnnn
n
n
www
www
www
W
..
..
..
..
..
21
22221
11211
 
然而我們只針對個別特徵加權重，所以設 Wij=0, for i≠j，則轉換後的新特徵向量是 x`=Wx, 
y`=Wy, 則兩者的距離 ( ) ( )∑
=
−=
n
i
jiii yxwyxd
1
22','  ，∑
=
=
n
i
iiw
1
1。 
則 Intraset Distance ( ) ( )∑
=
=
n
i
iiiwCD
1
22 2' σ ，下面是最小化的求解 
( )∑ ∑
= =
⎟⎠
⎞⎜⎝
⎛ −−=
n
i
n
i
iiiii wwA
1 1
2 12 ασ  
niw
w
A
iii
ii
≤≤=−=∂
∂ 1  ,04 2 ασ
 
∑∑
=
−
=
−
== n
i
ii
iin
i
i
wand
1
22
1
2
1   4
σσσ
α        (10) 
而相似度擷取所使用的距離擇定義如下，令 NFAi 和 NFBi 分別是影像 A,B 的特徵 FAi 和
FBi正規化後的特徵值，wii為其權重，其中 i=1~14，則影像 A，B的距離為: 
( )∑
=
−=
14
1i
BiAiiiAB NFNFwDistance           (11) 
最後組織我們的系統架構如圖 4所示，在切片影像在經過切割和特徵抽取之後，以 SVM
分類器分類得到分類結果，以這個分類結果來選擇可靠度分析中所使用的權重組，可靠度
分析後再以臨界值來決定是否接受這個分類結果或執行相似度擷取，這個臨界值可以預設
或由醫師決定。 
 
8 
 
2. 查詢範例 
 
2.1 典型影像範例 
圖 6是醫師上傳查詢的影像，經過切割和特徵擷取後，以 SVM 進行分類，得到分級結
果為 Grade3。 
 
     圖 6. 欲查詢玻片影像 
 
可靠度分析取用分級 3 的權重，計算相似度最高的前 10、20、30、40、50 張影像中，
同樣也是屬於 Grade3 的影像，所佔的比率有多少。圖 7是圖 6影像的測試結果，透過這些
數值可以了解該特徵向量在特徵空間中所處的區域同一分級的群聚情形，利用公式(12)得
到可靠度計量，來評斷這個分級結果的可信賴程度。 
 
圖 7.群聚測試的結果 
∑=
k
kiiTopwReliablity           (12) 
iiw ：權重    kTop ：資料群聚分類正確率  k=10,20,30,40,50 
           
以本範例這張影像來說，Top10~30 群聚的程度都是 100%，Top40 和 50 都還有 90%
以上的正確性，計算其 Reliablity 得到影像可靠度分析值為 1，故可以瞭解到，這張上傳
的影像是可靠度是非常高的，所以是很典型的 Grade 3 影像。 
  
2.2 非典型影像範例 
圖 8是使用者上傳影像，經過切割和特徵擷取後，以 SVM 進行分類，得到分級結果為 Grade 
2。圖 9是群聚測試結果，數值顯示出特徵空間上該區域同一分級並不多，Top10 群聚程度
只有 40%，而 Top50 時只剩下 32%，最後影像可靠度分析值為 0.35。故這張上傳的影像，
是屬於非典型的分級，醫師對於這類影像可以進行相似性擷取， 圖 10 是進行相似性擷取
的分級情形。 
10 
 
 
          圖 11.使用者查詢畫面 
 
 
 
            圖 12. 影像相似性擷取查詢結果 
 
 
12 
 
[18] A. Moragas, M. Garcia-Bonafe, I. de Torres, and M. Sans, Textural Analysis of Lymphoid 
cells in serous effusions. A Mathematical Morphologic Approach, Analytical and 
Quantitative Cytology and Histology, Vol. 15, No. 3, Jun. 1993, pp. 165-170. 
[19] Linda G. Shapiro and George C. Stockman, Computer Vision, Prentice Hall, 2001. 
[20] Robert Haralick, K. Shanmugam, and Its’hak Dinstein, Texture Features for Image 
Classification, IEEE Transactions on Systems, Man, and Cybernetics, Vol. SMC-3, No. 6, 
Nov. 1973, pp. 610-621.  
[21] Robert Haralick, Statistical and Structural Approaches to Texture, Proceedings of the IEEE, 
Vol. 67, No. 5, May 1979, pp. 786-804. 
[22] Chih-Chung Chang and Chih-Jen Lin, LIBSVM: A Library for Support Vector Machines, 
2001. Software available at http://www.csie.ntu.edu.tw/~cjlin/libsvm. 
[23] Menahem Friedman, Abraham Kandel, Introduction to Pattern Recognition, Imperial 
College Press, 1999, pp. 147-153  
