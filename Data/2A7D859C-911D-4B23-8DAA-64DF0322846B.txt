1 
 
中英文摘要 
 
本計畫設計了一個適合 PDA 的資料分享系統。以隨意模式的無線區域網路為架構，
建構一個以轉送群為技術的資料分享平台。不需要基礎基台、伺服主機、複雜的路由傳
輸協定，利用無線訊號廣播傳輸的特性，以主動推播及轉送的技術，實現方便、迅速及
有效的資料分享應用，結合隨意網路隨時隨地可架設的優點及無線裝置輕巧可攜帶的便
利，提供無線裝置可以隨時應用的環境，擴展無線裝置在無線網路中的應用價值。 
。 
 
關鍵詞：PDA，隨意網路，推播轉送，分享平台。 
 
Abstract 
 
To enhance and improve the diversity of applications for mobile devices, this project 
designs and develops a sharing platform for mobile devices using forwarding technique 
under mobile ad hoc mode networks (MANET).  No access points and servers are necessary 
in the ad hoc networks, and different from traditional networks, no routing protocols are used 
to forward packets in the platform.  A self-organized forwarding scheme is proposed to 
forward the shared applications.  Various sharing applications including audio/video data 
are planned into the platform to provide mobile device users with useful and helpful 
experiences. The advantages of MANET are rapid deployment and flexible management, 
thus making the sharing platform more valuable for mobile device applications. 
 
Keywords: PDA, Ad Hoc Networks, Push casting, Forwarding, Shared Platform. 
 
報告內容 
一、前言及研究目的 
『行動裝置』（Mobile Devices）具有無線網路及可移動的特性，許多的個人行動
裝置除了具有強大的作業系統及多元的應用軟體外，都配備了無線通訊的能力，包括紅
外線（Ir）、藍芽（Bluetooth）、WiFi[1]及 WiMax，加上 GPRS[9]及 3G 的行動通訊，
「無線上網」已是愈來愈普遍也愈來愈方便的網路通訊及傳輸方式。本計畫針對具備
WiFi 連線功能的 PDA 為研發對象，設計開發一個可分享資料的應用平台。 
WiFi 無線區域網路的運作模式有兩種：『基礎架構模式』（Infrastructure）及『隨意
模式』（Ad Hoc）[10]。基礎架構模式的運作是每個『無線裝置』（Wireless Station）只
能與『基礎基台』（Access Point）連線通訊，無線裝置間彼此無法直接連線通訊，基礎
基台除了提供無線裝置連線通訊外，也可以與 Internet 連線，無線裝置透過基台便可以
連線上 Internet。在隨意模式運作的無線區域網路內，無線裝置只能與其他無線裝置互
連，不能連線上基台。基礎架構模式的無線區域網路因為可以透過基台連線上網際網
路，大部分的無線區域網路都採用此模式來運作，只要基礎基台的訊號能夠接收得到，
無線裝置便可很容易地連線上網。而隨意模式無線區域網路的好處是不需要架設基礎基
台，只要將無線裝置的無線網路模式設定成隨意模式，無線裝置間便可直接利用無線訊
號來傳輸資料。 
基礎架構模式的無線區域網路最嚴重的缺點是：一旦基礎基台故障或是收訊不
到，無線裝置便無法使用無線網路連線上 Internet，同時因為基礎基台的無線訊號有效
傳送距離不長，使得無線裝置的網路應用只局限於有基礎基台的無線網路環境。本計畫
3 
 
簡單有效地達到資料傳送的目的；另外一個特點是，本計畫的方法不需要路由協定
（Routing）[7][8]，以簡單的隨意群播轉送，達到群播資料的應用。 
 
封包轉送點的產生 
本系統將利用無線網路訊號本身就具有廣播的特性來分享資料，每一個 PDA 都可
以利用無線廣播將資料傳輸給相鄰 PDA，不相鄰的 PDA 無法傳遞資料，因此我們需要
資料轉送的機制，將封包傳遞到其他不相鄰 PDA。哪些 PDA 必須負責轉送？如果每個
PDA 都廣播轉送資料（Flooding），封包將被重複廣播轉送，形成類似廣播風暴，網路
效能將降低。如何選擇適當的轉送點（Forwarding Points），甚至是最少的轉送點，就
能將資料廣播轉送至整個網路是主要的關鍵。本計畫採用叢集（Cluster）[1][5]觀念設計
了一個分散式的方法來決定轉送點，演算法描述如下： 
自主形成轉送群演算法（Self-Organized Forwarding Group Algorithm：簡稱 SOFG）： 
代號說明： 
PDAi：行動裝置 i 
IDi：PDAi之識別碼 
NIDi：與 PDAi之相鄰且未定叢集角色之 PDA 的識別碼之集合 
NCHi：PDAi之相鄰叢集中心的集合 
Min(NIDi)：集合 NIDi中最小的識別碼 
Ci：PDAi叢集角色。Ci = -1，PDAi之叢集角色未定；Ci = 1，PDAi是叢集中心； 
Ci = 0，PDAi已有所屬叢集 
FPi：PDAi轉送功能之狀況。FPi = 0，PDAi不負責轉送封包；FPi = 1， 
PDAi負責轉送封包 
Sendi(τ,data)：PDAi每隔時間τ週期性地廣播 data（表 1） 
 
初始狀況：Ci = -1; FPi = 0; NIDi = ∅; NCHi = ∅ 
步驟 1：每個 PDAi週期性地廣播自己的 IDi、Ci、NCHi ， 
Sendi(τi1, {IDi、Ci、NCHi }); 
步驟 2：PDAi收到相鄰 PDAj的 IDj、Cj、NCHj後， 
if ( Cj== -1 )     ［條件 1］ 
NIDi = NIDi ∪ {IDj} ; 
if ( Cj== 0 ) 
if ( Ci == -1 )    ［條件 2］ 
NIDi = NIDi − {IDj}; 
if ( Ci == 0 && (NCHj ⊃ NCHi || (NCHj = NCHi && IDj < IDi) ) )  ［條件 3］ 
FPi = 0; 
if ( Cj== 1 )   
if ( Ci== -1 || ( Ci== 1 && IDj < IDi ) )［條件 4］ 
Ci = 0; 
NIDi = NIDi − {IDj}; 
NCHi= NCHi ∪ {IDj}; 
if ( Cj== 1 && |NCHi| > 1 )   ［條件 5］ 
FPi = 1; 
步驟 3：在時間τi2（τi2 > τ i1）後，  
5 
 
Hop 封包被轉送次數 1 Byte 
ID PDA 之識別碼 1 Byte or 2 Bytes
Time PDA 之登入系統時間 4 Byte 
NID 
與 PDA 相鄰且未定叢集角色之
PDA 的識別碼之集合 n Byte 
NCH PDA 相鄰叢集中心的集合 n Byte 
 
表 1 中的 Seq 是封包的序號，由發送端的 PDA 產生，每發送一個封包後序號就增加 1，
每個 PDA 收到封包後會檢查（ID, Seq）資訊（查詢 SOFG 狀態表）來判斷是否為重複
封包。 
群播傳輸轉送 
結合群播傳輸，SOFG 可以提供多播傳輸應用，要分享的資料可以用廣播
（Broadcasting）傳輸方式傳送，但以廣播 IP 位址來傳送資料有一些缺點：在同網段的
所有網路設備都會接收及處理廣播封包，為了降低分享資料對不相干系統之影響及簡化
IP 位址的規劃及分配，本系統採用群播傳輸（Multicasting）[1][2][3][4][13]方式來分享
資料，群播傳輸是使用群播群組（Multicast Group）IP [14]位址，只有執行群播群組相
關軟體的網路設備才會接收及處理，沒有每台 PDA 都會接收處理的負荷及問題。我們
將採用實驗用群組 IP（224.0.1.20）為本系統分享平台系統之群組 IP，其對映的 MAC 位
址是 01:00:5E:00:01:14，只有使用 224.0.1.20 群組 IP 的軟體才會設定網路卡去擷取以
此 MAC 位址為目的 MAC 位址的封包。本系統利用群播群組 IP 位址來區隔廣播封
包，同時以群播轉送（Multicast Forwarding）的方法達到封包轉遞的功能，取代了複雜
的群播路由協定及群播管理協定。結合群播傳輸的轉送點我們稱之為群播轉送群
（Multicast Forwarding Group：簡稱 MFG）。MFG 與[2]中的 FGMP 不同，FGMP 的轉
送群是藉由路由協定來找出，而本計畫所是利用 SOFG 來形成，不需要任何路由協定。 
自動 IP 定址 
本系統是以無線訊號廣播的特性來作群播轉送，而不是利用路由（Routing）來轉遞
封包，因此 IP 位址的角色就不同於一般網路，本平台不需要路由功能，也不需要分割
網段，定址主要以群播群組的 IP 為主，幾乎可以說不需要 IP 位址。然而因為本系統還
是使用現有的 TCP/IP 網路，IP 封包表頭還是需要發送端的 IP 位址（Source IP），因
此我們還是需要每個 PDA 都有自己唯一的 IP 位址，作為識別與管理之用。本系統之
IP 位址的角色可以說是與 ID 一樣，因此我們可以將 ID 對映成 IP 位址，因為 ID 不
重複，對映的 IP 位址也是不重複。為了隨意網路的便利性，我們採用 Private IP 而不
採用 Public IP，對映的方式依據 ID 的大小來決定。加大 ID 欄位大小雖然可以有效降
低 ID 的重複機率，然而也增加系統的複雜度及資源負荷，在 PDA 有限的資源及達到
簡化系統複雜度的前題下，可以設計及調整公式(1)的 H 函數。對小範圍的隨意網路，
我們可以採用一個 Byte 的 ID 對映的 IP 位址則是 192.168.1.ID；大範圍的隨意網路 ID 
用 2 個 Bytes，對映的 IP 位址是 172.16.id1.id0，其中 ID 可以表示成 id1.id0，範例如下 
1 Byte ID :  
ID = 123 
Î  IP = 192.168.1.123 
2 Byte ID :  
7 
 
在這個網路架構系統上，本系統設計開發了能夠應用資料分享的平台，每個行動裝置可
以將想要分享的資料及應用透過本系統平台，很容易地將資料群播傳輸給所有在本系統
中的行動裝置（概念圖如圖 2）。 
主／監控角色管理 
因為是群組的分享，要使分享應用達到實用可行，必須控制 PDA 的角色，避免大
家一起分享傳送的混亂。本系統採用主控／監控的切換機制，分享應用的主控權由主控
者決定，每個 PDA 在使用分享應用前，必須先取得主控者的角色，然而才可以選擇各
種分享應用功能，任何時間整個網路系統最多只能有一個主控者；其他 PDA 都是監控
者的角色，只能監看或操作主控者所分享的應用。因此，本系統必須先解決主／監控角
色的管理機制，演算法如下： 
1. 系統一開始時，每個PDA 的角色狀況（Role）是未定（Unknown）。 
2. 在未定狀況下，每個PDA 可以點選『主控』的按鈕來取得主控者（Master）角色，
同時將主控者角色以控制封包群播給所有PDA。 
3. 在未定狀況下，PDA 如果收到主控者角色的封包，則將自己的角色設定為監控
（Slave），並更新群組成員狀態表；如果同時有一個以上的PDA宣稱是主控者，則
以ID 小的為優先。 
4. 主控者如欲結束主控，可以利用控制封包通知大家，取消其主控角色，並將自己的
角色設定為未定。 
5. 在監控狀況下的PDA 如果收到取消主控封包，則將自己的角色設定為未定，並更新
群組成員狀態表。 
6. 任何PDA 如果已處在主控或監控狀況時，如果有新的PDA 加入並宣稱是主控者
時，則不予理會。 
 
角色控制資訊可以加入表1的控制封包中傳送，我們可以在表1中增加Role的欄位並
結合『軟性狀態』（Soft State：Refresh／Timeout）機制更新狀態。在步驟2 時，如果
同時有兩個以上的PDA 點選『主控』按鈕，這時以ID 來仲裁，ID小的取得主控權。因
為是分散自主系統，各種隨機狀況都會發生，我們必須處理仲裁角色不一致的問題；步
驟6 的情況是當有PDA 新加入系統，因為還未收到角色狀態資訊，以為沒有主控者，
而想成為主控者。『軟性狀態』機制是利用週期性地更新（Refresh）及定期檢查是否有
狀態要刪除（Timeout），當狀態改變時也將立即更新。善加調整利用『軟性狀態』機
制可以降低甚至解決系統狀態不一致的問題。 
分享應用 
當 PDA 取得主控者角色後，畫面會切換到分享應用的選擇介面，選擇要分享的應
用，初步規劃的畫面介面如圖 3。本系統設計開發各種實用的分享應用，主要有四大類
（如圖 4）：檔案、聲音、視訊及即時傳訊。針對這四類的設計方法描述如下圖 4： 
9 
 
視訊分享功能包括圖片分享功能、螢幕分享功能及即時影像分享。圖片分享功
能：利用檔案分享功能改為將圖片檔案從檔案系統中讀入記憶體，將圖片檔顯現在自
己（主控端）的 PDA 螢幕上，同時利用封包轉送將圖片封包分享給群組，監控端接
收到封包後將圖片檔顯現。圖片的分享及擴放可以應用在各種展覽會場，結合 RFID
標籤，將導覽圖片編號，利用主控者 PDA 上的 RFID Reader 讀取展覽場上的 RFID 標
籤，分享相關的圖片給監控端，監控端不用一一去讀取展覽場上的 RFID 標籤，就可
看到說明圖片，對大團體的導覽幫助很大。螢幕分享功能：直接將螢幕畫面對映記憶
體資料直接傳輸，便可以達到螢幕分享的功能；藉由螢幕分享，可以將主控端使用者
的操作畫面分享給群組，包括使用者目前所執行的軟體的畫面，如此便可達到應用系
統之分享。這樣的分享功能如同電腦教室的螢幕切換，將教師的螢幕分享給學生的電
腦螢幕。不需要電腦教室專屬的軟硬體及空間，在普通教室甚至任何地點，只要有
PDA，就可以使用本系統來實現螢幕廣播的教學效果，也可以使用在電子書導讀的應
用上。即時影像分享：如同即時麥克風廣播是將麥克風收錄的聲音利用音訊分享的功
能來達到即時聲音廣播效果；結合 PDA 上的數位相機，將數位相機所擷取的視訊影
像利用螢幕分享功能分享給群組，可以達到即時影像分享及遠端螢幕監控的效能。 
即時傳訊（IM）之應用： 
本系統另一個實現的群播分享應用是即時傳訊（Instant Message）。每個 PDA 的使
用者可以用文字交談的方式來達到群組文字對談，不同於傳統的即時傳訊需要伺服主機
系統，本系統是利用分享平台將每個使用者的名稱及對談文字以群播傳送方式傳給每個
群組成員，不需借助伺服主機系統的轉送，只要透過本系統所設計開發的群播分享平
台，就可以實現多對多的即時文字傳訊，稱為群播分享即時傳訊（Multicast Instant 
Message）。圖 5 是目前測試畫面。 
   
圖 5 即時傳訊測試範例 
四、結果與討論 
行動裝置的網路應用受限於網路架構及伺服系統，無法有效也擴展應用。本系統設
計及開發了一個能在行動隨意無線網路中，以轉送群方式分享應用資料的系統平台，不
需要基礎基台、不需要伺服主機、不用複雜的路由協定，利用無線訊號廣播傳輸的特性，
以主動推播（Push Casting）及轉送（Forwarding）的技術，實現方便、迅速及有效的資
料分享應用，結合隨意網路（Ad Hoc Networks）隨時、隨地可架設的優點，提供無線裝
置（Mobile Devices）可以應用的環境，擴展無線裝置在無線網路中的應用價值，發展
多元化的網路應用。 
