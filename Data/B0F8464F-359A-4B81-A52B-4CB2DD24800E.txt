this study, we propose a non-fluorescence microscopic 
imaging technique for measuring blood flow velocity 
of microcirculation on tumor on nude mice.  
Image processing for blood flow velocity measurement 
using a frame by frame analysis is a common approach. 
We evaluated the accuracy of the existing methods, 
which include cross correlation method, Hough 
transform method, and optical flow method, by 
applying these methods to simulated micro-vessel 
image sequences. The blood flow variation in the same 
micro-vessels with different RBC densities and 
velocities was considered in the simulations. Based 
on the comparison, the use of an optical flow method, 
which is superior to a cross-correlation method or a 
Hough transform method, is proposed for measuring RBC 
velocity. 
    The blood flow observation was focused on the 
tumor surface of nude mice. Multiple weekly data were 
acquired from each nude mouse for five weeks after 
tumor implantation. The averaged red blood cell 
velocities of capillaries were measured and 
calculated at different weeks for each tumor. The 
microvascular RBC velocity measurements in 
postcapillaries and venules in the surface of solid 
tumor were found that the distribution of blood flow 
velocity among all samples was ranged from 40 to 350 
μm/s. The differences in vessel diameter and blood 
flow velocity during tumor growth were studied in 
comparison with the initial week. According to the 
obtained p value (p<0.05) of data, significant 
difference can be found between the velocity values 
at the initial week and the 2nd week. The results by 
using the presented imaging system and analysis 
method suggested an optical based process has the 
potential to develop new experimental protocols in 
numerical simulation of tumors growth. This 
measurement system may also be useful in many other 
biotechnological evaluations. 
英文關鍵詞： White-light LED Microscopic Imaging, Measurement of 
blood flow velocity, Numerical simulation of blood 
flow 
 1
 
 
行政院國家科學委員會補助專題研究計畫 □期中進度報告▉期末報告
 
以白光 LED 顯微造影技術在裸鼠腫瘤微循環血管之血流速分析研究 
 
計畫類別：▉個別型計畫   □整合型計畫 
計畫編號：NSC   99-2221-E-033 -012 -MY3 
執行期間： 99  年 08 月 01  日至 102  年 7 月 31  日 
 
執行機構及系所：中原大學 電機工程學系 
 
計畫主持人：林康平 
共同主持人：劉仁賢 
計畫參與人員：林汶正 
 
 
 
 
本計畫除繳交成果報告外，另含下列出國報告，共 _3_ 份： 
□移地研究心得報告 
▉出席國際學術會議心得報告 
□國際合作研究計畫國外研究報告 
 
 
 
處理方式：除列管計畫及下列情形者外，得立即公開查詢 
            □涉及專利或其他智慧財產權，□一年□二年後可公開查詢 
 
中   華   民   國  102  年  9  月  15  日 
 2
Abstract 
Quantification of vascular response by monitoring the blood flow information at each local capillary is 
one way to know the microcirculation mechanisms. At present, employing fluorescence dye is the most 
popular method to enhance imaging quality for using microscopy to study the dynamic behavior exhibited in 
vivo microcirculation. Unfortunately, the limitation of fluorescence dye is well known, such as destroying live 
cell of sample, appearing a side effect, etc. It is now our purpose to overcome those limitations when we 
observe the physiological mechanisms of microcirculation on small vivo animal (nude mice). In this study, we 
propose a non-fluorescence microscopic imaging technique for measuring blood flow velocity of 
microcirculation on tumor on nude mice.  
Image processing for blood flow velocity measurement using a frame by frame analysis is a common 
approach. We evaluated the accuracy of the existing methods, which include cross correlation method, Hough 
transform method, and optical flow method, by applying these methods to simulated micro-vessel image 
sequences. The blood flow variation in the same micro-vessels with different RBC densities and velocities 
was considered in the simulations. Based on the comparison, the use of an optical flow method, which is 
superior to a cross-correlation method or a Hough transform method, is proposed for measuring RBC velocity. 
    The blood flow observation was focused on the tumor surface of nude mice. Multiple weekly data were 
acquired from each nude mouse for five weeks after tumor implantation. The averaged red blood cell 
velocities of capillaries were measured and calculated at different weeks for each tumor. The microvascular 
RBC velocity measurements in postcapillaries and venules in the surface of solid tumor were found that the 
distribution of blood flow velocity among all samples was ranged from 40 to 350 μm/s. The differences in 
vessel diameter and blood flow velocity during tumor growth were studied in comparison with the initial 
week. According to the obtained p value (p<0.05) of data, significant difference can be found between the 
velocity values at the initial week and the 2nd week. The results by using the presented imaging system and 
analysis method suggested an optical based process has the potential to develop new experimental protocols in 
numerical simulation of tumors growth. This measurement system may also be useful in many other 
biotechnological evaluations. 
 
Keywords﹕White-light LED Microscopic Imaging, Measurement of blood flow velocity, Numerical 
simulation of blood flow 
 
 4
 
二、研究目的 
微循環系統對於血流與細胞組織有很大的關連性，影響著細胞組織的結構生長，血流速度是反映
微循環狀態好壞的一個重要指標。隨著各種技術的進步，微攝影技術已提供許多血液循環研究上的工
具，如雷射都卜勒技術、超音波都卜勒技術、共焦雷射顯微技術等，但目前在量測方法和技術上仍還
有一些缺陷。這些技術過於複雜，造成系統操作繁瑣，探頭價格昂貴，實際應用成本過高，器材體積
龐大，使用有其不便性。本計畫在多重目的研究需求下，以擬設置在台北榮民總醫院劉仁賢教授之
microPET 研究室，共同研究之內容包含如下： 
(一)發展無需螢光染劑(白光 LED 光源)之微循環血流造影技術 
本研究發展可攜性與操作方便的光學顯微鏡，進行微循環血流之影像造影，主要工作內容在於
利用一種無需螢光顯微染劑的造影技術，針對在活體小動物腫瘤之微循環血流速量測，藉由微循環
之時間序列動態影像的處理，得到不同週數的腫瘤表層之血流流速資訊，探討其長期之演變，並將
此資訊應用於相關實驗之血流速評估。 
(二)提供血流量測方法及開發驗證工具 
本研究將利用影像處理方式進行血管血流速分析，並利用光流法來量測血管切面的流速及分
佈。此外，亦將以量化實際觀測到的微循環之血液流體變化的特質為基礎，發展模擬微循環各種血
液生理特性之動態資訊，此項模擬工具，將可提供為後續血流量測之開發驗證。 
(三)建置微循環血流生理資訊資料庫 
建置腫瘤小動物模型之微循環生理資訊資料庫，增加實驗動物許多重要資訊之需求，應用於腫
瘤之發展預測與機能評估，本研究將分別在時間資訊(血流影像)與空間資訊(組織切片影像)的分
析，所獲得到活體小動物腫瘤之微循環多樣性資料，作為未來腫瘤與血液生理相關領域之重要研究
資料庫。 
  
三、研究方法 
  (一) 材料準備 
1.實驗裸小鼠  
本研究採用品系為 Sever comoined immune deficiency(SCID)之裸小鼠為實驗對象，此種品系
的小鼠具有嚴重的併發免疫缺損，因為基因缺損，其 B 細胞與 T 細胞皆不能完成 V（J）D 重組，
導致 B 細胞無法有效的生合成免疫球蛋白與 T 細胞受器，進而發生低免疫球蛋白血症，應用此嚴
重免疫缺陷，加以某些其他基因的導入，使之不會排斥所移植入的人類腫瘤細胞，做為「活體細
胞培養基」，本研究用裸小鼠將購自財團法人國家實驗研究院國家實驗動物中心，選擇 6-10 周齡
的小鼠，體重 18~22g，單一性別，至少 20 隻。 
在進行顯微造影之過程前，需先行將裸小鼠給予藥物麻醉，本研究擬採用注射的全身麻醉方
法，必要時則輔以氣體麻醉方法;首先把濃度 10mg/c.c.的麻藥(Pentobarbital)注射到觀測小鼠腹腔
上，靜待觀測小鼠穩定後，將想要觀察的腫瘤表層皮膚之剪開適當窗口，在觀察造影的時候必要
注意幾個部份：(1)必須保持觀測鼠體溫，溫度不可太低，以免觀測鼠失溫休克。(2)傷口部位要保
持濕潤，如果過於乾燥則影像會有較多光反色雜訊。(3)觀測小鼠晃動情形，如果觀測鼠的晃動加
劇，可能是觀測時間過長，麻醉之藥性消退了，若在晃動劇烈的情形下，則可採用氣體麻醉來輔
助降低小鼠劇烈心跳呼吸時所造成的影像晃動之問題。 
 
(2)固態腫瘤細胞之培養及植入 
本研究細胞培養於陽明大學研究所 P2 實驗室完成，預計製作適量的數顆種子，每顆種子必
 6
上的放大倍數是 380 倍，每秒 30 張影像(30 frames per second f.p.s.)以下文簡稱 f.p.s.。靜態影像的
尺寸大小是 720×480 像素。每一張影像上的每一個像素大小為 1.42μm，這個解析度是使用 USAF
單位的測試標靶(Edmund Optics Inc., NJ, USA)。在物鏡裡頭還有一塊偏光片，透過旋轉偏光片的
角度使得反射光位置改變，減少反射所造成的影響，實際實驗環境如圖 3 所示。 
 
顯微鏡
&CCD
裸小鼠
X-Y軸
微調平台
即時動
態影像
筆記型
電腦
 
圖 3、無需螢光染劑顯微之血流量測系統之實體 
 
 
 
                                         (a) 
     
(b)                  (c)                  (d) 
     
(e)                  (f)                  (g) 
圖 4、小鼠腫瘤之微循環觀察：(a)採以水平或垂直軸向之檢視，每次移動 1 mm 的距離 
；(b)樹枝狀血管；(c)毛細血管；(d)細小動脈及；(e)-(f)複雜結構之血管 
 
3. 裸鼠腫瘤不同週數的血流影像取樣方法 
首先，將裸鼠放於調節載物平台之適當放置，調節平台之水平及垂直軸向，掃描裸鼠腫瘤
觀察窗口之血管血流影像，因顯微鏡視野為 1mm × 1mm 平方大小，為能觀測腫瘤表層血管分
觀察窗口 
 8
 (a)高頻成份法：以快速傅立葉轉換(FFT)並以高頻部份當成評估的準則，因運算較為複雜，
所以很難適用於需即時性估測的需求。 
(b)平滑性估測法：藉由計算影像中區域相鄰像素的平滑性，以平滑的最大累計量為評估指標，
但此法的缺點是靈敏度不佳。 
(c)鄰近灰階差異法：以灰階影像相鄰像素絕對差異度作為影像清晰度判斷的指標，取其逐行
與逐列之灰階值，並與其相鄰之行與列作相減，取其運算後之差異值絕對值累加最大值，
以進行其清晰度判斷，此法具有低運算量及高準確性之優點。 
{ }
( , )
( ) | ( , ) ( , 1) | | ( , ) ( 1, ) |i i i i
x y
D i f x y f x y f x y f x y= − − + − −∑                 (1) 
(a)
0 50 100 150 200 250 300
0.5
0.6
0.7
0.8
0.9
1
1.1
1.2
Index of Video Sequence  i
Su
n 
of
 D
iff
er
en
ce
  D
(i)
Evaluation of Image Quality
Su
n 
of
 D
iff
er
en
ce
  D
(i)
 
   
(b)                       (c) 
圖 6、參考影像品質評估 (a)時間序列的動態血流影像經品質評估後，落在最高值 
為最清晰影像，並當作參考樣板影像(b)，而落在低值部分則可視為較模糊影像(c) 
(2)相似度量測 
影像對位技術目前常用的方法主要有：根據相關計算的量測、以明亮度統計為基礎(如交互
資訊)、幾何特徵匹配法(包括點、線等)等演算法。當微循環血流序列影像經過相同的設備取得後，
再經過上述的方法選擇高品質的參考影像樣板後(在此定義為R)，而其他待校準的影像稱之為浮動
影像(定義為F)，擬針對以下評估函數，分析出適用於本研究的快速又準確的影演對位算法。 
a.相關度估測法 
常用的相關度量測演算法分為差異性度量(如絕對差、平方差)和相似性度量(如正規化互
相關)。假設一浮動影像F(u，v)和相同大小為M×N參考樣板影像R(u，v)，下面三種方法可用
來量測與位置R(x，y)之相似性：  
絕對差(Sum of Absolute Differences,SAD)： 
1 1
0 0
( , ) ( , ) ( , )
M N
u v
SAD x y R u v F x u y v
− −
= =
= − + +∑∑           (2) 
清晰 
模糊 
 10
 
(a)                       (b)                         (c) 
圖 7、時間序列影像對位：(a)參考影像；(b)待校準影像；(c)校準後影像 
 
5.微循環血管中流速變化之模擬實驗 
微循環之血球壓積與血液流體變化特性： 
紅血球在血中所佔比例稱為紅細胞壓積，正常的血球壓積將近在血液中占一半，對血液流變
性的影響最大，若壓積增高，血液變濃，血液粘度就升高，流動性就降低，在毛細血管中流動慢，
超過一定限度時就難以通過微循環，導致微循環障礙而無法進行正常的氣體交換和養料供給，所
以紅細胞增多症常伴隨有微循環障礙的表現[28-29]。 
微循環之血球聚集性與血液流體變化特性： 
紅細胞在流動時因表面的負電荷及切變應力而呈分散狀態，但在靜止時血液中有蛋白質長鏈
高分子物質分子間的凡得瓦吸引力，易聚集成串狀或團狀，此稱為紅細胞聚集性。而正常聚集的
紅細胞在流動時很快解聚，每個紅細胞都分散單獨流動，都能順利通過各部位的毛細血管。一旦
紅細胞表面負電荷減少，紅細胞間負電荷同性相斥力減弱，或某些蛋白質含量過高，從而使聚集
性增強，且不易解聚、分散，乃使血液粘度增高，成串成團的紅細胞就會堵塞於毛細血管中而導
致微循環障礙，紅細胞聚集性增高常見於心、腦、肺、腎等缺血性疾病，也見於某些腫瘤病[30]。 
本研究依據上述血液流變特性，擬在微血管中模擬出可能發生的各種狀況，如給予不同參數
設定模擬出影像中紅血球之流動路徑及流向，再藉由不同流速演算法進一步檢測出精確的紅血球
之移動向量。 
如上述可知，血液是一種複雜的非均質液體，黏度不恆定，隨著切變速率的升降或降升，應屬
非牛頓液體。但若忽略血液的血細胞和纖維蛋白，血液則接近均質，黏度相對較恆定，可近似
於牛頓液體。擬先設計出兩組不同的動態血流影像，其一是在均勻隨機亂數位移之模擬造
R
r
Vc
V(r) R:   vessels  radius ~ 17 pixels
Vc:  velocity at center of vessels 
 
圖 8、微血管中血球流向模擬與流動依循公式 
 12
 
(1)相互關聯法 (Cross correction) 
取連續兩張經前置對位處理後的靜態影像，由於微血管之血流是血球一批接一批地由動脈枝
往靜脈枝的方向移動，因此本研究擬採用一個沿微血管中心線上逐點地自動計算血流速度的演
算法。為了獲得影像中血管中心線(Center Line)，擬先將血管區域與其他組織分離，使用最佳化
閥值法(optimal thresholding)求出二值化的血管區域，選擇膨脹、侵蝕、細線化來處理血管骨幹
的中心線，經由輪廓標定及計算中心線逐點之平均灰階質後，可得到微循環顯微影像之微血管
管徑大小、中心線及中心線上逐點之平均灰階值變化(圖 10)。再者，血流速量測是以互相關函
數來計算兩張靜態影像達到最佳匹配時之偏移量，找出連續兩張靜態影像經由 Cross-correlation
演算後之最大值的位置，即可求得中心線上各點的血液流動的位移向量（Δd），再根據 td ΔΔ 將
微血管的血液流速計算出來。在圖 11 中，假設此連續兩張靜態影像的平均灰階分佈分別為 f1 ( x ) 
及 f2 ( x )，若該連續兩張靜態影像的時間差非常微小，則 f1 ( x ) 及 f2 ( x ) 有相當程度之相似。
由 f1 ( x ) 及 f2 ( x )兩曲線互相比較，其實彼此之間只是位移了一段距離，又兩張影像相隔時間
為 1 / 30 秒，因此位移與時間變化可以求得其血流速度的變化。 
 
(2) 霍夫轉換法 (Hough transform) 
將原始影像解決呼吸或抖動之位移處理後，採取影像差異法，將欲求得的血管部分取出，
求取血管的中心線(Center Line)，將中心線上的相鄰像素灰階值取平均，如同上述作法。接下來
按照時間的變化順序，依序將平均中心線集匯成血流的 profile 圖，再利用霍夫轉換(Hough 
Transform) 取得血流剖面(profile)圖上特徵線段與 X 軸方向所形成的 θ 角，算出 1/tan(θ)即是血
流速度。 
    血流的 profile 圖橫軸方向是血管中心線上的灰階分布，我們從硬體設備中知道每張影像上
的像素解析度是 1.42μm；縱軸方向是時間，M320 系統的最高取樣率是每秒 30 張影像，也就是
每張影像的時間差是 1/30 秒；我們知道速度的計算公式是 V=△D/△T。profile 圖上對應於距離
的是橫軸，對應於時間的是縱軸。 
在對位後的影像當中，血球與血球中的間隙，或是血球與血球的變化都會在血管中心線上
留下紀錄，透過這些記號灰階值差異變化，我們會發現在 profile 上的特徵，如斜直線、或是一
個條狀的區域，取得血流 profile 圖後，使用 Canny 邊緣偵測，這些特徵與橫軸之間形成夾角 θ，
那麼血流速度的計算公式： 
1/
tan
V S T θ= Δ Δ =                (7) 
再經 Hough Transform 求角度 θ，其公式如下式。 
cos sinR x yθ θ= +           (8) 
找出特徵線段，算出其 θ，代入計算公式 V=1/tan(θ)，即可估算出血流速度。 
 
 14
轉換圖中最大值，因為最長直線上的點會在相同角度上重復出現多次;由圖 14 可以知道出現最多
次數以及其對應的角度，此時得到最亮點的座標(R,θ)分別為 a.(206,-29)，b(166,-32)，c(170,-24)，
我們可以得到每區塊中最長線段的與水平方向的夾角，即可求的平均的角度為 28.3°，估算出平均
的血流速度是 80.1μm/sec。 
 
(3) 光流量測法 (Optical flow motion estimation)  
光流法是以影像梯度導向作為理論基礎，可用於不同影像上小幅位移量之追蹤，其基礎原理
則透過以下兩點假設：(1) 物體上每點的強度不隨時間改變，(2) 鄰近位置的像素為平滑運動，可
找出兩張影像上相同特徵點的位移量，透過此位移量去匹配來源影像得到形變後的估測影像
(deformed image)，以達到追蹤的目的。光流的理論基礎是根據 Horn and Schunck 在 1985  
所發行的論文並進一步延伸的理論推導，讓一個連續且可區分的影像定義為 f(x,y,t)，f 代表在時
間 t 時，點(x,y)的灰階強度。在時間 dt 之後，移動至(x+dx,y+dy)的相對應點和影像強度函數 f(x+dx, 
y+dy, t+dt)可被表示在一個 Taylor 序列級數展開為： 
( ) ( ) ( ) ( ) y
y
tyxfx
x
tyxftyxfdttdyydxxf ∂∂
∂+∂∂
∂+=+++ ,,,,,,,,  
( ) +∂∂
∂+ t
t
tyxf ,, higher order terms     （9） 
假設影像的灰階強度樣本不隨著時間產量而改變 
( ) ( )tyxfdttdyydxxf ,,,, =+++          （10） 
對小位移之band-limited的影像，在式子(1)第二次和較高次序的關係可被忽視。結合式子(9)和(10)
及忽略較高次序關係的產量即被稱為「光流方程式」。 
( ) ( ) ( ) 0,,,,,, =∂
∂+∂
∂+∂
∂
t
tyxf
y
tyxf
x
tyxf vv yx （11） 
其中 vx = dx/dt，vy = dy/dt. 
  公式(11)有未知的vx和vy，為了解決此公式，需要一個附加的限制。The Horn and Schunck首先
限制是最一般地用於光流計算，緩和最初的限制且允許強度隨著在變形期間之非零值關係變動
( )[ ]tyxvof ,,ε 至公式（11）的關係： 
( ) ( ) ( )[ ]tyxv
t
tyxf
y
tyxf
x
tyxf
ofyx vv ,,
),,(,,,, ε=∂
∂+∂
∂+∂
∂  （12） 
  公式(12)說明光流會隨著函數的速度關係改變。The Horn and Schunck平滑限制並且使速度關
係的像素變化降至最小。此種變化，表示為 ( )[ ]tyxvs ,,2ε ，是用來識別構成速度向量之直角梯度的
總和： 
( )[ ]
2222
2 ,, ⎟⎟⎠
⎞
⎜⎜⎝
⎛
∂
∂+⎟⎟⎠
⎞
⎜⎜⎝
⎛
∂
∂+⎟⎟⎠
⎞
⎜⎜⎝
⎛
∂
∂+⎟⎟⎠
⎞
⎜⎜⎝
⎛
∂
∂=
yxyx
tyxv vvvv yyxxsε （13） 
Horn and Schunck 方法使所有影像ε 2of 和 2α 和ε 2s 加權的結合縮至最小 
( ) ( )[ ]∫ + dxdyvv sof εαε 222min      （14） 
其中α²是一個加權因子 
 16
 
(a) 
 
(b) 
   
(c)                        (d) 
圖 16、實際血流量測 (a)微靜脈 (b)微動脈  
(c)-(d)分別為微靜脈、微動脈之光流向量及大小統計 
 
 
(1)髮夾狀微血管 
模擬由一支細動脈發出幾個分支血管，每個分支上又發出毛細血管，每個毛細血管在途中急
劇回轉，形成髮夾狀微血管結構，然後匯入細靜脈，它屬最簡單的微血管結構。擬分別採用內徑
為10~50μm的彈性管道設計，模擬出毛細血管輸入枝、毛細血管輸出枝、細動脈和細靜脈，血液
由細動脈流經管袢輸入枝經輸出枝匯集到細靜脈。為便於分析，將不同動脈分支上發出的管袢分
為第一排、第二排和第三排管袢(圖17-(a))。 
 
(2)樹枝狀微血管 
模擬由一根細動脈提供血液，經分支毛細血管、網狀毛細血管、集合毛細血管，再逐級匯入
細靜脈，形成樹枝狀微血管結構。考慮到微血管不同管徑的差異，分別採用內徑為10~50μm的彈
性管道設計，模擬出毛細血管、細動脈和細靜脈，血液由細動脈經逐級分支流人毛細血管網，然
 18
 
表 1、不同對位法與位移影響之比較 
Comparison for Matching Metric
Effect SAD VR NCC MI GFM
blur effect 
(vertical ) ▲ ▲ ● ● ×
blur effect
(horizontal)
▲ ● ● ● ×
noise 
effect × ▲ ▲ × ●
illumination 
effect × ▲ ● × ●
Time 
consuming ● ● × × ×
● good  ▲ accepted good  ×poor  
 
(二)血流速量測法之評估 
        此實驗為評估現存的血流影像測速法，其中包含相互關聯法、霍夫轉換法及光流法，利
用模擬出微循環血管各種不同流速變化特性之動態影像資訊(如圖 19)，由圖 17 中可了解三
種不同的微血管種類，可歸那出包含 7種不同的管道，如圖 20 所示。為能評估不同量測速度
演算法之準確性，本實驗根據圖 19 及圖 20 進行模擬測試。根據實驗比較後，其結果可見於
表 2中，以不同測量法之總平均誤差而言(圖 21)，光流法比其他兩種演算法(相互關聯法及
霍夫轉換法)較適合於量測血球的流動速度。有以光流法而言，表 3及圖 22 所呈現之結果，
代表光流法對於不同密度與不同血球流速，可見估測血流之精確值，約 5 piexls/frame 之位
移內，為有效之血流速之估測範圍。 
A parabolic curve function of
blood flow in microvessel
0
2
4
6
8
10
12
0 2 4 6 8 10 12 14 16
The distance from the vessel center (piexls)
Ve
loc
ity
 (p
iex
ls 
/ f
ram
e)
max v=10
max v=5
max v=3
max v=1(a)
(b)
(c) (d)  
圖 19、 血流速與血球密度： (a)低密度； (b)中密度；(c)高密度；(d)不同流速 
 
 20
The velocity estimation
in various micro-vessel cases
0
1
2
3
4
5
6
7
8
9
10
Cross-correlation Hough transform Optical flow
Defferent image processing methods
Ov
era
ll 
av
era
ge
d e
rro
r
(pi
ex
l/f
ram
e)
 
圖 21、不同測量法之總平均誤差 
 
表 3、光流法於不同微血管流道之平均誤差 
The averaged error estimation of RBCs velocity, Mean ± S.D. (pixel/frame) 
Velocity 
Density 
RBC movement, maximum (average) 
1 pixel 3 pixels 5 pixels 10 pixels 
(0.7) (2.1) (3.5) (7) 
Low 0.200 ± 0.157 0.220 ± 0.176 0.267 ± 0.171 2.107 ± 0.776 
Medium  0.203 ± 0.159 0.235 ± 0.171 0.268 ± 0.168 1.440 ± 0.578 
High  0.204 ± 0.172 0.246 ± 0.175 0.281 ± 0.177 0.911 ± 0.473 
Overall 0.202 ± 0.163 0.234 ± 0.174 0.272 ± 0.172 1.486 ± 0.609 
 
 
Velocity estimation for different RBCs densities
v.s. averaged error
0
0.5
1
1.5
2
2.5
1 3 5 10
Maximal movement (pixel/frame)
Av
era
ge
d e
rro
r(p
ixe
l/fr
am
e)
Low
Med
High
 
 (a) 
 22
Initial week
36.636μm
19.312μm
11.36μm
   
The 1st week
41.18μm
22.01μm
15.62μm
 
The 2nd week
51.688μm 9.514μm
33.086μm
   
The 3rd week
35.926μm
24.14μm
28.258μm
 
The 4th week
81.224μm
5.964μm
10.366μm
   
The 5th week
69.296μm
34.648μm
31.95μm
 
圖 24、不同週數腫瘤成長之表面微血管 
 24
測速法，但其不同演算法的正確性比較卻很少被深入探討。因此研究目的為評估現存的血流影像測速
法，其中包含相互關聯法、霍夫轉換法及光流法，利用模擬出微循環血管各種不同流速變化特性之動
態影像資訊，以評估量測速度演算法之準確性。根據實驗比較後，光流法比其他兩種演算法(相互關
聯法及霍夫轉換法)較適合於量測血球的流動速度。完成 SCI 論文一篇：“Experimental Estimation 
ofBlood flow Velocity through Simulation of Intravital Microscopic imaging in Micro-vessels byDifferent 
Image Processing Methods.”Microvascular Research, 80(3):477-83, 2010. (SCI,IF=3.075)[35] 
本研究已將過去三年所完成之動物實驗成果，結合前兩項研究所獲得之結果，以裸鼠腫瘤表面之
血流為其觀察對象，觀察裸鼠植入腫瘤後，連續 1~ 5 週之成長及量測表面血流變化，由結果顯示，
所量測的腫瘤樣本之微細血管及微靜脈之血流速介於 40~350μm/s 之間。而在腫瘤成長期間的微血管
管徑與血流之差異比較，發現植入腫瘤前與腫瘤成長第二週時的血流速值具有統計意義(p<0.05)。本
研究以影像分析微循環血流之技術，獲得的常模活體小動物腫瘤之微循環血流資料，將可進一步作為
腫瘤與血液生理相關領域之參考。此研究之成果，完成 SCI 論文一篇於 2012 年發表：“Red BloodCell 
Velocity Measurement of Rodent Tumor Model：An in vivo Microscopic study. ”Journal of Medical and 
Biological Engineering,32(2): 97-102,2012.(SCI,IF=0.6)[36]，並獲得 2012 年之該期刊年度最佳論文獎，
以及中國工程師學會工程論文獎。 
 
參考文獻 
[1] Bertuglia S., Leger P., Colantuoni A., Coppini G., Bendayan P. and Boccalon H. Different flowmotion patterns inhealthy 
controls and patients with Raynaud’s phenomenon Technol, Health Care 7 113–23, 1999. 
[2] Wollersheim H., Reyenga J. and Thien T . Laser Doppler velocimetry of fingertips during heat provocation in normals and in 
patients with Raynaud’s phenomenon Scand, J. Clin. Lab. Invest. 48 91–5, 1988. 
[3] Cesarone M R, Incandela L, Ledda A, De Sanctis M T,Steigerwalt R, Pellegrini L, Bucci M, Belcaro G andCiccarelli R. 
Pressure and microcirculatory effects of treatment with lercanidipine in hypertensive patients and invascular patients with 
hypertension Angiology 51 53–63, 2000. 
[4] Cesarone M R, Laurora G and Belcaro G V. Microcirculation in systemic hypertension . Angiology 43 899–903,1992. 
[5] Hudetz A, Feher G, Weigle C, Knuese D and Kampine J . Video microscopy of cerebrocortical capillary flow: response to 
hypotension and intracranial hypertension Am. J. Physiol.268 2202–10, 1995. 
[6] Rayman G, Hassan A and Tooke J E . Blood flow in the skin of the foot related to posture in diabetes mellitus Brit. Med. J. 
292 87–90, 1986. 
[7] Tooke J E, Lins P E, O¨ stergren J, Adamson U and Fagrell B. The effects of intravenous insulin infusion on skin 
microcirculatory flow in type A diabetes Int. J. Microcircul. Clin. Exp. 4 69–83, 1985. 
[8] George Mchedlishvili, Disturbed blood flow structuring as critical factor of hemorheological disorders in microcirculation, 
Clinical Hemorheology and Microcirculation, Volume 19, Number 4, pp. 315-325, 1998. 
[9] Jain, R.K. Ward-Hartley, K. Tumor Blood Flow-Characterization, Modifications, and Role in Hyperthermia,Sonics and 
Ultrasonics, IEEE Transactions on,31(5)504- 525,1984.  
[10] Katsuyoshi Hori, March Suzuki , Shigeru Tanda,  Sachiko Saito . Characterization of Heterogeneous Distribution of Tumor 
Blood Flow in the Rat. Cancer Science.Volume 82 Issue 1, pp. 109 – 117, 1991. 
[11] Arthur M. Iga, Sandip Sarkar, Kevin M. Sales, Marc C. Winslet and Alexander M. Seifalian, Quantitating Therapeutic 
Disruption of Tumor Blood Flow with Intravital Video Microscopy, Cancer Research 2006; 66: (24). December 15, 2006. 
[12] Bollinger A, Butti P, Barras J P, Trachsler H and Siegenthaler W, Red blood cell velocity in nailfold capillaries of man 
measured by a television microscopy technique Microvasc. Res. 7 62–72, 1974. 
 26
[33] Gai-ping ZHAO,Jie WU, Shi-xiong XU, M.W. COLLINS, Yu-ping JIANG and Jian WANG. Numerical simulation of 
hemodynamics in the host blood vessel and microvascular network generated from tumor-induced angiogenesis.Journal of 
Hydrodynamics,Volume 18, Issue 6, pp.727-735, 2006. 
[34] Wen-Chen Lin, Chih-Chieh Wu, Geoffrey Zhang, Tung-Hsin Wu, Yang-Hsien Lin, Tzung-ChiHuang, Ren-Shyan Liu and 
Kang-Ping Lin, “An approach to automatic blood vessel imageregistration of microcirculation for blood flow analysis on nude 
mice”, Computer Methods in Biomechanics and Biomedical Engineering, Volume 14, Issue 4, p. 319-330, 2011. 
[35] Tzung-Chi Huang, Wen-Chen Lin, Geoffrey Zhang, Kang-Ping Lin, “Experimental Estimation ofBlood flow Velocity through 
Simulation of Intravital Microscopic imaging in Micro-vessels by Different Image Processing Methods”, Microvascular 
Research, 80(3):477-83, 2010. 
[36] Wen-Chen Lin, Chih-Chieh Wu, Tzung-Chi Huang, Wen-Chi Lin, Bill Yuan-Chi Chiu, Ren-Shyan Liu, Kang-Ping Lin, “Red 
BloodCell Velocity Measurement of Rodent Tumor Model：An in vivo Microscopic study”, Journal of Medical and Biological 
Engineering, 32(2): 97-102,2012. 
 
 
 28
 
國科會補助專題研究計畫出席國際學術會議心得報告 
                                                                   日期： 99  年  12 月  10 日 
 
會議心得： 
美國心臟學會(American Heart Association, AHA)年會是年度全球性最大最重要的心血管疾病相
關會議，2010 年 11 月 14 日至 17 日在美國芝加哥舉行，會議內容主要是針對提高心血管病患者不同
階段的預防、診斷和治療。預計有 4000 多名發言者包括世界頂尖知名的心血病專家在會議上進行精
彩演講和交流等活動。依主題區分成七個子議程，包括影像學暨心臟超音波、心血管疾病流行病學、
心血管基因研究、心衰竭、介入性心血管技術與週邊血管疾病。 本研討會使與會人員更加瞭解未來心
血管疾病危險因素及預防心血管疾病的關鍵發展，心房顫動（AF）是危害人類健康的重大疾病，可升
高患者死亡率發生率，因國內隨著醫療科技的進步使平均壽命延長，社會高齡化，因此心房顫動將是
日愈常見的重要課題之一，為本人在此研討會中最為關切的議題，如何能有效從微循環的長期觀察及
追縱，進而預防心腦血管疾病的猝死發生，希望能藉此吸取他人的經驗，從別人的研究成果中得到新
的靈感與啟發。最後，感謝國科會的支持與贊助，讓本人可以順利參加此次 AHA 年會，在學術及研究
工作上有新的見識。  
計畫編號 NSC   99-2221-E-033 -012 -MY3 
計畫名稱 以白光 LED 顯微造影技術在裸鼠腫瘤微循環血管之血流速分析研究(1/3) 
出國人員
姓名 林康平 
服務機構
及職稱 中原大學電機系 
會議時間 99 年 11 月 14 至99 年 11 月 17 日 會議地點 
美國芝加哥 
會議名稱 美國心臟學會(American Heart Association, AHA)年會 
附件二 
 30
 
國科會補助專題研究計畫出席國際學術會議心得報告 
                              日期： 102  年 7  月 15 日 
 
 
 
 
 
 
 
 
 
 
 
 
一、參加會議經過及與會心得 
本人此次參加在日本大阪會議中心所舉行之 IEEE-EMBS-2013，共計有三項工作，分
別為： 
(1)發表醫學影像成果之論文 
(2)參加 IFMBE 亞太工作小組會議 
計畫編號 NSC  99-2221-E-033 -012 -MY3 
計畫名稱 以白光 LED 顯微造影技術在裸鼠腫瘤微循環血管之血流速分析
研究(3/3) 
出國人員
姓名 林康平 
服務
機構
及職
稱 
中原大學 電機系 特聘教授 
會議時間  2013 年 7 月 3 日2013 年 7 月 7 日 
會議
地點 
日本 大阪 
會議名稱 
(中文)第 35 屆 IEEE 生物醫學工程國際研討會 
(英文)  The 35th Annual International Conference of the IEEE 
Engineering in Medicine and Biology Society (EMBC’13) 
發表題目 
(中文)以非均相性擴散與權重 k 均值類聚之乳房影像強化法 
(英文) Mammogram Enhancement Using Anisotropic Diffusion and 
Weighted K-means Clustering 
附件四 
 32
會會長以及重要會務運作人士，協商未來之論文出版品，由 Springer 國際出版商發
行外，並取得 IEMBE 總會同意，在今年九月底的歐洲醫工研討會中，討論將每年舉
辦的 IFMBE 執行委員會議，會員團代表會議以及亞太工作會議均安排在台南舉行，
同時，將可吸引更多的國際重要醫工學者來台灣訪問。對於提升我國國際地位，以
及國際影響力，影響深遠。 
以上所述為此出國參加 IEEE-EMBS-2013 會議之重要記述。 
 
三、發表論文全文或摘要 
1.論文題目：Mammogram Enhancement Using Anisotropic Diffusion and Weighted 
K-means Clustering 
2.作者：施莉娜、林耿宏、林汶正、林康平 
3.摘要： Mammogram is used to diagnose the breast cancer. However the region in 
digital mammograms are usually noisy and have low contrast, they might affect the 
interpretation. This study proposed a combination of an anisotropic diffusion technique 
and a weighted K-means clustering. The results from the real mammogram presented 
that the proposed method succeeded to improve the performance of Original 
Anisotropic Diffusion method to reduce the noise and enhance the image contrast. 
 
四、建議 
無 
五、攜回資料名稱及內容 
研討會之議程手冊及論文電子檔 
 
 
between the two images. Several image similarity measures
have been proposed. They can be classified depending on the
theoretic foundations:
. Correlation measures. The intensity values of each
image are analysed and the alignment is achieved
when a certain correlation measure is minimised (or
maximised). Usually, a priori information is used in
these fast metrics.
. Intensity occurrence. These measures depend on the
probability of each intensity value and are based on
information theory.
. Geometrical features. A segmentation process
detects some features and then they are aligned.
These methods obtain volume accuracy and they do
not have high computational cost. Nevertheless, there is a
great dependence on the initial segmentation results.
The optimiser searches the maximum (or minimum)
value as the metric varies the spatial transformation. A lot
of numerical methods have been developed in order to
obtain the global extreme of a non-analytical function.
The following methods are the most used in medical image
registration: Powell’s method, gradient descent, one-plus-
one evolutionary and the simplex method. The choice of
method will depend on the implementation criteria and the
measure features (smoothness, robustness, etc.).
In this paper, an applicable automatic registration
scheme is proposed and applied in the evaluation of
existent metric for the capillary blood flow video sequence
in tumour regions of nude mice with severe combined
immune deficiency (SCID).We allow employing a strategy
with highly accurate and rapid registration, with its
objective function based on the feature-based or intensity-
based matching technique. In addition, to examine the
blood cell flow velocity in each local capillary, the
microscopic system without fluorescent labelling provides
precise and continuous quantitative data of blood flow rate
in individual small vessels.
2. Materials
2.1 Animal origin and tumour
Female nude mice with SCID, 7–12 weeks old and with an
average weight of 16–17 g, were used for tumour blood
flow measurements and vital microscopic observations
under anaesthesia (Figure 1). After tumour cells were
implanted and grown in the back leg muscle, the nude
mice were imaged for capillary blood flow in the tumours
using the M320 system (JMC Corporation, Kyoto, Japan).
2.2 Microscopy and image acquisition
Many different blood flow measurement techniques
have been proposed (Sugii et al. 2002; Iga et al. 2006;
Jeong et al. 2006). The electromagnetic blood flowmeter
and ultrasonic Doppler flowmeter are useful for larger
blood vessel measurement, but not suitable for micro-
circulation. In general, IVVM involves the use of a
fluorescence microscope in a living animal for real-time
observing, monitoring and recording, and can be applied in
the quantitative analysis of specific variables and events.
However, some detrimental effects as given may arise
with fluorescence microscopy on living tissues, below.
(1) The fluorophore itself may interfere with the signalling
pathway or alter cellular function in some way.
(2) The excitation light itself may damage the living
tissue, which may affect the behaviour of the sample or
even cause its death.
(3) The effect arises as a result of the combination of
fluorophores, and excitation light is clearly not an
option with live cell imaging.
Our microscopic system without fluorescent labelling
provides precise and continuous quantitative data of blood
flow rate in individual small vessels. The wavelength and
illumination are key parameters of the light source in a
microcirculation imaging system. The penetration capa-
bility of light depends on the filter wavelength. Generally,
a longer wavelength will result in deeper penetration
under skin but with worse resolution (see Equation (1)).
Therefore, the wavelength of the light source should be
chosen properly to obtain correct and clear images which
can be used to analyse blood flow or morphologic features
accurately. Absorption of blood under the skin is another
important consideration that will influence the contrast or
clarity of the image. According to the absorption spectrum
of haemoglobin, the 532-nm wavelength is strongly
absorbed by oxygenated haemoglobin, giving it a superior
probing ability for RBCs in capillaries. Theoretically, a
green light source (500–550 nm) is more suitable for
(a) (b)
Figure 1. (a) Nude mouse with SCID. Tumour cells
implantation is within the red circles, (b) the microcirculation
in the tumour region observed after an easy surgical treatment
of surface.
W.-C. Lin et al.320
D
o
w
n
lo
ad
ed
 B
y:
 [
Na
ti
on
al
 C
hi
ao
 T
un
g 
Un
iv
er
si
ty
 -
Fu
ll
 L
ib
ra
ry
] 
At
: 
10
:5
4 
28
 M
ar
ch
 2
01
1
(a) agonic, (b) single peak, (c) high sensitivity, (d) high
SNR and (e) low computation. The common evaluation
methods for focusing are as follows: (Winkler 1999;
Wang et al. 2004; Wei et al. 2005):
(1) High frequency component. Perform the fast Fourier
transform on an image and extract the high-frequency
component as the focus evaluation, which has a large
computation cost and is not suitable for real-time
measurement.
(2) Smoothness. The smoothness between the adjacent
pixels is calculated. The smoothed pixels are
summed as the focus evaluation function. The
maximum value is the focus criterion. This method
has low sensitivity.
(3) Threshold integration method. Choose a threshold
according to the grey distribution. Sum the grey
values above the threshold. The maximum value is
the focus criterion. This method has low precision.
(4) Grey difference method. This method makes use of
the absolute value of adjacent pixels as the focus
criterion function. To each pixel of an image, the step
summation on the x-axis and y-axis is calculated
in Equation (2),
DðiÞ ¼
X
ðx;yÞ
{j f iðx; yÞ2 f iðx; y2 1Þj
þ j f iðx; yÞ2 f iðx2 1; yÞj};
where i ¼ 0; 1; . . . ;m andm [ Z:
ð2Þ
When the image is focused, i ¼ 0; 1; . . . ;m, D(i) is
the maximum value. From observation, motion blur
is mainly caused by factor-oriented abnormity which
affects the imagequality. Sincemotionblur occurswhen
the pixels overlap along themoving direction, it leads to
the grey level difference between neighbouring points
getting smaller. So the grey level difference can be used
to evaluate the motion blur. We can then choose the
clearest image as reference by searching this maximum
of D(i). An example is shown in Figure 5.
3.1.2 Down-sampling and preprocessing property
Usually, this is a common approach for registration.
The original images are down-sampled to speed up the
registration convergence. For instance, in this study,
the image pixel matrix is up to 720 £ 480 pixels. With a
scale factor of two, an image is down-sampled to about
360 £ 240 pixels prior to the processing stage. Sometimes,
the Gaussian filter is employed as the preprocessing
property to smooth the down-sampled images, and it can
improve the registration performance and avoid local
extremes using low pass smoothing.
3.2 Measurement of metric
Serial image sequences of the same modality are acquired,
and they have the same resolution in space and grey scale.
The highest-quality image is selected as the reference
(denotedwithR)whereas the others are referred to asfloating
(denoted as F). The floating images are aligned with the
reference image in space by translating the floating image.
In general, the alignment is solved either manually or by
computer-based (semi-)automatic registration techniques.
Manual registration is shown to be error-prone, time
consuming and probably biased. Computer-based methods
use either intensity-based registration or feature-based
registration. Intensity-based registration with different
similarity metrics has been generally adopted; these include
correlation measures and intensity occurrence. Feature-
based matching techniques do not use the grey values to
describematching entities, but use image features derived by
a feature extraction algorithm. The formof the description as
well as the type of features used for matching depends on the
task to be solved. Evaluation of registration strategies for
large serial sets of microscopic images is strongly related to
Image quality
assessment
(Microcirculatory
video sequence)
Measurement
of matching
Measurement
of matching
Geometric
transformation
Geometric
transformation
Optimisation local search
by Powell’s method
Slight search
by direct method
Registration
results
(a)
(b)
(c)
Reference
image
Uniform random
generator
Image
pre-processing
Image
pre-processing
Down-samplingDown-sampling
Figure 4. Typical block diagram of automatic registration. (a)
Assessment of reference image and preprocessing applied to
video sequences. (b) Coarse and fast alignment by an
optimisation search. (c) Precise alignment by fine searching
with the search range depending on the specific ratio of down-
sampling.
W.-C. Lin et al.322
D
o
w
n
lo
ad
ed
 B
y:
 [
Na
ti
on
al
 C
hi
ao
 T
un
g 
Un
iv
er
si
ty
 -
Fu
ll
 L
ib
ra
ry
] 
At
: 
10
:5
4 
28
 M
ar
ch
 2
01
1
3.2.2 Intensity occurrence
. Mutual information (MI). MI (Huang et al. 2003) is an
information theoretic measure and was proposed for
use in image registration by two independent groups.
The basic concept behind the use of this measure is to
find a transformation. The MI of two images R and F
is then defined by summing all grey value pairs at
corresponding positions, regarded as random vari-
ables X and Y and their intensity values at a certain
coordinate in the images as the joint outcome of a
randomexperiment. TheMI betweenX andY, denoted
as IðX; YÞ, is a measure for the statistical dependency
between both variables. The MI between two random
variables X and Y is defined as
IðX; YÞ ¼ HðXÞ2 HðXjYÞ ¼ HðYÞ2 HðYjXÞ
¼
X
x[X
X
y[Y
pðx; yÞ log pðx; yÞ
pðxÞpðyÞ : ð5Þ
MI represents the amount of information that one
random variable, the output of the channel, gives
(or contains) about a second random variable, the
input of the channel, how much the knowledge of X
decreases the uncertainty of Y. Therefore, I(X,Y) is a
measure of the shared information between X and Y.
3.2.3 Geometrical features matching
Feature-based matching is a powerful method for medical
image registration, such as retinal images. A wide range of
operators for image enhancement and detection has been
described in the literature (Matsopoulos et al. 1999). In this
similar case of vascular images, after preprocessing of
feature extraction two binary images of the vascular vessels
are obtained, BR and BF . The coarse alignment is based on
localised correlation of binary templates in binary images.
The calculation of the correlation is performed using an
XOR operation between BR and BF data in order to find all
pixels set to different values. Here, XOR is tested by
developing an objective function defined as follows:
M ¼ argmaxXORðBR; TðBFÞÞ
H £W ; ð6Þ
where H £ W is the size of the overlap. The search pattern
is moved over the binary image by the search method and
the correlation can be mathematically formulated as the
maximisation. The number of bits agreeing at each location
is taken as a final measure of the result.
3.3 Optimisation search
Typically search algorithms may use either a direct
method or a mathematical method. The use of the former
is restricted almost completely to applications relying on
very sparse information. The mathematical search
methods that exist are suitable for global or local
optimisation (Matsopoulos et al. 2003). Some global
optimisation methods exist (such as genetic algorithms
and simulated annealing). Many of the methods require a
very large number of iterations to satisfy statistical
convergence criteria. It is, therefore, the speed of the
global optimisation methods that is the limiting factor for
their successful application to this problem (Jenkinson and
Smith 2001). Although some existing global optimisation
techniques may be viable, the majority of existing
registration methods opt for local optimisation methods,
such as Powell’s direction set method (PDSM), gradient
descent, downhill simplex methods and so on, in order to
increase speed. PDSM was found to often yield the best
optimal solution among these methods (Xu and Dony
2004). It only requires evaluations of the cost function
itself and not of its gradient. Despite its strengths, its
performance is found to be strongly dependent on the
initial solution, and the global solution is not guaranteed.
Generally, this drawback can be improved using a
combined simplex (Plattard et al. 2000), a method hybrid
genetic scheme (Hsiao et al. 2001) and a multi-resolution
algorithm (Jenkinson and Smith 2001) to solve the desired
global minimum, which is hidden among many local
minima.
Powell’s direction set algorithm is selected to perform
the optimal search in this study. It is quadratically
convergent, which makes it one of the fastest methods for
solving non-linear minimisation problems. A key idea of
Powell’s method is to select a starting point Pðp1; . . . ; pnÞ
in parameter space with a uniform random generator,
which avoids getting stuck in local minima as much as
possible, and minimise the cost function along some
chosen direction vector n using a 1-D minimiser such
as bracketing or Brent’s parabolic method. The most
appreciated scheme for choosing successive directions is
the conjugate gradient method, which we now briefly
describe. When the cost function is minimised along the
direction n, the gradient in the obtained minimum is
necessarily perpendicular to that direction. If it were not,
that would mean that the projection of the gradient to that
direction is non-null, which would in turn mean that the
point was not really a minimum. The cost function may be
expanded in a Taylor series around that minimum:
f ðpÞ ¼ f ðPÞ þ
X
i
›f ðPÞ
›pi
pi þ 1
2
X
i
X
j
›2f ðPÞ
›pi›pj
pipj
þ . . . ¼ f ðPÞ2 bpþ 1
2
p†Hp; ð7Þ
where b is the negative gradient of f and H is the Hessian
matrix of second partial derivatives of f at P. The gradient
W.-C. Lin et al.324
D
o
w
n
lo
ad
ed
 B
y:
 [
Na
ti
on
al
 C
hi
ao
 T
un
g 
Un
iv
er
si
ty
 -
Fu
ll
 L
ib
ra
ry
] 
At
: 
10
:5
4 
28
 M
ar
ch
 2
01
1
and can be randomly located anywhere in the vessel.
The random cells are placed by Gaussian distribution
function using uniform random numbers, in which it is
possible to use standard deviation for dominating
volumes of various density vessels. The intensity of one
RBC ranges randomly from 0 to 10 levels of greyscale,
which closely approximates the actual images as shown
in Figure 6(d) and (e).
4.2 Displacement for simulation and measurement
of alignment errors
Within this work, the simulated displacement of virtual
blood flow images was first to verify our registration
method. The mechanical simulations gave random
positions from 0 to 50 pixels as a displacement of time.
From these positions at each time step, a 2D magnified
image sequence was simulated using microscopic image
formation equations that consider motion blur, noisy
translation and reflectance illumination effects. After
simulating with the eccentric condition in actuality, the
distance between registered image and reference image
was determined. A least squares approach was applied to
construct a single measurement of Euclidean distance
using the root mean square error (RMSE) function.
The distance was excluded from the analysis. The mean
error, standard deviation of error and maximum error
were calculated as accuracy estimation overall.
The correlation coefficient (CC) is also calculated to
serve as the robustness estimation for the trials
registration. All displacements for simulation are
implemented from 50 randomly generated transform-
ations as described in this section.
4.3 Motion blur
Many types of motion blur can be distinguished, all of
which are caused by relative motion between the camera
and the object. This can be in the form of a translation, a
rotation, a sudden change of scale or some combination of
these. In this study, only the important type, translation,
was included. When the object translates at a constant
horizontal velocity during the exposure interval, the
discrete equivalent point-spread function makes use of the
blurring distance L, which is the number of additional
points in the image resulting from a single point the
in original scene. The blur image caused by regular
heartbeats can be simulated at horizontal and vertical
velocities given by
hði; j; k; lÞ ¼ hði2 kÞ
¼
1
Lþ1 ; o # i2 k # L; j ¼ l
0 otherwise
(
ð12Þ
4.4 White noise in image
Real images are often degraded by some random noise.
Noise can occur during capture or transmission. White
noise is frequently applied as the approximation of worst
degradation. A special case of white noise is Gaussian
noise. Gaussian noise in image is fabricated by the density
function, which is a very good approximation to realistic
noise. Test-moving images were generated by adding
different levels of Gaussian noise to the original images,
and transforming the noise-corrupted images according to
random transformations. The adopted Gaussian noise has
zero mean with standard deviation l.
4.5 Surface reflectance and illumination effect
When light is incident on a boundary interface between
two different media with a microscopically smooth and flat
material surface, such as float glass, the incident and
reflected light rays make the same angle with the normal to
the reflecting surface, producing specular reflection. If the
material surface is ‘rough’, not microscopically smooth,
diffuse reflections will occur. The reflection of light by a
surface can be studied using optics. Two approaches were
applied in the study of reflection.
Considering reflectance illuminated by a parallel light
source, we assume that the shape of the threads can be
approximated by a Gaussian function as a distribution
function of the radiance around the direction of ideal
reflection,
LðxÞ ¼ k exp 2x
2
2s2
 
: ð13Þ
The standard deviation is used as a parameter to describe
the degree of the surface, because the specular reflection
and diffuse reflection are defined between low and high
degree, respectively. The parameter k which denotes the
intensity of illumination amplitude is created using
uniform random numbers from 1 to 3 levels.
Figure 7 demonstrates the influences of various
conditions as described above in the simulations.
5. Results and discussion
There are a lot of aspects to be evaluated with the present
method of matching, including the robustness, the
accuracy and the speed using simulated and real data.
To investigate the characteristic of the present alignment
algorithms, validation experiments were performed using
simulation images. All of the present methods are run in
Cþþ on a personal computer (Intel Core CPU, 2.33GHZ,
RAM 4G). The quantitative analysis results are summar-
ised in Tables 1–4. The variation of registration errors is
small for different controlled values, indicating that all
W.-C. Lin et al.326
D
o
w
n
lo
ad
ed
 B
y:
 [
Na
ti
on
al
 C
hi
ao
 T
un
g 
Un
iv
er
si
ty
 -
Fu
ll
 L
ib
ra
ry
] 
At
: 
10
:5
4 
28
 M
ar
ch
 2
01
1
The approach assumes that point correspondence is
available between the images. The binary images of
vessel structures are obtained using a Gaussian filter for
the registration process which maximises the computed
similarity measure. Feature-based matching computation
is faster than MI, but it requires sophisticated image
processing for feature extraction and its matching depends
on the robustness of feature detection. As a result, the
image matching precision is not as good as that of the
intensity-based matching with motion blur effect.
Furthermore, the matching stability is greater with lower
complexity in operation and shorter matching time
between the reference image and the target image for the
methods such as the SAD, VR and NCC. This study finds
that NCC is the most effective metric with average errors
less than 1 pixel, and the CC greater than 1 for most cases,
with three simulation effects: motion blur, noise and
illumination effect. Table 5 lists the performance measures
of time consumed described previously. For comparison
of time consumed between our proposed measurement
methods, we find that Powell’s search algorithm was able
to effectively reduce the calculation time. Especially for
the more complex calculation method MI, the time
reduction ratio 71.94% is much higher than that of other
proposed methods. Based on the results of simulation, we
think that the VR method is simple, fast and robust to low
Table 3. Estimations by noise effect (n ¼ 50). RMSE and r values are listed.
Matching metric SAD VR NCC MI GFM
r 0.999 1.000 1.000 1.000 1.000
SNR ¼ 62 RMSE
(max. error)
0.02 ^ 0.14
(1.00)
0.00 ^ 0.00
(0.00)
0.00 ^ 0.00
(0.00)
0.00 ^ 0.00
(0.00)
0.00 ^ 0.00
(0.00)
r 0.999 0.999 1.000 0.998 0.999
SNR ¼ 29 RMSE
(max. error)
0.02 ^ 0.14
(1.00)
0.04 ^ 0.20
(1.00)
0.00 ^ 0.00
(0.00)
0.38 ^ 0.51
(1.41)
0.04 ^ 0.20
(1.00)
r 0.999 0.999 0.999 0.998 0.999
SNR ¼ 21 RMSE
(max. error)
0.28 ^ 0.49
(1.41)
0.25 ^ 0.45
(1.41)
0.22 ^ 0.44
(1.41)
0.87 ^ 0.65
(3.16)
0.06 ^ 0.24
(1.00)
r 0.999 0.999 0.999 0.998 0.999
Total RMSE
(max. error)
0.11 ^ 0.26
(1.41)
0.10 ^ 0.22
(1.41)
0.10 ^ 0.22
(1.41)
0.42 ^ 0.39
(3.16)
0.03 ^ 0.15
(1.00)
Table 4. Estimations by illumination effect on surface reflectance (n ¼ 50). RMSE and r values are listed.
Matching metric SAD VR NCC MI GFM
r 0.999 1.000 1.000 1.000 1.000
k ¼ 1, s ¼ 100 RMSE
(max. error)
0.11 ^ 0.39
(1.41)
0.00 ^ 0.00
(0.00)
0.00 ^ 0.00
(0.00)
0.00 ^ 0.00
(0.00)
0.00 ^ 0.00
(0.00)
r 0.998 1.000 1.000 1.000 1.000
k ¼ 1, s ¼ 150 RMSE
(max. error)
0.14 ^ 0.43
(1.41)
0.00 ^ 0.00
(0.00)
0.00 ^ 0.00
(0.00)
0.00 ^ 0.00
(0.00)
0.00 ^ 0.00
(0.00)
r 0.666 0.998 1.000 1.000 1.000
k ¼ 2, s ¼ 100 RMSE
(max. error)
23.87 ^ 41.95
(123.37)
0.30 ^ 0.46
(1.00)
0.00 ^ 0.00
(0.00)
0.00 ^ 0.00
(0.00)
0.00 ^ 0.00
(0.00)
r 0.415 0.528 1.000 0.097 1.000
k ¼ 2, s ¼ 150 RMSE
(max. error)
49.99 ^ 52.21
(126.81)
18.75 ^ 41.55
(126.09)
0.00 ^ 0.00
(0.00)
22.77 ^ 41.96
(110.92)
0.00 ^ 0.00
(0.00)
r 0.769 0.882 1.000 0.774 1.000
Total RMSE
(max. error)
18.53 ^ 23.74
(126.81)
4.76 ^ 10.50
(126.09)
0.00 ^ 0.00
(0.00)
5.69 ^ 10.49
(110.92)
0.00 ^ 0.00
(0.00)
Table 5. Time consumed (n ¼ 150 s).
Matching metric SAD VR NCC MI GFM
Direct search 103.26 149.85 246.42 4611.57 381.63
Powell’s search 64.59 83.59 134.68 339.92 179.48
W.-C. Lin et al.328
D
o
w
n
lo
ad
ed
 B
y:
 [
Na
ti
on
al
 C
hi
ao
 T
un
g 
Un
iv
er
si
ty
 -
Fu
ll
 L
ib
ra
ry
] 
At
: 
10
:5
4 
28
 M
ar
ch
 2
01
1
Matsopoulos GK, Delibasis KK, Mouravliansky NA, Asvestas
PA, Nikita KS, Kouloulias VE, Uzunoglu NK. 2003. CT-MRI
automatic surface-based registration schemes combining
global and local optimization techniques. Technol Health
Care. 11:219–232.
Mchedlishvili G. 1998. Disturbed blood flow structuring as
critical factor of hemorheological disorders in microcircula-
tion. Clin Hemorheol Microcirc. 19(4):315–325.
Plattard D, Soret M, Troccaz J, Vassal P, Giraud JY,
Champleboux G, Artignan X, Bolla M. 2000. Patient set-up
using portal images: 2D/2D image registration using mutual
information. Comput Aided Surg. 5:246–262.
Sugii Y, Nishio S, Okamoto K. 2002. In vivo PIV measurement
of red blood cell velocity field in microvessels considering
mesentery motion. Physiol Meas. 23(2):403–416.
Wang Z, Lu L, Bovik AC. 2004. Image quality assessment: from
error visibility to structural similarity. IEEE Trans Image
Process. 13(4):600–612.
Wei Z, Tan T, Sun Z, Cui J. 2005. Robust and fast assessment of
iris image quality. Adv Biomet :464–471.
Winkler S. 1999. Issues in vision modeling for perceptual video
quality assessment. Signal Processing. 78:231–252.
Woods RP, Cherry SR, Mazziotta JC. 1992. Rapid automated
algorithm for aligning and reslicing PET images. J Comput
Assist Tomogr. 16(4):620–633.
Wu C-C, Lin K-P, Chung B-T. 2007. A study of image quality
analysis for a cutaneous capillary imaging system. J Med
Biol Eng. 27(3):110–115.
Xu X, Dony RD. 2004. Differential evolution with Powell’s
direction set method in medical image registration. IEEE Int
Symp Biomed Imaging. 1:732–735.
W.-C. Lin et al.330
D
o
w
n
lo
ad
ed
 B
y:
 [
Na
ti
on
al
 C
hi
ao
 T
un
g 
Un
iv
er
si
ty
 -
Fu
ll
 L
ib
ra
ry
] 
At
: 
10
:5
4 
28
 M
ar
ch
 2
01
1
method to measure velocity proﬁles of a blood ﬂow in the multiple
branching of frog mesentery employing microscopic video imaging
(Manjunatha and Singh, 2002). In the literature by Kempczynski and
Grzegorzewski (2008), the Hough transform technique has been
adopted to estimate the velocity of RBC aggregates during sedimenta-
tion. RBC velocity was also estimated by using the Hough transform
method in a simulation experiment. The results show that velocity
assessment performs excellently up to 750 pixels/s. At higher velocities
(N1250 pixels/s), themethod fails and selects an alternative orientation
that results in a large velocity error (Dobbe et al., 2008).
Generally, the blood ﬂow velocity inside microvessels in vivo is
estimated along the central line of vessels. The accuracy of calculated
results, which is algorithm dependant, has rarely been examined. In
this paper, the red blood cell velocities in microvessels were
calculated using the three mentioned measurement methods: cross
correlation method, Hough transform method, and optical ﬂow
method, through simulation of intravital microscopic imaging. The
accuracy of the methods was evaluated by applying these methods to
simulated microvessel image sequences, of which the RBC velocities
are known. The calculation accuracy of different ﬂow patterns and
vessel shapes were also examined respectively.
Materials and methods
Image generation
In microcirculation, the capillaries lie between, or connect, the
arterioles and venules. Capillaries form extensive branching networks
in a vivo body, which dramatically increase the surface areas available
for rapid exchange of molecules. A capillary is a thin size form of
vessel. Pre-capillary is a vessel lacking complete coats, located just to
the arterial side of a capillary, and is about 3–5 times in diameter. It is
not much different from capillary in other respects. Pre-capillary and
capillary branch off from metarteriole and terminal arteriole. The
simulation images were generated based on the physical (or
physiological) and anatomical characteristics of microcirculation.
The capillary bed is simulated in various forms, with one of them in
straight line, and another clip shaped for one RBC to pass. Branching
bed of pre-capillary into capillary is also simulated. A Matlab based
computer program (MathWorks, version 7. 1) was used to generate
the micro-vessel image sequences.
Blood is a complicate heterogeneous liquid with its viscosity
varying with shear rate. It possesses non-Newtonian characteristics.
Two kinds of dynamic blood ﬂow images were simulated in this study.
One was to simulate the random motion of RBC in various shapes of
blood vessels. Individual RBCs suspended in autologous plasma that
have randommotion were studied too in this category. The other one
focused on the blood ﬂow variation with different RBC densities. This
is included in our study because the density of RBC, or hematocrit, is
the most important factor in blood hydrodynamic variation. The RBC
density also dominates the variation in viscosity. The higher RBC
density, or the higher hemotocrit, results in higher friction between
the blood layers, which causes higher viscosity. Normal hematocrit is
about 50% of blood in volume. In the simulation, the RBC densities
were grouped to high, medium and low levels.
Vessel size and shapes
Vessel size varies in a wide range in human anatomy.Micro vessels
were generated with various sizes: (1) 1-RBC wide in diameter
(Fig. 1a), (2) 2-RBCs wide in diameter (Fig. 1b) and 4-RBCs wide in
diameter (Fig. 1c). Different vessel shapes were generated with the
Matlab-based program in order to cover various real conditions as
blood ﬂow in micro-vessels. The RBC movement in vessels followed
the velocity variation shown in Fig. 1d through e. Fig. 1f and g gives 2
examples of shapes: branching and clip (or clip-shape). These shapes
can often be found in various parts of a human body. For example, the
clip-shape vessel is very common in ﬁnger nail-fold.
Spatial distribution of RBC velocity in micro-vessel
The RBC velocity varies depending on the RBC location in a vessel.
Mathematical expression of the RBC motion model is showing in
Fig. 2. The RBC velocity Vwas simulated as a function of radius r inside
a vessel, V(r)=Vc(1−r2/R2), in which Vc is the center velocity (r=0),
R is the vessel radius. Due to viscosity, the velocity is less in value as r
increases (closer to the vessel wall). Motion in vessels of various RBC
densities was also modeled. Low, medium and high density of RBC is
deﬁned based on the number of cells per unit volume. Fig. 3 shows
examples of vessels with different RBC densities. With different
densities, the image sequences were generated with various maxi-
mumRBC velocities of 1, 3, 5, and 10 pixels per frame respectively. The
RBC velocities have a parabolic curve function in relation to the
location inside a micro-vessel.
RBC velocity estimation
Cross correlation method (CCM)
Several studies have focused on the use of cross correlations for the
assessment of RBC velocity (Tsukada et al., 2000). The use of these
methods corresponds to the tracking of characteristic patterns in
space or in time. In this study, temporal correlation was used to
measure the blood ﬂow velocity in themicro-vessels. For the temporal
cross correlationmethods, the transit time between two regions of the
micro-vessel is estimated by measuring the intensity of two
independent windows positioned on the skeleton of micro-vessel.
This transit time, estimated using an image correlation function
between the windows, is used to estimate the velocity.
Fig. 1. Various micro-vessels. Different sizes in diameter: (a)-(c) the diameter of the
micro-vessel is one, two and four times of the RBC size, respectively. (d)-(e) micro-
vessel changes from narrow to wide and vice versa. (f)-(g) Two vessel shapes: (f)
branching (g) clip.
478 T.-C. Huang et al. / Microvascular Research 80 (2010) 477–483
at the origin, and R the length of this vector, which is equal to the
distance of the line to the origin. The discrete image of parameter
space consists of accumulated cells, H(θ, R), that are incremented for
each sinusoidal curve that passes the cell.
On a proﬁle image, border detection is performed using the Canny
edge method. Characteristic curves, straight lines in this study, are
then detected using HTM. The angle θ is calculated using the straight
lines. The blood ﬂow velocity V is calculated by equation
V = 1= tan θð Þ: ð3Þ
The horizontal axis of a proﬁle image is the grey level distribution
along the central line of a blood vessel. The spatial resolution of the
image determined by hardware is 1.42 μm, and if the temporal
resolution is 1/30 s, determined by the maximum sampling rate of the
system. From the velocity equation
V = △D=△T; ð4Þ
we know that the horizontal axis of a proﬁle image corresponds to
distance while the vertical corresponds to time. As the gaps between
RBCs, or the variation among the RBCs, are reﬂected as the grey level
variation along the central axis, the characteristic lines or strips can be
obtained from the proﬁle image. Using the angle between the lines
and the horizontal axis θ, the velocity equation becomes
V = △D=△T = 1= tan θð Þ ð5Þ
An example of using Hough Transform to get the angle θ from a
blood ﬂow proﬁle image is given here. The Canny characteristic
images are generated by applying Hough transform to the proﬁle
image which is shown as schema in Fig. 4a. The resulted images are
shown as (b) in Fig. 4. The coordinates of the brightest spots are then
located, which are the maximum values of the transform. Since the
point of the longest line appears many times at the same angle, by
analyzing c to f in Fig. 4, the maximum number of appearance and the
corresponding angle are obtained for each image. Such brightest
coordinates (R, θ) calculated for c, d, e and f are (23,−18°), (43,−19°),
(40,−20°) and (26,−19°) respectively. The average blood ﬂow velocity
is thus 284.22 μm/s.
Optical ﬂow method (OFM)
Optical ﬂow computation results in motion direction and motion
velocity at image points. The immediate aim of OFM-based image
analysis is to determine a motion ﬁeld. It reﬂects the image changes
due to motion during a time interval dt, and the optical ﬂow ﬁeld is
the velocity ﬁeld that represents the three-dimensional motion of
object points across a two-dimensional image. In the present study,
this gradient-base OFM (Horn and Schunck, 1981; Wu et al., 2009;
Huang et al., 2006; Zhang et al., 2008a; Guerrero et al., 2004; Zhang
et al., 2008b) was applied to calculate the RBC velocity on two
successive images. The velocity matrix of displacement, including
horizontal and vertical movement respectively on the vessel image for
each single pixel, was acquired using OFM. The velocity calculation
equation in OFM is shown below.
v n + 1ð Þ = v nð Þ + ∇f
∇f ⋅v nð Þ + ∂f∂t
α2 +‖∇f ‖2
 !
ð6Þ
where n is iteration times and v nð Þ is the average velocity derived from
the surrounding pixel.
Optical ﬂow equation calculates the difference of images and ﬁnds
the deformed image to match the next frame. Originally, optical ﬂow
method (OFM) requires a very small time interval between
consecutive images and no signiﬁcant change occurs between two
Fig. 4. (a) An image of temporal proﬁle which was composed of intensity of pixels on the central line of micro-vessel. In this example, the length of central line is 256 pixels. (b) The
edge of temporal proﬁle (256×100 pixels) was obtained by using Canny edge detection, which was divided into four of small square diagrams with a size of 64×100 pixels from top
to bottom. (c)-(f) are the Hough transformations which correspond to Canny edge detection as in (b). The angle of the maximal aggregate value of appearance for each image is (c)
-18°, (d) -19°,(e) -20°and (f) -19° respectively.
480 T.-C. Huang et al. / Microvascular Research 80 (2010) 477–483
maximal velocity of 1, 3, and 5 pixels, respectively. The worst relative
error occurred at the highest maximum velocity case (10 pixels/
frame), while the worst relative average error was at the lowest
maximumvelocity case (1 pixel/frame). The relative average error can
be as high as 25% (Fig. 7b).
Conclusions
Three methods, which are commonly applied in red blood cell
(RBC) velocity measurement in micro-vessels, were evaluated with
simulated microscopic video image sequences in this study. The
optical ﬂow method (OFM) demonstrated superior accuracy over the
cross-correlation method (CCM) and Hough transform method
(HTM). With larger size vessels, for which both CCM and HTM have
difﬁculties in RBC velocity estimation, OFM can still provide accurate
results. This comparison study concluded that OFM is suitable for
Fig. 6. The velocity analysis using OFM in micro-vessels at selected points.
Table 2
The absolute average error by suing OFM in different RBC densities with the same
micro-vessel bed.
The average error estimation of RBC velocity, Mean±S.D. (pixel/frame)
RBC movement, maximum (average)
Velocity 1 pixel 3 pixels 5 pixels 10 pixels
Density (0.7) (2.1) (3.5) (7)
Low 0.200±0.157 0.220±0.176 0.267±0.171 2.107±0.776
Medium 0.203±0.159 0.235±0.171 0.268±0.168 1.440±0.578
High 0.204±0.172 0.246±0.175 0.281±0.177 0.911±0.473
Overall 0.202±0.163 0.234±0.174 0.272±0.172 1.486±0.609
Table 3
The relative average errors by suing OFM in different RBC densities with the same
micro-vessel bed.
The percentage of average error in different RBCs velocity (%)
Maximal velocity
Velocity 1 pixel 3 pixels 5 pixels 10 pixels
Density
Low 28.6 10.5 7.6 30.1
Medium 29.0 11.2 7.7 20.6
High 29.1 11.7 8.0 13.0
Overall Mean±S.D. 28.9±0.3 11.1±0.6 7.8±0.2 21.2±8.6
(C.V.) (0.9) (5.4) (2.7) (40.3) Fig. 7. The velocity estimation in various RBCs densities within same micro-vessel: (a)
absolute average errors, (b) relative average errors.
482 T.-C. Huang et al. / Microvascular Research 80 (2010) 477–483
Journal of Medical and Biological Engineering, 32(2): 97-102 97 
Red Blood Cell Velocity Measurement in Rodent Tumor 
Model: An in vivo Microscopic Study 
Wen-Chen Lin1,2   Chih-Chieh Wu3   Tzung-Chi Huang4   Wen-Chi Lin1,2                                     
Bill Yuan-Chi Chiu5   Ren-Shyan Liu6,7   Kang-Ping Lin1,2,
*
 
1Department of Electrical Engineering, Chung Yuan Christian University, Chungli 320, Taiwan, ROC 
2Holisc Medical Device Development Center, Chung Yuan Christian University, Chungli 320, Taiwan, ROC 
3Instrument Technology Research Center, National Applied Research Laboratories, Taipei 106, Taiwan, ROC 
4Department of Biomedical Imaging and Radiological Science, China Medical University, Taichung 404, Taiwan, ROC 
5Research and Development Center for Membrane Technology, Chung Yuan Christian University, Chungli 320, Taiwan, ROC 
6Department of Biomedical Imaging and Radiological Sciences, National Yang Ming University, Taipei 112, Taiwan, ROC 
7Department of Nuclear Medicine, Taipei Veterans General Hospital, Taipei 112, Taiwan, ROC 
Received 7 Dec 2010; Accepted 18 Apr 2011; doi: 10.5405/jmbe.875 
 
Abstract 
Blood flow dynamics in microvessels in a small animal tumor model provide important physiological and 
pathological information. In this study, red blood cell velocity in microvessels distributed near the surface in a rodent 
tumor model is investigated using an approach based on optical flow estimation. A long-term experiment is performed 
to observe tumor growth on nude mice and to monitor the variation of blood flow velocity. The blood flow images are 
acquired using a capillaroscope with a spatial resolution of 1.42 μm and an image sampling rate of 30 frames per second. 
Frame to frame image registration with mutual information feature matching is used to stabilize images to eliminate the 
vessel shift that results from regular heartbeats. The blood flow results measured by the optical flow method are 
compared with visual inspection results to verify accuracy. The blood flow observations focus on the tumor surface of 
nude mice. Multiple weekly data are acquired from each nude mouse for five weeks after tumor implantation. The 
average red blood cell velocities of capillaries are measured and calculated at different weeks for each tumor. The 
distribution of blood flow velocity among all samples ranges from 40 to 350 μm/s. The differences in vessel diameter 
and blood flow velocity during tumor growth are studied. A significant difference is found between the velocity values 
at the initial week and the 2nd week. The results suggest that an optical-based method can be used to develop 
experimental protocols for the numerical simulation of tumor growth. The proposed measurement system may also be 
useful in many other biotechnological evaluations. 
 
Keywords: Microcirculation, Blood flow velocity, Tumor growth, Microscopy 
1. Introduction 
Microcirculation is crucial for the maintenance of healthy 
tissues and functional organs as it delivers oxygen and 
nutrients. In clinical studies, the relationship between blood 
flow in microcirculation and blood circulation has been 
extensively researched. Studies have shown that various risk 
factors of disease can be related to corresponding changes in 
microcirculation. For instance, Raynaud’s syndrome [1,2], 
hypertension [3,4], and diabetes [5,6] are usually accompanied 
by impaired microcirculation. Therefore, microcirculation 
information, namely vessel diameter, flow velocity, vessel 
 
* Corresponding author: Kang-Ping Lin 
Tel: +886-3-2654825; Fax: +886-3-2654899 
E-mail: kplin@cycu.edu.tw 
density, permeability, leucocyte function, and tracer appearance 
times, plays an important role in health assessment and 
angiopathy prevention. In order to identify the characteristics of 
microcirculation during illness and its response to medicinal 
drugs, the hemodynamic characteristics of blood flow [7-9] 
must be obtained. The heterogeneous nature of blood flow in 
tumors results in a lack of nutrient supplement to tissues. 
Further investigations are needed to determine the mechanisms 
of this bizarre characteristic in tumor microcirculation [10]. The 
measurement of blood flow velocity at local microvessels is an 
effective method of observing and quantifying microvessel 
differences during tumor growth. Several studies have 
investigated tumor microcirculation using intravital video 
microscopy (IVVM), which allows dynamic observation of red 
blood cell (RBC) activity in the microcirculation of intact 
organs and tissues in live animals, such as laboratory mice [4,5]. 
RBC flow of Rodent Tumor 99 
Image Stabilization
Blood Flow
Velocity Estimation
Microcirculation
Tissue
Video Camera
White-LED
Analysis Results
Lens
Vein
Artery
Image Acquisition
Image Sequence
Surface
 
Figure 2. Schematic representation of the microscopy system and data 
analysis flow chart. 
2.4 Imaging processing and RBC velocity 
Respiration and pulsatile heartbeats result in oscillatory 
movement of the body in IVVM observations. Therefore, image 
stabilization was the first step of image processing. With a cost 
(or similarity) function to quantify the quality of the alignment 
of two images, frame-to-frame image matching can effectively 
mitigate the motion [12,13]. Prior to the implementation of the 
optical flow algorithm, each pair of digitized images was 
processed by a homomorphic filter, a median filter, and a 
matching filter. The optical flow algorithm was implemented in 
Microsoft (MS) Visual C++™. The preprocessing steps are 
described below. 
Homomorphic filtering. Since the IVVM images of blood flow 
through microvessels were low contrast, a homomorphic filter 
was used to compress the dynamic range and enhance contrast 
[14]. 
Median filtering. Median filtering is a nonlinear operation that 
is implicitly edge-adaptive. A 5 × 5 window-sized median filter 
was used to denoise the image by reducing the blurring of edges. 
Matching filter. Vascular images can be calculated using a 
simplistic matching filter after Gaussian smoothing to reduce the 
computation load and to segment microvessel trees [15]. Vessel 
density can be calculated as the number of vessels. Vessel size is 
then categorized by the diameter of vessels. 
Velocity estimation. A gradient-based deformable image 
registration algorithm, the optical flow method (OFM) [16,17], 
was applied to calculate the RBC velocity from two successive 
images. In our previous study, an automatic RBC velocity 
estimation system was developed to perform OFM-based 
measurements in a complete, clip-shape capillary [12]. A flow 
chart of velocity estimation is shown in Fig. 3. Based on Horn 
and Schunck’s method [18], an approach is developed here to 
constrain the optical flow field. Horn and Schunck’s method 
calculates the optical flow within the gradient of images by 
iterating Eq. (1). 
       
       
1
22
2
, ,
ˆ , ,
k k
x y
k k
x x
f f f
v X t v X t
f x y t
v X t v X t
x f f
x y


   
    
    
                    
       
       
1
22
2
, ,
ˆ , ,
k k
x y
k k
y y
f f f
v X t v X t
f x y t
v X t v X t
y f f
x y


   
    
    
                  
(1) 
where k is the iteration counter, the overbar denotes weighted 
local averaging (excluding the present pixel), and all partials are 
evaluated at the point (x, y, t). The initial estimates of the 
velocities 
   0 ,xv X t  and 
   0 ,yv X t  are usually taken as zero. 
If object movement is large or no features overlap, the Horn and 
Schunck optical flow method does not give reliable velocity 
flow fields. To avoid this problem, the Horn and Schunck 
optical flow is preprocessed with a deformed image which 
depends on the velocity field estimated from the source image. 
The features are thus modified to the covered pattern according 
to the correct patterns in the next frame. This helps motion 
estimation, yielding a suitable velocity field. In another study, 
the authors discussed the use of three techniques for RBC 
velocity measurement using simulated blood flow images [17]. 
The OFM, a space-time diagram (Hough-transform-based 
estimation), and the cross-correlation method (CCM) are 
suitable for RBC velocity determination. Among these three 
approaches, the OFM has the highest accuracy in RBC velocity 
calculation with simulated blood flow patterns of microvessels. 
In the present study, a velocity estimation method based on 
analyzing the intensity variation of pixels on the skeleton of a 
vessel was used. A thinning method [12], which enables a 
continuous vessel skeleton including small and large 
microvessels, was applied to vascular tree segmentation. The 
obtained skeleton was independent of the position of the region 
of interest (ROI) in an image pixel matrix of 256 × 256. Thus, 
the measurements of the RBC velocity are consistent and 
reproducible (Fig. 4). 
 
Figure 3. Flow chart of velocity computation. 
3. Results 
3.1 Tumors in mice 
A total of 25 mice, which weighed 22.7 ± 0.88 g, were 
divided into two groups. Ten mice were in the control group 
and the remaining 15 were in the tumor experimental group. 
Figure 5 shows the weekly tumor growth on the back leg 
muscle of SCID mice. Table 1 lists the average sizes measured 
every week in the experiment group after tumor implantation. 
Figure 6 shows the weekly average volumes. Tumors 
grew gradually in the first 2 weeks with mild rates of 49.58 
mm3 in the 1st week and 63.37 mm3 in the 2nd week. The 
growth was rapid in the 3rd (228.22 mm3) and 4th weeks  
RBC flow of Rodent Tumor 101 
 
Figure 8. Averaged blood flow velocity at each week of growth. Test of 
significance (independent T-test) value indicated by “*” 
(p < 0.05). 
 
velocity in the large vessels was always faster than that in the 
small vessels. The average velocities were 150.54 ± 32.28 μm/s 
for the large vessels and 112.74 ± 57.62 μm/s for the small 
vessels. In the tumor group, for both large and small vessels, 
the highest and second highest flow velocities were found in 
the 2nd and 1st weeks, respectively. The averages of the highest 
velocities were 171.76 ± 82.22 μm/s for the small vessels and 
225.35 ± 66.36 μm/s for the large vessels. The averages of the 
second highest velocities were 131.20 ± 23.72 μm/s and 
171.25 ± 98.07 μm/s, respectively. The small and large vessels 
exhibited opposite tendencies from the 3rd to the the 5th weeks. 
In small vessels, the blood flow gradually declined during the 
last 3 weeks. The average values for the small vessels from the 
3rd to the 5th weeks were 130.92 ± 59.52, 126.96 ± 49.87, and 
110.67 ± 63.20 μm/s, respectively. In the large vessels, the 
velocity had a sudden decrease in the 3rd week, and then 
increased gradually in the last 3 weeks. However, the velocities 
did not exceed those of the first two weeks. The values for the 
large vessels in the 3rd to the 5th weeks were 116.95 ± 46.71, 
130.20 ± 56.30, and 148.37 ± 55.46 μm/s, respectively. 
Statistical analysis of blood flow velocity was done using the 
independent T test. According to the p values (p < 0.05) 
obtained for each week compared to week 0, a significant 
difference was found between the velocity values in the 2nd 
week. In the experimental group, a significant difference 
(p < 0.01) was found between the vessel diameter values in 
each week. The blood flow velocity in the large vessels was 
larger than that in the small vessels, except in the 3rd week. 
Since the definitions of arterioles and venules are not suitable 
for describing vessels in tumors, these terms are not used here 
[20]. The results obtained using the proposed imaging system 
and analysis method are consistent with those reported in a 
previous study [21]. In that study, the blood flow velocity 
measured at the tumor surface of SCID mice was on average 
200 μm/s with a range of 0~600 μm/s. 
4. Discussion 
The differences in vessel diameter and blood flow velocity 
during tumor growth were found to be statistically significant. 
The blood vessel density increases with tumor growth, reaching 
its maximum at the late phase [22, 23]. According to the 
obtained tumor growth curves from experiments, tumors grew to 
a certain volume in the initial phase (1st and 2nd weeks). The 
regional nutrition and oxygen requirements in the initial phase 
are high. To satisfy this high demand, the incomplete 
microcirculation system in the initial phase is compensated for 
with high blood flow velocity. In the growth phase (3rd and 4th 
weeks), the slow blood flow in tumor microcirculation resulted 
from two factors. First, the microvessels in tumor tissues are 
different from those in normal tissues. In tumor tissues, the 
microvessels are lumens formed by a layer of endothelial cells 
as barrier walls. These lumens have incomplete differentiation, 
and are not controlled by nerves, which paralyzes the 
microvessels. The blood flow in such microvessels hence cannot 
be varied by varying the diameter, and thus tends to be constant. 
Second, a high-density microcirculation system is well 
established in this phase, which can provide sufficient nutrition 
and oxygen to the tumor cells even with a relatively slow blood 
flow. In the 4th and 5th weeks, tumor growth is still fast. The 
cells in the edge regions usually require more nutrition and 
oxygen than those in the tumor center. As microvessels are 
lower in density or even not present in the center volume, the 
blood flow velocity stops increasing. As a result, apoptosis is 
often found in the tumor cells in the center volume due to 
ischemia. 
Other studies have used intravital microscopy techniques 
with fluorescence labeling to measure temporal instabilities in 
red blood cell flow in individual vessels in small sub-regions of 
tumors growing in window chambers [24]. However, 
fluorescence microscopy may have some detrimental effects on 
living tissues. For long-term observation, this study used a 
microscopy system without fluorescence labeling to evaluate the 
velocity range of blood flow through a solid tumor area. 
5. Conclusion 
A microcirculation imaging system that uses white LEDs 
as the illumination source and no fluorescence labeling was used 
for in vivo tumor surface microcirculation blood flow velocity 
measurements. Weekly blood flow velocity data were collected 
from the tumor surface microvessels in nude mice. The 
techniques used in this microcirculation study have potential 
applications in tumor development evaluation and prognosis. 
The tumor microcirculation data of small animals obtained in 
this study could be a reference for tumor and blood 
pathophysiology research in the future. 
Acknowledgments 
The authors acknowledge the financial support by the 
National Research Program for Genomic Medicine (Molecular 
and Genetic Imaging Core, NSC 99-3112-B-010-015), the 
National Science Council of Taiwan (NSC 99-2221-E-033- 
012-MY3), and the Department of Industrial Technology of the 
Ministry of Economic Affairs of Taiwan (99-EC-17-A-19- 
S1-163). 
References 
[1] S. Bertuglia, P. Leger, A. Colantuoni, G. Coppini, P. Bendayan 
and H. Boccalon, “Different flowmotion patterns inhealthy 
controls and patients with Raynaud’s phenomenon,” Technol. 
國科會補助專題研究計畫出席國際學術會議心得報告 
                              日期： 102  年 7  月 15 日 
一、參加會議經過及與會心得 
本人此次參加在日本大阪會議中心所舉行之 IEEE-EMBS-2013，共計有三項工
作，分別為： 
(1)發表醫學影像成果之論文 
(2)參加 IFMBE 亞太工作小組會議 
計畫編號 NSC  99-2221-E-033 -012 -MY3 
計畫名稱 以白光 LED 顯微造影技術在裸鼠腫瘤微循環血管之血流速分析
研究 
出國人員
姓名 林康平 
服務
機構
及職
稱 
中原大學 電機系 特聘教授 
會議時間 2013 年 7 月 3 日至2013 年 7 月 7 日 
會議
地點 
日本 大阪 
會議名稱 
(中文)第 35 屆 IEEE 生物醫學工程國際研討會 
(英文)  The 35th Annual International Conference of the IEEE 
Engineering in Medicine and Biology Society (EMBC’13) 
發表題目 
(中文)以非均相性擴散與權重 k 均值類聚之乳房影像強化法 
(英文) Mammogram Enhancement Using Anisotropic Diffusion and 
Weighted K-means Clustering 
期望能為我國舉辦之 APCBME-2014 之亞太地區每三年舉行一次之國際醫學工
程研討會，此研討會將於明年十月於台南成功大學為使此會議能受到亞太地
區以及世界各地之人士了解，本人在 IFMBE 之亞太工作會中，報告各個工作
之內容外，也與 IEMBE 總會會長以及重要會務運作人士，協商未來之論文出
版品，由 Springer 國際出版商發行外，並取得 IEMBE 總會同意，在今年九月
底的歐洲醫工研討會中，討論將每年舉辦的 IFMBE 執行委員會議，會員團代
表會議以及亞太工作會議均安排在台南舉行，同時，將可吸引更多的國際重
要醫工學者來台灣訪問。對於提升我國國際地位，以及國際影響力，影響深
遠。 
以上所述為此出國參加 IEEE-EMBS-2013 會議之重要記述。 
 
三、發表論文全文或摘要 
1.論文題目：Mammogram Enhancement Using Anisotropic Diffusion and 
Weighted K-means Clustering 
2.作者：施莉娜、林耿宏、林汶正、林康平 
3.摘要： Mammogram is used to diagnose the breast cancer. However the 
region in digital mammograms are usually noisy and have low contrast, they 
might affect the interpretation. This study proposed a combination of an 
anisotropic diffusion technique and a weighted K-means clustering. The results 
from the real mammogram presented that the proposed method succeeded to 
improve the performance of Original Anisotropic Diffusion method to reduce 
the noise and enhance the image contrast. 
 
國科會補助計畫衍生研發成果推廣資料表
日期:2013/08/23
國科會補助計畫
計畫名稱: 以白光LED顯微造影技術在裸鼠腫瘤微循環血管之血流速分析研究
計畫主持人: 林康平
計畫編號: 99-2221-E-033-012-MY3 學門領域: 醫學資訊
無研發成果推廣資料
其他成果 
(無法以量化表達之成
果如辦理學術活動、獲
得獎項、重要國際合
作、研究成果國際影響
力及其他協助產業技
術發展之具體效益事
項等，請以文字敘述填
列。) 
本研究三年內所完成之動物實驗成果，發表於國內外重要之醫學工程期刊，並
獲得 2012 年之 JMBE 期刊年度最佳論文獎，以及中國工程師學會工程論文獎。
 成果項目 量化 名稱或內容性質簡述 
測驗工具(含質性與量性) 0  
課程/模組 0  
電腦及網路系統或工具 0  
教材 0  
舉辦之活動/競賽 0  
研討會/工作坊 0  
電子報、網站 0  
科 
教 
處 
計 
畫 
加 
填 
項 
目 計畫成果推廣之參與（閱聽）人數 0  
 
