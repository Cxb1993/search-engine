 2
一. 前言與研究目的 
網際網路的普及和多媒體編碼技術的進步，分散式(decentralized)的媒體處理
有逐漸取代 client/server 架構為主的中央化 (centralized)的媒體處理或搜尋引擎。
目前的主流是網路上的每一台電腦都可以是 client，也可以為 server，即點對點
(Peer-To-Peer,P2P)的資料處理架構。其有三種主要的架構，即 centralized、
decentralized structured，和 decentralized unstructured。在 centralized 的架構中如
Napster[1]），有一個中央伺服器 server 紀錄了檔案儲存在哪一個網路端點 peer，
所以當某一個端點 peer 要進行搜尋時，必須要與 server 溝通，取得想要的檔案位
置資訊然後迅速存取，此一檢索方是雖然迅速，但其致命的缺點為當 server 受到
攻擊而無法正常運作時，整個系統會癱瘓。分散式的檢索系統則可以避免這樣的
風險，在分散式的檢索架構下(如 DHT[4])，檔案(file)被轉換成 key 來表示，每一
個 peer 都有自己所負責的 key，進行檢索時只需要 log(N)個 hop 就可以找到 file。
但此架構當有 peer 加入或離開系統後，相關的運作會相當複雜，因此不適合提供
複雜的搜尋或檢索。在 decentralized unstructured 架構下(Gnutella[2]、Freenet[3])，
檔案存放的位置是隨意的，peer 之間沒有事先儲存任何端點的資訊，即每個 peer
都是獨立運作的。因此在檢索時只是盲目地將訊息以類似水氾濫(flooding)的模式
傳遞。以此隨機散佈的檢索方式，檢索效率必然不佳。然此架構可以提供較複雜
的檢索方式，如向量空間(Vector Space)的比對。因此本計畫以此架構為主要的系
統設計方向。 
 
二、文獻探討 
為了在 P2P 環境下進行影像內容檢索 Content-Based Image Retrieval, CBIR)，
必須透過分群(clustering)，讓內容有相關性的 peer 互相連接，相連的 peer 在內容
上可能有相關的主題。在檢索時，不要進行無謂的路由 routing，進而提升檢索的
效率。常見的方法有 directory node[5]、R-tree[6]和 table of interest[7]等，以 directory 
node 而言，每一個的 cluster 都由一個 directory node 來管理，檢索時藉由自己的
directory node 來發送檢索詢例 query，可避免不必要的路由 routing 而提升檢索的
效能，其 supernode 和 ultrapeer 都是相同的觀念。而 R-tree 的方式，peer 中 image
的 feature vector 以 R-tree 的方式 clustering，每一個 cluster 用數個 super-peer 來管
理,檢索採用 k-NN query 和 Range query，只選擇 distance 小的 peer 來進行檢索，
進而減少無謂的 routing。Table of interest 是指每一個 peer 都有一個 table，紀錄
之前的檢索結果，在下一次的檢索時，可藉由之前的經驗，讓 peer 可以選擇對比
較可能有相關內容的 peer 發出檢索。 
有了群集 clustering 的幫助，對於 P2P 影像檢索系統而言，資訊傳遞(flooding)
的策略也是非常重要，文獻[8]中說明了許多在 P2P 網路下 flooding 的方法與評
估，另外在文獻[8]提出紀錄上次檢索最後到達的 peer，以便下次檢索能直接把
 4
本研究所採用的架構如圖一(a)上所示，每個端點的運作模式都一樣(圖一(a)下)，
同時具備 client 和 server 的角色。而探索的深度由 TTL 來設定。內部的架構如圖
一(b)所示，主要的特點是運作的一致性，而仍然可以藉由調整參數來達成不同
的檢索策略。這部分的介紹在第一年的結案報告已有說明。本研究報告著重在整
體系統的改進部分。在進行檢索之前，可以先對系統中的所有 peer，依照 peer
與 peer 之間的相似程度建立群聚(clustering)資訊。如此則可以在檢索過程
中，避免不必要的路由(routing)以增加檢索在時間和精確度上的效率。 
漸進式檢索方法 (scalable retrieval)  
漸進式檢索的運作可以圖二來說明，其中框起來的文字或數目表是以經收到的相
似影像數目或端點。假如 A 是檢索端點，A 將檢索 Q 傳送給 B, C 和 D 並將 TTL
的值減一（圖二(b)）。端點 C 將檢索訊息 Q 傳給 Q 和 E。D 又傳給 F 和 G(圖二
(c))。在此同一時間，B 已經開始回傳所搜尋到相似的影像並回傳給 A。因為 A
一次只能接收一個端點的回傳影像，因此端點 B,C 和 D 的相似影像必須輪流回
傳。在 B 回傳的同時，E 也開始回傳影像給 B。G 也同時可以回傳資料給 C。依
此類推，端點 A 所接收到的相似影像就會逐漸增加，而使用者可以在任何時間
決定是否要停止檢索程序。 
     
(a)      (b)              (c)           
     
(d)      (e)      (f) 
圖二、在 P2P 檢索系統上提供漸進式檢索(scalable retrieval)的示意圖 
NCCA (Normalized Correlation Coefficients Algorithm) 
因為我們使用兩種 feature，所以檢索時會產生兩組排名(rank)，必須將兩組排名
整合。我們採用正規化之關聯系數 NCCA 來整合排名。相關的細節可參考文獻
[15]。在影像型狀特徵方面，我們採用 Zernike Moments, ZMs 做為對影像區塊形
狀描述。色彩特徵以分布直方圖(Color Histogram) 為最普遍使用，其優點是方法
簡單且計算快速。特徵不會受影像中物體之平移、旋轉、變形等的影響。圖三顯
示使用 NCCA 方法的系統圖。我們可以將檢索結果以下式表示： 
        (1) 
 6
我們也模擬文獻上煙火式檢索(Firework Query model)以作為評估效能的比較。在
圖四(a)中，顯示了不同方法的檢索回取率，本研究所提出的 Heter 方法顯示最佳
的回取率。因為若採用固定回傳張數的策略，則也會增加回傳不相干影像的機
率。因此會降低檢索的回取率。比較合理的作法應是固定每一個端點在回傳影像
時的相似度門檻。如圖四(b)所示，因為只有相似度高的影像被回傳，因此回取
率比較高。 
網路與端點傳送資料的時間區段以圖五顯示。根據實際的狀況分析，每個端
點處理檢索運算的時間與處理網路傳送依張影像的時間比約為 103，因此在記錄
端點活動時間區段的過程中，可以只分析網路傳送資料的時間。當檢索程序完成
後，某一時間點處與檢索運算的端點數目為 
( ) ( )?1: 0,
op
peer p
p P
n t t T
∈
= ∈∑                        (6) 
其中 pT 紀錄某一端點 p 處於運算傳輸的時間區段而 opP 表示某一檢索過程中所
有會被探索的端點。上式的意義可以藉由圖五的時間區段表示來瞭解其運算的過
程與目的。 
 
圖五、端點電腦(A,B,…G)處於檢索與傳送的時段 
       
(a) 固定回傳影像張數    (b) 固定回傳相似度門檻 
圖四、檢索效能的比較(a) 固定回傳影像張數 (b)以固定的相似度門檻進行檢索
之效能（TTL 大小亦固定） 
最佳化檢索參數控制 
一般而言，當使用者比較多的時候，P2P 影像檢索系統所能提供給每一個使用者
的檢索回取率就會比較低。反之，使用者比較少則會有比較高的回取率。對於一
個檢索程序 Q，平均使用者數目可以下面的公式來計算：       
