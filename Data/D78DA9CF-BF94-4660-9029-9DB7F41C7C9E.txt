 2
pressure control valve, this study proved that 
with proper design controller incorporated 
with pressure valve to control the hydrogen 
flow rate can reduce the fuel cell motorcycle 
system cost. Fuel cell motorcycle powertrain 
simulation under HIL environment can 
provide information for controller parameter 
effects evaluation which can reduce the 
trial-and-error and research and development 
time. 
Keywords: Hydrogen Fuel Cell Motorcycle   
Power Control, Pulse Width 
Modulation Hydrogen Flow 
Controller, Fuel Cell Motorcycle 
HIL Simulation.  
 
二、緣由與目的 
 
近年來能源危機導致油價暴漲，石油
能源的節源議題不斷地被提出，台灣目前
也積極的投入高效率及低污染的能源開
發，人口的急速增加，使能源耗竭加速，
台灣土地狹小，各大都市人口密集，依據
台灣戶役政資料 2006 年五月底止，台灣總
人口共有 22,805,647 人，隨著人口密度的
增加，機車交通工具的使用率也提高，交
通部資料可知 2006 年 2 月底，全國的機車
總數量為 11，983，7570 輛。每平方公里
機車 330 輛，產生之廢氣相當驚人，不得
不重視。 
台灣電動機車的研發與推廣成為政府
積極投入的議題，目前電動機車是以電瓶
替代內燃機為動力源，然而電瓶的性是關
鍵議題，目前由於電動機車的行駛時速過
低、續航力低、爬坡角度太低、充電不方
便、車身較重及電池壽命短等問題、這些
問題造成電動機車之推廣成效，無法被大
眾所接受。 
目前燃料電池平台測試方法通常為固
定氫氣壓力及氫氣流量，改變負載電流，
燃料電池電壓隨之改變。但燃料電池機車
行駛時，負載電流會因行駛狀況而有所不
同，為了維持燃料電池基本輸出電壓，必
須改變氫氣壓力與氫氣流量來維持燃料電
池輸出功率，目前由昂貴之流量控制電磁
閥調整氫氣流量，影響增加整車系統開發
成本。本研究目的利用便宜之電磁閥控制
調整氫氣流量，因為燃料電池機車行駛
時，負載電流會因行駛狀況而有所不同，
依據氫電池電流所需氫氣量需求，給予適
當的量，減少多餘氫氣浪費，而依需求目
標設計控制器，達到控制所需的量。 
 
三、研究方法與內容 
 
3.1 研究方法架構 
     
本研究主要使用 Matlab/Simulink®分
析模擬軟體，建構燃料電池暫態特性、及
燃料電池機車之動態模型及輸入CNS標準
市區行車型態下之燃料電池機車之氫氣消
耗量，此消耗量是設計氫氣控制器之需求
流量，再利用廉價之電磁閥設計氫氣流量
控制器，控制系統架構，如圖 3.1 所示。利
用系統識別法建立電磁閥之數學模組，然
後利用 Try & Error 試誤法及實驗設計法則
找出最佳化之控制參數，最佳化控制器經
過 PWM Driver 產生 PWM 訊號，改變所
產 生 的 載 波 頻 率 與 工 作 循 環 (Duty 
Cycle)，利用不同流量之需求，改變電磁
閥工作循環(Duty Cycle)，來達到需求之命
令流量，利用系統識別法建立電磁閥數學
模組，然後建構氫氣控制器模擬測試環境。 
配合硬體迴路 (Hardware-in-the-Loop, 
HIL)模擬技術，利用模擬之環境建立最佳
化參數之控制器，然後將電腦模擬環境的
訊號，經由資料擷取卡由電壓方式傳送出
來，這當中會將模型轉譯成 ANSI C 程式
碼，再利用 Real Time Windows Target 與資
料擷取介面卡作資料的輸入與輸出的動
作。本研究針對燃料電動機車行車型態下
之氫氣需求量設計氫氣控制器，觀察電腦
模擬訊號與實驗訊號控制器相互比較，觀
察控制器的輸出數值誤差量與即時性。 
 
3.2 燃料電池氫氣消耗量模組建立 
 
依據單一電池的標準壓，以 Blome 與
Mugerwa 的修正 Nernst 所提出公式，其單
一燃料電池的標準電壓可表示成如下公式
(1)： 
( ) ( ) ( )[ ]
22
50
222 0 OHr
Pln.Pln
F
RTTT
F
S
F
GE ++−Δ+Δ=   ( 1 ) 
將標準的 Gibbs free energyΔG Entropy 
 4
中之『CNS 標準市區行車型態』，進行模
擬，行車型態包括加速、定速高速行駛
（50km/h）、定速低速行駛（20km/h）及
減速等測試項目，整個行車型態所需時間
為 112 秒，最高車速設為（50km/h），整
個行車型態，如圖 3.3 所示。 
0 10 20 30 40 50 60 70 80 90 100 110
0
10
20
30
40
50
60
CNS City Drive Cycle
Time (sec)
 D
riv
e 
S
pe
ed
 (k
m
/h
)
 
圖 3.3 機車 CNS 行車型態 
     
    輸入CNS標準市區行車型態燃料電池
機車之暫態響應，以預估輸出之機車 CVT
轉速及扭力、馬達電流及功率及轉速、燃
料電池電壓及電流變化，利用 CNS 標準市
區行車型態下之馬達消耗電流量對應燃料
電動機車行車型態下，燃料電池所需之氫
氣消耗量，建立相關評估，及行車型態下
燃料電池所需的氫氣消耗量，而設計氫氣
控制器，其建立之反向行車型態模組，如
圖 3.4 所示。 
 
圖 3.4 反向燃料電池機車模組 
 
3.4 建立氫氣燃料電動機車電能管理系統   
氫氣控制器硬體模擬之架構 
 
分析與設計控制系統首要的工作是對
我們所要研究的系統，依據它的特性、再
根據相關的定律，建立起系統的數學模
型，利用此數學模組來描述系統的動態特
性，建立線性系統模型最常用的二種方法
是轉移函數(Transfer Function)與動態方程
式(Dynamical Equation)法，本研究利用轉
移函數來建立系統之數學模組，系統之轉
移函數，則是利用系統識別法則(System 
Identification)來找出系統的轉移函數，由輸
入 與 輸 出 的 關 係 利 用 Matlab/System 
Identification Toolbox 可快速的找出系統轉
移函數，本研究的架構中利用系統識別來
求電磁閥動態系統之轉移函數，決定出系
統之轉移函數後，建構壓力電磁閥之模擬
模組。 
 
3.4.1 壓力電磁閥轉移函數之建立 
 
本實驗來代表電磁閥動態數學模型之
轉移函數為利用輸出誤差法(OE)，去求出
系統之轉移函數，如圖 3.5 所示。 
 
圖 3.5 System Identification ToolBox 
 
本研究之電磁閥動態數學模型之轉移
函數，利用輸出誤差法(OE)，去求出的轉
移函數，本研究代表電磁閥動態之轉移函
數是使用 OE221，只有 OE221 這種系統識
別方法，整體上識別出來之圖形比較和實
際測量之圖形一樣 
由於 OE221 系統識別法，不同 Duty 
Cycle%條件輸入下識別出來的轉移函數，
都會因為不同條件輸入下而有所不同，以
下為輸入不同條件下之轉移函數，分別為
10%~100% Duty Cycle 之轉移函數，10%轉
移函數，如(12)式所示，但 20%~30%及
40%~50%轉移函數共用，如(13)、(14)式所
示，50%~100%，如(15)式所示。 
10%求出之轉移函數為(12)式所示 
00701240040991
00862111438
2 e.e.s
es
+−
−+          (12) 
20%~30%求出之轉移函數為(13)式所示 
00701230040991
0085525338
2 e.e.s
e.s
+−
+          (13) 
40%~50%求出之轉移函數為(14)式所示 
 6
0 50 100 150 200 250 300
0 
10
20
30
40
50
60
Time(ms)
A
ir 
Fl
ow
 (l
/m
in
)
0 50 100 150 200 250 300
0
2
4
6
8
10
Time(ms)
S
ol
en
oi
d 
V
al
ve
 V
ol
ta
ge
 (V
) 60% Voltage-Output
Measured 60% Voltage-Air Flow Output
Simulated 60% Voltage-Air Flow Output
 
圖 3.10 60% Duty Cycle 未加控制器之 
流量圖 
 
0 50 100 150 200 250 300
0 
10
20
30
40
50
60
Time(ms)
A
ir 
Fl
ow
(l/
m
in
)
0 50 100 150 200 250 300
0
2
4
6
8
10
Time(ms)
S
ol
en
oi
d 
V
al
ve
 V
ol
ta
ge
(V
)
Measured 80% Voltage-Air Flow Output
Simulated 80% Voltage-Air Flow Output
80% Voltage- Output
 
圖 3.11 80% Duty Cycle 未加控制器之 
流量圖 
 
0 50 100 150 200 250 300
0
2
4
6
8
10
Time(ms)
S
ol
en
oi
d 
V
al
ve
 V
ol
ta
ge
(V
)
0 50 100 150 200 250 300
0 
10
20
30
40
50
60
Time(ms)
A
ir 
Fl
ow
 (l
/m
in
)
Measured 100% Voltage-Air Flow Output
Simulated 100% Voltage-Air Flow Output
 
圖 3.12 100% Duty Cycle 未加控制器之 
流量圖 
 
3.4.3 氫氣壓力電磁閥控制器之參數設定 
 
本研究使用 PI 控制器來控制空氣流
量，控制器最佳化之參數，利用試誤法及
ITAE 配合實驗設計法來驗證其參數最佳
化，如圖 3.13 所示，在氫氣流量控制系統
中，使用 PI 控制時，要找出其控制參數利
用 Try and Error 方法來試誤，且找出之參
數並不一定是最佳化之參數，本研究使用
Try and Error 所找出，控制器輸出之響應達
到要求的範圍附近之控制參數，為找出最
佳控制器之控制參數，利用實驗設計法來
搜尋，而可調整之參數為 Kp 及 Ki 兩個參
數，為分析兩參數對實際需求流量輸出之
影響，分別先測試當 Ki固定，調整 Kp 及將
Kp 固定調整 Ki等情況已分析參數之感度，
而 Try and Error 過程中，發現 Kd 值對系統
沒有太大幫助，故控制器之參數設計沒考
慮 Kd 值。 
 
圖 3.13 PI 控制器 ITAE 模型 
 
利用 10%~100%之需求空氣流量命令
需求，搜尋控制器最佳化之參數。再將搜
尋出之參數代入其他狀況作測試，並用絕
對誤差與時間乘積的積分準則作為參數調
校之依據來判斷其誤差之大小。 
利用實驗設計法，針對 PI 控制器之 Kp
與 Ki兩參數，做最佳化之搜尋，由三階層
設定 Kp 、Ki兩參數之範圍，依據 ITAE 來
尋找最佳化之參數。表 3.2 為實驗設計控制
器參數三階層分布，最佳化值計算之結
果，如表 3.3 所示。 
 
表 3.2 實驗設計控制器參數三階層分布 
三階層 Kp Ki 
-1 1 1 
0 10 10 
1 100 100 
 
表 3.3 PI 控制器參數最佳化計算之結果 
項目 Kp Ki 
最佳計算實驗值 37 37 
最佳化設計設定實驗 
最佳化值 50.5 25.75
     
    利用 STATISTIAC®軟體來計算出最
佳化之參數，而功效系數之設定為誤差愈
 8
池電壓及電流變化，機車馬達電流變化
下，所對應燃料電池之氫氣消耗情形，設
計氫氣控制器，在氫氣控制器模擬環境之
模組模擬，設計最佳化之氫氣控制器模擬
模組。 
    設計最佳化之氫氣控制器後，為了使
模擬之情形和實際控制情形能更趨近實際
狀況，利用四種測試輸入訊號來測試控制
器之輸出響應，再利用硬體迴路模擬技
術，將控制器與受控體在電腦模擬環境中
獨立出來，利用硬體迴路模擬技術，將電
腦運算的模擬訊號經由資料擷取卡以電壓
方式傳送訊號出來，此步驟可觀察受控制
物體與控制器的輸出訊號是否正確。 
    利用模擬和實驗之平均累計誤差值，
來觀察控制器之模擬和實驗之差異性，利
用模擬結合實驗比較，再使用模擬環境決
定最佳化控制器及配合硬體迴路測試技
術，利用模擬和實驗驗證比較控制器性
能，設計控制達到所需之氫氣流量必須符
合CNS標準市區行車行車型態下之氫氣消
耗量之需求氫氣量，此設計方法可加快控
制器快速成型。 
 
4.1 燃料電動機車動態模組之輸出響應 
 
    利用建構之燃料電動機車動態模型，
由輸入機車CNS標準市區行車型態燃料電
池機車之暫態響應，預估輸出之機車 CVT
轉速及扭力、馬達功率及電流及轉速、燃
料電池電壓及電流變化，機車馬達電流變
化下，所對應燃料電池之氫氣消耗情形，
如下圖 4.1~4.9 所示。 
0 10 20 30 40 50 60 70 80 90 100 110
0
10
20
30
40
50
60
CNS City Drive Cycle
Time (sec)
 D
riv
e 
S
pe
ed
 (k
m
/h
)
 
圖 4.1 機車 CNS 行車型態 
0  10 20 30 40 50 60 70 80 90 100 110
0
50
100
150
200
250
300
350
400
CNS City Drive Cycle 
Time (sec)
C
V
T 
S
pe
ed
 (r
ad
/s
)
 
圖 4.2 機車 CVT 輸出轉速曲線變化 
 
0  10 20 30 40 50 60 70 80 90 100 110
-4
-3
-2
-1
0
1
2
3
4
5
6
CNS City Drive Cycle
Time (sec)
C
V
T 
To
rq
ue
 (N
m
)
 
圖 4.3 機車 CVT 輸出扭力 
 
0  10 20 30 40 50 60 70 80 90 100 110
0
100
200
300
400
500
600
700
CNS City Drive Cycle
Time (sec)
M
ot
or
 P
ow
er
 (w
)
 
圖 4.4 機車馬達輸出功率曲線變化圖 
 
0  10 20 30 40 50 60 70 80 90 100 110
0 
1
2
3
4
5
6
7
8
9
10
11
12
13
14
CNS City Drive Cycle
Time (sec)
M
ot
or
 C
ur
re
nt
 (A
)
 
圖 4.5 機車馬達輸出電流曲線變化圖 
 10
0  10 20 30 40 50 60 70 80 90 100 110
0
0.01
0.02
0.03
0.04
0.05
0.06
0.07
0.08
0.09
0.1
CNS City Drive Cycle 
Time (sec)
 H
2 
C
on
su
m
pt
io
n 
(m
l/m
in
)
 
圖 4.10 CNS 行車型態之氫氣消耗量 
 
0  10 20 30 40 50 60 70 80 90 100 110
0
1
2
3
4
5
6
7
8
9
10
CNS City Drive Cycle 
Time (sec)
H
2 
C
on
su
m
pt
io
n 
(l/
m
in
)
 
圖 4.11 CNS 行車型態之氫氣 
消耗量(放大一百倍) 
 
4.3 燃料電池機車氫氣控制器之模擬及實       
   驗測試環境 
 
    將行車型態下之氫氣控制器之氫氣需
求，帶入最佳化參數之控制器，利用模擬
模組，如圖 4.12 所示，和硬體迴路測試模
組，如圖 4.13 所示，可以比較出模擬和實
際控制器之差異性，還有為何選用 PI 控制
器，而沒使用 PID 控制器，由圖 4.14 及圖
4.15 所示，很明顯 PI 空制器跟隨情形比較
符合實際需求之響應。利用本研究所建構
的硬體迴路模擬技術，配合軟體模擬測
試，減少實際實驗之開發時程，利用模擬
環境先決定控制器之參數，加速設計的氫
氣控制器快速成型，達到減少實驗之經費
輸出，達到降低設計控制器之低成本目的。 
 
圖 4.12 氫氣控制器模擬之模組 
 
圖 4.13 硬體迴路測試模組 
 
0 10 20 30 40 50 60 70 80 90 100 110
0
1
2
3
4
5
6
7
8
9
10
Time (sec)
D
riv
e 
C
yc
le
 H
2 
C
on
su
m
pt
io
n 
(l/
m
in
)
PI Controller
 
 
Command
Simulation
Experimental Data
 
圖 4.14 氫氣消耗量輸入 PI 控制器之 
模擬與實驗響應輸出圖 
 
0  10 20 30 40 50 60 70 80 90 100 110
0 
4
8
12
16
20
24
28
32
36
40
Time (sec)
D
riv
e 
C
yc
le
 H
2 
C
on
su
m
pt
io
n 
(l/
m
in
)
PID Controller
 
 
Command
Simulation
Experimental Data
 
圖 4.15 氫氣消耗量輸入 PID 控制器 
之模擬與實驗響應輸出圖 
 
    由上圖 4.14、4.15 PI 及 PID 控制器在
模擬和實驗比較圖中，可以清楚觀察比較
出 PI 控制器，不管在模擬和實驗平台的流
量都比較符合實際需求之流量，而 PID 控
制器，不管模擬或實驗平台，都會有不穩
定震盪之情形產生。 
 12
3. 本研究針對燃料電動機車行車型態下之
氫氣需求量設計氫氣控制器，觀察電腦模
擬訊號與實驗模擬訊號相互比較，觀察控
制器的輸出數值誤差量與即時性。 
4. 本研究針對氫氣流量控制器，使用 PI 及
PID 作為氫氣流量控制器，利用控制器實
驗結果與電腦模擬相互比較，此二種控制
器之差異性，PI 控制器不管在模擬或實
驗都有較好之輸出響應，而 PID 控制器
的輸出響應比較差，但平均累計誤差量來
看，模擬和實驗之 PI 控制器還是比 PID
控制器好。 
5. 本研究設計之氫氣 PI 控制器，平均相對
誤 差 值 都 在 5% 左 右 ， 最 大 值 為
3.6475%，低於一般的工程應用中之 5%
的容許誤差。 
6. 利用模擬和硬體迴路測試與電腦模擬，利
用先建立氫氣控制器模擬之環境，在配合
模擬和實驗環境測試比較，可加快氫氣控
制器實體的快速成型。 
 
六、計畫成果自評 
本研究利用 Matlab/Simulink®模擬軟
體，建構燃料電池機車動態模型，所建構
之動態模組包含燃料電池模組、無段變速
器模組、最終傳動模組、輪胎模組等控制
元件，藉由輸入機車 CNS 標準市區行車型
態，機車馬達所需之電流變化下，所對應
燃料電池之氫氣消耗情形，並設計氫氣控
制器，在氫氣控制器模擬環境之模組模
擬，設計最佳化之氫氣控制器。 
    本研究配合硬體迴路模擬技術，將燃
料電動機車在CNS標準市區行車型態下之
氫氣消耗量，作為氫氣控制器之命令需求
之流量。本研究貢獻在於未來發展燃料電
池機車整體架構提供一套完整的模擬程
式，並可利用本研究所建構的氫氣控制器
之硬體迴路模擬技術，將所設計的氫氣控
制器快速成型，達到控制目的。 
    實驗過程中利用空氣來替代氫氣，減
少實驗之危險性，並配合建立之模擬環境
下模擬最佳化之控制情形下，再利用硬體
迴路架構平台控制實體之電磁閥，測試是
否控制能達到控制器之需求，實驗過程
中，諸多參數設計影響，使工程師需浪費
試誤時間，利用模擬環境找出最佳化控制
器，再結合硬體迴路測試，驗證模擬和實
驗之差距，利用本研究之模擬和實驗配
合，可加速氫氣控制器實體的快速成型，
減少工程師設計之試誤時程。 
 
七、參考文獻 
 
[1] 黃鎮江，“燃料電池，＂全華科技圖
書股份有限公司，民國九十二年。 
[2] 陳亮光、陳穎平，“質子交換膜燃料
電池系統之模型與分析，＂國立台灣
科技大學機械工程系碩士論文，民國
九十三年。 
[3] 張一屏，“串聯式燃料電池機車動態
模擬與分析，＂ 2003燃料電池研討
會，民國九十二年。 
[4] 蔡武田，“質子交換膜燃料電池之非
線性電路分析與控制，＂國立中興大
學電機工程系碩士論文，民國九十三
年。 
[5] 林博煦，“燃料電池電動機車即時模
擬與控制，＂國立清華大學動力機械
工程學系碩士論文，民國九十一年。 
[6] 黃仁智、勒方奇，“燃料電池應用於
氣渦輪機之汽電共生系統評估，＂國
立中山大學機械工程系碩士論文，民
國八十八年。 
[7] 王璽鈞、林修正，“燃料電池:新世紀
能源，＂滄海書局，民國九十三年。 
[8] 章文堯，“混合動力車輛反向性能模
擬與分析，＂大葉大學車輛工程系碩
士論文，民國九十四年。 
[9] 黃鎮江，“燃料電池，＂全華科技圖
書股份有限公司，民國九十二年。 
[10] 徐德強，“不同流道設計對燃料電池
陽極面氫氣消耗量的影響，＂國立中
央大學機械工程碩士論文，民國九十
五年。 
[11] K. S. Kwi and B. S. Oh, “Fuel Economy 
and Life-Cycle Cost Analysis of a Fuel 
Cell Hybrid Vehicle,” Journal of Power 
Sources 105, pp.58-65, 2002. 
[12] 左峻德，“燃料電池電動機車使用環
境與法規標準研究計畫，＂期末報告
初稿，民國九十年。 
[13] 李耿昌，“燃料電池車輛現況及發
展，＂ARTC車輛測試中心測試二課，
