摘要 
隨著科技不斷的進步，電子產品不斷推
陳出新，人們對科技產品依賴度越來越高，
已成為我們日常生活中不可或缺的一部分，
目前大部分產品，主要以短小輕薄為訴求以
及功能多樣化，深受消費者喜愛，但伴隨著
功能的增加，已經使得消費性電子產品內部
的微控制器，無法儲存更多的程式碼，造成
必須額外增加外部記憶體 IC，且因種類之繁
多，價格隨著容量大小而增加，使產品開發
公司必須額外增加成本，相對產品售價提
高，對消費者及公司都無益處，更多針對程
式碼壓縮的方法陸續被提出，並實用在不同
CPU 上。 
本計畫以FPGA的方式分別實現 6502微
控制器以及解碼電路設計，因大多數程式碼
壓縮的方法，都是以資料壓縮的方式來實際
應用在程式碼壓縮，以至於壓縮後的指令長
度跟原來不一樣，必須要有 LAT(Line Address 
Table)電路來把原來指令位址轉換成壓縮後
指令的位址，最後與 6502、解碼電路整合，
完成具有程式碼壓縮之 6502 微控制器。 
 
關鍵字：6502、LAT、程式碼壓縮 
一、 前言 
隨著科技不斷的進步，電子產品不斷的
推陳出新，連帶功能也越來越強大，甚至以
短小輕薄為目標，吸引消費者去購買，不論
手機、PDA、資訊家電、玩具等消費性電子
等電子產品，已經伴隨在我們日常生活中，
科技的發展讓人們對電子產品依賴度越來越
高，消費者對產品的功能及方便性，決定是
否購買主要考量之一，但往往價格偏高，而
使消費者卻步，其主要原因是因為功能變
多，記憶體所能儲存的空間不足，必須額外
增加微控制器外部記憶，為了讓記憶體能夠
儲存更多的程式碼，因此具有壓縮功能的微
控制器是必要的。 
二、 研究目的 
微控制器一直以來都是消費性電子產品
最重要的核心之一，負責控制整個系統的運
作以及周邊裝置的溝通，隨著科技的進步，
電子產品不斷推陳出新，所能控制周邊數目
與功能的強化，因記憶體空間不足而被受
限，而記憶體空間大小將決定所需的成本以
及能夠控制多少周邊，未來記憶體在一顆晶
片上所佔用的面積會超過 CPU 以及其他不
同功能的電路，例如：看門狗(Watch Dog)、
數位/類比轉換(A/D Converter)、脈波寬度調
變(PWM)等功能，使得微控制器所要控制的
裝置變多，所需要的程式碼相對增加，為了
解決這樣的問題，透過以資料壓縮的方法應
用在微控制器上，在設計上也必須考慮到成
本與耗電，才符合消費性電子產品的目的。 
指令壓縮常用於 MIPS、ARM、8086、
PowerPC 等指令集，因記憶體容量低，所以
幾乎所有控制器都要外接記憶體，而目前很
少人對 6502 微控制器做壓縮，因 6502 沒有
授權的問題，且目前還有笙泉、凌陽、
Realtek、Holtek 等公司在使用，因此以 6502
為核心對其程式碼壓縮，進而避免外接記憶
體。 
三、 文獻探討 
指令壓縮主要減少記憶體空間的使用，
以至於可以存放更多的指令或減少記憶體空
間上的成本，而資料壓縮是減少資料儲存空
間與資料傳輸量的一種方式，以更短的編碼
長度取代原始編碼，剛好與指令壓縮目的一
樣，所以利用資料壓縮上所使用的一些演算
法應用在指令壓縮。 
相對定址(Relative) $aa 
隱含定址(Implied)  
累加器定址(Accumulator) A 
(3) 程式碼壓縮 
指令在壓縮後，造成指令長度的改變使
得下一個位元組(運算碼、運算元)必須填滿壓
縮後剩下的空間，使得原來指令的位址也受
影響，必須要透過 LAT（Line Address Table）
來計算壓縮後的指令位址，找出指令位址
後，Decompression Unit 會把原來壓縮的指令
解碼，其解碼電路內部架構如圖 3 所示，Shift
區塊讀取記憶體內壓縮的指令，根據指令的
編碼長度，產生編碼的運算碼、運算元以及
沒經過編碼的指令；Dictionary 區塊將編碼的
指令還原；Control 區塊負責控制 Dictionary
三條路徑輸出的多工器。而在 6502 和
Decompression Unit 之間加入 Cache，是為了
減少每次解碼的時間，因為要找出原來指令
的位址必須把整個 Instruction Block 解碼
後，才能知道指令在哪一個位置，因此 6502
必須等到全部解碼後才能讀到指令，在解碼
過程中，6502 都是處於閒置狀態，只要資料
在 Cache 之中，就不必使 6502 閒置過久，整
個系統架構如圖 2 所示。 
6502
Instruction
 Cache
Instruction 
Decompression 
Unit
LAT
Memory
 
圖 2  System overview 
Dictionary
Control
Shift
CacheMemory
 
圖 3  Decompression Unit 
五、 結果與討論 
為了完成具有壓縮功能的 6502，在架構
上花了很多時間，並參考相關資料以及不同
CPU 設計方法，因部分參考資料有些許的不
同，為了避免 6502 在執行上的錯誤，必須謹
慎處理，在 6502 與解碼電路以及 LAT 整合
上也須注意時序的問題，在設計上並未包含
A/D Converter、SPI 等功能，因市面上核心一
樣的微控制器，應用在不同電子產品，功能
上也會有些許不同，但不影響所設計的架
構，因所使用的指令都一樣，且方便為不同
電子產品增加不同功能，因此在電路上只有
具有壓縮功能的 6502。未來方向將是強化
6502指令集或提升解碼速度與提出更有效的
壓縮方法，減少程式碼在記憶體所占用的空
間，有些壓縮演算法要以硬體實現是很困難
的且複雜度高，尤其在硬體上多增加了解碼
電路，若能在兩者間取得平衡，讓廠商不需
要額外的成本，使得產品能夠實現更多的功
能，是未來努力的目標。 
模擬結果如圖 4 所示，CPU 重置時，會
到記憶體重置向量(FFFC、FFFD)取出程式初
始位址，然後再開始擷取指令並執行指令的
動作，指令擷取與資料寫入記憶體都符合預
期結果。 
 
圖 4  6502 模擬結果 
解碼後部分模擬結果如圖 5 所示，指令
LDA #$01 的運算碼為 A9(編碼 000)、運算元
01(編碼 000)，因 Block 第一個指令為 OP，
且 兩 個 都 有 編 碼 ， 因 此 壓 縮 的 值 為
22(0010,0010,00)，剩餘 2-bit 與下一個指令合
併，其中 Compression 為壓縮後的程式碼。 
國科會補助計畫衍生研發成果推廣資料表
日期 2010年08月10日
國科會補助計畫
研發成果名稱
發明人
(創作人)
技術說明
技術移轉可行性及
預期效益
技術/產品應用範圍
產業別
計畫名稱:
計畫主持人:
計畫編號: 學門領域:
(中文)
(英文)
成果歸屬機構
(中文)
(英文)
具程式碼壓縮功能之6502 微控制器設計
王立洋
98 -2622-E -218 -010 -CC3 積體電路及系統設計
具程式碼壓縮功能之6502 微控制器設計
南臺科技大學 王立洋,田政生
隨著科技不斷的進步，伴隨在我們日常生活之中的消費性電子產品，也是千變
萬化，功能不
斷推陳出新。 消費者對新產品、新功能、新式樣的追求，成為市場發展最主要
的驅動力量。 幾
乎所有消費性電子產品都有一顆或一顆以上之微控制器(MCU)，負責控制整系統
的運作以及與周
邊裝置的溝通。 事實上，由於消費性電子的應用市場非常之廣泛， 應用到之
MCU 種類繁多，不
像PC 主要以Intel 的處理器為主，在消費性市場並無任何一家的MCU 可以主宰
市場，尤其是屬
於中低階的八位元微控制器應用市場。
6502 是目前廣泛被使用之一顆8 位元MCU， 它的歷史悠久， 第一顆6502 出現
至今已超過
三十年。 第一台暢銷的個人電腦Apple II 採用的CPU 正是6502。 雖然時至今
日有許多許多功Most of the consumer electronic devices involve one or more than one
micro controller units (MCU), which make sure that the devices act as
it planned to be. Unlike the mature PC market, which is denominated
by Intel, there is not any particular MCU which can dominate the
consumer electronic market. This is especially true for 8 bit MCU
application market.
6502 has been used for more than 30 years; it was adopted in the
first popular personal computer, APPLE II. Because of cheaper
royalty, many local companies design and produce their own 6502
devices. 6502 still plays an important role in both ASIC and embedded
system design.
The purpose of this project is to develop an efficient instruction
code compression algorithm, which not only can provide a high其他專業、科學及技術服務業
具指令解壓縮電路之6502 IP/ 消費性電子產品
可以IP授權
註：本項研發成果若尚未申請專利，請勿揭露可申請專利之主要內容。
