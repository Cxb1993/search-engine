應用逆向工程法建構 3D/VR 仿真雙足機器人之動作行為 
Behaviour Construction of 3D/VR Mimetic Biped Robot using Inverse 
Engineering Method 
 
黃榮興 吳曜廷 張靖毅 林宜靜 
逢甲大學自動控制工程研究所 
台中市西屯區文華路 100 號 
E-mail: tshwang@fcu.edu.tw
 
中文摘要 
    本研究計畫之目的在於研製一套即時視訊人型特徵點辨認處理系統以及三維人臉辨識系統平台。
其中為了方便擷取全身的姿態，我們在全身的關節處貼上易於辨識之特徵點，利用影像處理將特徵點
擷取出來，透過所擷取出來的二維特徵座標轉換到三維座標，然後針對特徵點做多目標的追蹤，以此
辨識與估測人身之動作行為，再由其動作行為求得各關節的位置座標，以此座標位置驅動 3D/VR 以便
分析驗證所估測之動作行為，以完成伸展台真人與 3D/VR 仿真之基本台步即時同步展示。 
    在三維人臉辨識方面主要利用一台攝影機分別擷取正面以及側面的輸入影像，再以影像處理方式
擷取正面及側面臉部之特徵點，藉由通用三維網格模型的特徵頂點嵌入所擷取的特徵點，以完成三維
人臉模型之建立。接著將三維人臉模型分別左右旋轉至所需角度，使之產生多張二維影像，進而存入
訓練影像資料庫中，然後在人臉訓練階段採用主成分分析之特徵臉演算法，進而獲得一組加權向量作
為人臉訓練之資料。而在人臉辨識階段，則將輸入之測試影像所獲得的測試加權向量與訓練加權向量，
透過距離量測以最近鄰方式找出兩者距離最為接近者作為辨識之人臉。本研究主要採用三維人臉模型
旋轉多個角度，因此亦可增加訓練樣本數，而改善對於測試影像的臉部角度變化之辨識容忍度，同時
能估測測試者之臉部旋轉角度，進而適合應用於門禁管制或是命格推論等系統。 
 
關鍵詞: 特徵點擷取、影像追蹤、3D/VR、網格模型、主成分分析、特徵臉、三維人臉辨識 
Abstract 
The purpose of this paper is to implement a real-time vision processing platform for hunman feature 
recognition. In order to detect the posture of whole body conveniently , we post feature points on all joints of 
whole body for recognition easily . The feature points are abstracted and recognized by using image 
processing method , then to estimate human behavior . In the meanwhile , We use the corresponding position 
coordinates to drive the 3D/VR for analysis and validation of estimated behavior. We can drive the 3D/VR 
model to walk and complete 3D/VR imitative walk on runway in real-time synchronous demonstration . 
 
Keyword：Feature Detect、Image Tracking、3D/VR 
 
              (3.4) 
    其中 ，而 k 為透鏡失真係數，一般來說
良好製程與品質的 CCD 其 k 幾乎很微小，甚至在校正過程
中可以忽略成零。                          
3.1 攝影機座標系統 
    攝影機座標與像素座標 之間的映射關係如下： ( ,u v )
 
     (3.5) 
其中  
    、 為單位長度的像素數，而 、 為攝影機
座標的主軸（principle point）如圖 3 所示，C為上三角矩
陣，由於 、 、 、 只與鏡頭內部結構有關，故C又
稱之為內部參數矩陣（intrinsic matrix），透過攝影機內部
參數矩陣即可由攝影機座標 推得像素座標
。 
L e n sC C D
d 2
d 1
f
h 2h 1
C a l ib r a t io n  ta r g e t
Z c
X c
O c
Y c
ba
圖 3 預定
攝影機主軸點 
3.2 世界座標系統 
    攝影機座標系統與世界座標系統之間的關係是經由轉
動與移動而得，其轉換關係為： 
    (3.6) 
    其中 R 代表轉動，T 代表移動，而兩者之間的關係式
又稱之為外部矩陣（extrinsic matrix），結合攝影機內部矩
陣，即可求出世界座標與像素座標之間的轉換矩陣： 
 
         (3.7) 
    由此可以定義出3 的投影矩陣 K，4×
。 
四、步行運動之 3D/VR 系統設計 
4.1 虛擬三維場景及骨架建立 
三維場景我主要是選擇 OpenGL 來架設我的場景，以
及人體模型建立，OPENGL 中很容易實現模型的各種變
換、著色、光照、紋理、交交互操作和動畫 ,但是它只提
供基本幾何元素的造型函數,使得複雜模型的建模相對困
難。而我的 3D 模型主要是從 Poser 這個軟體，所匯出的骨
架模型，轉為.3DS的檔案，然後再透過OpenGL去讀取.3DS
格式的檔案，在 OPENGL 中實現對其控制和變換等操作。 
(a) OpenGL 三維場景建立 
    我們將 3DS 的圖檔準備好後如下圖所示，我在 3D 
MAX 環境中建好我的模型在匯出我所要的檔案，要將我們
的模型讀入之前首先要先將我們的 OpenGL 場景架設好，
所以三維圖形及動畫場景的顯示，首先我們把人體上的座
標轉換到世界座標，之後再透過轉換到 OpenGL 上的座
標，經過計算機的複雜處理，最終在計算機二維螢幕上顯
示的過程，下圖為我用 3D MAX 所繪製的簡易圖形。 
 
圖 4 在 3D MAX 下的人體模型 
(b)三維骨架建立 
當擷取到特徵點的位置座標後，我們根據特徵點的標
號，依照順序將我們骨架元件讀入我們的 OpenGL 的視窗
畫面，由於 OpenGL 之中並沒有直接讀取 3ds 檔案的功能，
因此我們要先自己理解 3ds 檔案的內部架構後，再把 3ds
檔轉換成 OpenGL 可以讀取的型態。而 3DS 是一種三維模
型的資料檔案交換格式，含有紋理和光照資訊。3DS 檔是
由許多 chunk(區塊)組成的，一個區塊的組成是由區塊資訊
和區塊數據結構組成，區塊資訊又由區塊的 ID 和區塊的
長度組成。我們在讀入時，可以根據自己的需要選擇性地
讀入自己需要的區塊，而忽略掉那些不感興趣或未知的區
塊。在讀入這區塊塊結構的檔時，完全可以用遞迴的方法
實現。該程式流程圖如圖 5 所示。 
         
          (4.1) 
(2)區域內1階矩  
            
         (4.2) 
(3)Mass Center為： 
10 01
00 00
,c c
M Mx   y
M M
= =            (4.3) 
(c) .CamShift 演算法 
在我們設定整個圖像為我們的搜尋區域，然後選擇
MeanShift 的初始的搜尋示窗的大小與位置，計算搜尋視窗
裡的色彩概率分佈圖，然後再運用 MeanShift 得到新的搜
尋視窗，這時候我們儲存我們 t 時間的位置座標，在移動
到下一幅位置時我們以新的搜尋視窗來當作我們的初始搜
尋視窗重複之前的動作，在得到下一個 t+1 時的位置，做
動態的追蹤。如圖 10 所示就是我們透過顏色直方圖，利用
CamShift 來追蹤我們的特定顏色物體。 
 
圖 10 單個物體追蹤情形 
五、三維人臉之辨識系統設計 
5.1 Candide-3 網格模型的建立 
Candide-3 網格模型的格式包含頂點、面、FAP、FDP
等資料，其中 FAP 主要用於人臉追蹤，而 FDP 則是用於
定義人臉的靜態特徵，至於頂點、面則可以透過 OpenGL
的 glVertexPointer 座標陣列顯示函式可以快速地顯示出
Candide-3 模型。 
(a)頂點與面之關係 
Candide-3 是由頂點(Vertex)與面(Faces)所組成，該模
型利用三個頂點形成一個面，因此面又稱為三角形
(Triangles)，透過頂點的移動可以改變三角形的形狀，進而
改變模型的各項特徵，例如，眼睛的形狀、大小等，將隨
著頂點的移動而改變，如圖 11 所示。 
 
(a) 
 
(b) 
圖 11 (a) Candide-3 模型(b)眼睛部份頂點改變時，眼睛特徵
變化的情形 
 
(b) 靜態人臉定義參數(FDP) 
MPEG-4 定義了用於描述特定臉形的人臉定義參數
(Facial Definition Parameter, FDP)以及臉部活動的人臉動
畫參數(Facial Animation Parameter, FAP)，而對於其他網
格、紋理、人臉動畫定義表等內容沒有具體限定。FDP 是
一種靜態參數，用來定義一個特定人臉模型，在 MPEG-4
標準中，定義 FDP 的 84 個人臉特徵點，如圖 12 所示。 
 
圖 12 MPEG-4 FDP 特徵點[1] 
 
    Candide-3 模型則是遵循 MPEG-4 的標準進行改版，對
於臉部的 14 個定義參數如表 2 所示。 
 
表 2 Candide-3 模型定義的 14 項 FDP 
         
 
圖 14 正面和側面影像的特徵點對應關係[14] 
 
    所擷取的特徵點將對應至 Candide 網格模型之特徵頂
點，如圖 15 所示。 
 
圖 15 Candide 網格模型之特徵頂點 
 
表 3 網格模型之特徵頂點對應表 
 
 
(a)臉部特徵之擷取 
    正面影像的自動特徵點擷取是採用二維影像處理以膚
色分割、形態學運算、影像增強等方法找出眼睛、嘴巴區
塊，接著找尋區塊外形的端點作為特徵點，最後由橢圓參
數找出其餘的臉部輪廓特徵點，擷取步驟如下所示： 
(1) 利用膚色分割與橢圓參數定位出人臉位置並
轉換成二值化影像 
 
圖 16 人臉區域定位 
(2) 針對膚色區域以形態學的侵蝕與膨脹運算，
使得眼睛、嘴巴的輪廓最大化 
 
圖 17 經侵蝕與膨脹運算的結果 
 
(3) 找出非膚色區域與膚色區域相比較後得出可
能的眼睛、嘴巴的區塊 
 
圖 18 臉部候選區塊 
 
(4) 透過眼睛判斷式得到眼睛區塊 
其判斷式如下： 
A. 左右眼之間距 
0.3 0.9x× < <臉寬 兩區塊的 軸間距 臉寬 ×  
                             (5.7) 
B. 左右眼區塊面積比  
   0.3 1.5 < <右眼區塊的像素左眼區塊的像素     (5.8) 
C. 左右眼之對稱性    
   -1tan  30oy
x
兩區塊 軸間距( )兩區塊 軸間距  <     (5.9)
 
 
圖 19 經眼睛區塊判斷式之結果 
(5) 透過嘴唇判斷式得到嘴唇區塊 
其判斷式如下： 
A. 兩眼至嘴唇之距離比     
         0.75 1.251
2
D
D
< <
     (5.10)
 
B. 兩眼之間與兩眼至嘴唇之距離比 
         
1 2
21 1.5
3
D D
D
+
< <
   (5.11)
 
 
         
 
(b) 網格模型的三維特徵頂點 
圖 24 特徵點嵌入特徵頂點之結果 
 
5.4 紋理貼圖 
當取得嵌入二維特徵點的三維網格模型後，所呈現的
只是模型的框架，此時基本上很難由線框模型辨識出不同
樣貌的人，因此藉由 OpenGL 的紋理貼圖(Texture Mapping)
功能，我們可以將網格模型的特徵頂點座標轉換成紋理貼
圖座標，以便使網格模型顯現出人臉的實際樣貌，才能為
後續的人臉辨識階段所用。 
 
圖 25 人臉的紋理貼圖結果 
5.5 人臉辨識 
    本研究是採用統計特徵擷取的方式，以主成分分析法
(Principle Component Analysis, PCA) 為基礎的特徵臉
(Eigenface)作為人臉辨識，以下將針對這些方法作說明。 
(a) 主成分分析 
影像的維度通常非常高，必須經過維度的降低才能順
利由軟體加以處理，降低維度的用意是以最少的資料量來
描述影像，此步驟稱為特徵擷取。常用的方法有主成分分
析，又稱為 Larhunen-Loeve 轉換，其目的是將 維空間資
料作降維，使得投影後的資料點能盡量散開，使原本資料
保有在 維空間分佈的特性，以便於進行分類或分群。 
k
k
對於d 維度的輸入向量 X 若具有平均向量(Mean 
Vector) 與共變異矩陣(Covariance matrix)m xC ，則 
 
1[ ,..., ] , 1,...,kX x x k M= =       (5.13) 
1
1[ ]
M
k
k
m E X x
M =
= = ∑
           (5.14)
 
( )( )[ ]Tx k kC E x m x m= − −       (5.15) 
若向量 X 的元素 ix 與 jx 無相關(uncorrelated)，則共
變異矩陣 xC 的變異為 0，如 0ij jiσ σ= = ，則共變異矩
陣為 
1
1 ( )( )
M
T
x k k
k
C x m x
M =
= − −∑ m
    (5.16)
 
藉由共變異矩陣可以獲得其特徵向量(Eigenvector) Q
與特徵值(Eigenvalue)λ ，如 
xC Q Qλ=                   (5.17) 
對於投影向量 Y 存在一個正交轉換 (Orthogonal 
transform) 
TY Q X=                     (5.18) 
其元素 ，由於 componentTi iy Q x= i iy 可看作是向量
X 的特徵，而各特徵互相無關(uncorrelated)，因此投影
向量Y 的 Covariance Matrix yC 是對角矩陣(diagonal) 
1
2
3
0 0 0 0
0 0 0
0 0 0 0
0 0 0
T
y
M
C Q XQ
λ
λ
λ
0
λ
⎡ ⎤⎢ ⎥⎢ ⎥⎢ ⎥= = ⎢ ⎥⎢ ⎥⎢ ⎥⎣ ⎦
M M M O M
L  (5.19)
 
向量 X 的最小平方差(Mean Square Error)可表示 
2
1
( )
n
i
i m
mε λ
= +
∑
                 (5.20)
 
 
近似之後為 
1
m
i i
i
X y q
=
′ =∑
                 (5.21)
 
可獲得誤差向量  e
e X X ′= −                   (5.22) 
而最小平方差(Mean Square Error)為 
2( )i i
i
e X X x x ′′= − = −∑
  (5.23) 
主成分分析其目的是將高維度空間的資料投影到低維
度空間，並找出最佳的投影方式，使得投影後的資料點能
盡量散開，以保有原資料在高維度空間分佈的特性，便於
進行其後的分類或分群。 
 
六、實驗結果與分析 
6.1 三維人體姿態動作模擬 
(a) 實驗環境建立 
為了不要受太多的複雜背景影響，所以我們以白色背
景為主，以方便做實驗，背景建置如下圖所示： 
 
         
頭
部 
HEAD.3DS 
 
身
體
軀
幹 
BODY.3DS 
 
右
臂 
RSHOULDER.3DS 
 
左
臂 
LSHOULDER.3DS 
 
右
小
臂 
RELBOW.3DS 
 
左
小
臂 
LELBOW.3DS 
 
右
大
腿 
RTHING.3DS 
 
左
大
腿 
LTHING.3DS 
 
右
小
腿 
RFEET.3DS 
 
左
小
腿 
LFEET.3DS 
 
 
 
圖 32 貼上特徵圖的 Model 
 
圖 33 三維骨架之模擬結果 
6.2 三維人臉建立與辨識 
    在軟體架構上是以 Borland C++ Builder (BCB) 所設
計，其操作介面如圖 4.2 所示，主要包含人臉擷取模式、
人臉註冊模式、門禁管制、二維影像顯示區域、三維模型
顯示區域、三維模型特徵頂點控制、三維模型位移控制、
特徵點擷取模式、三維模型顯示模式。 
 
圖 34 人臉辨識系統之主畫面 
(a)人臉擷取模式 
    人臉擷取模式是透過攝影機擷取人臉影像，進入此模
式後會出現攝影機控制視窗，如圖 35 所示，可以由單台攝
影機分別以 Capturing 按鈕擷取人臉正面與側面影像或是
透過雙台攝影機以 Sync. Capturing 同步時擷取。所擷取的
影像透過Export按鈕分別匯出至二維顯示區域的正面影像
顯示區域以及側面影像顯示區域。 
 
圖 35 人臉擷取模式之介面 
 
(b)特徵點擷取模式 
         
 
圖 41 未通過人臉辨識 
    綠燈表示人臉已經在人臉訓練資料庫裡並通過人臉辨
識，Door Status 顯示出測試者人名以及其人臉角度，例如
已建立訓練影像的測試人臉名為 Ivan，其臉部角度為 0
度，則辨識之後的結果在 Member 的欄位顯示 Ivan，而 Face 
Degree 欄位則是顯示測試者估測的人臉角度為 3 度，但實
際的人臉角度為 0 度，誤差為 3 度左右，如圖 42 所示。 
 
圖 42 通過人臉辨識 
 
    另一個例子測試者同樣是 Ivan，但實際人臉角度分別
為 15 度如圖 43 以及人臉角度為-5 度如圖 44。 
 
圖 43 測試者人名：Ivan，實際人臉角度：15 度，測試人
臉角度：19 度 
 
圖 44 測試者人名：Ivan，實際人臉角  度：-5 度，測試
人臉角度：-7 度 
七、結論與未來展望 
    本研究在三維人體姿態動作模擬部分主要利用
CamShift 演算法來追蹤人體特徵點，以進行追蹤定位工
作，且將所得到之座標位置儲存起來以及執行特徵點之座
標辨識，透過這些資訊來進行 OpenGL 3D/VR 環境進行人
體模型之建立，以及讓 3D/VR 裡的人體模型模仿我們攝影
機所拍攝到人的動作與姿態，來完成即時視訊人型特徵點
辨認系統處理平台。在應用方面，我們已完成模擬人體動
作後可以對該動作加以分析，這將可運用在互動式遊戲等
領域，並可透過我們所算出來的座標和角度，來計算馬達
該轉多少角度以驅動人形機器人之動作，如 KHR-1…等人
形機器人，而使機器人模仿與學習人類的動作行為。 
    而在三維人臉建立與辨識方面，該系統已經完成二維
人臉特徵點擷取、三維網格模型特徵頂點嵌入以及人臉多
角度的辨識與估測。但此系統仍有可改善的空間，如三維
網格模型方面，對於人臉較為精細的輪廓如鼻子、臉頰等
臉部特徵，由於 Candide 三維模型提供的頂點與面較少，
使得以模型近似的臉部特徵與實際的臉部特徵尚有落差，
因此當三維模型旋轉某個角度後有時會造成臉部失真，影
響後續的人臉辨識工作，未來可以利用較為複雜的三維模
型改善模型的擬真度。 
參考文獻 
[1] J.O’Rourke, N.I.Badler. Model -based image analysis of 
human motion using constraint propagation. IEEE Trans. 
Pattern Anal. Mach. Intell., November 1980,2(6):522-536  
 
[2] D.Hogg. Aprogram to see a walking person. Image Vision 
Computing, 1983, 5(20):87-96 
 
[3] K.Rohr. Incremental recognition of pedestrians from 
image sequences. In: Proc. IEEE Cpmput. Soc. Conf. Comput. 
Vision and Pattern  Recogn. New York City: June 1993.8-13 
 
[4] Z.chen, H.J.Lee. Knowledge-guided visual perception of 
3D human gait from a single image sequence. IEEE Trans. On 
System, Man, and Cybernetics, 1992, 22(2):336-342 
 
[5] A. G. Bharatkumar, K.E. Daigle, M.G. Pandy, Q.Cai, J.K. 
Aggarawal. Low limb    
         
出席新加坡2010 IEEE 機器人、自動化與機電整合國際研討會之心得報告 
Report of IEEE International Conference on Robotics, Automation and Mechatronics (RAM 2010) 
 June 28-30, 2010, Grand Copthorne Waterfront Hotel, Singapore, http://www.cis-ram.org/2010/ 
逢甲大學 自動控制工程學系 黃榮興 7/7/2010 
    
此次 2010 IEEE 機器人、自動化與機電整合國際研討會是由 IEEE Systems, Man & Cybernetics 
(SMC) Singapore Chapter, IEEE Robotics & Automation (R&A) Singapore Chapter 幾個團體機構所贊
助，Centre for Intelligent Control, National University of Singapore, Singapore, Centre for Intelligent 
Machines, Nanyang Technological University, Singapore 以及 Mechatronics Group SIMTech, Singapore 等
學校所舉辦。研討會之會場選在新加坡 Grand Copthorne Waterfront Hotel, Singapore。此次研討會接
受之論文大約 150 篇，錄取率相當低，這些論文分別在三天內(June 28-30)發表，場面相當壯觀。此
次所發表之論文都會收錄於 IEEE Xplore 以及 Engineering Village EI Compendex database。此次本團
隊共發表三篇論文，參加學生計有一個博士班學生與四個碩士班學生，由我帶隊浩浩蕩蕩於 6/27 搭
華航班機出發，於 7/1 順利完成任務返國。 
 
此次共發表三篇論文，發表之場次如下: 
1. Session: MB4-Dynamics and Motion Control 
Date:   Monday, 28 June 2010 
Time:   13:30 – 15:30 
Chairs:  Pauline Hamon and Boyang Hu 
Venue:  Room 4 
 
ZPETC Path-Tracking Gain-Scheduling Design and Real-Time 
Multi-Task Flight Simulation for the Automatic Transition of 
Tilt-Rotor Aircraft 
 
1Chih-Cheng Peng, 2Thong-Shing Hwang, 2Shiaw-Wu Chen, 
2Ching-Yi Chang, 2Yi-Ciao Lin, 2Yao-Ting Wu, 2Yi-Jing Lin, 2Wei-Ren Lai 
1 Ph.D. Program in the Graduate Institute of Electrical and Communications Engineering, Feng Chia University 
Taiwan, R.O.C. , *E-mail: peter.peng@atechsystem.com.tw
2Department of Automatic Control Engineering, Feng Chia University 
Taiwan, R.O.C., *E-mail: tshwang@ fcu.edu.tw 
Abstract—The purpose of this research is to accomplish the ZPETC (Zero Phase Error Tracking 
Control) Path-Tracking gain-scheduling control design and real-time multi-task flight simulation for 
the automatic transition of tilt-rotor aircraft. 
Firstly, we select 20 flight equilibrium points during the automatic transition through the trim 
operation. For each equilibrium state, we can get a set of Jacobian matrix A, B of the linearized 
equation by using the numerical linearization method and perform the flight control system design. 
Due to the highly instability of the system for the period of the dynamic transition maneuver, if we 
978-1-4244-6506-4/10/$26.00 ©2010 IEEE                             RAM 2010 
 Time:   16:00 – 18:00 
Chairs:  Ray Jarvis and Mehmet Guzel 
Venue:  Room 3 
 
 
Development of Intelligent Massage Manipulator and Reconstruction of 
Massage Process Path using Image Processing Technique 
 
1Chih-Cheng Peng, 2Thong-Shing Hwang, 3Chih-Jui Lin, 2Yao-Ting Wu, 2Ching-Yi Chang, 2Jian-Bin Huang 
1 Ph.D. Program in the Graduate Institute of Electrical and Communications Engineering, Feng Chia University 
Taiwan, R.O.C., *E-mail: peter.peng@atechsystem.com.tw
2Department of Automatic Control Engineering, Feng Chia University 
Taiwan, R.O.C., *E-mail: tshwang@ fcu.edu.tw 
3Graduate Institute of Electrical Engineering, National Cheng Kung University, Taiwan, R.O.C. 
Abstract—This paper develops a motor-driven massage artificial electro-mechanical manipulator 
system with intelligent biomedical sensing-monitoring capabilities and constructs the path of massage 
process by using CCD image processing technique. In this paper, we integrate a versatile inter-digital 
electrocardiograph (ECG) into the manipulator system and construct a massage path by using twin 
CCD image processing technique with inverse engineering method. So, this electro-mechanical 
manipulator can automatically do the full massage process including pushing, pick-up and kneading 
actions to get the best therapy effect. 
By capturing the variant signals of the cardiovascular physiological parameters from the 
versatile inter-digital electrocardiograph, we can understand and analyze the physiological reaction 
due to the massage action and then try further to improve the therapy effect of massage. 
In the meantime, we have imitated a real human’s palm with finger’s action to design a 
human-like mechanical palm and accomplished the actions of massage including “pushing, picking-up, 
and kneading”, the most decisive technique is lying on the design of the fingers. 
Keywords—massage manipulator, image processing, massage process, biomedical sensing 
 
本次在國科會NSC 98-2221-E-035-058 的計畫經費暨逢甲大學資電學院專案核准補助經費下，前
往新加坡參加IEEE International Conference on Robotics, Automation and Mechatronics (RAM 2010)國際
研討會。  
本次會議除了本身之論文發表外，亦利用此會議與大陸、香港、新加坡以及來自世界各國之學者
探討有關機器人、自動化與機電整合之問題，使得這次學術之旅，既充實又難以忘懷。 
         
 In fact, the research and design of tilt-rotor in the United 
States of America have proceeded some years [1], in 1991, the 
technical report CR177578[3] of NASA stated the 
development of V-22. The propeller can be rotated upward or 
forward to make the thrust direction upward or forward. 
During take-off, the generated thrust of propeller upward to 
make the aircraft take-off vertically until some specified 
altitude is reached. After that, the propeller rotates gradually 
to make the aircraft flight forward with fixed wing in the 
cruise mode. 
For the time being, V-22 prototype has already been 
constructed and US Boeing Company proceeds with the 
commercial production of V-22 type aircraft [4]. Within the 
design of the mechanism, the rotational joint mechanism to 
conjunct the propeller and the wing must afford extreme large 
reaction force.  In order to secure the structure, we must raise 
the utilized standard of the material. During the mode 
interchanging of the rotary wing mode and fixed wing mode, 
the stability and control of the tilt-rotor aircraft body is very 
difficult. 
Another design idea is the M-85 design concept 
presented in the TM10287 report [5] of NASA-Ames 
Research Center in 1991. The design concept of M-85 is to 
utilize a round disk with the turbulent plate to generate the 
lifting force. Within the report, NASA proceed the wind 
tunnel test for the distribution situation of the 
round-disk-shape wing-cross-section and the round-disk with 
rotor-blade, the results show that the cruising performance of 
the round disk with rotor-blade will be able to reach or even 
exceed the other design concept as Folded Tilt Vector or 
X-wing. 
In 1998, the team directed by Professor Yang C. D. of 
Aeronautics and Astronautics Graduate Institute, National 
Cheng Kung University, developed the VTOL aircraft [7]. In 
the project, a whole new concept had been designed and 
developed, there are dual purposes for this kind of aircraft:  
rotor is used for vertical rising/descending and fixed wing is 
for high speed cruising as well. The key is the mechanism 
design of “Coaxial double layers round disk rotary wing”. 
In 1995, the project of Su-27 dynamic analysis, 
gain-scheduling design and real-time multi-task flight 
simulation is handled by Professor Hwang Thong-Shing, 
Aeronautics and Astronautics Graduate Institute, Chung-Hua 
University. In the project, the purpose is to design and simulate 
the particular Cobra behavior of SU-27 [8]. 
II. DYNAMIC MATHEMATICAL MODEL OF 
TILT-ROTOR AIRCRAFT 
Modeling aerodynamic forces is complicated due to (a) 
the interaction between the rotor downwash and the wing, 
and (b) the change in configuration with rotor tilt during the 
automatic transition.  The two nacelles are located at the 
wing tips and can be rotated through slightly more than 90 
degrees. Each nacelle accommodates an engine to drive a 
propeller. Each rotor has collective pitch control and cyclic 
pitch control in the longitudinal and the lateral directions.  
The forces acting on a tilt rotor VTOL aircraft can be 
divided into three classes: (a) gravitational, (b) aerodynamic, 
and (c) thrust. The aerodynamic forces are approximated by 
sums of forces on individual components of the aircraft. A 
simplified force diagram is shown in Fig.1. Let D be the drag 
and L the lift. The thrust and the in-plane force on the rotor 
are denoted by T and H respectively. D and L are expressed 
as the horizontal and vertical forces respectively in the flight 
path coordinate (velocity coordinate). T is perpendicular to 
the rotor tip path plane. η Is the angle between T and 
fuselage zero lift axis; γ is the flight path angle; θ is the 
pitch angle; φ is the angle between T and flight path axis. 
Fig.2 shows the longitudinal forces and moments acting 
on tilt-rotor aircraft. Here the moment equation is derived in 
body coordinate for holding constant inertia yyI of every 
computation, the purpose is to save computation time. But, 
the force equation is derived in flight path coordinate, the 
purpose is to put the drag force on the linear acceleration 
axis and the lift force on the tangential acceleration axis for 
convenient computation of flight velocity and flight angle. 
φ
θ
η
iα
γ
 
Fig.1 Tilt-rotor aircraft reference angles and forces  
Where  and  are expressed as components of 
thrust along the body x axis and z axis respectively in body 
coordinate.  and  are expressed as components of 
rotor in-plane force along the body x axis and z axis 
respectively in body coordinate. 
TxbF TzbF
HxbF HzbF
d Vm
d t
and dmV
dt
γ  are  the 
components of force along the x axis and z axis respectively 
in flight path coordinate. ：distance from the root of the 
nacelle to the center of gravity, 
2
：distance from the root of 
the nacelle to tail, ：distance from the root of the nacelle to 
hub, q : pitching angular velocity.  
1l
l
3l
3l
1l
2l
γ θ
η
Am
HzbF−
HxbF−
TzbF−
TxbF
Fig.2 Longitudinal forces and moments for tilt-rotor aircraft 
The drag and lift are expressed in the following as sums 
of forces on individual components (W ,T ,F,NAC are 
expressed as wing, tail, fuselage, and nacelle respectively): 
         
  
Fig.3 Particular selected take-off flight path  
The problem of guidance during take-off concerning 
some control variable constraints is stated as follows: 
(a) The thrust is fixed at the maximum value. 
(b) There are similar constraints on flap deflection and pitch 
angle during a portion of the take-off trajectory. 
(c) One way to use quadratic synthesis is to use less(more) 
than the maximum(minimum) values of these control 
variables during the nominal flight leaving a certain 
margin for feedback control. 
(d) Flap deflection is not rather efficient control variable. 
(e) The installed power and rotor size in a tilt-rotor VTOL 
aircraft are dictated by the take-off requirements. 
From the above constraint condition analysis of the control 
variables, it is not necessary to use four control variables 
, , , (T )fδη δθ δ δ δ to achieve the desired goal. Therefore, 
we only choose rotor shaft tilt δη and pitch angles δθ as 
feedback controls.  
Hence, the longitudinal linear dynamic equation can be 
simplified to the following expression: 
1 1
2 2
( ) ( ) ,
, ,
TO TO TO
TO
dZ F t Z G t U U
dt
g g u
G Z
g g w
η θ
η θ
Y Z
η
θ
⎡ ⎤= + = ⎢ ⎥⎣ ⎦
⎡ ⎤ ⎡ ⎤= =⎢ ⎥ ⎢ ⎥⎣ ⎦⎣ ⎦
=
                (14)
 
When Z is measurable and the quadratic synthesis method is 
used, optimal control problem can be solved by the minimum 
principle and the corresponding Hamiltonian equation formed 
as )()(
2
1),,( TOTO
T
TO
T
TO
T UGFZBUUAZZtZH +++= λλ ,
then we can get the optimal control gain as follows: 
CZRZGBU TTO =−= − 1*                                   
  (15) 
Where R is the solution of the following well-known Riccati equation:
      (16) 
ftf
T
TOTO
T RtRRGBRGARFRFR =+−−−= − )(,1&
Assume 
TO
TO
GFsIP
U
YZY 1)(, −−===                  (17) 
If we transfer the optimal gain C into the classical feedback 
control gain K(s), then 
( ) ( ) ( )P s K s CP s− =                           (18) 
Therefore, the classical unit feedback closed-loop control 
diagram can be obtained as follows: 
)(sP)(sK
 
Fig.4 Classical unit feedback closed-loop control diagram 
The closed-loop transfer function can be obtained as: 
( ) ( )( )
1 ( ) ( )
P s K sM s
P s K s
= +                          (19) 
B. Longitudinal guidance and control during landing 
The technique of the longitudinal control gain and 
guidance scheme design during landing is similar to the 
take-off case. The nominal trajectory is a straight line with a 
flight path angle of -5.7 degree/sec, to start with the rotors 
until the rotor shaft angle reaches 101 degrees. The flaps and 
the aileron-flaps are turned until they are deflected 57 degrees. 
The rotor start producing thrust when the rotor shaft angle 
exceeds 90 degrees so that a component of the thrust 
decelerates the aircraft. The aircraft trajectory is shown in 
Fig.5. 
 
Fig.5 Nominal landing trajectory 
The linearized equations also need to be simplified as in 
the case of take-off guidance with one exception. During 
take-off the rotor thrust was set at its maximum available 
value at all times. However, during landing the thrust is less 
than the maximum value and can be used as a control variable. 
We use rotor shaft tilt angle and rotor thrust as two control 
variables. The simplified and linearized equations are  
1 1
2 2
( ) ( )   ,  
  ,    ,   
L L L
L
dZ F t Z G t U U
Tdt
g g u
G Z
g g w
η θ
η θ
η⎡ ⎤= + = ⎢ ⎥⎣ ⎦
⎡ ⎤ ⎡ ⎤
Y Z= = =⎢ ⎥ ⎢ ⎥⎣ ⎦⎣ ⎦
              (20) 
As same as take-off, we can get the optimal control gain C. 
 
V. DYNAMIC ANALYSIS AND CONTROL DESIGN 
OF AUTOMATICAL TRANSITION FOR TILT-ROTOR VTOL 
AIRCRAFT 
A. Dynamic analysis and control design 
VTOL tilt-rotor aircraft design need consider the relation 
between aerodynamic variation of VTOL transition state and 
control stability problem. Therefore, it is necessary to propose 
a special guidance control mechanism to analyze, design, 
simulate, and validate the abrupt varying situation in the 
VTOL transition state. Also, we need investigate the force and 
moment on the mechanism to select the appropriate material. 
Therefore, we propose a hybrid methodology including 
optimal control, ZPETC and gain scheduling method to 
complete the guidance and control of VTOL transition period. 
 
VI. ZERO PHASE ERROR TRACKING CONTROL  
In the control loop, if feed forward controller design is 
the reciprocal of the system transfer function , )(sM
         
 and actuator 
Task2 6-DOF dynamic equation computation 2 32Hz 
Task3 Indication of real time state variables 3 32Hz 
Task4 Indication of the operating system parameters 4 16Hz 
Task 
t CPU spare time calculation 5 8Hz 
Taskb Demonstration of flight dynamic behavior 6 8Hz 
The current planned and established task-scheduling is 
implemented in the prearranged scheduling table as above 
Table 1, there are 4 kinds of task with frequencies 64Hz, 32Hz, 
32Hz, 16Hz. 
In the following procedures, we can see how to decide 
the priority and time base of all tasks: 
 1. Execute task establishment (Task-create), task scheduling 
arrangement (Task-exec), and task stop to sleep 
(Task-suspend). Finally the program starts to run by the 
main procedure (usermain). 
2.  While executing the main program loop, first to pause and 
wait the interrupt event (EVENT-wait) until the interrupt 
signal appears , and then to read the scheduling table and 
execute the related jobs in sequence. 
3.  Execute the computation of the control law and actuator 
in Task 1. 
4.  Execute the calculation of the air dynamic coefficients 
and the longitudinal dynamic response in Task 2. 
5. Select the screen to display for the purpose of analysis 
The program of this project is written by MSC 
(Microsoft C), main program is the mainframe and soul of 
whole real time simulation. Task 1 and Task 2 can be replaced 
by the air dynamics and dynamic equation of IDF、F-16、
SU-27, or helicopter at any time, corresponding with suitable 
interrupt frequency and schedule table to simulate different 
system.  
C. Real Time Dynamic response Simulation and Analysis 
Regarding the real time simulation, due to the special 
aerodynamic characteristics of tilt-rotator aircraft, we need 
tune PID control gains to simulate the motion of each 
different stage such as Hover, Transition, and Cruise. As for 
the dynamic response analysis, before the action of maneuver, 
we need trim the airplane to steady-state of level flight and 
utilize the numerical linearization method to find the 
linearized state equation of all points regarding the transition 
between vertical rise/descend and forward flying of the 
tilt-rotor aircraft to analyze their performance and then 
perform optimal control and ZPETC tracking control design. 
 
Fig.8 State variables display of real-time flight simulation 
 
 
Fig.9 Animation display of the dynamic behavior for vertical 
rising and descending 
 
VIII. CONCLUSION 
Through the computation of derived dynamic equations 
(force ad torque equations), we adjust the control factors to 
get the state variables of the non-linear dynamic equations, 
flight trajectory (include take-off and landing) and dynamic 
behaviors. By the ZPETC tracking control algorithm, we can 
adjust control force to reach the motion contour of rising and 
descending. Before analysis and design of the control 
algorithm for the motion contour tracking, we linearize the 
non-linear system by the numerical linearization method. And 
utilize the Matlab to complete the optimized control law 
design and transfer the optimized control gains to control 
compensator at the same time in order for feed-forward 
controller or intelligent controller design. 
Finally, we setup the real-time multi-task flight 
simulation system to simulate and validate the system 
dynamic behavior of the tilt-rotor aircraft. 
 
IX. ACKNOWLEDGEMENT 
This research was sponsored by Chung-Shan Institute of 
Science & Technology, Taiwan, R.O.C. under the grant 
XW98132 P073 PE. 
X. REFERENCES 
[1] Narendra Kumar Cupta, Part I: Automatic Transitions of 
a Tilt-Rotor Aircraft, Dissertation of Ph. D. in Stanford 
University, December 1973.. 
[2] Georgie, J., and Valasek, J., “Evaluation of Longitudinal 
Desired Dynamics for Dynamic-Inversion Controlled 
Generic Reentry Vehicles,” Journal of Guidance , 
Control , and Dynamics, Vol. 26, No. 5, pp. 811-819, 
2003. 
[3] Rutherford, O'Rourke, Martin, Lovenguth, and Mitchell, 
“Technology Needs for High-Speed Rotorcraft,” NASA 
CR177578 , Apr.1991. 
         
 Real-time Simulation of a 3-leg 6-DOF Parallel Manipulator  
Based on RT-Linux Operation System 
1Chih-Cheng Peng, 2Thong-Shing Hwang, 2Ching-Yi Chang, 2Yao-Ting Wu, 2Sang-Hugh Wu 
1 Ph.D. Program in the Graduate Institute of Electrical and Communications Engineering, Feng Chia University 
Taiwan, R.O.C. , *E-mail: peter.peng@atechsystem.com.tw
2Department of Automatic Control Engineering, Feng Chia University 
Abstract—The real-time multi-task simulation of a 3-leg 
6-DOF high performance platform system based on RT-Linux 
operation system is presented in this paper. The new architecture 
is setup by three extensible legs sliding on three linear slide-rail 
each actuated by a synchronous linear servo motor. The 
extensible legs are actuated by inductive AC servo motors. In the 
meantime, the inverse and forward kinematical equations 
describing the motion of the platform system are derived. This 
kind of architecture using the hybrid (linear and AC) motors 
yields high performance of motions, especially in speed and 
working space. The novel result of maximal working angles is the 
significant contribution of this architecture. 
 The platform system is operated in the RT-Linux real-time 
multi-task executive environment, which is superior to windows, 
including: (a) RT-Linux real-time is hard real-time, (b) 
RT-Linux real-time operation system is free, (c) Multi-task can 
be scheduled by the optimum preemptive static scheduling 
algorithm. We have demonstrated the dynamic behavior of 
platform in the RT-Linux window and the OpenGL 3D/VR 
multi-medium. 
Keywords—RT-Linux, parallel manipulator, real-time 
multi-task simulation, linear servo motor 
XI.  INTRODUCTION  
HE  Stewart platform is a 
six-degree-of-freedom (6-DOF) mechanism with two 
platforms connected together by six extensible legs. This 
manipulation structure is obtained from generalization of the 
mechanism originally proposed by Stewart [1-2] as a flight 
simulator. There are many research topics concerning the 
related mechanical structure, including its construction, 
singularity and working space determination, forward and 
inverse kinematical problem solution, dynamic forces 
computation, motion control, and practical applications [3-8]. 
Up to now, there has been little research concerning 
multiple DOF parallel manipulators actuated by the hybrid 
(including linear and AC) motors. Linear motors possess 
many advantages, such as direct driving, high position control 
accuracy, high speed, high acceleration, wide bandwidth and 
easy to control (due to less nonlinearity). These features 
strengthen the dynamic performance and simplify the control 
design task. In this paper, the base platform of this 
architecture has three linear slide-rail each actuated by a linear 
motor. On each forcer (translator) of the linear motors, there is 
a link with extensible length jointing the upper (moving) 
platform and the forcer. Forward and inverse kinematical 
equations have been derived and validated. This kind of 
platform has also been experimentally setup in our laboratory.  
This kind of new special architecture using the hybrid 
motors yields high performance of motions, especially in speed 
and working space. Since the presented manipulator 
mechanism is different from the conventional ones, the 
working angle is proved to be very large. The novel result of 
the maximal working angle is the significant contribution of 
this paper. We have accomplished the hard real-time multi-task 
simulation after building the 3-leg 6-DOF hybrid motors 
driven platform system. We also have constructed a 3D/VR 
OpenGL graphic user interface embedded in the monitor under 
RT-Linux real-time operation system. The program design can 
be divided into several parts: (1) 3-leg platform kinematical 
equation computation, (2) Real-time multi-task operating 
system design, (3) RT-Linux processes communication 
between foreground and background processes, (4) 3D/VR 
OpenGL multi-medium display. 
XII. PLATFORM SYSTEM DESIGN 
A. New architecture 
The new architecture as shown in Fig.1 is constructed by 
three extensible legs sliding on three linear slide-rail each 
actuated by a synchronous linear servo motor. The extensible 
legs are actuated by inductive AC servo motors.  
B. Degree of freedom analysis 
Based on the Grubler criterion, the degree-of-freedom value 
of a mechanism can be calculated as follows: 
                                 
(1) 
( ) ∑g i
i= 1
M = d n - g - 1 + f
Where g is the number of joints in a mechanism, d = 6 for 
spatial mechanisms, n: number of links in a mechanism, 
：degrees of relative motion permitted by joint i. So, the 
degree-of-freedom value of the above 3-leg 6-DOF parallel 
if
Taiwan, R.O.C., *E-mail: tshwang@ fcu.edu.tw
T 
         
 Combining (5) and (6), ixB  can be solved for all motor 
translators: 
( ) ( )(
( ) ( )
)bix aix ix iy biy aiy
ix
bix aix biy aiy
B - B P + P - C B - BB = B - B + A B - B
        
   (6) 
Where ( )( )biy aiybix aix
B - BA = B - B
, bix aiy biy aix
bix aix
B B - B BC = B - B
 
Equation (6) ensures that all ixB  are within the slide-rail 
of the linear motor. By the same way, can also be 
determined.  
iyB
C. Forward kinematics 
The forward kinematics is to calculate the position and 
attitude of the moving platform for the given iB and . The 
forward kinematics problem is required to solve the solution 
of non-linear equations and this usually leads to multiple 
solutions. In order to obtain a fast and reliable solution to the 
forward kinematics, Newton-Difference numerical method is 
adopted. 
il
Using the constraint equations of the links, we have 
2 0il= − =i 1Φ Ti i i i( P - B ) ( P - B ) 1,2,3
i 2
, i =        
(7) 
0= ⋅ =Φ Tk k k( P - B ) d = 4 ,5 ,6 , k = i - 3 , i       
  (8) 
Where  is the vector of the slide-rail for the linear motor, kd
| |i il = L . 
Differentiating (7) and (8) with respect to time t gives 
= = 0
t
∂
∂
& &Φ X qΦ X + Φ q 11 21 31 42 52 62[Φ ,Φ ,Φ ,Φ ,Φ ,Φ ]
ω ω ⎤⎦
,Φ =       
 (9) 
Where , 
. Using 
T
px py pz= = x y zϑ ω⎡ ⎤ ⎡⎡ ⎤⎣ ⎦ ⎣⎣ ⎦&& & & & & &X
T
pp = p ω
Tlllddd ],,,,,[ 321321=q
( )∂∂ & & &pi1 v
Φ = 2 + T Ti i ip T m - B p = 2Lp
= 1,2,3, i         
 (10) 
( )
∂
⋅∂
∂&
i 2Φ
T
Tv k k k
k
T + m - B d
p = p = p
p p d& &
 , 
       (11) i = 4,5,6, k = i - 3
( ) ( ) ( )ω ω∂ × ×∂ & T T Tp Pi i p i i i i p= 2 R P L = 2 R P L = 2 m Lϑ pωi1Φ , 
        (12) i = 1,2,3
p
T
kkk
T
k
p
p
k
T
kk
p
v
p ω)d(md)PR(ω
d)BPRT
ω ×==∂
−+∂=∂
∂ &ϑϑ
(Φi2 ,    
,    (13) 
         
i = 4,5,6 k = i - 3
Where , Pi im = R P i v i
1 1 1 1 1
2 2 2 2 2
3 3 3 3 3
1 1 1
2 2 2
3 3 3
{2 ( )} {2 ( )}
{2 ( )} {2 ( )}
{2 ( )} {2 ( )}
( )
( )
( )
T T
T T
T T
T T
T T
T T
⎡ ⎤+ − × + −⎢ ⎥+ − × + −⎢ ⎥⎢ ⎥+ − × + −= ⎢ ⎥×⎢ ⎥⎢ ⎥×⎢ ⎥×⎢ ⎥⎣ ⎦
XΦ
v v
v v
v v
T m B m T m B
T m B m T m B
T m B m T m B
d m d
d m d
d m d
 
(14) 
Equations (7) and (8) can be expanded as 
∂
∂ L( )
ΦΦ X + Δ XX + = 0
        
(15) 
Ignoring the high-order terms, the above equation can be 
expressed 
- 1
XΔ = - ( )X Φ Φ         
(16) 
With XΦ defined by (14). The Newton-Difference numerical 
method solving for X  can then be performed by using this 
equation. 
 
XIV. BUILDUP OF RT-LINUX REAL-TIME MULTI-TASK 
SIMULATION SYSTEM 
A. Advantages of RT-Linux 
We design the simulation program of real-time control 
according to the 3-leg 6-DOF platform. Based on the 
definition of hard real-time, Windows NT cannot achieve the 
hard real-time response due to using the technology of 
message-queue and event-driven, Windows NT will result in 
time latency and uncertainty. To solve this problem, we select 
the RT-Linux as the real-time simulation platform. 
B. Communication between processes 
The RT-Linux application is divided into two parts, 
real-time domain and non-real-time domain. The real-time 
domain program simply provided limited resources can’t be 
satisfied in the complex case. It can’t use general function 
library such as lib. The non-real-time domain program can use 
all the resource provided by the Linux. 
    The major functions of real-time task are: The function 
pthread_create() is used to create a new job, and set the size of 
stack and priority. The function pthread_make_periodic_np() 
is used to setup the task period and start time. The function 
pthread_wait_np () will stop all running real-time task until 
next period. The key point of communication between 
real-time task and Linux process is FIFO. We use the function 
rtf_create() to create FIFO, and then use the function rtf_put() 
to put data into FIFO. The FIFO is treated as a file in Linux, 
we can use open() and read() to open and read it. 
iL = T + m - B ,  is the 
angular rate of the platform. 
pω
XΦ can be expressed as  
         
 Secondly, the program goes into an endless loop and call the 
pthread_wait_np() function to wait. When the Linux process 
writes command into FIFO to wake up the interrupt 
processing program, the interrupt processing program will call 
the pthread_wait_np() to wake up the task, and then set the 
related task data from FIFO. Any time the Linux process will 
check if the FIFO has been written, when it has been written 
the program will execute the specific function. 
D. Multimedia  
Although Glade can build the major GUI framework of 
our application, but it is still developing, so it has restriction in 
some parts. Therefore, there is some problems in OpenGL 
graphics display on X windows. The first question is Glade 
doesn’t provide the OpenGL drawing area component. In fact, 
a weight-bearing point is that GTK doesn’t have OpenGL 
drawing area component. Since GTK doesn’t support 
OpenGL drawing, we need to install some library which 
supports the OpenGL drawing. Here we choose the Mesa 3D 
library, its syntax is almost the same as OpenGL besides some 
special functions. After we install the Mesa 3D library, we can 
manipulate the OpenGL drawing. 
Also we face a new problem to put the OpenGL graphics 
into the GTK windows together with the state data. Because 
there is no OpenGL drawing area component, so we can’t 
display the OpenGL graphics in GTK windows. In order to 
solve this program, we need to install GtkGLArea to make it, 
GtkGLArea provides the OpenGL drawing area component in 
GTK windows for us. However, the OpenGL drawing area 
component provided by GtkGLArea doesn’t combine with 
Glade, so we can’t build our GUI by Glade alone, we must 
modify the source codes produced by Glade and add the 
GtkGLArea component to draw OpenGL graphics. 
Write Ctl_FIFO
& set Task_period
Start_taskStop_task
While(1)
RenderShowInput Path-> Inverse Kinematics
2 real-time task &
ctl_fifo handler created
ctl_fifo handler
(my_handler();)
While(1)
pthread_wait_np();
pthread_wakeup_np();
Start taskStop task
pthread_make_periodic_np();pthread_suspend_np();
break(); rtf_put();
pthread_wait_np();
Yes
Yes Yes
Start next period
Linux ProcessKernel Module (real-time process)
check ctl_fifo if set?
check FIFO 1
if set ?
check FIFO 2
if set ?
Initial Initial
Fig.5 Communication between RTLinux and Linux 
  process 
 
Fig.6 3D graphical illustration of the hybrid motors driven 
platform 
E. Build OpenGL Drawing Area and Graphics into GTK 
Windows  
The normal GTK doesn’t support OpenGL, so we need 
to install some library to support it. Some steps for building 
OpenGL drawing area in GTK windows are introduced as 
follows： 
(A) Create a GtkGLArea component: 
           GtkWidget *glarea; 
   glarea = GTK_WIDGET(gtk_gl_area_new(attrlist)); 
Where the attrlist is a matrix used to setup some attributes. 
(B) Setup the event processing function: 
We need to set the event which is linked to GtkGLArea 
component. For example, the following function links the 
GtkGLArea with the configure_event. When the windows size 
changes, it will send out configure_event, and then our 
program will execute the event processing function. 
(C) Add the OpenGL drawing area into GTK windows: 
We add the GtkGLArea into GTK windows when all the 
events and processing functions have been set. 
gtk_container_add(GTK_CONTAINER(window),GTK_WID
GET(glarea)); Where the window is the target window. 
(D) Display drawing area: 
After the GTK window has been displayed, we can call the 
following function to show up the GtkGLArea drawing area: 
    gtk_widget_show(GTK_WIDGET(glarea)); 
Thanks that the OpenGL is a cross-platform software, so 
the syntax in Linux is almost the same as windows. The major 
different is: 
(A) make_current function:   For Linux syntax, we have 
gtk_gl_area_make_current(GTK_GL_AREA(widget)) 
 (B) Refresh function: 
Linux syntax:  gtk_widget_draw(widget,NULL); 
F. RT-Linux Real-time Program Design  
Because RT-Linux treats real-time task as module, it can’t 
use main() function in the program. The major parts of the 
program consist of init_module(), thread_code(), and other 
related interrupt processing functions: 
1. init_module()：Initialize the modules.  
Int init_module(void) 
         
  ACKNOWLEDGEMENT 
 This research was sponsored by National Science Council, 
Taiwan, R.O.C. under the grant NSC 98-2221-E-035-058.  
  
 REFERENCES 
 [1] D. Stewart, A platform with six degrees-of-freedom, 
Proc Inst Mech Eng 180(Pt 1, 5), 965, 371-386.  
 [2] E.F. Fichtert, A Stewart platform-based manipulator: 
general theory and practical construction, International 
Journal of Robotics Res 5(2), 1986, 157-182. 
 
 
 [3] J.P. Merlet, Trajectory verification in the workspace for 
parallel manipulators, J Robotic Syst 13, 1994, 326-333.   
 [4] L.C. Lin and M.U. Tsay, Modeling and control of 
micropositioning systems using Stewart platforms, J 
Robotic Syst 17(1), 2000, 17-52. 
 
 
 [5] Z. Ji, Workspace analysis of Stewart platform via vertex 
space, J Robotic Syst 13, 1994, 631-639.  
 [6] Z. Hao and W. Qiyi, The kinematics and workspace 
analyses of a parallel manipulator for manufacturing, 
Proc IEEE Int Conf Industrial Technology, 1996, pp. 
647-650. 
 
 
 
 [7] C.M. Luh, Working capability analysis of Stewart 
platforms, ASME J Mech Design 118, 1996, 220-227.  
 [8] M. K. Lee and K. W. Park, Kinematic and dynamic 
analysis of a double parallel manipulator for enlarging 
workspace and avoiding singularities, IEEE Trans 
Robotics Automat 16, 1999, 1024-1034. 
 
 
 
  
  
  
  
  
  
  
  
  
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
         
 recognition and positioning to identify the massage behavior. 
At the same time, we can deeply understand and analyze the 
massage physiological reaction and response to improve the 
therapy effect by using the signal variation of the 
cardiovascular physiological parameters from the versatile 
inter-digital electrocardiograph. 
XIX. MOTOR-DRIVEN MASSAGE ARTIFICIAL 
ELECTRO-MECHANICAL MANIPULATOR SYSTEM 
We divide the motor-driven electro-mechanical massage 
manipulator system into two main parts: 1st part is the 
manipulator system with 5-DOF electro-mechanical 
manipulator platform as a base to integrate with the connecting 
human-like mechanical palm and then be able to reach the 
three-dimensional space range of massage onto the patients. 
The finger tips can approach and reach any massage starting 
location, the palm posture possesses three freedom variations 
by rotating the wrist joint, the flexible pressure sensor on hand 
is used to real-time monitor the massage force during the 
therapy onto the patients, and the vibrating massage effect can 
be enhanced on hand by applying the micro vibrating motor. 
The other main part is the physiology signal monitoring 
system which can process the measurement, recording, and 
analysis at the same time while the electro-mechanical 
massage manipulator is doing the rehabilitation treatment. 
A. 5-DOF Electro-Mechanical Manipulator Design 
In order to enable the electro-mechanical massage 
manipulator to process the massage in three-dimensional space 
with no restriction, we design the platform to be a 5-DOF 
electro-mechanical manipulator. The design about the length 
of the manipulator is to consider real human body as reference. 
The whole mechanical structure designed by circular or 
rectangular thin pipe with aluminum alloy is to reduce the 
weight of the mechanism but to support necessary mechanical 
stiffness and effective cost of materials. We use Solid Works 
software to design the 3D drawing as shown in Fig1. 
 
Fig.1 5-DOF manipulator top, side and vertical views 
(A)Kinematical Analysis of the Manipulator 
We are going to study both the kinematics and dynamics of 
the manipulator. While the speed of the motion is not high 
enough to raise the effect of the dynamics, we can only 
consider the kinematics. As long as we want to demonstrate 
high speed motion, we then must consider the dynamical 
behavior to be able to describe the complete situation of the 
motion of the mechanism. 
In order to analyze the motion of the manipulator, we 
need to make some definition for the manipulator. While 
designing the manipulator for three dimensional motion, it 
requires 5 degree-of-freedom as illustrated in Fig.1.   
After the mechanism has been confirmed, then to define 
the environment of the manipulator as follows: 
The kinematics of the manipulator includes forward 
kinematics and inverse kinematics. The forward kinematics is 
to get the relative motion results of the end-effecter in the 
Cartesian coordinate from the base coordinate and the 
rotational motion of each joint of the manipulator. The inverse 
kinematics is to get the relative motion of each joint of the 
manipulator from the given base coordinate ant the Cartesian 
coordinate of the end-effecter. 
The coordinate transfer matrix we use here to derive the 
kinematics is based on the homogeneous transformation 
matrix, and the Denavit-Hartenberg homogeneous 
transformation matrix is used to derive the forward and inverse 
kinematics of the manipulator. 
Based on D-H method, we transfer the i-1th coordinate to  
ith coordinate, the transformation matrix can be derived 
from the multiplication of  transformation matrices as  
i
i A1−
44×
),(),(),(),(1 αθ xTaxTzTdzTAii =−         
(1) 
To substitute the 44×  matrices into equation, we can 
get 
⎥⎥
⎥⎥
⎦
⎤
⎢⎢
⎢⎢
⎣
⎡
−
−
=−
1000
0
1
iii
iiiiiii
iiiiiii
i
i
dcs
sacsccs
cassscc
A αα
θθαθαθ
θθαθαθ
        
(2) 
Above matrix is the transfer matrix of D-H coordinate 
transformation method. 
(B)Dynamics analysis of the manipulator  
The dynamics of the manipulator also includes forward 
dynamics and inverse dynamics as introduced as follows: 
Forward dynamics: Given the applied torque of each joint 
to get the dynamic behavior and then to derive the motion 
trajectory of the manipulator. 
Inverse dynamics: Given a plan-scheduled motion 
trajectory of the manipulator to get the dynamic behavior of 
each joint and then to derive the force and torque of each joint. 
We apply the method of Newton-Euler to derive the 
dynamic equation of the manipulator. The Newton-Euler 
method is constructed by Newton equation and Euler equation 
described separately as following: 
Newton equation: The force equation can be obtained as 
follows: 
     cc vmmaf &==         
(3) 
Euler Equation: The torque equation also can be derived 
in the following: 
      ( )ωωω CCCCC IIn ×+= &         
(4) 
         
 Part xxI  yyI  zzI  
Base (Disk) 2940 2940 5880 
Upper Arm 7627.5 32130 25098.75 
Lower Arm 5791.875 36770.83 31687.71 
Wrist 395.83 1136.67 1074.17 
(C) Implementation of kinematics for the massage manipulator 
The following is the implementation of the massage 
electro-mechanical manipulator. Please refer to the following 
figure as the real implementation of the manipulator: 
 
Fig.3 Photo of the manipulator 
x 0
y 0
z 0
x 1z 1
y 1
z 2
y 2
x 2 z 3 x 3
y 3
y 4
x 4
z 4
x 5
y 5
z 5
5 c m
3 c m
1 8 c m
1 5 c m
2 0 c m
4 c m
T 
Fig.4 5-DOF coordinates of manipulator  
The above figure is designed based on the Solid Works to 
show the size and the space coordinates. 
We consider the required working space and the “pushing, 
pick-up, and kneading” actions for the massage process, and 
then design a massage electro-mechanical manipulator with 5- 
DOF within the 3D space to realize the desired massage 
therapy with the planning trajectories.  
 
According to D-H method, we can obtain all joint 
parameters as shown in Table 2. 
Table 2 Parameters of each joint 
joint i 
iθ  iα  ia  id  
1 
1θ  90° 3 5 
2 
2θ  0° 18 0 
3 
3θ  0° 20 0 
4 
4θ  –90° –4 0 
5 
5θ  0° 0 15 
From the D-H table, the homogeneous transformation 
matrices  can be obtained.  5~1,1 =− iAii
From the definition of the forward kinematical 
computation, if we substitute the angle of joints  
),,,,( 54321 θθθθθ  into the transformation matrices, then the 
position and orientation of the end-effecter expressed in the 
base coordinate system can be calculated. 
After completing the calculation of the forward kinematics, 
we continue to calculate the inverse kinematics. We use the 
traditional calculation method which can be applied into most 
of the manipulators. During the calculation process, we need 
to assume the position and orientation of the end-effecter with 
respect to the base coordinate to be known already as follows: 
T0 5 =
⎡ ⎤⎢ ⎥⎢ ⎥⎢ ⎥⎢ ⎥⎢ ⎥⎣ ⎦
x x x x
y y y y
z z z z
n o a p
n o a p
o a pn
0 0 0 1
        
(21) 
Using the homogeneous transformation 
matrices , we compare each element of these 2 
matrices to solve the inverse motion equation and get the 
solution of the angles at each joint. Thus 
5~1,1 =− iAii
T A A A A A0 0 1 2 3 45 1 2 3 4= 5
-1
        
(22) 
Due to the elements of the 4th row of the 2 matrices to be 0, 0, 
0, 1，according to equation (22), we can list the other 12 
equivalent equations to find the solution of the inverse 
kinematical equation. Observe the 12 equations, it is not easy 
to find the suitable equivalent equation to get the solution, 
therefore we multiply  on both sides of equation (22) 
to get the following equation: 
0
1( A )
  ( )-10 0 1 2 3 41 5 2 3 4A T A A A A= 5
5
5
5
5
5
5
        
(23) 
Compare the elements of the 2 transformation matrices 
by equation (23), we can list 12 equivalent equations as 
follows: 
( )1 1 2 3 4cosθ + sinθ = cos θ +θ +θ cosθx yn n        
(24) 
( )2 3 4= sin θ +θ +θ cosθzn         
(25) 
1 1sinθ cosθ = sinθ- -x yn n         
(26) 
( )1 1 2 3 4cosθ + sinθ = cos θ +θ +θ sinθ-x yo o        
(27) 
( )2 3 4= sin θ +θ +θ sinθ-zo         
(28) 
1 1sinθ cosθ = cosθ- -x yo o         
(29) 
( )1 1 2 3 4cosθ + sinθ = sin θ +θ +θ-x ya a         
(30) 
         
  
Fig.8 3D/VR design diagram of massage hand system 
XXI. EXPERIMENTS 
A. Manipulator motion trajectory control and monitoring 
(A) Software control interface screen 
The motor controller chosen to control the 
electro-mechanical massage manipulator is “LTSV10KIT03” 
developed by the company “LATTEBOX”. The controller can 
control 10 axes servomotors at the same time through the USB 
interface communication with main PC. We use the API 
interface tool to establish the motor control interface to 
process the require motion of each axis in order to accomplish 
the massage motion. 
(B) Pressure sensor monitoring interface 
Here, we use the flexible pressure sensor “FlexiForce 
Sensor” to capture the pressure signal, convert to digital signal 
with ADC0804, do signal processing in microcontroller 8051, 
transfer the pressure signal to personal computer through 
RS232 serial interface, and then monitor the pressure signal on 
PC man-machine interface. 
 (C) Manipulator motion trajectory control interface 
For our current prototype system, the massage motion 
trajectory need to be setup by using CCD acupuncture-point 
recognition and positioning procedure in the above section in 
advanced, this motion trajectory with the characteristic image 
data (feature points) captured by the dual CCD camera sets 
and processed on PC to get the joint angles of the massage 
manipulator through the inverse kinematics computation. 
Using the computed joint angles, the manipulator moves all 
axes to reach the recognized position of each 
acupuncture-point and then accomplish the massage therapy 
process. 
(D) Physiology signal monitoring interface 
For monitoring the physiology signal of massage, we use 
“NOVA 5000” physiology signal measurement platforms. This 
platform matches with built-in “MultiLab” operational system 
software, can measure at the same time with 4 kinds of sensors, 
and process the statistics analysis such as covariance etc.. 
B. CCD acupuncture-point recognition and positioning 
       Based on the above described procedure of 
acupuncture point recognition and positioning, we can search 
the feature point of acupuncture from the shoulder to waist on 
the back side of body and calculate the coordinate position by 
using CCD image processing technique and camera model 
which describes the physical process from scene plane to 
image plane. 
       The experimental result has demonstrated the 
acupuncture points can be recognized and coordinated 
automatically by CCD image processing technique as shown 
in Fig.10. 
 
Fig,10 Acupuncture-point recognition and positioning 
C. Physiology signal analysis of massage therapy treatment 
A candidate was selected as follows: sex: male, age: 24 
years old, height: 177 cm, weight: 74 kg. We process 500 sec 
physiology data collection for the heart beat rate, ECG, 
breathing rate, human body temperature as reference data 
before the start of massage action and during the massage 
action on acupuncture locations. The collected data and related 
statistic data analysis comparison sheet shown in TABLE 3. 
TABLE 3 
The statistic data analysis comparison sheet  
 control  Experiment 
Average  67.17 63.3 
standard error  8.05 8.6 
Measurement 
velocity  
10 sample 
/sec  
10 sample 
/sec  
H
eart R
ate  sample amounts  5000 5000 
Average  12.2 9.74 
standard error  26.6 57.89 
Measurement 
velocity  
10 sample 
/sec  
10 sample 
/sec  
V
ital 
C
apacity
sample amounts  5000 5000 
We compare the experimental results for the data before 
and during the massage action, we find that the heartbeat rate 
during massage is reduced to 63.3/sec compare to the original 
67.17/sec before the massage action. But there are no obvious 
differences for other sensors. From the experimental result of 
heartbeat rate shows that the massage action tends to cause 
human being to be relatively peaceful during massage process. 
XXII. CONCLUSION 
The current society already tend to be the aging society, 
many elders are suffering the regression and pains of body 
after long-accumulated job loadings. Therefore human being 
often requires rehabilitation related physiotherapy to recover 
the health, and the artificial massage therapy by the 
physiotherapist is recognized as effective therapy already in 
the medical field. 
The reason why we propose the idea of a motor-driven 
electro-mechanical massage manipulator is to provide the best 
assistance to the physiotherapists to accomplish the same or 
even better massage rehabilitation effects for human beings. In 
this research, we have accomplished the following major tasks: 
         
出席新加坡2010 IEEE 機器人、自動化與機電整合國際研討會之心得報告 
Report of IEEE International Conference on Robotics, Automation and Mechatronics (RAM 2010) 
 June 28-30, 2010, Grand Copthorne Waterfront Hotel, Singapore, http://www.cis-ram.org/2010/ 
逢甲大學 自動控制工程學系 黃榮興 7/7/2010 
    
此次 2010 IEEE 機器人、自動化與機電整合國際研討會是由 IEEE Systems, Man & Cybernetics 
(SMC) Singapore Chapter, IEEE Robotics & Automation (R&A) Singapore Chapter幾個團體機構所贊
助，Centre for Intelligent Control, National University of Singapore, Singapore, Centre for Intelligent 
Machines, Nanyang Technological University, Singapore以及Mechatronics Group SIMTech, Singapore等
學校所舉辦。研討會之會場選在新加坡 Grand Copthorne Waterfront Hotel, Singapore。此次研討會接
受之論文大約 150 篇，錄取率相當低，這些論文分別在三天內(June 28-30)發表，場面相當壯觀。此
次所發表之論文都會收錄於 IEEE Xplore以及 Engineering Village EI Compendex database。此次本團
隊共發表三篇論文，參加學生計有一個博士班學生與四個碩士班學生，由我帶隊浩浩蕩蕩於 6/27 搭
華航班機出發，於 7/1順利完成任務返國。 
 
此次共發表三篇論文，發表之場次如下: 
1. Session: MB4-Dynamics and Motion Control 
Date:   Monday, 28 June 2010 
Time:   13:30 – 15:30 
Chairs:  Pauline Hamon and Boyang Hu 
Venue:  Room 4 
 
ZPETC Path-Tracking Gain-Scheduling Design and Real-Time 
Multi-Task Flight Simulation for the Automatic Transition of 
Tilt-Rotor Aircraft 
 
1Chih-Cheng Peng, 2Thong-Shing Hwang, 2Shiaw-Wu Chen, 
2Ching-Yi Chang, 2Yi-Ciao Lin, 2Yao-Ting Wu, 2Yi-Jing Lin, 2Wei-Ren Lai 
1 Ph.D. Program in the Graduate Institute of Electrical and Communications Engineering, Feng Chia University 
Taiwan, R.O.C. , *E-mail: peter.peng@atechsystem.com.tw
2Department of Automatic Control Engineering, Feng Chia University 
Taiwan, R.O.C., *E-mail: tshwang@ fcu.edu.tw 
Abstract—The purpose of this research is to accomplish the ZPETC (Zero Phase Error Tracking 
Control) Path-Tracking gain-scheduling control design and real-time multi-task flight simulation for 
the automatic transition of tilt-rotor aircraft. 
Firstly, we select 20 flight equilibrium points during the automatic transition through the trim 
operation. For each equilibrium state, we can get a set of Jacobian matrix A, B of the linearized 
equation by using the numerical linearization method and perform the flight control system design. 
Due to the highly instability of the system for the period of the dynamic transition maneuver, if we 
978-1-4244-6506-4/10/$26.00 ©2010 IEEE                             RAM 2010 
 Time:   16:00 – 18:00 
Chairs:  Ray Jarvis and Mehmet Guzel 
Venue:  Room 3 
 
 
Development of Intelligent Massage Manipulator and Reconstruction of 
Massage Process Path using Image Processing Technique 
 
1Chih-Cheng Peng, 2Thong-Shing Hwang, 3Chih-Jui Lin, 2Yao-Ting Wu, 2Ching-Yi Chang, 2Jian-Bin Huang 
1 Ph.D. Program in the Graduate Institute of Electrical and Communications Engineering, Feng Chia University 
Taiwan, R.O.C., *E-mail: peter.peng@atechsystem.com.tw
2Department of Automatic Control Engineering, Feng Chia University 
Taiwan, R.O.C., *E-mail: tshwang@ fcu.edu.tw 
3Graduate Institute of Electrical Engineering, National Cheng Kung University, Taiwan, R.O.C. 
Abstract—This paper develops a motor-driven massage artificial electro-mechanical manipulator 
system with intelligent biomedical sensing-monitoring capabilities and constructs the path of massage 
process by using CCD image processing technique. In this paper, we integrate a versatile inter-digital 
electrocardiograph (ECG) into the manipulator system and construct a massage path by using twin 
CCD image processing technique with inverse engineering method. So, this electro-mechanical 
manipulator can automatically do the full massage process including pushing, pick-up and kneading 
actions to get the best therapy effect. 
By capturing the variant signals of the cardiovascular physiological parameters from the 
versatile inter-digital electrocardiograph, we can understand and analyze the physiological reaction 
due to the massage action and then try further to improve the therapy effect of massage. 
In the meantime, we have imitated a real human’s palm with finger’s action to design a 
human-like mechanical palm and accomplished the actions of massage including “pushing, picking-up, 
and kneading”, the most decisive technique is lying on the design of the fingers. 
Keywords—massage manipulator, image processing, massage process, biomedical sensing 
 
本次在國科會NSC 98-2221-E-035-058的計畫經費暨逢甲大學資電學院專案核准補助經費下，前
往新加坡參加IEEE International Conference on Robotics, Automation and Mechatronics (RAM 2010)國際
研討會。  
本次會議除了本身之論文發表外，亦利用此會議與大陸、香港、新加坡以及來自世界各國之學者
探討有關機器人、自動化與機電整合之問題，使得這次學術之旅，既充實又難以忘懷。 
         
 In fact, the research and design of tilt-rotor in the United 
States of America have proceeded some years [1], in 1991, the 
technical report CR177578[3] of NASA stated the 
development of V-22. The propeller can be rotated upward or 
forward to make the thrust direction upward or forward. 
During take-off, the generated thrust of propeller upward to 
make the aircraft take-off vertically until some specified 
altitude is reached. After that, the propeller rotates gradually 
to make the aircraft flight forward with fixed wing in the 
cruise mode. 
For the time being, V-22 prototype has already been 
constructed and US Boeing Company proceeds with the 
commercial production of V-22 type aircraft [4]. Within the 
design of the mechanism, the rotational joint mechanism to 
conjunct the propeller and the wing must afford extreme large 
reaction force.  In order to secure the structure, we must raise 
the utilized standard of the material. During the mode 
interchanging of the rotary wing mode and fixed wing mode, 
the stability and control of the tilt-rotor aircraft body is very 
difficult. 
Another design idea is the M-85 design concept 
presented in the TM10287 report [5] of NASA-Ames 
Research Center in 1991. The design concept of M-85 is to 
utilize a round disk with the turbulent plate to generate the 
lifting force. Within the report, NASA proceed the wind 
tunnel test for the distribution situation of the 
round-disk-shape wing-cross-section and the round-disk with 
rotor-blade, the results show that the cruising performance of 
the round disk with rotor-blade will be able to reach or even 
exceed the other design concept as Folded Tilt Vector or 
X-wing. 
In 1998, the team directed by Professor Yang C. D. of 
Aeronautics and Astronautics Graduate Institute, National 
Cheng Kung University, developed the VTOL aircraft [7]. In 
the project, a whole new concept had been designed and 
developed, there are dual purposes for this kind of aircraft:  
rotor is used for vertical rising/descending and fixed wing is 
for high speed cruising as well. The key is the mechanism 
design of “Coaxial double layers round disk rotary wing”. 
In 1995, the project of Su-27 dynamic analysis, 
gain-scheduling design and real-time multi-task flight 
simulation is handled by Professor Hwang Thong-Shing, 
Aeronautics and Astronautics Graduate Institute, Chung-Hua 
University. In the project, the purpose is to design and simulate 
the particular Cobra behavior of SU-27 [8]. 
II. DYNAMIC MATHEMATICAL MODEL OF 
TILT-ROTOR AIRCRAFT 
Modeling aerodynamic forces is complicated due to (a) 
the interaction between the rotor downwash and the wing, 
and (b) the change in configuration with rotor tilt during the 
automatic transition.  The two nacelles are located at the 
wing tips and can be rotated through slightly more than 90 
degrees. Each nacelle accommodates an engine to drive a 
propeller. Each rotor has collective pitch control and cyclic 
pitch control in the longitudinal and the lateral directions.  
The forces acting on a tilt rotor VTOL aircraft can be 
divided into three classes: (a) gravitational, (b) aerodynamic, 
and (c) thrust. The aerodynamic forces are approximated by 
sums of forces on individual components of the aircraft. A 
simplified force diagram is shown in Fig.1. Let D be the drag 
and L the lift. The thrust and the in-plane force on the rotor 
are denoted by T and H respectively. D and L are expressed 
as the horizontal and vertical forces respectively in the flight 
path coordinate (velocity coordinate). T is perpendicular to 
the rotor tip path plane. η Is the angle between T and 
fuselage zero lift axis; γ is the flight path angle; θ is the 
pitch angle; φ is the angle between T and flight path axis. 
Fig.2 shows the longitudinal forces and moments acting 
on tilt-rotor aircraft. Here the moment equation is derived in 
body coordinate for holding constant inertia yyI of every 
computation, the purpose is to save computation time. But, 
the force equation is derived in flight path coordinate, the 
purpose is to put the drag force on the linear acceleration 
axis and the lift force on the tangential acceleration axis for 
convenient computation of flight velocity and flight angle. 
φ
θ
η
iα
γ
 
Fig.1 Tilt-rotor aircraft reference angles and forces  
Where  and  are expressed as components of 
thrust along the body x axis and z axis respectively in body 
coordinate.  and  are expressed as components of 
rotor in-plane force along the body x axis and z axis 
respectively in body coordinate. 
TxbF TzbF
HxbF HzbF
d Vm
d t
and dmV
dt
γ  are  the 
components of force along the x axis and z axis respectively 
in flight path coordinate. ：distance from the root of the 
nacelle to the center of gravity, 
2
：distance from the root of 
the nacelle to tail, ：distance from the root of the nacelle to 
hub, q : pitching angular velocity.  
1l
l
3l
3l
1l
2l
γ θ
η
Am
HzbF−
HxbF−
TzbF−
TxbF
Fig.2 Longitudinal forces and moments for tilt-rotor aircraft 
The drag and lift are expressed in the following as sums 
of forces on individual components (W ,T ,F,NAC are 
expressed as wing, tail, fuselage, and nacelle respectively): 
         
  
Fig.3 Particular selected take-off flight path  
The problem of guidance during take-off concerning 
some control variable constraints is stated as follows: 
(a) The thrust is fixed at the maximum value. 
(b) There are similar constraints on flap deflection and pitch 
angle during a portion of the take-off trajectory. 
(c) One way to use quadratic synthesis is to use less(more) 
than the maximum(minimum) values of these control 
variables during the nominal flight leaving a certain 
margin for feedback control. 
(d) Flap deflection is not rather efficient control variable. 
(e) The installed power and rotor size in a tilt-rotor VTOL 
aircraft are dictated by the take-off requirements. 
From the above constraint condition analysis of the control 
variables, it is not necessary to use four control variables 
, , , (T )fδη δθ δ δ δ to achieve the desired goal. Therefore, 
we only choose rotor shaft tilt δη and pitch angles δθ as 
feedback controls.  
Hence, the longitudinal linear dynamic equation can be 
simplified to the following expression: 
1 1
2 2
( ) ( ) ,
, ,
TO TO TO
TO
dZ F t Z G t U U
dt
g g u
G Z
g g w
η θ
η θ
Y Z
η
θ
⎡ ⎤= + = ⎢ ⎥⎣ ⎦
⎡ ⎤ ⎡ ⎤= =⎢ ⎥ ⎢ ⎥⎣ ⎦⎣ ⎦
=
                (14)
 
When Z is measurable and the quadratic synthesis method is 
used, optimal control problem can be solved by the minimum 
principle and the corresponding Hamiltonian equation formed 
as )()(
2
1),,( TOTO
T
TO
T
TO
T UGFZBUUAZZtZH +++= λλ ,
then we can get the optimal control gain as follows: 
CZRZGBU TTO =−= − 1*                                   
  (15) 
Where R is the solution of the following well-known Riccati equation:
      (16) 
ftf
T
TOTO
T RtRRGBRGARFRFR =+−−−= − )(,1&
Assume 
TO
TO
GFsIP
U
YZY 1)(, −−===                  (17) 
If we transfer the optimal gain C into the classical feedback 
control gain K(s), then 
( ) ( ) ( )P s K s CP s− =                           (18) 
Therefore, the classical unit feedback closed-loop control 
diagram can be obtained as follows: 
)(sP)(sK
 
Fig.4 Classical unit feedback closed-loop control diagram 
The closed-loop transfer function can be obtained as: 
( ) ( )( )
1 ( ) ( )
P s K sM s
P s K s
= +                          (19) 
B. Longitudinal guidance and control during landing 
The technique of the longitudinal control gain and 
guidance scheme design during landing is similar to the 
take-off case. The nominal trajectory is a straight line with a 
flight path angle of -5.7 degree/sec, to start with the rotors 
until the rotor shaft angle reaches 101 degrees. The flaps and 
the aileron-flaps are turned until they are deflected 57 degrees. 
The rotor start producing thrust when the rotor shaft angle 
exceeds 90 degrees so that a component of the thrust 
decelerates the aircraft. The aircraft trajectory is shown in 
Fig.5. 
 
Fig.5 Nominal landing trajectory 
The linearized equations also need to be simplified as in 
the case of take-off guidance with one exception. During 
take-off the rotor thrust was set at its maximum available 
value at all times. However, during landing the thrust is less 
than the maximum value and can be used as a control variable. 
We use rotor shaft tilt angle and rotor thrust as two control 
variables. The simplified and linearized equations are  
1 1
2 2
( ) ( )   ,  
  ,    ,   
L L L
L
dZ F t Z G t U U
Tdt
g g u
G Z
g g w
η θ
η θ
η⎡ ⎤= + = ⎢ ⎥⎣ ⎦
⎡ ⎤ ⎡ ⎤
Y Z= = =⎢ ⎥ ⎢ ⎥⎣ ⎦⎣ ⎦
              (20) 
As same as take-off, we can get the optimal control gain C. 
 
V. DYNAMIC ANALYSIS AND CONTROL DESIGN 
OF AUTOMATICAL TRANSITION FOR TILT-ROTOR VTOL 
AIRCRAFT 
A. Dynamic analysis and control design 
VTOL tilt-rotor aircraft design need consider the relation 
between aerodynamic variation of VTOL transition state and 
control stability problem. Therefore, it is necessary to propose 
a special guidance control mechanism to analyze, design, 
simulate, and validate the abrupt varying situation in the 
VTOL transition state. Also, we need investigate the force and 
moment on the mechanism to select the appropriate material. 
Therefore, we propose a hybrid methodology including 
optimal control, ZPETC and gain scheduling method to 
complete the guidance and control of VTOL transition period. 
 
VI. ZERO PHASE ERROR TRACKING CONTROL  
In the control loop, if feed forward controller design is 
the reciprocal of the system transfer function , )(sM
         
 and actuator 
Task2 6-DOF dynamic equation computation 2 32Hz 
Task3 Indication of real time state variables 3 32Hz 
Task4 Indication of the operating system parameters 4 16Hz 
Task 
t CPU spare time calculation 5 8Hz 
Taskb Demonstration of flight dynamic behavior 6 8Hz 
The current planned and established task-scheduling is 
implemented in the prearranged scheduling table as above 
Table 1, there are 4 kinds of task with frequencies 64Hz, 32Hz, 
32Hz, 16Hz. 
In the following procedures, we can see how to decide 
the priority and time base of all tasks: 
 1. Execute task establishment (Task-create), task scheduling 
arrangement (Task-exec), and task stop to sleep 
(Task-suspend). Finally the program starts to run by the 
main procedure (usermain). 
2.  While executing the main program loop, first to pause and 
wait the interrupt event (EVENT-wait) until the interrupt 
signal appears , and then to read the scheduling table and 
execute the related jobs in sequence. 
3.  Execute the computation of the control law and actuator 
in Task 1. 
4.  Execute the calculation of the air dynamic coefficients 
and the longitudinal dynamic response in Task 2. 
5. Select the screen to display for the purpose of analysis 
The program of this project is written by MSC 
(Microsoft C), main program is the mainframe and soul of 
whole real time simulation. Task 1 and Task 2 can be replaced 
by the air dynamics and dynamic equation of IDF、F-16、
SU-27, or helicopter at any time, corresponding with suitable 
interrupt frequency and schedule table to simulate different 
system.  
C. Real Time Dynamic response Simulation and Analysis 
Regarding the real time simulation, due to the special 
aerodynamic characteristics of tilt-rotator aircraft, we need 
tune PID control gains to simulate the motion of each 
different stage such as Hover, Transition, and Cruise. As for 
the dynamic response analysis, before the action of maneuver, 
we need trim the airplane to steady-state of level flight and 
utilize the numerical linearization method to find the 
linearized state equation of all points regarding the transition 
between vertical rise/descend and forward flying of the 
tilt-rotor aircraft to analyze their performance and then 
perform optimal control and ZPETC tracking control design. 
 
Fig.8 State variables display of real-time flight simulation 
 
 
Fig.9 Animation display of the dynamic behavior for vertical 
rising and descending 
 
VIII. CONCLUSION 
Through the computation of derived dynamic equations 
(force ad torque equations), we adjust the control factors to 
get the state variables of the non-linear dynamic equations, 
flight trajectory (include take-off and landing) and dynamic 
behaviors. By the ZPETC tracking control algorithm, we can 
adjust control force to reach the motion contour of rising and 
descending. Before analysis and design of the control 
algorithm for the motion contour tracking, we linearize the 
non-linear system by the numerical linearization method. And 
utilize the Matlab to complete the optimized control law 
design and transfer the optimized control gains to control 
compensator at the same time in order for feed-forward 
controller or intelligent controller design. 
Finally, we setup the real-time multi-task flight 
simulation system to simulate and validate the system 
dynamic behavior of the tilt-rotor aircraft. 
 
IX. ACKNOWLEDGEMENT 
This research was sponsored by Chung-Shan Institute of 
Science & Technology, Taiwan, R.O.C. under the grant 
XW98132 P073 PE. 
X. REFERENCES 
[1] Narendra Kumar Cupta, Part I: Automatic Transitions of 
a Tilt-Rotor Aircraft, Dissertation of Ph. D. in Stanford 
University, December 1973.. 
[2] Georgie, J., and Valasek, J., “Evaluation of Longitudinal 
Desired Dynamics for Dynamic-Inversion Controlled 
Generic Reentry Vehicles,” Journal of Guidance , 
Control , and Dynamics, Vol. 26, No. 5, pp. 811-819, 
2003. 
[3] Rutherford, O'Rourke, Martin, Lovenguth, and Mitchell, 
“Technology Needs for High-Speed Rotorcraft,” NASA 
CR177578 , Apr.1991. 
         
 Real-time Simulation of a 3-leg 6-DOF Parallel Manipulator  
Based on RT-Linux Operation System 
1Chih-Cheng Peng, 2Thong-Shing Hwang, 2Ching-Yi Chang, 2Yao-Ting Wu, 2Sang-Hugh Wu 
1 Ph.D. Program in the Graduate Institute of Electrical and Communications Engineering, Feng Chia University 
Taiwan, R.O.C. , *E-mail: peter.peng@atechsystem.com.tw
2Department of Automatic Control Engineering, Feng Chia University 
Abstract—The real-time multi-task simulation of a 3-leg 
6-DOF high performance platform system based on RT-Linux 
operation system is presented in this paper. The new architecture 
is setup by three extensible legs sliding on three linear slide-rail 
each actuated by a synchronous linear servo motor. The 
extensible legs are actuated by inductive AC servo motors. In the 
meantime, the inverse and forward kinematical equations 
describing the motion of the platform system are derived. This 
kind of architecture using the hybrid (linear and AC) motors 
yields high performance of motions, especially in speed and 
working space. The novel result of maximal working angles is the 
significant contribution of this architecture. 
 The platform system is operated in the RT-Linux real-time 
multi-task executive environment, which is superior to windows, 
including: (a) RT-Linux real-time is hard real-time, (b) 
RT-Linux real-time operation system is free, (c) Multi-task can 
be scheduled by the optimum preemptive static scheduling 
algorithm. We have demonstrated the dynamic behavior of 
platform in the RT-Linux window and the OpenGL 3D/VR 
multi-medium. 
Keywords—RT-Linux, parallel manipulator, real-time 
multi-task simulation, linear servo motor 
XI.  INTRODUCTION  
HE  Stewart platform is a 
six-degree-of-freedom (6-DOF) mechanism with two 
platforms connected together by six extensible legs. This 
manipulation structure is obtained from generalization of the 
mechanism originally proposed by Stewart [1-2] as a flight 
simulator. There are many research topics concerning the 
related mechanical structure, including its construction, 
singularity and working space determination, forward and 
inverse kinematical problem solution, dynamic forces 
computation, motion control, and practical applications [3-8]. 
Up to now, there has been little research concerning 
multiple DOF parallel manipulators actuated by the hybrid 
(including linear and AC) motors. Linear motors possess 
many advantages, such as direct driving, high position control 
accuracy, high speed, high acceleration, wide bandwidth and 
easy to control (due to less nonlinearity). These features 
strengthen the dynamic performance and simplify the control 
design task. In this paper, the base platform of this 
architecture has three linear slide-rail each actuated by a linear 
motor. On each forcer (translator) of the linear motors, there is 
a link with extensible length jointing the upper (moving) 
platform and the forcer. Forward and inverse kinematical 
equations have been derived and validated. This kind of 
platform has also been experimentally setup in our laboratory.  
This kind of new special architecture using the hybrid 
motors yields high performance of motions, especially in speed 
and working space. Since the presented manipulator 
mechanism is different from the conventional ones, the 
working angle is proved to be very large. The novel result of 
the maximal working angle is the significant contribution of 
this paper. We have accomplished the hard real-time multi-task 
simulation after building the 3-leg 6-DOF hybrid motors 
driven platform system. We also have constructed a 3D/VR 
OpenGL graphic user interface embedded in the monitor under 
RT-Linux real-time operation system. The program design can 
be divided into several parts: (1) 3-leg platform kinematical 
equation computation, (2) Real-time multi-task operating 
system design, (3) RT-Linux processes communication 
between foreground and background processes, (4) 3D/VR 
OpenGL multi-medium display. 
XII. PLATFORM SYSTEM DESIGN 
A. New architecture 
The new architecture as shown in Fig.1 is constructed by 
three extensible legs sliding on three linear slide-rail each 
actuated by a synchronous linear servo motor. The extensible 
legs are actuated by inductive AC servo motors.  
B. Degree of freedom analysis 
Based on the Grubler criterion, the degree-of-freedom value 
of a mechanism can be calculated as follows: 
                                 
(1) 
( ) ∑g i
i= 1
M = d n - g - 1 + f
Where g is the number of joints in a mechanism, d = 6 for 
spatial mechanisms, n: number of links in a mechanism, 
：degrees of relative motion permitted by joint i. So, the 
degree-of-freedom value of the above 3-leg 6-DOF parallel 
if
Taiwan, R.O.C., *E-mail: tshwang@ fcu.edu.tw
T 
         
 Combining (5) and (6), ixB  can be solved for all motor 
translators: 
( ) ( )(
( ) ( )
)bix aix ix iy biy aiy
ix
bix aix biy aiy
B - B P + P - C B - BB = B - B + A B - B
        
   (6) 
Where ( )( )biy aiybix aix
B - BA = B - B
, bix aiy biy aix
bix aix
B B - B BC = B - B
 
Equation (6) ensures that all ixB  are within the slide-rail 
of the linear motor. By the same way, can also be 
determined.  
iyB
C. Forward kinematics 
The forward kinematics is to calculate the position and 
attitude of the moving platform for the given iB and . The 
forward kinematics problem is required to solve the solution 
of non-linear equations and this usually leads to multiple 
solutions. In order to obtain a fast and reliable solution to the 
forward kinematics, Newton-Difference numerical method is 
adopted. 
il
Using the constraint equations of the links, we have 
2 0il= − =i 1Φ Ti i i i( P - B ) ( P - B ) 1,2,3
i 2
, i =        
(7) 
0= ⋅ =Φ Tk k k( P - B ) d = 4 ,5 ,6 , k = i - 3 , i       
  (8) 
Where  is the vector of the slide-rail for the linear motor, kd
| |i il = L . 
Differentiating (7) and (8) with respect to time t gives 
= = 0
t
∂
∂
& &Φ X qΦ X + Φ q 11 21 31 42 52 62[Φ ,Φ ,Φ ,Φ ,Φ ,Φ ]
ω ω ⎤⎦
,Φ =       
 (9) 
Where , 
. Using 
T
px py pz= = x y zϑ ω⎡ ⎤ ⎡⎡ ⎤⎣ ⎦ ⎣⎣ ⎦&& & & & & &X
T
pp = p ω
Tlllddd ],,,,,[ 321321=q
( )∂∂ & & &pi1 v
Φ = 2 + T Ti i ip T m - B p = 2Lp
= 1,2,3, i         
 (10) 
( )
∂
⋅∂
∂&
i 2Φ
T
Tv k k k
k
T + m - B d
p = p = p
p p d& &
 , 
       (11) i = 4,5,6, k = i - 3
( ) ( ) ( )ω ω∂ × ×∂ & T T Tp Pi i p i i i i p= 2 R P L = 2 R P L = 2 m Lϑ pωi1Φ , 
        (12) i = 1,2,3
p
T
kkk
T
k
p
p
k
T
kk
p
v
p ω)d(md)PR(ω
d)BPRT
ω ×==∂
−+∂=∂
∂ &ϑϑ
(Φi2 ,    
,    (13) 
         
i = 4,5,6 k = i - 3
Where , Pi im = R P i v i
1 1 1 1 1
2 2 2 2 2
3 3 3 3 3
1 1 1
2 2 2
3 3 3
{2 ( )} {2 ( )}
{2 ( )} {2 ( )}
{2 ( )} {2 ( )}
( )
( )
( )
T T
T T
T T
T T
T T
T T
⎡ ⎤+ − × + −⎢ ⎥+ − × + −⎢ ⎥⎢ ⎥+ − × + −= ⎢ ⎥×⎢ ⎥⎢ ⎥×⎢ ⎥×⎢ ⎥⎣ ⎦
XΦ
v v
v v
v v
T m B m T m B
T m B m T m B
T m B m T m B
d m d
d m d
d m d
 
(14) 
Equations (7) and (8) can be expanded as 
∂
∂ L( )
ΦΦ X + Δ XX + = 0
        
(15) 
Ignoring the high-order terms, the above equation can be 
expressed 
- 1
XΔ = - ( )X Φ Φ         
(16) 
With XΦ defined by (14). The Newton-Difference numerical 
method solving for X  can then be performed by using this 
equation. 
 
XIV. BUILDUP OF RT-LINUX REAL-TIME MULTI-TASK 
SIMULATION SYSTEM 
A. Advantages of RT-Linux 
We design the simulation program of real-time control 
according to the 3-leg 6-DOF platform. Based on the 
definition of hard real-time, Windows NT cannot achieve the 
hard real-time response due to using the technology of 
message-queue and event-driven, Windows NT will result in 
time latency and uncertainty. To solve this problem, we select 
the RT-Linux as the real-time simulation platform. 
B. Communication between processes 
The RT-Linux application is divided into two parts, 
real-time domain and non-real-time domain. The real-time 
domain program simply provided limited resources can’t be 
satisfied in the complex case. It can’t use general function 
library such as lib. The non-real-time domain program can use 
all the resource provided by the Linux. 
    The major functions of real-time task are: The function 
pthread_create() is used to create a new job, and set the size of 
stack and priority. The function pthread_make_periodic_np() 
is used to setup the task period and start time. The function 
pthread_wait_np () will stop all running real-time task until 
next period. The key point of communication between 
real-time task and Linux process is FIFO. We use the function 
rtf_create() to create FIFO, and then use the function rtf_put() 
to put data into FIFO. The FIFO is treated as a file in Linux, 
we can use open() and read() to open and read it. 
iL = T + m - B ,  is the 
angular rate of the platform. 
pω
XΦ can be expressed as  
         
 Secondly, the program goes into an endless loop and call the 
pthread_wait_np() function to wait. When the Linux process 
writes command into FIFO to wake up the interrupt 
processing program, the interrupt processing program will call 
the pthread_wait_np() to wake up the task, and then set the 
related task data from FIFO. Any time the Linux process will 
check if the FIFO has been written, when it has been written 
the program will execute the specific function. 
D. Multimedia  
Although Glade can build the major GUI framework of 
our application, but it is still developing, so it has restriction in 
some parts. Therefore, there is some problems in OpenGL 
graphics display on X windows. The first question is Glade 
doesn’t provide the OpenGL drawing area component. In fact, 
a weight-bearing point is that GTK doesn’t have OpenGL 
drawing area component. Since GTK doesn’t support 
OpenGL drawing, we need to install some library which 
supports the OpenGL drawing. Here we choose the Mesa 3D 
library, its syntax is almost the same as OpenGL besides some 
special functions. After we install the Mesa 3D library, we can 
manipulate the OpenGL drawing. 
Also we face a new problem to put the OpenGL graphics 
into the GTK windows together with the state data. Because 
there is no OpenGL drawing area component, so we can’t 
display the OpenGL graphics in GTK windows. In order to 
solve this program, we need to install GtkGLArea to make it, 
GtkGLArea provides the OpenGL drawing area component in 
GTK windows for us. However, the OpenGL drawing area 
component provided by GtkGLArea doesn’t combine with 
Glade, so we can’t build our GUI by Glade alone, we must 
modify the source codes produced by Glade and add the 
GtkGLArea component to draw OpenGL graphics. 
Write Ctl_FIFO
& set Task_period
Start_taskStop_task
While(1)
RenderShowInput Path-> Inverse Kinematics
2 real-time task &
ctl_fifo handler created
ctl_fifo handler
(my_handler();)
While(1)
pthread_wait_np();
pthread_wakeup_np();
Start taskStop task
pthread_make_periodic_np();pthread_suspend_np();
break(); rtf_put();
pthread_wait_np();
Yes
Yes Yes
Start next period
Linux ProcessKernel Module (real-time process)
check ctl_fifo if set?
check FIFO 1
if set ?
check FIFO 2
if set ?
Initial Initial
Fig.5 Communication between RTLinux and Linux 
  process 
 
Fig.6 3D graphical illustration of the hybrid motors driven 
platform 
E. Build OpenGL Drawing Area and Graphics into GTK 
Windows  
The normal GTK doesn’t support OpenGL, so we need 
to install some library to support it. Some steps for building 
OpenGL drawing area in GTK windows are introduced as 
follows： 
(A) Create a GtkGLArea component: 
           GtkWidget *glarea; 
   glarea = GTK_WIDGET(gtk_gl_area_new(attrlist)); 
Where the attrlist is a matrix used to setup some attributes. 
(B) Setup the event processing function: 
We need to set the event which is linked to GtkGLArea 
component. For example, the following function links the 
GtkGLArea with the configure_event. When the windows size 
changes, it will send out configure_event, and then our 
program will execute the event processing function. 
(C) Add the OpenGL drawing area into GTK windows: 
We add the GtkGLArea into GTK windows when all the 
events and processing functions have been set. 
gtk_container_add(GTK_CONTAINER(window),GTK_WID
GET(glarea)); Where the window is the target window. 
(D) Display drawing area: 
After the GTK window has been displayed, we can call the 
following function to show up the GtkGLArea drawing area: 
    gtk_widget_show(GTK_WIDGET(glarea)); 
Thanks that the OpenGL is a cross-platform software, so 
the syntax in Linux is almost the same as windows. The major 
different is: 
(A) make_current function:   For Linux syntax, we have 
gtk_gl_area_make_current(GTK_GL_AREA(widget)) 
 (B) Refresh function: 
Linux syntax:  gtk_widget_draw(widget,NULL); 
F. RT-Linux Real-time Program Design  
Because RT-Linux treats real-time task as module, it can’t 
use main() function in the program. The major parts of the 
program consist of init_module(), thread_code(), and other 
related interrupt processing functions: 
1. init_module()：Initialize the modules.  
Int init_module(void) 
         
  ACKNOWLEDGEMENT 
 This research was sponsored by National Science Council, 
Taiwan, R.O.C. under the grant NSC 98-2221-E-035-058.  
  
 REFERENCES 
 [1] D. Stewart, A platform with six degrees-of-freedom, 
Proc Inst Mech Eng 180(Pt 1, 5), 965, 371-386.  
 [2] E.F. Fichtert, A Stewart platform-based manipulator: 
general theory and practical construction, International 
Journal of Robotics Res 5(2), 1986, 157-182. 
 
 
 [3] J.P. Merlet, Trajectory verification in the workspace for 
parallel manipulators, J Robotic Syst 13, 1994, 326-333.   
 [4] L.C. Lin and M.U. Tsay, Modeling and control of 
micropositioning systems using Stewart platforms, J 
Robotic Syst 17(1), 2000, 17-52. 
 
 
 [5] Z. Ji, Workspace analysis of Stewart platform via vertex 
space, J Robotic Syst 13, 1994, 631-639.  
 [6] Z. Hao and W. Qiyi, The kinematics and workspace 
analyses of a parallel manipulator for manufacturing, 
Proc IEEE Int Conf Industrial Technology, 1996, pp. 
647-650. 
 
 
 
 [7] C.M. Luh, Working capability analysis of Stewart 
platforms, ASME J Mech Design 118, 1996, 220-227.  
 [8] M. K. Lee and K. W. Park, Kinematic and dynamic 
analysis of a double parallel manipulator for enlarging 
workspace and avoiding singularities, IEEE Trans 
Robotics Automat 16, 1999, 1024-1034. 
 
 
 
  
  
  
  
  
  
  
  
  
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
         
 recognition and positioning to identify the massage behavior. 
At the same time, we can deeply understand and analyze the 
massage physiological reaction and response to improve the 
therapy effect by using the signal variation of the 
cardiovascular physiological parameters from the versatile 
inter-digital electrocardiograph. 
XIX. MOTOR-DRIVEN MASSAGE ARTIFICIAL 
ELECTRO-MECHANICAL MANIPULATOR SYSTEM 
We divide the motor-driven electro-mechanical massage 
manipulator system into two main parts: 1st part is the 
manipulator system with 5-DOF electro-mechanical 
manipulator platform as a base to integrate with the connecting 
human-like mechanical palm and then be able to reach the 
three-dimensional space range of massage onto the patients. 
The finger tips can approach and reach any massage starting 
location, the palm posture possesses three freedom variations 
by rotating the wrist joint, the flexible pressure sensor on hand 
is used to real-time monitor the massage force during the 
therapy onto the patients, and the vibrating massage effect can 
be enhanced on hand by applying the micro vibrating motor. 
The other main part is the physiology signal monitoring 
system which can process the measurement, recording, and 
analysis at the same time while the electro-mechanical 
massage manipulator is doing the rehabilitation treatment. 
A. 5-DOF Electro-Mechanical Manipulator Design 
In order to enable the electro-mechanical massage 
manipulator to process the massage in three-dimensional space 
with no restriction, we design the platform to be a 5-DOF 
electro-mechanical manipulator. The design about the length 
of the manipulator is to consider real human body as reference. 
The whole mechanical structure designed by circular or 
rectangular thin pipe with aluminum alloy is to reduce the 
weight of the mechanism but to support necessary mechanical 
stiffness and effective cost of materials. We use Solid Works 
software to design the 3D drawing as shown in Fig1. 
 
Fig.1 5-DOF manipulator top, side and vertical views 
(A)Kinematical Analysis of the Manipulator 
We are going to study both the kinematics and dynamics of 
the manipulator. While the speed of the motion is not high 
enough to raise the effect of the dynamics, we can only 
consider the kinematics. As long as we want to demonstrate 
high speed motion, we then must consider the dynamical 
behavior to be able to describe the complete situation of the 
motion of the mechanism. 
In order to analyze the motion of the manipulator, we 
need to make some definition for the manipulator. While 
designing the manipulator for three dimensional motion, it 
requires 5 degree-of-freedom as illustrated in Fig.1.   
After the mechanism has been confirmed, then to define 
the environment of the manipulator as follows: 
The kinematics of the manipulator includes forward 
kinematics and inverse kinematics. The forward kinematics is 
to get the relative motion results of the end-effecter in the 
Cartesian coordinate from the base coordinate and the 
rotational motion of each joint of the manipulator. The inverse 
kinematics is to get the relative motion of each joint of the 
manipulator from the given base coordinate ant the Cartesian 
coordinate of the end-effecter. 
The coordinate transfer matrix we use here to derive the 
kinematics is based on the homogeneous transformation 
matrix, and the Denavit-Hartenberg homogeneous 
transformation matrix is used to derive the forward and inverse 
kinematics of the manipulator. 
Based on D-H method, we transfer the i-1th coordinate to  
ith coordinate, the transformation matrix can be derived 
from the multiplication of  transformation matrices as  
i
i A1−
44×
),(),(),(),(1 αθ xTaxTzTdzTAii =−         
(1) 
To substitute the 44×  matrices into equation, we can 
get 
⎥⎥
⎥⎥
⎦
⎤
⎢⎢
⎢⎢
⎣
⎡
−
−
=−
1000
0
1
iii
iiiiiii
iiiiiii
i
i
dcs
sacsccs
cassscc
A αα
θθαθαθ
θθαθαθ
        
(2) 
Above matrix is the transfer matrix of D-H coordinate 
transformation method. 
(B)Dynamics analysis of the manipulator  
The dynamics of the manipulator also includes forward 
dynamics and inverse dynamics as introduced as follows: 
Forward dynamics: Given the applied torque of each joint 
to get the dynamic behavior and then to derive the motion 
trajectory of the manipulator. 
Inverse dynamics: Given a plan-scheduled motion 
trajectory of the manipulator to get the dynamic behavior of 
each joint and then to derive the force and torque of each joint. 
We apply the method of Newton-Euler to derive the 
dynamic equation of the manipulator. The Newton-Euler 
method is constructed by Newton equation and Euler equation 
described separately as following: 
Newton equation: The force equation can be obtained as 
follows: 
     cc vmmaf &==         
(3) 
Euler Equation: The torque equation also can be derived 
in the following: 
      ( )ωωω CCCCC IIn ×+= &         
(4) 
         
 Part xxI  yyI  zzI  
Base (Disk) 2940 2940 5880 
Upper Arm 7627.5 32130 25098.75 
Lower Arm 5791.875 36770.83 31687.71 
Wrist 395.83 1136.67 1074.17 
(C) Implementation of kinematics for the massage manipulator 
The following is the implementation of the massage 
electro-mechanical manipulator. Please refer to the following 
figure as the real implementation of the manipulator: 
 
Fig.3 Photo of the manipulator 
x 0
y 0
z 0
x 1z 1
y 1
z 2
y 2
x 2 z 3 x 3
y 3
y 4
x 4
z 4
x 5
y 5
z 5
5 c m
3 c m
1 8 c m
1 5 c m
2 0 c m
4 c m
T 
Fig.4 5-DOF coordinates of manipulator  
The above figure is designed based on the Solid Works to 
show the size and the space coordinates. 
We consider the required working space and the “pushing, 
pick-up, and kneading” actions for the massage process, and 
then design a massage electro-mechanical manipulator with 5- 
DOF within the 3D space to realize the desired massage 
therapy with the planning trajectories.  
 
According to D-H method, we can obtain all joint 
parameters as shown in Table 2. 
Table 2 Parameters of each joint 
joint i 
iθ  iα  ia  id  
1 
1θ  90° 3 5 
2 
2θ  0° 18 0 
3 
3θ  0° 20 0 
4 
4θ  –90° –4 0 
5 
5θ  0° 0 15 
From the D-H table, the homogeneous transformation 
matrices  can be obtained.  5~1,1 =− iAii
From the definition of the forward kinematical 
computation, if we substitute the angle of joints  
),,,,( 54321 θθθθθ  into the transformation matrices, then the 
position and orientation of the end-effecter expressed in the 
base coordinate system can be calculated. 
After completing the calculation of the forward kinematics, 
we continue to calculate the inverse kinematics. We use the 
traditional calculation method which can be applied into most 
of the manipulators. During the calculation process, we need 
to assume the position and orientation of the end-effecter with 
respect to the base coordinate to be known already as follows: 
T0 5 =
⎡ ⎤⎢ ⎥⎢ ⎥⎢ ⎥⎢ ⎥⎢ ⎥⎣ ⎦
x x x x
y y y y
z z z z
n o a p
n o a p
o a pn
0 0 0 1
        
(21) 
Using the homogeneous transformation 
matrices , we compare each element of these 2 
matrices to solve the inverse motion equation and get the 
solution of the angles at each joint. Thus 
5~1,1 =− iAii
T A A A A A0 0 1 2 3 45 1 2 3 4= 5
-1
        
(22) 
Due to the elements of the 4th row of the 2 matrices to be 0, 0, 
0, 1，according to equation (22), we can list the other 12 
equivalent equations to find the solution of the inverse 
kinematical equation. Observe the 12 equations, it is not easy 
to find the suitable equivalent equation to get the solution, 
therefore we multiply  on both sides of equation (22) 
to get the following equation: 
0
1( A )
  ( )-10 0 1 2 3 41 5 2 3 4A T A A A A= 5
5
5
5
5
5
5
        
(23) 
Compare the elements of the 2 transformation matrices 
by equation (23), we can list 12 equivalent equations as 
follows: 
( )1 1 2 3 4cosθ + sinθ = cos θ +θ +θ cosθx yn n        
(24) 
( )2 3 4= sin θ +θ +θ cosθzn         
(25) 
1 1sinθ cosθ = sinθ- -x yn n         
(26) 
( )1 1 2 3 4cosθ + sinθ = cos θ +θ +θ sinθ-x yo o        
(27) 
( )2 3 4= sin θ +θ +θ sinθ-zo         
(28) 
1 1sinθ cosθ = cosθ- -x yo o         
(29) 
( )1 1 2 3 4cosθ + sinθ = sin θ +θ +θ-x ya a         
(30) 
         
  
Fig.8 3D/VR design diagram of massage hand system 
XXI. EXPERIMENTS 
A. Manipulator motion trajectory control and monitoring 
(A) Software control interface screen 
The motor controller chosen to control the 
electro-mechanical massage manipulator is “LTSV10KIT03” 
developed by the company “LATTEBOX”. The controller can 
control 10 axes servomotors at the same time through the USB 
interface communication with main PC. We use the API 
interface tool to establish the motor control interface to 
process the require motion of each axis in order to accomplish 
the massage motion. 
(B) Pressure sensor monitoring interface 
Here, we use the flexible pressure sensor “FlexiForce 
Sensor” to capture the pressure signal, convert to digital signal 
with ADC0804, do signal processing in microcontroller 8051, 
transfer the pressure signal to personal computer through 
RS232 serial interface, and then monitor the pressure signal on 
PC man-machine interface. 
 (C) Manipulator motion trajectory control interface 
For our current prototype system, the massage motion 
trajectory need to be setup by using CCD acupuncture-point 
recognition and positioning procedure in the above section in 
advanced, this motion trajectory with the characteristic image 
data (feature points) captured by the dual CCD camera sets 
and processed on PC to get the joint angles of the massage 
manipulator through the inverse kinematics computation. 
Using the computed joint angles, the manipulator moves all 
axes to reach the recognized position of each 
acupuncture-point and then accomplish the massage therapy 
process. 
(D) Physiology signal monitoring interface 
For monitoring the physiology signal of massage, we use 
“NOVA 5000” physiology signal measurement platforms. This 
platform matches with built-in “MultiLab” operational system 
software, can measure at the same time with 4 kinds of sensors, 
and process the statistics analysis such as covariance etc.. 
B. CCD acupuncture-point recognition and positioning 
       Based on the above described procedure of 
acupuncture point recognition and positioning, we can search 
the feature point of acupuncture from the shoulder to waist on 
the back side of body and calculate the coordinate position by 
using CCD image processing technique and camera model 
which describes the physical process from scene plane to 
image plane. 
       The experimental result has demonstrated the 
acupuncture points can be recognized and coordinated 
automatically by CCD image processing technique as shown 
in Fig.10. 
 
Fig,10 Acupuncture-point recognition and positioning 
C. Physiology signal analysis of massage therapy treatment 
A candidate was selected as follows: sex: male, age: 24 
years old, height: 177 cm, weight: 74 kg. We process 500 sec 
physiology data collection for the heart beat rate, ECG, 
breathing rate, human body temperature as reference data 
before the start of massage action and during the massage 
action on acupuncture locations. The collected data and related 
statistic data analysis comparison sheet shown in TABLE 3. 
TABLE 3 
The statistic data analysis comparison sheet  
 control  Experiment 
Average  67.17 63.3 
standard error  8.05 8.6 
Measurement 
velocity  
10 sample 
/sec  
10 sample 
/sec  
H
eart R
ate  sample amounts  5000 5000 
Average  12.2 9.74 
standard error  26.6 57.89 
Measurement 
velocity  
10 sample 
/sec  
10 sample 
/sec  
V
ital 
C
apacity
sample amounts  5000 5000 
We compare the experimental results for the data before 
and during the massage action, we find that the heartbeat rate 
during massage is reduced to 63.3/sec compare to the original 
67.17/sec before the massage action. But there are no obvious 
differences for other sensors. From the experimental result of 
heartbeat rate shows that the massage action tends to cause 
human being to be relatively peaceful during massage process. 
XXII. CONCLUSION 
The current society already tend to be the aging society, 
many elders are suffering the regression and pains of body 
after long-accumulated job loadings. Therefore human being 
often requires rehabilitation related physiotherapy to recover 
the health, and the artificial massage therapy by the 
physiotherapist is recognized as effective therapy already in 
the medical field. 
The reason why we propose the idea of a motor-driven 
electro-mechanical massage manipulator is to provide the best 
assistance to the physiotherapists to accomplish the same or 
even better massage rehabilitation effects for human beings. In 
this research, we have accomplished the following major tasks: 
         
無研發成果推廣資料 
權利金 0 0 100% 千元  
碩士生 0 0 100%  
博士生 0 0 100%  
博士後研究員 0 0 100%  
參與計畫人力 
（外國籍） 
專任助理 0 0 100% 
人次 
 
其他成果 
(無法以量化表達之成
果如辦理學術活動、獲
得獎項、重要國際合
作、研究成果國際影響
力及其他協助產業技
術發展之具體效益事
項等，請以文字敘述填
列。) 
協助柏煇科技研製"即時視訊人型特徵點辨認系統處理平台"。 
 成果項目 量化 名稱或內容性質簡述 
測驗工具(含質性與量性) 0  
課程/模組 0  
電腦及網路系統或工具 0  
教材 0  
舉辦之活動/競賽 0  
研討會/工作坊 0  
電子報、網站 0  
科 
教 
處 
計 
畫 
加 
填 
項 
目 計畫成果推廣之參與（閱聽）人數 0  
國科會補助專題研究計畫成果報告自評表 
請就研究內容與原計畫相符程度、達成預期目標情況、研究成果之學術或應用價
值（簡要敘述成果所代表之意義、價值、影響或進一步發展之可能性）、是否適
合在學術期刊發表或申請專利、主要發現或其他有關價值等，作一綜合評估。
1. 請就研究內容與原計畫相符程度、達成預期目標情況作一綜合評估 
■達成目標 
□未達成目標（請說明，以 100字為限） 
□實驗失敗 
□因故實驗中斷 
□其他原因 
說明： 
2. 研究成果在學術期刊發表或申請專利等情形： 
論文：□已發表 □未發表之文稿 ■撰寫中 □無 
專利：□已獲得 □申請中 ■無 
技轉：■已技轉 □洽談中 □無 
其他：（以 100字為限） 
(1)即時建構仿真雙足機器人之步行軌跡，此部份已技轉給柏煇科技(2)頭部姿態角度之即
時量測，此部份由在職碩專班林皇億同學完成碩士論文(3)應用模糊推論於人臉辨識與命格分
析，此部份已投稿 SCI 期刊。 
3. 請依學術成就、技術創新、社會影響等方面，評估研究成果之學術或應用價
值（簡要敘述成果所代表之意義、價值、影響或進一步發展之可能性）（以
500字為限） 
本計畫之建構，其技術將可擴散至以下各類型機器人以及各種應用場合中： 
(A) 將此辨識系統移植至智慧型機器人兩眼視覺系統中。可進一步實現超視覺機器人之建
構，應用於服務型娛樂型工業型機器人場合中。 
(B)利用人臉辨識功能，將之應用於門禁管制上。當行人接近時，即可經由人臉之定位定
姿態技術，進行座標轉換與影像處理，完成樣板比對與辨識工作。 
(C)談判會議人員進場之辨認。當對方談判人員進場時，利用人臉辨識與命格分析功能，
可運用於對方談判人員之辨認以及性格之了解。 
(D)3D/VR 仿真雙足機器人動作行為之建構。 
(E)大量縮小遠端即時視訊傳輸量。僅傳輸代表人身與人臉特徵點，人模及人臉樣板在遠
端已建構妥當，人身特徵點用於人模動作行為之建構與展現，人臉特徵點用於人臉模型樣
板之辨識與變臉。 
 
