摘要 
排程問題的共同的特性是其限制條件與所擁有的資源不相同，如何在有限的資源與限
制條件下，找出最佳的配置方案是一個重要問題。在排程過程中，因為各個利害關係人的
利益衝突與限制，常因無法找出令各方滿意的解決方案而必須進行繁瑣的協商或退讓程
序。過去許多獻研究中，已嘗試運用多代理人處理排程的協商問題。本研究中，運用多代
理人協商溝通機制於排課問題，將教師的排課過程，以多代理人自動化協商完成。針對教
師所開的課程及教師喜好，在有限資源及課程限制下，找出所有代理人滿意度最適當的提
案。最後製作一個多代理人自動協商雛形系統，並比較不同排課方法的功能與效能。 
關鍵詞：智慧型代理人、辯證協商、排課系統 
1. 前言 
有關排程問題，必須在限制條件與有限的資源下，找出好的配置方案；因此常會發生
成員為了爭取資源而發生意見不合或衝突。為了解決這些問題，互相合作達成共同目標，
必須對這些衝突原因進行協調，達到共識。許多研究希望透過協商機制來協調資源分配問
題。由於代理人具有知識智能與溝通協調的機制，能根據本身的目標來計畫行動，讓相互
有衝突的代理人在一個共同目標下，合作協商達成資源分配的共識[5][6]。根據許多學者研
究顯示，排課問題是尚未定論多項式困難的問題(NP-hard)[3]，因此沒有很好的解決方法，
難以在有限時間找出最佳解。有學者採用基因演算法、模糊邏輯、多準則決策等[2][9][10]，
亦只能找到近似最佳解。近年來許多學者嘗試使用代理人技術處理這個問題[1][4][12]。在
本研究論文中，我們使用代理人自動化協商的方式來處理。各老師的代理人在協商過程中，
會以所代表的老師最大利益為任務。事實上不可能大家都可排到自己最想要的時間，有可
能且容易發生衝突。在本研究中，希望將多代理人自動化協商的方法應用到排課系統中，
使代理人能透過自動化協商中選擇更符合其他代理人目標需求的提案，以加速代理人間的
共識。論文結構為第二節提出多代理人自動協商架構與多代理人自動協商流程。第三節設
計代理人自動協商雛形系統，並以簡單排課實例說明我們提出的方法。 
2. 自動協商架構 
代理人針對使用者喜好應用模糊理論塑模代理人信念，遵循協商流程根據信念評估以
選取協商提案。我們使用研究論文[7][8]的演化式代理人的架構為基礎，建構我們的代理人
自動協商架構。圖1是我們提出的代理人自動協商架構。主要由中央協商代理人來主導整個
協商的流程，並透過效益值計算器、協商共識產生器、退讓者產生器，來協助中央協商代
理人進行協商決策及退讓策略。由教師協商代理人藉由協商提案定義及喜好定義，來進行
整個協商流程。並透過候選課表產生器、提案產生器，來協助教師協商代理人進行候選課
表的產生，及協商提案的產生。透過此代理人協商架構，教師只需提出對開課課程的喜好
設定，代理人將會依據所提出的喜好設定，提出對代理人最有利的候選課表，並滿足所有
限制式。透過代理人的協商找出整體滿意度較高且對各教師最有利的提案課表。 
代理人的喜好設定，會影響代理人在評估及選擇提案的結果，並影響最後協商的決議。
代理人可將他的喜好，及對提案的評估結果提供給其他代理人知道。這樣可以使協商成員
更了解大家的需求。對於代理人的喜好定義中，必須包含代理人喜歡及不喜歡時段。時段
包含星期一至星期五，及早上、下午、晚上等時段。 
候選課表主要是在產生提供協商代理人選擇的提案課表，所以所產生的提案候選課表
的好壞，是否能滿足所有的協商代理人，影響著整個協商的過程。在所產生的候選課表，
都必須滿足整個排課流程中課程及教師的限制式，如表 1。為滿足這些限制式，整個候選
課表產生的流程： 
1.各教師代理人產生排課順序：所有教師代理人可產生對自己最有利的 3 個候選課表，提
供協商流程進行時協商提案使用。教師排課順序為自己的課程最優先排列，其他教師代理
人用亂數方式產生排列順序。利用此種方法，每位教師所產生的候選課表除了對自己最有
利，也會盡量滿足其他教師的喜好。 
2.排定必修及選修課程：先排定所有教師的必修課程再排定選修課程，因為必修課程會有
衝堂問題，所以優先排必修課程。 
3 找出符合喜好的時段：在還未有課程排入的教室時段中，找出符合教師喜好時段、所需的
教室類型、上課人數的時段。 
4.處理同一時段排課問題：主要在解決但同一位老師的課程不能排到同一時段限制式。 
5.處理衝堂問題：主要在解決必修課程不可衝堂限制式，選修課則無須考慮。 
6.處理滿堂問題：主要解決教師在一天中，課程滿堂的限制式。 
7.如符合喜好時段無法排入，則任意排入其他時段，但須符合限制式。利用此方法產生的
候選課表，可滿足表 1 中的所有限制式，且較符合教師喜好。且候選課表由各教師代理人
產生，會因為各教師代理人的喜好，產生各種類型的候選課表提供協商使用。 
2.2 自動協商流程 
協商提案的產生是透過代理人喜好，對每個提案評估計算。再由評估結果中找出合適
的提案，並由合適提案中選取一個提案做為該回合協商提案。協商決策由各代理人所選取
的提案及評估可接受的提案集合中，利用模糊邏輯的模塑方式，找尋所有代理人有共識可
接受的提案，完成協商決議，如無共識提案進行退讓策略。退讓策略為當協商無共識時，
評估所有代理人的退讓風險，由退讓風險較低的代理人進行退讓。進入下一回的協商，各
代理人重新產生協商提案。代理人自動協商流程為： 
1.進入第一回合協商，將每個代理人可接受的提案設為空集合。 
2.在協商提案的產生過程中，代理人選取最佳提案的方式是從個人利益最高的提案中選出
整體利益最高的提案。利用模糊邏輯的模塑方式，將個人喜好分為多個模糊集合，並以模
糊聯集的方式評估提案對單一喜好所得到的效益值，並對所有喜好的效益值平均做為一個
提案的效益值透過公式(1)(2)。代理人可取得個人利益最高的提案，並產生各代理人由各
提案中所獲得之整體效益，取得最適合的協商提案。 
NissuePUtility ij
M
i
N
j
k /))(max()(
1
μ∑
=
=    (1) 
3.1 軟體架構 
整個系統分為 6 大模組：候選課表產生器、中央協商代理人、教師協商代理人、效益值計
算器、提案產生器、協商共識決策器、退讓者產生器)及一個代理人對話視窗。表 2 對各模
組的功能及關係描述。 
3.2 自動協商初始設定 
排課系統中的教師開課資訊如表3，教室資訊如表4，老師依學校規定該學期授課時數
及學生選課限制，設定相關開課課程。教師個人喜好如表5，設定個人所期望的上課時間。
在老師的時間喜好方面，可分為開在星期幾，開在早上、下午、或晚上。 
表 3 部分教師開課資訊  
教 師  開 課 課 程  選 必 修  人 數  教 室  
物 件 導 向  必 修  1 00  一 般 教 室郭 老 師  
軟 體 工 程  選 修  6 0  一 般 教 室
演 算 法  必 修  6 0  一 般 教 室蔡 老 師  
平 行 處 理  選 修  6 0  電 腦 教 室
無 線 網 路  選 修  6 0  一 般 教 室呂 老 師  
高 速 網 路  選 修  6 0  一 般 教 室
影 像 處 理  選 修  6 0  一 般 教 室林 老 師  
電 腦 繪 圖  必 修  6 0  電 腦 教 室
資 料 處 理  選 修  6 0  一 般 教 室謝 老 師  
程 式 設 計  選 修  6 0  電 腦 教 室
資 料 庫 概論  必 修  1 00  一 般 教 室陳 老 師  
資 料 庫 設計  選 修  6 0  一 般 教 室
電 腦 實 習  選 修  6 0  電 腦 教 室劉 老 師  
J a va 程 式  選 修  6 0  一 般 教 室
C 語 言  必 修  1 00  一 般 教 室李 老 師  
V B . N E T  選 修  6 0  一 般 教 室
資 料 安 全  選 修  6 0  一 般 教 室許 老 師  
密 碼 學  選 修  6 0  一 般 教 室
 
表 4 教室資訊  
   用 途 人 數  
教 室 代 號  
教 室 用 途  人 數  
3 01  一 般 教 室  1 00  
3 02  一 般 教 室  6 0  
3 09  電 腦 教 室  6 0  
 
表 5 教師喜好  
喜好 
教師 
喜好 1 喜好 2 喜好 3 
郭老師 不喜歡 Tue 喜歡晚上  
蔡老師 喜歡早上 不喜歡 Tue  
呂老師 喜歡晚上 喜歡 Wed 喜歡 Fri
林老師 喜歡早上 不喜歡 Mon  
謝老師 不喜歡 Tue 下午 不喜歡 Wed 早上  
陳老師 喜歡早上 不喜歡 Mon  
劉老師 不喜歡 Tue 早上 喜歡晚上  
李老師 不喜歡 Tue   
許老師 喜歡早上 喜歡 Fri 下午'  
 
 
圖 2 單日時間喜好之歸屬函數 
表 6 部分候選課表  
課表
課程 
1 2 3 4 5 6 7 8 
物件導向 一 晚 
301 
一 晚 
301 
一 晚 
301 
一 晚 
301 
五 晚 
301 
一 晚 
301 
五 晚 
301 
五 晚 
301 
軟體工程 二 晚 
302 
二 晚 
301 
二 晚 
301 
二 晚 
302 
三 晚 
302 
二 晚 
302 
四 晚 
301 
四 晚 
301 
演算法 五 早 
301 
三 早 
301 
二 早 
301 
一 早 
302 
一 早 
301 
一 早 
301 
三 早 
301 
五 早 
301 
平行處理 三 早 
309 
五 早 
309 
三 早 
309 
二 早 
309 
二 早 
309 
二 早 
309 
二 早 
309 
三 早 
309 
無線網路 三 晚 
302 
一 晚 
302 
一 晚 
302 
三 午 
301 
一 晚 
301 
一 晚 
302 
一 晚 
302 
一 晚 
301 
高速網路 五 午 
301 
三 午 
302 
二 晚 
302 
三 早 
301 
二 晚 
302 
三 午 
301 
二 晚 
301 
二 晚 
301 
影像處理 三 早 
302 
二 早 
301 
四 早 
301 
四 早 
301 
五 早 
301 
二 早 
302 
二 早 
301 
二 早 
301 
電腦繪圖 二 早 
309 
一 早 
309 
五 早 
309 
三 早 
309 
三 早 
309 
三 早 
309 
一 早 
309 
一 早 
309 
資料庫概
論 
三 午 
301 
三 午 
301 
五 午 
301 
二 午 
301 
二 午 
301 
二 早 
301 
一 晚 
301 
三 午 
301 
資料庫設
計 
二 早 
302 
一 早 
302 
三 早 
302 
一 午 
302 
二 早 
301 
二 午 
302 
二 午 
301 
一 早 
301 
電腦實習 三 晚 
309 
三 晚 
309 
二 晚 
309 
二 晚 
309 
一 晚 
309 
二 晚 
309 
一 晚 
309 
三 晚 
309 
Java 程式
設計 
五 晚 
301 
五 晚 
301 
三 晚 
301 
三 晚 
302 
二 晚 
301 
三 晚 
301 
二 晚 
302 
五 晚 
302 
C 語言 二 午 
301 
三 晚 
301 
二 午 
301 
五 午 
301 
一 午 
301 
二 午 
301 
四 午 
301 
五 午 
301 
資料安全 一 午 
301 
三 晚 
302 
五 早 
301 
一 午 
301 
二 早 
302 
三 早 
302 
三 午 
301 
二 午 
302 
密碼學 一 早 
302 
五 午 
301 
五 晚 
302 
一 早 
301 
三 午 
301 
三 晚 
302 
三 早 
302 
三 午 
302 
繪圖概論 三 晚 
301 
二 晚 
302 
五 晚 
301 
二 晚 
301 
三 晚 
301 
二 晚 
301 
三 晚 
301 
三 晚 
301 
 
表 7 部分代理人整體效益值表  
提 案
教 師  
1 2  3  4  5  6  7  8  
郭 老 師 1 1 1 1  1  1  1 1
蔡 老 師 1 1 1 1  1  1  1 1
呂 老 師 1 0 . 67 0 . 33 0 . 33  0 . 33  0 . 67  0 . 33 0 . 33
林 老 師 1 1 1 1  1  1  1 1
謝 老 師 1 1 1 1  1  1  1 1
陳 老 師 1 1 1 0 . 5  1  1  0 . 5 1
劉 老 師 1 1 1 1  1  1  1 1
表 8 部分代理人可接受的提案集合 
教 師  合 適 提 案  
郭 老 師 1  2  3  4  5  6  7  8  9  10  11  12  13  1 4  15  16  1 7  18  
1 9  20  21  2 2  23  24  2 5  26  27  2 8  29  30  3 1  32  
3 3  34  35  3 6  37  38  3 9  40  41  4 2  43  44  4 5  46  
4 7  48  
蔡 老 師 1  2  3  4  5  6  7  8  9  10  11  12  13  1 4  15  16  1 7  18
1 9  20  21  2 2  23  24  2 5  26  27  2 8  29  30  3 1  32  
3 3  34  35  3 6  37  38  3 9  40  41  4 2  43  44  4 5  46  
4 7  48  
呂 老 師 1  
早上 下午 晚上 
1 
0 
  3       5       7         9 
NissuePUtility ij
M
i
N
j
Huang /))(max()(
1
μ∑
=
= =1 
將各老師合適的協商提案加入每位代理人可接受的提案集合中表8。每位老師可接受的提案
集合中計算共識集合，若共識集合不為空集合，則協商達成共識，協商結束；若共識集合
為空，代表協商無法達成共識。必須選擇一個代理人進行退讓。針對所有老師，計算所有
老師的退讓風險值，並以風險值最低的代理人做為退讓者。各老師依評估退讓者所提出的
提案課表是否為可接受的提案，若接受則將該提案加入代理人可接受的提案集合中。如果
整體效益值大於評估接受提案效益值，則將提案課表加入可接受的提案集合中，如表9。並
計算代理人由各候選課表所獲得之部分整體效益值，如表8。經過13個回合的協商後，以提
案課表45（因篇幅只列出部分提案）達成協商共識，如表10。本執行案例中，因郭老師所
提出的提案無法讓所有老師接受，因此必須進行退讓。重新計算退讓者郭老師對各提案課
表的整體效益值如表9，取得最適合的協商提案。 
3.4 系統環境效能比較 
本排課系統之執行使用 Intel Pentium 3.0 GHz CPU、512MB RAM，作業系統為 MS 
Window 2000，開發軟體包括 J2SDK 1.5，代理人軟體為 ADK3.2，資料庫為 MYSQL 3.23。
系統分別做 5、10、15 個教師協商的速度及滿意度測試，其效能如表 11 所示。 圖 3 為系
統執行畫面。因為產生符合限制式，且較符合教師滿意度的候選課表。在協商排課的過程
中，所提出的合適提案可以讓大多數的代理人所接受，減少協商退讓的回合數，因此所需
的時間較短。在滿意度方面，協商流程中，每位代理人會找出自身效益值較高且有助於提
升整體效益值得提案當作該回合的提案，因此所產生的提案共識有高達 90%以上的滿意度。 
4. 結論 
對於排程問題繁瑣的協商過程，本研究運用代理人自動協商機制於排課系統，利用候
選課表產生滿足課程條件限制的候選提案，避免在未滿足課程限制時，需人工介入調整課
表。由各個教師代理人產生對自己喜好最有利的候選提案，避免所產生的課表不被大部分
教師代理人接受，減少協商回合次數，加快協商速度。透過代理人協商溝通機制，解決排
課中教師滿意度問題，找出顧及整體滿意度，又盡量滿足所有教師代理人喜好的提案。本
研究協商提案的喜好是固定的，不因每回合的協商過程，吸取協商經驗。人在協商時會對
每回合的協商結果進行協調退讓，並吸取經驗以對自己的喜好做改變。因此在未來的研究
中，將加入代理人會對本身認知與喜好演進，使代理人可以更有智慧的互動。 
5.計畫成果自評 
本研究內容與原計畫規劃預期主要目標皆已達成。本研究內容於計劃執行期中已將初
步成果於 2007 年 6 月發表於第 3 屆軟體工程研討會。近期已著手整理計畫執行完整成果及
相關資料，預計投稿國外期刊。 
可供推廣之研發成果資料表 
□ 可申請專利  █ 可技術移轉                                      日期：96 年 10 月 31 日 
國科會補助計畫 
計畫名稱：應用代理人辯證協商技術發展開放式軟體架構系統 
計畫主持人：郭忠義 
計畫編號：NSC 95-2221-E-027-141-     學門領域：資訊學門 
技術/創作名稱 代理人自動協商模型 
發明人/創作人 郭忠義 
技術說明 
一般在有限的資源與許多限制條件下，排程常會發生成員為爭取資
源而發生意見不合或衝突，解決方法是對這些衝突原因進行協調以
達成共識。本研究運用智慧型代理人自動化協商的方式，透過協商
機制來協調資源分配問題，找出好的配置方案，以互相合作達成共
同目標，或求得最大利益。代理人具有知識智能與溝通協調的機
制，能根據受委託的目標來計畫其協商行動，讓有衝突的代理人在
一個共同目標下，合作協商達成資源分配的共識。本研究將多代理
人自動化協商方法應用到排課系統，各老師代理人在協商過程中，
以所代表的老師最大利益為任務。實務上不可能每一位老師都可排
到自己最想要的時間，事實上很容易發生衝突，代理人能透過自動
化協商中選擇更符合所有代理人目標需求的提案，以加速代理人間
的共識，達成整體的最大利益。 
可利用之產業 
及 
可開發之產品 
線上協商排程系統 
技術特點 
在協商過程中： 
1.所提出的合適提案可以讓大多數的代理人所接受，減少協商退讓
的回合數，縮短所需時間。 
2.每位代理人會找出自身效益值較高且有助於提升整體效益值的
提案，以提升個人與整體滿意度。 
3.智慧型代理人自動協商機制，可以協助處理排程繁瑣的協商過
程。 
推廣及運用的價值 
可推廣運用於線上排程系統，運用智慧型代理人主動特性，協助使
用者處理瑣碎繁雜的協商事務。 
※ 1.每項研發成果請填寫一式二份，一份隨成果報告送繳本會，一份送 貴單位
研發成果推廣單位（如技術移轉中心）。 
※ 2.本項研發成果若尚未申請專利，請勿揭露可申請專利之主要內容。 
※ 3.本表若不敷使用，請自行影印使用。 
