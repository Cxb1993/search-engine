 2
轉矩。 
 
 
圖二：三相感應機旋轉磁場示意圖。 
 
2.1 空間向量調變 
    圖三所示為變頻器的電路架構，其三相交流電源是
由圖三中 A, B, C 三處交替變換而輸出正負電壓所得到
的。在電動機控制的應用中，通常會將 A, B, C 三處電
路位置與三相旋轉電機之定子繞組引出線相連接，於是
定子繞組得以接受三相交流電源而產生旋轉磁場，進而
驅使電動機轉動[1]。 
 
 
圖三：變頻器電路架構示意圖。 
    不同開關切換組合，將導致定子三相繞組上產生不
同方向的電流，並且生成不同方向的定子磁場，總共可
以產生六個不同方向的定子磁場，且彼此互差60度機械
角，剛好360度機械角可以旋轉一週，將這六種不同角
度位置的定子磁場之開關切換組合，依其磁場旋轉順序
定義為空間向量1 (V1)至空間向量6 (V6)等六個向量，
上橋開關全關為空間向量7(V7)，以及下橋開關全關為
空間向量零(V0)，最後這兩個向量依其功能統稱為零向
量，所以總共有8種空間向量可供選用，如圖四所示[1]。 
 
圖四：電壓向量與空間區段示意圖。 
2.2 直接轉矩控制電壓向量切換法 
 整個直接轉矩控制理論，可以從功能上區分成兩
大區塊，一個是空間向量調變，而另一個則是電動機狀
態分析。如圖五所示，狀態分析需要取得電壓和電流迴
授值作為輸入，以進行分析與控制動作；而空間向量調
變則是將前述之分析結果投入電壓向量切換表中，選擇
出下一週期所要使用的電壓向量，藉此進行切換開關的
設定，使變頻器產生不同電壓大小，提供三相感應電動
機有效的交流驅動，表一所示即為直接轉矩控制之電壓
向量切換表[1]。 
 
圖五：直接轉矩控制理論可粗分成空間向量調變與電動
機狀態兩大功能區塊。 
表一：電壓向量切換表 
 
 
2.3 直接轉矩控制電動機狀態分析方法 
 在直接轉矩控制中，最核心的首腦是感應電動機狀
態分析方法[1]，惟有經過該方法的分析與判斷後，才
能進入電壓向量切換表中進行讀表選取正確的控制電
壓，有效進行空間向量調變動作。在開始進行分析計算
之前，首先必須取得定子繞組之單相直流電阻值，並以
迴授方式取得定子繞組之相電壓與相電流(a, b, c三相
座標軸形式)，其後將其轉換為d-q 軸座標形式，如圖
六所示。 
 
 
 
 
 
 
 
 
圖六：三相座標軸與d-q 軸轉換。 
 
依圖六所示之座標軸轉換形式，其轉換原理如下
[2]： 
⎪⎪
⎪
⎩
⎪⎪
⎪
⎨
⎧
++=
⎥⎦
⎤⎢⎣
⎡ ⎟⎠
⎞⎜⎝
⎛ −+⎟⎠
⎞⎜⎝
⎛ ++=
⎥⎦
⎤⎢⎣
⎡ ⎟⎠
⎞⎜⎝
⎛ −+⎟⎠
⎞⎜⎝
⎛ ++=
][
3
1
3
2
3
2
3
2
3
2
3
2
3
2
0 csbsass
csbsasqs
csbsasds
ffff
SinfSinfSinff
CosfCosfCosff
πθπθθ
πθπθθ      (1) 
其中 fas、fbs、fcs 表示三相座標軸函數，而 fds、fqs、f0s
表示 d-q 軸函數。當θ = 0 且假設三相平衡時(即
 4
    如果直接以三相系統來設計時，整個計算過程會過
於複雜且龐大，造成系統不管是在體積或速度上都有一
定的影響，這就是為何在設計 DTC 系統之前，需將外
部輸入訊號事先加以處理的原因。圖九所示為三相轉二
相系統的整體架構，我們使用 6 位元大小來進行轉換工
作；依公式(5)與(6)所示，先將開根號值放大到 64，而
以整數值方式求出，再與輸入信號相乘之後，經由加法
器相加而得到結果，其後再將該結果除以 64 便是所要
的答案；此外，為了增加運算速度，在乘法器方面，係
使用以 Booth 演算法所寫成的乘法器[3]，它比一般的
乘法器快一倍，比較能快速得知運算結果。接著以
Modelsim 做功能模擬與驗證，由圖十所示模擬圖得知
所設計的三相轉二相系統正確無誤。 
     
 
圖九：三相轉二相系統方塊圖。 
 
 
圖十：Modelsim 模擬三相轉二相系統圖。 
 
3.2 合成磁通計算分析與模擬 
有關合成磁通量 λdqs 的計算，可以由公式(7)與(8)
得知，其系統架構圖如圖十一所示，其中該根號計算是
採用 Shadow Tree 演算法寫成的[4]；採用該演算法可以
加快運算速度，以 16 位元的資料為例，僅需 4 個脈波
即可完成開根號動作。該架構經由 Modelsim 進行功能
模擬與驗證，確認該系統是正確無誤的。 
 
圖十一：合成磁通計算的系統方塊圖。 
 
3.3 比例積分微分器設計與模擬 
   比例積分微分控制器的設計是為了達到純量的閉迴
路控制；其中，主要的參數如比例常數 Kp、積分常數
Ki與微分常數 Kd等，在整個控制器中均扮演著非常重
要的角色，系統的變動性都會因為該參數值的設定而有
非常大的差異性，以下是類比形式 PID 的轉移函數。 
( )( )
( )
i
P d
KU SD S K K S
E S S
≡ = + +         (11) 
然後將類比形式轉換成數位形式，即對積分器做雙線性
轉換，並對微分器做反饋差運算，如此可以得到： 
⎪⎩
⎪⎨
⎧
−=
−
+=−
z
z
T
S
z
zTS
11
1
1
2
1                      (12) 
代入類比形式 PID 的轉移函數中，可以得到 
  ( ) ( ) ( ) ( ) ( )⎥⎦
⎤⎢⎣
⎡ +++= zEK
Z
zEK
Z
zEKzU
z
zU 2210
111   (13) 
其中，K0、K1與 K2的值分別為： 
⎪⎪
⎪
⎩
⎪⎪
⎪
⎨
⎧
=
−+−=
++=
T
KK
K
T
KTKK
T
KKTKK
d
dip
d
ip
2
1
0
2
2
2                       (14) 
經由反 Z 轉換後，可以得到下式： 
( ) ( ) [ ]221101 −− +++−= kkk eKeKeKkuku (15) 
當 Kp、Ki、Kd由 Simulink 軟體模擬得到後，K0、K1、
K2便可決定。若以(K0,K1,K2) = (1,2,3)為例，我們可以
採用查表方式來取代乘法器，即預先將乘積值儲存於
ROM 中，再利用定址的方式取出乘積值，如此可以快
速得到乘積值[5]，圖十二為 PID 系統的模擬方塊圖。
該系統經 Quartus II 軟體進行模擬驗證，得知功能是正
確的。 
 
圖十二：PID 系統模擬方塊圖。 
      
3.4 速度量測分析與模擬 
馬達運轉時，可透過轉速編碼器轉換成二進位碼，
再與預設轉速值作分析判斷，然後經由 PID 控制器所
產生的轉矩，透過轉矩磁滯控制器來產生所需的轉矩，
並加以輸入至開關切換表中，藉以達到控制馬達轉速的
功能。當馬達旋轉時，A、B 相產生相差 900之連續脈
波，透過相位比較來判斷誰領先、誰落後，如此即可辨
別出馬達旋轉的方向是正轉或逆轉；當 A 相領先 B 相
900 則為正轉，反之，則為逆轉。再者，透過偵測 A、
B 相的方波頻率，對應圓盤之解析，即可判斷出磁極位
置與轉角，而 Z 相於每馬達旋轉一週後，於固定位置
產生一脈波輸出。 
圖十三所示為轉速估測方塊圖[6]，當 A、B 二相的
 6
 
 
圖十九：數位降頻濾波器的電路方塊圖。 
 
3.8 直接轉矩控制演算法電路的模擬結果 
直接轉矩控制法電路的功能方塊圖如圖二十所
示，其包含了三相轉成二相電路、磁通計算電路、合成
磁通計算電路、轉矩計算電路、角度計算電路、比例積
分微分器、速度量測與數位濾波器等子系統電路所合成
的電路架構圖；圖二十一則為直接轉矩控制法電路的模
擬結果；圖二十二則是整體馬達控制晶片的模擬波形；
圖二十三與圖二十四分別為 FPGA 實體量測的結果，前
圖設定開關保護時間為 2µs，而後圖開關保護時間設定
為 5µs。 
 
圖二十：直接轉矩控制演算法電路之功能方塊圖。 
 
 
圖二十一：直接轉矩控制演算法電路之模擬結果。 
 
 
 
圖二十二：整體馬達控制晶片模擬波形。 
 
 
圖二十三：開關保護時間設定為 2µs。 
 
 
圖二十四：開關保護時間設定為 5µs。 
 
四、馬達控制用類比三角積分類比數位轉換器設計 
本研究旨在比較切換電容式與切換電流式二階三
角積分調變器的優缺點，以為馬達控制之用。為了比較
兩者，在切換電容式二階三角積分調變器方面，我們使
用不受寄生電容影響的積分器；在切換電流式二階三角
積分調變器方面，我們提出一種不需要運算放大器回授
且可降低輸入阻抗的切換電流式取樣電路，並且加上一
個共模前饋電路降低輸入共模抵補電壓。所有的設計與
模擬工作均採用 TSMC 0.35µm 製程參數所完成的。模
擬結果顯示，在 10.24MHz 的取樣頻率與超取樣率為
128 時，切換電容式與切換電流式分別可以得到 89dB
與 86.3dB 的最大訊號雜訊與失真比，消耗功率皆為
12mW。 
 
4.1 二階三角積分調變器電路架構 
圖二十五為一種二階三角積分調變器的功能方塊
圖，該架構係由積分器電路、取樣 / 保持電路
 8
電路稱為共模前饋電路，其電路架構如圖三十二所
示。該共模前饋電路係利用 M1、M2、M3、M9 所產生
的補償電流來吸引差動對 M5、M10 所產生的誤差電
流，使得 Iout+的共模輸出可維持固定。同樣地，M6、
M7、M8、M12 所產生的補償電流亦可吸引差動對 M4、
M11 所產生的誤差電流，使得 Iout-的共模輸出維持固
定。 
D i f f e r e n t i a l O u t p u t W i t h C M F F
M 1 M 2 M 3 M 4 M 5 M 6 M 7 M 8
M 9 M 1 0 M 1 1 M 1 2
Io u t+ Io u t-
Ie rro r I erro r
I in + Iin -
 
圖三十二：輸出端之共模前饋電路。 
 
4.4 電壓式比較器 
 圖三十三所示為使用再產生閂鎖器 (regenerative 
latch)所實現的比較器[11]，在此閂鎖器中互相交叉對稱
的元件 M2-M3 與 M8-M9 可以想成是兩個背對背的反
向器。在積分相位的時候，時脈輸入φ1為低準位，A 點
與 B 點被拉高，使得再產生(regeneration)的功能停止，
SR 閂鎖器的輸入 R 點與 S 點也因此為低準位。當φ1 為
高準位的時候，A 點與 B 點被釋放，使得交叉對稱的
電晶體 M2-M3 與 M8-M9 再產生的功能被打開。當輸
入電晶體 M1 與 M4 將比較器鎖往一個方向時，將驅動
SR 閂鎖器的其中一個輸入為高準位，此時結果會被存
起來，然後比較器會在下一個時脈週期被重設。  
S
Vin-M2
M5
Vin+M11
R
M3 M4
M6
M7 M8 M9 M10M12 M14
M13M1
1φ 1φ
1φ1φ
 
(a) 
S
R
Q
Q
 
(b) 
圖三十三：(a)再產生回授比較器，(b) SR閂鎖器。 
 
4.5 電流式比較器 
 如圖三十四所示，該電路為本研究所採用的一位元
低輸入阻抗電流比較器[11]。當有一正向電流輸入時，
M3 的閘極 (Gate)電壓會因寄生電容充電而上升
(High)，相對地輸出電壓也會下降(Low)並回授至 M2
的閘極(Gate)上，使 M2 這個 PMOS 電晶體加速導通而
成為低輸入阻抗，惟此時的 M0 電晶體是在截止狀態；
反之，若有一反向電流輸入時(即流出狀態)，這個 M0
電晶體(NMOS)會快速導通而成為低輸入阻抗，同樣可
以加快電流比較器的速度。值得注意的是，整個電路的
後級串上一個 CMOS 反向器，其功能是將訊號放大至
數位邏輯位準，以提昇電路驅動能力。特別一提的是，
我們不僅以此低輸入阻抗的電路來設計電流比較器，同
時也以該電路來設計一位元量化器。 
Vout
Icmp
M0 M1
M2 M3
 
圖三十四：具有低輸入阻抗之電流比較器。 
 
4.6 電壓式數位類比轉換器 
圖三十五所示為一位元數位類比轉換器[12]。Vin
的訊號是來自於比較器輸出的波形，因此 Vin 訊號只有
兩個準位，不是很高(VDD)就是很低(GND)。假如 Vin
訊號為 VDD，M2 電晶體導通，Vout 會等於 Vref-；反
之，Vout 會等於 Vref+。 
Vin Vout
Vref+
Vref-
M1
M2
 
圖三十五：一位元數位類比轉換器。 
 
4.7 電流式數位類比轉換器 
如圖三十六所示，此為本研究所採用的一位元串
疊式數位類比轉換器(Cascade DAC) [4,8][13]。操作
時，其係利用一個偏壓電流源 IDA，並藉由 PMOS 與
NMOS 電流鏡來產生一對雙向的輸出電流 Iout，同時配
合一組互為反向的數位邏輯準位D1來切換CMOS型開
關元件。當數位邏輯準位 D1 為 ON 時，會有一輸出電
流 Iout 流出，是為正電流；而當數位邏輯準位 D1 為
OFF 時，會有一與輸出電流 Iout 反向的電流流入，是為
負電流。依此，若有一串連續性的數位輸入(D1)時，便
會有反應的一連串量化電流訊號輸出，而完成 DAC 的
動作。 
Vbias 1
Vbias 2
D 1
D 1
I DA
Iout
 
 
圖三十六：一位元串疊架構的數位類比轉換器。 
