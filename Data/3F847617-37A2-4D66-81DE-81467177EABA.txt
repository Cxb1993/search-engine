 2
二、前言 
近年來因為資訊化設備的快速進步帶來了許多便利，例如，透過資料的數位化
讓使用者在使用資料時得到最高的品質，存取資料時減少了許多的時間，快速發展
的數位儲存媒體也使得大量多媒體資料的存放更為經濟，當許多資料都數位化後，
我們希望能進一步享有更多的便利性，例如透過網路即可存取資料，如此可以省去
攜帶大量資料的不便，並且希望這些數位化的資料可以進行適當地分享以及整合。
但是直接把隱私資料或是重要訊息直接存放於網路上的資料庫主機危險性太高，傳
統上這個問題的解決方式是讓使用者經過認證，授權即可存取資料。使用這種模式
存取資料基本上假設：“資料庫主機會盡其可能保障客戶交付的任何資料以及相關存
取訊息的隱密性，並不會做出任何損害客戶權益的行為”，由於這是一個非常強的假
設，在實際運作中萬一無法達成此假設，透過遠端資料庫主機儲存資料的安全性便
無法達成。因此在本計劃中我們運用密碼學的機制來去除這種信任主機的假設來增
進遠端資料儲存的安全性。 
三、研究目的 
本計畫主要目標在於研究如何運用密碼學以及相關安全技術，實現不需要信任
伺服器主機、能夠兼顧個人隱私、又能夠達到醫療資源共享的集中式醫療病歷資料
庫。目前各大醫院正逐步採用數位化的方式來記載病歷資料[1]，以得到資訊迅速確
實的存取、以及全面整合的好處，如何進一步地運用電子化的資料來達到醫療資源
共享是需要努力的目標。例如：病人到醫院看病時，醫生如果可以掌握病人過去的
病歷資料，將有利於醫生這次的診斷與處方；某些疾病有區域性及時間性，如果醫
生能夠在病歷資料庫中做有限制的查詢以取得經過適當授權的資料，對於病情的診
斷與治療大有幫助。一般來說病歷資料應當視為病人的隱私，該如何安全地整合儲
存、取得和查詢資料呢？如果只是需要個人的資料，概念上最簡單的方式就是病人
把自己的病歷資料用數位媒體加密儲存，再配合智慧卡[2](例如健保卡)來存取使
用，就醫時攜帶數位儲存媒體即可，然而由於病歷資料逐漸轉為多媒體的形式，例
如照片、聲音、視訊等等，病人使用隨身攜帶的方式可能會有許多不便，例如空間
不足，帶錯資料等等；再者也無法查詢或統計區域性多人的病歷資料；另一種方式
是採用信任資料庫主機的方式儲存病歷於遠端資料庫上，當客戶端需要查詢資料
時，可透過認證方式到資料庫存取，但這種模式就會有信任主機的缺點存在，例如：
某公司具有客戶的隱私資料庫，可能因為公司內的不肖員工盜賣客戶資料、竊取或
統計客戶查詢內容或是因為資料庫管理不當而被駭客入侵，進而影響到了客戶的權
益。所以在本計畫中將研究不需信任資料庫主機的資料儲存與查詢方式，運用這樣
的方式來避開信任主機的缺點，卻保留遠端資料庫資源共享的彈性與便利性。 
四、文獻探討 
密文可搜尋的加密方法目前國內外學者仍然在持續改進其安全性與效率當中 
[5,10,11,12,13,14]，在 [5] 中 Song 等人首次藉由虛擬亂數函式設計可以辨認的密
文，提出可以支援關鍵字搜尋的加密方法，對稱式的加密方法應用在醫療資料庫中
最主要的困難點在於：資料共享的成本很高，例如醫生和病人本來就可以共享某一
 4
字密文 E(Wi) 之後，會得到資料庫中一整組含有該關鍵字的資料，也因此得悉相關的訊息。 
基於雙線性對應提供關鍵字搜尋的加密系統[10]： 
Boneh 的關鍵字可搜尋公開金鑰加密演算法如下： 
基本參數：令 G1 及 G2 為兩個大小為質數 p 的循環群，令 H1 及 H2 為兩個密碼學 
Hash 函式，其中 H1: {0,1}*→G1, H2: G2→{0,1}log p 
參數產生：在 Zp* 中任選祕密亂數 α, 並且挑選 G1 中的一個生成數 g, 計算 h = gα，公
開金鑰 PK = (g, h), 私密金鑰 SK = α 
關鍵字加密 PEKS(PK, W)：在 Zp* 中挑選亂數 r, S = (A, B) = (g
r
, H2(e(H1(W), h
r
))) 
關鍵字暗門 Trapdoor(SK, W)：Tw = H1(W)
α
 
比對函式 Test(PK, S, Tw)：檢查 H2(e(Tw, A)) = B 
上述 e(⋅,⋅) 為一個雙線性對應，例如 Tate 或是 Wail 對應，G1 常常為橢圓曲線的點
所構成的群。  
接下來介紹在資料庫主機上密文醫療資訊查詢系統之架構，再依此架構討論三種運用
不同加密系統所建構能夠支援密文搜尋的遠端資料儲存系統。 
資料庫主機上密文醫療資料儲存與查詢架構 
如圖二所示，因為資料庫主機端是不可信任的，所以當使用者儲存資料至遠端資料庫
時，先把所有的資料加密後再傳送至主機端，藉以防止主機端或駭客竊取或濫用使用者資
料。如果主機端使用密文可搜尋的加密演算法，當使用者對主機提出請求時，主機透過密
文搜尋的演算法找出含有使用者所要的密文資料，並回傳給使用者。如果加密系統本身不
支援密文搜尋，必須事先將比較重要的關鍵字由資料中分離出來獨立加密，以便支援密文
之搜尋。 
圖二：支援密文搜尋的遠端資料庫上資料儲存與查詢 
1. 使用確定式加密演算法設計的密文醫療資料庫系統 
一般資料庫在搜尋某一筆資料時，搜尋的方式是在索引欄位中依照索引值找出指定的
一筆資料。密文資料庫的建置方式也可以採用相同的概念，利用關鍵字的密文當成資料表
格的索引（例如在圖三中把病人 ID 的密文當成索引欄位），透過密文的比對找出特定幾筆
資料，最後回傳資料記錄給查詢者。在此架構中資料表格中的索引值可以不只一個，若只
使用單一索引進行搜尋，資料庫可能會回傳多筆資料，為了讓客戶能夠更精確的取回目標
資料，可以採用多關鍵欄位的階層式搜尋方式，例如先依照 ID 欄位比對出所有病人的 ID
欄和 Ek2(Joe)相同的幾筆資料，再比對日期密文 Ek2(09/06/2007) 進行第二層的搜尋，除此
密文
病人
DB
醫院
資料查詢(query)
資料取回
密文搜尋
資料儲存
密文
密文
 6
比機率式公開金鑰系統好，所以我們在表格中新增一個用來儲存對稱式金鑰的欄位，並用
機率式加密的金鑰和亂數把對稱式金鑰 s 加密後存放。另外為了隱藏簽章者的身份，避免
侵入系統的人藉由驗證金鑰來確認病歷資料擁有者身份，必須使用前述對稱式加密方法加
密簽章。 
3. 使用密文可搜尋的加密系統設計的密文醫療資料庫系統 
不論在確定式加密或是在機率式加密的架構中，我們搜尋目標物的方式都是透過階層
式的搜尋（即先將病歷資料中關鍵欄位分離出來，搜尋時再依照欄位搜尋），如圖三所做的
索引欄位為病人 ID與日期兩個階層的目錄分類；但是這樣的搜尋方式缺少了許多便利性，
如果病人想要搜尋自己病歷資料中具有類固醇關鍵字的所有病歷，用此種分欄位階層式的
搜尋就無法達成，因為不能無限制地做目錄分類，況且階層式的搜尋需要耗費建立分類目
錄所需要的資源；如果希望系統具有類似全文檢索的搜尋功能，依照使用者想搜尋的辭彙
來搜尋，就需要運用密文可搜尋的加密系統來實作伺服端的資料庫。 
如圖五，運用[5]中密文可搜尋的加密系統來建構一個允許使用者全文檢索的密文資料
庫，這樣的資料庫允許使用者對所有文件做特定詞彙的查詢並取回病歷資料。建構方法如
下：當病人至醫院看完病後，即把整份病歷資料的所有詞彙做可搜尋式的加密，產生對應
密文儲存於主機端。當需要查詢病歷資料時，把所欲搜尋的詞彙Wi之密文 Ek(Wi)傳送至主
機，讓主機做密文的搜尋（依可搜尋式加密的搜尋方式）。例如，病人想要取回自己在某家
醫院中包含類固醇這詞彙的病歷，可先把病人姓名、醫療院所名稱、類固醇等關鍵辭用確
定式金鑰加密，再計算出對應的 ki，然後傳送至醫院資料庫進行搜尋，把所有病歷中有病
人姓名、醫療院所名稱和類固醇的文件傳回，再進行解密即可拿到所需要的資料。 
 
圖五：採用可搜尋式加密方式設計的資料存放模型 
在本計畫中我們除了實作上述架構的密文可搜尋資料庫外；由於醫生或是病人
儲存在集中式資料庫中的為密文形式的資料，我們為了方便日後查詢的有效性，也
將設計要求使用者提出部份資料正確性的零知識證明；我們也將實作基於橢圓曲線
雙線性對密碼系統的密文可搜尋資料庫，嘗試設計較為合理有效的複合查詢，例如 
AND, OR 或是多個查詢的一般邏輯組合；我們將嘗試設計有時限的關鍵字查詢；另
外我們也將嘗試設計加速密文比對的索引方法，考量實作面上如何配合智慧卡記錄
病人以及醫生的私密查詢金鑰；並且深入分析各種設計方法的運算與儲存效率，最
後分析各個系統的安全性。 
病歷
姓名:
日期:
……類固醇….
Joe
04/09/28
病歷
A(姓名):
A(日期):
……A(類固醇)….
A(Joe)
A(04/09/28)
Each word use A(.) to encrypt 
Searchable Encryption=
ΔA( . )
A(姓名):
A(日期):
……E(SARS)….
A(Jacky)
E(04/09/28)E(姓名):
A(日期):
……E(SARS)….
A(Helen)
E(04/09/28)E(姓名):
A(日期):
……A(類固醇)….
A(Steven)
A(04/09/28)
A(姓名):
A(日期):
……A(類固醇)….
A(Joe)
A(04/09/30)
…
A( . )
E(.)
Ti
 
 8
 C先挑選空間維度 n、質數 p和兩個秩為 p的循環群 G，GT並傳送給 A，A挑
選兩個身分識別字串的集合 S0 = {ID0,1, ID0,2, …, ID0,k}，k<n，S1 = {ID1,1, ID1,2, …, 
ID1,k'}，k'<n 並傳送 (S0, S1) 給 C，C挑選 x0 ∈ k
i 1=U
V0,i, x1 ∈ '
1
k
i=U
V1,i,，Vi,j 為 IDi,j 所
對應的仿射空間，C 挑選其它的公開參數 PP 並傳送給 A。 
第一次詢問階段： 
 A 向 C 詢問多次授權給身分識別字串 ID' (對應仿射空間 V')的密鑰， C 執
行 Delegate(PP , ⊥, K⊥ ,V') 並傳送 KV' 給 A，但是 A不能詢問子集合 S0 與 S1 內
的身分識別字串的密鑰。 
質疑階段： 
 A 挑選兩個信息 m0、m1 傳送給 C，C 隨機挑選 β ∈{0,1}，計算 
c* :=Encrypt(PP , xβ , mβ)，並回傳給  A 。 
第二次詢問階段： 
 A 再向 C 詢問多次授權給身分識別字串 ID'' (對應仿射空間 V'') 的密鑰，  
A 不能詢問子集合 S0 與 S1內的身分識別字串的密鑰。 
猜測階段： 
 A 輸出 β'，如 β'= β 則  A 贏得此賽局。 
攻擊者 A在 V 賽局(當 A攻擊一個設定參數為 SP的加密系統 S)中的優勢為 
VAdvA→ ( S, SP)( λ):= | Pr [ A wins V ] - Pr [ A loses V ] |。 假如對於所有的設定參數 SP
和所有的機率式多項式時間的攻擊者 A， 優勢 VAdv A→ (S, SP)( λ) 是一個 λ的可忽略
函數，則稱此廣播加密系統 S是 V -secure。 
匿名的空間加密系統四個演算法如下： 
環境設定 Setup(λ , n)： 
產生一個雙線性對映 e：G× G→GT，G、GT 為兩個秩為質數 p (⎣log p⎦ = λ) 的
循環群， h: GT→ Zp 為一 1-1之編碼函式，n是空間維度。 挑選 g∈RG*，產生秘密
參數 a0、b、b1∈R Zp，a、a1∈R Zpn，然後計算 t :=e(g,g)b、t1 := gb1，輸出公開參數 PP := 
(p, G, GT: g, g
a0, ga, ga1, t, t1) 和管理者密鑰 K⊥ := (g, gb, ga, b1, a1)。一個識別字串 ID 
對應的仿射空間 V = Aff(M, x)的密鑰 KV = (gr , gb+ra0+r<x, a>, gr M
Ta , gb1<x, a1> , 
gb1M
T a1)，其中 b、b1是管理者的秘密，r是從 *pZ 中隨機挑選的一個數。 
授權 Delegate(PP, V1, KV1,V2)： 
 10
公開 (ym , gu , R)，使 S集合內的使用者都用自己的密鑰計算出此密文之單次密鑰 
key，而不在 S 內的使用者則否。步驟 5 為解一個 n 元聯立方程式，k 必須小於 n，
否則無解。步驟 2 - 4 使得每次加密時，即使集合 S 內的成員不變，步驟 5 聯立
方程式的係數仍會不同，而解聯立方程式得到的單次密鑰 key 亦不相同。 
實際應用時集合 S 必須將所有可解密的上層 ID 都放進來，由於我們 ID 的設
計為一個路徑， 如：臺大醫院\眼科\··，因此只需要沿著路徑，就可把上層 ID (臺
大醫院、臺大醫院眼科、…) 都放入集合 S內。 
匿名廣播解密 Decrypt (PP, Vi, KVi, c)：  
如果密文 c的安全政策 π 所對應的向量 x∈ Vi 則此演算法可以解出正確明文 
m，Vi 為集合 S 中使用者 IDi 所對應的仿射空間， KVi 為 IDi 之密鑰， 解密步
驟如下： 
1. v'i = Mi ym + xi  
2. 計算 r'1,i = e(gb1<v'i,a1>,gu)。 
3. 計算 key' ≡ <R'i, v'i> (mod p)， R'i = ( h(r'1,i), r2, ..., rn)。 
4. 用 key' 解密 xe 得到 x'1 || x'2 || ... || x'n，還原 x' =(x'1 , x'2 , ... , x'n)。 
5. 令 V'x = Aff(0, x') 執行授權演算法Delegate(PP, Vi, KVi, V'x)，得到K{x} := (k1 , k2) = 
(gr, gb+r(a0+<x',a>) ) 
6. 代入下式可解出 m' 
)k,e(c
)k ,e(c  c
21
123 ⋅  = ),rs(asb
),rs(as
ax'
ax
0
0
g)e(g,
g)e(g, t m
><++
><+⋅⋅  = m' 
未來我們將持續推展 PEKS 系統之研究，除了探討關鍵字密文與暗門私密性以
及關連性之安全性定義，我們也將探討整合混和式密碼系統與 PEKS 系統之安全性
定義，發展相關符合安全性要求的加密系統，並且探討標準模型下相關系統的設計，
在可搜尋的廣播加密系統中也將繼續嘗試是否能夠提供匿名性，設計能夠支援複合
搜尋的加密系統，並且設計基於角色的加密系統。 
六、計畫成果自評 
本計畫在執行過程中深入地了解集中式醫療資料庫的安全需求，在透過可搜尋
對稱式加密系統的實作探討中逐步評估符合需求的系統所需付出的金鑰交換與金鑰
管理之成本，加密與解密運算之成本，密文資料儲存空間之需求，資料搜尋時間之
成本，資料搜尋與解密時各種角色權限彈性設定的需求，動態指定可解密角色的需
求，為了在最小的成本下達成上數這些需求，我們慢慢發現必須犧牲對稱式系統加
密快速的優點，而需要以基於公開金鑰的系統來滿足上述之各項需求，同時也發現
需要轉換應用廣播加密的 GIBE 密碼技術來達到動態指定存取權限的目的，發現透
過匿名性的設計可以保護醫療資料庫中許多重要的資訊，因此提出各種相關的系統
設計，在 PEKS 系統中深入地定義整合密文與關鍵字暗門的安全定義，設計滿足該
定義的 SCF-PEKS-1 系統，更進一步定義具有不可分辨安全性的關鍵字暗門 PEKS 
系統之整合安全性，設計滿足該定義的 SST-PEKS 系統，這些成果都是由計劃書規
劃的研究方法與目標中逐步衍生而得，可以說是本計畫執行過程中最寶貴的產出，
相信也藉此逐漸跨出重要的里程碑。 
國科會補助出席國際會議報告 
                                           98  年   09   月   05   日 
報告人姓名 丁 培 毅 服務機關名稱（請註明系所）及職稱
國立台灣海洋大學資訊工程學
系副教授 
會議期間及地點 自 2009年 05月 26日至  
2009年 05月 29日(日本)
國科會核定 
補助文號 
   年  月  日 
 
會議名稱 
（ 中文 ）2009年國際計算機及資訊科技會議 
（ 英文 ）International Conference on Computer and Information 
Technology (ICCIT 2009) 
發表論文題目 
（ 中文 ）可匿名否決的代理多重簽章系統 
（ 英文 ）A Proxy Multi-Signature Scheme with Anonymous Vetoable  
Delegation 
報告內容應包括下列各項： 
一、參加會議經過 
二、與會心得 
三、建議 
四、攜回資料名稱及內容 
五、其它 
 
列特性：1.多人進行分散式代理密鑰產生：用一般傳統的多方安全運算來分散式
地產生代理密鑰，需要很龐大的通訊，當我們運用此機制時，可以很模組化的產
生整合的代理密鑰；2.多人進行匿名否決授權：各授權者自由決定是否授予代理
者該項權利，且任何人都無法追溯個別授權者的決定；3.安全的代理密鑰傳送機
制：藉由一個公開管道，授權者便可將個別的代理密鑰傳送給代理者，省去由秘
密管道傳送所需的代價，除了代理者外，任何人都不能取得所有代理者的代理密
鑰；4.此機制可以很一致地加上保護代理者的功能，不像其他代理簽章方法在加
上保護代理者功能時常常需要代理者額外簽署一個個人的簽章，在實作上、在簽
章的長度、和運算時間上都有好處。 
    基本上這一次的國際會議讓我了解到學術是沒有分界的，不會因為你是工程
背景就被限制住只能做實務，學數學的人就只能去發展理論。各個領域不完全相
同的專家在一起時仍然可以有相當好的腦力激盪，可以成為下一階段研究發展的
方向。 
     
三、建議 
 此行由於 H1N1 新流感肆虐，並沒有安排參訪行程，研討會中遇見的國外學
者讓我感覺到學術交流與國際視野開拓的重要性。在交流的過程中，可從提問與
答辯間解答許多的疑惑；亦可在私下討論時，了解每位學者間所關注的焦點，了
解其對相關問題的看法，有助我們掌握新的研究方向。希望教育部、國科會、以
及學校往後能繼續大力支持補助國內博士生，甚至碩士生，參與國際學術會議，
開拓其國際視野 
 
四、攜回資料名稱及內容 
    與會後攜回的主要資料包括，本次會議的詳細議程， VCD及一本大會論文
摘要集。 
 
