 2
遠距居家-隨身照護系統晶片平台設計(II) 
 
計畫編號：NSC 94－2218－E－003－002 
執行期限：94 年 10 月 01 日至 95 年 09 月 30 日 
主持人：高文忠 助理教授 國立台灣師範大學應用電子科技研究所 
計畫參與人員：尤俊國、陳偉昕、沈家平、高志忠 
 
摘要 
本計畫的主要目標是開發以系統晶片為
基礎之隨身照護系統軟硬體平台。在居家照
護系統中，利用系統晶片與嵌入式軟體技
術，將多種軟硬體設計整合於單一晶片中，
使整個照護系統便成可攜式的設備，是使照
護系統具有實用性的關鍵技術。本計畫之第
二年的工作重點除了持續改進影音界面外，
我們著重於心電圖與心音圖等醫學量測資料
的前處理與辨識工作。 
 
關鍵詞：系統晶片、嵌入式系統、照護系統、
心電圖、心音圖、影音擷取。 
 
Abstract 
The objective of this sub-project is to 
develop a hardware/software platform for 
tele-homecare system based on SoC 
technologies. By using SoC with embedded 
software technologies, the proposed system 
integrates versatile hardware and software 
modules into a portable device, and increases 
the practicability of the system. In this year, we 
focus on studying the ECG/PCG analysis 
algorithm as well as their hardware architecture 
design. Promising results have been achieved 
with the proposed algorithm for ECG/PCG 
recognition. 
 
Keywords: System-on-a-chip (SoC), 
Embedded System, Homecare system, ECG, 
PCG, A/V recording. 
 
1. 前言 
醫學診斷訊號如心電圖與電子聽診器的
訊號量相當大，尤其是長時間監測患者時，
資料的傳輸頻寬將不敷使用。此外心電圖與
電子聽診器所產生的心音圖資料量如果過大
的話，將增加醫護人員的工作負擔與誤診斷
的機會。因此在隨身照護系統上，將量測資
料先進行訊號前處理、特徵抽取、壓縮與訊
號異常辨認，是一項必要的工作。雖然目前
已有許多相關心電圖的壓縮與辨認技術被提
出，但以系統晶片為基礎的心電圖訊號處理
研究則仍在進行中，許多問題仍未被充份討
論，尤其是研究如何共用軟硬體模組於心電
圖與心音圖的訊號壓縮與辨認，這些研究議
題需再研究系統晶片本身的相關技術，使照
護系統具有較完整的訊號處理功能。在心音
圖的研究方面，我們對於低雜訊的心音圖研
究已經達到近 100% 的準確率，然而於實際
應用條件下，需處理各式噪音，而這也是我
們往後需再加強之處。在心電圖的研究方
面，我們已獲得不錯的成果，並因此榮獲IEEE 
APCCAS 2006 最佳論文獎。 
 
2. ECG 信號分析 
 我們從MIT-BIH database中取出ECG信
號，依據此資料庫，我我們區分出十二種病
症做為分類正常波形(Normal Beat)、左分支
束阻塞(Left Bundle Branch Block)、右分支束
阻塞(Right Bundle Branch Block)、變形的心
房期外收縮(Aberrated atrial premature beat)、
心 室 期 外 收 縮 (Premature Ventricular 
Contraction) 、 心 室 融 合 心 跳 (Fusion of 
ventricular and normal beat)、房室交界處期外
 4
首先輸入心電圖連續訊號，這連續心電
圖訊號中包含了許多的 QRS 複合波組
(complex)，第二步使用低通濾波器來消除原
始心電圖波中的雜訊，由於在原始訊號中因
為外在的干擾，產生了許多不必要的雜訊，
所以利用低通濾波器去除訊號中的高頻成
份，第三步接著對通過低通濾波器的心電圖
訊號作 5 單位的時間延遲，並且映射到二維
空間判斷其訊號的相關性，使得心電圖中的
各個特徵部份容易辨識出來，最後計算訊號
的空間速率，也就是說計算位移速率之後的
訊號和原始訊號之間的差異。 
 
2.2 k-Means Clustering 
當從 MIT-BIH 心律不整資料庫中所得到
的樣本資料會有些問題，同一種類的病症會
有不一樣的波形，例如病症 LBBB 在
MIT-BIH 心律不整資料庫中，就至少有四種
波形用肉眼判斷就會發現不一樣形狀，還有
病症 RBBB 在資料庫中，也有六種波形用肉
眼就能發現其不同形狀，特別的是病症
PVC，其中包括了許多不同的波形，尤其在
些波形和 Normal beat 相似是，所以在細分時
要注意其特徵性。因此在作為辨識的樣本資
料時，並不可以把同樣的病症歸屬於同一類
別去作為訓練的樣本，這樣會使得此類樣本
資料發散，面對此問題，解決的方式是把同
樣形狀的病症波形歸屬在同類別，對病症樣
本做次級的分類。 
首先把切割出的樣本資料做形狀概要分
析，決定出所要的分群數目，最後依照其波
形特性分群出所要的類別。經過 k-mean 演算
法的分類之後，從原本的 12 類別轉變成 72
個次類別，依據表中所示正常波形(Normal 
Beat)被分為 38 個次類別，原因是因為心電圖
資料中，Normal Beat 的資料是從 38 個人取
出來，所以在決定要取幾個次類別時，就依
據這樣的方式。在 k-mean 過程中如果分為過
多次類別時，會使得較少筆數的類別被較多
資料類別給混淆；如果 k-mean 分群結果較少
類別時，會使得資料中混沌過多的波形，而
且不容易辨識。因此經過實驗模擬本研究採
用 72 個次類別較為恰當 (如表一所示)。 
 
2.3 Feature extraction 
根據所分群的病症資料，做特徵的擷
取，其計算特徵值的流程如圖三所示，主要
的方法分為頻域分析和觀察病症波形等特
性，針對此兩種方式分別說明： 
ECG Signal
Frequency Domain
(W avelet Transform )
Feature Selection 
Feature Vector 
T im e Dom ain
(W ave Condition)
Feature Selection 
 
圖三、特徵擷取流程圖 
 
2.3.1 小波頻帶分解： 
g
h
g
h
2
2
D1
(100)
One Beat
ECG signal 2
2
g
h
D2
(50)
2
2
D3
(25)
(200)
A2
(50)
A1
(100)
A3
(25)  
圖四、ECG 信號分析流程圖 
使用小波轉換做三階頻帶分解如圖四所
示。分別取出 A1、A2、A3、D1、D2、D3
等頻帶係數。在心電圖的分解過程中，心電
圖訊號中的不連續點或轉折點處經過小波轉
換，能夠在多重解析度中呈現明顯且不一樣
的特徵，利用這一點，對有尖銳波形的 QRS
波使用小波轉換，則會在多重解析中會有明
顯的正負落差。h 分別表示一階、二階和三
階的低頻的波形，g 分別表示一階、二階和
三階的高頻的波形。在低頻的部份，逐漸能
凸顯波形中較細微的部份，而高頻部份，對
變化較劇烈的特徵凸顯出來。 
 6
值相減的平方。我們會得到(72×71) / 2 = 2556
個不同兩類間差異的 d 向量，如圖六所示，
其中 k 表示所屬的特徵維度，下標的兩個數
字 m、n 表示所要分類的兩個類別。 
 
1
2,1d
2
2,1d
3
2,1d
4
2,1d
5
2,1d
383
2,1d·················
382
2,1d
1
3,1d
2
3,1d
3
3,1d
4
3,1d
5
3,1d
383
3,1d·················
382
3,1d
1
36,35d
2
36,35d
3
36,35d
4
36,35d
5
36,35d
383
36,35d·················
382
36,35d
·
·
·
·
·
·
·
·
·
·
·
·
·
·
·
·
·
·
·
·
·
·
·
·
·
·
·
·
·
·
·
·
·
·
·
·
·
·
·
·
·
·
·
·
·
·
·
·
1
72,71d
2
72,71d
3
72,71d
4
72,71d
5
72,71d
383
72,71d·················
382
72,71d
2556
383  
圖六、兩兩之間平均值差異的平方的向
量示意圖 
計算完
k
nmd , 後，就可以利用剛剛產生的
k
nmd , 與之前計算的變異數來計算可以用來區
別兩類的特徵區別值σ。計算方法如下列公
式。因此，若是所計算出來的σ值越大，表
示這個值越可以區分出這兩類，這個特徵越
重要。 
,
2 2, , 1, ,383(( ) ( ) )
1 , 72,
k
k m n
k km n
m n
d for kv v
where
m n m n
σ = =+
< ≤ ≠
"
  
計算完兩類與兩類之間的特徵區別值 σ
後，我們就可以知道針對不同的兩個類別，
哪一個特徵維度的特徵值是對於分辨這兩類
有幫助的，值越大表示對於分類越有利。經
過排序後可以知道，使用哪幾個特徵維度
可以最佳辨識兩類所對應的兩類如圖七
所示。由於是兩類與兩類之間的辨識，針
對不同的兩個類別取相對應此兩類的最
佳分類特徵維度的做法就會比一般將所
有類別一起訓練出一個分類模型的分類
效果來的好，而且可以用到更少的特徵。 
 
1
2,1σ 22,1σ 32,1σ 42,1σ 52,1σ 3832,1σ················· 3822,1σ
1
3,1σ 23,1σ 33,1σ 43,1σ 53,1σ 3833,1σ················· 3823,1σ
1
36,35σ 2 36,35σ 3 36,35σ 4 36,35σ 5 36,35σ 38336,35σ················· 38236,35σ
·
·
·
·
·
·
·
·
·
·
·
·
·
·
·
·
·
·
·
·
·
·
·
·
·
·
·
·
·
·
·
·
·
·
·
·
·
·
·
·
·
·
·
·
·
·
·
·
1
72,71σ 2 72,71σ 3 72,71σ 4 72,71σ 5 72,71σ 38372,71σ················· 38272,71σ
2556
383  
圖七、兩兩之間特徵區別值的向量示
意圖 
 
3. Chip Design 
藉由本實驗團隊研發出的支援向量機晶
片架構模組，應用在語音辨識機器人上的教
學來實現辨識模組。支持向量機之辨認所使
用的公式如下： 
( )
1
,
m n
i i ii
y y K x z bα+== +∑  
m 為被比較之第一類 Support Vector 個
數，n 為被比較之第二類 Support Vector 個
數，b 為修正偏移量，而其中核函數(Kernel 
function)的計算公式如下： 
( ) ( )2, expi iK x z x zγ= − −
 
而所計算出來的 y 值便能決定屬於第一
類或第二類。由計算公式可以知道，當中有
exponential的部分，但是一般來說 exponential
電路實際執行上太過龐大，所以我們使用數
段直線模擬之。圖八為辨識系統硬體完整架
構圖。利用此假構圖完整實現 SVM 的預測硬
體。 
 
