I 
 
 
摘    要 
在本計劃中，我們已深入研究目前 3GPP 制定的 IP Multimedia Subsystem (IMS)
架構與服務控制(Service Control)機制，並將此機制與 IN/CAMEL 技術中的服務觸發
(Service Triggering)機制相比較。觀察目前 IP 多媒體子系統(IMS)服務執行流程，當滿
足服務觸發的條件或情況發生，將由服務伺服器(Application Server；AS)來負責執行
相關的加值服務。而為了讓 AS 能適時掌握使用者狀態，只要用戶建立通話(Session)時
符合一些基本定義的條件(Filter Criteria)，就必須把 AS 加入 SIP 通話控制信令路徑
(Signaling Path)中，藉由監看通話狀態，以決定是否即時執行用戶所訂購的加值服務。
如此可以得知，在 IMS 架構服務控制下，所有符合基本條件可能觸發服務的 SIP 控制
訊息，都需繞送經過 AS；然而，許多加值服務在實際應用上真正需要被觸發執行的狀
況並不多見，如此轉送 SIP 訊息到 AS 的執行程序似乎顯的並非必要。在此計畫期末報
告中，便以 IN/CAMEL 觸發機制為基礎，提出了狀態感知服務觸發機制(state-aware 
service triggering mechanism)。此設計主要包含三個部份：設計通話狀態機(Session 
State Model；S2M)、修改目前 Filter Criteria 的內容和為觸發訊息設計 SIP Extension 
Methods。在本機制的運作下，只有在服務真正需要執行時，通話(Session)相關的 SIP
訊息才會被繞送到 AS。經過我們從服務範例中應用此機制，完成分析與比較後可發現，
本機制可改善 IMS 相當程度的效能。 
另外，我們也針對多方通話服務(Multiparty Service)與通話控制服務(Call Control 
Services)整合，可能發生的特徵衝突(Feature Interaction)問題，提出一個具備偵測與解
決特徵衝突的方法，稱為 ECOMPS (Extended COcoons for Multi-Party Service)。
ECOMPS 主要利用包缚在集中式多方通話服務外圍的 cocoon (稱之為 COMPS)，經由
修改在多方通話服務中原本的 SIP request messages，使其包含所有參與此多方通話服
務的用戶資訊；此外，運用 COCCS (COcoon for Call Control Services)，在修改過的
SIP request messages 中描述服務的執行狀況。特別的是，ECOMPS 可應用到 IMS 上
的 SCIM (Service Capability Interaction Manager)，在 SIP 應用伺服器之間偵測並解決
特徵衝突，即使是集中式多方通話整合的服務，也能偵測解決特徵衝突。最後將以多方
會議服務的例子來說明 ECOMPS 運作的流程。 
關鍵詞：IP 多媒體子系統(IMS)、智慧型網路/行動加值客制應用(IN/CAMEL)、議程
啟始協定(SIP)、服務觸發機制、服務控制技術、特徵衝突、多方通話服務、
服務能力互動管理者(SCIM) 
III 
 
 
目       錄 
中文摘要..................................................................................................................................... I 
英文摘要................................................................................................................................... II 
目錄.......................................................................................................................................... III 
1 前言......................................................................................................................................... 1 
2 研究目的................................................................................................................................. 2 
3 文獻探討................................................................................................................................. 3 
3.1 IMS 服務控制架構 .......................................................................................................... 3 
3.2 IMS 服務觸發流程 .......................................................................................................... 4 
3.3 IN/CAMEL 服務觸發技術 ........................................................................................... 4 
3.4 參考 cocoon 設計 ........................................................................................................... 5 
4 研究方法................................................................................................................................. 6 
4.1 IMS 上狀態感知之服務觸發機制(SAST) ..................................................................... 7 
4.2 SAST 之效能分析 ......................................................................................................... 12 
4.3 多方通話特徵衝突之偵測與解決 (ECOMPS) ........................................................... 16 
5 結果與討論........................................................................................................................... 21 
參考文獻.................................................................................................................................. 22 
計畫成果自評.......................................................................................................................... 24 
可供推廣之研發成果資料表.................................................................................................. 25 
附錄一 論文發表與投稿........................................................................................................ 26 
2 
 
行的時候不會有任何問題發生；但是在 SIP 通話控制服務之間的互動，不可預期的錯誤
就有可能產生。所以，當我們在 VoIP 中開發這些服務時，就必須考量到這些服務會有
特徵衝突的問題。在[13-20]的參考文獻中已經提出在兩方通話中要如何解決特徵衝突的
問題。目前 VoIP 最熱門的協議就是 SIP，3G/B3G 上的應用服務多以 SIP 來建立 session；
相對地，也增加了許多方法運用 SIP 建立的 connection，來處理 Feature Interaction，像
是採用”cocoon”的方式來避免 Feature Interaction[20]。然而，集中式多方通話的服務中 
(例如:多方會議、Push-to-Talk 的服務)，因為多方通話服務之伺服器與多個使用者之間
必須建立多條連線，所以當多方通話服務與通話控制服務整合時，多方通話服務有可能
造成通話控制服務的特徵衝突。目前針對此議題，尚未有任何解決方法被提出。所以，
本計劃也將針對多方通話服務與通話控制服務整合，可能發生的特徵衝突(Feature 
Interaction)問題，提出一個具備偵測與解決特徵衝突的方法。 
2. 研究目的  
本研究計畫探討 3GPP IP Multimedia Subsystem (IMS)架構中 SIP session/event state 
models 的設計；另外，我們也探討多方服務(Multiparty Service)與通話控制服務(Call 
Control Services)的整合應用，針對可能的 integrated service scenarios 進行分析，探討
service integration 過程中可能造成的 feature interaction 問題，並研究解決方案。 
首先，我們將參考 IN(Intelligent Network)/CAMEL(Customized Applications for 
Mobile network Enhanced Logic)服務觸發機制[21-24]，研究修改 IMS Service Triggering
運作機制，讓通話流程更有效率。利用 IN/CAMEL 在建立通話時有通話狀態機(call 
model)的概念，可以不需要再讓應用伺服器存在於通話控制信號之傳送路徑中，可縮短
通訊建立時間(call setup time)，並減少通訊控制訊息在網路上傳輸的數量以降低頻寬的
使用；此外，將服務觸發的方式分為要求(request)模式和通知(notify)模式，可改善觸發
機制必須暫停流程的缺點。為了達到我們的目標，我們首先需要修改 Filter Criteria 的類
別(class)，接著會針對 IMS 系統在 S-CSCF 上設計通訊狀態模型(session state model)，
並且針對不同的服務觸發方式，提出所需的 SIP extension methods 建議。 
此外，針對多方通話服務可能造成的特徵衝突問題，我們延伸”cocoon”的概念來解
決在多方會話服務可能造成的特徵衝突問題，提出一套具備偵測與解決特徵衝突的方
法，稱之為 ECOMPS (Extended COcoons for Multi-Party Service)。ECOMPS 的設計主要
是參考自[20]。其概念就是利用環繞在通話控制服務外圍的 cocoon 來監控不同的服務特
性，cocoon 描繪了服務的連線型態(connection type)並且偵測特徵衝突發生，可以在 SIP
通話控制服務之間偵測衝突並解決衝突。ECOMPS 包含了 COMPS(the COcoon for 
Multi-Party Services)與 COCCS(the extended COcoon for Call Control Services)的設計。
COMPS 將集中式的多方通話服務包在裡面，經由修改在多方通話服務中原本的 SIP 
request messages，使其包含所有參與此多方通話服務的用戶資訊；COCCS 則是在修改
過的 SIP request messages 中描述服務的執行狀況。特別的是，ECOMPS 可應用到 IMS
上的 SCIM (Service Capability Interaction Manager)，在 SIP 應用伺服器之間偵測並解決
特徵衝突，即使是集中式多方通話整合的服務，也能偵測解決特徵衝突。 
4 
 
3.2 IMS 服務觸發流程 
接下來簡介現有 IMS 服務觸發的執行流程如下：在 IMS 服務觸發機制上，Filter 
Criteria 扮演著比對(matching)、決定是否觸發服務的角色，電信網路業者會將每個電信
用戶的相關資料及設定(user profile) 存放在建置的 HSS 上，其中就包括了個人的 initial 
Filter Criteria (iFC)，iFC 內含的資料是依據用戶購買的服務而有所不同，將作為服務是
否觸發的參考依據。當用戶開機上線註冊，電信系統即會為該用戶選定一 S-CSCF 負責
其後續所有通話及服務觸發運作控制，在完成註冊同時，也將原先存在 HSS 的 initial 
Filter Criteria (iFC)下載到此 S-CSCF。後續該用戶上線註冊後的所有通訊活動(request)，
都將經由此 S-CSCF 控制，正好可在此 S-CSCF 比對 request messages 與 iFC，判斷是否
需為此用戶進行加值服務的觸發(參見圖 2)。 
圖 2  The process of S-CSCF service triggering in current IMS architecture 
3.3 IN/CAMEL 服務觸發技術 
在傳統電信 PSTN 網路上加值服務的觸發機制是參照 IN/CAMEL 技術，由 SSP 
(Service Switching Point)這個元件來處理，我們可發現其上的服務觸發機制是由一個通
話狀態機(call state machine)來描述通話進行的狀態，再根據目前的通話狀態與用戶提
供資訊，來判斷是否需要觸發加值服務。此狀態機包含了兩個部分: Point-in-Call (PIC)
和 Detection Point (DP)，PIC 代表各種動作(action)的集合，每當進入此狀態便會執行
PIC 中的動作集合，而 DPs 則是分布在 PICs 之間，各自 DP 擁有不同的觸發準則(trigger 
criteria)，扮演類似 IMS Filter Criteria 的角色，每當狀態機執行經過 DP，就進行檢查
比對，只要當時通話狀態和用戶提供資訊符合這些 trigger criteria 就會觸發加值服務，
使用 INAP(Intelligent Network Application Part)通訊協定，將服務觸發訊息送到提供該
服務的 SCP (Service Control Point)執行服務。另外，DP 也分為兩種觸發方式，一種為
6 
 
 
ConType : ID=CFU; TP=sip:Bob @ proxy-b.net;
OrigFrom=Alice @ proxy-a.net;
OrigTo=Bob @ proxy-b.net;
FinalFrom=Alice @ proxy-a.net; 
FinalTo=Chris @ proxy-c.net  
圖 4  CFU 服務的 ConType header 
 
圖 5  CFU 與 TCS 之間的特徵衝突 
為了解決偵測到的服務衝突，可以將其中一個服務 Disabled。假如我們現在要關掉
的是 TCS 的服務，就不會有 TCS 服務的結果產生。若假如我們要關掉 CFU 的服務，
cocoon 就會回應一個 380 Alternative Service Response 給請求端，且在 CFU 的 ConType 
header 中加一個 Status 的欄位，代表現在 CFU 的服務被關掉了。如圖 6 所示。 
ConType : ID=CFU; TP=sip:Bob @ proxy-b.net;
OrigFrom=Alice @ proxy-a.net;
OrigTo=bob @ proxy-b.net;
FinalFrom=Alice @ proxy-a.net; 
FinalTo=Chris @ proxy-c.net
Status= disabled  
圖 6  Status 欄位說明 CFU 服務被取消 
一旦 Caller 端收到 cocoon 送過來的 380 response, caller 就會重新發起一個新的
INVITE 請求訊息，裡面包含了 ConType header 與 Status 的欄位。所以當 CFU 的 cocoon
發現在 INVITE 訊息裡的 ConType header 與 CFU 服務能彼此配對的話，cocoon 就不會
執行 CFU 的動作，並且在把 request 訊息傳送出去之前，先將 ConType header 移除。 
4. 研究方法 
本計畫研究議題可分為兩個部分，首先是探討 3GPP IP Multimedia Subsystem (IMS)
架構中 S-CSCF 內部 IP Multimedia Service Control 之 SIP session/event state models 的設
計；另外，依據可能 integrated service scenarios 進行分析，設計 service integration 架構
及運作流程。 
• 設計 3GPP IMS 架構中 S-CSCF 內部 SIP session/event state models：將研究 3GPP 
IMS S-CSCF 上 Service Point Trigger (SPT)處理、Filter Criteria 比對的運作程序；
並參考目前 IETF RFC 3261 SIP transaction state machines 的設計[2]，分析
8 
 
有了此狀態機的概念，未來服務可以在特定狀態(PIC)結束後才進行比對執行。本狀態
機的設計將參考 IN/CAMEL 傳統電信網路的狀態機，並針對 3GPP IMS 的運作流程[12]
提出改善設計。 
下面做個簡單介紹，Originating Session State Model (O_S2M)和 Terminating Session 
State Model (T_S2M)如同 IN/ CAMEL 觸發機制一樣，會由許多 PICs 和 DPs 所所構成，
state models 的設計可參考圖 8 和圖 9，執行過程則類似 IN/CAMEL，每當 S-CSCF 收到
使用者外撥或來話的 SIP Invite 時，便會產生對應的 O_ S2M 或 T_ S2M 來提供服務；而
DP 則是利用修改的 initial Filter Criteria 達成，可以依據觸發狀態（Trigger State）這個
屬性適當分配到各個 DP 中，並利用優先權屬性依序比對，整個有限狀態機在 S-CSCF
上的運作可參考圖 10，而服務觸發流程則與 IN/CAMEL 相同，隨著 session state model
執行檢查相對應 DP，看是否有服務要觸發。而從我們提出的有限狀態機可以看出，簡
化了許多傳統 IN/CAMEL 有限狀態機的狀態流程，這是因為現今網際網路開放存取的
特性，以及使用者設備日益的強大緣故，連線的資源都是共用開放的，並且由使用者設
備來管理，大都不需要經過中間的傳輸伺服器做管理（特殊服務例外，如：會議服務），
中間傳輸建立通話的伺服器（例如：S-CSCF）只是幫助建立連線，所以很多傳統有限
狀態機的步驟流程也因此而簡化而不需要了。 
O_S2M 和 T_S2M 分別負責打電話端與接電話端的通話控制狀態機，圖 11 則以一通
話建立至結束為例，表現了這兩個 state models 間互動的情形。另外，我們也建議利用
S-CSCF 上既有的 SIP transaction state machines (RFC 3261[2])，在 SIP Transaction State 
Machines 上覆蓋(overlay)實作這些 state models (如圖 12)。這將使得基本的通話處理與
繞徑(call processing and routing)由 SIP transaction state machines 負責；而加值服務的觸
發就交給這些 session state models。這不但使得 S-CSCF 在實作上模組化，在系統的運
作分工上也更有效率。 
 
圖 7  The extended initial Filter Criteria class 
10 
 
 
 
 
圖 10  The processing of the state-aware mechanism 
 
 
 
1. INVITE
2. 180
4. ACK
5. BYE
3. 200
 
圖 11  Interactions between Originating and Terminating Session State Models 
12 
 
務觸發訊息的需求仍有些差異，下面我們將一一比較，說明不適合的原因，並把合適性
整理成表 2。 
1. Subscribe & Notify methods 的詳細內容可參考[25][26]，這兩個 methods 的功用是用
來監控狀態用的，使用方法如下：首先監控端可用 Subscribe method 來訂閱被監控
端的某些事件或狀態，然後當該事件或狀態發生時，被監控端會用 Notify Method 來
回應事件的發生與狀態的變化，所以兩個 methods 較適合用來做要求(request)模式的
服務觸發。我們在 S-CSCF 使用 Subscribe method 通知 AS 服務觸發，在 AS 用 Notify 
method 回應讓 S-CSCF 的有限狀態機恢復執行，並決定下一步的執行動作；而缺點
則是功能上的不適合，這兩個 methods 本是用來監控狀態的，所以傳送 Subscribe 時
要帶有欲監控的狀態，而 Notify 則是需回應監控狀態的現況，但服務觸發卻是
S-CSCF 要送出服務的要求給 AS，所以實行上會有些功能上差異的問題。 
2. Publish method 的詳細內容可參考[27]，此 method 類似 Register method，使用者可用
來修正該 AS 上使用者本身相關的狀態，使用方法如下：首先使用者將本身的資訊
放在 Publish 中，然後送到 AS 去做修改，此 method 適合用在通知(notification)模式
的服務，我們在 S-CSCF 使用 Publish method 通知 AS，告知有服務觸發；缺點則是
此 method 原本功能是建立或修改伺服器上的相關狀態，並在一段區間內要固定去更
新此相關狀態，但通知模式服務只需通知 AS 即可，其他功能是不需要可省略的。 
3. Do method 的詳細內容可參考[28]，此 method 是用來控制家網路設備用的訊息，使
用方法如下，首先將欲作用的家網路設備填在 SIP Request-URI header 中，然後欲執
行的動作放在 SIP message body 中，再傳送回家網路即可執行動作，此 method 適合
用在通知模式服務，我們只需將欲執行的服務填寫在 message body 中傳送給服務伺
服器即可，但問題在於通常 S-CSCF 不會知道要執行的服務是什麼，S-CSCF 只是做
通知的動作，而要做什麼服務是由 AS 來決定，所以此 method 也同樣有功能上的不
合適。 
表 2 Subscribe/Notify、Publish、Do 與服務觸發訊息的需求差異 
SIP Method  
Service Trigger  
Requirement  
Subscribe & Notify 
Method 
Publish Method Do Method 
暫停模式的觸發機制 可用，但仍有差異 不合適 不合適 
通知模式的觸發機制 不合適 可用，但仍有差異 不合適 
 
由此分析我們可知觸發服務訊息所需的條件，在此我們暫且訂定三個合適的 SIP 
methods：Query/Answer、Report methods，分別符合上表 Request、Notification modes
的條件，也許未來標準組織會提出量身訂做的 methods，本論文在此只是先提出個概念，
作為未來參考設計。 
4.2 SAST 之效能分析 
接下來將以一服務應用範例-無回應轉接服務(call forwarding on no answer) 
[29]，分析本研究結果所帶來 IMS 服務觸發效能的改善。 
14 
 
• 平均漫遊用戶的百分比：20% 
• 一通通話中，發話端與受話端屬於不同的業者之比例：60% 
於是，我們由以上數據計算出平均 P-CSCF 和 S-CSCF 間的傳輸成本( CSCFSCSCFPC −⇔− )
如下： 
yxC CSCFSCSCFP 8.02.0 +=−⇔− 。 
同樣地，我們可以得到以下的結果： 
yxCC CSCFSCSCFSCSCFICSCFS 4.06.0 +== −⇔−−⇔− 。 
為 了 簡 單 表 示 ， 我 們 使 得 CSCFSCSCFPCSCFSCSCFP CC −⇔−−⇔− = ， 以 及
CSCFSCSCFSCSCFSCSCFSCSCFICSCFSCSCFICSCFS CCCC −⇔−−⇔−−⇔−−⇔− === 。 
另外，由[31]中的通話統計資料中可知，無回應通話轉接服務發生的機率大約為
27%，所以我們計算 sap 和 sna 兩種情況的加權平均(C )如下： 
snasap CCC ×+×= 73.027.0 ， 
上式中的 sapC 和 snaC 即為 sap 和 sna 的總傳輸成本。我們依據圖 13 和圖 14 的通話建立
流程，計算出總傳輸成本於表 4 中，而改善程度 z 則表列於表 4 的最下方。 
圖 13  The processing of call forwarding on no answer service in the IMS 
16 
 
sap 
+×+×
++×
+×+×
−⇔−⇔−
−⇔−−⇔−
−⇔−−⇔
CSCFSCSCFIHSSCSCFI
CSCFSCSCFSCSCFICSCFS
CSCFSCSCFPCSCFPUE
CC
CC
CC
52
5
1616
ASCSCFSC ⇔−×16  (based on [12]) 
yx
yyxyx
2.388.616
23)4.06.0(6)8.02.0(1616
++=
+++++=  
+×+×
++×
+×+×
−⇔−⇔−
−⇔−−⇔−
−⇔−−⇔
CSCFSCSCFIHSSCSCFI
CSCFSCSCFSCSCFICSCFS
CSCFSCSCFPCSCFPUE
CC
CC
CC
52
5
1616
ASCSCFSC ⇔−×2  (based on [12]) 
yx
yyxyx
2.248.616
9)4.06.0(6)8.02.0(1616
++=
+++++=   
Weighted 
Average cost yx
yxyx
64.2548.516.10
)2158(73.0)2.388.616(27.0
++=
+++++
yx
yxyx
02.1648.516.10
)1358(73.0)2.248.616(27.0
++=
+++++  
Improvement 
Ratio z yx
y
yx
yxyxz
64.2548.516.10
62.9
64.2548.516.10
)02.1648.516.10()64.2548.516.10(
++=++
++−++=  
而圖 15 則是將 z 作為一個 function 以 x,y 為兩個軸描繪成圖，從圖中我們可以發現
當 2.0=y 和 1=x 時，本研究成果可改進 9.2%。另外，由[32]中的實驗結果可知，當控
制訊號是由高頻寬的無線存取網路來傳輸時，主要的通話建立延遲是發生在後端有線網
路，於是如圖所示，當 1=y 和 5=x 時，改善程度可以提升到 15.2%。 
 
圖 15  Improvement ratio z of the state-aware mechanism over the IMS-based 
service control of call forwarding on no answer service 
4.3 多方通話特徵衝突之偵測與解決 (ECOMPS) 
(1) ECOMPS 之設計概念 
SIP 通話控制服務會將一個會話的兩邊用戶都考量進去。這些服務利用檢查使用者
的位址(例如: 從誰送來的、要送給誰的)、或者利用修改 request URI 來處理一通會話。
一個集中式的多方會議服務可以使多個使用者彼此之間溝通。所以在集中式多方會議服
務和各個使用者之間需各自建立 session，但是在此情況下就有可能會發生特徵衝突。
18 
 
B.延伸自通話控制服務之 cocoon 
為了要偵測由集中式多方服務所引起的通話控制服務特徵衝突，在[20]中所提出的
cocoon 機制必須要被延伸。這個延伸的 cocoon 稱為 COCCS，COCCS 在 ConType header
中使用多的欄位去描述修改過的要求訊息其服務的執行狀況。圖 18 顯示了 CFU 的
ConType 延伸 header，Chris 會將打給他的通話轉接給 David。 
ConType : ID=CFU; TP=sip:Chris@proxy-c.net;
OrigFrom=conf-wklab@cs.ccu.edu.tw;
OrigFrom=Alice@proxy-a.net;
OrigFrom=Bob@proxy-b.net;
OrigTo=Chris@proxy-c.net;
FinalFrom=conf-wklab@cs.ccu.edu.tw;
FinalFrom=Alice@proxy-a.net;
FinalFrom=Bob@proxy-b.net;
FinalTo=David@proxy-d.net
 
圖 18  修改後的 CFU 服務的 ConType header 
(2) IMS 上 ECOMPS 之應用 
隨著 3GPP IP 多媒體子系統(IMS)興起，帶來了許多的加值服務，因此我們必須去
管理這些加值服務所造成的特徵衝突問題，Service Capability Interaction Manager (SCIM)
是 3GPP 定義用來管理多個 SIP 應用伺服器(AS)間的特徵衝突，在通話建立的時候，
SCIM 是 S-CSCF 和應用伺服器(AS)訊息傳輸的中介。 
A. ECOMPS 應用到 IMS SCIM 
我們在 SCIM 上採用 cocoon 的功能，SCIM 的功能主要為控制通話控制服務的連結
型態和偵測特徵衝突。當 SIP INVITE 從 S-CSCF 傳送向應用伺服器(AS)，SCIM 會在訊
息傳送到 AS 之前暫存這個 INVITE 訊息，如果沒有衝突的發生，這個暫存訊息會在時
間結束或是收到 200 OK 的回應訊息後，消除這個暫存。 
當應用伺服器(AS)通話控制服務執行完成後，AS 會在訊息中插入一個指示，指示
說明該要求的服務是否被啟動，如圖 19 所示，SCIM 會根據這個指示，判斷是否有特
徵衝突發生，Service-Indication header 會在 SCIM 將訊息傳給 S-CSCF 前被 SCIM 移除。 
INVITE sip:David@proxy-d.net SIP/2.0
From : sip:Alice@proxy-a.net;tag=171828 
To : sip:Bob@proxy-b.net
Service-Indication : ID=CFU; Activated=True
 
圖 19 服務指示延伸的 header 
20 
 
 
圖 21  採用了 ECOMS 的多方會議服務 
其餘的方法主要是著眼於特徵衝突的偵測，在[15][16]中，提出一個專門的特稱衝
突伺服器（feature interaction server），利用檢查數個 CPL 來偵測特徵衝突的發生，每一
個通話信息路徑上的代理伺服器，都必須上傳相關的 CPL script 給特稱衝突伺服器
（feature interaction server）。在[17-19]，也是相似的作法，介紹了一個新的元件，稱為
特徵衝突管理代理人（feature interaction management agent；FIMA），所有和通話相關的
訊息都會被送往 FIMA，然後去檢查服務間的特徵衝突。 
ECOMPS 是基於[20]所提出來的解決方法，主要用來偵測和解決由集中式多方服務
所造成的特徵衝突問題。這個方法和需要服務詳細服務資料的中央式偵測特徵衝突的方
法比起來，其複雜度比較低。而且因為它只需考慮通話連接型態，它適合用來偵測集中
式多方服務所造成的特徵衝突。表 5顯示了本章節中所提出的各種方法的比較。 
表 5. A Comparison with Related Approaches 
 New 
entity 
Interaction 
detection 
Resolution 
mechanism 
Required 
information 
Multi-party 
service 
[14]   negotiation   
[15,16] FI server 
semantic 
warnings  CPL scripts  
[17-19] FIMA mapped to FIML ∨  
service models 
(FIML)  
[20]  ConType header ∨  
connection 
level  
ours  modified request ∨  
connection 
level ∨  
 
22 
 
參考文獻 
[1] 3GPP TS 23.228, “IP Multimedia Subsystem (IMS);Stage 2(Release 6),” V6.6.0, 
June 2004. 
[2] J. Rosenberg, H. Schulzrinne, G. Camarillo, A. Johnston, J. Peterson, R. 
Sparks, M. Handley, E. Schooler, SIP: Session initiation protocol, RFC 3261, 
IETF, June 2002. 
[3] M. Handley et al., “SDP: Session Description Protocol,” RFC 2327, IETF, 
April 1998. 
[4] 3GPP TS 24.229, “IP multimedia call control protocol based on Session 
Initiation Protocol (SIP) and Session Description Protocol (SDP),” Stage 3. 
[5] 3GPP TS 22.141, “Presence Service; Stage 1(Release 6),” v6.2.1, July 2004. 
[6] P. Asprino, P. Vitiello, A. Fresa1, and M. Longo, “Implementation of a 
conference service in a 3G architecture,” SoftCOM 2002, 2002. 
[7] R. Venkatesha Prasad, Richard Hurni, and H. S. Jamadagni, “A scalable 
distributed VoIP conferencing using SIP,” ISCC 2003, 2003. 
[8] OMA, “OMA Push to talk Over Cellular,” Candidate Enabler, 2005, 
http://www.openmobilealliance.org/release_program/poc-v1_0.html. 
[9] V.K. Gurbani & Sun Xian-He, “A systematic approach for closer integration 
of cellular and Internet services,” Network, IEEE, Jan.-Feb. 2005.  
[10] V. W.-S. Feng, Y.-B. Lin, and S.-L. Chou, “Design and Implementation of a 
Softswitch for Third Generation Mobile All-IP Network,” Wireless 
Communications Systems and Networks (Ed. Mohsen Guizani), Kluwer 
Academic/Plenum Publishers, 2004. 
[11] V. K. Gurbani et al., “Interworking SIP and Intelligent Network (IN) 
Applications”, RFC 3976, IETF, January 2005. 
[12] 3GPP TS 23.218, IP Multimedia (IM) session handling; IM call model; Stage 
2(Release 7), V7.1.0, March 2006. 
[13] M. Calder, M. Kolberg, E.H. Magill, S. Reiff-Marganiec, “Feature interaction: a 
critical review and considered forecast,” Computer Networks, vol. 41, pp. 
115–141, 2003. 
[14] M. Kolberg, E. Magill, “Handling incompatibilities between services deployed 
on IP-based networks,” in: IEEE Intelligent Networks Workshop 2001 (IN2001), 
Boston, USA, May 2001. 
[15] M. Nakamura, P. Leelaprute, K. Matsumoto, T. Kikuno, “Semantic warnings 
and feature interaction in call processing language on internet telephony,” in 
Proc. of SAINT 2003, pp. 283-291, Jan. 2003. 
[16] M. Nakamura, P. Leelaprute, K. Matsumoto, T. Kikuno, “On detecting feature 
interactions in the programmable service environment of internet telephony,” 
Computer Networks, vol. 45, pp. 605-624, 2004. 
24 
 
計畫成果自評 
本期末報告研究內容與原計畫預期成果相符，研究議題主要可分為兩個部分，首先
是探討 3GPP IP Multimedia Subsystem (IMS)架構中 S-CSCF 內部 IP Multimedia Service 
Control 技術，研究 SIP session/event state models 之設計；另外，我們也探討應用整合時
的服務控制(Service Control for Integration of Applications)，針對 service integration of call 
control services 的運作流程，分析 service integration 過程中可能造成的 feature interaction
問題，研究可能之解決方案。 
本計畫提出了改進 IMS 服務觸發的機制，使得使用者發出的 request 不再只為了讓
AS 能監控通話進行，就把控制訊息繞送給 AS，而是只有在需要加值服務的情況，
S-CSCF 才會把控制訊息傳送給 AS，這樣可縮短通訊建立時間(call setup time)，並減少
通訊控制訊息在網路上傳輸的數量，以降低頻寬的使用。 
另外本計畫提出了一個稱為 ECOMPS 的即時處理機制，可以用來偵測和解決多方
服務與通話控制服務整合時，可能造成的特徵衝突問題。同時我們也將 ECOMPS 應用
在 IP 多媒體子系統(IMS)上，與 IMS SCIM 結合應用。 
計畫部份研究成果已在國際研討會發表[R1-R2]，並投稿至國際期刊[R3-R5]，也發
表在國內學術期刊[R6]。我們預計將設計之 Call Control Service Invocation Function 機制
申請專利，並將此結果投稿至國際期刊。 
[R1] Chiang, Wei-Kuo, and Cheng-Yang Tseng, “Handling Feature Interactions for 
Multiparty Services in 3GPP IP Multimedia Subsystem,” accepted for the 1st 
International Conference on IP Multimedia Subsystems Architecture and Applications 
(IMSAA’07), 6-8 December, 2007, Bangalore, India. 
[R2] Chiang, Wei-Kuo, and Huang, Hsin-Fu, “Network-initiated triggering for 
mobility in voice over 3GPP-WLAN,” 4th European Conference on Universal 
Multiservice Networks (ECUMN'07), pp. 320-326, 2007. 
[R3] Chiang, Wei-Kuo, and Chen, Hsuan-Ting (2006) “State-aware service triggering 
in the IP multimedia subsystem,” submitted to IEEE Communications Magazine 
(under Revision). 
[R4] Chiang, Wei-Kuo, and Huang, Hsin-Fu (2007) “Network-initiated terminal 
mobility in voice over 3GPP-WLAN,” submitted to Journal of Networks. 
[R5] Chiang, Wei-Kuo, and Chang, Wen-Yen (2007) “Network-initiated 
simultaneous mobility in voice over 3GPP-WLAN,” submitted to IEEE Wireless 
Communications. 
[R6] 江為國，許鴻基，陳炫廷(2007)「IP多媒體子系統服務觸發機制之設計(Design of 
the Service Triggering Mechanism in the IP Multimedia Subsystem)」，IICM 第
十卷 第一期 民國九十六年三月，(pp.123-140)。 
26 
 
 
 
Referred Conference Paper(學術會議論文) 
[1] Chiang, Wei-Kuo, and Cheng-Yang Tseng, “Handling Feature Interactions for 
Multiparty Services in 3GPP IP Multimedia Subsystem,” accepted for the 1st 
International Conference on IP Multimedia Subsystems Architecture and Applications 
(IMSAA’07), 6-8 December, 2007, Bangalore, India. 
[2] Chiang, Wei-Kuo, and Huang, Hsin-Fu, “Network-initiated triggering for 
mobility in voice over 3GPP-WLAN,” 4th European Conference on Universal 
Multiservice Networks (ECUMN'07), pp. 320-326, 2007. 
[3] Chiang, Wei-Kuo, and Huang, Hsin-Fu, “Mobility over 3GPP VoWLAN using 
the CAMEL concept,” National Symposium on Telecommunications, Dec. 2, 2006. 
 
Submitted to International Journal Papers(投稿國際期刊論文) 
[1] Chiang, Wei-Kuo, and Huang, Hsin-Fu (2007) “Network-initiated terminal 
mobility in voice over 3GPP-WLAN,” submitted to Journal of Networks. 
[2] Chiang, Wei-Kuo, and Chang, Wen-Yen (2007) “Network-initiated simultaneous 
mobility in voice over 3GPP-WLAN,” submitted to IEEE Wireless Communications. 
[3] Chiang, Wei-Kuo, and Chen, Hsuan-Ting (2006) “State-aware service triggering 
in the IP multimedia subsystem,” submitted to IEEE Communications Magazine 
(under Revision). 
 
Patent(專利) 
[1] Chiang, Wei-Kuo, and Lee, Pei-An, “Method and Apparatus of the Lawful 
Interception for Services in IP Multimedia Subsystem,” CCL approved, U.S. and 
Taiwan. Patent Pending, 2007. 
[2] Chiang, Wei-Kuo, and Ho, Che-Shiun, Hsu, Chien Chan, “Method and 
apparatus for mobility management in communication networks,” CCL 
approved, Europe and R.P.C. Patent Pending, 2005. 
 
Chinese Journal Paper(中文期刊論文) 
[1] 江為國，許鴻基，陳炫廷(2007)「IP多媒體子系統服務觸發機制之設計(Design of the 
Service Triggering Mechanism in the IP Multimedia Subsystem)」，IICM 第十卷 
第一期 民國九十六年三月，(pp.123-140)。 
附錄一 
II. BACKGROUNDS AND RELATED WORKS 
SIP standard is now in much discussion and seems to be the 
most popular protocol used for VoIP. It is a text-based HTTP-
like protocol used for session setup, modification and 
termination in the application layer. Recently, along with the 
emergence of 3GPP IMS, call control services can be deployed 
on SIP application servers. A brief overview of SIP 
architecture and IMS architecture is given in this section. 
A. SIP architecture with call control services 
The main components in a SIP network are the user agent, 
the registrar server, the proxy server and the redirect server. 
There are two roles that played by the user agent: the user 
agent client and the user agent server. The former initiates SIP 
requests, and the latter generates provisional and final 
responses. The registrar server is responsible for keeping track 
of the users’ location. The proxy server is in charge of routing 
requests and responses to the user agent. The redirect server 
receives SIP request and then returns alternative location where 
the user targeted by the request may be available. In a SIP call 
session, a request originated from a user agent, travels through 
one or more proxy servers and terminates in another user agent. 
Fig. 1 shows the processing of session establishment. 
There are two types of the SIP message: requests and 
responses. Requests and responses are grouped together into 
transactions. Each transaction consists of a request, one or 
more provisional responses and a final response. A basic 
transaction begins by a user agent client sending an INVITE 
request including the address of the caller (in the From header 
field), the address of the intended callee (in the To header field), 
and the address indicates the user to which this request is being 
addressed (Request-URI). 
 
Figure 1.  The processing of session establishment. 
The SIP call control service is used for directing the session 
establishment. For examples, CFU (call forwarding 
unconditional), CFB (call forwarding on busy), OCS 
(originating call screening), and TCS (terminating call 
screening). The call control service is used for changing the 
call setup request different from the original call attempt. For 
instance, the CFU service forwards the INVITE request to a 
new destination by overwriting the address of Request-URI 
field in the INVITE message. 
B. IMS architecture for service provisioning 
3GPP IMS utilizes SIP as the signaling protocol. The 
functional architecture of IMS, as shown in Fig. 2, can be 
divided into three layers: transport layer, session control layer, 
and application layer. 
 
Figure 2.  Functional architecture of IMS. 
The transport layer in IMS is access agnostic so that a 
common IMS based service platform can be built to support 
various access networks such as DSL, cable, CDMA/UMTS 
and WiFi/WiMax. 
The session control layer of IMS is in charge of the session 
establishment, control and termination. The network entities 
for the session handling are call session control functions 
(CSCF). There are three types of CSCF in the session control 
layer: Proxy-CSCF (P-CSCF), Interrogating-CSCF (I-CSCF) 
and Serving-CSCF (S-CSCF). The HSS stores user-related data 
on behalf of each application server. At registration time of 
IMS user, the HSS data is sent to the S-CSCF over the Cx 
interface. 
The service capability interaction manager (SCIM) is a 
specialized type of SIP application server that introduced by 
3GPP. The SCIM aims to manage the interactions between 
services that deployed on SIP application servers. In the 
specification, the functionalities of SCIM for performing the 
interaction management are not defined clearly. 
C. The reference approach 
The approach proposed in [9] introduced the design of the 
cocoon which surrounds the call control service as the feature 
controller. We describe this approach below in detail. 
The concept of the approach is to focus on the call 
connection controlled by the call control service (e.g., from A 
to B). Conflict detection and resolution between SIP call 
control services is performed by the cocoon. The cocoon 
describes the connection type of the surrounded service and 
detects the feature interaction. The implementation of 
connection type for describing service is a ConType header as 
SIP extension. 
The call control service executes the service logic first 
while an INVITE request arrives. On finishing the execution, 
an indication from the service indicates whether the service is 
activated by the INVITE request. If the service is not activated, 
the cocoon has nothing to do. Otherwise, it checks whether the 
ConType header exists in the message. If the ConType header 
is not found, the cocoon inserts the ConType header which 
describes the surrounded service. An example of the ConType 
header describing the CFU service is shown in Fig. 3. 
ConType : ID=CFU; TP=sip:Bob @ proxy-b.net;
OrigFrom=Alice @ proxy-a.net;
OrigTo=Bob @ proxy-b.net;
FinalFrom=Alice @ proxy-a.net; 
FinalTo=Chris @ proxy-c.net  
Figure 3.  A ConType header for the CFU service. 
ConType : ID=CFU; TP=sip:Chris@proxy-c.net;
OrigFrom=conf-wklab@cs.ccu.edu.tw;
OrigFrom=Alice@proxy-a.net;
OrigFrom=Bob@proxy-b.net;
OrigTo=Chris@proxy-c.net;
FinalFrom=conf-wklab@cs.ccu.edu.tw;
FinalFrom=Alice@proxy-a.net;
FinalFrom=Bob@proxy-b.net;
FinalTo=David@proxy-d.net  
Figure 8.  The ConType header of CFU in the modified request. 
The COCCS’s behavior is the same as the original cocoon’s 
one in [9]. If the centralized multi-party service is involved in 
the users’ communication, the COCCS can detect and resolve 
the feature interaction caused by the centralized multi-party 
service. 
IV. APPLYING TO THE IMS ARCHITECTURE 
Along with the emergence of 3GPP IMS which would 
bring us many value-added services, there is a need to manage 
the feature interaction between these value-added services. The 
SCIM defined by 3GPP could be used for the management of 
the feature interaction between multiple SIP application servers. 
To this end, the SCIM needs to intermediate the transmission 
of messages between the S-CSCF and the AS while 
establishing the call session. 
A.  Applying to the SCIM in the IMS architecture 
Here we apply the cocoon’s functionality to the SCIM 
which intermediates the transmission of messages. The SCIM 
contains connection types of call control services and detects 
the feature interaction.  
Whenever an INVITE request message is being forwarded 
from the S-CSCF to the AS where the SIP call control service 
is deployed on, the SCIM caches the request message before 
relaying to the AS. The cached INVITE request is used for the 
resolution of the feature interaction. If there is no conflict 
occurs in the call session establishment, the cached request will 
be erased on timeout or receiving a 200 OK response to the 
request. 
 After the AS finishes the execution of the call control 
service, the AS would insert an indication into the message. 
This indication is used to indicate that whether the service is 
activated by the request message (e.g., changes the address in 
the Request-URI header). An example of indication from the 
AS which contains the CFU service is shown in Fig. 9. The 
SCIM performing the detection of the feature interaction is 
relying on the indication. The Service-Indication header will be 
removed by the SCIM when relaying the message to the S-
CSCF. The concept of the Service-Indication header could be 
useful while implementing the SCIM for managing not merely 
call control services but value-added services that are deployed 
on the AS in the future. 
INVITE sip:David@proxy-d.net SIP/2.0
From : sip:Alice@proxy-a.net;tag=171828 
To : sip:Bob@proxy-b.net
Service-Indication : ID=CFU; Activated=True  
Figure 9.  An extension header for service indication. 
On the detection of the feature interaction between two call 
control services, if a decision is made that the first service 
needs to be disabled, the SCIM of the second service would 
responds to the request with the 380 Alternative Service. When 
the SCIM of the first service receives the response, the cached 
INVITE request will be sent out before erased. In this way, the 
AS with the forbidden service will not be involved in the call 
signaling path. If the second service is considered to be 
disabled, the SCIM of the first service simply discards the 
outcome and sends out the cached request before erased.  
The TCS service could be taken to screen the call from 
some unwelcome parties such that the subscriber is not to be 
disturbed. If the address of the caller in the INVITE message 
matches any address in the subscriber’s screening list, the call 
is screened.  
Fig. 10 shows the processing of resolving the feature 
interaction between CFU and TCS within single call session 
establishment in the IMS. 
 
Figure 10.  Resolving the feature interaction between CFU and TCS. 
B.  Applying the ECOMPS for the multi-party service 
We take the multi-party conferencing service as an example, 
and the ECOMPS is applied to solve the feature interaction. 
The multi-party conferencing service within the IMS is defined 
in 3GPP TS 24.147 specification [11]. The feature interaction 
problem induced by the conferencing call would occur while 
creating the conferencing call with the conference URI.  
Assumes Alice is trying to make a conferencing call with 
Bob and Chris as participants within the IMS Architecture; 
however, Chris subscribed the TCS application server with a 
screen list containing Alice. Alice first sends an INVITE 
request to the conference server which located in the IMS 
home network. The message body contains the SIP URI list [12] 
indicating users that Alice wishes to communicate with. 
The conference server then invites the users to join the 
conferencing call.  Once the ECOMPS is applied to the IMS 
SCIM, the INVITE request originated by the conference server 
is modified by the COMPS surrounding the IMS conferencing 
service, and then the feature interaction between the IMS 
conferencing service and the TCS AS can be resolved, as 
shown in Fig. 11. 
When the modified INVITE message arrives at Chris’ 
home network, the TCS AS will be activated by the modified 
request message. Therefore the modified request message is 
screened by the TCS AS. Consequently, Chris would not be 
disturbed by Alice since the TCS AS works correctly on the 
modified request message. 
Network-Initiated Triggering for Mobility in Voice over 3GPP-WLAN 
 
 
Wei-Kuo Chiang and Hsin-Fu Huang 
Department of Computer Science & Information Engineering, National Chung Cheng University, 
Chiayi 621, Taiwan, R.O.C. 
{wkchiang, hhf92}@cs.ccu.edu.tw  
 
 
Abstract 
 
This paper proposes a network-initiated triggering 
mechanism to facilitate terminal mobility with the 
session initiation protocol (SIP) in 3GPP Voice over 
WLAN (VoWLAN). We design the E2E Tunnel State 
Model running on the packet data gateway (PDG) 
using the CAMEL concept, and introduce the Mobility 
Server to re-establish sessions with third party call 
control (3PCC). The Mobility Server is triggered to 
provide the terminal mobility service from the PDG by 
detecting the state transition of E2E Tunnel State 
Model that represents the occurrence of a handover. 
This mechanism can advance the time to re-establish 
sessions. That is, our approach can provide smaller 
handover delay than SIP Mobility; moreover, it can 
handle mobility without additional support from the 
mobile host. In addition, the handover missing problem 
(messages lost) might happen when the MH moves 
under communication. With the help of the Mobility 
Server, the lost messages are re-sent, and the handover 
missing problem, including simultaneous movement, is 
therefore solved. 
 
1. INTRODUCTION 
 
WLAN has the advantages of high bandwidth and 
low license cost, compared with UMTS/GPRS, so it 
can provide users rich multimedia services with lower 
price. Voice over IP (VoIP) has developed rapidly in 
recently years. VoIP allows us to make telephone calls 
in data networks like the Internet. VoIP avoids the tolls 
charged by ordinary telephone service and can provide 
more new services. With rapid deployment of WLAN, 
it becomes the current trend to apply VoIP to WLAN. 
However, mobile users accessing WLAN are free to 
move, an efficient terminal mobility mechanism is 
crucial in VoWLAN. 
SIP Mobility is an application layer solution to 
terminal mobility [1][2]. However, the major drawback 
of SIP Mobility is the considerable handover delay 
which makes it unsuitable for real-time services such 
as VoIP. Hence we propose a network-initiated 
triggering mechanism (NTM) to shorten the handover 
delay. By applying the concept of IN/CAMEL, we 
design the E2E Tunnel State Model running on the 
packet data gateway (PDG). We add a SIP-based 
Application Server, Mobility Server (MS), to IMS in 
VoWLAN. The MS can re-establish session with third 
party call control (3PCC). The MS is triggered to 
provide terminal mobility service from the network 
component PDG by tracking the detection points in the 
state transition of E2E Tunnel State Model. Because 
the NTM is an active-triggering mechanism, it avoids 
the passive-triggering drawback in SIP Mobility that 
the MH has to poll the operation system to detect the 
change of IP address [3]. Therefore, our approach can 
provide small handover delay and can handle mobility 
without additional support from Mobile Host (MH). 
Moreover, the handover missing problem might 
happen when the MH moves under communication. 
The handover missing problem means that there are 
messages sent to the MH which happens to change its 
location. These messages get lost since these messages 
are sent to the MH's previous location. Simultaneous 
movement is a special case of the handover missing 
problem. It happens when both communicating sides 
are changing their IP addresses, and it might lead to the 
termination of a session. With the help of the Mobility 
Server, the lost messages are re-sent, and the handover 
missing problem, including simultaneous movement, is 
therefore solved. 
The aim of this paper is to investigate the terminal 
mobility in 3GPP VoWLAN. In section 2, 3GPP 
VoWLAN architecture and preliminaries are 
introduced. In section 3, a network-initiated triggering 
mechanism (NTM) is proposed to handle the terminal 
mobility. In section 4, we discuss the effect of 
simultaneous movement to the terminal mobility and 
describe how the NTM solves the handover missing 
problem. In section 5, we evaluate the handover delay 
for the terminal mobility and the extra delay caused by 
simultaneous movement. In section 6, we conclude this 
paper. 
Proceedings of the Fourth European Conference on Universal Multiservice Networks (ECUMN'07)
0-7695-2768-X/07 $20.00  © 2007
C. SIP Mobility in Voice over 3GPP-WLAN 
SIP Mobility supports terminal mobility at the 
application layer and can be applied to 3GPP-WLAN 
interworking architecture. Figure 3 shows the SIP 
Mobility flows. 
Step 1. The MH leaves WLAN1 and attaches to 
WLAN2. 
Step 2-7. The MH performs SIP registration. 
Step 8-10. The MH sends a re-INVITE request to 
the CH to re-establish session. 
Step 11. New session is created. 
The original idea of SIP Mobility is to re-establish 
session before SIP registration. However, in VoWLAN, 
the MH may not be allowed to register in the new 
P-CSCF network, so the MH has to perform SIP 
registration to check the permission before sending a 
SIP re-INVITE request. 
 
Figure 3: Message Flows for SIP Mobility in VoWLAN. 
 
3. NETWORK-INITIATED TRIGGERING MECHANISM 
 
The handover process stops the communication for a 
period of time and is a serious problem for real-time 
services such as VoIP.  In SIP Mobility, the MH 
re-establishes the session when it moves to different 
networks. Because the MH usually detects the change 
of IP address by polling the operation system, the 
polling time becomes a significant part of the handover 
delay. Hence, we propose a network-initiated 
triggering mechanism (NTM) to reduce the handover 
delay in this section.  
In the NTM, we design the E2E Tunnel State Model 
running on the packet data gateway (PDG), and add a 
new SIP-based Application Server, Mobility Server 
(MS), to IMS in VoWLAN. The MS can re-establish 
session with 3PCC. The 3PCC refers to the ability of 
one entity to create a call in which communication is 
actually between other parties [8][9]. The MS is 
triggered to provide terminal mobility service from the 
PDG. Because the MS is notified actively, the polling 
interval can be removed. Moreover, there is no need 
for the MH to support any terminal mobility, since the 
session is re-established by the MS. 
A. VoWLAN E2E Tunnel State Model 
We refer to CAMEL phase 3 to design the 
VoWLAN E2E Tunnel State Model. The VoWLAN 
E2E Tunnel State Model runs on the PDG and tracks 
the state of the tunnel between the MH and the PDG. 
This state model is shown in Figure 4. The Dynamic 
Area (DA) is similar to Routing Area in UMTS/GPRS 
and is composed of one or several WLANs.  
 
Figure 4: VoWLAN E2E Tunnel State Model. 
If the MH subscribes a MS to support terminal 
mobility, the SIP Subscriber Information (SSI) related 
to the MS must be retrieved from the 3GPP AAA 
Server or HSS to the PDG to maintain the VoWLAN 
E2E Tunnel State Model when the MH attaches to the 
PDG. The SSI contains the address of a SIP AS (here, 
the MS), identification of the service to be invoked 
(service key), list of detection points to be armed, and 
an indication of default handling in case of exceptions. 
When the MH moves to another Dynamic Area and 
attaches to another PDG, the subscribed service might 
be triggered due to the state transition of the E2E 
tunnel state model running in the new attached PDG. 
That is, the new PDG sends a PUBLISH (a SIP 
message) request to the MS to inform of the MH’s 
latest location; and then, the MS executes the terminal 
mobility service for the MH, and the session is able to 
continue. 
B. Mobility Server 
The MS is a SIP Application Server in IMS, which 
can also be seen as the mobile agent of the MH. When 
the MH moves to different network, the PDG notifies 
the MS of the MH's latest location, and then the MS 
re-establishes the session with 3PCC.  
With the help of the MS, one approach is proposed 
to handle the handover missing problem. The approach 
uses the MS to buffer the SIP messages sent to the MH, 
and the MS re-sends the buffered messages to the MH 
in case of handover missing problem. Therefore, the 
MH can receive the lost messages. 
All the messages buffered in the MS are released 
Proceedings of the Fourth European Conference on Universal Multiservice Networks (ECUMN'07)
0-7695-2768-X/07 $20.00  © 2007
Step 7. SIP registration completes. The MS replies a 
200 OK response to the PDG. 
Step 8-22. The MS re-establishes session with 3PCC. 
All the SIP messages should be buffered in the MS at 
both sides to be prepared for the handover missing 
problem. 
Step 23. Session re-establishment completes. The 
MH and the CH resume their communication. 
 
Figure 7: A PUBLISH Request from the PDG to the MS. 
 
4. SOLUTIONS TO SIMULTANEOUS MOVEMENT  
 
In this section, we take the simultaneous mobility 
problem for example to describe how the NTM solves 
the handover missing problem. 
A. MH-Triggering for Simultaneous Movement 
K. Daniel Wong, Ashutosh Dutta and Ken Young 
proposed a mechanism to solve the simultaneous 
mobility problem [11], and here we call this 
mechanism as "MH-triggering mechanism (MHT)". In 
the MH-triggering mechanism, two new stationary 
components are proposed: 
1. Stationary binding update proxy: update the MH's 
latest location to the CH, 
2. Stationary location proxy: store the MH's latest 
location. 
To apply the MH-triggering mechanism in IMS, the 
S-CSCF shall act as both stationary binding update 
proxy and stationary location update proxy, and the 
SIP re-INVITE request shall act as location update 
message. After the MH moves to a new network, the 
MH sends a REGISTER request to the S-CSCF to 
update location, and the S-CSCF would forward SIP 
re-INVITE request to the MH's latest location at once. 
Figure 8 shows the MH-triggering mechanism flows. 
Both MH1 and MH2 re-establish session with SIP 
Mobility. 
Step 1. MH2 moves from WLAN4 to WLAN3. 
Step 2-7. MH2 detects the change of IP address and 
then performs SIP registration. 
Step 8. MH1 moves from WLAN1 to WLAN2. 
Step 9. MH2 sends a re-INVITE request to MH1 to 
re-establish session. However, MH1 doesn't perform 
SIP registration yet, this re-INVITE request is sent to 
WLAN1, and MH1 therefore loses this message. 
Step 10-15. MH1 detects the change of IP address 
and performs SIP re-registration. 
Step 16. MH1's S-CSCF re-sends the re-INVITE 
request to MH1 in WLAN2. 
 
Figure 8: MH-Triggering Mechanism for Simultaneous Mobility. 
B. The NTM for Simultaneous Movement 
In the NTM, all of the SIP messages are forwarded 
to the MS, and the MS would buffer all of these 
messages. After the PDG informs the MH’s latest 
location to the MS, the MS re-send these buffered 
messages to the MH’s latest location immediately to 
solve the simultaneous mobility problem. 
 Figure 9 shows the message flows of the 
network-initiated triggering mechanism to handle 
mobility under simultaneous movement. 
 
Figure 9: The Network-Initiated Triggering Mechanism for 
Simultaneous Mobility. 
PUBLISH MH1_public1@ms.home1.net SIP/2.0 
Via: SIP/2.0/UDP [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7 
From: MH1_public1@PDG1.home2.net>;tag=31415 
To: MH1_public1@ms.home1.net 
Call-ID: b89rjhnedlrfjflslj40a222 
CSeq: 61 PUBLISH 
Event: presence 
Expires: 7200 
Content-Type: application/pidf+xml 
Content-Length: (...) 
 
<?xml version="1.0" encoding="UTF-8"?> 
   <presence xmlns="urn:ietf:params:xml:ns:pidf" 
             xmlns:ms="http://ms.home1.net/presence/" 
             entity="pres:MH1_public1@PDG1.home2.net"> 
     <tuple id="a8098a.672364762364"> 
       <status> 
         <basic>open</basic> 
  <ms:Mobility>yes</ms:Mobility> 
       </status> 
       <ms:PubID>MH1_public1@SIP1.home1.net</ms:PubID> 
       <ms:PivID>284011234567890</ms:PivID> 
       <ms:HNDN>wlan.mnc123.mcc456.home1.net</ms:HNDN> 
       <ms:RoA>123.111.122.133</ms:RoA> 
       <ms:AoPCSCF>123.111.122.100</ms: AoPCSCF > 
     </tuple> 
   </presence> 
Proceedings of the Fourth European Conference on Universal Multiservice Networks (ECUMN'07)
0-7695-2768-X/07 $20.00  © 2007
