 2
行政院國家科學委員會專題研究計畫成果報告 
 
創新手輪馬達電動輪椅混合動力系統整合研究與開發 
－子計畫二:質子交換膜燃料電池模組的系統識別、控制與系統整合 
System Identification, Control and Integration of the Proton Exchange Membrane Fuel Cell 
Module for a Hybrid Electric Powered Wheelchair with Innovative Rim Motors 
 
摘要 
本計畫之目標在於整合燃料電池系統與電動輪椅系統，以質子交換膜燃料電池搭配二次電池，作
為電動輪椅的電力來源。研究分為三部分進行：燃料電池的控制、電力管理系統的設計、輪椅馬達的
控制與全車之整合。 
    首先，在燃料電池控制方面，我們將其視為一雙輸入單輸出的系統，輸入為氫氣與空氣的流量，
輸出為燃料電池的電壓，透過強韌控制器的設計與安裝，以達到穩定輸出電壓的目標，並同時減少了
氫氣消耗與能量消耗。 
    其次，將燃料電池搭配兩組磷酸鋰鐵電池，規劃串聯式混合電力鏈，依據它們的動態特性，制定
合適的電力管理策略。首先建立充電與供電迴路，其中一個電池組提供電力給後端負載，另一個電池
組作為備用電力。當第一個電池組的電量降至一個選定值時，切斷其供電迴路並控制燃料電池以定電
壓對其進行充電，而當其供電迴路被切斷的同時，另一個備用電池的供電迴路會被打開，使後端的電
力供應不會間斷。由實驗結果顯示，整個電力轉換和傳輸的過程相當成功。 
    最後，進行電動輪椅馬達的控制，利用馬達控制卡與二維操縱搖桿，控制雙輪馬達的行進、加速
與轉向。並將前面所設計的兩個子系統與電動輪椅進行系統整合，以提供電動輪椅穩定且持續的電力
供應。 
關鍵詞：質子交換膜燃料電池、強韌控制、磷酸鋰鐵電池、電動輪椅、系統整合 
 
 4
1. 簡介 
     
由於石油能源日益枯竭、全球暖化日益嚴重等問題，人們漸漸開始尋找替代的乾淨能源，成為永
續發展的共同目標。其中質子交換膜燃料電池具備低溫操作、高效率、低汙染等特性，是具發展潛力
的綠色能源，且符合時代的趨勢所需。簡單地說，燃料電池並非一般電池，而是將燃料的化學能透過
電化學反應直接轉換為電能與熱能的一種發電裝置，其能量轉換效率高於一般熱機，整個能量轉換過
程中燃料電池不需經過燃燒，而反應後的生成物為可供飲用的水及能夠回收利用的熱能，所以較其他
能源更為潔淨。質子交換膜燃料電池目前已被廣泛應用於各種輕型電動車輛上，像是電動腳踏車、高
爾夫球車、小型載客車等等。在本計畫中，我們將質子交換膜燃料電池整合於輕型電動輪椅，作為電
動輪椅的動力來源。傳統的輪椅，需要介護者在輪椅後端輔助，或是藉由操作者自己手臂的力量驅動，
並不利於長時間操作，大幅增加人力的成本；而電動輪椅的發明，雖然帶來相當的方便，但一般的電
動輪椅因為受限於電池的電容量，往往行走一段時間後就會面臨電池沒電的情況，此時必須在半途中
更換電池，或是想辦法對電池進行充電。對使用者來說，輪椅只能行駛一段特定的距離，一旦超過這
個安全距離，就必須要折返回去充電，或是能夠在電池完全沒電前找到可以充電的地方。 
為了解決此一續航力的問題，我們將質子交換膜燃料電池搭配二次電池組，設計適當的電力供應
鏈，建立充電與放電迴路，依據燃料電池與二次電池的動態特性，作最佳的操作切換，一方面使電動
輪椅的行進保持順暢，一方面使能源管理操作在最佳效率的狀況。 
 
2. 燃料電池的工作原理與系統架構 
 
2.1 質子交換膜燃料電池的工作原理 
質子交換膜燃料電池是以氫氣為燃料氣體，空氣或純氧為氧化劑，其電化學反應過程中的輸送現
象包括：在陽極中，反應氣體在電極擴散層內擴散，氫氣在電極觸媒層內被觸媒吸附並發生氧化反應
解離成氫離子與電子，氫離子在質子交換膜內從陽極側傳到陰極側，電子同時在雙極板間傳遞與經由
外部電路對負載作功後移往陰極；在陰極中，氧分子、電子、氫離子在觸媒的催化下發生還原反應生
成水，如圖 1 所示，各反應方程式描述如下： 
 6
表 1. Palcan 燃料電池規格書 
500W Air-Cooling Stack 
Electrical Voltage 24~37V DC 
Nominal Power 500W 
Efficiency@500W >47% 
Size 11.7cm*11.3cm*25cm 
Weight 2.4kg 
Reactant Air  
Flow rate 30SLPM 
Inlet Dew Point 
Temperature 
50℃ 
Inlet Pressure 5 psig 
Reactant 
Hydrogen  
Flow rate 6SLPM 
Inlet Dew Point 
Temperature 
50℃ 
Inlet Pressure 5 psig 
 
 
圖 2. 燃料電池系統組合圖 
 
 
 8
eZ
 
圖 4. 燃料電池系統動態模型方塊圖[2] 
 
3.3 系統鑑別 
    由於質子交換膜燃料電池本身的電化學方程式十分複雜，因此我們利用黑箱模型化的方法，將控
制對象視為一個黑箱，由系統的觀點去比較其輸入、輸出的關係，此方法亦稱為系統識別法[3]。透過
設計實驗擷取其輸入、輸出資料，再經由適當的資料處理，找到合理的系統數學模型來代表這個系統
的動態行為，將其表示成多輸入多輸出的型式，如圖 5 所示，其中 NH2 與 Nair 分別為氫氣流量與空氣
流量，I 與 V 則為燃料電池的輸出電壓與電流。假定外接的阻抗為 Ze，則 eV Z I  ，如圖 6 所示，可
以藉由控制空氣與氫氣流量來達到控制輸出電壓之目的。 
 
 
圖 5. 燃料電池系統示意圖 
 
 10
 
4. 強韌控制理論 
 
4.1 標稱系統的選定 
由表 2 得知，經由系統鑑別所得到的燃料電池系統轉移函數不盡相同，因此我們必須找出其中一
組轉移函數作為標稱系統，再將剩餘的轉移函數當作是含不確定性的系統模型。而尋找標稱系統的方
式，是先採用間隙度量的定義來計算出系統間的差異量[8]，並藉由找重心的觀念選定標稱系統。針對
此一標稱系統，便可以設計強韌控制器，使燃料電池獲得最大的穩定範圍。首先將系統 G 表示為正規
化左互質因式分解的型式 1G M N  ，且滿足 ,M N RH  與 * * ,MM NN I       ，則兩個正規化左互質
因式分解系統 1G 、 2G 之間隙值便可表示為  1 2,G G 。參照表 3 的間隙值，可以求得標稱系統為 31G ，
因為在表 3 中， 31G 與其它的轉移函數最大間隙值為 0.1777 在所有轉移函數中為最小。 
 
表 3. 九個轉移函數彼此間的間隙值 
 11G  12G  13G  21G  22G  23G  31G  32G  33G  
11G  0 0.1281 0.1472 0.2204 0.1926 0.1466 0.0838 0.1169 0.1595
12G  0.1281 0 0.0528 0.2628 0.2354 0.1897 0.0886 0.0847 0.1186
13G  0.1472 0.0528 0 0.2117 0.1839 0.1907 0.0693 0.0414 0.0663
21G  0.2204 0.2628 0.2117 0 0.0608 0.1062 0.1777 0.1856 0.1582
22G  0.1926 0.2354 0.1839 0.0608 0 0.0478 0.1507 0.1627 0.1636
23G  0.1466 0.1897 0.1907 0.1062 0.0478 0 0.1291 0.161 0.1999
31G  0.0838 0.0886 0.0693 0.1777 0.1507 0.1291 0 0.0344 0.0789
32G  0.1169 0.0848 0.0413 0.1856 0.1626 0.161 0.0344 0 0.0454
33G  0.1595 0.1186 0.0663 0.1582 0.1636 0.1998 0.0789 0.0454 0 
max 0.2204 0.2628 0.2117 0.2628 0.2354 0.1998 0.1777 0.1858 0.1999
 
 
 12
1 1
0( )
K
I G K M
I
     
 N M 
1
2
z
z
   

 
圖 8. 經小增益原理轉換後的系統方塊圖 
根據式(4)，可以找到控制器K ，使系統達到的最大穩定半徑  0 ,b G K ，換句話說，強韌控制器設
計的目的，是找到一個最佳控制器 K ，使系統具有最佳的強韌性。而由(4)式所定義之穩定邊界，可
進一步定義最大穩定邊界 max ： 
   
1
1
max 0 0 
inf ,
K stabilizing
K
I G K I G
I




        
                     (5) 
且最大穩定邊界可由下式計算得到： 
  1/22max 1 ,HN M                                   (6) 
其中
H
 代表 Hankel 範數。一般而言，在控制系統中，最佳化的控制器設計，要使用疊代法去求取，
但若存在系統的狀態空間且系統結構如圖 7，並將之以正規化左互質分解型式拆解，則存在一精確解
的控制器K 使得最大穩定邊界 max maxb  ，但在實際應用上，通常給予一適當 max(0 )    ，使其滿足
0( , )b G K  。針對質子交換膜燃料電池系統，吾人由表 3 得知最適合的標稱系統為 31G ，其系統與其
他不確定性系統的最大間隙值是 0.1777，因此在實際設計次最佳化H控制器時，只要滿足
0( , ) 0.1777b G K   ，便可保證質子交換膜燃料電池系統具有強韌穩定性。 
為了兼顧系統的性能(performance)的要求，通常會對系統的開路轉移函數做預先的處理。吾人利用
H 迴路成型(loop-shaping)設計[11]來達到系統性能的要求，包含以下幾個步驟，並參考圖 9： 
(a) 選擇適當的 1W 、 2W ，來調整系統的開路轉移函數，假設 2 0 1sG W G W 沒有任何隱藏的模態。 
(b) 將 sG 以 NLCF 拆解，使得 1s s sG M N ，並計算K，可得 
 14
用迴路成型概念設計的權重函數如下： 
   1 2
3 0.9 0
, 1,
0.30
s
sW s W s
s
s
       
 
則設計後的傳統H強韌控制器 ( )K s 如下： 
 
2
2
2
2
-0.8957 -15.12 - 4.476
13.92 4.087
-0.1653 - 2.626 - 0.7743
13.92 4.087
s s
s sK s
s s
s s

         
 
其穩定邊界  1,sb G K 為 0.7393。 
 
4.3 強韌控制器的實驗結果與討論 
    首先，設定實驗負載分別為 4A、5A、6A、7A，比較其系統響應，如圖 10 所示。由實驗結果可以
看出控制器皆能有效地將電壓控制在 27V，空氣幫浦與比例閥也能隨著電壓訊號，適時調節空氣與氫
氣的供應量。而實驗數據整理於表 4。 
0 50 100 150 200 250 300
26
27
28
Time (sec)
O
ut
pu
t v
ol
ta
ge
 (V
)
0 50 100 150 200 250 300
0
0.5
1
Time (sec)
A
ir 
pu
m
p 
co
nt
ro
l s
ig
na
l (
V
)
0 50 100 150 200 250 300
0
0.5
Time (sec)
H
yd
ro
ge
n 
va
lv
e
 c
on
tro
l s
ig
na
l (
V
)
 
 
4A
5A
6A
7A
 
圖 10. 各負載下的控制結果 
 16
5. 混合燃料電池電力鏈設計 
 
5.1 混合電力鏈之電力管理策略 
    在本計畫中，我們採用串聯式混合電力鏈作為電動輪椅的電力供應系統。串聯式混合電力鏈是由
一個燃料電池、兩組二次電池和電動馬達三部分組合而成，它們之間用串聯的方式組成動力單元系統，
如圖 11 所示。其運作原理為：負載之電力需求由二次電池提供，當二次電池電量降至適合燃料電池對
其充電的電量時，燃料電池開始對其充電；與此同時，另一顆二次電池持續對電動馬達供電。此種運
作方式下，燃料電池與電動馬達間並無連結裝置，電動馬達所需的動能皆由二次電池組提供，適合像
電動輪椅這種低電力需求的動力系統。 
 
 
圖 11. 串聯式混合電力鏈 
 
5.2 二次電池組的選擇 
    二次電池組的選擇對於電動車的設計是一個相當關鍵性的決定，由於電動車輛類型與工作模式的
不同，電力鏈對二次電池組的要求亦不相同。本計畫所設計之混合燃料電池電力鏈中，預設負載為電
動輪椅的兩個輪轂馬達，所以須考慮的性能如下： 
（1）高能量密度 
為了達到車身輕量化之目標，二次電池組的重量不宜過重，過重或過大的體積皆會造成電動輪椅
硬體配置上的困難，最好選擇有較高能量密度的二次電池，以免電動輪椅的負擔過重。 
（2）高功率密度 
 18
 
圖 13. 磷酸鋰鐵電池組外觀 
 
表 6. 磷酸鋰鐵電池組規格 
Battery model A123  ANR26650M1A 
Nominal voltage 23.1V 
Nominal capacity 6.9Ah 
Internal resistance 23.3mΩ typical  
Energy density 108 Wh/kg, 222Wh/L 
Power density 2200 W/kg 
Recommended standard charge method 9A to 25.2V CCCV, 45 min 
Recommended fast charge current 30A to 25.2 CCCV, 15 min 
Maximum continuous discharge 210A 
Pulse discharge at 10 sec 360A 
Recommended pulse charge/discharge 
cutoff 
26.6V to 11.2V 
Cycle life at 10C discharge, 100% DOD Over 1000 cycles 
Operating temperature range o o-30 C to 60 C  
 
 20
5.4 燃料電池對二次電池組的充電策略 
當燃料電池對磷酸鋰鐵電池進行充電時，制定一個合適的充電機制是非常重要的，最主要須考慮
兩件事情：充電電壓的掌控與充電的時機。以下將分別做深入的探討： 
（1）充電電壓的掌控 
一般來說，若控制燃料電池的輸出電壓在過高的範圍，對二次電池進行充電時會很容易造成二
次電池過充電，進而損害二次電池；反之，若控制燃料電池的輸出電壓在過低的範圍，則會因
為二次電池的電壓高過燃料電池的電壓，造成無法順利對二次電池進行充電。 
（2）充電的時機 
充電的時機取決於二次電池殘電量剩餘的多寡。相同的充電電壓下，若二次電池殘電量太低，
則易導致過高的充電電流，如此可能會損害燃料電池，並增加整個充電迴路的危險性；隨著充
電的時間越來越長，二次電池的殘電量越來越高，充電電流也會跟著變小，此時充電速度趨於
緩慢，充電效率降低。 
我們所設計的電力管理系統如下：首先確立燃料電池在 4A、5A、6A、7A 皆能控制在 27V；其次，
為了防止充電電流過大，選定當磷酸鋰鐵電池的殘電量剩下約莫 50%時，就必須開啟充電機制，控制
燃料電池以定電壓 27V 對其充電；到了充電末期，由於充電速度趨於緩慢，充電效率降低，並且燃料
電池在低功率下的氫氣使用效率不高，原則上不希望花過久的時間在充電末期，所以選定 4A 為其充電
終止電流。接著，吾人藉由多次的放電實驗，整理出二次電池在不同放電速率下的放電深度—電池電
壓關係曲線，如圖 16 所示。 
0 1 2 3 4 5 6 7
18
19
20
21
22
23
24
Discharge curve
Ampere-hour (Ah)
V
ol
ta
ge
 (V
)
 
 1A
3.5A
5A
6.9A
 
圖 16. 磷酸鋰鐵電池放電特性曲線 
 
 22
    在充電的過程當中，燃料電池的系統響應如圖 18 所示，可以看出強韌控制器能有效地控制空氣幫
浦與比例閥，隨著電壓訊號調節空氣與氫氣的供應，並穩定地將電壓控制在 27V。 
    在 20 分鐘的充電過程中，平均充電電流為 4.37A，氫氣使用量為 25.61 升，因為氫氣在常溫常態
下（一大氣壓、 o25 C ）的密度為 10.08235 g L   ，因此可算出 2ExpH 為 2.1g，氫氣使用效率為 96.25%。 
0 200 400 600 800 1000 1200
26
27
28
Time (sec)
O
ut
pu
t v
ol
ta
ge
 (V
)
0 200 400 600 800 1000 1200
0
0.5
1
Time (sec)
A
ir 
pu
m
p 
co
nt
ro
l s
ig
na
l (
V
)
0 200 400 600 800 1000 1200
0
0.5
1
Time (sec)
H
yd
ro
ge
n 
va
lv
e 
co
nt
ro
l s
ig
na
l (
V
)
0 200 400 600 800 1000 1200
4
6
Time (sec)
Ch
ar
ge
 c
ur
re
nt
 (A
)
 
圖 18. 燃料電池系統響應圖 
 
6. 系統整合 
 
6.1 系統整合架構 
    一輛完整的燃料電池混合動力車必定包含四個子系統：燃料電池系統、二次電池系統、能量管理
系統與動力系統，而每個子系統間必須互相配合無誤，才能使電動車運行順暢，如圖 19 所示。 
 24
 
圖 20. 金屬氫化物儲氫器 
6.3 電動輪椅車體佈局 
電動輪椅的空間配置如圖 21 所示，紅色部分為新加的隔層，上層放置儲氫鋼瓶、下層放置燃料電
池系統及二次電池組。而較輕的控制電路板與繼電器等則放置在輪椅的前端。 
 
 
圖 21. 輪椅系統空間配置示意圖 
控制電路板及
繼電器 
儲氫鋼瓶 
燃料電池系統及二次電池組 
 26
 
圖 25. 全車系統完成圖 
6.4 實際上路實驗與長時間實驗 
我們操作輪椅一段時間，並記錄電池的電壓與電流，如圖 26 所示。在這一段時間內，電池的平均
輸出電流為 2.93A，平均消耗功率約為 70W。 
0 5 10 15 20 25 30
23
23.5
24
24.5
25
Time (sec)
ba
tte
ry
 v
ol
ta
ge
 (V
)
0 5 10 15 20 25 30
-7
-6
-5
-4
-3
-2
-1
0
Time (sec)
ba
tte
ry
 c
ur
re
nt
 (A
)
 
圖 26. 輪椅行駛時的用電情況 
其次，利用工具軟體 TMMATLAB/simulink 裡的 SimPowerSystems toolbox 進行串聯式混合電力鏈的
模擬，模擬結果如圖 27 所示。可以發現，經由第 5 章所設計的充電策略，二次電池組將可以持續提供
穩定的電力給電動輪椅。 
 28
0 2000 4000 6000 8000 10000
22.8
23
23.2
23.4
Time (sec)
ba
tte
rie
s 
vo
lta
ge
 (V
)
0 2000 4000 6000 8000 10000
-4
-2
0
2
4
Time (sec)
ba
tte
rie
s 
cu
rr
en
t (
A
)
 
 
battery 1
battery 2
0 2000 4000 6000 8000 10000
50
60
70
Time (sec)
SO
C 
(%
)
 
圖 28. 連續 4.5A 負載下的電力模擬 
 
6.4.1 修正型串聯式混合電力鏈 
考慮電動輪椅在實際上路時，燃料電池周邊電力的消耗不可能是由固定的外部電源所供應，因此
我們將針對第 5 章所設計的電力鏈作修正，把燃料電池周邊電力的使用情況也考慮進去。修正後的串
聯式混合電力鏈如圖 29 所示，其運作流程則依照以下程序進行： 
（1）首先假設一開始由一號電池供電，此時只有 S2 成導通狀態。 
（2）當供電中的一號電池電量降至需要充電時，切斷 S2 開關，同時打開 S1 與 S4 
 開關，由燃料電池對一號電池充電，而由二號電池持續對後端馬達供電。 
（3）二號電池同時也提供電力給 DC–DC 轉換器（圖 30），DC–DC 轉換器會將二號 
電池的電力轉成 DC12V 的電源供應給燃料電池周邊，包含空氣幫浦、氫氣閥、散熱風扇與排水閥
等。當燃料電池周邊元件被啟動後，強韌控制器便可調節氫氣與空氣的供應量，控制燃料電池以
定電壓 27V 對一號電池充電。 
（4）當一號電池充電完成後，切斷 S1 開關，結束充電程序，此時只有 S4 呈導通 
狀態。 
（5）回到步驟（1），一號電池與二號電池的角色對調，並重複進行每個步驟。 
 30
程中，二號電池供應給燃料電池周邊的平均消耗電流為 1.01A，當燃料電池周邊元件啟動後，帶動燃料
電池發電，對一號電池的平均充電電流約為 5.78A，因此可推算出整體的發電效率約為： 
5.78 1.01 82.5%
5.78
   
而從電量消耗的角度來看，可以用以下方式計算： 
100%,I tSOC
C
   
其中 I 為燃料電池周邊元件消耗之電流，t 為燃料電池的操作時間，C 為二號電池的電容量，因此可計
算出燃料電池周邊共消耗了二號電池 3.84%的電量，可使一號電池的電量由 50%充至 72%。 
 
 
圖 31. 實際上路測試 
 
 32
0 100 200 300 400 500 600 700 800 900
26.5
27
27.5
Time (sec)
O
ut
pu
t v
ol
ta
ge
 (V
)
0 100 200 300 400 500 600 700 800 900
0
0.5
1
Time (sec)
A
ir 
pu
m
p 
co
nt
ro
l s
ig
na
l (
V
)
0 100 200 300 400 500 600 700 800 900
0
0.5
Time (sec)
H
yd
ro
ge
n 
va
lv
e
 c
on
tro
l s
ig
na
l (
V
)
0 100 200 300 400 500 600 700 800 900
4
6
8
Time (sec)
Ch
ar
ge
 c
ur
re
nt
 (A
)
 
圖 34. 燃料電池系統響應圖 
6.4.3 長時間實驗 
為了驗證串聯式混合電力鏈可以永續地提供電動輪椅所需之電力，我們進一步進行長時間實驗，
並討論其結果是否有變化。長時間實驗所用的架構大致上與之前實驗一樣，但因為目前的系統長時間
在外易有未知數，且基於安全性的考量，所以實驗將於室內進行。 
利用負載機模擬輪椅行駛過程中的負載變化，並將其記錄於圖 35 中。而二次電池組的電力響應與
燃料電池系統的響應則如圖 36 與圖 37 所示，可以看出整個電力鏈在長時間運作之下，電力的轉換與
傳輸的過程仍然相當順利，並不會因為時間拉長而受到影響。 
我們進一步估算儲氫鋼瓶中的氫燃料使用率。因為一支鋼瓶內有 51g 的氫，每充一次電約耗掉
2.1g，所以填滿氫氣的鋼瓶可提供燃料電池對二次電池組充電 24 次。藉由本次的長時間實驗可知，在
5800 秒內約有 4 次的充放電循環，因此可推算出鋼瓶內的氫氣量可提供電動輪椅的續航力約為
5800×6=34800 秒左右，也就是 9.67 小時。當鋼瓶內的氫氣量一旦被耗盡，則由二次電池組剩餘之電力
將可再推動半小時，所以總續航力約為 10 小時左右。 
 34
0 1000 2000 3000 4000 5000
0
20
Time (sec)
O
ut
pu
t 
vo
lta
ge
 (V
)
0 1000 2000 3000 4000 5000
0
0.5
1
Time (sec)
A
ir 
pu
m
p 
co
nt
ro
l s
ig
na
l (
V
)
0 1000 2000 3000 4000 5000
0
0.5
Time (sec)
H
yd
ro
ge
n 
va
lv
e
 c
on
tro
l s
ig
na
l (
V
)
0 1000 2000 3000 4000 5000
0
5
Time (sec)
Ch
ar
ge
 
cu
rr
en
t (
A
)
 
圖 37. 燃料電池系統響應圖 
 
7. 結論 
 
由於質子交換膜燃料電池具有低溫操作、低汙染、高效率等特性，因此常被應用在各種電動車輛
上。在本計畫中，我們將質子交換膜燃料電池整合於輕型電動輪椅，作為電動輪椅的動力來源。一般
的電動輪椅因為受限於電池的電容量，往往行走一段時間後就會面臨電池沒電的情況，此時必須在半
途中更換電池，或是想辦法對電池進行充電。為了解決此一續航力的問題，我們將質子交換膜燃料電
池搭配二次電池組，設計適當的電力供應鏈，依據燃料電池與二次電池的動態特性，作適當的操作切
換，一方面使電動輪椅的行進保持順暢，一方面使能源管理操作在有效率的狀況。 
由於質子交換膜燃料電池本身會因為外界負載的變動與操作環境的影響，輸出電壓會呈現不穩定
的情況，這也是燃料電池在實際應用中往往都需要藉由一個電壓轉換器來穩定最後的輸出電壓。但由
於電壓轉換器會有轉換效率的問題，長久使用下來會損失很多能量在電力轉換的過程中，有鑑於此，
本計畫首先針對質子交換膜燃料電池系統，進行強韌控制器的設計及安裝，藉由控制氫氣與空氣的流
量，達到穩定輸出電壓的目的。 
 36
References 
[1] Larmine J and Dick A, Fuel Cell System Explained, 2nd ed., Wiley, 2003. 
[2] Ceralo M, Miulli C and Pozio A, “Modelling Static and Dynamic Behaviour of Proton Exchange 
Membrane Fuel Cell on the Basis of Electro-Chemical Description,” Journal of Power Sources, 113(1): pp. 
131-144, 2003. 
[3] 趙清風編譯，使用 MATLAB 控制之系統鑑別，全華圖書，台北市，2001。 
[4] 黃志偉，系統識別和H 強韌控制在質子交換膜燃料電池上的應用，國立台灣大學機械工程研究所
碩士論文，2006。 
[5] 陳炫綜，多變數強韌控制理論在質子交換膜燃料電池上的應用，國立台灣大學機械工程研究所博士
論文，2009。 
[6] 周銘城，質子交換膜燃料電池控制及整合，國立台灣大學機械工程研究所碩士論文，2009。 
[7] Mocoteguy P, et al., “Monodimensional Modeling and Experimental Study of the Dynamic Behavior of 
Proton Exchange Membrane Fuel Cell Stack Operating in Dead-End Mode,” Journal of Power Source, 
167(2): pp.349-357, 2007. 
[8] Georgiou TT and Smith MC, “Optimal Robustness in the Gap Metric,” Automatic Control, IEEE 
Transaction on, 35(6): pp. 673-686, 1990. 
[9] Doyle JC, Francis BA and Tannenbaum AR, Feedback Control Theory, 1992, New York. 
[10] Glover K and McFarlane DC, Robust Controller Design Using Normalized Coprime Factor Plant 
Descriptions, Springer-Verlag New York, Inc. 217, 1989. 
[11] McFarlane D, Glover K, “A loop-shaping design procedure using Hinf synthesis,” IEEE Trans. Autom. 
Control, 37:pp. 759-769, 1992. 
[12] Wang FC, Chen HT, “Design and Implementation of Fixed-Order Robust Controllers for a Proton 
Exchange Membrane Fuel Cell System”, International Journal of Hydrogen Energy, 34(6): pp. 2705-2717, 
2009. 
[13] A123 Systems：http://www.a123systems.com/ 
[14] 漢氫科技股份有限公司：http://www.hbank.com.tw/ 
[15] DC–DC 轉換器：http://www.alibaba.com/product-gs/357654372/10A_Negative_booster.html 
 38
3. 請依學術成就、技術創新、社會影響等方面，評估研究成果之學術或應用價
值（簡要敘述成果所代表之意義、價值、影響或進一步發展之可能性）（以
500 字為限） 
吾人從 2004 年開始進行燃料電池控制系統研究，以系統控制的角度出發，
將燃料電池視為多變數系統，並控制其氫、氧流量，從理論及實驗兩方面證明，
強韌控制器可以增加系統穩定性、提高系統性能、並且降低氫氣消耗。第一階段
的工作，我們證明經由控制氧氣流量，可以增加系統穩定性，以及提高系統性能
(Journal of Power Sources, 2007)；第二階段的工作，證明經由控制氫、氧氣流量，
可以大幅降低氫氣消耗量，提昇系統效率 (Journal of Power Sources, 2008)；第三
階段的工作，是利用定階強韌控制器，簡化控制器之設計，並將其安裝於單晶片，
實際進行系統控制 (International Journal of Hydrogen Energy, 2009)。第四階段的
工作，則是結合強韌控制處理系統擾動的能力、以及 PID 控制廣為工業界偏好
的特性，設計簡單而功能強大的強韌 PID 控制器  (International Journal of 
Hydrogen Energy, 2010)。現階段成果已經吸引工業界的目光，並提高其投入研究
的意願。吾人目前研究重心為燃料電池系統整合，研究燃料電池驅動輕型電動
車；並與國內燃料電池系統開發商合作，研究燃料電池商品化及定置型燃料電池
開發。 
 
 
 
 
 
 
 
 
 40
 
 
國科會補助專題研究計畫項下出席國際學術會議心得報告 
                                     日期：100 年 5 月 31 日 
                                                             
出國人員姓名 
服務機關及職稱 王富正 副教授，國立臺灣大學機械工程學系 
會議時間地點 19-21/MAY/2011, Yokohama, Japan 
會議名稱 the 4th International Conference on Human System Interaction (HSI 2011) 
發表論文題目 Synchronized Robust Control of a Gait Trainer 
 
一、 簡介 
 
這一次帶領一個學生前往日本慶應大學參加  the 4th International Conference on 
Human System Interaction (HSI 2011)，發表這幾年在醫工領域的工作成果，留下深刻的印
象。 
 
二、 HSI 的特色 
 
HSI2011 是由 IEEE 協辦的醫工領域會議，每兩年舉辦一次；這一次在日本舉辦，
恰逢日本大地震，見證日本重建的生命力，覺得特別有意義。本次會議安排相當緊湊，每
天早上以一個大會演講開始，所安排的演講如下： 
 
1. Prof. Hongbin Zha (Peking University, China): 3D Scene Analysis and Modeling both 
for Static and Dynamic Environments. 
2. Prof. Bogdan Wilamowski (Auburn University, USA): Can computers be more 
intelligent than humans? 
3. Prof. Shuji Hashimoto (Waseda University, Japan): Expanded Human with HSI 
-Universality and Individuality. 
 
我們過去七年和陽明醫工所合作醫學工程系統的控制研究，從控制角度跨入醫工領
域，學習到很多不同的知識。這次參與會議，聆聽專家們的高見，非常受益；同時也發現
這個領域的專家對控制不甚熟悉，相信我們的跨領域整合，一定可以展現嶄新的結果。 
附件四 
 42
 
四、 結論 
 
近年來參加各種重要的國際會議，和各國學者交流，常思考如何提升我們的研究水
準。除了邀請各國學者訪台，並帶領學生參加大型國際會議，以開闊其視野，希望能對他
們有正面的激勵作用，這也正是台灣亟需培養的軟實力。 
 
五、 附檔 
 
附檔為我們這一次在 HSI2011 發表的文章。 
 a six-bar linkage, as shown in Fig. 2(a), which can produce 
the normal gait when the motor rotates at point A.  Because 
walking speed is not constant, the motor needs to follow the 
trajectories of Fig. 2(b) to produce the preferred gaits for 
gait training. The position 0   is defined as when the 
linkage AB  and the linkage BD  are in parallel.  
 
 
(a)The six-bar mechanism.  
 
0 0.5 1 1.5 2 2.5 3 3.5 4 4.5 5
0
50
100
150
200
250
300
350
400
Time(sec)
D
eg
re
e(
θ)
 
 
Motor input
 
(b) Time trajectory of the mechanism motor. 
Fig. 2 Control of mechanism motors. [8, 9] 
 
The forward wheel is designed to mimic forward 
movement. Consider a single leg, a gait cycle can be 
separated into two phases: the stance phase and swing 
phase. The former is when the foot contacts the floor, and 
the latter is when the foot leaves the ground [12]. 
Furthermore, the stance phase can be divided into single 
stance and double stance intervals. During the single stance 
interval, the leg which contacts the ground bears the body 
weight and pushes the body forward, while the body is 
moved by two legs during the double stance interval, as 
illustrated in Fig. 3. Therefore, we can calculate the forward 
velocity of the body. Because the vertical movement is 
small during walking, we consider the horizontal velocity 
and draw the corresponding time trajectory of the forward 
wheel in Fig. 4, where the forward wheel has with a radius 
of 75 mm.  
 
Stance Swing Stance 
Initial 
Double 
Limb 
Stance 
Single 
Limb 
 Stance 
Terminal 
Double Limb 
Stance 
Swing Double 
Limb 
Stance 
10% 40% 10% 40% 10% 
Fig. 3 Gait cycle of the right foot. [12] 
 
Referring to Figs. 2–4, the left, the right, and the forward 
motors need to be controlled synchronically to produce the 
correct gaits.  Fig. 5 illustrates the corresponding motor 
trajectories for three steps for the active trainer.  
0 0.5 1 1.5 2 2.5 3 3.5 4 4.5 5
0
100
200
300
400
500
600
700
Time(sec)
M
ot
or
 p
os
iti
on
(d
eg
re
e)
 
Fig. 4 Time trajectory of the forward wheel. 
 
0 2.5 5 7.5 10 12.5 15
0
200
400
600
800
1000
1200
1400
1600
Time(sec)
M
ot
or
 p
os
iti
on
(d
eg
re
e)
 
 
Right motor input
Left motor input
Forward motor input
 
Fig. 5 Time trajectories of the motors. 
 
We use a cRIO system to control the gait trainer, as 
shown in Fig. 6. First, cRIO 9004 sends three control 
signals to three cRIO 9505 modules so that the linkage 
mechanism and the forward wheel will generate preferred 
gaits. Second, the position and current signals of motors are 
measured and sent to cRIO 9004 by the cRIO 9505 modules 
to form a closed-loop system. For gait training, the patient 
sits on the suspended seat with feet fixed on the treadles, so 
that the gait trainer can guide the patient’s legs to produce 
the preferred gait traces repeatedly. Finally, operators can 
observe the recorded position data and inspect the working 
conditions of the gait trainer in real time. 
 
 
Fig. 6 Control structure of the gait trainer. 
III. SYSTEM IDENTIFICATION 
Applying identification techniques, we can obtain 
system dynamics of the gait trainer. Fig. 7 shows the 
multivariable control structure of a motor, where the 
armature current aI  and motor position   are measured 
and fedback to regulate the input voltage aV  and the 
angular velocity of the motor. Suppose the gait trainer 
 =0 
 =0 
124
  
   
1 1
0
1
0 0
   
1
.
K
I G K M
I
K
I G K I G
I 
 



 
 
 
 
   
 
            
(2) 
 
Definition 1: Stability Margin [17] 
The stability margin of the closed-loop system of Fig. 8 can 
be defined as [17]: 
1
1
0 0 0( ,  ) ( ) [ ] .
K
b G K I G K I G
I



 
  
 
      
     (3) 
 
Therefore, The closed-loop system with uncertainty 
 N M     is internally stable if and only if 
0( , )b G K  . In addition, because the coprime 
factorization is not unique, i.e. there is more than one 
expression for 0G  or G . Therefore, we can define the gap 
between two systems 0G  and G  as in the following:   
 
Definition 2: Gap Metric [17] 
The gap between two systems 0G  and G  is the smallest 
value of  [  ]M N   , which perturbs 
1
0( ) ( ) ( )G s M s N s   
into 1( ) ( )
M N
G M N        , denoted as 0( , )G G  .  
 
Thus, the selection of the nominal plant is based on the 
calculation of gaps between the nominal plants 0G  and all 
perturbed plants G , such that the maximum gap is 
minimized as follows: 
0
0 0arg min max ( , )
i
i
G G
G δ G G                       (4) 
Therefore, the nominal plants of the systems are selected as: 
2
3 2
0 3
2
3 2
6.959 29.66 1.07
26.82 784 1.048
,
5.281 69.33 4130
26.82 784 1.048
R R
s s
s s s
G G
s s
s s s
                
         (5) 
2
3 2
0 7
2
3 2
5.503 22.79 0.9437
22.86 624.9 1.054
,
5.759 69.54 3446
22.86 624.9 1.054
L L
s s
s s s
G G
s s
s s s
                
      (6) 
2
3 2
0 2
2
3 2
67.2 69.67 8.653
41.05 534.5 0.4681
,
4.147 48.26 2269
41.05 534.5 0.4681
F F
s s
s s s
G G
s s
s s s
                  
   (7) 
which give system gaps as 0( , ) 0.0056iR RG G  , 
0( , ) 0.0382iL LG G  , and 
0( , ) 0.0129iF FG G  .  
 
To improve system performance, the following loop 
shaping techniques [18], as shown in Fig. 9, are normally 
applied for controller design:  
(1) Choose appreciate weighting functions 1W  and 2W , to 
shape the open-loop system as 2 1sG W GW .  
(2) Design a controller K  to achieve the largest stability 
margin of max b  for the shaped plant sG : 
1
1
max ( , ) inf ( ) [ ]s s s
K stablizing
K
b G K I G K I G
I


 
 

 
 
 
 . (8) 
If max ( ,  ) 1sb G K  , then return to the step (1).  
(3) Multiply 1W  and 2W  to K , and implment the 
controller 1 2K W K W  to the system G . 
 
Fig. 9 Loop shaping design. 
 
Using the following weighting functions for the left and 
right mechanism motors:  
1 2
1
0
800
( ) 1,  ( ) ,
200
0
80
s
W s W s
s
s
            
and the following weighting functions for the forward 
motor:
 
1 2
250
0
1000
( ) 1,  ( ) ,
500
0
100
F F
s
s
W s W s
s
s
          
 
we design the multivariable robust controllers, RK
 , LK
 , 
and FK
 , respectively, for the right, the left, and the forward 
motors, as illustrated in Table 1. Note that the system can 
remain internally stable by the designed controllers in that 
the stability margins are greater than the system gaps. 
Because the resulting controllers are six-order, we then 
apply a MATLAB command sysbal to reduce them to the 
following third-order controllers: 
5 2 5
3 2 4
3
3 2 5
3 2 4
2.329 10 7.378 10 0.02046
116.4 3007 8.923 10 ,
1.166 265 7352 1.913 10
116.4 3007 8.923 10
T
R
s s s
s s sK
s s s
s s s
      
     
     
       
5 2 5
3 2 4
3
3 2 5
3 2 4
2.329 10 7.378 10 0.02046
116.4 3007 8.923 10 ,
1.166 265 7352 1.913 10
116.4 3007 8.923 10
T
L
s s
s s sK
s s s
s s s
      
     
     
     
 
126
 illustrated in Table 2. First, all controllers can stabilize the 
system. Second, these controllers achieve similar 
performance. Therefore, the lower-order controllers can be 
used to simplify hardware implementation. In the future, 
the lower-order controllers will be implemented on a 
microchip for system miniaturization [19].  
0 0.5 1 1.5 2 2.5 3 3.5 4 4.5 5
0
50
100
150
200
250
300
350
400
Time(sec)
M
ot
or
 p
os
iti
on
(d
eg
re
e)
 
 
right motor input
K
R6
K
R2
K
R3
 
(a) Responses of the right motor. 
0 0.5 1 1.5 2 2.5 3 3.5 4 4.5 5
0
50
100
150
200
250
300
350
400
Time(sec)
M
ot
or
 p
os
iti
on
(d
eg
re
e)
 
 
left motor input
K
L6
K
L2
K
L3
 
(b) Responses of the left motor. 
0 0.5 1 1.5 2 2.5 3 3.5 4 4.5 5
0
100
200
300
400
500
600
700
Time(sec)
m
ot
or
 p
os
iti
on
(d
eg
re
e)
 
 
forward motor input
K
F6
K
F2
K
F3
 
(c) Responses of the forward motor. 
Fig. 12 Motor responses. 
 
Table 2 Statistic data with a tester of Fig. 11. 
RMSE (degree)
 
 
R
iK  
L
iK  
F
iK  
6th-order 
controller
 9.0546 8.7662 8.4277 
3rd-order 
controller
 10.4394 9.67385 7.60052 
2nd-order 
controller
 12.9004 13.3901 11.4362 
 
VI. CONCLUDING REMARKS 
This paper has proposed synchronized multivariable 
robust control to an active gait trainer for people with 
walking disability. We identified the system transfer 
functions, and then designed robust controllers to 
simultaneously control the motors to produce normal gait 
trajectories. The designed controllers were implemented on 
a cRIOTM system to generate preferred gaits for 
experimental verification. The results demonstrated the 
effectiveness of the synchronized multivariable robust 
control. In the future, the controllers can be further 
implemented on a microchip for system miniaturization, as 
shown in [19]. 
REFERENCES 
[1]. Butler, C. (1986). "Effects of powered mobility on self-initiated 
behaviors of very young children with locomotor disability." 
Developmental Medicine & Child Neurology 28(3): 325-332. 
[2]. Ulrich, D. A., Ulrich, B. D., Angulo-Kinzler, R. M. and Yun, J. 
(2001). "Treadmill training of infants with Down syndrome: 
evidence-based developmental outcomes." Pediatrics 108(5): E84. 
[3]. Alton, F., Baldey, L., Caplan, S. and Morrissey, M. C. (1998). "A 
kinematic comparison of overground and treadmill walking." 
Clinical Biomechanics (Bristol, Avon) 13(6): 434-440. 
[4]. Strathy, G. M., Chao, E. Y. and Laughman, R. K. (1983). "Changes 
in knee function associated with treadmill ambulation." Journal of 
Biomechanics 16(7): 517-522. 
[5]. Stolze, H., Kuhtz-Buschbeck, J. P., Mondwurf, C., Boczek-Funcke, 
A., Johnk, K., Deuschl, G. and Illert, M. (1997). "Gait analysis 
during treadmill and overground locomotion in children and 
adults." Electroencephalogr Clin Neurophysiol 105(6): 490-497. 
[6]. Jeng, S.-F., Liao, H.-F. and Hu, M.-H. (2001). "Comparison of 
Treadmill   Walking with Overground Walking in Children and 
Adults." FJPT. 
[7]. Werner, C., Von Frankenberg, S., Treig, T., Konrad, M. and Hesse, S. 
(2002).     "Treadmill training with partial body weight support and 
an electromechanical gait trainer for restoration of gait in subacute 
stroke patients: a randomized crossover study." Stroke 33(12): 
2895-2901. 
[8]. Fu-Cheng Wang, Chung-Huang Yu, Nai-Chung Chang, and Tai-Yu 
Chou. 2009, June, "Design and Control of an Active Gait Trainer", 
IEEE International Symposium of Industrial Electronics. 
[9]. Fu-Cheng Wang, Chung-Huang Yu and Tai-Yu Chou, 2009, June, 
Design and implementation of robust controllers for a gait trainer, 
Proceedings of the Institution of Mechanical Engineers, part H. 
Journal of Engineering in Medicine, 223 (6): 687-696 
[10]. W.G. Huang, Normal Children Gait, Master Thesis, National Cheng 
Kung University, 1995. 
[11]. F.C. Wang, M.C. Chou and Y.L. Lin, Optimal Tracks of the 
Hand-Raising and Gait, in “Distributed Human-Machine Systems”, 
V. Marik, J.M. Bradshaw, J. Meyer, W.A. Gruver and P. Benda, 
Eds., Czech Technical University, Prague, 2008. 
[12]. Jacquelin Perry. (1992) "Gait analysis: normal and pathological 
function". SLACK. pp. 4-6  
[13]. Goethals I, Pelckmans K, Suykens JAK,  Bart De M. “Subspace 
identification of Hammerstein systems using least squares support 
vector machines”. IEEE Transactions on Automatic Control  50(10): 
1509-1519, 2005 
[14]. K. Zhou, J.C. Doyle and K. Glover K. Robust and Optimal Control. 
Prentice Hall, Upper Saddle River, New Jersey, 1996. 
[15]. McFarlane, D.C., and Glover, K. "Robust Controller Design using 
Normalised Coprime Factor Plant Descriptions", Springer Verlag, 
Lecture Note in control and Information Science, vol 138, 1989 
[16]. K. Glover K. and D. McFarlane, “Robust stabilization of normalized 
coprime factor plant descriptions with H-infinite-bounded 
uncertainty”, IEEE Transaction on Automatic Control, 34 (8): 
821-830, 1989. 
[17]. T.T. Georgiou and M.C. Smith, “Optimal robustness in the gap 
metric”, IEEE Transactions on Automatic Control, 35(6): 673-686, 
1990. 
[18]. D. McFarlane and K. Glover, “A loop-shaping design procedure 
using Hinf synthesis”, IEEE Transactions on Automatic Control, 
37(6): 759-769, 1992. 
[19]. F.C. Wang and H.T. Chen, “Design and Implementation of 
Fixed-Order Robust Controllers for a Proton Exchange Membrane 
Fuel Cell System,” International Journal of Hydrogen Energy, Vol. 
34, No.6, pp. 2705-2717, 2009. 
[20]. http://140.112.14.7/~sic/GaitTrainerVideo1.html 
 
128
  
      
   
 
三、 學術會議之外的心得 
 
這一次參加 HSI2011，除了學術上的收穫之外，我們也觀察了日本在大地震
之後重建的力量。首先，是日本人民以一貫認命及沈穩樂觀的態度進行重建；其
次，是整體社會安定的力量，包括媒體的自律及民眾的配合。這些都是直的我們
學習的地方。 
日本慶應大學是亞洲第一個現代化的大學，創始人福沢諭吉還被選為日本萬
元鈔的肖像人物，可見其影響力。會後利用半天時間參觀伊藤博文紀念館，伊藤
HSI 2011 Yokohama, Japan, May 19-21, 2011 
 
Abstract. This paper proposes synchronized robust control 
for an active gait trainer. We design an active gait trainer, 
which composes of linkage mechanism and motors, to produce 
preferred gait traces for people with walking disability. The 
goal of this work is to simultaneously control the motors to 
mimic normal gaits. By finding the transfer functions of the 
mechanism and motors, we design robust controllers to 
regulate the trainer in a synchronic way.  The designed 
controllers are implemented on a cRIOTM system for 
experimental verification. From the results, the proposed 
synchronized robust control is deemed effective.  
 
Keywords: gait trainer, synchronization, robust control, motor 
control, mechanism 
 
I. INTRODUCTION 
alking ability is important because it relates to the 
brain cognitive, psychosocial skills, and subsequent 
development of children. For example, children’s sight, 
language, and explorative abilities are increased when they 
can move [1, 2]. Traditional gait training applies a series of 
training programs to strengthen patients’ legs muscles to 
improve the motion ability. To do so, therapists normally 
need to accompany patients during the training to correct 
their gait patterns repeatedly. However, that will increase 
therapists’ working load and decrease rehabilitation 
efficiency. Therefore, two kinds of assistive devices were 
developed: treadmills and gait trainers. The former are 
advantageous because of the small sizes and adjustable 
mechanisms for walk training in different speed and slopes 
[3]. However, because the forward velocity during general 
walking is not constant, the users’ gaits are different from 
normal walking [4, 5]. Because the user’s vision can help 
 
This work was supported in part by the National Science Council of 
Taiwan under Grant 97-2221-E-002-230-MY3. 
Fu-Cheng Wang is with the Mechanical Engineering Department of 
National Taiwan University, Taipei 10617, Taiwan. (phone: 
+886-2-33662680; fax: +886-2-23631755; e-mail: fcw@ntu.edu.tw).  
Chung-Huang Yu is with the Institute of Rehabilitation Science and 
Technology, National Yang-Ming University, Taipei, Taiwan (e-mail: 
chyu@ym.edu.tw). 
Chia-Hui Chen is with the Department of Mechanical Engineering,  
National Taiwan University, Taipei 10617, Taiwan. (e-mail: 
pop6235@hotmail.com).  
Tai-Yu Chou is with the Department of Mechanical Engineering,  
National Taiwan University, Taipei 10617, Taiwan. (e-mail: 
r97522802@ntu.edu.tw).  
Chen-En Tsai is with the Center for Drug Evaluation, Taipei, Taiwan. 
(e-mail: cetsai@cde.org.tw) 
 
the body sense and balance, gait trainers are found more 
beneficial for improving walking ability in that patients can 
move when walking [6, 7]. Hence, we proposed an active 
gait trainer to produce preferred gait traces by linkage 
mechanism and motor control [8, 9]. The gait trainer can 
guide patients’ ankles to follow correct gait traces 
repeatedly, so that it can reduce therapists’ working loads 
and increase training efficiency. To mimic the normal 
walking, the left, the right, and the forward motors need to 
be simultaneously controlled. In this paper, we design 
multivariable robust controllers to operate the system in a 
synchronic way. These controllers are then implemented on 
a cRIOTM system for experimental tests.  
This paper is organized as follows: Section 2 introduces 
the mechanism and working principles of the gait trainer. 
Section 3 applies identification techniques to obtain the 
system’s dynamics. Section 4 designs multivariable H∞ 
controllers, and proposes synchronic control algorithms for 
the gait trainer. In Section 5, the designed controllers are 
implemented on a cRIOTM system for experimental 
verification. Lastly, conclusions are made in Section 6. 
II. THE ACTIVE GAIT TRAINER SYSTEM 
Fig.1 show the gait trainer system, which is composed 
of three parts: linkage mechanism, the forward wheel, and 
motors. The linkage mechanism produces preferred gait 
traces, while the forward wheel generates forward 
movement, and the motors control the linage mechanism 
and the forward wheel to create correct gaits.  
 
 
Fig. 1 A prototype gait trainer. [8, 9] 
 
The ankle motion of normal gaits can be obtained by 
motion analysis systems [10, 11]. To mimic the normal gait 
traces, we use software, called Roberts Animator, to design 
Synchronized Robust Control of a Gait Trainer 
Fu-Cheng Wang1, Chung-Huang Yu2, Chia-Hui Chen1, Tai-Yu Chou1, Chen-En Tsai3 
1National Taiwan University, Taipei, Taiwan,  
2 National Yang-Ming University, Taipei, Taiwan, 
3 Center for Drug Evaluation, Taipei, Taiwan, 
fcw@ntu.edu.tw, chyu@ym.edu.tw 
W 
Motor  
Forward 
wheel Linkage 
mechanism 
Suspended 
seat  
978-1-4244-9639-6/11/$26.00 ©2011 IEEE 123
 system ( )G s  can be conformably partitioned as 
 ( ) ( ) ( ) TIG s G s G s , such that 
( )
( ) .
( )
Ia
a a
G sI
G s V V
G s
  
     
   
                    (1) 
The controller  ( ) ( ) ( ) ,IK s K s K s in which the 
subscripts   and I represent the angular position and the 
current of the motor, respectively. 
 
eK
1
a aR L s
aI
tK
1
Js B
1
s
ref
 aV gT 
  
Fig. 7 The multivariable motor control. 
 
To identify the system dynamics, we generate swept 
sine signals as inputs and measure the output responses to 
obtain the system dynamics. Then we can apply the N4SID 
(numerical algorithm for subspace state space system 
identification) method [13] to obtain the system’s transfer 
function matrices. Considering system variations, we repeat 
the experiment eight times for each motor and obtain the 
following transfer functions for the right mechanism motor: 
2 2
3 2 3 2
1 2
2 2
3 2 3 2
6.187 38.28 1.373 7.378 26.22 0.8879
31.21 960.6 1.62 24.74 706.2 0.954( ) , ( )
5.504 106.6 5038 5.069 48.22 3733
31.21 960.6 1.62 24.74 706.2 0.954
R R
s s s s
s s s s s sG s G s
s s s s
s s s s s s
     
          
    
        
2 2
3 2 3 2
3 4
2 2
3 2 3 2
,
6.959 29.66 1.07 8.054 28.64 1.046
26.82 784 1.048 26.52 769.1 1.184( ) , ( )
5.281 69.33 4130 4.862 45.49 4080
26.82 784 1.048 26.52 769.1 1.18
R R
s s s s
s s s s s sG s G s
s s s s
s s s s s s



 
 
    
        
    
       
2 2
3 2 3 2
5 6
2 2
3 2 3 2
,
4
7.382 27.66 1.042 6.783 36.17 1.211
25.25 741.4 1.178 32.17 936.9 1.323( ) , ( )
5.102 50.19 3918 5.424 102.5 4928
25.25 741.4 1.178 32.17 9
R R
s s s s
s s s s s sG s G s
s s s s
s s s s s
 
 
 
 
  
    
        
    
      
2 2
3 2 3 2
7 8
2 2
3 2 3 2
,
36.9 1.323
8.554 39.19 1.394 8.33 29.2 1.09
31.62 980 1.709 26.93 782.9 1.29( ) , ( )
5.167 76.51 5149 4.928 46.23 4149
31.62 980 1.709 26.93
R R
s
s s s s
s s s s s sG s G s
s s s s
s s s s s
 
 
 
 
  
    
        
    
     
.
782.9 1.29s
 
 
 
 
   
  
The following model are for the left mechanism motor: 
2 2
3 2 3 2
1 2
2 2
3 2 3 2
4.37 18.44 0.6847 7.977 23.33 1.161
22.57 510.3 0.478 28.36 734.2 1.016( ) , ( )
5.716 80.95 2796 5.479 69.77 4075
22.57 510.3 0.478 28.36 734.2 1.016
L L
s s s s
s s s s s sG s G s
s s s s
s s s s s s
     
         
    
        
2 2
3 2 3 2
3 4
2 2
3 2 3 2
,
5.273 23.38 1.011 4.592 19.74 0.8218
23.08 644.6 1.159 21.98 555.6 0.8554( ) , ( )
5.792 74.26 3563 5.763 74.89 3073
23.08 644.6 1.159 21.98 555
L L
s s s s
s s s s s sG s G s
s s s s
s s s s s


 
 
 
    
        
    
      
2 2
3 2 3 2
5 6
2 2
3 2 3
,
.6 0.8554
6.316 22.51 1.007 5.126 21.66 0.9305
24.53 646.1 1.146 22.51 602.2 0.945( ) , ( )
5.688 71.64 3582 5.752 71.48 3326
24.53 646.1 1.146
L L
s
s s s s
s s s s s sG s G s
s s s s
s s s s
 
 
 
 
  
    
        
    
     2
2 2
3 2 3 2
7 8
2 2
3 2
,
22.51 602.2 0.945
5.503 22.79 0.9437 4.869 19.78 0.7948
22.86 624.9 1.054 22.43 547.2 0.8413( ) , ( )
5.759 69.54 3446 5.691
22.86 624.9 1.054
L L
s s
s s s s
s s s s s sG s G s
s s s
s s s
 
 
 
 
    
    
        
   
     3 2
.
75.84 3011
22.43 547.2 0.8413
s
s s s
 
 
 
 
    
  
And the following models are for the forward motor: 
2 2
3 2 3 2
1 2
2 2
3 2 3 2
69.21 86.29 9.319 67.2 69.67 8.653
41.37 580.2 0.4928 41.05 534.5 0.4681( ) , ( )
4.272 45.86 2435 4.147 48.26 2269
41.37 580.2 0.4928 41.05 534.5 0.4681
F F
s s s s
s s s s s sG s G s
s s s s
s s s s s s
    
        
    
       
2 2
3 2 3 2
3 4
2 2
3 2 3 2
,
68.17 75.7 8.457 63.86 81.14 8.77
41.58 553.6 0.6173 38.82 563.7 0.5722( ) , ( )
4.295 46.5 2363 4.348 43.49 2388
41.58 553.6 0.6173 38.82 56
F F
s s s s
s s s s s sG s G s
s s s s
s s s s s
 
 
 
 
  
    
        
    
      
2 2
3 2 3 2
5 6
2 2
3 2
,
3.7 0.5722
66.52 59.89 7.151 68.87 89.5 8.658
40.22 497.1 0.1583 40.25 572.2 0.5303( ) , ( )
3.997 47.22 2077 4.278 40.24 2409
40.22 497.1 0.1583
F F
s
s s s s
s s s s s sG s G s
s s s s
s s s
 
 
 
 
  
    
        
    
     3 2
2 2
3 2 3 2
7 8
2 2
3 2
,
40.25 572.2 0.5303
66.63 46.29 7.72 66.92 84.31 8.982
39.76 500.9 0.2717 39.27 573 0.6199( ) , ( )
4.145 43.08 2125 4.197
39.76 500.9 0.2717
F F
s s s
s s s s
s s s s s sG s G s
s s s
s s s
 
 
 
 
    
    
        
   
     3 2
,
41.82 2400
39.27 573 0.6199
s
s s s
 
 
 
 
    
These plants will be used for control design in Section IV. 
IV. ROBUST CONTROL DESIGN 
From the identification results, the system varies in 
different operating conditions. In order to guarantee 
stability and performance of the system with uncertainties, 
we apply robust control to the gait trainer. Suppose a 
system 0( )G s RH  
can be expressed as 
1
0 ( ) ( ) ( )G s M s N s  , where , M N RH    and 
* *MM NN I     . It is called a normalized left coprime 
factorization (NLCF) [14–16] of 0( )G s . Now suppose a 
perturb system G  can be expressed as 
1( ) ( )
M N
G M N         with  , M N RH      and 
[  ] M N    . The closed-loop system structure is 
represented as in Fig. 8.  
 
M

N

N 1M 

 


r 2z
1z
G
 
 
(a) NLCF feedback structure 
1 1
( )
K
I GK M
I
 

 
  
 
N M
 
1
2
z
z
 
 
 
 

 
(b) Rearrange for Small-Gain Theorem. 
Fig. 8 The NLCF feedback control structure. 
 
Theorem: Small Gain Theorem [14–16] 
The closed-loop system of Fig. 8(b) remains internally 
stable for all uncertainty  N M    , if and only if  
125
 3 2
3 2 5
3
2
3 2 5
1.329 743 596 3873
166.6 4828 1.211 10 .
0.1566 4.714 168.9
166.6 4828 1.211 10
T
F
s s s
s s sK
s s
s s s
    
     
   
     
 
and the following second-order controllers: 
5 5
2
2
2
2
1.475 10 6.891 10
72.72 1222 ,
1.166 202.1 2287
72.72 1222
T
R
s
s sK
s s
s s
     
   
   
     
5 5
2
2
2
2
1.356 10 4.152 10
67.24 820.9 ,
1.14 188.3 1538
67.24 820.9
T
L
s
s sK
s s
s s
     
   
   
     
2
2
2
2
2
1.329 535.3 3024
73.46 1047 .
0.1566 4.714 168.9
73.46 1047
T
F
s s
s sK
s s
s s
   
   
   
   
 
These controllers will be implemented for experiments in 
the following section. 
V. EXPERIMENTS 
We use the Tustin method to convert the continuous 
time controllers into discrete time with a sampling rate of 
50 Hz, and then implement these controllers on a cRIO 
system. In order to guarantee synchronic operation of the 
motors, we measure the motor positions and compare their 
phase errors. Suppose the input is r and the output is y, the 
position error is defined as e r y  . And the relative 
errors to the right motor are defined as RL R Le e e   for the 
left motor and RF R Fe e e  , for the forward motor where 
the subscripts R, L, and F represent the right, the left, and the 
forward motors, respectively. The synchronization control 
is to give the required motor trajectories of Fig. 5, and 
measure the relative errors RLe  and RFe . If | | 20RLe
  or 
| | 20RFe
 , then the cRIO will stop until the left and 
forward motors are adjusted to satisfied | | 0.1RLe
  and 
| | 0.1RFe
 . The synchronized control algorithms are 
illustrated in Fig. 10. 
| | 20?RLe 
| | 20?RFe 
| | 20?
and | | 20?
RL
RF
e
e


L
F
R
 
Fig. 10 Synchronized motor control. 
 
We invited a 8-year-old boy, who has a height of 135 
cm and a weight of 32 kg, to test the gait trainer, as shown 
in Fig. 11. [20] 
 
Fig. 11 Experiments by a tester. [20] 
 
To compare the system performance, we define the 
root-mean-square error (RMSE) as:  
1/21 2
11
( )
RMS error .
1
N
i ii
r
N



 
 
 
 

 
The system performance with different controllers is 
compared when the motor operates without any load. The 
system responses are shown in Fig. 12, and the RMSE are 
Table 1 The designed standard robust controllers. 
Controllers  Stability 
margins 
5 5 4 3 2 4 5
6 5 5 4 8 3 9 2 11 12
6 5 6 4 8 3 2 11
9.398 10 0.09324 15.58 942.8 2.768 10 6.481 10
1797 9.677 10 1.463 10 8.466 10 2.236 10 4.598 10
1.166 2224 1.349 10 2.765 10 1.965 10 5.261 10 9.86 1
R
s s s s s
s s s s s s
K
s s s s s


        
          
            12
6 5 5 4 8 3 9 2 11 12
0
1797 9.677 10 1.463 10 8.466 10 2.236 10 4.598 10
T
s s s s s s
                  
0.6511
5 4 3 2 4 5
6 5 4 4 5 3 7 2 8 8
6 5 4 4 6 3 7 2 8 9
6
0.004397 0.8668 58.8 1832 3.699 10 2.372 10
213.4 1.545 10 5.111 10 1.193 10 1.369 10 5.535 10
1.14 369.4 3.366 10 1.207 10 2.759 10 3.067 10 1.213 10
L
s s s s s
s s s s s s
K
s s s s s s
s

       
          
           
5 4 4 5 3 7 2 8 8213.4 1.545 10 5.111 10 1.193 10 1.369 10 5.535 10
T
s s s s s
                  
0.6594
6 5 4 4 7 3 8 2 10 11
6 5 6 4 8 3 10 2 11 13
6 5 6 4 9 3 11 2
0.1566 235.2 9.147 10 1.372 10 8.665 10 2.477 10 5.836 10
2255 1.536 10 3.023 10 2.182 10 5.943 10 1.15 10
1.329 3521 3.157 10 1.074 10 1.118 10
F
s s s s s s
s s s s s s
K
s s s s s

           
          
        12 13
6 5 6 4 8 3 10 2 11 13
3.666 10 4.383 10
2255 1.536 10 3.023 10 2.182 10 5.943 10 1.15 10
T
s
s s s s s s
                     
0.5985
 
127
國科會補助計畫衍生研發成果推廣資料表
日期:2011/10/01
國科會補助計畫
計畫名稱: 子計畫二：創新手輪馬達電動輪椅之質子交換膜燃料電池模組的系統識別、
控制與系統整合
計畫主持人: 王富正
計畫編號: 97-2221-E-002-230-MY3 學門領域: 系統整合與工業應用 
研發成果名稱
(中文) 燃料電池控制系統及其控制方法
(英文) FUEL CELL CONTROL SYSTEM AND METHOD
成果歸屬機構
國立臺灣大學 發明人
(創作人)
王富正,陳炫綜
技術說明
(中文) 一種燃料電池控制系統及其控制方法，主要係提供空氣供給模組、具有燃料供給
端之燃料供給模組、具有電力輸出端之燃料電池組、電力量測單元以及具有運算
單元之控制模組，藉以利用一組有效調控該燃料電池電力輸出之控制運算式，識
別出該系統之轉移函數，復於發現該輸出電力與預設之電力輸出值產生差異時，
利用該系統轉移函數與控制規則進行運算，進而產出燃料供給控制信號與空氣供
給控制信號，對燃料供給與空氣供給進行及時修正，俾穩定該燃料電池之輸出電
力，亦能降低燃料消耗。
(英文) The present invention generally relates to a control technique, and more particularly to a 
fuel cell control system and its control method. Firstly, the PEMFC system was modeled 
as multivariable transfer function matrices using identification techniques, with the un-
modeled dynamics treated as system uncertainties and disturbances. Secondly, robust 
control algorithms were utilized to design multivariable H∞ controllers to deal with 
system uncertainty and performance requirements. Finally, the designed robust 
controllers were implemented to control the air and hydrogen flow rates. From the 
experimental results, multivariable robust control is shown to provide steady output 
responses and significantly reduce hydrogen consumption.
產業別 電機及電子機械器材業；電力供應業；其他專業、科學及技術服務業
技術/產品應用範圍 整合燃料電池之系統控制
技術移轉可行性及
預期效益
具實際應用價值 (已有初步實驗結果可供評估)
註：本項研發成果若尚未申請專利，請勿揭露可申請專利之主要內容。
其他成果 
(無法以量化表達之成
果如辦理學術活動、獲
得獎項、重要國際合
作、研究成果國際影響
力及其他協助產業技
術發展之具體效益事
項等，請以文字敘述填
列。) 
1. Springer London 主編邀請撰寫燃料電池控制專書 
2. European Journal of Control 邀請發表燃料電池控制論文 
3. 受邀加入 IPEC 2010 commitee  
4. 受邀為 2012 American Control Conference Associate Editor 
3. 協助國內燃料電池系統廠商, 真敏與美菲德, 開發燃料電池控制系統 
 成果項目 量化 名稱或內容性質簡述 
測驗工具(含質性與量性) 0  
課程/模組 0  
電腦及網路系統或工具 0  
教材 0  
舉辦之活動/競賽 0  
研討會/工作坊 0  
電子報、網站 0  
科 
教 
處 
計 
畫 
加 
填 
項 
目 計畫成果推廣之參與（閱聽）人數 0  
 
