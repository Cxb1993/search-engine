error introduced by the nonlinearity of the value 
function may cause the pricing results to converge 
slowly or even oscillate significantly. A derivative 
is called multivariate if its value depends on more 
than one market variable. A lattice for a 
multivariate derivative is called a multivariate 
lattice. In this project, I propose a flexible multi-
phase method to build a multivariate lattice for 
pricing derivatives accurately. First, the original, 
correlated processes of market variables are 
transformed into uncorrelated ones by the Gram—
Schmidt orthogonalization method. A multivariate 
lattice is then constructed for the transformed, 
uncorrelated processes. To sharply reduce the 
nonlinearity error of many numerical pricing methods, 
the proposed lattice has the flexibility to match the 
so-called ＇critical locations＇ — the locations 
where nonlinearity of the derivative｀s value 
function occurs. Finally, the proposed construction 
methodology is applied to build multivariate lattices 
for pricing and analyzing some complex financial 
instruments, such as vulnerable options, insurance 
contracts guaranteed minimum withdrawal benefit 
(GMWB), and defaultable bonds. 
英文關鍵詞： nonlinearity error, derivatives pricing, lattice, 
multivariate, complexity 
 
letting nodes or discrete time steps match the critical locations; in addition, it is efficient for pricing
discretely monitored options, such as discrete barrier options, since it deploys only one time step
between two monitoring dates. However, the quadrature method is not as efficient as the lattice in
handling continuous sampling features, like the American exercise feature and the continuous barrier
options [16]. Besides, stochastic interest rate models, such as the Hull-White interest rate model [20],
are not covered by their methods.
1.2 The Goals of the Research Project
The major goal of this project is to propose a general multi-phase method to build multivariate lat-
tices for pricing complex derivatives without significant nonlinearity errors. By using the trinomial
structure of [16] into the lattice, the length of a time step, the distance between two adjacent price
levels, and even the position of the lattice can be changed to make the proposed lattice match critical
locations. In addition, the proposed lattice also generalizes the stair lattice proposed in [15]; the stair
lattice can handle the discrete price jumps in the underlying assets. This generalization significantly
extends the capability of the lattice to handle real-world features that are hard to address, like asset
sales to finance the discrete coupon payments and the insurance contract that allows the insurer to
withdraw money from the account.
To handle the correlations between the processes of market variables, Hull and White’s method
with the orthogonalization method is revised to transform the original, correlated processes into un-
correlated ones. The original, uncorrelated processes can be easily recovered by standard matrix
operations.
This work next builds a multivariate lattice for the transformed, uncorrelated processes. The
values of the i-th transformed process depend only on the values of the first i of the original, correlated
processes. Inductively, suppose we have built an i-variate lattice for the first i of the transformed
processes. We proceed to build a lattice for the (i+1)-th process among the transformed, uncorrelated
processes. Finally, these two lattices are combined to form an (i + 1)-variate lattice. In this sense,
the construction for an n-variate lattice has n phases. During the construction process, we locate the
critical locations in the transformed space and adjust the lattice to match them.
2 Methodology
￿￿￿￿
2.1 Modeling and Preliminaries
2.1.1 The Lognormal Diffusion Process and the CRR Lattice
Define S(t) as the value of a market variable at time t. S(t) is said to follow a lognormal diffusion
process if it can be represented as the following differential form under the risk-neutral probability:
dS(t)
S(t)
= rdt+ σdz(t), (1)
where r is the risk-free rate, σ is the volatility of the market variable, and the random variable dz(t)
is the standard Brownian motion. The lognormal diffusion process is widely used to model the stock
process [8], the firm value [29], and the portfolio value [14, 37]. Equation (1) has the following
solution [34]:
S(t) = S(0)e(r−σ
2/2)t+σz(t). (2)
A lattice is a numerical pricing method that approximates a continuous-time stochastic process,
e.g., S(t) in Eq. (2). Let a derivative on S(t) initiate at time 0 and mature at time T . A lattice
partitions this time span into n equal-distanced time steps and specifies the value of S(t) at each time
2
τ τ +∆t￿
A
B
C
D
Pu
Pm
Pd
∆t￿
|α|
|β|
|γ|
x
x+ 2
√
∆t
x+ 4
√
∆t
X(τ)
E(X(τ +∆t￿)|X(τ))
Figure 2: The Trinomial Structure. Node A with value X(τ) at time τ can move to node B(x) with
probability Pu, nodeC (at position x+2
√
∆t) with probability Pm, and nodeD (at position x+4
√
∆t)
with probability Pd. The conditional expected value ofX(τ+∆t￿), orE(X(τ+∆t￿)|X(τ)), is marked
by the cross. The symbols |α|, |β|, and |γ| denote the distances between E(X(τ + ∆t￿)|X(τ)) and
the nodes B, C, D, respectively.
conditional expected value ofX(τ +∆t￿) from the values of nodes B, C,D, respectively. This yields
valid branching probabilities Pu, Pm, and Pd [16].
2.1.3 The Hull-White Interest Rate Model and Its Lattice
The Hull-White interest rate model (see [20]) is a no-arbitrage short rate model that is able to match
the market’s term structure of interest rates. The short rate at time t, r(t), follows the stochastic
process
dr(t) = (θ(t)− ar(t))dt+ σrdzr, (3)
where θ(t) is a function of time that makes the model fit the real-world interest rate market, a denotes
the mean reversion rate for the short rate r(t) to revert to θ(t)/a, σr denotes the instantaneous volatility
of the short rate, and dzr is the standard Brownian motion. [22] provide a two-stage lattice-building
procedure for the Hull-White interest rate model.
2.1.4 The Oscillation Problem and Nonlinearity Error
Although the prices generated by the lattice converge to the theoretical value of a contingent claim as
n→∞ (see [17]), they may oscillate significantly. According to [18], this phenomenon is due to the
error introduced by the nonlinearity of the value function of the contingent claim. This nonlinearity
error can be much reduced by making a node or a price level of the lattice match the critical locations
where the value function of the contingent claim is highly nonlinear (see [16]). Critical locations are
straightforward to identify. For example, the vanilla option has a critical point at maturity with the
stock price equal to the strike price. For continuous barrier options, the critical price level occurs
along the barrier price. For pricing vulnerable options and defaultable bonds under the structural
4
Integrate both sides of Eq. (8) to yield
X1(t) =
Sa(t)− Sa(0)
σa
, (9)
X2(t) =
1￿
1− ρ2
￿
Sb(t)− Sb(0)
σb
− ρ Sa(t)− Sa(0)
σa
￿
=
1￿
1− ρ2
￿
Sb(t)− Sb(0)
σb
− ρX1(t)
￿
, (10)
where X1(0) = X2(0) = 0 for convenience. The market variables Sa(t) and Sb(t) can be expressed
in terms of X1(t) and X2(t):
Sa(t) = Sa(0) + σaX1(t), (11)
Sb(t) = Sb(0) + σb
￿￿
1− ρ2X2(t) + ρX1(t)
￿
. (12)
The above method can be easily generalized to handle more than two correlated stochastic pro-
cesses. If n correlated processes need to be orthogonalized, the lower-triangular matrix A (e.g., Eq.
(6)) can be obtained by decomposing the covariance matrix of n correlated Brownian motions by the
Cholesky decomposition [19].
The proposed lattice approximates the uncorrelated processes X1(t) and X2(t); the values of the
original market variables (Sa(t) and Sb(t)) on each node of the lattice can be recovered by substituting
X1(t) and X2(t) into Eqs. (11)–(12). Note that the fact that Sa(t) depends only on X1(t), and vice
versa, can help locate the positions of critical locations and adjust the lattice to match the locations.
2.2.2 Cores Ideas of the Multi-Phase Branch Construction
The core ideas of the proposed multi-phase branch construction are illustrated in Fig. 3. Consider
a bivariate lattice that approximates the evolution of two uncorrelated processes X1(t) and X2(t).
The construction contains two phases. Let us focus on node A with value (X1(τ), X2(τ)). The
first phase constructs the trinomial structure from node A￿, the projection of node A on the X1-t
plane, to approximate process X1(t). After selecting nodes B￿, C ￿, and D￿ as the destinations of
the trinomial structure, the branching probabilities Pu, Pm, and Pd are calculated. The second phase
approximates X2(t); the trinomial structure from node A to nodes B1, B2, and B3 is constructed,
and the corresponding probabilities Qu, Qm, Qd are calculated. After combining the branches from
the two planes, node A now has nine branches, and the joint branching probabilities can be obtained
by multiplying the branching probabilities in the X1 dimension and those in the X2 dimension. For
example, the joint branching probability from node A to node B1 is PuQu. Note that the nodes at
time τ + ∆t￿ on both X1-t and X2-t planes are positioned so that one of the nodes at time τ + ∆t￿
coincides with the critical location.
2.2.3 A Bivariate Lattice: Two Correlated Market Variables
We now focus on the bivariate lattice for two market variables: the stock price, S(t), and the firm’s
asset value, V (t). The bivariate lattice is built to price vulnerable barrier options with the strike price
K and the barrier B(t) = Be−γ(T−t). The default boundary for the firm’s asset value at time t,D∗(t),
is assumed to be the sum of the non-vulnerable option value at time t, c(S(t), t), and the discounted
value of the firm’s outstanding debt; that is, D∗(S(t), t) = De−r(T−t) + c(S(t), t), where D denotes
the firm’s outstanding debt [25]. In this setup, the option holder receives
c(S(t), t)/D∗(S(t), t) (13)
6
from the lattice for Y (t), both at time step j. Since X(t) and Y (t) are uncorrelated, the branching
probabilities can be obtained by multiplying the branching probabilities of the X(t)-lattice and those
of the Y (t)-lattice.
The construction for the X(t)-lattice is described first. By Eq. (9), the barrier B(t) for the stock
price S(t) can be transformed to the barrier BX(t) on the X(t)-lattice:
BX(t) =
1
σS
(lnB(t)− lnS(0)) . (18)
Figure 4(a) depicts a 3-time-step X(t)-lattice with the time-varying barrier BX(t). The lattice starts
by placing gray nodes on the barrier to reduce the nonlinearity error. All the other nodes are then laid
from the gray nodes upward and downward with the log-distance between any two vertically adjacent
nodes being 2
√
∆t. This setting helps us construct trinomial branches from any node at time step t to
the three successor nodes at time step t + 1 via the procedure proposed by [16]. Start from node X
for X(0). Its successor nodes will be selected from the nodes at time step 1, the successor nodes of
these 3 nodes will be selected from the nodes at time step 2, and so on. Note that the option knocks
out once X(t) reaches the gray nodes on the barrier. The gray nodes, therefore, have no need for
successor nodes.
We now proceed to build the Y (t)-lattice. Recall that the default boundary for the firm’s asset
value V (t) is assumed to be D∗(t) = De−r(T−t) + c(S(t), t). The term c(S(t), t) can be evaluated by
the Black-Scholes formula as follows:
c(S(t), t) = S(t)N(d1)−Ke−r(T−t)N(d2), (19)
whereN(·) denotes the CDF of the standard, 1-dimensional normal distribution, and
d1 =
ln(S(t)/K) + (r + σ2S/2)(T − t)
σS
√
T − t ,
d2 = d1 − σS
√
T − t.
By Eq. (10), the default boundaryD∗(t) for the firm’s asset value can be transformed to the boundary
D∗Y (t) on the Y (t)-lattice thus:
D∗Y (t) =
1￿
1− ρ2
￿
lnD∗(t)− lnV (0)− ρX(t)
σV
￿
. (20)
Once we have D∗Y (t), the lattice again starts by placing nodes on this default boundary (the black
nodes in Fig. 4(b)). Note that each node with the value x on the X(t)-lattice corresponds a unique
stock price S(0)eσSx by Eq. (11). Since D∗Y (t) depends on the stock price as in Eq. (20), each node
on the X(t)-lattice will map to a value of D∗Y (t) given the value of this node. For example, in Fig.
4(b), node a on the X(t)-lattice corresponds to node A on the default boundary; similarly, node b
corresponds to node B on the default boundary. The branch construction procedure for the Y (t)-
lattice is identical to that for the X(t)-lattice.
Recall that each node in the bivariate lattice corresponds to a bivariate state with a value from the
X(t)-lattice and a value from the Y (t)-lattice. As the trinomial X(t)-lattice and the trinomial Y (t)-
lattice are combined to build our bivariate lattice, there are 3× 3 = 9 branches per node as illustrated
in Fig. 4(c). Node X at time step t has 9 branches, to nodes A, B, C, D, E, F , G, H , and I at time
step t+ 1. It is straightforward to show that the size of the bivariate lattice is O(n3).
An Example Lattice
This subsection provides a numerical example to illustrate how to construct a bivariate lattice for
pricing vulnerable barrier options. Assume the strike price is K = 30, the maturity is T = 3, the
8
Y (t)-lattice. For example, by the result in Eq. (21),
D∗Y (1.5) =
1√
1− 0
￿
ln(111.516)− ln(100)
0.2
− 0× 1.707
￿
≈ 0.545.
Once we have D∗Y (t), all the nodes on the Y (t)-lattice are laid on top of D∗Y (t) and then from the
D∗Y (t) upward and downward as illustrated in Fig. 6. In Fig. 6, the firm defaults when Y (t) reaches
the dark-gray nodes, which, therefore, have no need for successor nodes. The branching probabilities
can be obtained by the procedure in Subsection 2.1.2.
We now calculate the value of the vulnerable option on the 2-time-step bivariate lattice in Fig. 6
via backward induction. At maturity (time step 2), the option knocks out when the stock price hits
the barrier (the light-gray node), so the option value is 0 (node E). If the option does not knock out
(i.e., nodes A, B, C, and D), there are two cases: (1) the firm defaults if its asset value is less than
the default boundary D∗Y (t); (2) otherwise, the firm survives (the white nodes). For example, at node
c1, the firm survives and the option value is (93.237− 30, 0)+ ≈ 63.24. As another example, the firm
defaults at node d3, and the option value is
0.75× 117.125× (57.125− 30)
+
117.125
≈ 20.344
by Eq. (13). The option values at time step 1 are obtained by backward induction with the appropriate
branching probabilities. For example, the value of the option at node b1 equals
e−0.05×1.5 × (0.157× (0.445× 63.24 + 0.554× 47.43 + 0.002× 29.06)+
0.746× (0.121× 27.13 + 0.75× 27.13 + 0.129× 20.34) +
0.096× 0) ≈ 26.13.
Note that the joint probabilities can be obtained by multiplying the branching probabilities on the
X(t)-lattice and the Y (t)-lattice because X(t) and Y (t) are uncorrelated. Finally, the option value
for node A at year 0 can be computed thus:
e−0.05×1.5 × (0.401× (0.068× 26.13 + 0.733× 21.02 + 0.199× 12.88)+
0.594× 0 + 0.006× 0) ≈ 7.337.
2.2.4 A Bivariate Lattice with Stochastic Interest Rate as the Second Market Variable
This subsection focuses on bivariate lattices with the following two market variables: the interest rate,
r(t), and the firm’s asset value, V (t). The asset value is assumed to follow the process in Eq. (1). The
bivariate lattice is built to price defaultable bonds with a positive net-worth covenant ξPV (t) as the
default boundary (see [6]) under the Hull-White interest rate model in Eq. (3), where PV (t) denotes
the sum of the present values of the unpaid coupons and the face value at maturity of the defaultable
bond at time t, where ξ is a constant.
We first apply the orthogonalization process mentioned in Subsection 2.2.1 to the original two
processes, r(t) and V (t) in Eq. (3) and Eq. (14), respectively, to obtain two uncorrelated process
X(t) and Y (t). According to matrix equation (8),
dX(t) =
θ(t)− ar(t)
σr
dt+ dzr,
dY (t) =
1￿
1− ρ2
￿
− ρ
σV
(θ(t)− ar(t)) + 1
σV
￿
r(t)− σ
2
V
2
￿￿
+ dz,
where dzr and dz are uncorrelated.
10
YX
t
S = 40
S = 56.275
S = 21.125
S = 93.237
S = 57.125
S = 35
S = 35
V = 182.01
Y = 2.99
V = 111.516
Y = 0.545
V = 68.32
Y = −1.90
V = 250.11
Y = 4.58
V = 153.237
Y = 2.134
V = 93.89
Y = −0.32
V = 312.01
Y = 5.68
V = 191.17
Y = 3.24
V = 117.125
Y = 0.790
7.3
4
26
.13
21
.02
12
.88
63
.24
47
.43
29
.06
27
.13
27
.13
20
.34
0
0
∆t = 1.5 ∆t = 1.5
Time step 0 1 2
Q u
=
0.
06
8
Qm
= 0
.73
3
Qd = 0
.199
Q
u
=
0.
44
5
Q
m
=
0.
55
4
Q
d
=
0.
00
2
S = 34.479
Qu
=
0.1
21
Qm = 0.
75
Q
d = 0.129
A
B
C
D
E
b1
b2
b3
c1
c2
c3
d1
d2
d3
X = 0
X = 1.707
X = 4.231
X = 1.782
a1
X = −3.192
X = −0.668
X = −0.743
0
Figure 6: A 2-Time-Step Bivariate Lattice. The curve denotes the time-varying barrierBX(t) on the
X-t plane. The log-distances between any two vertically adjacent nodes on the X-t and Y -t planes
are both 2
√
∆t. The option knocks out when X(t) reaches the light-gray nodes. The firm defaults
when Y (t) reaches the dark-gray nodes.
12
date. Thus the option prices under the [25] setting (with a higher debt obligation D + c(S(T ), T ))
should be lower than those under the [24] setting (with a lower debt obligation D), as expected.
The first-passage model (FPM hereafter) proposed by [6] generalizes Merton’s credit risk model
by allowing the default to occur prior to the option’s maturity. In the sixth column, we generalize
the setting in [24] by assuming that the default boundary at time t as the discounted value of D; that
is, De−r(T−t). In the seventh column, the setting in [25] is generalized by assuming that the default
boundary as the sum of the non-vulnerable option value at time t, c(S(t), t), and the discounted
value of other outstanding debts; that is, De−r(T−t) + c(S(t), t). In this case, analytical formulas
and numerical methods are hard to come by since the default boundary contains a stochastic term
c(S(t), t), which is governed by the stock price process. Again, a higher default boundary implies a
higher likelihood for the option holders to suffer from the loss of firm’s default. Thus under the FPM,
the option prices under the generalized [25] setting (with a higher default boundary De−r(T−t) +
c(S(t), t)) should also be lower than those under the [24] setting (with a lower default boundary
De−r(T−t)), as expected.
Our lattice can be extended to price barrier options with counterparty risk. To suppress the non-
linearity error, our lattice matches both the default boundary in the firm’s asset value and the barrier
in the stock price. The robustness and the fast convergence of our lattice is confirmed by the solid line
in Fig. 7 for pricing a vulnerable barrier call option under the FPM. To our knowledge, no analytical
formulas are available to handle this problem in which each dimension has one boundary (the default
boundary and the barrier); even both boundaries are all simple constants. A naive numerical method
that does not align with the barrier and the default boundary will generate oscillating prices depicted
as the dashed line in Fig. 7.
Our lattice is able to price vulnerable barrier options under various structural models and different
barrier settings as illustrated in Table 2. Analytical formulas are only available for Merton’s structural
model with a constant debt obligation (see [30]) as in the Formula column. The robustness of our
lattice is corroborated by the closeness of the prices generated by our lattice to those generated by
analytical formulas. Furthermore, our lattice can be easily extended to deal with other more complex
structural models that are analytically intractable. Like the results of the vulnerable vanilla options
in Table 1, the values of the vulnerable barrier options priced under the setting in [25] are lower than
those priced under the setting in [24].
Option price behaviors may differ greatly under different structural models. In the volatility sen-
sitivity plot in Fig. 8, for example, the discrepancy of option prices under two different structural
models increases with the stock price volatility. Moreover, the option values under Merton’s model
with the [25] setting assume a humped shape, while the option values under other models increase
monotonically with volatility.
The relationships between option values and structural models are discussed as follows. Since
the default boundary under [24] is lower than that under [25], the firm incurs less bankruptcy cost
under the former setting than the latter one. Therefore, the option values under [24] (the dotted and
dashed lines in Fig. 8) are greater than those under [25] (the solid and dot-dashed lines). Compared
to Merton’s model, the FPM allows the firm to default prior to maturity and has a higher default
probability. Thus more bankruptcy cost is introduced under the FPM, which harms the value of the
vulnerable option. However, the FPM provides protections to option holders by letting the firm default
when its asset value goes below the default boundary. This protection raises the option value. If the
effct of incurring more bankruptcy cost under the FPM dominates that of the protection provided by
the FPM, the option values under Merton’s model will be higher than those under the FPM; see the
prices in Fig. 8 under the [24] setting for example. On the contrary, [25] include the potential liability
of the written option (c(S(t), t)) into the debt obligation which provides more protection to the option
holders. So in this case, the effect of the protection dominates that of increased bankruptcy cost and
the option values under Merton’s model are lower than those under the FPM.
14
 4.66
 4.68
 4.7
 4.72
 4.74
 4.76
 4.78
 50  100  150  200  250  300  350  400  450
Op
ti
on
 v
al
ue
#(Time steps)
Barrier not matched
Barrier matched
Figure 7: Convergence of the Vulnerable Barrier Call Option under the FPM Model. The x and
the y axes denote the number of time steps and the option value, respectively. A barrier call option
is assumed to be issued by a firm at time 0 and the call matures at T = 3 (years). The amount of all
other outstanding debts of the firm is D = 90. The initial stock price is S(0) = 40, the strike price is
K = 40, the initial firm’s asset value is V (0) = 100, the volatility of the stock price is σS = 0.2, the
volatility of the firm’s asset value is σV = 0.2, the correlation between the stock price and firm’s asset
value is ρ = 0, the risk-free interest rate is r = 0.05, and the recovery rate is α = 0.75, The barrier is
35. The default boundary for the firm’s asset value at time t is D∗(t) = De−r(T−t) + c(S(t), t).
3.1.2 Evaluating Defaultable Bonds and GMWBs under Short Rate Models
To price defaultable bonds under short rate models, we build a bivariate lattice with asset price and
interest rate as market variables. Our lattice describes the dynamics of the asset value and the inter-
est rate, which is assumed to follow the Hull-White model (see [22]). Table 3 compares defaultable
zero-coupon bond prices by our lattice and those by the analytical formula proposed by [10]. The
robustness of our lattice is affirmed by the low relative pricing errors. Note that the values of default-
able zero-coupon bonds are lower than default-free ones due to the credit risk. Their price discrepancy
increases with the face value since the credit risk increases with the amount of outstanding bonds.
Both asset-sales assumptions and positive net-worth covenants affect bond prices. The coupon
payments can be either financed by selling the firm’s asset, which is called the total-asset-sales as-
sumption (see [29, 9]), or by issuing new equities, which is called the no-asset-sales assumption (see
[27]). [26] argues that the existence of jumps under the total-asset-sales assumption makes analytical
formulas impossible and lattices non-recombining. But our proposed methodology proves otherwise.
The defaultable bond prices under these two assumptions are listed under the “Total-asset-sales” and
“No-asset-sales” columns in Table 4. Under the total-asset-sales assumption, the firm’s asset value
jumps downward by the amount of the coupon at the payment date. These downward jumps weaken
the firm’s financial status and increase its default risk. That explains why the bond values under the
total-asset-sales assumption are lower than those of an otherwise identical bond under the no-asset-
sales assumption. The only exception when the bonds values are equal is the annual coupon payment
setting. This is because the only coupon is paid at maturity T=1 (year), which, coinciding with the
return of the face value, can be treated as part of the face value.
The FPM assumes the firm is allowed to default prior to maturity and the firm defaults when its
asset value goes below an exogenous default boundary. We follow [27] by calling a bond with an
exogenous default boundary a protected bond, and a bond without an exogenous default boundary an
16
 5
 10
 15
 20
 25
 30
 0  0.2  0.4  0.6  0.8  1
Op
ti
on
 v
al
ue
Volatility of stock
Merton + Klein (1996)
Merton + Klein and Inglis (2001)
FPM + Klein (1996)
FPM + Klein and Inglis (2001)
Figure 8: Vanilla Option Values with Various Stock Price Volatilities. A call option is assumed
to be issued by a firm at time 0 and the call matures at T = 3 (years). The amount of all other
outstanding debts of the firm is D = 90. The initial stock price is S(0) = 40, the strike price is
K = 40, the initial firm’s asset value is V (0) = 100, the volatility of the stock price is σS = 0.2,
the volatility of the firm’s asset value is σV = 0.2, the correlation between the stock price and firm’s
asset value is ρ = 0, the risk-free interest rate is r = 0.05, the recovery rate is α = 0.75, and the
number of the time steps is n = 500. In [24], the default boundary for the firm’s asset value at time
t is D∗(t) = De−r(T−t), whereas in [25], the default boundary for the firm’s asset value at time t is
D∗(t) = De−r(T−t) + c(S(t), t), where c(S(t), t) denotes the value of the call option at time t. In
Merton’s model, the default can only occur at maturity, whereas the default can occur prior to maturity
in the FPM.
ical locations, the market variables are first properly ordered. Then our multivariate lattice describes
the evolution of the uncorrelated processes transformed from the original, correlated processes of
market variables by orthogonalization. Numerical results for vulnerable options, insurance contracts
GMWB, and defaultable bonds show that our multi-phase method can be applied to the pricing of
various complex financial contracts accurately.
18
Call/
Put Callable bonds Putable bonds Straight bonds
prices Defaultable Default-free Defaultable Default-free Defaultable Default-free
3030 3016.6 3029.4 3063.6 3063.8 3017.6 3034.8
3035 3017.2 3033.0 3068.4 3068.7 3017.6 3034.8
3040 3017.5 3034.4 3073.2 3073.5 3017.6 3034.8
3050 3017.6 3034.8 3082.9 3083.2 3017.6 3034.8
Table 5: Pricing Callable and Putable Bonds. The initial firm’s asset value is V (0) = 5000, the
volatility of the firm’s asset is σV = 30%, the face value is F = 3000, the annualized coupon rate
is c = 5%, the maturity is T = 1, the correlation between the firm’s asset value and the interest rate
is ρ = −0.25, the recovery rate is α = 1, and the tax rate is τ = 0. The parameters for the interest
rate model are a = 50% and σr = 1%. The annualized yields of zero-coupon bonds for years 0.5
and 1 are 0.0343 and 0.0382, respectively, and those for any other time t ∈ [0, 1] is calculated by
linear interpolation. The default boundary for defaultable bonds at time t is ξ = 90% of the sum
of the present values of the unpaid coupons and the face value at maturity. The continuous coupon
payments are fully financed by selling the firm’s asset. The bond prices are evaluated numerically by
our lattice with 180 time steps.
Charges (bps)
T ρ = −0.2 ρ = 0 ρ = 0.2
1 140.43 141.85 142.48
5 42.94 44.21 45.32
10 19.07 20.13 21.15
20 7.73 8.48 9.21
25 5.61 6.25 6.86
Table 6: Charges Change with Maturities and Correlations. The initial account value isW (0) =
100, and the volatility of the account value is σW = 20%. In the table, T represents the maturity, and
ρ represents the correlation between the account value and the interest rate. The number of the time
steps is n = 20 × T , and the annual withdrawal is G = W (0)/T . The curve of annualized yields
of zero-coupon bonds is generated by the Vasicek model with parameters r(0) = 3%, θ = 0.3%,
σr = 1%, and a = 0.1.
20
[19] G.H. Golub and C.F. Van Loan. Matrix Momputations. Baltimore: Johns Hopkins University
Press, 1996.
[20] J. Hull and A. White. Pricing Interest-Rate-Derivative Securities. The Review of Financial
Studies, 3(4):573–592, 1990.
[21] J. Hull and A.White. Valuing Derivative Securities Using the Explicit Finite Difference Method.
Journal of Financial and Quantitative Finance, 25(1):87–100, 1990.
[22] J. Hull and A. White. Numerical Procedures for Implementing Term Structure Models II. Jour-
nal of Derivatives, 2(2):37–48, 1994.
[23] H. Johnson and R. Stulz. The Pricing of Options with Default Risk. Journal of Finance,
42(2):267–280, 1987.
[24] P. Klein. Pricing Black-Scholes Options with Correlated Credit Risk. Journal of Banking and
Finance, 20(7):1211–1229, 1996.
[25] P. Klein and M. Inglis. Pricing Vulnerable European Options When the Option’s Payoff Can
Increase the Risk of Financial Distress. Journal of Banking and Finance, 25(5):993–1012, 2001.
[26] D. Lando. Credit Risk Modeling: Theory and Applications. Princeton, NJ: Princeton University
Press, 2004.
[27] H.E. Leland. Corporate Debt Value, Bond Covenants, and Optimal Capital Structure. Journal
of Finance, 49(4):157–196, 1994.
[28] Y.-D. Lyuu and C.-J. Wang. On the Construction and Complexity of the Bivariate Lattice with
Stochastic Interest Rate Models. Computers & Mathematics with Applications, 61(4):1107–
1121, 2011.
[29] R.C. Merton. On the Pricing of Corporate Debt: The Risk Structure of Interest Rates. Journal
of Finance, 29(2):449–470, 1974.
[30] Z.-H. Pan. Vulnerable Option Pricing: The Dual Problem. Master’s Thsis, Institute of Finance,
Natoinal Chiao Tung University, Hsinchu, Taiwan, 2010.
[31] E. Reiner and M. Rubinstein. Breaking Down the Barriers. Risk, 4(8):28–35, 1991.
[32] P. Ritchken. On Pricing Barrier Options. Journal of Derivatives, 3(2):19–28, 1995.
[33] M. Rubinstein. Return to Oz. Risk, 7(11):67–70, 1994.
[34] S.E. Shreve. Stochastic Calculus for Finance: Continuous-Time Models. New York: Springer,
2004.
[35] Y. Tian. A Flexible Binomial Option Pricing Model. Journal of Futures Markets, 19(7):817–
843, 1999.
[36] M.Widdicks, A.D. Andricopoulos, D.P. Newton, and P.W. Duck. On the Enhanced Convergence
of Standard Lattice Methods for Option Pricing. Journal of Futures Markets, 22(4):315–338,
2002.
[37] H.-C. Wu. Pricing Guaranteed Minimum Withdrawal Benefits by Tree. Master’s Thsis, Depart-
ment of Finance, Natoinal Taiwan University, Taipei, Taiwan, 2009.
[38] R. Zvan, P.A. Forsyth, and K.R. Vetzal. Negative Coefficients in Two-Factor Option Pricing
Models. Journal of Computational Finance, 7(1):37–74, 2003.
22
2 Dai, Wang, and Lyuu
oscillating prices. To construct an accurate, multivariate lattice, this study pro-
poses a multiphase method that alleviates the oscillating problem by making the
lattice match the “critical locations,” locations where nonlinearity of the deriva-
tive’s value function occurs. Moreover, our lattice has the ability to model the
jumps in the market variables such as regular withdraws from an investment ac-
count, which is hard to deal with analytically. Numerical results for vulnerable
options, insurance contracts guaranteed minimum withdrawal benefit (GMWB),
and defaultable bonds show that our methodology can be applied to the pricing
of a wide range of complex financial contracts. C© 2012 Wiley Periodicals, Inc. Jrl
Fut Mark
1. INTRODUCTION
The financial markets have become vast, tightly integrated, and complex, partic-
ularly in the derivatives sector (see Bank for International Settlements, 2010).
As a result, derivatives pricing has become much more complicated. One reason
is that more sophisticated derivatives are constantly being structured to fit the
needs of markets. Addressing their sophisticated features significantly increases
the difficulty of pricing them (see Figlewski &Gao, 1999). Another reason is that
the importance of some factors, such as sovereign risk or credit risk, which are
overlooked in earlier, primitive derivatives pricing models, is being recognized
as key due to recent financial crises. If the default risk of the option issuer (or
the counterparty risk) is ignored, analytical pricing formulas for vanilla options
and barrier options have been derived by Black and Scholes (1973) and Reiner
and Rubinstein (1991), respectively. However, when the structural model (see
Black & Cox, 1976; Merton, 1974) is introduced to model the counterparty risk,
analytical formulas for the vulnerable vanilla options (defined in, e.g., Ammann,
2001) are only available under restricted assumptions (see Klein, 1996; Klein
& Inglis, 2001). In addition, no analytical formulas seem to exist for vulnera-
ble barrier options under the Black and Cox (1976) first-passage model (FPM
hereafter).
The lattice method and the closely related finite-difference method are pop-
ular and flexible numerical methods for pricing derivatives, particularly when
analytical solutions do not exist or when analytical solutions involve multiple
integrations. These methods can be easily modified to price derivatives with
American and other exotic features. They divide the time dimension and the
market factors/variables into discrete points. The results converge to the desired
value under the continuous-time model as the number of discrete steps goes to
infinity (see Duffie, 1996).
Figlewski and Gao (1999) point out that one of the most difficult issues
facing lattice and finite-difference methods is the nonlinearity error. This error
reveals itself as oscillating prices, resulting from the nonlinearity of the deriva-
tive’s value function—such as the kink of the option payoff function. Figlewski
Journal of Futures Markets DOI: 10.1002/fut
4 Dai, Wang, and Lyuu
Hull–White interest rate model (see Hull and White, 1990a), are not covered
by their methods.
The major contribution of this study is a general multiphase method to
build multivariate lattices for pricing complex derivatives without significant
nonlinearity errors. By using the trinomial structure of Dai and Lyuu (2010)
into our lattice, the length of a time step, the distance between two adjacent
price levels, and even the position of the lattice can be changed to make the
lattice match the critical locations. In addition, our lattice also generalizes the
stair lattice proposed in Dai (2009); the stair lattice can handle the discrete
price jumps in the underlying assets. This generalization significantly extends
the capability of our lattice to handle real-world features that are hard to address,
such as asset sales to finance the discrete dividend payments and the insurance
contract that allows the insurer to withdraw money from the account.
Hull and White (1990b) handle the correlations between market variables
by the orthogonalization method, which transforms the original, correlated pro-
cesses into uncorrelated ones. To simultaneously handle the correlations and
make the lattice match the critical locations, we precede their orthogonalization
method with ordering the market variables so that the ith coordinates of the
critical locations depend only on the first i of the market variables. The pro-
posed multiphase method builds the multivariate lattice for the transformed,
uncorrelated processes with successive coordinates. The first phase constructs
the lattice for the first uncorrelated process; this lattice will match the first
coordinates of the critical locations. The second phase adds a lattice for the
second uncorrelated process on top of the lattice constructed in the first phase
to form a bivariate lattice while matching the second coordinates of the critical
locations. A multivariate lattice is finally constructed by repeating the above
method: The ith phase adds a lattice for the ith uncorrelated process on top
of the (i − 1)-variate lattice constructed in (i − 1)th phase to form an i-variate
lattice. The ith phase will adjust the lattice to match the ith coordinates of the
critical locations.
Take the pricing of vulnerable knock-out barrier options on stock under
the FPM (see Black & Cox, 1976) as an example. There are two cases that
the value of the option becomes zero with a zero recovery rate: (1) the stock
price process reaches the barrier, and (2) the firm’s asset value is less than the
default boundary, which is the sum of the firm’s outstanding bonds and the
nonvulnerable option value. A bivariate lattice is constructed to describe the
evolution of the two correlated market variables, that is, the firm’s asset value V
and the stock price S. First, the two market variables are ordered: S is the first
market variable and V the second. The reason for the choice is that the barrier
for the stock price depends only on the value of S, whereas the default boundary
for the firm’s asset value depends on both S and V . We then transform the two
Journal of Futures Markets DOI: 10.1002/fut
6 Dai, Wang, and Lyuu
FIGURE 1
The CRR lattice. The value of process S(t) at time step 0 is denoted as S0. The upward and
downward multiplicative factors are u and d , respectively. The upward and downward branching
probabilities are Pu and Pd = 1− Pu, respectively. The log-distance between two adjacent stock
prices at any given time step is 2σ
√
"t, where "t is the length of a period.
(1979) depicted in Figure 1, for example. Each stock price S can either move
upward to become Su with probability Pu, or move downward to become Sd
with probability Pd ≡ 1− Pu. The upward and downward movements (u and
d) and the branching probabilities (Pu and Pd ) of the CRR lattice are set to
asymptotically match the mean (µ) and the variance (σˆ 2) of the lognormal
return of S(t), which can be derived from Equation (2) as
µ ≡ (r − σ 2/2)"t,
σˆ 2 ≡ σ 2"t.
The CRR lattice adopts the following solution:
u = eσ
√
"t,
d = e−σ
√
"t,
Pu = e
r"t − d
u − d ,
Pd = e
r"t − u
d − u .
For convenience, define the log-distance between stock prices S and S′ as
| ln(S)− ln(S′)|. Thus the log-distance between any two adjacent stock prices at
any given time step in the CRR lattice (see Figure 1) is 2σ
√
"t.
Journal of Futures Markets DOI: 10.1002/fut
8 Dai, Wang, and Lyuu
Dai and Lyuu (2010) prove that this yields valid branching probabilities.
Pu = βγ +#t
′
(α − β)(α − γ ) ,
Pm = αγ +#t
′
(β − α)(β − γ ) ,
Pd = αβ +#t
′
(γ − β)(γ − α) .
2.3. The Hull–White Interest Rate Model and
Its Lattice
The Hull–White interest rate model (see Hull &White, 1990a) is a no-arbitrage
short rate model that is able to match the market’s term structure of interest
rates. The short rate at time t, r (t), follows the stochastic process
dr (t) = (θ(t)− ar (t))dt + σr dzr , (3)
where θ(t) is a function of time that makes the model fit the real-world interest
rate market, a denotes the mean reversion rate for the short rate r (t) to revert
to θ(t)/a , σr denotes the instantaneous volatility of the short rate, and dzr is
the standard Brownian motion. Hull and White (1994) provide a two-stage
lattice-building procedure for the Hull–White interest rate model.
2.4. The Oscillation Problem and
Nonlinearity Error
Although the prices generated by the lattice converge to the theoretical value of
a contingent claim as n→∞ (see Duffie, 1996), theymay oscillate significantly.
According to Figlewski and Gao (1999), this phenomenon is due to the error
introduced by the nonlinearity of the value function of the contingent claim.
This nonlinearity error can be much reduced by making a node or a price
level of the lattice match the critical locations where the value function of the
contingent claim is highly nonlinear (see Dai & Lyuu, 2010). Critical locations
are straightforward to identify. For example, the vanilla option has a critical
point at maturity with the stock price equal to the strike price. For continuous
barrier options, the critical price level occurs along the barrier price. For pricing
vulnerable options and defaultable bonds under the structural model, critical
locations run along the exogenous default boundary. The hard problem is that,
Journal of Futures Markets DOI: 10.1002/fut
10 Dai, Wang, and Lyuu
To simultaneously handle the correlations and make our lattice match
the critical locations, we revise Hull and White’s (1990b) orthogonalization
method, which transforms the original, correlated processes into uncorrelated
ones. Before the transformation, the market variables are so ordered that the
ith coordinates of the critical locations depend only on the first i of the market
variables. For example, the two correlated market variables are ordered so that
S1 is followed by S2 when the first coordinates of the critical locations are
functions of S1 and the second coordinates are functions of S1 and S2.
Let S1 and S2 be represented as follows:
dS1 = µ1dt + σ1dz1,
dS2 = µ2dt + σ2dz2.
Above, for x ∈ {1,2}, µx denotes the drift of Sx , σx denotes the volatility of Sx ,
and dzx denotes the standard Brownian motion. The correlation between dz1
and dz2 is ρ.
It is well known that dz2 can be decomposed into a linear combination of
dz1 and another independent Brownian motion dz thus:
dz2 = ρ dz1 +
√
1− ρ2 dz. (4)
The differential forms of S1 and S2 can be represented in the following matrix
form: [
dS1
dS2
]
=
[
µ1
µ2
]
dt +
[
σ1 0
σ2ρ σ2
√
1− ρ2
][
dz1
dz
]
. (5)
For this two-asset case, define A as
A =
[
σ1 0
σ2ρ σ2
√
1− ρ2
]
. (6)
Thus, the inverse matrix A−1 equals
A−1 =
 1/σ1 0−ρ
σ1
√
1− ρ2
1
σ2
√
1−ρ2
 . (7)
We proceed to transform S1 and S2 into two uncorrelated processes X1 and X2.
The differential forms of X1 and X2 can be obtained by multiplying A−1 to both
Journal of Futures Markets DOI: 10.1002/fut
12 Dai, Wang, and Lyuu
FIGURE 3
The branching structures of our bivariate lattice. The branching structure from node A at time
τ to the nine nodes at time τ +"t ′ are marked in thick black lines. The projections of nodes A,
B1, . . . are marked by dashed gray lines. The trinomial branches emitting from node A′ to nodes
B′, C′, and D′ with probabilities Pu, Pm, and Pd approximate the evolution of the process X1.
EX1 and EX2 denote the conditional expected values of processes X1 and X2 at time τ +"t ′,
respectively.
3.2. Core Ideas of Our Multiphase Branch
Construction
The core ideas of our multiphase branch construction are illustrated in Figure 3.
Consider a bivariate lattice that approximates the evolution of two uncorrelated
processes X1(t) and X2(t). The construction contains two phases. Let us focus
on node A with value (X1(τ ), X2(τ )) in Figure 3. The first phase constructs
the trinomial structure from node A′, the projection of node A on the X1-
t plane, to approximate process X1(t). After selecting nodes B′, C′, and D′
as the destinations of the trinomial structure, the branching probabilities Pu,
Pm, and Pd are calculated. The second phase first approximates X2(t); the
trinomial structure from node A to nodes B1, B2, and B3 is constructed, and
the corresponding probabilities Qu, Qm, Qd are calculated. After combining
Journal of Futures Markets DOI: 10.1002/fut
14 Dai, Wang, and Lyuu
We first order the original two processes in Equation (14); ln S(t) is the first
process and ln V (t) the second. The reason for the choice is that the barrier for
the stock price is f (ln(S(t))), whereas the default boundary for the firm’s asset
value is g (ln S(t), ln V (t)) (see Section 3.1).We then apply the orthogonalization
process in Section 3.1 to the processes, to obtain two uncorrelated processes,
X (t) and Y (t). According to matrix Equation (8),
d X (t) = 1
σS
(
r − σ
2
S
2
)
dt + dzS, (15)
dY (t) = 1√
1− ρ2
(
− ρ
σS
(
r − σ
2
S
2
)
+ 1
σV
(
r − σ
2
V
2
))
dt + dz, (16)
where dzS and dz are uncorrelated.
The bivariate lattice is built from two lattices, one for X (t) and another for
Y (t), in the following way. Each node on a bivariate lattice at time step j pairs a
value from the lattice for X (t) with a value from the lattice for Y (t), both at time
step j . Because X (t) and Y (t) are uncorrelated, the branching probabilities can
be obtained by multiplying the branching probabilities of the X (t)-lattice and
those of the Y (t)-lattice.
The construction for the bivariate lattice has two phases. In the first phase,
the X (t)-lattice is built. By Equation (9), the barrier B(t) for the stock price S(t)
can be transformed to the barrier BX (t) on the X (t)-lattice:
BX (t) = 1
σS
(ln B(t)− ln S(0)) . (17)
Figure 4 depicts a 3-time-step X (t)-lattice with the time-varying barrier BX (t).
The lattice starts by placing gray nodes on the barrier to reduce the nonlin-
earity error. All the other nodes are then laid from the gray nodes upward and
downward with the log-distance between any two vertically adjacent nodes be-
ing 2
√
#t. This setting helps us construct trinomial branches from any node at
time step t to the three successor nodes at time step t + 1 via the procedure
in Section 2.2. Start from node X for X (0). Its successor nodes will be selected
from the nodes at time step 1, the successor nodes of these three nodes will be
selected from the nodes at time step 2, and so on. Note that the option knocks
out once X (t) reaches the gray nodes on the barrier. The gray nodes, therefore,
have no need for successor nodes.
We now proceed to the second phase, which builds the Y (t)-lattice at first.
Recall that the default boundary for the firm’s asset value V (t) is assumed to
Journal of Futures Markets DOI: 10.1002/fut
16 Dai, Wang, and Lyuu
FIGURE 5
Construction for the Y (t)-lattice. The curve denotes the time-varying barrier BX (t) on the X -t
plane. The log-distances between any two vertically adjacent nodes on the X -t and Y -t planes
are both 2
√
!t. The option knocks out when X (t) reaches the gray nodes. The firm defaults
when Y (t) reaches the black nodes.
Once we have D∗Y (t), the lattice again starts by placing nodes on this default
boundary (the black nodes in Figure 5). Note that each node with the value
x on the X (t)-lattice corresponds a unique stock price S(0)eσSx by Equation
(11). Because D∗Y (t) depends on the stock price as in Equation (19), each node
on the X (t)-lattice will map to a value of D∗Y (t) given the value of this node.
For example, in Figure 5, node a on the X (t)-lattice corresponds to node A on
the default boundary; similarly, node b corresponds to node B on the default
boundary. The branch construction procedure for the Y (t)-lattice is identical
to that for the X (t)-lattice.
In the end of the second phase, the Y (t)-lattice is added on top of the X (t)-
lattice to form the bivariate lattice. Recall that each node in the bivariate lattice
corresponds to a bivariate state with a value from the X (t)-lattice and a value
from the Y (t)-lattice. As the trinomial X (t)-lattice and the trinomial Y (t)-lattice
are combined to build our bivariate lattice, there are 3× 3 = 9 branches per
node as illustrated in Figure 6. Node X at time step t has nine branches, to
nodes A, B, C, D, E, F , G, H, and I at time step t + 1. It is straightforward to
show that the size of the bivariate lattice is O(n3).
Journal of Futures Markets DOI: 10.1002/fut
18 Dai, Wang, and Lyuu
FIGURE 7
A 2-time-step X (t)-lattice. The dashed curve denotes the time-varying barrier BX (t). The
log-distance between any two vertically adjacent nodes is 2
√
!t = 2.45. The option knocks out
when X (t) reaches the gray nodes.
two vertically adjacent nodes being 2
√
!t = 2.45. The branching probabilities
for nodes A and B can be calculated by the procedure in Section 2.2.
We now start to build the Y (t)-lattice. We first recover the value of S(t) at
each node on the X (t)-lattice by Equation (11). Then the term c(S(t), t) in the
default boundary for the firm’s asset value, D∗(t) = De−r (T−t) + c(S(t), t), can
be obtained by Equation (18); we therefore have D∗(t) for each node on the
X (t)-lattice. For example, with S(1.5) = 56.275 (i.e., the stock price of node
B), we have
D∗(1.5) = 90× e−0.05×1.5 + 28.019 ≈ 111.516. (20)
Note that c(S(t), t) = 0 when the option knocks out (i.e., the gray nodes in
Figure 7). By Equation (19), the default boundary D∗(t) for the firm’s asset value
Journal of Futures Markets DOI: 10.1002/fut
20 Dai, Wang, and Lyuu
FIGURE 8
A 2-time-step bivariate lattice. The curve denotes the time-varying barrier BX (t) on the X -t
plane. The log-distances between any two vertically adjacent nodes on the X -t and Y -t planes
are both 2
√
!t. The option knocks out when X (t) reaches the light-gray nodes. The firm
defaults when Y (t) reaches the dark-gray nodes.
Journal of Futures Markets DOI: 10.1002/fut
22 Dai, Wang, and Lyuu
asset is interpreted as the firm’s asset value, this lattice can be used to evaluate
interest-sensitive securities on the firm, such as defaultable corporate bonds.
When the underlying asset is interpreted as the insurer’s account, this lattice
can be used to evaluate variable annuity, such as GMWB. In Section 4.2, we
analyze the numerical results for the defaultable corporate bonds and GMWB.
The following numerical results confirm that our lattice can generate accurate
and smoothly convergent prices that are unavailable to alternative analytical
formulas and numerical methods.
4.1. Vulnerable Options
Many financial institutions trade derivatives through the over-the-counter
(OTC) markets with other financial institutions or their corporate clients. Be-
cause there are no margin and daily settlement mechanisms in the OTC mar-
kets, the holders of these financial derivatives are vulnerable to counterparty
credit risk (see Johnson & Stulz, 1987). These derivatives are sometimes called
vulnerable derivatives (see Ammann, 2001). The solvency of the counterparty
must be considered to evaluate them. The structural model pioneered by Mer-
ton (1974) is adopted here to model the financial status of the counterparty.
In this subsection, the counterparty is assumed to be a firm, the underlying
asset is assumed to be stock, and the derivative is assumed to be option for
convenience. To evaluate a vulnerable option, our bivariate lattice models the
dynamics of the firm’s asset value and the stock price. It has the capability to
fit the settings of different structural models to suppress the numerical errors.
In Table I, we tabulate the values of the vulnerable vanilla options under
different structural models. To make analytical formulas possible, Klein (1996)
and Klein and Inglis (2001) make some simplifying assumptions. Both papers
follow Merton (1974) by assuming that the firm can only default at the option’s
maturity date, and it defaults when it cannot meet the debt obligation then.
The debt obligation in Klein (1996) is approximately set as the value of all other
outstanding debts of the firm, D, by assuming that the obligation of the option
is much smaller than D. The option holder receives c(S(T), T)/D of the firm’s
asset value when the firm defaults. On the other hand, Klein and Inglis (2001)
include the potential liability of the written option into the debt obligation so
the total obligation at maturity becomes D+ c(S(T), T). In this case, the option
holder receives c(S(T),T)D+c(S(T),T) of the firm’s asset value when the firm defaults. The
prices generated by their formulas appear in the second and forth columns of
the table. The two columns marked by Lattice next to the aforementioned two
Formula columns denote the prices generated by our lattice. The accuracy of
our lattice is verified by observing that the prices generated by our lattice are
close to those generated by the analytical formulas. Note that a higher debt
Journal of Futures Markets DOI: 10.1002/fut
24 Dai, Wang, and Lyuu
FIGURE 9
Convergence of the vulnerable barrier call option under the FPM model. The x and the y axes
denote the number of time steps and the option value, respectively. A barrier call option is
assumed to be issued by a firm at time 0 and the call matures at T = 3 (years). The amount of
all other outstanding debts of the firm is D = 90. The initial stock price is S(0) = 40, the strike
price is K = 40, the initial firm’s asset value is V (0) = 100, the volatility of the stock price is
σS = 0.2, the volatility of the firm’s asset value is σV = 0.2, the correlation between the stock
price and firm’s asset value is ρ = 0, the risk-free interest rate is r = 0.05, and the recovery rate
is α = 0.75. The barrier is 35. The default boundary for the firm’s asset value at time t is
D∗(t) = De−r (T−t) + c(S(t), t).
term c(S(t), t), which is governed by the stock price process. Again, a higher
default boundary implies a higher likelihood for the option holders to suffer
from the loss of firm’s default. Thus under the FPM, the option prices under
the generalized Klein and Inglis (2001) setting (with a higher default boundary
De−r (T−t) + c(S(t), t)) should also be lower than those under the Klein (1996)
setting (with a lower default boundary De−r (T−t)), as expected.
Our lattice can be extended to price barrier options with counterparty risk.
To suppress the nonlinearity error, our lattice matches both the default bound-
ary in the firm’s asset value and the barrier in the stock price. The robustness
and the fast convergence of our lattice is confirmed by the solid line in Figure 9
for pricing a vulnerable barrier call option under the FPM. To our knowledge,
no analytical formulas are available to handle this problem in which each di-
mension has one boundary (the default boundary and the barrier); even both
boundaries are all simple constants. A naive numerical method that does not
Journal of Futures Markets DOI: 10.1002/fut
26 Dai, Wang, and Lyuu
FIGURE 10
Vanilla option values with various stock price volatilities. A call option is assumed to be issued
by a firm at time 0 and the call matures at T = 3 (years). The amount of all other outstanding
debts of the firm is D = 90. The initial stock price is S(0) = 40, the strike price is K = 40, the
initial firm’s asset value is V (0) = 100, the volatility of the stock price is σS = 0.2, the volatility
of the firm’s asset value is σV = 0.2, the correlation between the stock price and firm’s asset
value is ρ = 0, the risk-free interest rate is r = 0.05, the recovery rate is α = 0.75, and the
number of the time steps is n = 500. In Klein (1996), the default boundary for the firm’s asset
value at time t is D∗(t) = De−r (T−t), whereas in Klein and Inglis (2001), the default boundary for
the firm’s asset value at time t is D∗(t) = De−r (T−t) + c(S(t), t), where c(S(t), t) denotes the
value of the call option at time t. In Merton’s model, the default can only occur at maturity,
whereas the default can occur prior to maturity in the FPM.
The relationships between option values and structural models are dis-
cussed as follows. Because the default boundary under Klein (1996) is lower
than that under Klein and Inglis (2001), the firm incurs less bankruptcy cost
under the former setting than the latter one. Therefore, the option values under
Klein (1996) (the dotted and dashed lines in Figure 10) are greater than those
under Klein and Inglis (2001) (the solid and dot-dashed lines). Compared to
Merton’s model, the FPM allows the firm to default prior to maturity and has
a higher default probability. Thus more bankruptcy cost is introduced under
the FPM, which harms the value of the vulnerable option. However, the FPM
provides protections to option holders by letting the firm default when its asset
value goes below the default boundary. This protection raises the option value.
If the effect of incurring more bankruptcy cost under the FPM dominates that
Journal of Futures Markets DOI: 10.1002/fut
28 Dai, Wang, and Lyuu
TABLE IV
Pricing Coupon Bonds Under Different Payment Frequencies, Asset Sales
Assumptions, and Default Boundaries
Total-Asset-Sales No-Asset-Sales
Payment Frequency (Per Year) ξ = 0.9 ξ = 0 ξ = 0.9 ξ = 0 Default-Free Bonds
Continuously 3,017.6 3,014.6 3,021.4 3,019.9 3,034.8
4 3,016.5 3,013.4 3,019.7 3,017.7 3,034.1
2 3,015.3 3,012.2 3,017.7 3,015.3 3,033.4
1 3,012.8 3,009.5 3,012.8 3,009.5 3,031.8
Note. The initial firm’s asset value is V (0) = 5,000, the volatility of the firm’s asset is σV = 30%, the face value of the
outstanding bond is F = 3,000, the annualized coupon rate is c = 5%, the maturity is T = 1, the correlation between the
firm’s asset value and the interest rate is ρ = −0.25, the recovery rate is α = 1, and the tax rate is τ = 0. The parameters
for the interest rate model are a = 50% and σr = 1%. The default boundary at time t is set as ξ of the sum of the present
values of the unpaid coupons and the face value at maturity of the defaultable bond. The annualized yields of zero-coupon
bonds for years 0.5 and 1 are 0.0343 and 0.0382, respectively, and those for any other time t ∈ [0, 1] is calculated by
linear interpolation. The bond prices are evaluated numerically by our lattice with 180 time steps.
under the total-asset-sales assumption makes analytical formulas impossible
and lattices nonrecombining. But our proposed methodology proves otherwise.
The defaultable bond prices under these two assumptions are listed under the
“total-asset-sales” and “no-asset-sales” columns in Table IV. Under the total-
asset-sales assumption, the firm’s asset value jumps downward by the amount
of the coupon at the payment date. These downward jumps weaken the firm’s
financial status and increase its default risk. That explains why the bond values
under the total-asset-sales assumption are lower than those of an otherwise
identical bond under the no-asset-sales assumption. The only exception when
the bonds values are equal is the annual coupon payment setting. This is because
the only coupon is paid at maturity T=1 (year), which, coinciding with the
return of the face value, can be treated as part of the face value.
The FPM assumes the firm is allowed to default prior to maturity and the
firm defaults when its asset value goes below an exogenous default boundary.
We follow Leland (1994) by calling a bond with an exogenous default bound-
ary a protected bond, and a bond without an exogenous default boundary an
unprotected one. In numerical experiments, we adopt Briys and De Varenne
(1997) in setting the boundary at ξ = 90% of the present value of bonds’ un-
paid coupons and the face values at maturity. Note that this stochastic default
boundary depends on the term structure of interest rates, and the naive lattice
will find it hard to address the price oscillation problem. In contrast, our lattice
can address this problem by the technique in Section 3.3. As shown in Table IV,
the above-mentioned default boundary does affect the prices of the bonds.
Although the early redemption features (such as callable or putable rights)
are hard to evaluate analytically, our bivariate lattice can easily cope with it, as
Journal of Futures Markets DOI: 10.1002/fut
30 Dai, Wang, and Lyuu
the GMWBs under different maturities and correlations between the account
value and the interest rate. Observe that the charges decrease with maturities
but increase with correlations.
5. CONCLUSIONS
This study proposes a flexible multiphase method to build a multivariate lattice
for pricing derivatives accurately. To simultaneously handle the correlations
and make the lattice match the critical locations, the market variables are first
properly ordered. Then our multivariate lattice describes the evolution of the
uncorrelated processes transformed from the original, correlated processes of
market variables by orthogonalization. Numerical results for vulnerable options,
insurance contracts GMWB, and defaultable bonds show that our multiphase
method can be applied to the pricing of various complex financial contracts
accurately.
BIBLIOGRAPHY
Aitsahlia, F., Imhof, L., & Lai, T.-L. (2004). Pricing and hedging of American knock-in
options. Journal of Derivatives, 11(3), 44–51.
Ammann, M. (2001). Credit risk valuation: Methods, models, and applications. Berlin:
Springer-Verlag.
Andricopoulos, A., Widdicks, M., Duck, P., & Newton, D. (2003). Universal option
valuation using quadrature methods. Journal of Financial Economics, 67(3), 447–
471.
Andricopoulos, A.,Widdicks,M., Newton, D., &Duck, P. (2007). Extending quadrature
methods to value multi-asset and complex path dependent options. Journal of
Financial Economics, 83(2), 471–499.
Bank for International Settlements. (2010). Semiannual OTC derivatives statistics at
end-June 2010. Basel. http://www.bis.org/statistics/derstats.htm
Black, F., &Cox, J. (1976). Valuing corporate securities: Some effects of bond indenture
provisions. Journal of Finance, 31(2), 351–367.
Black, F., Derman, E., & Toy, W. (1990). A one-factor model of interest rates and its
application to treasury bond options. Financial Analysts Journal, 46(1), 33–39.
Black, F., & Scholes, M. (1973). The pricing of options and corporate liabilities. Journal
of Political Economy, 81(3), 637–654.
Brennan, M., & Schwartz, E. (1978). Corporate income tax, valuation, and the problem
of optimal capital structure. Journal of Business, 51(1), 103–114.
Briys, E., & De Varenne, F. (1997). Valuing risky fixed rate debt: An extension. Journal
of Finance and Quantitative Analysis, 32(2), 239–248.
Broadie, M., & Detemple, J. (1996). American options valuation: New bounds, approxi-
mations, and a comparison of existing methods. Review of Financial Studies, 9(4),
1211–1250.
Journal of Futures Markets DOI: 10.1002/fut
32 Dai, Wang, and Lyuu
Tian, Y. (1999). A flexible binomial option pricing model. Journal of Futures Markets,
19(7), 817–843.
Widdicks, M., Andricopoulos, A., Newton, D., & Duck, P. (2002). On the enhanced
convergence of standard lattice methods for option pricing. Journal of Futures
Markets, 22(4), 315–338.
Wu, H.-C. (2009). Pricing guaranteed minimum withdrawal benefits by tree. Master’s
thesis, Department of Finance, Natoinal Taiwan University, Taipei, Taiwan.
Zvan, R., Forsyth, P., & Vetzal, K. (2003). Negative coefficients in two-factor option
pricing models. Journal of Computational Finance, 7(1), 37–74.
Journal of Futures Markets DOI: 10.1002/fut
over a period of time. Let St be the price of a stock
at time t. Holding the stock for one period from
time t − 1 to time t would result in a simple net
return: Rt = St/St−1− 1 (Tsay, 2005). Therefore,
the volatility of returns for a stock from time t− n
to t can be defined as follows:
v[t−n,t] =
￿￿t
i=t−n (Ri − R¯)2
n
, (1)
where R¯ =
￿t
i=t−nRi/(n+ 1).
2.2 Financial Sentiment Lexicon
For most sentiment analysis algorithms, a senti-
ment lexicon is the most crucial resource. As men-
tioned in (Loughran and McDonald, 2011), a gen-
eral purpose sentiment lexicon might misclassify
common words in financial texts. As shown in their
paper, almost three-fourths of the words in the 10-
K financial reports from year 1994 to 2008, which
are identified as negative by the widely used Har-
vard Psychosociological Dictionary, are typically
not considered negative in financial contexts.
In this paper, we use a finance-specific lexi-
con that consists of the 6 word lists provided
by (Loughran and McDonald, 2011) to analyze
the relations between these sentiment words and
financial risk. The six lists are shown as follows:1
1. Fin-Neg: negative business terminologies
(e.g., deficit, default).
2. Fin-Pos: positive business terminologies (e.g.,
achieve, profit).
3. Fin-Unc: words denoting uncertainty, with em-
phasis on the general notion of imprecision
rather than exclusively focusing on risk (e.g.,
appear, doubt).
4. Fin-Lit: words reflecting a propensity for legal
contest or, per our label, litigiousness (e.g.,
amend, forbear).
5. MW-Strong (Strong Modal Words): words ex-
pressing strong levels of confidence (e.g., al-
ways, must).
6. MW-Weak (Weak Modal Words): words ex-
pressing weak levels of confidence (e.g.,
could, might).
1All these lists are available at http://www.nd.edu/
mcdonald/Word_Lists.html.
2.3 Problem Formulation
2.3.1 Regression Task
Given a collection of financial reports D =
{d1,d2, . . . ,dn}, in which each di ∈ Rp and is
associated with a company ci, we seek to predict
the company’s future risk, which is characterized
by its volatility vi. Such a prediction can be defined
by a parameterized function f as follows:
vˆi = f(di;w). (2)
The goal is to learn a p-dimensional vectorw from
the training data T = {(di, vi)|di ∈ Rp, vi ∈ R}.
Support Vector Regression (SVR) (Drucker et
al., 1997) is a popular technique for training such
a regression model. SVR is trained by solving the
following optimization problem:
min
w
V (w) =
1
2
￿w,w￿
+
C
n
n￿
i=1
max (|vi − f(di;w)|− ￿, 0) ,
where C is a regularization constant and ￿ controls
the training error. More details about SVR can be
found in (Scho¨lkopf and Smola, 2001).
2.3.2 Ranking Task
For the ranking task, our goal is to rank companies
by using their financial reports according to the
volatilities of stock returns. Following the work
in (Tsai andWang, 2013), we split the volatilities of
company stock returns within a year into different
risk levels, which can be considered as the relative
difference of risk among the companies.
After classifying the volatilities of stock returns
(of companies) into different risk levels, the ranking
task can be defined as follows: Given a collection
of financial reports D, we aim to rank the compa-
nies via a ranking model f : Rp → R such that the
rank order of the set of companies is specified by
the real value that the model f takes. In specific,
f(di) > f(dj) is taken to mean that the model
asserts that ci ￿ cj , where ci ￿ cj means that ci
is ranked higher than cj ; that is, the company ci is
more risky than cj . In this paper, we adopt Ranking
SVM (Joachims, 2006) for the ranking task.
3 Experiments
This section first describes the details of our exper-
imental settings. Then, we report the experimental
results of the models trained on the finance-specific
Task (Features) 2001 2002 2003 2004 2005 2006 Mirco-avg
Regression Mean Squared Error
(LOG1P+) ORG 0.18082 0.17175 0.17157 0.12879 0.13038 0.14287 0.15271
SEN 0.18506 0.16367 0.15795 0.12822 0.13029 0.13998 0.14894
Kendall’s Tau
Ranking
ORG 0.62173 0.63626 0.58528 0.59350 0.59651 0.57641 0.59965
SEN 0.63349 0.62280 0.60527 0.59017 0.60273 0.58287 0.60458
(TFIDF+) Spearman’s Rho
ORG 0.65271 0.66692 0.61662 0.62317 0.62531 0.60371 0.62939
SEN 0.66397 0.65303 0.63646 0.61953 0.63133 0.60999 0.63403
Table 3: Experimental Results of Using Original Texts and Only Sentiment Words.
{y1, y2, . . . , yn},
Rho = 1− 6
￿
(xi − yi)2
n(n2 − 1) ,
Tau =
#concordant pairs−#discordant pairs
0.5 · n · (n− 1) .
For the measure of Kendall’s Tau, any pair of ob-
servations (xi, yi) and (xj , yj) is concordant if
the ranks for both elements agree; that is, if both
xi ￿ xj and yi ￿ yj or if both xj ￿ xi and yj ￿ yi.
In contrast, it is discordant if xi ￿ xj and yj ￿ yi
or if xj ￿ xi and yi ￿ yj . If xi = xj or yi = yj ,
the pair is neither concordant nor discordant.
3.1.4 Parameter Settings
For the regression task, linear kernel is adopted
with ￿ = 0.1 and the trade-offC is set to the default
value of SVMlight,2 which are the similar settings
to those in (Kogan et al., 2009). For ranking, linear
kernel is adopted with C = 1, all the other parame-
ters are set as the default values of SVMRank.3
3.2 Experimental Results
Table 3 tabulates the experimental results, in which
the training data is composed of the financial re-
ports in a five-year period, the following year of
which is the test data. For example, the reports
from year 1996 to 2000 constitute a training data,
and the learned model is tested on the reports of
year 2001.
We compare the performance of the models
trained on the original texts (denoted as ORG here-
after) with those on only sentiment words (denoted
2http://svmlight.joachims.org/
3http://www.cs.cornell.edu/people/tj/
svm_light/svm_rank.html
as SEN hereafter). In our experiments, the word
feature LOG1P is chosen for the regression task and
TFIDF for the ranking one, as suggested in (Ko-
gan et al., 2009) and (Tsai and Wang, 2013). Note
that in these two studies, their models are trained
on the original texts and the results are listed in
the row denoted as ORG in Table 3. The bold face
number in the table denotes the best result between
ORG and SEN. As shown in the table, for the two
tasks, the results of using only sentiment words, in
most cases, perform better than those of using the
original texts.
4 Analysis
4.1 Ranking vs. Regression
Figure 1 shows the top 10 learned words from both
the ranking (TFIDF+) and regression (LOGP+)
models trained on sentiment words only (SEN);
in addition, the figure also lists the accumulated
numbers of these words appearing in the 6 corre-
sponding regression or ranking models.
Observe that the words learned from the rank-
ing models are much more consistent than those
from the regression ones. For example, the words
“amend,” “deficit,” “forbear” appear in all of the 6
ranking models; in addition, there are 7 words from
the ranking models get the majority vote with more
than 4 occurrences, whereas only 3 words from the
regression ones occur more than 4 times. On the
other hand, there are 11 words from the ranking
models and 20 words from the regression ones that
occur only one time. The results shown in Fig-
ure 1 correlate with the findings in (Tsai and Wang,
2013), which states that adopting the ranking mod-
els to analyze the relations between financial risk
amend 
deficit
forbear
delist
defaultsureti
discontinu
wherebi
unabl
disput
concern
profit
violat
regain
uncom
-plet
accid
abl
integr
grantor
ceg
nasdaq
gnb
coven
forbear
waiver
sureti
excelsior
rais
ebix
shelbour
nplacement
syndic
pfc
stage
same
driver
default
small-
cap
seri
hearthawg
amend
libert
special
benefici sever
breach
doubt
Fin-Neg
Fin-Pos
Fin-Lit
Fin-Unc
Non
SEN
ORG
1
1
2
3
4
5
2
3
4
5
deficit
deficits
default
defaulted
defaulting
defaults
delist
delisted
deslisting
delists
amend
amendable
amendatory
amended
amending
amendment
amendments
amends
forbear
forbearance
forbearances
forbearing
forbears
Figure 2: Highly-Weighted Terms Learned from the 6 Ranking Models of Using Original Texts (ORG)
and Only Sentiment Words (SEN). The color filled in a circle with a term denotes which the sentiment word lists the
word belongs to; the circle with 2-mixed colors indicates the term belongs to two word lists. The single-outline circle denotes
that only sentiment words from the 6 dictionaries (see Table 2) are used as the training data; the double-outline circle denotes that
the original texts are considered when training. Top 5 terms for the results of each kind of training data are marked by numbers
from 1 to 5; the original words from the sentiment lexicon for each top 5 average weighted sentiment terms are also provided.
have higher risk. One piece of paragraph quoted
from the original report is listed as follows:
(from AXS-One Inc., 2006 Form 10-K)
At December 31, 2005, we had cash and
cash equivalents of $3.6 million and a
working capital deficit of $3.6 million
which included $8.2 million of deferred
revenue. The increase of the working
capital deficit from $3.3 million at De-
cember 31, 2004 is primarily the result
of a decrease in cash and decreased ac-
counts receivable offset partially by a de-
crease in deferred revenue.
5 Conclusions and Future Work
This paper identifies the importance of sentiment
words in financial reports associated with financial
risk. With the usage of a finance-specific sentiment
lexicon, regression and ranking techniques are ap-
plied to analyze the relations between the sentiment
words and financial risk. The experimental results
show that, based on the bag-of-words model, the
models trained on sentiment words only can re-
sult in comparable performance to those on origin
texts, which attests the importance of the financial
sentiment words on risk prediction. In addition,
the learned models also suggest strong correlations
between financial sentiment words in financial re-
ports and the risk of companies. As a result, these
findings provide us more insight and understand-
ing into the impact of financial sentiment words
on companies’ future risk. There are several future
work, such as how to use even further information
(i.e., syntactic information) for analysis, and how
to conduct more fine-grained analysis.
Acknowledgments
This research was partially supported by the Na-
tional Science Council of Taiwan under the grants
NSC 100-2218-E-133-001-MY2, 101-2221-E-004-
017, 102-2221-E-004-006, and 102-2221-E-133-
001-MY3.
 
國科會補助專題研究計畫項下出席國際學術會議心得報告  
                  日期： 2012  年 04 月 28 日 
                                 
一、參加會議經過 
 本次會議為 IEEE 主辦之財務工程與經濟學計算智能會議
（CIFEr），於 2012 年 3 月 29 日至 3月 30 日在美國紐約瑞士瑞信
銀行大樓（Credit Suisse）舉行。 
 
二、與會心得 
 CIFEr會議為金融工程與計算機科學（計算智能）之間交流的
主要會議， 與會者約有 200 多人，其中包括各個國家之應用數學、
財務金融工程、電腦科學等研究人員，更有許多投資銀行分析師等
金融專業人士參與。本人所發表之論文 “A Multi-Phase, Flexible, and 
Accurate Lattice for Pricing Complex Derivatives with Multiple Market 
Variables” 在大會中以口頭報告發表，在會議過程中，來自各國研
究人員與在金融界服務的專業人士皆對本人的研究很有興趣，亦有
計畫編
號 
NSC 100-2218-E-133-001-MY2 
計畫名
稱 
多變量樹狀模型之建構分析及其應用（第 1 年） 
出國人
員姓名 王釧茹 
服務機
構及職
稱 
台北市立教育大學 
助理教授 
會議時
間 
2012年 3月 
29日至 
2012年 3月 
30日 
會議地
點 
美國，紐約 
會議名
稱 
(中文)IEEE 財務工程與經濟學計算智能會議 
(英文)IEEE Computational Intelligence for Financial 
Engineering and Economics 2012 
發表論
文題目 
(中文)多階段建構且具彈性並能精準評價複雜衍生性金融
商品之多變量樹狀模型 
(英文)A Multi-Phase, Flexible, and Accurate Lattice for 
Pricing Complex Derivatives with Multiple Market Variables 
• 此篇論文由中研院何建明教授之博士班學生報告，
報告十分精采，主要介紹 mortgage 的評價問題，
描述所提出模型如何處理提前償還等問題。報告者
對於 mortgage pricing 文獻介紹十分詳細，讓原本
對於此領域不太了解的我，得到許多。回國之後研
讀了幾篇這個領域的重要文獻，獲益良多。 
 
四、建議 
 本國財務工程領域在此重要會議中僅有三篇論文，參與之研究
人員亦均為資訊科學領域，相較其他國家，財務領域研究人員參與
此類財務工程會議略顯不足。 
 
五、攜回資料名稱及內容 
1) 大會議程手冊  
 
六、其他 
 在會議期間也遇到了一些學者，對建立合作研究很有興趣，回
來後也加強部份的聯繫，也許有開花結果的時候。同時，也非常感
謝國科會給予支持出席此會議。 
 
 
 
 
A Multi-Phase, Flexible, and Accurate Lattice for Pricing Complex
Derivatives with Multiple Market Variables
Chuan-Ju Wang Tian-Shyr Dai Yuh-Dauh Lyuu
Abstract—With the rapid growth of financial markets, many
complex derivatives have been structured to meet specific
financial goals. But most complex derivatives have no analytical
formulas for their prices, e.g., when more than one market vari-
able is factored. As a result, they must be priced by numerical
methods such as lattice. A derivative is called multivariate if
its value depends on more than one market variable. A lattice
for a multivariate derivative is called a multivariate lattice.
This paper proposes a flexible multi-phase method to build a
multivariate lattice for pricing derivatives accurately. First, the
original, correlated processes are transformed into uncorrelated
ones by the orthogonalization method. A multivariate lattice is
then constructed for the transformed, uncorrelated processes.
To sharply reduce the nonlinearity error of many numerical
pricing methods, our lattice has the flexibility to match the so-
called “critical locations” — the locations where nonlinearity
of the derivative’s value function occurs. Numerical results for
vulnerable options, insurance contracts guaranteed minimum
withdrawal benefit, and defaultable bonds show that our
methodology can be applied to the pricing of a wide range
of complex financial contracts.
I. INTRODUCTION
The financial markets have become vast, tightly integrated,
and complex, particularly in the derivatives sector [1]. As
a result, derivatives pricing has become much more com-
plicated. One reason is that more sophisticated derivatives
are constantly being structured to fit the needs of markets.
Addressing their sophisticated features significantly increases
the difficulty of pricing them [2]. Another reason is that the
importance of some factors, like sovereign risk or credit risk,
which are overlooked in earlier, primitive derivatives pricing
models, is being recognized as key due to recent financial
crises. If the default risk of the option issuer (or the counter-
party risk) is ignored, analytical pricing formulas for vanilla
options and barrier options have been derived by [3] and
[4], respectively. However, when the structural model (e.g.,
Merton’s model [5] and Black-Cox model [6]) is introduced
to model the counterparty risk, analytical formulas for the
vulnerable vanilla options are only available under restricted
assumptions [7], [8]. In addition, no analytical formulas seem
to exist for vulnerable barrier options under the Black-Cox
first-passage model [6].
Chuan-Ju Wang is with Department of Computer Science, Taipei Munic-
ipal University of Education, Taipei, Taiwan. Corresponding author. E-mail:
jerewang@gmail.com
Tian-Shyr Dai is with Department of Information and Finance Man-
agement, Institute of Information Management and Institute of Finance,
National Chiao-Tung University, Hsinchu, Taiwan.
Yuh-Dauh Lyuu is with Department of Finance and Department of
Computer Science & Information Engineering, National Taiwan University,
Taipei, Taiwan.
The lattice method and the closely related finite-difference
method are popular and flexible numerical methods for
pricing derivatives, particularly when analytical solutions
do not exist or when analytical solutions involve multiple
integrations. These methods can be easily modified to price
derivatives with American and other exotic features. They
divide the time dimension and the market factors/variables
into discrete points. The results converge to the desired value
under the continuous-time model as the number of discrete
steps goes to infinity [9].
One of the most difficult issues facing lattice and finite-
difference methods is the nonlinearity error [2]. This error
reveals itself as oscillating prices, resulting from the nonlin-
earity of the derivative’s value function — like the kink of the
option payoff function. In 1999, Figlewski and Gao address
this problem with the adaptive mesh model (AMM). The
problem with the AMM is that its structure is complicated
and hard to implement. Furthermore, it is difficult to tailor
the AMM to many derivatives. Alternatively, the nonlinearity
error can be reduced by restructuring the lattice to make
a lattice’s nodes, price levels, or time steps match the so-
called “critical locations” — locations where nonlinearity of
the derivative’s value function occurs. Indeed, this idea is
adopted in [10], [11], [12], [13], [14], [15]. However, these
methods are not flexible enough for complex derivatives;
besides, only one market variable is considered.
Multivariate derivatives elevate the pricing difficulty to
a new level compared with that of univariate derivatives.
First, the correlations between the market variables must be
carefully handled; otherwise, invalid branching probabilities
may result [16]. Furthermore, any valid constant-degree
lattice for bivariate derivatives must grow superpolynomially
in size when the second market variable is the interest rate
that allows its value to grow superpolynomially in magnitude
[17], such as the popular model of [18].
One approach is to construct a multivariate lattice that
matches the means, variances, and covariances of the
market variables. For example, Rubinstein builds a three-
dimensional lattice for two correlated assets by a non-
rectangular arrangement of the lattice nodes [19]. However,
his lattice is not flexible enough to suppress the nonlinearity
error. Another approach is to build a lattice by assuming
that the processes of market variables are independent first,
and then to adjust the branching probabilities to reflect
the correlations [20]. However, the branching probabilities
can become negative after the adjustments. Hull and White
suggest that the correlated processes can be first transformed
uP
dP
0S
0S u
0S d
2
0S u
0S
2
0S d
0S u
0S d
3
0S u
3
0S d
t∆
tσ ∆
Fig. 1. The CRR Lattice.
For convenience, define the log-distance between stock prices
S and S￿ as | ln(S)− ln(S￿)|. Thus the log-distance between
any two adjacent price levels in the CRR lattice (the height
of a cell in Fig. 1) is σ
√
∆t.
B. Hull-White Interest Rate Model and Its Lattice
The Hull-White interest rate model [25] is a short rate
model that is able to match the market’s term structure of
interest rates. The short rate at time t, r(t), follows the
stochastic process
dr(t) = (θ(t)− ar(t))dt+ σrdzr, (3)
where θ(t) is a function of time that makes the model
fit the real-world interest rate market, a denotes the mean
reversion rate for the short rate r(t) to revert to θ(t)/a, σr
denotes the instantaneous volatility of the short rate, and dzr
is the standard Brownian motion. A two-stage lattice-building
procedure for the Hull-White model is provided by [20].
C. Price Oscillation Problem and Nonlinearity Error
Although the prices generated by the lattice converge to
the theoretical value of a contingent claim as n → ∞ [9],
they may oscillate significantly. This phenomenon is due to
the error introduced by the nonlinearity of the value function
of the contingent claim [2]. This nonlinearity error can be
much reduced by making a node or a price level of the lattice
match the critical locations where the value function of the
contingent claim is highly nonlinear [24]. Critical locations
are straightforward to identify. For example, for continuous
barrier options, the critical price level occurs along the barrier
price. For pricing vulnerable options and defaultable bonds
under the structural model, critical locations run along the
exogenous default boundary. The hard problem is, in general,
the positions of critical locations can be irregular due to the
contracts, and it is hard for a lattice to match these critical
locations by a traditional construction methodology.
III. TWO KEY IDEAS FOR THE LATTICE CONSTRUCTION
A. Transforming Correlated Processes into Uncorrelated
Ones via Orthogonalization
The orthogonalization is a method that converts a
nonorthogonal set of functions to an orthogonal basis. With
this method, we can transform a set of correlated processes
into a set of uncorrelated ones. For the sake of brevity, we
demonstrate this transformation for a set of two correlated
processes. The transformation for more than two correlated
processes shares the same methodology.
Let two correlated processes of market variables Sa and
Sb be represented as follows:
dSa = µadt+ σadza,
dSb = µbdt+ σbdzb.
Above, for x ∈ {a, b}, µx denotes the drift of Sx, σx denotes
the volatility of Sx, and dzx denotes the standard Brownian
motion. The correlation between dza and dzb is ρ. It is well-
known that dzb can be decomposed into a linear combination
of dza and another independent Brownian motion dz thus:
dzb = ρ dza +
￿
1− ρ2 dz. (4)
The differential forms of Sa and Sb can be represented in
the following matrix form,￿
dSa
dSb
￿
=
￿
µa
µb
￿
dt+
￿
σa 0
σbρ σb
￿
1− ρ2
￿ ￿
dza
dz
￿
.
(5)
For this two-asset case, define A as
A =
￿
σa 0
σbρ σb
￿
1− ρ2
￿
. (6)
Thus the inverse matrix A−1 equals
A−1 =
￿
1/σa 0
−ρ
σa
√
1−ρ2
1
σb
√
1−ρ2
￿
. (7)
We proceed to transform Sa and Sb into two uncorrelated
processes X1 and X2. The differential forms of X1 and X2
can be obtained by multiplying A−1 to both sides of Eq. (5):￿
dX1
dX2
￿
=
￿
dSa/σa
−ρ dSa
σa
√
1−ρ2 +
dSb
σb
√
1−ρ2
￿
=
￿
µa/σa
−ρµa
σa
√
1−ρ2 +
µb
σb
√
1−ρ2
￿
dt+
￿
1 0
0 1
￿ ￿
dza
dz
￿
.
(8)
Integrate both sides of Eq. (8) to yield
X1(t) =
Sa(t)− Sa(0)
σa
, (9)
X2(t) =
1￿
1− ρ2
￿
Sb(t)− Sb(0)
σb
− ρ Sa(t)− Sa(0)
σa
￿
=
1￿
1− ρ2
￿
Sb(t)− Sb(0)
σb
− ρX1(t)
￿
, (10)
a− 4√∆t
a− 2σ√∆t
X2
X1
t
τ +∆t￿
τ
b
X2(τ)
EX2
b+ 2
√
∆t
b+ 4
√
∆t
a
a+ 4
√
∆t
a+ 2
√
∆t
EX1X1(τ)
A￿
B￿ D￿
B1
B2
B3
Pu Pm Pd
PuQu
PuQm
PuQd
A
C ￿
Fig. 3. The Branching Structures of Our Bivariate Lattice. EX1 and
EX2 denote the conditional expected values of processes X1 and X2 at
time τ +∆t￿, respectively.
B. A Bivariate Lattice: Two Correlated Market Variables
This subsection focuses on the bivariate lattice for two
market variables: the stock price, S(t), and the firm’s asset
value, V (t). The bivariate lattice is built to price vulnerable
barrier options with the strike price K and the barrier
B(t) = Be−γ(T−t). The default boundary for the firm’s
asset value at time t, D∗(t), is assumed to be the sum of
the non-vulnerable option value at time t, c(S(t), t), and
the discounted value of the firm’s outstanding debt; that is,
D∗(S(t), t) = De−r(T−t)+ c(S(t), t), where D denotes the
firm’s outstanding debt [8]. In this setup, the option holder
receives
c(S(t), t)/D∗(S(t), t) (13)
of the firm’s asset value when the firm defaults. The two
market variables, S(t) and V (t), are both assumed to follow
the processes in Eq. (1). By Ito’s lemma,
d lnS(t) =
￿
r − σ
2
S
2
￿
dt+ σSdzS ,
d lnV (t) =
￿
r − σ
2
V
2
￿
dt+ σV dzV , (14)
where r is the risk-free rate, σS and σV are the volatilities
of S(t) and V (t), respectively, and dzS and dzV are two
correlated standard Brownian motions with correlation ρ.
We first apply the orthogonalization process in Subsection
III-A to the original two processes, S(t) and V (t), to obtain
two uncorrelated processes, X(t) and Y (t). According to
X
2
√
∆t
2
√
∆t
2
√
∆t
∆t ∆t ∆t
BX(t)
Fig. 4. The X(t)-Lattice with the Time-Varying Barrier BX(t).
matrix equation (8),
dX(t) =
1
σS
￿
r − σ
2
S
2
￿
dt+ dzS , (15)
dY (t) =
1￿
1− ρ2
￿
− ρ
σS
￿
r − σ
2
S
2
￿
(16)
+
1
σV
￿
r − σ
2
V
2
￿￿
dt+ dz, (17)
where dzS and dz are uncorrelated.
The bivariate lattice is built from two lattices, one for X(t)
and another for Y (t), in the following way. Each node on a
bivariate lattice at time step j pairs a value from the lattice
for X(t) with a value from the lattice for Y (t), both at time
step j. Since X(t) and Y (t) are uncorrelated, the branching
probabilities can be obtained by multiplying the branching
probabilities of the X(t)-lattice and those of the Y (t)-lattice.
The construction for the X(t)-lattice is described first. By
Eq. (9), the barrier B(t) for the stock price S(t) can be
transformed to the barrier BX(t) on the X(t)-lattice:
BX(t) =
1
σS
(lnB(t)− lnS(0)) . (18)
Figure 4 depicts a 3-time-step X(t)-lattice with the time-
varying barrier BX(t). The lattice starts by placing gray
nodes on the barrier to reduce the nonlinearity error. All the
other nodes are then laid from the gray nodes upward and
downward with the log-distance between any two vertically
adjacent nodes being 2
√
∆t. This setting helps us construct
trinomial branches from any node at time step t to the three
successor nodes at time step t + 1 via the procedure in
Subsection III-B. Start from node X for X(0). Its successor
nodes will be selected from the nodes at time step 1, the
successor nodes of these 3 nodes will be selected from the
nodes at time step 2, and so on. Note that the option knocks
out once X(t) reaches the gray nodes on the barrier. The
gray nodes, therefore, have no need for successor nodes.
We now proceed to build the Y (t)-lattice. Recall that the
default boundary for the firm’s asset value V (t) is assumed
V. NUMERICAL EVALUATION
This section shows that our methodology can be applied
to the pricing of a wide range of complex financial contracts,
such as vulnerable options, insurance contracts GMWB, and
defaultable bonds.
A. Vulnerable Options
To evaluate a vulnerable option, our bivariate lattice mod-
els the dynamics of the firm’s asset value and the stock
price. It has the capability to fit the settings of different
structural models to suppress the numerical errors. Take
the pricing of vulnerable barrier options for example. To
suppress the nonlinearity error, our lattice matches both the
default boundary in the firm’s asset value and the barrier
in the stock price. The robustness and the fast convergence
of our lattice is confirmed by the solid line in Fig. 7 for
pricing a vulnerable barrier call option under the Black-
Cox first-passage model (FPM hereafter). To our knowledge,
no analytical formulas are available to handle this problem
in which each dimension has one boundary (the default
boundary and the barrier); even both boundaries are all
simple constants. A naive numerical method that does not
align with the barrier and the default boundary will generate
oscillating prices depicted as the dashed line in Fig. 7.
 4.66
 4.68
 4.7
 4.72
 4.74
 4.76
 4.78
 50  100  150  200  250  300  350  400  450
Op
ti
on
 v
al
ue
#(Time steps)
Barrier not matched
Barrier matched
Fig. 7. Convergence of the Vulnerable Barrier Call Option under the
FPM Model.
B. Evaluating Defaultable Bonds and GMWBs under Short
Rate Models
To price defaultable bonds under short rate models, we
build a bivariate lattice with asset price and interest rate as
market variables. Our lattice describes the dynamics of the
asset value and the interest rate, which is assumed to follow
the Hull-White model [20]. Table I compares defaultable
zero-coupon bond prices by our lattice and those by the
analytical formula proposed by [32]. The robustness of our
lattice is affirmed by the low relative pricing errors.
Both asset-sales assumptions and positive net-worth
covenants affect bond prices. The coupon payments can be
either financed by selling the firm’s asset, which is called
the total-asset-sales assumption [5], [33], or by issuing new
equities, which is called the no-asset-sales assumption [34].
Defaultable Zero Bonds
with an Exogenous Default Boundary
Face value (F ) Lattice Formula Relative errors
2000 1924.8 1924.8 −0.002%
2500 2404.0 2404.4 −0.015%
3000 2874.9 2876.2 −0.045%
TABLE I
PRICING DEFAULTABLE ZERO-COUPON BONDS WITH AN
EXOGENOUS DEFAULT BOUNDARY.
Payment frequency Total-asset-sales No-asset-sales
(per year) ξ = 0.9 ξ = 0 ξ = 0.9 ξ = 0
Continuously 3017.6 3014.6 3021.4 3019.9
4 3016.5 3013.4 3019.7 3017.7
2 3015.3 3012.2 3017.7 3015.3
1 3012.8 3009.5 3012.8 3009.5
TABLE II
PRICING COUPON BONDS UNDER DIFFERENT PAYMENT
FREQUENCIES, ASSET SALES ASSUMPTIONS, AND DEFAULT
BOUNDARIES.
Lando argues that the existence of jumps under the total-
asset-sales assumption makes analytical formulas impossi-
ble and lattices non-recombining [35]. But our proposed
methodology proves otherwise. The defaultable bond prices
under these two assumptions are listed under the “Total-
asset-sales” and “No-asset-sales” columns in Table II. Under
the total-asset-sales assumption, the firm’s asset value jumps
downward by the amount of the coupon at the payment date.
These downward jumps weaken the firm’s financial status
and increase its default risk. That explains why the bond
values under the total-asset-sales assumption are lower than
those of an otherwise identical bond under the no-asset-sales
assumption. The only exception when the bonds values are
equal is the annual coupon payment setting. This is because
the only coupon is paid at maturity T=1 (year), which,
coinciding with the return of the face value, can be treated
as part of the face value.
The FPM assumes the firm is allowed to default prior
to maturity and the firm defaults when its asset value
goes below an exogenous default boundary. We follow [34]
by calling a bond with an exogenous default boundary a
protected bond, and a bond without an exogenous default
boundary an unprotected one. In numerical experiments, we
adopt [32] in setting the boundary at ξ = 90% of the
present value of bonds’ unpaid coupons and the face values at
maturity. Note that this stochastic default boundary depends
on the term structure of interest rates, and the naive lattice
will find it hard to address the price oscillation problem. In
contrast, our lattice can address this problem by the technique
in Subsection IV-B. As shown in Table II, the values of the
protected bonds with the above-mentioned default boundary
are higher than those of the unprotected bonds (i.e., ξ = 0)
with the recovery rate α = 1. In general, however, a different
recovery rate or ξ may change the relative values of protected
and unprotected bonds.
 
國科會補助專題研究計畫項下出席國際學術會議心得報告  
                  日期： 2012  年 11 月 10 日 
                                 
一、參加會議經過 
 本次會議為 INNS主辦之計算機神經網路冬季會議（INNS-
WC），於 2012 年 10 月 2 日至 10月 5 日在泰國曼谷 Centara Grand 
at Central Plaza Ladprao Bangkok 及泰國曼谷/蒙庫國王科技大學
（King Mongkut’s University of Technology Thonburi, Bangkok, 
Thailand）舉行。 
 
二、與會心得 
 INNS為類神經網路之重要學會之一，其冬季會議與 11th 
International Conference on Bioinformatics 合辦， 與會者約有 200 多
人，其中包括各個國家之電腦科學、生物資訊等研究人員 。本人所
發表之論文 “Post-Modern Portfolio Theory for Information Retrieval” 
在大會中以口頭報告發表，在會議過程中，來自各國研究人員皆對
本人的研究很有興趣，亦有很深入的討論，他們也給予一些很有建
計畫編
號 
NSC 100-2218-E-133-001-MY2 
計畫名
稱 
多變量樹狀模型之建構分析及其應用（第 2年） 
出國人
員姓名 王釧茹 
服務機
構及職
稱 
台北市立教育大學 
助理教授 
會議時
間 
2012年 10月 
2日至 
2012年 10月 
5日 
會議地
點 
泰國，曼谷 
會議名
稱 
(中文) INNS 冬季會議 
(英文)The 3rd International Neural Network Society Winter 
Conference 2012 
發表論
文題目 
(中文) 後現代投資組合理論在資訊檢索上的應用 
(英文)Post-Modern Portfolio Theory for Information 
Retrieval 
 *PDLO,116:&QRWLILFDWLRQIRUSDSHU
KWWSVPDLOJRRJOHFRPPDLOX"XL 	LN IEEE	YLHZ SW	VHDUFK LQER[	PVJ HHIEHE
&KXDQ-X:DQJMHUHZDQJ#JPDLOFRP!
,116:&QRWLILFDWLRQIRUSDSHU
,116:&LQQVZF#HDV\FKDLURUJ! 7KX-XODW30
7R&KXDQ-X:DQJMHUHZDQJ#JPDLOFRP!
'HDU&KXDQ-X:DQJ
7KLVLVWRLQIRUP\RXWKDWWKHIROORZLQJSXEOLFDWLRQVXEPLWWHGWRWKH6\PSRVLXPRQ'DWD$QDO\WLFVDQG
&RPSHWLWLRQVKDVEHHQDFFHSWHGIRUSXEOLFDWLRQLQWKHSURFHHGLQJVRI,116:&ZLWKDQRYHUDOOUDWLQJRI
ZHDNDFFHSW
1XPEHU
7LWOH3RVW0RGHUQ3RUWIROLR7KHRU\IRU,QIRUPDWLRQ5HWULHYDO
3OHDVHUHYLVHG\RXUSDSHUDFFRUGLQJWRWKHFRPPHQWVRIWKHUHYLHZHUVDQGVXEPLW\RXUILQDOPDQXVFULSWE\
$XJXVW3OHDVHHQVXUHWKDWWKHIRUPDWWLQJLVSURSHULQFOXGLQJWKHUHIHUHQFHV$OVRDWOHDVWRQHRIWKH
DXWKRUVPXVWUHJLVWHUDQGSD\WKHUHJLVWUDWLRQIHHVE\$XJXVWDVZHOO
%HVWUHJDUGV
-RQDWKDQ&KDQ
2QEHKDOIRIWKH3&&KDLUVRI,116:&
5(9,(:
3$3(5
7,7/(3RVW0RGHUQ3RUWIROLR7KHRU\IRU,QIRUPDWLRQ5HWULHYDO
$87+2560LQJ)HQJ7VDLDQG&KXDQ-X:DQJ
29(5$//5$7,1*DFFHSW
5(9,(:(5
6&21),'(1&(KLJK
1LFHLGHDVDQGUHVXOWVIRURSWLPL]LQJUDQNLQJLQ,5V\VWHP
5(9,(:
3$3(5
7,7/(3RVW0RGHUQ3RUWIROLR7KHRU\IRU,QIRUPDWLRQ5HWULHYDO
$87+2560LQJ)HQJ7VDLDQG&KXDQ-X:DQJ
29(5$//5$7,1*DFFHSW
5(9,(:(5
6&21),'(1&(ORZ
:HOOZULWWHQDQGRUJDQL]HGSDSHU
7KHDEVWUDFWWKHLQWURGXFWLRQDQGWKHIUDPHZRUNDUHZHOOH[SODLQHGZKLFKPDNHVLWHDV\IRUWKHUHDGHUVWR
XQGHUVWDQG
,QWKHUHVXOWV6HFWLRQH[SHULPHQWVKRZZDVWKHLPSURYHPHQWFDOFXODWHG",WKLQNWKLVVKRXOGEHFODULILHGLQWKH
WH[W
7KHRQO\FRQFHUQZRXOGEHKRZVLJQLILFDQWWKHUHVXOWVDUH"&RXOGWKLVQHZIUDPHZRUNUHSODFHWKHRWKHU
WHFKQLTXHVDOUHDG\XVHGRUEHDGGHGWRWKHP"7KLVVKRXOGEHFODULILHGLQWKHFRQFOXVLRQV
0LQRUSRLQW
 Procedia Computer Science  13 ( 2012 )  143 – 148 
1877-0509 © 2012 Published by Elsevier B.V. Selection and/or peer-review under responsibility of Program Committee of INNS-WC 2012
doi: 10.1016/j.procs.2012.09.116 
Proceedings of the International Neural Network Society Winter Conference (INNS-WC 2012)
Post-Modern Portfolio Theory for Information Retrieval
Ming-Feng Tsaia,b, Chuan-Ju Wangc,∗
aDepartment of Computer Science, National Chengchi University, Taipei 116, Taiwan
bProgram in Digital Content & Technologies, National Chengchi University, Taipei 116, Taiwan
cDepartment of Computer Science, Taipei Municipal University of Education, Taipei 100, Taiwan
Abstract
Information Retrieval (IR) aims to discover relevant information according to a user’s information need. The classic Probability
Ranking Principle (PRP) forms the theoretical basis for probabilistic IR models. This ranking principle, however, neglects the
uncertainty introduced through the estimations from retrieval models. Inspired by the Post-Modern Portfolio Theory (PMPT),
this paper proposes a mean-semivariance framework to handle the uncertainty. The proposed framework not only deals with the
uncertainty but has the ability to distinguish bad surprises (downside uncertainty) and good surprises (upside uncertainty) when
optimizing a ranking list. The experimental results shows that the proposed method improves the IR performance over the PRP
baseline in terms of most of IR evaluation metrics; moreover, the results suggest that the mean-semivariance framework can
further boost the top-position ranking quality.
c© 2012 The Authors. Published by Elsevier B.V.
Selection and/or peer-review under responsibility of the Program Committee of INNS-WC 2012.
Keywords: retrieval models, optimization, semivariance
1. Introduction
Information Retrieval (IR) aims to discover relevant information according to a user’s information need. In
general, the process of retrieving information consists of two phases. In the first phase, probabilistic retrieval
models [1] compute the relevance between a given user’s information need (query) and each of the documents in a
collection. The second phase focuses on how to rank the calculated documents; the classic Probability Ranking
Principle (PRP) [2] forms the theoretical basis of this phase, which ranks the documents with the order of decreasing
probabilities of relevance to the query. However, the ranking principle neglects the uncertainty associated with the
relevance of the documents to the query; the uncertainty may result from various sources, such as specific user
preferences and ambiguity within a query. Take the query “jaguar” as an example. This query may refer to the
Jaguar Cars company, the Apple Jaguar operation system, the Fender Jaguar electric guitar, or the felines. For
such a query with some uncertainty, an IR system should provide a ranking list of documents with all possible
interpretations, which may better meet as many information needs as possible.
To deal with the uncertainty, we draw an analogy between the ranking problem in IR and the investing problem
in finance; that is, selecting a set of stocks (portfolio) resembles selecting a set of documents (ranking list). In
∗Corresponding author. Tel.: +886-2-23113040 ext 8936
Email addresses: mftsai@nccu.edu.tw (Ming-Feng Tsai), cjwang@tmue.edu.tw (Chuan-Ju Wang)
Available online at www.sciencedirect.com
  Published by Elsevier B.V. Selection and/or peer-review under responsibility 
of Program Committee of INNS-WC 2012
145 Ming-Feng Tsai and Chuan-Ju Wang /  Procedia Computer Science  13 ( 2012 )  143 – 148 
where Var−(Rn) (Var+(Rn)) denotes the downside (upside, respectively) variance of the overall relevance. Unlike
the variance defined in Eq. (1), which can be calculated exogenously, the semivariance is endogenous. As a result,
we use the approximation proposed by [11] to calculate VarQ(Rn):
VarQ(Rn) ≈
n∑
i=1
n∑
i=1
wiwjcˆi, j,
where
cˆi, j =

E
[
Min (ri − E[ri], 0) × Min(r j − E[r j], 0)
]
, if Q = −,
E
[
Max (ri − E[ri], 0) × Max(r j − E[r j], 0)
]
, if Q = +.
(2)
2.3. Optimization for the Ranking List
To optimize the effectiveness of a ranking list with the summary statistics, mean and semivariance, the objective
function for the optimization is
max An = E[Rn] − a × VarQ(Rn), (3)
where a denotes the risk preference parameter and Q ≡ sgn[a]. Note that for a risk-averse solution, a < 0 and for a
risk-loving solution, a > 0; additionally, with a = 0, documents are ranked by the PRP.
Since the weight wi for each document is a discrete variable, it is hard to directly optimize the objective function
in Eq. (3). Therefore, the greedy algorithm in [4] is adopted to optimize the objective function. The difference of
the objective function from the position k − 1 to k is
Ak − Ak−1 = E[Rk] − a × VarQ(Rk) − E[Rk−1] + a × VarQ(Rk−1)
=
k∑
i=1
wiE[ri] − a
k∑
i=1
k∑
i=1
wiwjcˆi, j −
k−1∑
i=1
wiE[ri] + a
k∑
i=1
k−1∑
i=1
wiwjcˆi, j
= wk(E[rk] − awkcˆkk − 2a
k−1∑
i=1
wicˆi,k). (4)
The i-th ranked document for i ∈ {2, 3, · · · , n} is selected to maximize the difference Ai − Ai−1 in Eq. (4). (Note that
the first document (i = 1) is set to the document with the highest relevance score.)
2.4. Calculation of Means and Semicovariance Matrix
Different retrieval models generate different estimators of E[Rn] and VarQ(Rn). In the following experiments,
the probabilistic language models with Dirichlet and Jelinek-Mercer (JM) smoothing are adopted [12]. In a
multinomial language model with parameter y = (y1, · · · , yi, · · · , y|V |), given a document d ≡ (d1, · · · , di, · · · , d|V |),
the posterior probability can denoted as p(y |d,α), and
p(y |d,α) ∝ p(d | y)p(y |α) =
∏
i
(yi)di
∏
i
(yi)αi−1
=
∏
i
(yi)di+αi−1
∼ Dir(d + α), (5)
where p(w|α) is the Dirichlet prior on y with parameter α = (α1, · · · ,αi, · · · ,α|V |).
The mean of yi is chosen to be the estimator of yi; i.e.,
yˆi =
di + αi∑n
i=1 di + αi
. (6)
147 Ming-Feng Tsai and Chuan-Ju Wang /  Procedia Computer Science  13 ( 2012 )  143 – 148 
(a) (b)
Fig. 2. Comparison of our approach (PMPT) against the MPT and the PRP on Robust2004 hard topics.
the PMPT method can better rank retrieved documents via the mean-semivariance framework. For the performance
at top positions, the PMPT method, especially, can gain about 2.5%, 1.5%, and 1.0% improvements in terms of
MAP5, P@5, and NDCG@5, respectively; this leap demonstrates that the PMPT method can boost the top-position
ranking quality even further, no matter with either the Dirichlet or JM smoothing techniques. Similarly, as shown
in Fig. 2, the proposed PMPT method improves over the PRP baseline in terms of most of IR evaluation metrics
on the Robust04 dataset. However, since the topics we used for the Robust04 track are hard topics only, in terms
of some metrics, the PMPT method can only get minor improvements, or even cannot outperform over the MPT
method. This phenomenon shows that, when operating on hard topics, these two approaches based on Portfolio
Theory might obtain similar performance. As shown in Fig. 2(b), compared with the PRP baseline, the PMPT
method with the JM smoothing still gains about 7%, 5%, and 3% improvements in terms of MAP5, P@5, and
NDCG@5, respectively. Furthermore, with respect to the different smoothing techniques, we observe that the JM
smoothing generally performs better than the Dirichlet smoothing does; this phenomenon may be due to the big
variances caused by the JM smoothing in our experiments. This observation is also consistent with that in [10],
which suggests that it might be more preferable to apply the “risk-sensitive“ approach with the JM smoothing
technique.
4. Conclusions and Future Work
This paper proposes a general mean-semivariance framework to study document ranking under uncertainty.
In the framework, the downside uncertainty can be distinguished with the upside uncertainty when optimizing a
ranking list. Experiments on two TREC datasets with the different smoothing techniques validate that the proposed
framework improves the ranking quality over the PRP baseline and the MPT approach. In particular, the proposed
framework obtains about 1%-7% improvements over the PRP baseline in terms of MAP5, P@5, and NDCG@5.
Future directions include how to use learning techniques to find out the optimal parameters of the proposed
framework, and how to adapt the framework to diversified information retrieval.
Acknowledgments
Research of this paper was partially supported by National Science Council, Taiwan, under the contract
NSC100-2218-E-004-001.
 
國科會補助專題研究計畫項下出席國際學術會議心得報告  
                  日期： 2012  年 12 月 20 日 
                                 
一、參加會議經過 
 本次會議為 Indian Institute of Technology Bombay (IITB)主辦之
計算語言學會議（COLING ），於 2012 年 12 月 8 日至 12月 15 日
在印度孟買 IITB校園之 VMCC舉行。 
 
二、與會心得 
 COLING 為計算語言學之國際重要會議，兩年舉辦一次，每次
皆十分盛大，此次會議長達一星期， 與會者約有 800 多人，其中包
括各個國家之電腦科學、語言學等研究人員 。本人所發表為 demo 
paper，也就是會在會場提供實體 demo，將論文內容以 demo 形式
發表，題目為“Visualization on Financial Terms via Risk Ranking 
from Financial Reports ”，我們的 demo 在多個時間在會場發表，在
會議過程中，來自各國研究人員皆對我們的研究很有興趣，亦有很
深入的討論，他們也給予一些很有建設性的建議及提問，對於我們
計畫編
號 
NSC 100-2218-E-133-001-MY2 
計畫名
稱 
多變量樹狀模型之建構分析及其應用（第 2年） 
出國人
員姓名 王釧茹 
服務機
構及職
稱 
台北市立教育大學 
助理教授 
會議時
間 
2012年 12月 
8日至 
2012年 12月 
15日 
會議地
點 
孟買，印度  
會議名
稱 
(中文) 第 24屆國際計算語言會議 
(英文)The 24th International Conference on Computational 
Linguistics (Coling 2012) 
發表論
文題目 
(中文) 由財報中針對公司風險排序之視覺化呈現 
(英文)Visualization on Financial Terms via Risk Ranking 
from Financial Reports 
 *PDLO$FFHSWHGDVGHPRӾQDOIRU&2/,1*
KWWSVPDLOJRRJOHFRPPDLOX"XL 	LN IEEE	YLHZ SW	VHDUFK LQER[	PVJ DHEHG
&KXDQ-X:DQJMHUHZDQJ#JPDLOFRP!
$FFHSWHGDVGHPRILQDOIRU&2/,1*
&KULVWLDQ%RLWHW#LPDJIU&KULVWLDQ%RLWHW#LPDJIU! 6XQ1RYDW$0
7RFMZDQJ#WPXHHGXWZ
'HDU0LQJ)HQJ7VDLDQG&KXDQ-X:DQJ
7KLVPHVVDJHLVWRLQIRUP\RXRIWKHVWDWXVRI\RXUVXEPLVVLRQWRWKH&2/,1*FRQIHUHQFHWKDWZLOOWDNH
SODFHLQ0XPEDLIURPWKWRWK'HFHPEHU<RXUSDSHUQXPEHUHQWLWOHG
9LVXDOL]DWLRQRQ5LVN5DQNLQJIURP)LQDQFLDO5HSRUWV
KDVEHHQGHILQLWLYHO\DFFHSWHGDVDGHPRSDSHU
3OHDVHPDNHVXUHWKHPHWDGDWDLQWKH)LQDO6XEPLVVLRQ3DJHLVFRUUHFWDXWKRUVWLWOHVDEVWUDFWV
NH\ZRUGV7KDWLVEHFDXVHPDQ\ILQDOVXEPLVVLRQVKDYHWLWOHVDQGDEVWUDFWVGLIIHULQJIURPWKRVHRIWKHILQDO
VXEPLVVLRQ7KHLQGH[HVDQGWDEOHVRIFRQWHQWVZLOOEHSURGXFHGIURPWKHVHPHWDGDWD
6HH\RXVRRQLQ0XPEDLIRU&2/,1*
0DUWLQDQG;DQ
1 Introduction
Financial risk is the chance that a chosen investment instruments (e.g., stock) will lead to a loss.
In finance, volatility is an empirical measure of risk and will vary based on a number of factors.
This paper attempts to use text information in financial reports as factors to rank the risk of
stock returns.
Considering such a problem is a text ranking problem, we attempt to use learning-to-rank
techniques to deal with the problem. Unlike the previous study (Kogan et al., 2009), in which a
regression model is employed to predict stock return volatilities via text information, our work
utilizes learning-to-rank methods to model the ranking of relative risk levels directly. The reason
of this practice is that, via text information only, predicting ranks among real-world quantities
should be more reasonable than predicting their real values. The difficulty of predicting the
values is partially because of the huge amount of noise within texts (Kogan et al., 2009) and
partially because of the weak connection between texts and the quantities. Regarding these
issues, we turn to rank the relative risk levels of the companies (their stock returns).
By means of learning-to-ranking techniques, we attempt to identify some key factors behind the
text ranking problem. Our experimental results show that in terms of two different ranking
correlation metrics, our ranking approach significantly outperforms the regression-based method
with a confidence level over 95%. In addition to the improvements, through the learned ranking
models, we also discover meaningful words that are financially risk-related, some of which
were not identified in (Kogan et al., 2009). These words enable us to get more insight and
understanding into financial reports.
Finally, in this paper, a visualization interface is provided to demonstrate the learned relations
between financial risk and text information in the reports. This demonstration not only enables
users to easily obtain useful information from a number of financial reports but offer a novel
way to understand these reports.
The remainder of this paper is organized as follows. In Section 2, we briefly review some
previous work. Section 3 presents the proposed ranking approach to the financial risk ranking
problem. Section 4 reports experimental results and provides some discussions and analyses on
the results. We finally conclude our paper and provide several directions for future work.
2 Related Work
In the literature, most text ranking studies are related to information retrieval (Manning
et al., 2008). Given a query, an information retrieval system ranks documents with respect to
their relative relevances to the given query. Traditional models include Vector Space Model
(Salton et al., 1975), Probabilistic Relevance Model (Robertson and Sparck Jones, 1988), and
Language Model (Ponte and Croft, 1998). In addition to the conventional models, in recent
years there have also been some attempts of using learning-based methods to solve the text
ranking problem, such as (Freund et al., 2003; Burges et al., 2005; Joachims, 2006), which
subsequently brings about a new area of learning to rank in the fields of information retrieval
and machine learning. Considering the prevalence of learning-to-rank techniques, this paper
attempts to use such techniques to deal with the ranking problem of financial risk.
In recent year, there have been some studies conducted on mining financial reports, such as (Lin
et al., 2008; Kogan et al., 2009; Leidner and Schilder, 2010). (Lin et al., 2008) use a weighting
scheme to combine both qualitative and quantitative features of financial reports together, and
448
Method 2001 2002 2003 2004 2005 2006 Average
Feature: TFIDF Kendall’s Tau (Kendall, 1938)
SVR (baseline) 0.517 0.536 0.531 0.515 0.515 0.514 0.521
Ranking SVM 0.539 0.549 0.543 0.526 0.539 0.525 0.537* (6.57E-4)
Feature: TFIDF Spearman’s Rho (Myers and Well, 2003)
SVR (baseline) 0.549 0.567 0.562 0.545 0.544 0.540 0.551
Ranking SVM 0.571 0.580 0.575 0.556 0.568 0.551 0.567* (6.97E-4)
Numbers in brackets indicate the p-value from a paired t-test. Bold faced numbers denote improve-
ments over the baseline, and * indicates that the entry is statistically significant from the baseline at
95% confidence level.
Table 1: Experimental Results of Different Methods.
optimization problem.
min
w
V (w,ξ) =
1
2
〈w,w〉+ C￿ξi, j,k
s.t.

∀(di,dj) ∈ Y1 : 〈w,di〉 ≥ 〈w,dj〉+ 1− ξi, j,1
. . .
∀(di,dj) ∈ Yn : 〈w,di〉 ≥ 〈w,dj〉+ 1− ξi, j,n∀i∀ j∀k : ξi, j,k ≥ 0,
(3)
where w is a learned weight vector, C is the trade-off parameter, ξi, j,k is a slack variable, and Yk
is a set of pairs of financial reports within a year.
4 Experiments and Analysis
In this paper, the 10-K Corpus (Kogan et al., 2009) is used to conduct the experiments;
only Section 7 “management’s discussion and analysis of financial conditions and results of
operations” (MD&A) is included in the experiments since typically Section 7 contains the most
important forward-looking statements. In the experiments, all documents were stemmed by
the Porter stemmer, and the documents in each year are indexed separately. In addition to the
reports, the twelve months after the report volatility for each company can be calculated by
Equation (1), where the price return series can be obtained from the Center for Research in
Security Prices (CRSP) US Stocks Database. The company in each year is then classified into 5
risk levels ("= 2) via Equation (2). For regression, linear kernel is adopted with ε= 0.1 and
the trade-off C is set to the default choice of SVMlight, which are the similar settings of (Kogan
et al., 2009). For ranking, linear kernel is adopted with C = 1, all other parameters are left for
the default values of SVMRank.
Table 1 tabulates the experimental results, in which all reports from the five-year period
preceding the test year are used as the training data (we denote the training data from the
n-year period preceding the test year as Tn hereafter). For example, the reports from year 1996
to 2000 constitute a training data T5, and the resulting model is tested on the reports of year
2001. As shown in the table, with the feature of TF-IDF, our results are significantly better than
those of the baseline in terms of both two measures. In addition to using T5 as the training
data, we also conduct other 4 sets of experiments with T1,T2,T3,T4 to test the reports from
450
Future directions include how to reduce the noise within texts, and how to incorporate Standard
Industrial Classification (SIC) into our ranking approach. In addition, a hybrid model consisting
of both financial and text information may be also one of our future directions.
References
Burges, C., Shaked, T., Renshaw, E., Lazier, A., Deeds, M., Hamilton, N., and Hullender, G.
(2005). Learning to rank using gradient descent. In Proceedings of the 22nd international
conference on Machine learning, ICML ’05, pages 89–96. ACM.
Freund, Y., Iyer, R., Schapire, R. E., and Singer, Y. (2003). An efficient boosting algorithm for
combining preferences. J. Mach. Learn. Res., 4:933–969.
Joachims, T. (2006). Training linear svms in linear time. In Proceedings of the 12th ACM
SIGKDD international conference on Knowledge discovery and data mining, KDD ’06, pages
217–226. ACM.
Kendall, M. (1938). A new measure of rank correlation. Biometrika, 30(1/2):81–93.
Kogan, S., Levin, D., Routledge, B., Sagi, J., and Smith, N. (2009). Predicting risk from financial
reports with regression. In Proceedings of Human Language Technologies: The 2009 Annual
Conference of the North American Chapter of the Association for Computational Linguistics, pages
272–280. ACL.
Leidner, J. L. and Schilder, F. (2010). Hunting for the black swan: risk mining from text. In
Proceedings of the ACL 2010 System Demonstrations, ACLDemos ’10, pages 54–59. ACL.
Lin, M.-C., Lee, A. J. T., Kao, R.-T., and Chen, K.-T. (2008). Stock price movement prediction
using representative prototypes of financial reports. ACM Trans. Manage. Inf. Syst., 2(3):19:1–
19:18.
Manning, C., Raghavan, P., and Schutze, H. (2008). Introduction to information retrieval.
Cambridge University Press.
Myers, J. and Well, A. (2003). Research design and statistical analysis, volume 1. Lawrence
Erlbaum.
Ponte, J. M. and Croft, W. B. (1998). A language modeling approach to information retrieval. In
Proceedings of the 21st annual international ACM SIGIR conference on Research and development
in information retrieval, SIGIR ’98, pages 275–281. ACM.
Robertson, S. E. and Sparck Jones, K. (1988). Relevance weighting of search terms. In
Document retrieval systems, pages 143–160. Taylor Graham Publishing.
Salton, G., Wong, A., and Yang, C. S. (1975). A vector space model for automatic indexing.
Commun. ACM, 18(11):613–620.
Tsay, R. (2005). Analysis of financial time series. Wiley-Interscience.
452
100年度專題研究計畫研究成果彙整表 
計畫主持人：王釧茹 計畫編號：100-2218-E-133-001-MY2 
計畫名稱：多變量樹狀模型之建構分析及其應用 
量化 
成果項目 實際已達成
數（被接受
或已發表）
預期總達成
數(含實際已
達成數) 
本計畫實
際貢獻百
分比 
單位 
備 註 （ 質 化 說
明：如數個計畫
共同成果、成果
列 為 該 期 刊 之
封 面 故 事 ...
等） 
期刊論文 0 0 100%  
研究報告/技術報告 0 0 100%  
研討會論文 0 0 50% 
篇 
 
論文著作 
專書 0 0 100%   
申請中件數 0 0 100%  專利 已獲得件數 0 0 100% 件  
件數 0 0 100% 件  
技術移轉 
權利金 0 0 100% 千元  
碩士生 4 0 20%  
博士生 2 0 40%  
博士後研究員 0 0 100%  
國內 
參與計畫人力 
（本國籍） 
專任助理 0 0 100% 
人次 
 
期刊論文 1 1 100% 
A Multi-Phase, 
Flexible, and 
Accurate Lattice 
for Pricing 
Complex 
Derivatives with 
Multiple Market 
Variables. To 
appear in The 
Journal of 
Futures Markets. 
(SSCI，國科會財
金類 A-期刊） 
研究報告/技術報告 0 0 100%  
國外 論文著作 
研討會論文 5 5 60% 
篇 
A Multi-Phase, 
Flexible, and 
Accurate Lattice 
for Pricing 
Complex 
Derivatives on 
Multiple Market 
Variables. In 
Proceedings of
Proceedings of 
the 35th annual 
European 
Conference on 
Information 
Retrieval (ECIR 
'13), Moscow, 
2013, pp. 
804-807. (poster 
paper) 
 
Chuan-Ju Wang, 
Ming-Feng Tsai, 
Tse Liu, and 
Chin-Ting Chang. 
Financial 
Sentiment 
Analysis for 
Risk Prediction. 
In Proceedings 
of the 6th 
International 
Joint Conference 
on Natural 
Language 
Processing 
(IJCNLP '13), 
Nagoya, 2013. 
專書 0 0 100% 章/本  
申請中件數 0 0 100%  專利 已獲得件數 0 0 100% 件  
件數 0 0 100% 件  
技術移轉 
權利金 0 0 100% 千元  
碩士生 0 0 100%  
博士生 0 0 100%  
博士後研究員 0 0 100%  
參與計畫人力 
（外國籍） 
專任助理 0 0 100% 
人次 
 
