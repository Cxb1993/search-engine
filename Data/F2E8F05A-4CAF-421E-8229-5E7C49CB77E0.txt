    I 
 
中文摘要 
本計畫針對逐漸被重視且國內尚未有研發能力設計的主動安全防護功能的高速線傳（x-by-Wire）
控制系統，其所需具備的 FlexRay 高速車載通訊網路來作開發與研究。其中，分別實現 Android 作業系
統之嵌入式車輛通訊網路電子平台，以及外部連接之嵌入式 FlexRay ECU 節點與嵌入式 FlexRay/CAN
閘道器來驗證與測試高速 FlexRay 車載通訊網路所實現之主動安全防護功能。 
其中，以 Freescale S12XF512 16 位元微控制器與 NXP TJA1080 收發器整合成一 FlexRayECU 節
點，並設計出有源與無源耦合器來拓展出完整的 FlexRay 拓樸網路架構，以及實現出具備 FlexRry 功能
之 ABS 電腦防鎖煞車系統。此外，在每一年的執行進度中，分別將 FlexRray 車載通訊網路的相關訊
息傳回至以 ARM-based OMAP 3530（TI）處理器為核心的嵌入式車輛通訊網路電子平台中，並以
Android 2.1 來開發圖形化的應用程式。 
此計畫是針對車輛通訊網路節點技術及嵌入式電子平台之通訊網路技術進行研製，以發展 Android
嵌入式車輛通訊網路之電子平台以及嵌入式 ECU 技術為最終目標。而相關的應用程式碼皆為開放原
始碼，未來更助於相關技術轉移以及與其他平台共用或是移植。 
關鍵詞：Android、車輛電子通訊網路技術、嵌入式系統、FlexRay、CAN  
    III 
 
目錄 
中文摘要 ………………………………………………………………………………………… I 
英文摘要 ………………………………………………………………………………………… II 
一、前言 ………………………………………………………………………………………… 1 
二、研究目的 …………………………………………………………………………………… 3 
三、文獻探討 …………………………………………………………………………………… 4 
四、研究方法 …………………………………………………………………………………… 6 
五、結果與討論 ………………………………………………………………………………… 16 
六、參考文獻 …………………………………………………………………………………… 20 
七、附錄 ………………………………………………………………………………………… 21
    2 
 
的概念，如圖 1.3 所示。因此，藉由電子與車輛跨領域產業結合，更加使得車輛通訊網路發展日新月
異。 
 
 
圖 1.3 混合 FlexRay 網路之節點通訊拓樸方式 
 
而先進的安全線傳控制(X-by-wire)網路系統 FlexRay，在多家半導體公司和許多高階汽車大廠倡導
下，將成為下一世代車輛通訊網路的主流。由於 FlexRay 擁有比 CAN 還要大 20 倍的頻寬(10Mb/s)，
還具備有容錯能力和定時啟動能力，可以提供可靠和即時的資訊給安全需求高的應用環境。 
因此，本計畫研究將使用 Freescale 公司的 MC9S12XF512 做為核心，建構出轉速轉向與傳動控制
的 FlexRay ECU 節點，實現 X-by-wire 控制。並開發一 FlexRay 轉 CAN 通訊網路的閘道器，實現兩種
不同通訊網路的資料傳遞。此外，為了提高可攜性，我們以 TI OMAP3530 為核心的 Android 嵌入式平
台，擷取目前 CAN 通訊網路的資料，做為車載網路資料檢測平台。 
    4 
 
三、文獻探討 
21 世紀以來，隨著車用電子元件與嵌入式系統模組持續發展，汽車製造商進一步提升安全性、可
靠性和舒適性等，大量的感測器、作動器和電子控制單元(ECU)組成的先進車輛控制系統，原有的車
載通訊網路－區域控制網路匯流排(CAN-Bus)，勢將無法提供充分支援，FlexRay™協議得以因應而生
[4-6][17]。FlexRay™協議藉由高速、確定性與容錯通信技術，足以滿足先進車輛控制系統的需求；它
支援車載網路，不是取代現有網路，而是與現有通訊控制網路，如區域控制網路(CAN)[13][16]、局域
互聯網路(LIN)[13][19]和媒體導向系統傳輸網路(MOST)等相結合[20]。 
其中，FlexRay 已經成為業界公認的車用網路標準，從技術層面來看，FlexRay 的通訊速度是目前
各種介面中最快，是實現線控煞車、線控轉向等功能不可或缺的網路技術，它能減輕車體重量，各個
安全裝置的連動確實實現。線傳控制(X-by-wire)是將傳統機械方式操控與制動之功能，改用電氣傳動
裝置(actuator)或馬達電子來控制的技術，例如線傳控制驅動、線傳控制駕駛等。X-by-wire 可提升汽車
性能，安全性可顯著提升，並省掉機械元件。FlexRay 線傳控制技術顯著的優勢，在於可同時支援時
間觸發和事件觸發兩種通訊方式；可同時採用匯流排與星狀拓璞，彈性相當大。此外，FlexRay 協定
可同時採用靜態段與動態段，兩種傳送資料分配方式，大大的增加通訊控制的靈活度，可用性與訊息
容量也隨之增加。FlexRay 資料傳輸率可達 10~20 Mbit/s，可採用作為傳送匯流排內預先定義必要時間
的匯流排系統，具有較高的可靠性。因此美國、歐洲和亞洲的許多汽車製造業者，都已加入 FlexRay
研發工作，主要集中在線傳控制轉向系統、線傳控制動力系統以及線傳控制煞車系統等方面。如圖
12-2.2 所示，為 FlexRay 最主要之應用架構示意圖。  
根據 IBTS 機構的分析[21]，汽車電子預估複合成長率約 5%~6%，預估到 2010 年汽車電子佔車價
比重將提高至 35%[21-22]。而 2006 年汽車電子所佔比重較高者分別為動力系統（28%）、車體系統
（20%）、駕駛資訊（20%）。 
其中，針對非強迫性的需求—引發民眾注意安全問題，全世界每年因車禍受傷的人數約 2,000 萬
人，而死亡人數約 120 萬人，財產損失方面約佔全球國民生產毛額 2%。而根據 Benz 指出，只要增加
0.5 秒的警示時間，即可避免 60%的追撞事故；增加 1.5 秒，即可避免 90%的追撞事故。相對的，強
迫性的需求—增加安全系統消費，衍生出主動與被動安全系統的法規誕生。 
而在非強迫性的需求之主動式安全系統中，剎車系統包含了電腦防鎖煞車系統(ABS) 、循跡防滑
控制系統（TCS）與電子穩定控制系統（ESP）。換言之，車輛之主動安全防護系統的重要性與車輛電
    6 
 
四、研究方法 
根據先前所述，本研究包含一個閘道器與兩種通訊網路。如下圖 4.1 所示，為本系統的架構圖。上
半部為傳輸率 10Mbps 的 FlexRay 通訊網路，包括轉速轉向與傳動控制兩個 ECU；下半部為傳輸率
500Kbps 的 CAN 通訊網路，包括一個儀表控制的 ECU，以及做為資料檢測的 Android 嵌入式平台。使
用 FlexRay/CAN 閘道器連結兩種不同的通訊網路。 
兩種網路上的 ECU 節點控制的功能，考量成本、傳輸率與安全性等，將需要即時、安全性的車輛
控制部份，於 FlexRay 高速網路並僅用單通道實現。較無安全急迫的儀表控制，則於 CAN 網路中實現。 
本研究使用遙控車模擬實車，透過市售遊戲方向盤與踏板實現車輛轉速與轉向的控制。 
 
 
圖 4.1 系統架構圖 
 
以下，分別針對相關系統設計加以說明。 
 
4.1 FlexRay 通訊網路 
本系統的 FlexRay 網路，利用星狀拓樸的方式以兩個 ECU 節點和一個 FlexRay/CAN 閘道器建構出
一個高達 10Mbps 的高速車載網路，並以高安全性和高及時性為導向，模擬實車的轉速轉向和傳動控
制。 
為了實現 FlexRay 網路傳輸，在軟體設計方面，首先需考慮 FlexRay 網路具備之 FTDMA (Flexible 
    8 
 
 
圖 4.3 FlexRay 區塊圖 
 
本系統中 FlexRay ECU 節點使用 MC9S12XF512 微處理器(Frescale)，其內建 FlexRay 控制器，並
搭配 TJA1080 FlexRay 收發器(NXP)實現 FlexRay 傳輸。如下圖 4.4 所示，為 FlexRay ECU 節點架構圖。 
 
 
圖 4.4 FlexRay ECU 節點架構 
 
以下分別介紹轉速轉向控制節點、傳動控制節點與 FlexRay/CAN 閘道器的設計。 
 
4.1.1 FlexRay 轉速轉向控制節點設計 
轉速轉向方面，透過羅技公司(Logitech)所推出市售的 USB 方向盤與踏板組實現轉速轉向的控制動
作。其中，透過所設計的電路板，採用 P89C61X2BA 微處理器(Atmel)與 SL81HS USB 控制器(Cypress)。
USB 方向盤與踏板訊號轉換成 RS232 的型式，傳入 FlexRay 轉速轉向控制的 ECU 節點中，達到模擬
操控的目的。如下圖 4.5 所示，為轉速轉向控制節點的架構圖。 
 
 
    10 
 
 
由於 MC9S12XF512 提供六個通道的 PMF，對於控制遙控車來說已經非常夠用。在設計方面，首
需量測遙控車前輪的伺服馬達和後輪直流馬達的總週期時間以及 Duty Cycle time，下表 4.2 為量測的結
果。 
 
表 4.2 遙控車週期時間&Duty Cycle time 
 轉速 0 正轉 反轉 
轉向 
中心 
轉向 
左轉 
轉向 
右轉 
Duty 
high 
1.54us 1.97us 1.15us 1.48us 1.82us 1.06us 
Duty 
low 
17.63us 17.02us 18.02us 17.68us 17.63us 18.01us 
 
如下圖 4.8 所示，為傳動控制節點中的 FlexRay ECU 韌體流程圖。 
 
 
圖 4.8 傳動控制節點韌體流程圖 
 
4.1.3 FlexRay/CAN 閘道器設計 
目前車輛通訊網路，還是由 CAN 最為廣泛應用。因此，FlexRay 與 CAN 的資料轉換與傳遞，則
    12 
 
 
圖 4.11 FlexRay/CAN 閘道器之韌體流程圖 
 
4.2 CAN 通訊網路 
CAN(Controller  Area  Network，控制區域網路)，因其優異性能而在工業控制、汽車電子、安全
防護等方面得到廣泛的應用。CAN 擁有了高度的彈性調整能力，可以在既有的網路中增加節點而不用
在軟硬體上作修正與調整，且資料傳輸率可高達 1Mbps。此外，可根據訊息格式發送訊息不需指定裝
置、可靠的錯誤處理與偵錯機制、訊息遭到破壞後可自動重發，以及節點在錯誤嚴重的情況下具有自
動退出串列協定分析的功能。 
本系統中的 CAN ECU 節點做為儀表的控制，我們採用 89C51CC01 微處理器(Atmel)其內建 CAN
控制器，搭配 PCA82C251 CAN 收發器(NXP)，透過差動訊號 CAN_H 與 CAN_L 進行 CAN 傳輸。如
下圖 4.12 所示，為 CAN ECU 節點架構圖。 
 
 
    14 
 
4.3 Android 嵌入式平台 
本研究使用 UBIKIT 6612 嵌入式開發平台(優奎士公司)。此平台為雙核心架構，核心採用
OMAP3530 ARM Cortex™的 A8 CPU 與數位訊號處理運算的 DSP TMS320C64+處理器。由於此核心之
效能優於 S3C6410，故本系統改採用此一嵌入式開發平台。 
如下圖 4.15 所示，為嵌入式平台上的 CAN 匯流排硬體架構，OMAP3530 連接 MCP2515 CAN 控
制器(NXP)與 MCP2551 CAN 收發器(Microchip)實現 CAN 傳輸。 
 
圖 4.15 嵌入式平台 CAN 架構圖 
 
為了方便檢測 CAN 匯流排通訊網路上的資料，並且提高可攜性與易操作性，我們設計一 CAN 匯
流排資料檢測程式，安裝於嵌入式平台上。嵌入式平台上搭載 Android 2.1 作業系統，如下圖 4.16 所示，
為 Android 架構。 
 
 
圖 4.16 Android 架構圖 
 
為開發 CAN 匯流排資料擷取程式，我們需撰寫 Android 應用程式[15]與設計底層 CAN 驅動程式，
並編譯於核心中[12]。如下圖 4.17 所示，我們將自行開發的 CAN 驅動程式掛載於 Linux Kernel 中。 
 
    16 
 
五、結果與討論 
如下圖 5.1 所示，為本系統的實體圖。由先前所述，共有兩種通訊網路，分別為 FlexRay 與 CAN，
透過 FlexRay/CAN 閘道器做為兩種網路的連接。兩個 FlexRay ECU 節點，分別為轉速轉向與傳動控制；
一個 CAN ECU 節點，做為儀表控制。以及，使用以 Android 為作業系統的 UBIKIT 6612 嵌入式開發
平台來檢測 CAN 匯流排網路上的資料。 
 
 
圖 5.1 整體系統架設實體圖 
 
緊接著，透過嵌入式平台上的圖形化介面程式顯示，如下圖 5.2 所示，顯示目前 CAN 網路上的資
料封包。前兩個位元組為方向盤轉動的數值，此時為正轉。三、四、五位元組為油門踏板踩動的數值，
第六個位元組為剎車踏板踩動的數值。 
 
 
圖 5.2 CAN 匯流排資料檢測 
 
5.1 轉向控制 
首先，我們進行轉向的控制實驗，如下圖 5.3 所示，我們將連接轉向轉速控制節點的方向盤往左
    18 
 
 
 
圖 5.6 壓下油門踏板 
 
同樣的，當壓下踏板的同時，Android 圖形化介面程式上的 CAN 匯流排資料會如下圖 5.7 所示，
在第三、四、五位元組的資料上有明顯的改變。 
 
 
圖 5.7 壓下油門踏板 CAN 資料變化 
 
如下圖 5.8 所示，CAN 網路的儀表控制節點，接收來自 FlexRay/CAN 閘道器的轉速資料，驅使連
接儀表控制節點的儀表做動。 
 
 
圖 5.8 儀表變化操作示意圖 
 
5.3 資料驗證 
FlexRay 網路的資料驗證，我們採用 LAP-322000U-A 數位邏輯分析儀(孕龍公司，Zeroplus)來實現
FlexRay 分析資料，以驗證系統上的網路為標準 FlexRay 訊號。如下圖 5.9 所示，擷取 10Mbps 的資料
訊框。 
 
    20 
 
六、參考文獻 
[1] Seung-Han Kim, Suk-Hyun Seo1, Jin-Ho Kim1, Tae-Yoon Moon1, Chang-Wan Son1, Sung-Ho Hwang2, 
and Jae Wook Jeon1, “A Gateway System for an Automotive System: LIN, CAN, and FlexRay”, The IEEE 
International Conference on Industrial Informatics, pp.967-972, 2008 
[2] Pro.Dr.-Ing.K.Etschberger, “CAN-based Higher Layer Protocols and Profiles,” IXXAT Automation 
Gmbh., 2005. 
[3] Jingcheng Wang and Xiaoming Wang and Xianglin Zhai and Hao Wang, “CAN/LIN hybrid network for 
automobile,” IEEE International Conference, Vol.14-16, pp. 348-352,2005.  
[4] 王信凱、許永和、許源鏞，FlexRay 汽車通訊網路平台之設計與實作，第十三屆車輛工程學術研討
會，台北，2008。 
[5] 王銘儀，即時排程在 10Mbps 車用電子網路之應用，碩士論文，國立中山大學，台灣，2007。 
[6] 李旺軒，巫志倫，“車身 AFS 與車身網路整合之電控介紹＂，車輛研測資訊，2005，11 
[7] 張國梁、羅民芳、胡紹俊、胡起雯，FlexRay 與 CAN 網路 Gateway 模組之設計，第十三屆車輛工
程學術研討會，台北，2008。 
[8] 許永和，許源鏞，賴大溪，黃屹偉，郭仲宇，李宗穎，“應用於車輛電子通訊網路之 USB-CAN Dongle
設計＂ ，第十一屆車輛工程學術研討會 
[9] 羅清岳，車用電子－打造未來智能化汽車，嵌入式系統扮演要角，DigiTimes.com 
[10] 羅清岳，車用電子控制單元(ECU)系統架構及解決方案－(上) ，DigiTimes.com 
[11] 羅清岳，車用電子控制單元(ECU)系統架構及解決方案－(下) ，DigiTimes.com 
[12] 平田豐，Linux  Driver  Programming 驅動程式設計，博碩文化股份有限公司，2010。 
[13] 許永和，第 4C 車載通訊電子網路之 CAN/LIN 匯流排設計與應用，儒林圖書有限公司，2010。 
[14] 陳乃塘，實現完全電控汽車 FlexRay 躍居車用網路主流，新通訊元件雜誌 67 期 9 月號，2006 
[15] 蓋索林(gasolin)，Google!Android2 手機應用程式設計入門第三版，松崗資產管理股份有限公司，
2009。 
[16] CAN Specification 2.0A & 2.0B,  http://www.can-cia.org/, 2002 
[17] FlexRay Communications System Protocol. Specification Version 2.1. 
[18] FlexRay Consortium,http://www.flexray.com 
[19] LIN Specification Package Revision 2.1,  http://www.Lin-subbus.org/, 2006 
[20] MOST Specification v3.0,MOST Cooperation,  http://www.mostnet.de/home/index.html,  2010 
[21] 台灣工業銀行，IBTS，www.ibts.com.tw. 
[22] 鐘榮峰，打通汽車任督二脈-連結！啟動！GO！，零組件雜誌，第 192 期，第 31-45 頁，2007. 
國科會補助計畫衍生研發成果推廣資料表
日期:2011/09/18
國科會補助計畫
計畫名稱: 具備線傳控制主動安全防護功能之Android嵌入式車輛通訊網路電子平台研製
計畫主持人: 許永和
計畫編號: 99-2221-E-150-045- 學門領域: 計算機結構與計算機系統
無研發成果推廣資料
其他成果 
(無法以量化表達之成
果如辦理學術活動、獲
得獎項、重要國際合
作、研究成果國際影響
力及其他協助產業技
術發展之具體效益事
項等，請以文字敘述填
列。) 
獲得 99 學年度全國大學校院嵌入式系統設計競賽，嵌入式系統軟體組，佳作 
 成果項目 量化 名稱或內容性質簡述 
測驗工具(含質性與量性) 0  
課程/模組 0  
電腦及網路系統或工具 0  
教材 0  
舉辦之活動/競賽 0  
研討會/工作坊 0  
電子報、網站 0  
科 
教 
處 
計 
畫 
加 
填 
項 
目 計畫成果推廣之參與（閱聽）人數 0  
 
