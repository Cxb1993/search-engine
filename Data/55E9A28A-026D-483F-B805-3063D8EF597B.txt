2鬆與收縮方式，建構代理人讓步及替換之協商
策略；而結合案件導向推理與模糊機率限制之
對手模塑(Opponent Model)則是利用過去協商
記錄與目前協商過程，來學習、預測對手行
為，引導協商方向。此模式之目的是為了能預
測對手可能的意圖，避免協商失敗，加速達成
代理人預期的協商目標。
三. 文獻探討
代理人協商係兩個或多個軟體代理人
間，經由不斷重覆的共同決策過程，達成相互
可接受之決策目標[7]。許多方式被提出處理
協商問題，包括協商支援系統(Negotiation
Support Systems)[8] ， 賽 局 理 論 (Game
Theory)[19] ， 貝 氏 模 式 (Bayesian
Model)[18] ， 演 化 式 計 算 (Evolutionary
Computation)[4,16] ， 分 散 式 人 工 智 慧
(Distributed Artificial Intelligence)
[5]。協商支援系統強調的是與人的互動，提
供協商者相關的資訊來支援協商者的判斷，而
不是自動化的協商。在賽局理論模式中，代理
人對每一可能互動產生的效益(Utility)，被
用來建構收益矩陣(payoff matrix)，且代理
人每次協商均以本身最高的期望效益值作為
選 擇 協 商 內 容 為 考 量 。 Rosenschein 與
Zlotkina[19]將決策理論與賽局理論應用到
協 商 的 設 計 與 環 境 的 互 動 。 Carmel 和
Markovitch [3]以對局理論(Game Theory)模
式提出之學習架構，可藉由學習對手規律性的
習慣，推斷出相對於對手規律性習慣的最好回
應策略。然而以賽局理論為基礎的協商模式，
一般基於不實際的假設所有的軟體代理人都
對收益矩陣有共同的知識。同時即使收益矩陣
為已知，若協商為多議題和多參與者之賽局，
則此模式之推理將很快變得無法處理。在貝氏
模式中，貝氏網路是用來更新每個代理人對於
環境與其他代理人的知識與看法，而貝氏機率
則用以產生提案。Zeng 和 Sycara[25]以此模
式來模塑多議題協商為一循序之決策模式，但
其方式不易描述使用者對產品屬性之需求。演
化式計算，係促使軟體代理人如何學習來完成
類似人類協商行為的理論基礎，從軟體代理人
協商策略的衍生中來決定何種協商策略是較
佳的，然而需要經過多次的嘗試與參數調整，
才能獲得較佳，但未必是最佳的策略。另一群
集之協商模式為分散式人工智慧的領域。
Sycara[21]將協商視為一重覆的程序並提出
一整合案件導向推理與多重屬性效益理論之
架 構 ， 來 處 理 多 重 軟 體 代 理 人
(Multi-agent)、多重議題(Multi-issue)的協
商模式；Sathi 和 Fox[20]則主張協商可視為
限制導向的搜尋問題。然而代理人可能是自私
的，尤其當對手的行為牽涉到許多的心理及思
維狀態的推理時，以上模式將無法有效地描述
和處理此不確定與不精確資訊的軟體代理人
協商行為。
而模糊限制[14]能提供一自然的方式描述
代理人對物品之單一屬性或多屬性之組合的
需求，它也能適當的模塑各議題或屬性之間的
替換，並可捕捉代理人放鬆其限制而達成部分
滿足協議的協商過程。因此，本文提出以模糊
限制為基礎(Fuzzy Constraint)[10,13]，結
合案件導向推理(Case Based Reasoning, CBR)
[1,12] 、模糊機率限制(Fuzzy Probability
Constraint)[24]，建構一具對手模塑之軟體
代理人協商。此模式之目的是為了能預測對手
可能的意圖，避免協商失敗，有效地達成代理
人預期的協商目標。
四. 研究方法
1. 以模糊限制為基礎之代理人協商
1.1 軟體代理人協商視為分散式模糊限制滿足
問題
限制式是描述一個或多個物件間彼此相
互關係的概念；限制滿足問題(Constraint
Satisfaction Problem, CSP)就是要找出所有
物件皆符合特定關係的解答，亦即求出滿足所
有物件限制式的解答，而其結果則可能有解，
也可能無解。同理，模糊限制[22,23,9]是以模
糊集合來表示物件間的關係，以解決不精確性
及不確定性資訊的問題。故模糊限制滿足係決
定是否存在一個滿足所有限制式且在最低可
接受滿意度以上的解題。因此，模糊限制滿足
問 題 (Fuzzy Constraint Satisfaction
Problem, FCSP)的目標是要能找到整體滿意度
最高的解決方案。然而，真實世界的環境是異
質且天生俱分散式的。因此，模糊限制滿足問
題有其需要擴充為分散式模糊限制滿足問題
(Distributed Fuzzy Constraint
Satisfaction Problem, DFCSP)。分散式模糊
4不同的協商問題模塑成不同的模糊限制式，並
以模糊界限(Fuzzy hedges)來比較不同協商問
題的重要性。
綜合上述個別協商問題的滿意度或期望
效益可得軟體代理人 k 的整體滿意值(或期望
效益值)定義為：
0 如果 },...,2,1{ mj ，  )(, uwk
jC


 )(, uwkC
m
umj C wkj )(1 , 否則
(4)
使用者的偏好已內含於各個協商問題的
歸屬函數中；因此，在定義軟體代理人的協商
策略中，均須同時考量整體滿意值及滿意度，
以避免各個協商問題的效益值或滿意度差異
太大而尚失了公平性。
當對手的提案比代理人目前或下一提案
之滿意度高，則代理人將接受此對手的提案。
假設代理人 k 之對手為 k’，若代理人 k 提出
協商方案 u 給代理人 k’， 隨後代理人 k’提
出協商方案 u’給代理人 k，而 *u 為代理人 k
下一將提出之協商方案，則理性的代理人 k將
接受代理人 k’提出之協商方案 u’，如果 u’
滿足
))()(())(( uuu kkkiC k   ， (5)
或
))()(())(( *uuu kkkiC k   ， (6)
則軟體代理人 k 將接受 u’作為最後的協議。
而限制式 ))(( kiC k  u 可使各個協商問題的最
低滿意度最大化，確保每個軟體代理人各個協
商問題的滿意度不致落差太大。
1.2 軟體代理人協商策略
協商過程的發展是由有關代理人之協商
策略所決定，這些策略決定代理人如何評估和
產生協商方。典型地，每一代理人一開始協商
都先提出其最理想之方案。如果方案不能被其
他代理人接受他們則讓步或找一替代方案，使
代理人能逐漸達成協議。
 讓步策略(Concession Strategy)
在現階段所有可行方案中，須逐一過濾其
他協商對象不同意的方案，當所有可行方案均
不為其他協商對象所接受，或找不到符合現階
段整體滿意值或滿意度的可行方案時，軟體代
理人須調降現行的整體滿意值或滿意度，以尋
求其他的可行方案進行協商，此即為讓步策
略。此策略之整體滿意值或現階段滿意度的降
低乃利用模糊限制式的放鬆來完成，因此讓步
後協商方案的集合係由整體滿意值減去讓步
值成為新的整體滿意值後，符合新整體滿意值
的所有方案集合。其定義如下：
定義 4：讓步後可行方案的集合(Set of
potential concession solutions)－令軟體
代理人 k在第 t次，門檻 ki提出的協商方案為
ut，則代理人 k在第(t+1)次，門檻 ki的所有可
行讓步方案集合 k
t
k
i 1u
C 定義為
   ,)()()(| 1111 rtktkkitCtk ktki   uuuuu  C 。(7)
軟體代理人的下一提案之讓步值 r是依據
軟體代理人本身的心理狀態與其他協商對象
的反應而決定。若只考慮軟體代理人的急迫性
P，而其他協商對象的讓步值為 Q，則彈性的讓
步策略之軟體代理人的讓步值必須滿足以下
模糊限制式
}),(ε,,|),,{(),,( RQP qprqprqpRQPC UUU  ，(8)
其中， ),(ε qp 為模糊述詞(Fuzzy predicate)，
而 ),(ε qpr 可以表示為  )(~)(~: QBPAC iii  意指
(imply) )(~ RCi ，而 iA
~ ， iB
~ 和 iC
~ 為 P, Q, R的語
言詞彙；因此，給定協商軟體代理人的急迫性
p、其他協商對象的讓步值 q，透過上述的關係
即可獲得協商軟體代理人的讓步值 r。本計畫
發展不同的讓步策略，其中固定讓步策略之代
理人每次的讓步值是依據代理人自訂固定的
急迫性調降；而彈性讓步策略之代理人每次的
讓步值是依據軟體代理人本身的急迫性與其
他協商對象的讓步值而決定。
 替換策略(Trade-off Strategy)
在協商的可行方案有很多時，如何在整體
滿意值及滿意度不變的情況下，軟體代理人降
低其某些協商問題的滿意度，來提昇其他協商
問題的滿意度，並試圖提出一個較為其他協商
對象所接受的可行方案
在協商的可行方案有很多時，如何在整體
滿意值及滿意度不變的情況下，軟體代理人降
低其某些協商問題的滿意度，來提昇其他協商
問題的滿意度，並試圖提出一個較為其他協商
對象所接受的可行方案；意即在不犠牲自己的
6案應用到目前的案件上和儲存修改後的方
案。其主要的好處包括：知識獲得(knowledge
acquisition)容易、知識維護容易、增加解題
效率、提昇解決方案的品質及增加使用者的接
受度等。
每一協商案件在本研究，被視為基本的分
散式模糊限制滿足問題(primitive DFCSP)。
在 CBR 中，過去每個不管是協商成功或失敗的
協商案件之協商過程與結果均被儲存著，利用
過去類似協商案件判斷其目前可能的協商過
程與結果。
為將協商案件特性予以抽象化，本研究以
模糊限制為基，將擷取類似協商案例之過程分
為下列步驟：
 步驟 1：對每一協商案例之特徵相似度，根
據特徵之成員函數，對應一模糊語言詞
彙。我們將每一協商案例之特徵相似度，
定義為一模糊語言詞彙的方式如下：
定 義 7 ： 模 糊 語 言 詞 彙 (The fuzzy
linguistic term)－在一協商案例E 中，
給定一特徵相似度
EX ，藉由已定義特徵之
成員函數，模糊語言詞彙 EY 可由下式獲得，
)( EE XY predicate ， (12)
其中 (.)predicateEY 是定量值轉成定性模
糊語言詞彙之轉換函數。
 步驟 2：依據在每一特徵之模糊語言詞彙
EY ，搜尋出大於或等於某一門檻 E 之協商
案例。於是在相似協商案例集合中之案
例，其案例中，每一特徵之模糊語言詞彙 EY
必須滿足大於或等於某一門檻 E 之限制。
意即
CYE
  。 (13)
 步驟 3：把已比對好之協商案例，擷取為候
選案例。
我們利用下列之評估函數來選擇最高相似
度之案例，作為調適目前之新案例。
  C wEE EE HTHT ),(),( ， (14)
其中 Ew 和 ),( HTE 分別為權重與目標案例
T 與歷史案例H 之特徵相似度。
2.2 模糊機率限制(Fuzzy Probability
Constraint)
在整個協商過程中，對手一連串的回應方
案，可以視為其特定行為的模式。因此，當連
續的回應方案所呈現的行為或事件滿足下列
模糊機率限制式，
Usually(X is F)， (15)
即可預測對手可能的行為模式。意即 X為 F的
機率是經常地－Prob(X is F) is Usually。
在(15)式中，X是物件，F是模糊限制式，「X
is F」為模糊事件(Fuzzy event)，「Usually」
為模糊機率(Fuzzy probability)[24]。因此(15)
式用來描述物件 X 為模糊限制式 F的可能機率
分配。於是，給定任何機率密度函數 p(x)及歸
屬函數 F(x)可得
 


R
Rx
xFxpdxxFxp )()()()(F}isProb{X 。(16)
(15)式中 Usually(X is F)對模糊事件「X is F」
提供了特定程度的意義，而類似這樣的模糊機
率限制必須有足夠特定程度以上的意義，因此
其正式的表示應為：
Usually(X is F)＞λ， (17)
其中， ]1,0[ 。於是(17)式意即(15)式的機
率必須大於 λ，λ 值則可視不同的應用或對
物件 X可能的機率分配而調整。
如果對手的行為模式滿足以上的模糊機率
限制式，表示該行為模式得以歸納為特定類別
的行為，對手的行為模式是可以掌握的。
定 義 8 ：對手的行為 (The opponent
behavior) －對手 k’的行為 k'ib 可被定義為一
連續的方案或讓步值 nm uu ,..., 所組成之 i 種行
為，其中 n > m 1。當連續的回應方案或讓
步值所呈現的行為或事件滿足下列模糊機率
限制式，
Usually( k'ib is
k'
j )， (18)
即可預測對手可能的行為模式。其中， k'i 為
對手 k’以模糊限制表示之第 j 種可能協商策
略。(18)式意即 k'ib 為 k'j 的機率是經常地－
Prob( k'ib is
k'
i ) is Usually。( k'ib is k'j )
為模糊事件，而 Usually 為模糊機率，其歸屬
函數定義如圖二，在本研究中λ值定為 0.7。
8果；若協商結果“失敗(Failure)”，則計算
其可能的失敗回合數，以供後續協商參考。第
12 至 14 行是判斷若可能的協商結果是“失
敗”，且其可能的失敗回合數低於本次協商所
能容忍的最高協商回合數，亦即在還沒到達本
次協商所能容忍的最高協商回合數前，協商結
果極可能失敗，因此本次協商可以不用再繼
續，以節省系統資源。第 15 至 17 行是判斷若
可能的協商結果是“成功”，而其成功的協商
回合數高於本次協商所能容忍的最高協商回
合數，亦即在到達本次協商所能容忍的最高協
商回合數後，協商還沒有結果，因此本次協商
也可以不用再繼續，以節省系統資源。第 18
至 25 行則是判斷在最後可能的協議結果可接
受的情況下，預測對手下回合可能的讓步型態
與協商方案，再利用模糊推理機制(Fuzzy
Inference Model)針對代理人本身預訂之協商
目標進行模糊推理，找出本身下一回合的協商
方案。所提架構中，模糊推理機制即延用前述
式(8)、(9)之模糊推理而推出本身下回合的協
商方案。
五、 結果與討論
隨著網際網路的快速發展，電子商務已成
為目前商業交易之重要範例，其應用亦成為軟
體代理人協商[6,11,15]中重要的研究領域。因
此本計畫以電子商城之買賣協商應用，藉發展
出之軟體代理人協商系統(其使用者介面和輸
出畫面，如圖五及圖六)，實驗模擬商城買方
和賣方之協商過程，驗證其實用性及有效性。
在模擬買方和賣方組成之協商實驗一
中，我們隨意自動產生五百筆協商案例當成測
試資料，其目的是比較所提代理人學習機制和
一般粗略學習方式之協商結果，驗證所提模式
的實用性和有效性。其中粗略學習對手行為的
方式係藉由常識、經驗和式(10)及(11)而獲得
對手可能偏好的方法。其協商場景描述如下：
 協商議題為價格和時間；
 買、賣雙方協商價格的範圍區間為
[1000-3000] ； 協 商 時 間 分 佈 在 區 間
[0-10]，使得買、賣雙方的協商價格與時
間是有相同(重疊)值存在；
 賣、雙方有關價格與時間之成員(效益)函
數，是從價格與時間的區間範圍亂數產生；
 首次提案之參與者為隨意產生，而買、賣
雙方為輪流出價；
 買方代理人使用彈性讓步策略，而急迫性
為 0.1，賣方代理人使用固定讓步策略，而
急迫性為 0.07；
 若賣方代理人所提學習機制時，分別以(1)
利己(2)雙贏(3)較快達成協商，作為協商
目標，比較所提學習機制和粗略學習之代
理人之過程與結果。
實驗之目的為驗證所提學習模式是否能
(1)達成對自己較有利的解；(2)得到整體代理
人之較佳和公平解；(3)加速達成軟體代理人
協議等目的。在實驗中，為衡量整體代理人較
佳之協議解，我們定義 JASV 為每一代理人之
整體滿意值(ASV)的和(Joint)；為衡量整體代
理人較公平之協議解，PASV 被定義為每一代理
人之整體滿意值(ASV)的積(Product)；而平均
協商次數則作為評估代理人是否能有效率地
達成協商的指標。表一呈現出所提學習機制和
具粗略學習(Superficial Learning)之代理人
協商的實驗結果。
從表一之協商結果，呈現所提學習機制可
得到下列成果：
 利己的解(Egoistic)：賣方代理人利用所
提學習機制比粗略學習方式可得到較有利
圖五 軟體代理人協商系統之使用者介面
圖六 軟體代理人系統之協商結果的輸出畫面
