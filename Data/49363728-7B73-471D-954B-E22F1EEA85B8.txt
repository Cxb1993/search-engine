2 
 
 
1. 研究背景： 
 目前的流程探勘中大多為運用事件紀錄檔，以找出工作流程模型。而一個流程紀錄檔（Process 
Log）中含有許多案例，每個案例是由一串作業依其先後發生之順序所組成。而流程探勘便是藉由
分析各案例中，所包含之作業的相互關連性，以建構出流程模型。 
而將分群的概念加到流程探勘中，其主要目的是對流程資料庫之案例進行分群，找出流程的差
異性及其特質。而在現有的流程分群演算法中，其步驟大致為：計算各案例內相關作業的距離，以判
斷兩兩案例之相似度，並進而分群。其中相似度的計算，往往是兩兩流程事件檔間進行反覆的試算，
建構出相似度分數表，然而這步驟，常會面臨到一個問題，即案例中所包含的作業過多，則計算就會
變的過於繁複，使得分群方法只能適用於較短之案例中，若要套用到較長的案例時，計算的複雜度會
呈現指數的成長，造成探勘的困難。而分群應用在流程探勘上還包含了一個缺點，即無法分析個別因
子所造成的影響。目前的分群法是將相關案例分群，並判斷每個群組之影響因子。但如要進一步判斷
個別因子會影響群組內之哪些步驟，目前則尚未有相關之分群法則進行研究。例如醫療流程可能受患
者之年齡，性別，檢查時間等數個因素影響。假設某一醫療流程運用已發展之流程分群法將將高齡，
女性，夜間患者分成一群。但若要進一步探討高齡會影響哪些醫療行為，以目前之分群法則不易協助
做出如此判斷。因此本文延伸出區塊式的分群演算法概念，希望能藉由各區間中不同案例族群之差異
性，以協助找出各案例族群不同之特質 
2. 研究目的： 
目前由Jung et al.所發展之流程分群演算法[1]，主要是將各模型中每個活動均納入考慮，並給
予各個活動間轉換順序的權重，其計算的複雜度為 2 2 2( log )O n m n n+ 。因此當流程中活動越多則複雜
度越高。因此本研究擬發展一區塊式分群法將各案例中共同作業不予計算，僅計算各案例間相異之作
業，並進而分群。 
如圖 1 所示為一現有的流程案例檔，若依據 Jung et al.所發展之流程分群演算法，則其概念圖
如下。 
 
圖 1 流程相似度計算圖 
此方法會計算流程的所有活動，對於有共同的作業而言，計算時不免出現重複的情形。若能簡
化所需計算的活動，將能降低計算的複雜度。因此本研究擬發展一區塊式分群法將各案例中共同作業
4 
 
然而此概念可能會面臨到兩個問題： 
A. 如何找出紀錄檔中的共同作業，進行流程原始檔的切割，因為共同作業的選擇會決定
了後續分群的結果。 
B. 在進行分群的步驟中，各區塊進行完分群後，如何建立關聯法則，將分群結果做連結。 
 
3. 文獻探討 
3.1 流程的分群概念 
在流程的分群概念中，可以分成兩種類型： 
I. 針對現有流程的分群： 
  在此類型中，所儲存的流程事件均為單一的流程圖[1][2]，在此兩篇文獻中所發展的
流程分群演算法，是架構在使用者可直接由圖中，了解個別流程的活動發生順序，以及活
動連結的 and、or 等資訊，因此依照每個單一事件的流程模型，給予流程發生順序的權重，
如圖 5示： 
 
圖5 流程權重圖 
 
在圖中可看到，不同活動間因給予的權重，而有相互關係的產生，可將此權重圖已表
1來加以表示： 
表 1 
Case (1、2) (1、3) (1、4) (2、3) (2、4) (3、4) 
Case NO. 1 0.5 0.33 1 0.5 1 
 
因此可由流程資料庫中，建立如表 1的權重表，在以此為依據計算兩兩流程間的相似
度，接著以凝聚式的階層分群（Agglomerative Hierarchical Clustering：AHC）演算法
進行分群的探勘，AHC 的優點在於，不用預測分群的目標群數，因此可針對不同群數情況
下的流程分群，進行分析。此種類型下，進行流程資料庫的分群其目的在於，整理流程資
料庫的資料，讓使用者可選擇目標部門的流程架構進行分析，並找出不同流程分群間的相
互關係[3]。 
 
II. 針對流程事件檔的分群： 
  在此類型中，流程事件檔的記錄，多半用符號來表示，每個流程事件檔只是單純的符
號組合，無從得知流程模型的概況[5][7]。因此，為了能對事件檔進行分群探勘，必需先
對Process Log檔進行屬性的定義，如活動的發生與否、活動的輸入及輸出、活動的負責
人及活動的發生時間等屬性，在定義完Process Log檔的屬性後，才能對Process Log檔進
行相似度的計算，並進行分群。亦可由Process Log檔中，找尋Feature Space(特徵空間)[4]，
此方法為在資料庫中，挑選活動發生率高的建立特徵空間，並過濾發生率低的活動，因其
發生率低，在進行分群時不會有直接的影響，如此僅針對Feature Space，進行流程相似
度的計算。在分群方面，文獻中提出了三種距離計算方式：Euclidean Distance、Hamming 
6 
 
數的成長，且目前的分群演算法，無法解析出個別因子對流程所造成的影響，因此為了能簡化流
程相似度的計算方式，以及讓使用者能了解流程中個別因子的影響，主要透過分割流程資料庫的
方式，進行流程分群，在以分群結果進行流程圖的建構。 
 
4.2 設計階段 
  本研究的主要內容為：將流程資料庫中的原始檔，進行區塊切割，在各區塊中進行分群，藉
由關聯性法則將各區塊分群結果做連結，得出整體性的分群結果，進行分析，而最後利用側影係
數對此方法進行評估。圖 6 為設計的架構圖，將設計階段分成七大區塊，如下圖所示。 
 
圖6計架構圖 
 
4.2.1 初始探勘 
在流程資料探勘的初期，為了能進行流程檔的切割，必須先以 Heuristic（啟發式演算法）找
出初始流程架構，Heuristic是一種流程探勘的方法，其主要特色在於可在短時間內探勘出流程圖，
並會自動刪除流程檔中偶而發生或是異常值的流程，讓流程圖較為簡化，但相對的也可能會剔除
重要的資訊。 
    Heuristic 會先以定義 1 的四個規則，建構出工作流程： 
1 
(1)                       
(2)         
(3)  #           
(4)  ||    
Heuristic
A B if and only if there is a trace line in W in which event A is directly followed by B
A B if and only if A B and not B A
A B if and only if not A B and not B A
A B if
>
→ > >
> >
定義 ：
      and only if both A B and B A> >
 
其中｛A、B｝為事件，W為流程資料檔。其中(2)定義｛A、B｝事件為依賴關係，(3)｛A、
B｝事件是非平行關係，(4)｛A、B｝事件是代表平行關係。 
接著利用定義 2 建構流程關聯性／次數表： 
2 
(1)       (  # )
(2)            (  # )
(3)         
Heuristic
the overall frequency of task A notation A
the frequency of task A directly preceded by another task B notation B A
the frequency of A directly followed by another tas
<
定義 ： 演算法
  (  # )
(4)               
    (  $ )      :  
   $  (#  -  # ) 
L
L
k B notation A B
a local metric that indicates the strength of the dependency relation between task A
and another task B notation A B the local metric is as follows
A B A B B A
>
→
→ = > > /  (#   #  1).
(5)           
 (  $ )
A B B A
a more global metric that indicates the strength of the dependency
relation notation A B
> + > +
→
 
建構出流程關聯性／次數表後，在以此表計算依賴程度分數(Dependency Score：DS)，利用 DS 制定
8 
 
生如圖 7 的分群區塊示意圖。 
 
圖7 分群區塊示意圖 
 
4.2.4 分群 
本研究方法利用凝聚式的階層分群（Agglomerative Hierarchical Clustering：AHC）演算法[1][9]
進行分群。AHC 方法的特色為，初始將資料點當成個別群集，在每一步驟合併相似度最高的為
一組群集，直到剩下一個群集為止。其定義 5 如下： 
 
5  :   
1 :    _ ( );  
2 :    _ ( )
3 :   ( )  
4 :  ( ,  )   _ _ ( )
5 :    ( ,  )
6 :  _ ( ,  ,  ,  )
7 :  _
AH C
P extract structure W C P
S com pute sim ilarity C
w hile n C k do
u v find nearest pair C
w m erge u v
update cluster C u v w
update sim ila
= =
=
<
=
=
定 義 演 算 法
　 　
　 　
　 　
　 　
　 　
　 　
　 　 ( ,  )
8 :   
rity S w
end w hile　 　
 
 
第一步為將每個流程視為單一分群，第二步開始計算每個流程間的相似度，k 表示分群數量，
第四及第五則是尋找兩個相似度最大的流程 ( ,  )u v ，並將其分為同一群，重複上述的步驟，更新
分群數量，直到達到目標的 k 群數量。 
    其中相似度的計算，代表了計算兩兩流程間的距離，依照參數的屬性，相似度的計算可以有
許多的變化，舉例如下： 
(1) Transition：以流程活動間轉換的邊為屬性，計算流程間的相似度。 
(2) Activity Attributes：依活動是否有發生為屬性，計算流程間相似度。 
(3) Originator Attributes：依負責或直行的人員為屬性，計算相似度。 
(4) Performance：依執行的時間為屬性，計算流程間相似度。 
 
    在本研究中為了能了解流程間，活動發生的相關性，以及流程活動順序的資料，因此選擇
Transition 為屬性，計算兩兩流程間的相似度[1][2]。其定義 6 如下： 
 
10 
 
因本研究中每個點代表流程，因此將距離的遠近視為相似度的大小，並採取群平均的方式找尋分
群結果。針對群平均，群集（ ,i jC C）的群集鄰近值以下列公式表示[8]，其中 im , jm 代表群集大小：
( , )
( , )
*
i
j
x c
y c
i j
i j
x y
C C
m m
∈
∈=
∑ 鄰近值
鄰近值 。 
 
4.2.5 群組連結 
在得出各區塊的分群結果後，可分析出各區塊中的個別因子影響，也可藉由定義 7 的關聯
性法則，進行分群連結，找尋整體性的分群結果。 
7 :  
(( ) ( )) (( ) ( ))
( ) ( )
Re
i i i j j i j j
i j
x y x y x y x y
x x
lationship
n
σ σ
σ σ
∩ ∪ ∩ ∩ ∪ ∩+
= ∑
定義 關聯性法則
 
以定義 7，可由下圖 9 加以說明： 
 
圖 4-2-7 關聯性法則示意圖 
其中n代表 ix 及 jx 分群項目集的總頻率， ix 為前區塊分群中的序列項目集， jx 為同一分群
中的第二項目集，計算當 ix 及 jx 的情況下發生 iy 及 jy 序列項目集的頻率，而將發生的頻率做加
總平均，即代表兩分群間的關聯性強度。對於個別區塊分群做出關聯性分數的計算後，藉由分數
高低的判定，將其合併為同一分群，再將這一分群視為同一群集，往後延伸直到得出整體的分群
結果。若在進行關聯性計算時，遇到分數相同的情況下，則將後方序列項目集，合併到前一區塊
的個別分群中，在往後計算直到找出不同分群為止。 
 
4.2.6 流程探勘 
在得出整體的分群結果後，將此結果在以 Heuristic 進行流程探勘，找出個別分群的流程架
構圖，並加以分析。 
 
12 
 
3 打 119 等 ambulance 前往醫院/自行前往醫院急診/掛號門診 15:30 － 16:00 13:45 23:10 
4 於急診處掛號 15:30 ? 17:00 14:10 23:46 
5 急診內科醫師看診，發現疑似腦中風 15:30 ? 17:00 14:10 23:46 
6 抽血時間 15:32 ? 17:20 14:15 00:00 
7 血液檢驗報告時間(CBC/DC.PT/APTT;生化) 16:44 13:30 17:05 15:24 00:26 
8 F/U EKG 15:32 8:30 17:10 14:37 00:39 
9 安排 Brain CT(查 PACE) 15:32;22:10 00:15 17:20 14:30 00:20 
10 安排 CXR － － 17:20 14:30 00:00 
11 致電神內 CR 照會 21:10 00:15 19:00 15:00 00:20 
12 神內 CR 診視，問病史並評估 NIHSS，診斷為急性血性中風 21:15 00:15 19:10 15:00 00:35 
13 若為三小時內發生，評估是否符合打 rtPA 21:15 00:20 19:10 15:00 00:35 
14 若符合，家屬閱讀打 rtPA 同意書及簽署 21:15 00:20 19:10 15:00 01:20 
15 量體重 21:15 00:20 19:10 15:00 01:20 
16 量血壓 22:55 00:15 19:30 16:00 01:20 
17 安排 ICU 床 23:30 02:00 20:55 16:20 01:20 
18 施打 rtPA 22:39 02:00 20:30 16:10 01:20 
19 轉床至 ICU 23:45 03:10 21:10 16:35 02:00 
20 前一小時每 15 分鐘量血壓，控制血壓小於 180/105mmHg 23:45 03:10 21:10 16:35 02:00 
21 24 小時再 F/U Brain CT 隔日 9:00   － 15:45 － 
22 給予口服 Aspirin － － 4 日後服用 ? 09:00 
23 F/U Duplex 隔日 F/U ? 3 日後 F/U  ? ? 
24 F/U MRI － ? 當日 20:15 ? 11:40 
25 病情穩定後轉一般病房 － － 隔日 4PM 13:00 17:00 
26 開始安排復健;復健科醫師會診 － － － － － 
27 至復健科進行復健 － － － － － 
28 病情穩定後出院 ? ? ? ? ? 
 
 根據表 3 的活動資料檔，將流程資料庫中的活動依照時間做排序，整理成如表 4 的資料檔。 
 
表 4 
Case                       Process                 
Case1 1 2 3 4 15 5 9 7 8 6 10 11 12 13 14 16 17 18 22 19 23 21 24 20 25 26 27
Case2 1 2 3 4 5 7 8 6 10 11 12 13 14 17 15 16 18 19 20 22 27       
Case3 3 4 5 6 7 8 10 11 15 12 13 14 16 17 18 19 20 22 23 27       
Case4 1 2 3 4 6 7 5 8 9 10 14 11 12 13 23 15 17 16 18 19 24 22 21 27    
Case5 1 2 3 4 5 8 9 7 10 11 12 13 14 6 15 17 16 18 19 20 21 22 24 23 27   
 
以表 4-3-2 為基礎，將流程資料檔轉為 XML 文件，在以 ProM 軟體中的 Heuristic 流程探勘
演算法，進行初始的流程探勘，得到如圖 11 的初始流程圖。 
14 
 
 以圖 11 基礎，將表 4 的活動資料表進行分組切割，可得到完整流程活動切割表，並透過 MATLAB
撰寫，給予各 Block 內流程活動的 Transition 權重以及計算活動的 Transition Similarity 並建構出流程
相似度分數表。 
 依據 Jung 所提出的相似度計算定義計算兩兩流程間的相似度，如圖 12 似度分數圖所示： 
 
 
圖 12 似度分數圖
 
在獲得流程相似度分數表後，將其另存為.txt 格式，使用 Cluster 3.0 軟體進行分群，將所建構出
的相似度分數表匯入 Cluster3.0 中，選擇 Cluster3.0 內的 AHC 階層式分群演算法進行分群，找出每個
Block 中的分群結果。接著利用 Java Treeview 將 Cluster3.0 所計算的結果以樹狀圖加以表示，若以
Cluster Block A 所包含的流程活動進行分群，可得到如圖 13 分群樹狀圖。 
 
 
圖 13Java Treeview 分群樹狀圖 
 由於 AHC 分群演算法之特性為不預設分群數量，因此本研究利用 ANOVA 統計分析，針對病況
16 
 
表 8 整體分群結果 
Cluster No. Case No. 
Cluster 1 3、5、6、16、18、29、47、48、49、50、53、54、56、57、58、59、60 
Cluster 2 15、19、20、21、23、24、27、31、32、36、37、40、41、43、44、45、46 
Cluster 3 2、4、22、25、26、34、39、42、51、52 
Cluster 4 1、7、8、10、11、12、13、17、30、33、35、38、55 
  
III. 結果評估 
依此分群結果與中風醫療流程資料庫中的病況轉換欄位，以組合方式結合各群集，並統計病況轉
換欄位。接著利用卡方檢定將各組合的病況改善與嚴重度之相關性進行檢定。 
獨立性檢定: 
在獨立性檢定中，為了配合檢定流程分群與病況轉換間的相關性，因此獨立性列聯表如表 9 所
示： 
表 9 獨立性列聯表 
 C1 C2 C3 C4 ∑
中  輕 7 0 4 0 11
重  輕 2 4 1 1 8
重  中 0 0 0 1 1
∑ 9 4 5 2 20
設定虛無假設與對立假設： 
ܪ଴：群體與病況改善相互獨立。 
ܪଵ：群體與病況改善有相關性。 
本研究在以組合方式 combine 各群集，運用統計檢定可得到結果如表 10 所示，檢定在群數為四
的組合群集情況下，存在群體與病況改善間有顯著關係。 
 
表 10 統計結果表 
統計檢定 
群數為四 
Cluster 1 & Cluster 3 組合 Cluster 2 & Cluster 4 組合 
獨立性 
p-value＝0.005864<α=0.05 所以不同的群體與病況改善存在差異性。 
病患病況轉好的機率：60.87% 病患病況轉好的機率：21.42% 
持平機率：39.13% 持平機率：78.5% 
 
齊一性檢定 
在齊一性檢定中，為了配合檢定流程分群與活動 17(施打 rtPA)是否有效的情況中，其在流程資料
庫中所佔比率上是否有差異性，因此本研究利用 ANOVA 統計分析，針對施打 rtPA 是否有效的欄位
屬性進行組內變異的分析，尋找群體可產生顯著差異的最低分群數量，以此決定所需切割之分群數
量。 
由群數二為起始分群數量，對各 Cluster Block 中的分群結果進行 ANOVA 分析並搜尋最低分群數
量，其結果如表 11 所示： 
病況轉換 Cluster No. 
18 
 
 在現實企業流程中，透過資料庫紀錄事件發生的流程紀錄檔有增加的趨勢，企業可藉由此資料庫
進行流程管理或企業模型之建構。而將分群概念加到流程探勘中，主要目的在於透過分群的方法簡化
流程探勘結果。然而日趨龐大的企業流程資料庫，因大量資訊的儲存，在透過分群的方式進行流程探
勘時，對於某部分相對少數之流程活動，常會因筆數較少或活動的順序差異不大，而無法輕易與其他
群體進行切割，變成隱性的流程差異。因此本研究提出一切割流程探勘結果之方式，消除重複性活動
對於分群結果的影響，以期找出潛藏的差異性流程。本研究使用 Petri Net 塑模初始企業流程模型，並
透過對初始模型的資料檔切割，將原始流程資料庫進行精簡的處理，在將此精簡後結果進行分群，透
過分區式的分群方式，放大各區塊中的流程差異性，在透過關聯性法則將各區塊進行連結，建構整體
分群結果，並以此進行流程探勘。 
 
 本研究具體成果如下所述： 
¾ 提出一流程區塊切割之方法，藉此消除計算重複性活動相似度的分數，造成流程差異性被稀釋的
問題點。 
¾ 提供一套關聯性法則，將各區塊中之分群進行關聯性連結，建構整體性分群，此結果可放大各區
塊中流程的差異性。 
¾ 將統計檢定應用在流程分析中，透過此方式評估分群結果的優劣。 
¾ 透過本研究之流程分群演算法，找出某國內中風急診流程資料庫中，造成病人病況轉換的可能潛
藏因素，提高病人的病況改善率。 
 
Reference 
 [1]   J. Jung and J. Bae,(2006) "Workflow Clustering Model Based on Process Similarity" In Proc. of 
Int’l Conf. Computer Science and Applications, LNCS, Springer-Verlag , Berlin, pp. 379-389. 
[2]   Jae-Yoon Jung, J. Bae, and Ling Liu, (2008) "Hierarchical Business Process Clustering" IEEE 
International Conference on Services Computing, pp.613-616 
[3]   C. Li, M. Reichert, and A. Wombacher. (2008) "Discovering Process Reference Models from Process 
Variants Using Clustering Techniques.”Technical Report TR-CTIT-08-30 Centre for Telematics and 
Information Technology, University of Twente, Enschede 
[4]   Valerie Guralnik, George Karypis(2000) " A Scalable Algorithm for Clustering Sequential" 
DataDepartment of Computer Science and Engineering/Army HPC Research Center University of 
Minnesota pp. 1–13 
[5]   Greco, G., Guzzo, A., Pontieri, L., Sacca, D. (2006) "Discovering expressive process models by 
clustering log traces". IEEE Transactions on Knowledge and Data Engineering 18(8), 1010-1027 
[6]    Ana Karla Alves de Medeiros, Antonella Guzzo, Gianluigi Greco, Wil M.P. van der Aalst, A.J.M.M. 
Weijters, Boudewijn F. van Dongen, and Domenico Sacc`a(2008)"Process Mining Based on 
Clustering: A Quest for Precision" pringer-Verlag Berlin Heidelberg, BPM Workshops, LNCS 4928, 
pp. 17–29 
[7]    M. Song, C.W. G unther, and W.M.P. van der Aalst (2008) "Trace Clustering in Process Mining" 
Eindhoven University of Technology pp.1-12. 
[8]    Hisashi Koga, Tetsuo Ishibashi, Toshinori Watanabe (2007) " Fast agglomerative hierarchical 
clustering algorithm using Locality-Sensitive Hashing" Knowl INF Syst 12(1): pp. 25–53  
國科會補助計畫衍生研發成果推廣資料表
日期:2011/09/21
國科會補助計畫
計畫名稱: 區塊式流程分群法之研究
計畫主持人: 歐陽超
計畫編號: 99-2221-E-011-032- 學門領域: 資訊系統
無研發成果推廣資料
其他成果 
(無法以量化表達之成
果如辦理學術活動、獲
得獎項、重要國際合
作、研究成果國際影響
力及其他協助產業技
術發展之具體效益事
項等，請以文字敘述填
列。) 
透過本研究之流程分群演算法，找出某國內中風急診流程資料庫中，造成病人
病況轉換的可能潛藏因素，提高病人的病況改善率。 
 成果項目 量化 名稱或內容性質簡述 
測驗工具(含質性與量性) 0  
課程/模組 0  
電腦及網路系統或工具 0  
教材 0  
舉辦之活動/競賽 0  
研討會/工作坊 0  
電子報、網站 0  
科 
教 
處 
計 
畫 
加 
填 
項 
目 計畫成果推廣之參與（閱聽）人數 0  
 
