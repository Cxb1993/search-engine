 2
速計算方式來取代之。一般為了節省計算
成本，一是往硬體方面做一般化計算平台
建置，別於超級電腦的高計算費用，如於
個人電腦叢集上導入平行計算演算法；一
是往軟體本身做可延展演算法之研究，對
於不同研究問題導入最適化架構，如 PCG
法於等向性問題及多重網格法高收斂性。
基於大量計算尺度模擬計算，延伸出兩項
對計算法可延展性(Scalability)的定義： 
(1) 實 施 延 展 性 (Implementation 
scalability)：意指單次疊代在平行電腦上的
可延展度，簡單說就是硬體對單次疊代時
間的加速性。 
(2) 演 算 延 展 性 (Algorithmic 
scalability)：意指多次疊代因演算法不同的
收斂性，簡單說就是演算法本身不隨模擬
尺度的計算增大，而改變其收斂性。 
代數多重網格法是近年快速興起的大
型稀疏陣解法，最早是在 1980 年代[1]提
出，隨即引起很多學術研究者的興趣。1980
及 1990 年代[2][3][4]陸續有相關的研究出
現。近年來，由於分析問題的日益複雜化，
導致於更大量計算尺度的模擬，使得包括
典型的代數多重網格法及其他不同類型者
的研究又再度興起。而為了有效應用代數
多重網格法之高度演算延展性，相關於研
究代數多重網格法之問題應用特質，便顯
得特為重要且優先。 
覆晶封裝技術是目前為止最節省空
間、最高密度化的構裝方式覆晶封裝技
術，利用以凸塊取代金線作為晶片與基板
接合的優勢，可容納更多訊號輸出腳數和
極佳之散熱效果。最早起源於 1960年代美
國 IBM公司所發展的 C4技術，依序將已
作好錫球晶片倒置於印刷基板上貼合。其
次，封膠由基板與晶片間之空隙充填流
入，最後封膠冷卻後固化而完成製程。本
研究所模擬的便是其中底部填膠至固化之
過程。其中如何準確地描述封膠和其他材
料間的表面現象，是極重要的關鍵。過長
之充填時間將使得部分封膠提早固化，不
僅使得產品品質受到影響，也會造成製程
上之延遲。 
在本研究中，將依序引入代數多重網
格法於熱傳導問題、三維衣架型押出成型
及覆晶封裝模擬程式之撰寫。藉由代數多
重網格法強健的數值收斂性，加速整體分
析之計算效率，並進一步可利用於多種三
維案例之模擬計算加速。 
 
三、研究方法 
共位體心有限體積法 
本研究採用共位體心有限體程法
(collocated cell-centered Finite Volume 
Method)的 3維計算方式。共位體心有限體
積法基本觀念是要將所要計算的區域，細
切為一組包含離散節點的網格。每個網格
空間都被視為一個小的控制體積(control 
volume)，而對於每個控制體積內部而言，
輸送量必須遵守統御方程式而守恆。與早
期的有限體積法(Finite Volume Method)相
比，此法最大的差異在於將所有的變數都
安排於網格中心的計算方式，如此可以只
產生一組網格，而避免交錯式網格
(staggered grid)所需面對複雜繁瑣的邊界
差分技巧，經 Yang[6]的研究與整合，可大
幅提昇整個演算法之簡潔性及適用性。 
覆晶封裝底部填膠 
覆晶封裝底部充填的封膠是屬於熱固
性材料，在進行封裝製程時，所涉及的理
論範圍非常的廣，必需考慮硬化反應行為
的動力學方程式、封膠黏度、轉化率及溫
度關係的本質方程式，以及材料的表面張
力與接觸角變化，如此才能正確地預測充
填與硬化過程中材料系統的變數，如充填
時間、波前形狀、壓力、轉化率…等的行
為變化。封膠流動中的速度場、壓力場和
溫度場可用下列簡化後之統御方程式描
述： 
連續方程式： 
0=⋅∇ vρ  
動量方程式： 
( ) ( ) σηρρ fγvvv +−∇=⋅∇−⋅∇+∂
∂ p
t
&  
能量方程式：   
 4
下一層級 kk C=Ω +1 ，並找出延拓運算子所
需要之內插變數集合 kki CC ⊂ ，延拓步驟
便如下進行： 
Fi
Ci
if
if
ew
e
eI
iCj
C
jij
C
i
i
CF
C ∈
∈
⎪⎩
⎪⎨
⎧
= ∑
∈
)(  
ijw 表示延拓之權重值，詳細之粗化步驟及
權重值定義可參閱文獻[3]。 
 當完成準備期之元素定義，便開始求
解期之粗網格修正，常見為 V型多重網格
法求解循環如下： 
 
 
在此分別在每次粗網格修正前後各施以
1µ 及 2µ 次平滑化，一般以 Gauss- Seidel
為主。 
 
四、結果與討論 
 首先建立數個可判斷演算法之準則，
在代數多重網格法中，除了常見之疊代次
數、殘數規範及計算時間外，為了估計配
置多重網格法所使用之記憶體大小，加入
運算子、網格複雜度及相關時間應用，茲
定義如下[10]： 
 
ninner 計算疊代次數 
L2 norm 本研究中定義為殘數之 norm−2l  
telapsed 計算 CPU時間 
σA 運算子複雜度，定義為 
σA 素總數最細層級之矩陣非零元
素總數所有層級之矩陣非零元=
σΩ 網格複雜度，定義為 
σΩ  最細層級之變數總數
所有層級之變數總數=   
ρ 漸近 V-cycle間收斂因子，定義為 
ρ  innern
norm
norm 1)( −
−= 2
2
初始之殘數之
計算後殘數之
l
l
所有之計算例題皆在 AMD Opteron 
242 上以單 CPU執行(頻率 1.6 GHz)，記
憶體空間 2G bytes。數值方法離散後皆為
求解對稱稀疏矩陣，使用 DILU 與 AMG
為 CG 之預處理(Precondition)進行比較。
收斂判斷準則乃是依據下式： 
innernn
nn
n
n
nn
res
res =−
−=
−
−  ,minmax
max 1
1 φφ
φφ
 
 
程式驗證 
首先進行程式正確性之驗證，本研究
所開發之代數多重網格法之基本理論源於
AMG1R5，所以在此將以其 Fortran 77原
始碼，進行程式正確性比對，驗證之例題
取於文獻[3]，並採用相同之有限差分數值
離散，在一單位方形內進行等向切割使得
計算尺度之幾何網格大小為
512
1=h ，分別
驗證對稱及非對稱問題之結果正確性： 
1. 拉普拉斯運算子 
在第一個驗證例題中，將使用拉普拉
斯運算子作為驗證，採用如下不同之離散
模板(stencil)： 
⎥⎥
⎥
⎦
⎤
⎢⎢
⎢
⎣
⎡
−−
−−
⎥⎥
⎥
⎦
⎤
⎢⎢
⎢
⎣
⎡
−
−−
−
11
4
11
2
1)2(   ,
1
141
1
1)1( 22 hh
⎥⎥
⎥
⎦
⎤
⎢⎢
⎢
⎣
⎡
−−−
−−
−−−
⎥⎥
⎥
⎦
⎤
⎢⎢
⎢
⎣
⎡
−−−
−−
−−−
141
4204
141
20
1)4(,
111
181
111
8
1)3( 22 hh
 
從表(1)的結果中可發現，本研究基於
典型代數多重網格架構建立之 CAMG 與
AMG1R5的結果完全符合。而觀察相關準
V-cycle疊代循環： ),( kkkMV bx  
若 Mk = ，求解 MMM bxA = ；若 Mk ≠ 則
 (a) 在 kkk bxA = 上平滑運算 1µ 次 
 (b) 進行粗網格修正： 
  i. 限制運算：令 01 =+kx ，而殘數
)(11 kkkkk
k xAbIb −= ++  
  ii. 進 行 層 級 1+k 上 之
),( 111 +++ kkkMV bx  
  iii. 內 插 運 算 及 誤 差 修 正 ：
kkkkk
k
k exxxIe +←= ++   ,11  
 (c) 在 kkk bxA = 上平滑運算 2µ 次 
111 bxA =Smooth
)( 11121
2 xAbIb −=
222 bxA =Smooth
)( 22232
3 xAbIb −=
333 bxA =Smooth
)( 33343
4 xAbIb −=
qqq bAx 1)( −=
111 exx +←
21
2
1 xIe =
222 exx +←
32
3
2 xIe =
333 exx +←
43
4
3 xIe =
111 bxA =Smooth
222 bxA =Smooth
333 bxA =Smooth
 6
時，整個問題的求解便為擴散所支配，因
此結果與前述之拉普拉斯運子相當接近。
而隨著 k值減小，漸漸轉為對流項所支配
時，代數多重網格法便會自行抓取特徵方
向之強關聯，而使粗化網格之層級隨著流
場特徵線變動，因此使得複雜度及計算時
間拉長(見圖(6))。 
 
熱傳導問題 
首先考慮如下熱傳導問題之求解： 
( ) 0=∇⋅∇ Tk  
計算幾何為一二維之單位方形，含計算元
素 =2n 262144個，施以固定之牆壁面邊界
條件。改變不同之熱傳導係數，並設定一
可變動之參數 =c 0.001, 1, 1000 之計算測
試，茲將 =c 1000 之熱傳導係數等位線分
布示意如圖(7)。其中問題 1可假想為工業
上常見內嵌物件兩材質間之熱傳導，問題
2 及 3 雖然可能偏離實際之情況，但可看
出 AMG 在不需要任何調整下，仍可有不
錯之計算效益，具數值上測試之意義。所
有問題之判斷收斂準則，為計算後之 L2 
norm小於 10-8便停止計算。 
從結果中表(4)~(6)發現，本研究建立
之 CAMG/CG之計算結果，較單層疊代法
可獲得非常理想之計算效益加速比。而觀
察收斂曲線變化圖(8)~(10)，可看出單層網
格法(PCG)只能在最初幾次的疊代中消去
誤差，在達到某一程度後會有減緩或跳動
之情況，特別是尺度越大或問題越不易求
解下顯得更明顯；而搭配代數多重網格法
為前置處理，則能兼具有多重網格快速消
去平滑誤差的能力及單層網格法之收斂
性，使維持等速的收斂速率，有效地降低
疊代計算量與計算時間。 
 
衣架型押出成型 
薄膜及薄板押出成型是目前最具應用
價值的押出成型形式，通常使用衣架形模
頭進行加工，在此將探討代數多重網格法
與傳統單層疊代法，求解壓力離散式上收
斂速率的差異性。此衣架形押出模具如圖
(11)所示，進口處高度及寬度均為 2 cm，
出口處高度為 0.1 cm，寬度則為 80 cm。
所使用之材料為 PC，使用修正型 Cross模
式做為其本質方程式，不同溫度下 PC 材
料之黏度-剪切率曲線如圖(12)所示。材料
參數則如表(7)所示。 
給定入口熔膠溫度為 533 K，入口速
度為 4 cm/s，模溫則為 528 K。使用共
161,100個六面體元素網格進行計算，速度
場及溫度場的求解則使用 PBiCGStab進行
求解，內部收斂判斷準則為相對 L2 norm 
(計算後除以初始)小於 10-2，而外部收斂成
立於最大值小於 10-6。 
由結果圖(13)~(17)中，可知流線的分
佈相當均勻，沒有任何漩渦迴流產生；進
口速度在 4 cm/s的流速下，出口之速度分
布都非常均一，達到衣架型押出模具設計
的要求。由於出口區的厚度僅為 0.1cm，
因此熔膠在流經模具 0.1cm厚度區域時，
溫度已漸被降至模溫附近，使得出口之熔
膠具有均一之物理性質。整理代數多重網
格於圖(18)、(19)，可發現對此三維押出成
型問題之加速效果，在內部矩陣疊代計算
中，可大幅減少疊代次數，加速計算時間。
整體而言，可較傳統單層疊代法達到 4.83
倍之加速效果，保有很好之計算效益。 
 
覆晶封裝底部填膠 
利用前述的理論及數值分析方法，模
擬覆晶封裝的底部充填封膠製程，使用的
晶片幾何形狀如圖(20)所示，晶片的長和
寬皆為 0.7cm，高度為 0.08cm，底部間隙
高度為 0.01cm，晶片的底部有 401 顆錫
球。為節省計算網格及計算時間，錫球的
部份以圓柱來近似，其半徑為 0.008cm，
高度為 0.01cm，錫球中心至相鄰錫球中心
的間距為 0.025cm。計算網格共包含 94982
個六面體元素，129350個節點。液狀封裝
材料使用 Dexter 公司生產的 Hysol 
FP4510，材料的黏度模式如表(8)所示。材
料的硬化反應模式參數及基本性質如表(9)
及表(10)所示。同樣地，將探討代數多重
網格法與傳統單層疊代法，求解壓力離散
式上收斂速率的差異性。 
在此討論動態接觸角及 3維厚度方向
對流動時間的影響：從表(11)及圖(21)中實
驗值、2.5D靜態接觸角與 3D動態接觸角
之結果比較。我們可以發現文獻上 2.5D與
3D在預測初期充填時間上，皆有不錯之結
果。但是從充填流動分布圖(22)的比較
 8
Problem Method ninner telased σA σΩ ρ 
AMG1R5 10 3.92  2.20 1.67 0.065 
CAMG 10 3.90  2.20 1.67 0.065 1 
CAMG/CG 7 3.25  2.20 1.67 0.035 
AMG1R5 13 4.77  2.20 1.67 0.110 
CAMG 13 4.76  2.20 1.67 0.110 2 
CAMG/CG 9 4.25  2.20 1.67 0.046 
AMG1R5 15 4.90  1.33 1.33 0.142 
CAMG 15 4.89  1.33 1.33 0.142 3 
CAMG/CG 10 4.29  1.33 1.33 0.082 
AMG1R5 15 4.90  1.33 1.33 0.144 
CAMG 15 4.89  1.33 1.33 0.144 4 
CAMG/CG 10 4.34  1.33 1.33 0.085 
表(1) 拉普拉斯運算子計算結果 
P1 P2 
P3 P4 
圖(1) P1~P4, 
64
1=h 下粗化前四層級結果 
 
Problem Method ninner telapsed σA σΩ ρ 
    AMG1R5 12 4.50  2.80 1.99 0.054 
  0.001 CAMG 12 4.49  2.80 1.99 0.054 
    CAMG/CG 10 4.35  2.80 1.99 0.027 
    AMG1R5 12 5.06  2.97 1.97 0.071 
  0.01 CAMG 12 5.05  2.97 1.97 0.071 
    CAMG/CG 9 4.66  2.97 1.97 0.044 
    AMG1R5 11 6.59  3.49 1.87 0.084 
  0.1 CAMG 11 6.56  3.49 1.87 0.084 
    CAMG/CG 9 6.12  3.49 1.87 0.049 
    AMG1R5 11 5.11  2.20 1.67 0.082 
  0.5 CAMG 11 5.10  2.20 1.67 0.082 
    CAMG/CG 9 4.82  2.20 1.67 0.048 
    AMG1R5 10 3.92  2.20 1.67 0.065 
5 1 CAMG 10 3.90  2.20 1.67 0.065 
    CAMG/CG 7 3.25  2.20 1.67 0.035 
   AMG1R5 11 4.99  2.20 1.67 0.081 
 2 CAMG 11 4.98  2.20 1.67 0.081 
   CAMG/CG 9 4.72  2.20 1.67 0.040 
   AMG1R5 11 6.50  3.46 1.87 0.083 
 10 CAMG 11 6.49  3.46 1.87 0.083 
   CAMG/CG 9 6.07  3.46 1.87 0.049 
   AMG1R5 12 5.07  2.96 1.97 0.070 
 100 CAMG 12 5.04  2.96 1.97 0.070 
   CAMG/CG 9 4.65  2.96 1.97 0.043 
   AMG1R5 12 4.50  2.81 1.99 0.055 
 1000 CAMG 12 4.49  2.81 1.99 0.055 
   CAMG/CG 10 4.35  2.81 1.99 0.026 
AMG1R5 11 4.89  2.20 1.67 0.072 
CAMG 11 4.88  2.20 1.67 0.072 6 
CAMG/CG 8 4.30  2.20 1.67 0.040 
AMG1R5 17 6.73  2.24 1.68 0.138 
CAMG 17 6.70  2.24 1.68 0.138 7 
CAMG/CG 12 5.73  2.24 1.68 0.070 
表(2) 非等向性運算子及跳動係數計算結果 
  
ε=1000 ε=0.001 
  
ε=100 ε=0.01 
  
ε=10 ε=0.1 
  
ε=2.0 ε=0.5 
圖(2) P5 
64
1=h 下粗化前四層級結果 
 10
 
  
25.0)5.0  ,5.0(0 
0.1
)1(
otherwise
yxMaxifc
k
≤−−≤
⎩⎨
⎧=
 
)1( 1)2( yxck −−+=
 
 
0.10.5
5.00.0
0.10.5
5.00.0
,
,
,
,
0.10.5 
0.10.5 
5.00.0 
5.00.0 0.1
)3(
2
3
≤<
≤≤
≤<
≤≤
≤<
≤<
≤≤
≤≤
⎪⎪⎩
⎪⎪⎨
⎧
=
y
y
y
y
xif
xif
xif
xif
c
c
c
k
 
圖(7) =c 1000之熱傳導係數等位線示意圖 
 
Order Method ninner telapsed σA σΩ ρ Speedup 
c=0.001 DILU/CG 871 150.59       1.00 
  CAMG/CG 8 3.57 2.23 1.67 0.0193 42.16 
c=1 DILU/CG 843 146.09       1.00 
  CAMG/CG 7 3.21 2.20 1.67 0.0158 45.55 
c=1000 DILU/CG 1006 174.58       1.00 
  CAMG/CG 8 3.96 2.24 1.68 0.0273 44.04 
 
表(4) 熱傳導問題 1計算結果 
 
 
圖(8) 熱傳導問題 1- =c 1000收斂曲線圖 
 
Order Method ninner telapsed σA σΩ ρ Speedup
c=0.001 DILU/CG 843 146.06       1.00 
  CAMG/CG 7 3.34  2.20 1.67 0.0158 43.76 
c=1 DILU/CG 843 146.09       1.00 
  CAMG/CG 7 3.21  2.20 1.67 0.0158 45.55 
c=1000 DILU/CG 1137 197.36       1.00 
  CAMG/CG 10 4.19  2.20 1.67 0.0296 47.10 
表(5) 熱傳導問題 2計算結果 
 
 
圖(9) 熱傳導問題 2- =c 1000收斂曲線圖 
 
Order Method ninner telapsed σA σΩ ρ Speedup
c=0.001 DILU/CG 898 154.61       1.00 
  CAMG/CG 7 3.39  2.23 1.68 0.0178 45.54 
c=1 DILU/CG 843 146.09       1.00 
  CAMG/CG 7 3.21  2.20 1.67 0.0158 45.55 
c=1000 DILU/CG 1361 235.38       1.00 
  CAMG/CG 5 2.85  2.23 1.68 0.0025 82.74 
 
表(6) 熱傳導問題 3計算結果 
 
 
圖(10) 熱傳導問題 3- =c 1000收斂曲線圖 
 
 
圖(11) 衣架形押出模具之設計圖 
c=1000
1.E-08
1.E-07
1.E-06
1.E-05
1.E-04
1.E-03
1.E-02
1.E-01
1.E+00
1.E+01
1.E+02
1.E+03
1.E+04
0 100 200 300 400 500 600 700 800 900 1000
Iteration No.
L2
-n
or
m
PCG
CAMG/CG
CAMG/CG
1.E-10
1.E-07
1.E-04
1.E-01
1.E+02
0 3 6 9 12 15
c=1000
1.E-09
1.E-08
1.E-07
1.E-06
1.E-05
1.E-04
1.E-03
1.E-02
1.E-01
1.E+00
1.E+01
1.E+02
1.E+03
1.E+04
0 100 200 300 400 500 600 700 800 900 1000 1100 1200
Iteration No.
L2
-n
or
m
PCG
CAMG/CG
CAMG/CG
1.E-10
1.E-07
1.E-04
1.E-01
1.E+02
0 5 10 15
c=1000
1.E-04
1.E-03
1.E-02
1.E-01
1.E+00
1.E+01
1.E+02
1.E+03
1.E+04
0 100 200 300 400 500 600 700 800 900 1000 1100 1200 1300
Iteration No.
L2
-n
or
m
PCG
CAMG/CG
CAMG/CG
1.E-05
1.E+00
1.E+05
1.E+10
0 5 10 15
