 2
approaching and berthing control system 
that exclusively uses the image processing 
technique in providing the guidance 
information is successfully designed and 
implemented. 
 
二、文獻回顧及簡介 
本研究是延續前兩期工作項目而加
以改進，第一期工作是利用影像處理技
術擷取目標物，先經由色彩空間轉換，
將RGB[紅(Red)、綠(Green)、藍(Blue)]
空間轉成 HSV[ 色調 (Hue) 、飽和度
(Saturation)、色深度(Value)]空間，再利
用H、S擷取目標物顏色，經由中值濾波
器與型態學閉合，擷取出目標物。影像
處理結果經傳送至船舶控制器後，船艉
推進器做出相對應的動作，來達成
Leading Line Tracking(疊標導航)目標
(海洋大學，2007)[1]。 
    第二期工作，則將原有自動進港系
統結合自動靠泊模式。先是提升進港時
由影像估測船與岸壁距離之精確度，亦
針對有關目標物鎖定方面缺失，改善進
港時目標物未鎖定或出鏡之情況，及解
決目標物之水中倒影對影像處理所造成
之困擾。靠泊過程係利用岸邊疊標導航
之設置與影像處理技術鎖定岸邊疊標，
計算出航向角修正量與距離估測，並透
過內模式控制器判斷是否抵達待泊區，
再啟動靠泊模式進行靠泊動作(海洋大
學，2008)[2]。 
    但是在執行靠泊操作時，因仍需用
到 TCM2 與 DGPS，因此於第二期報告
中提出後續可考慮使用影像處理方式，
計算出船艏之航向角以取代 TCM2。為
了可全程用影像處理來判斷，所本階段
旨在取代 TCM2 和 DGPS 以影像處理技
術為主提供相對方位角及距離資訊，進
而達到完全以影像處理為基礎，完成船
舶進港及靠泊控制自動化。 
    參考其他姿態判定文獻時發現，亦
有利用船上多個GPS接收機進行姿態角
判定，例如 G. Lu, G. Lachapelle, M.E. 
Cannon and B.Vogel[3] 主 要 是 利 用
Multi-Antenna GPS 接 收 機 來 求 取
Heading、Pitch、Roll 參數。船艏向資料
為船上所配備之 Sperry Mark 23 Model 
C 之 Gyrocompass 電羅經所量測之
Heading，再與以四個 GPS 接收機為架
構來進行姿態角判定系統進行比較分
析。G. Lachapella, M. E. Cannon, G. Lu, 
and B, Loucarevic[4]姿態判定是運用
Differential carrier phase 方式獨立採用
每筆資料進行分析，載具上之 Carrier 
phase ambiguities(即 N 週波未定數)是利
用已知天線距離與其結合載體間之關係
來解算的。GPS 推估姿態參數之精確性
與否，其實取決於很多參數，其中最重
要 的 是 carrier phase observables 、
mulipath 及正確的天線位置。 
     隨著科技的進步，近年來，在影像
處理用於載具方面的相關應用也越來越
廣泛，剛開始是做一些影像處理計算，
像是 Alison[5]就曾利用影像處理技術，
建立一套視覺導引系統，應用於模型飛
機的飛行控制。Rafael[6]利用固定式
CCD 架設於實驗場地上方，利用座標轉
換之理論，控制實驗場地內載體之移動
軌跡。Tang[7]提出利用雙眼 CCD，透過
座標轉換及三角函數的運算，得到目標
物在三維空間上的真實位置。蔡(東華大
學，2002)[8]是以視覺為主的智慧型車輛
導航之研究。本案就是為了達成完全以
視覺導航而提出的影像處理解決方法。 
 
三、系統架構及工作流程 
(一) 硬體佈置及軟體環境 
本研究系統架構是延續之前研究採
用之架構，詳見文獻黃[2]、康[11]。實
驗是以三部電腦運作，一台為Host PC，
主要做影像處理及控制命令下達，一台
為Target PC執行Host PC所下達之控制
命令，一台為架設於岸上的影像處理電
 4
靠泊影像處理流程，如圖六 A 所示，及
b.靠泊時影像處理技術細節。 
a.靠泊影像處理流程： 
    由岸上 CCD 擷取影像，經預先設計
之靠泊影像處理技術，獲取影像中船舶
航向角和離岸距離資訊。若影像計算之
航向資訊，在船舶靠泊過程中，落在所
訂定之正確範圍內，則傳輸航向資訊至
船上。當船舶到達待泊區後，岸上電腦
會不間斷的傳輸離岸資訊至船上，其兩
者資訊經控制器輸出後，進行艏、艉推
進器之電壓分配。 
圖六 A 靠泊時影像處理流程圖 
b.靠泊時影像處理技術細節： 
靠泊影像處理技術，如圖六 B 所
示。將岸上 CCD 取得之彩色(RGB)影
像，轉換成 HSV 之 S(飽和度)值，如圖
七所示。 
影像擷取IEEE 1394 影像選取偵測區影像轉成HSV之S成分
Pa
tte
rn
 2 Pattern 3Patter
n 1
1.2 3.8
建立影像比例尺
否
圖六 B 靠泊時影像處理技術 
首先建立影像中比例尺，如圖八所
示。再由事先選取比對區域，分別建立
船艏、艉疊標辨識物之 Template，如圖
九 所 示 ， 岸 上 藍 色 帆 布 疊 標 之
Template，如圖十所示。靠泊過程經影
像比對後，從影像之幾何關係，可得到
影像計算之η角度，再經本文所提之航
向角公式，可得到靠泊時航向角，如圖
十一所示。與離岸距離資訊，如圖十二
所示。經判定屬於船舶正確的轉向範圍
內，則將航向資訊輸出至船上。 
 
  圖七取HSV之S  圖八 建立影像比例尺成分 
 
圖九 船艏、艉疊標     圖十 岸上藍色帆布 
      Template                Template 
          
       圖十一 影像計算之η角度 
   
       圖十二 船艏到岸壁之距離 
2.靠泊導航法則。導航方向角之計算採
用之航向角公式，如下(1)公式所示。 
    航向角=方位角-夾角度(η)    (1) 
    方位角可由 TCM2 或是其它方式，
事先測量得知。例如船舶離開岸壁時之
航向角度值為 320 度，如圖十三所示。
本研究採用此值當作是固定常數，乃預
先由 TCM2 測得。再利用藍色疊標之幾
何中心與黃色疊標之幾何中心連線，在
與以黃色疊標 X、Y pixels 值為基準，X 
pixels 值加上 10(此值可以任意調整，但
不可超出 CCD 畫素範圍)，Y pixels 值則
維持不變，以此新 X、Y pixels 值來當作
 6
由 47.73 度縮減為 17.806 度。也就是以
CCD 為中心，左右視角各 9 度，因此訂
定橫坐標值為正負 13 度，此角度值為實
船試驗測試結果。當 1θ 值為負時，表示
下疊標在船艏左側；反之當 1θ 為正時表
示下疊標在船艏右側，當 1θ 為零度時表
示船艏正對著下疊標。在此使用三個歸
屬函數分佈用以表示上述三種情形。 
 
圖十四 fuzzy 進港控制器 
 
          圖十五 1θ 之歸屬函數 
    訂定 2θ 歸屬函數分佈如圖十六所
示。圖中縱座標表示權重值，最大值為
1。橫坐標表示下疊標與上疊標之夾角，
由事先實驗結果得知 2θ 值約落在正負 4
度，不過由於實驗過程當中，有時系統
未正確鎖定上下疊標而導致 2θ 並未落
在此範圍，此結果將會導致系統無法正
常運作，故最後設定值落在正負 7 度。 
    當 2θ 為負時表示船舶在航道右
側，而 2θ 為正時表示船舶在航道左側，
當 2θ 為零時表示船舶位於航道上。因此
使用三種歸屬函數表示上述三種情形。 
 
 
圖十六 2θ 之歸屬函數 
    最後定義輸出舵角之歸屬函數如圖
十七所示。縱座標為權重值，最大值為
1。橫坐標為輸出舵角，介於正負 35 度。
由於前述之 1θ 與 2θ 各有三種歸屬函
數，配對後將有九種情形，故輸出舵角
訂定九種歸屬函數分佈。因此訂定模糊
規則如表 1-1 所示。 
 
       圖十七輸出舵角之歸屬函數 
 theta1_n theta1_m theta1_p 
theta2_n n_verylarg
e 
n_large n_slightlarge
theta2_m n_morelar
ge 
medium p_morelarge
theta2_p p_slightlar
ge 
p_large p_verylarge 
表 1-1 進港控制器模糊規則表 
 
(2)靠泊控制器 
    靠泊控制過程中需利用艏、艉推進
器的推力分配，來達到船舶側移運動的
效果。由參考文獻[10]得知，當艏推器
角度為 50 度，對應之艉推器角度為 29.2
度，動力分配艉推力為艏推力之 0.7366
倍。 
    依據海洋大學小艇碼頭實驗場合，
經測量判定之後，得知岸壁之參考航向
為 230 度。實驗過程中是利用岸上電腦
影像處理所計算的航向角回授船舶姿態
航向，再與參考航向 230 度相減之值，
所得到航向誤差量來做為靠泊控制器輸
入之一，另一個輸入為船舶與停泊點距
離資訊。 
    接著設計一組雙輸入、雙輸出之
Fuzzy 靠泊控制器，如圖十八所示。輸
入訊號分別為船舶航向與參考航向之差
(head_e) 與船舶與停泊點距離資訊
(distance)，兩輸出訊號則分別為艏、艉
推進器之輸出電壓(bow_v、stern_v) ，
以下分別介紹兩輸入之歸屬函數。 
 8
方法為將船舶開至離岸距離 85 公尺
處，在航道線之左側進行船舶追跡與靠
泊之實驗。 
 
1.內模式控制結果分析 
在圖二十二顯示船舶自航道左側進
行追跡及靠泊過程之軌跡圖，圖中紅線
虛線表示航道線，藍線表式船舶移動軌
跡，航向角修正量( 21 θθψ k+=Δ )調整
5=k 。圖中顯示船舶離岸 30 公尺處進
行轉向靠泊。 
40 50 60 70 80 90
10
20
30
40
50
60
70
80
90
100
110
120
船舶移動軌跡姿態
X-axis(m)
Y
-a
xi
s(
m
)
 
 
船舶移動軌跡
航道線
 
圖二十二 IMC 控制器之船舶姿態軌跡 
圖二十三分別顯示圖 1θ 、 2θ 及航
向角修正量ψ ，在圖中航向角修正量
( 21 θθψ k+= )為紅色線， 2θk 為圖中
綠色線， 1θ 為藍色線。因實驗在航道線
左側，所以用舵量開始出現正變化，用
舵量維持在正負 10 以內，在 t=89 秒後
船舶開始進行靠泊程序。      
0 50 100 150
-25
-20
-15
-10
-5
0
5
10
進港時航向角修正量
Time (sec)
D
eg
re
e 
(d
eg
)
 
 theta1
theta2
航向修正量
 
圖二十三 航向角修正量(k=5) 
圖二十四為靠泊階段艏、艉推進器
之電壓變化情形。圖中顯示，當影像航
向大於 230 度時，艏推器電壓增加，反
之遞減，使船舶與岸壁保持平行之航
向。當影像中船舶離岸距離減少，艉推
器電壓隨之減少，反之增加，使船舶靠
泊時期間船速度較慢。圖二十四在 t=87
秒與 t=115 影像航向角大於 230 度，艏
推器電壓增加，t=113 秒與 t=132 秒影像
航向角修正至 230 度內，艏推器電壓減
少。在 t=145 秒，影像距離已經接近岸
壁，艉推器降壓，船舶航向修正至 230
度附近，並且保持平行姿態靠泊至岸壁。 
0 50 100 150
-2
0
2
4
6
8
10
12
靠泊時艏艉推進器電壓命令
Time (sec)
V
ol
ta
ge
 (V
)
 
 
艏推進器電壓命令
艉推進器電壓命令
 
    圖二十四靠泊時艏艉推進器電壓分配圖 
 
圖二十五顯示靠泊時船舶影像航向
與實際航向及參考航向，圖二十五中藍
色線為影像航向，紅色線為實際航向，
黑色線為靠泊參考航向。對應至圖中實
際航向在 t=103 秒船舶在待泊區進行轉
向，在影像航向與實際航向為保持靠泊
時參考航向 230 度，在 t=110 秒至 138
秒因而產生上下震盪行為。 
0 50 100 150 200
0
50
100
150
200
250
300
靠泊時影像估測航向與實際航向及靠泊參考航向
Time (sec)
H
ea
di
ng
 (d
eg
)
 
 
影像估測航向
實際航向
靠泊參考航向
 
圖二十五 靠泊影像航向與實際航向及參考航向 
 
 
