2cross-validation, independently.
In experiments, the 76 shoulder
ultrasonic images are collected to analyze the
effects of classification. The features of
gray-level co-occurrence matrix and texture
feature coding method are demonstrated to be
more powerful than ones extracted from other
three methods using the criterions of mutual
information and F-score in the feature
extraction. In the diseases classification of
the 76 ultrasonic shoulder images, the correct
classification rate is 77.5% using the support
vector machine is 77.5%, however, it is
superior to radial basis function network that
reached 72.5%.
Keyword: rotator cuff, supraspinatus,
ultrasound images
一、簡介與研究動機
近來年，旋轉肌腱群損傷及斷裂普通
依賴醫師的臨床檢查，使用影像技術（如
核磁共振掃瞄，超音波掃瞄）以及關節鏡
檢查等方式來作診斷。關節鏡檢查
（arthroscopic examinations）可以確認
旋轉肌腱損傷及斷裂之真實狀況。然而，
關節鏡檢查為一侵入性的診斷方式，可能
造成不必要開刀，損害病患的權益。因此，
在臨床上使用核磁共振掃瞄檢查可以術前
診斷旋轉肌腱損傷狀況，然而，近年來國
內健保財務漸趨困窘，對於昂貴核磁共振
掃瞄檢查已漸失去效益。從文獻中，我們
了解超音波掃瞄對於偵測旋轉肌腱群損傷
與斷裂亦具成效。其中核磁共振掃瞄對於
完全斷裂有 80%~90%診斷正確率，超音波
影像亦具有相符的成效，然而對於超音波
診斷部份斷裂的病患僅能達 65%，不及核
磁共振掃瞄之 75%~80%。因此欲使用較具
經濟效益之超音波作為臨床診斷之工具，
進一步提昇超音波的效能，顯得相當重要。
如上所述，本計劃之主要目的發展一套
電腦輔助診斷系統用來偵測肩關節旋轉肌
肌群病變並進一步作疾病判讀。擷取病灶區
域中有效的紋路特徵並使用類神經分類器
作為分類正常，肌腱炎，肌腱部份斷裂以及
全斷裂之依據。在臨床上肩關節疼痛的成因
很多，但是多數為與岡上肌損傷或斷裂有
關。它大致上可以分成三個分類。此三類為
肌 腱 發 炎 (tendinopathy of rotator
cuff)、鈣化（calcification）、以及岡上
肌斷裂（supraspinatus tear)（包括部份
斷裂和完全斷裂）。診斷肩關節疼痛的普通
性診斷工具為超音波圖像(Sonogram)。在超
音波的診斷上有許多特徵有助於診斷，超音
波肩關節影像可分成冠狀(coronal view)
影像以及橫向(transverse)兩種影像。詳細
影像像特徵描述如下。
(1)正常旋轉肌腱者(normal rotator
cuff)
影像中岡上肌部位影像顯示正常肌腱
亮度(tendons echogenics)，均勻的
紋路(homogeneous texture)。整個肌
腱組織有正常厚度且具有均勻平滑的
曲線並且不具有輕度回音
(hypo-echoic)的現象。如圖 1-1。
圖 1-1、正常岡上肌影像。
(2)肌 腱 發 炎 者 (tendinopathy of
rotator cuff)
比對正常發現，皆肌腱組織的厚度較
正 常 者 為 大 ， 其 原 因 為 水 腫
(oedema)、發炎(inflammation)出現
在肌腱組織中。如圖 1-2。
圖 1-2、右圖為肌腱炎之長軸影像。左圖為
短軸影像
42 研究方法
2.1 紋路分析:
本研究的紋路分析使用：紋路特徵編
碼法[1]，灰階明亮度相互關係矩陣[2]，紋
路頻譜法[3]，統計特徵矩陣法[4]，以及碎
形維度[5]等方法擷取 34 個紋路特徵。將這
些特徵值正規化，正規化的方式，是以屬於
該特徵的每個資料減去該特徵資料的平均
值，再除以該特徵資料之標準差。
2.2 特徵選取:
交互訊息法（mutual information）是
可以衡量變數間相關性和資訊量的一種有
效方法，不過要計算連續變數間交互訊息非
常困難，因為需要計算變數的機率密度函
數。而使用Parzen視窗密度估計法可以來估
計變數的機率密度函數，降低計算複雜性。
因此本研究採用基於Parzen視窗密度估計
法的交互訊息方式來做特徵選取。
假設一個離散的隨機變數X有子集X，機
率密度函數p(x)= Pr{X=x}， x X，X的熵
值（entropy）定義為:H(X) = ( )log ( )-
x
p x p x


X
當某些變數確定，某些不確定時，不確定的
就用條件熵值來計算：
H(Y|X) = - ( , ) log ( | )
x y
p x y p y x
 

X Y
交互訊息和熵值的關係：
I(X;Y) = H(Y) - H(Y|X)
兩個變數間的交互訊息可以定義為：
( , )
I(X;Y) = ( , ) log
( ) ( )x y
p x y
p x y
p x p y 

X Y
要找 ),(),(),( yxpypxp 機率密度函數是
非常困難的工作，因此使用Parzen視窗密度
估計法來估計近似值。給定個數為n，維度
為d的向量集合D =  nxxx ,...,, 21 ，也就是樣
本數為n，維度為d的特徵集合，xn表示的就
是第n個樣本的特徵。Parzen視窗的機率密
度函數估計式為：



n
i
i hxxn
xp
1
),(
1
)(ˆ 
其中（‧）為window函數，h是window寬
度參數。寬度參數需要是n的函數：
lim
n
0)( nh 而且 lim
n
)(ndnh 而
window函數，通常使用高斯視窗函數
),( hxx i = )
2
exp(
)2(
1
2
1
2/12/ h
zz
h
T
dd


為隨機變數 ixx 的d維向量之共變異數
矩陣。
輸入特徵為連續變數，類別為離散值時，輸
入特徵X和類別C的交互訊息可表示為：
I(X;C) = H(C) - H(C|X)
其中條件熵值H(C|X)為：
1
H(C|X) = - ( ) ( | )log ( | )
N
X
c
p x p c x p c x dx


其中N是類別的數目。
根據貝式法則（Bayesian rule）條件機率
 xcp | 可寫成：
)(
),(
)|(
xp
xcp
xcp 
使用Parzen視窗法估計每個類別的條件聯
合機率密度函數的估計值：
),(ˆ xcp = 


cIi
i
c
hxx
n
),(
1 
其中nc是類別c的樣本數，Ic是屬於類別c的
樣本索引的集合。因為條件機率總和為1：
Nk xkp1 )|( =1
所 以 )|( xcp 可 表 示 為 ：
 
 N
k
N
k
xkp
xcp
xkp
xcp
xcp
11
),(
),(
)|(
)|(
)|( 機
率估計值變成：
)|(ˆ xcp =
 

 



N
k Ii ki
k
Ii
ci
c
k
c
hxx
n
hxx
n
1
),(
1
),(
1


ch 和 kh 為類別特定的視窗寬度參數，nk是類
別k的樣本數，Ik是屬於類別c的樣本索引的
集合。如果每個類別使用相同的視窗寬度參
數和共變異數矩陣，可以改寫為：
)|(ˆ xcp =
 

 





N
k kIi
i
T
i
k
cIi
i
T
i
c
h
xxxx
n
h
xxxx
n
1 2
1
2
1
)
2
)()(
exp(
1
)
2
)()(
exp(
1
6描述f : xy函數映射的放射狀基礎函數網
路。
在本研究的放射狀基礎函數網路模型
中，主要目標是在計算權重，其決定方式是
使用最小均方誤差法（Least Mean Square
Error Method ）。並藉由克萊斯基分解
（Cholesky decomposition），及使用規則化
理論，去有效地得到最佳解。
至於中心點及寬度函數則用簡單的方
式決定。中心點是由使用者決定個數，並由
程式從訓練集中隨機選擇，每個核心函數的
寬度函數則固定為 5。h 是隱藏層的輸出：
 1 2( ) ( ) ... ( ) Tkh x x x   ..
其中 k 是中心數目， 1( )x 是輸入 x 的第一
個核心函數輸出值。類別 j 個區別函數
(discriminant function)Cj(x)表示為：
( ) , 1,2,...,Tj jc x w h j m 
其中 m 為類別數，wj為類別 j 之權重向量：
1 2 ...
T
j j j jkw w w w  
分類方式為，在計算每個類別的區別函數值
後，選擇分類結果中有最大區別函數值的類
別。
支援向量機(support vector machine)[9]
是一種基於統計學習理論的機器學習方
法，是建立在統計理論的 VC 維度(Vapnik
Chervonenks Dimension)理論與結構風險最
小法(method of structrual risk minimizatin)的
原理基礎上。其基本概念是在高維度空間中
尋找一個超平面(hyperplane)，能將資料分為
兩類，以保證資料最小錯誤率，而最接近超
平面的向量稱為支援向量。
如果在資料為線性可分割的情況下進
行分類，首先對每筆不同的的訓練集資料
(training data)加上標註為+1 或-1，用以表示
不 同 類 別 。 以 數 學 式 表 示 訓 練 集 為
 1(x , )
N
i i i
d ，其中 xi表示第 i 個訓練樣本，
di為相對應之目標輸出。則可線性分割之超
平面公式如下：
w x 0T b 
其中 x 是輸入向量，w 是可調整權重向
量，b 為偏移量。因此可以寫成：
w x 0 1
w x 0 1
T
i i
T
i i
b for d
b for d
  
  
最接近的資料點稱為分隔邊界值（margin of
separation），表示為ρ。
如果需要將非線性的資料加以分類，可
採用核心函數（kernel function）來改變資料
型態，其主要的概念是將輸入資料由原先的
低維度空間(low dimensional)藉由核心函數
的轉換對映到高維度空間(high dimensional)
中，在高維度空間中就可將原本線性不可分
割的資料使用線性分割，也就是說核心函數
是將非線性的資料改為線性資料之後再行
分類，核心函數的選擇和核心參數的決定會
對結果造成影響。
給 定 兩 個 類 別 的 訓 練 向 量
, 1,...,nkx R k m  ，標籤向量 my R ，
 1, 1ky   ，支援向量機解決二次方程最佳
問 題 ：
, ,
1
1
min
2
m
T
kw b
k
w w C



 ........... 其 在
( ( ) ) 1 , 0, 1,...,Tk k k ky w x b k m     
限制下，其中訓練資料是藉由函數ψ映射到
高維度空間，且 C 是一個訓練誤差的懲罰參
數值。對任一測試實例 x，決定函數（decision
function），也就是預測器為：
( ) sgn( ( ) )Tf x w x b 
由於支援向量機的訓練需要核心函數
( , ) ( ) ( )Tk x x' x x'  ，本研究使用放射狀
基礎函數網路（radial basis function, RBF）
為核心函數：
2( , ) exp( )k x x' x x'  
使用此核心函數，在支援向量機的模型裡有
兩個參數需要設定，C 和γ。因此研究使用
網格搜尋（grid search）演算法來輔助找尋
最佳參數值。演算法說明如下：
1. 假設在(C,γ)參數對的一個網格空間。
設 定  2log 5, 3,...,15C  和
 2log 15, 13,...,3  。
2. 將搜尋空間的每個參數對(C,γ)，對訓
練集進行 5 摺交叉驗證（5-fold cross
validation）。
3. 選擇具有最低交叉驗證誤差率的參數
8特徵數
正
確率(%)
3 4 5 6 7 34(all)
交互訊息法 67.50 70.00 72.50 72.50 71.25 72.50
F-score 67.50 68.75 67.50 70.00 68.75 72.50
表 3-2、放射狀基礎函數網路使用最大交互訊
支援向量機實驗使用 libsvm，進行 5
摺交叉驗證，每摺的資料都與放射狀基礎函
數網路實驗相同，一樣分別以最大交互訊息
和 F-score 選出之前 7 個特徵值，以及全部
特徵來分類，並比較結果。
實驗使用的核心函數使用預設的放射
狀基礎函數網路。而實驗中亦需要決定成本
參數 C（cost or Penalty）與 g（gamma）兩
個參數值，C 預設值為 1，g 預設值為 1/k，
其中 k 為特徵數目。為方便尋找較佳之參
數，先使用 libsvm 中的基於網格搜尋演算
法的參數選擇工具 grid.py，來選擇參數，並
以此參數當一個基準，再進一步尋找其他參
數。將最大交互訊息法選出之 7 個特徵分別
以支援向量機分類，5 摺平均後，將最高的
正確率結果整理如表 3-3.。結果在前 3 個特
徵可以得到 77.5%的最高正確率，前 4 個為
72.50%，其他 5、6、7 個皆為 68.75%。將
具有支援向量機分類最高正確率之 3 個特
徵值的分類結果整理成混淆矩陣。如表
3-4。發炎分類正確率為 85.71%，鈣化為
90.00%，斷裂為 68.00%，而正常則是
60.00%。將 F-score 法選出之 7 個特徵分別
以支援向量機分類，5 摺平均後，將最高的
正確率結果整理如表 3-5結果依正確率大
小依次為，前 3 個特徵可以得到 77.5%的正
確率，前 4 個 75.00%，前 6 個為 72.50%前
7 個為 71.25%，最後前 5 個為 68.75%。表
3-6可以發現由於不論是最大交互訊息法還
是 F-score 法所取之前 3 個特徵是相同的，
因此使用支援向量機分類之正確率亦相
同，而且前 3 個特徵集即可得到最高正確
率。然而，最大交互訊息法從前 3 個開始，
以支援向量機的結果開始下降，除了前 5 個
結果為 68.75%是相同的之外，其他 4、6、
和 7 個之結果皆較 F-score 法的正確率低。
其原因可能是 fselect.py 程式的特徵選取演
算法，其實是結合 F-score 以及支援向量機
的方法。它在選取特徵子集時，經過支援向
量機使用網格參數搜尋演算法法的交叉驗
證。因此選取出來的特徵值，是支援向量機
配合網格參數搜尋演算法所設定之參數範
圍中較好的，所以 F-score 在支援向量機中
才會有較交互訊息法好的結果。另外，支援
向量機在使用全部特徵值，正確率會下降，
似乎在網格搜尋演算法的參數範圍內，太多
的特徵，正確率反而會降低。使用放射狀基
礎函數網路，使用之特徵選取法不管是最大
交互訊息法還是 F-score，分類的正確率結
果較平均，並且使用最大交互訊息法的最高
正確率與未進行特徵擷取之正確率相同，而
使用支援向量機，最大交互訊息法與 F-score
的結果除了前 3 個分類之正確率最高，以及
前 5 個分類正確率相同之外，其他 F-score
都比最大交互訊息法來的高。而使用全部的
特徵值以支援向量機分類，分類正確率會下
降，顯示放射狀基礎網路在不同特徵數的表
現上較為平均，而較多的特徵數則會些許降
低支援向量機的分辨率。
4.結論
本論文之主要目的是探討能夠使用於
偵測肩關節旋轉肌肌群病變之輔助疾病診
斷方法。希望可以增進超音波肌腱影像之診
斷效能，能夠造福肩部疼痛的病患並可節省
醫院診查之成本。
本研究分別使用了紋路特徵編碼法，
灰階明亮度相互關係矩陣，紋路頻譜，統計
特徵矩陣，以及碎型維度等方法，擷取肩關
節影像特徵，並分別利用交互訊息法與
F-score 法選取有效特徵，再以放射狀基礎
函數網路分類器進行分類，並比較支援向量
機實驗結果。
- 10 -
特徵數 3 4 5 6 7
正確率 77.50% 72.50% 68.75% 68.75% 68.75%
參數組合 c=32768, g=0.125 c=35, g= 1 c=8 , g=5 c=8.0 , g=5.0； c=8.0 , g=0.5；,
c=32768 , g=0.125 c=8.0 g=2.0；
c=0.5 , g=2.0
表 3-3. 最大交互訊息法所選出之特徵數與支援向量機分類正確率結果
預測
1 2 3 4 平均
1 30 2 3 0 85.71%
2 1 9 0 0 90.00%
3 8 0 17 0 68.00%
實
際
4 2 2 0 6 60.00%
表 3-4、支援向量機分類前 3 個特徵分類結果之混淆矩陣
特徵數 3 4 5 6 7
正確率 77.50% 75.00% 68.75% 72.50% 71.25%
參數組合
c=32768 ,
g=0.125
c=2048.0,
g=0.5 c=50 g =0.7 C=8.0 g=0.5 c=8.0 g =0.5
c=8192.0, g=0.03125 c =33.0 g= 0.4
表 3-5、F-score 法所選出之特徵數與支援向量機分類正確率結果表
特徵數
正確率
3 4 5 6 7 34(all)
交互訊息法 77.50% 72.50% 68.75% 68.75% 68.75% 66.25%
F-score 77.50% 75.00% 68.75% 72.50% 71.25% 66.25%
表 3-6、最大交互訊息法與 F-score 法所選出之特徵數以支援向量機分類結果
