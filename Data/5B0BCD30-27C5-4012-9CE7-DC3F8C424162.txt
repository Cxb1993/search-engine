 II
Abstract 
 
Radio Frequency Identification (RFID) in recent years has become very popular 
in many service industries, purchasing and distribution logistics, industry, 
manufacturing companies and material flow systems. The automatic identification 
technology of RFID is achieved with a reader reading/writing the information of the 
tags or the cards by radio waves. The RFID system consists of mainly the following 
parts：Reader、Tag、host and antenna comprised in the reader and th tag. The readers 
consist of two parts：a digital section used to control the RF section and to 
accept and process the base-band signals from the reader and an RF section that 
performs the RF transmission and reception functions 
The study adopts the microcontroller as the core, and combines the high 
frequency radio circuit and the embedded web server. By this real-time 
communication system, the user can directly reads data from the RFID reader or 
writes data to it through the network. This paper introduces the construction of the 
reader, the communication protocol used of the reader, and implementation of the 
reader. 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 1 
一、前言 
射頻辨識（Radio frequency identification，RFID）系統是自動化辨識（automatic 
identification，auto ID）系統中的一種技術。自動化辨識系統包括 Barcode 
systems、Optical character recognition、Biometric procedures、Smart cards 和 RFID
等。自動化辨識系統是利用自動化機械來辨識、定位和追蹤各種個別的物品、生
物等，也涵蓋了自動化資料擷取的範疇。由於此種特性，不但增加了效率，減少
了人為資料存取錯誤的發生，也降低了人力成本。 
射頻辨識利用無線電波（radio waves）的發射，來達到自動化辨識的功能，
是一種非接觸式的技術。藉由讀取器(interrogator or reader)發射訊號，欲辨識物
體上電子標籤（tag or transponder）的解讀，並送回讀取器所需要的資訊來達到
物體的自動化辨識。一個射頻辨識系統主要由以下兩個部分所組成： 
 電子標籤(tag)：又稱為詢答機(transponder)，用來放置於想要辨識的物體或
人員上，接收讀取器發射的能量與信號，解調出內部的命令，再以另一頻率
送回此標籤的電子產品碼(Electronic Product Code，EPC)等一連串的數位識
別資料。一個電子標籤主要由耦合元件（天線）、無線射頻(RF)電路及微晶
片所組成。 
 讀取器(reader)：用來傳送資訊給電子標籤和接收電子標籤所回傳的資訊。
一個典型的讀取器包含了一個 RF 模組（傳送器和接收器），一個控制單元
和耦合元件。除此之外，大部分的讀取器也包含了一個額外的介面（如：
RS 232、USB、WLAN 等）可和其他系統（如：個人電腦等）相連結，使
得它們可把接收到的資訊傳到其他的系統並進行分析與處理。而讀取器除了
負責與電子標籤之間的能量供給與通訊外，尚需肩負資料的安全性
(security)、可靠性(reliability)，以及處理資料碰撞(collision)的問題。 
 
圖 1. RFID 系統中的讀取器及電子標籤 
電子標籤上電源供應（battery）的有無，我們可以將射頻辨識系統分成兩大類： 
 主動式射頻辨識（active RFID）系統：電子標籤上附有電源，故自己本身就
 3 
入管制及消費應用。至於遠距離 RFID 要能普遍應用，則還需要一段時間來等待。 
RFID 技術存在已久，但隨著科技的進步及各種技術突破、規範協定的制定、
改良，促使 RFID 在這幾年內蓬勃的發展。預計未來 RFID 將成為影響人類發展
的一項重要科技，不過目前 RFID 在技術上仍有些瓶頸尚待突破。且市面上所發
展的 RFID 產品效能各家不一，其差異性來自於設計方式的不同。但是都建構在
相同的射頻原理或協定之上。而在進行射頻辨識系統的實際電路研發之前，有必
要先對射頻辨識系統的整體架構有所了解，了解在不同系統參數之下，射頻辨識
系統所產生出來的行為、效能，才能審慎的選定各項系統參數值，在最佳化操作
與實際應用上達到一個平衡點。 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 5 
記憶體類型 典型為可讀且可寫 唯讀 
記憶體容量大小 較大 較小 
感應距離 較遠 較短 
尺寸、重量 較大較重 較小較輕 
使用年限 有 無 
設備裝置 大 小 
環境影響 對高低溫較敏感 可以適應於較差的環境 
價格 較高 較低 
從讀取器到電子標籤所發
送的訊號強度 
較低 較高（因電子標籤必須從
中獲得電力） 
從電子標籤到讀取器所發
送的訊號強度 
較高 較低 
主動式或被動式射頻辨識系統的選取將造成以下的影響： 
(1). 通訊範圍：對於被動式射頻辨識系統而言，由於電子標籤需要從讀取器獲得
非常強的訊號來當作電力來源，故限制了讀取器到電子標籤之間的距離；又
因為從電子標籤只能發送少量的功率到讀取器，故限制了電子標籤到讀取器
之間的距離。由於以上兩個因素，所以被動式射頻辨識系統的通訊範圍，典
型地被限制在小於 3 公尺的範圍之內，而根據不同的應用及頻率的選取，有
時通訊範圍大概只有幾公分的距離。而主動式射頻辨識系統，由於本身附有
電源，所以通訊的範圍甚至可以大到 100 公尺以上。 
(2). 多個電子標籤的資訊蒐集：被動式射頻辨識系統由於通訊範圍比較短，所以
在蒐集多個電子標籤資訊上的能力也比較不足。尤其是在移動的物體上，由
於通訊範圍較短，所以當物體移動速度太快時，會導致讀取器來不及一個一
個去讀取。所以主動式射頻辨識系統在蒐集多個電子標籤資訊上的能力會來
的比較好。 
(3). 內建感應器能力：在某些應用上，會需要在電子標籤內建一個感應器，來偵
測外在環境的變化。由於被動式射頻辨識系統的電源不是持續性的（只有在
讀取器的讀取範圍內），導致這方面的應用上，無法持續去監測、紀錄這些
狀態。 
(4). 資料儲存能力：主動式射頻辨識系統由於本身附有電源，擁有較大的功率可
以提供較大的記憶體電路來使用，再加上其電源供應是持續性的，使得我們
 7 
 
圖 2. 反向散射耦合 
為了將資料以調變方式傳回給 Reader，Tag 使用一個負載電阻 RL與天線並
聯，並由微晶片內之數位資料串來控制天線 RF 之開與關(由負載電阻的開或關決
定傳送或不傳送);功率 P2（功率 P1’的一部份）由 Tag 天線所發射，也就是從電
子標籤電線反射出來的功率 P2 振幅將會被影響調變，也就是所謂的被調變反向
散射（modulated backscatter）。而功率 P2 輻射到自由空間，經衰減後其一小部份
功率 P2’為 Reader 天線所接收，經由方向耦合器（directional coupler）解耦合而
傳送到讀取器的接收機（receiver）作為輸入。此外，P1 除以 P2 的值可以由雷達
方程式獲得。 
 讀取器架構原理 
 讀取器操作原理 
 RFID 系統內的 Reader 主要用以讀取 Tag 內的資料，以利主電腦(Host)進行
物件的辨識工作，當主電腦下達辨識命令給 Reader 時，Reader 會透過內建或外
接的天線(Antenna)發射 RF 無線電波，一旦 Tag 進入偵測範圍，即開始進行雙方
溝通，Tag 會將其內的資料透過內建 RF 機制傳回給 Reader，Reader 接收到資料
後，再傳到主電腦進行物件的辨識工作。 
 9 
的。更詳細的協定資料將於之後做解釋。 
 讀取器組成模組 
 Reader 用以接收主電腦的命令，以讀取 Tag 內的資料或將資料寫入 Tag 內，
因此，Reader 內的組成模組包括如圖 5 所示之各單元方塊圖。 
 
 
圖 5.  Reader 的讀/寫單元方塊圖 
其操作功能如下： 
(1). 控制模組(control module) 
 控制模組是由微控制器(微晶片)、調變與解調等 RLC 電路所組成，主要區
分以下三項功能： 
 資料處理功能 
包括資料的編碼(Encode)、解碼(Decode)、檢查偵錯、儲存，以及與主電腦
之間的通訊等操作。 
 與 Tag 間的通訊管理 
包捨起動(wake up)Tag 開始工作，通訊機制的初始化、讀取與寫入資料、安
全認證、整合檢查與時序(Timing)控制等等。 
 實體的通訊 
控制收發模組與收發天線發射 RF 無線電波能量以進行對 Tag 的讀取或寫入
資料動作。 
(2). 射頻模組(Radio Frequency Module) 
 此為一發射與接收電磁波之 RF 收發機(Transceiver)的收發模組，其中收發機
 11 
及電子標籤識別層(Tag-identification layer)。實體層定義了 Reader 傳送資料到
Tag，使用的載波調變方式為 DSB-ASK、SSB-ASK 及 PR-ASK，編碼方式為
PIE(Pulse-interval encoding)；而 Tag 回傳資料到 Reader 的反向散射調變方式為
ASK 或 PSK，編碼方式為 FM0 或 Miller-modulated subcarrier。第二層電子標籤
識別層定義了 Reader 管理 Tag 的三種命令操作：選擇命令、登入命令及存取命
令。而 Reader 與 Tag 的通訊操作為半雙工型式，採用讀取器優先溝通
(Interrogator-talks-first)以及隨機導向(slotted random)的防碰撞技術。整個頻率操
作範圍則選擇台灣開放給射頻辨識系統使用的 UHF 頻段 922~928MHz。 
 讀取器對電子標籤的通訊編碼方式 
Reader 使用 PIE(Pulse-interval encoding)的編碼方式，傳輸資料給 Tag，其編
碼時脈如圖 6 所示，圖上所定義的單位 Tari 時間，是由上升脈波沿的中點至下一
個上升脈波沿的中點來計算，如表 2 有三種可參考值，可知 Reader 下載到 Tag
的資料傳輸率為 40、80 及 160 kbps。 
 
圖 6.  PIE 符號 
表 2  讀取器對電子標籤 Tari 時間值 
 
在傳送資料到 Tag 時，Reader 必須以一個前導(Preamble)或是訊框同步
(Frame-sync)做為傳輸至 Tag 的訊息開頭，此兩種方式如圖 7 所示，一個前導必
須在詢問命令之前，並代表整個登錄環程(inventory round)的開頭。往後接下來的
訊息則使用訊框同步作為開頭。 
 13 
PSK，而 Reader 必須能解調這兩種調變的載波。Tag 傳輸資料到 Reader 的編碼
方式為可以為「基頻 FM0」或「次載波米勒調變 (Miller modulation of a 
subcarrier)」。圖 8 所示為 FM0 二位元符號的時脈表示：位元周期中有轉變過程
的為位元 0，無轉變過程的為位元 1。 
 
圖 8.  FM0 符號及序列 
其資料連結頻率(等於資料傳輸率)可由 2.1.1 中的方程式 calTR/DRLF = 來
決定，EPC C1 G2 中定義的 DR 有 64/3 及 8 兩個值，TRcal 如 2.1.1 所述，因此
可計算出 FM0 的資料傳輸率約為 40、160、320 及 640 kbps。 
此外對所有 R=>T 和 T=>R 的通訊傳輸順序應該依照下列的協定 
 在每個訊息裡，最高有效位元應先被傳輸，還有 
 在每個字元裡，最高有效位元(MSB)應該先被傳輸。 
 資料完整性及錯誤偵測 
為了保持資料的完整及正確性，需要對其資料的傳輸進行偵測與改正，錯誤
偵測只能偵測到有傳輸錯誤的發生，但不能加以改正; 錯誤改正則可以偵測到錯
誤，並加以改正。依 EPC C1 G2 標準，並無定義錯誤改正，而有定義使用 CRC
的錯誤偵測法。錯誤偵測無法得知哪一位元錯誤，而是偵測位元錯誤已經發生，
而系統將忽略此錯誤訊息，並等待下一個內含正確命令的資訊到來。 
 資料正確性的檢驗-Checksum 
在資料傳輸過程中，難免會受到雜訊的干擾，導致資料的不正確性，為了偵
測出資料的正確性與否，我們需要利用某種 checksum 的技術來偵測錯誤的發
生，以保持資料的正確性。常用的幾種 checksum 程序如下： 
(1). 同位元檢查（Parity checking）：每一位元組（byte）的資料，多附加一個
同位位元。同位位元不算，當設定奇同位，當有奇數個位元為 1 時，則同位
位元被設定為 0;偶數個位元為 1 時，同位位元設定為 1。而偶同位，則是當
 15 
 
圖 9.  CRC-5 編解碼電路結構 
 常用的16位CRC多項式有兩種：一種是CRC-CCITT標準，另一種是CRC-16
標準，分別用於歐洲和美國的 8 位元字組的傳輸，CRC-CCITT 的偵錯能力略高
於 CRC-16，而 EPC C1 G2 採用的正是 CCITT-16 CRC 來偵測錯誤， 
表 4  CCITT-16 CRC 定義 
 
 CRC 的做法是若給定一個 k 位元的資料區塊，則發射機需再產生一個 n-k
位元的序列，此稱為訊框檢驗序列(frame check sequence, FCS)或區塊檢驗序列
(block check sequence，BCS)，這樣組成一個可被 CRC 產生函數 P(x)除盡的 n 位
元訊框(k 位元資料+n-k 位元 FCS)。P(x) = (n-k+1)位元之模式序列；即預定之除
數。接收機將接收到的 n 位元訊框資料除以 P(x)，如果沒有餘數則表示沒有錯誤
發生。 
因此 CCITT-16 需要一個 16 位元的訊框檢驗序列(FCS)，其做法為 k 位元資
料向上提升 16 位元，原 16 位元之位置補上 0，會產生一個新的(k+16)位元序列，
再將其除以 17 位元的 CRC 產生多項式，如上表定義之 X16 + X12 + X5 + X0 (X0 = 
1)，其二進位表示為 10001000000100001，產生之餘數即為訊框檢驗序列
(FCS)=CRC 碼。而最後傳出的訊號即為向上提升 16 位元的 k 位元資料+16 位元
CRC 碼=(k+16)位元訊框。當接收機接受此 k+16 位元資料，再次除以 P(x)，相除
後的餘數為 0，則表示資料傳輸無誤。其除法器的硬體電路實現可由移位暫存器
及 XOR 加法器所組成。 
EPC C1 G2 所使用的 CCITT-16 乃參考 ISO/IEC 13239 標準，如表 4 所示，
此編碼使用數位邏輯分析的步驟是先載入一個內容為 FFFFh 之 16-bit 移位暫存
器，稱之為「CRC」暫存器，然後將串列訊息(被除數)一次一個位元的輸入移位
 17 
 依 EPC C1 G2 的標準，UHF 採分時多工(TDM)架構，而 Reader 和 Tag 溝通
的防碰撞演算法是 slotted random，其基本原理為 Reader 發出訊號讓所有的 Tag
感應後，Tag 則會在時槽計數器產生一亂數，並在每次 Reader 發出訊息的每一時
槽時間，倒數一次，先倒數至零的則回應訊息至 Reader。 
在射頻辨識系統中，Tag 發生的碰撞問題是因為當有兩個以上的電子標籤在
同一個讀取器的讀取範圍，此時會導致讀取器同時接收到多個反射回來的訊號，
導致碰撞發生。此外還有另一種為讀取器的碰撞問題，其原因如下： 
 讀取器到讀取器的干擾（reader-to-reader interference）：兩個以上的讀取器在
相同的時間點在相同的頻率下操作，為一種頻率的干擾。 
 電子標籤的干擾（tag interference）：兩個以上的讀取器在相同的時間點企圖
去和同一個電子標籤做通訊。 
因此 EPC C1 G2 也新規範了密集讀取器(Dense-Interrogator)模式，有助於 Tag
在多個 Reader 在近距離使用的情形下正常工作。此並非強制性模式，但是只要
有一個非密集閱讀器模式的 RFID 讀取器也會淹沒 Tag 響應信號，抵消密集讀取
器模式的潛在好處，譬如手持閱讀器、超高頻主動式射頻辨識系統。因此密集讀
取器模式還是有建立的必要，此架構則定義在 EPC C1 G2 的協定第二層，電子
標籤識別層。其做法如下： 
Reader 應支援 4 會議層，即 Tag 能提供 4 個會議層，(定義為 S0、S1、S2、
S3)，在一個登入環程中，Tag 要能參與其中並唯一的一層，兩個或更多的 Reader
可以使用不同的會議層來獨立地登入一個 Tag 群，這會議層的概念解釋如圖 11  
Tags 在每一會議層須固定一個獨立的登入旗標，四會議層中任一個都有兩個登
入旗標值，定義為 A 跟 B，在每次的登入環程的開始，Reader 在四會議層中之
一選擇登入 A 或是 B Tag，而在其中之一會議層中，Tag 參與其登入環程時，其
他層的 Tag 是不能使用也不能修改其登入旗標值的。被給定的會議層中， Tag
提供分別獨立的登入旗標值，其他 Tag 來源在會議層被共享。 
 
會議層允許 Tag 對每個不同的 Reader 連結至分別獨立的登入旗標值。當
Reader 獨立區隔出一個 Tag 之後，Reader 便會發出一個命令，使得 Tag 在其會
議層中反轉其登入旗標值。(如 A->B 或是 B->A)。接下來的例子解釋兩個 Reader
如何使用會議層和登入旗標去區隔跟完全的登入一 Tag 群而不會發生衝突。  
 
 Reader 1 啟動，那麼 
 它開始一個登入循環，並區隔出 S2 會議層中的 A Tags 並反轉成 B。 
 Reader 1 關閉。 
 Reader 2 啟動，那麼 
 它開始一個登入循環，並區隔出 S3 會議層中的 B Tags 並反轉成 A。 
 Reader 2 關閉。 
 19 
 信號調變與解調 
由於低頻基帶信號在傳輸上易受雜訊和失真的影響，且所需要的接收天線極
長，為了使傳輸更有效率，因此將低頻基帶信號附加在高頻電磁波上傳遞，此即
所謂的調變。尚未調變過的電磁波也就是所謂的載波，調變過後的電磁波被傳送
端發射，在空氣中傳播，途中亦或多或少會受到外部雜訊的干擾影響，而後到達
接收端。接收端再對電磁波作解調變，還原成原本的訊號。典型的 RFID 系統中，
主要使用移幅鍵控(ASK)、移頻鍵控(FSK)和移相鍵控(PSK)等三種數位資料之類
比調變的方式。不同的調變技術，其功率消耗量量、可靠度、頻寬和電路設計複
雜度皆有所不同。以下為三種基本的數位調變技術： 
(1). ASK（amplitude-shift keying）調變：傳送端利用載波振幅的變化來傳送資
料。通常使用兩種不同的振幅來表示基帶編碼後的訊號。ASK 由於構造簡
單和易於在接收端解調出原基帶信號，所以是最簡單的調變方式，但需要極
寬的頻寬和極大的載波功率。使用 ASK 雖然有著極高的資料傳輸率，但對
於噪音的容忍度是較差的。 
(2). FSK（frequency-shift keying）調變：傳送端使用不同的載波頻率來傳送資
料。而 binary FSK 是最簡單常見的一種，利用兩種不同的頻率來表示基帶
編碼後的訊號。使用 FSK 可以簡化讀取器的設計，提供一個非常佳的噪音
容忍度，但由於需要的傳輸線路頻寬較高，造成了較低的資料傳輸率。 
(3). PSK（phase-shift keying）調變：傳送端使用載波相位的改變來傳送資料。
而 binary PSK 是最簡單常見的一種，利用兩種不同的相位（0 度、180 度）
來表示基帶編碼後的訊號。使用 PSK 也提供了不錯的噪音容忍度，適度地
簡化了讀取器的設計，並且跟 FSK 相比起來有更快的資料傳輸率， 
 
圖 12.  不同的調變技術(a)100%ASK (b)binary FSK (c)binary PSK 
 EPC C1 G2 規範了 Reader 對 Tag 的通訊調變方式為雙旁波帶-移幅鍵控
(DSB-ASK)、單旁波帶-移幅鍵控(SSB-ASK)及反相移幅鍵控(PR-ASK)，如圖 13
 21 
三、RFID 讀取器前端系統硬體架構 
 天線(Antenna) 
 天線是在空間有效送出電磁波，且對空間交錯的電磁波有效收集的被動元
件。RFID 系統中 Reader 與 Tag 之間的資料傳輸是以無線方式來進行，憑藉的就
是靠彼此間的天線發射與接收 RF 無線電波，因此如何設計出最佳化天線的操作
效能以取得最大之 Tag 可被讀取的距離，是相當重要的。 
首先要介紹三個不同的名詞 dB/ dBi / dBm。這都是用來測量增益的單位，
但意義並不相同。dB 和 dBi 是相對單位，而 dbm 是絕對單位。dB 是天線的增益
和此天線的比例，我們常以 3dB 代表天線增為 2 倍; dBi 這個值的比較基準是相
對於等向性天線(Isotropic Antenna：一種每個方向所測得的輸出及輸入功率都是
相等的理論天線)的比值，此即天線增益;dBm 是以 RF 輸出 1 mW 做為基準，其
發射功率和 1mW 之比值。 
在許多情況下，天線需要在某一方向加強訊號，而另一方向必須減弱訊號，
以這樣方式設計的天線就是指向性天線，而訊號的加強就是所謂的「天線增益」。
天線之指向特性則可以用電磁場輻射場型來解釋。如圖 14 所示： 
 Omni-directional-垂直天線之電磁場輻射能量在各方向完成相等。 
 Bi-directional-水平天線之電磁場輻能量主要在兩個方向上。 
 Uni-directional-單一指向性天線之電磁場輻射能量主要在一個方向上。 
 
圖 14.  電磁場輻射場型(Radiation Patterns) 
 超高頻 Reader 使用的天線以電信法所規定的增益範圍內，在結構允許的大
小、欲設計讀取範圍內作自由的選擇。對於 13.56 MHz，UHF，及 2.45 GHz 之
RFID，其天線的原理有所不同。13.56 MHz 主要靠的是電磁感應，感應距離較近;
而 UHF 及 2.45 GHz 則是利用天線共振所產生之電磁波，由 Tag 之天線接收，故
其有高指向性，讀取距離較遠。由於為了使超高頻 Reader 能夠讀取較寬廣範圍
距離的 Tag，所以我們使用圓形極化波的天線。天線的極化是指輻射波電磁場向
量的極化方向，通常天線的極化包括直線(垂直或水平)、圓形(右旋圓形極化
RHCP 與右旋圓形極化 LHCP)、及橢圓極化。 
 23 
 
圖 16.  環行器結構圖 
 典型的連接環行器：在上下兩個接地面間是兩層圓盤或三角狀磁性鐵氧體元
件(Ferrite disk)，中間夾著微帶線。三條微帶線交於一圓金屬盤，互相交 120 度，
做為環行器的三個端，直流偏壓場的方向與接地面垂直。當其工作時，兩磁性鐵
氧體圓盤會形成共振腔，無偏壓場時，共振腔會有一共振模式，受到偏壓時，共
振模式會形成兩頻率略為不同的共振模式，因此決定其操作頻率，使兩波形模式
疊加時，輸出端為同相相加，隔離端為相減。如下圖 17，能量流動方向為埠 1
到埠 2，埠 2 到埠 3，埠 3 到埠 1，其為順時針環行，亦有逆時針環行器。 
 
圖 17.  環行器運行方向 
 IQ 正交解調改善接收訊號準確度的分析 
在 RFID 的信號傳輸上，接收是比傳送更重要的課題，因為電子標籤反向散
射傳回的訊號非常微弱，即使經過特定的調變及編碼方式，仍然會受雜訊及失真
的影響。因此本計畫亦著重接收機應選擇何種的解調方式會使效能較好。由於多
數的雜訊干擾影響的是振幅，因此在尋求較佳的抗雜訊能力上，會選擇搭配解調
相位的方式。 
其中 IQ 正交解調可將 RF 訊號分為同相(in-phase)與正交(quadrature)的 I/Q
兩個基頻訊號，I 為 A*Cos(ψ)，Q 為 A*Sin(ψ)。此兩訊號因為彼此正交，所以
不會互相干擾。此兩訊號進入類比-數位轉換器編碼之後，處於 I 與 Q 兩狀態間
 25 
PD LPF VCO
25÷
inf
MHz
fin
925
25f
out
=
⋅=
25/
outdiv ff =MHz37=
 
圖 19.  鎖相迴路設計 
 功率放大器 
 功率放大器(以下簡稱 PA)的主要功用為把所要發射出去的訊號的功率做一
個提升，如此訊號被送到天線時才有足夠的能量發送到 tag。功率放大器與一般
放大器最大的分別在於正常操作時的效率，一般來說，PA 的效率為輸出功率除
以電源功率，由於耗電及熱效應的問題，PA 必須盡可能在有限的功率消耗下，
使用大信號操作，以提供大功率輸出，相對於一般放大器，雖然電流消耗低，但
正常操作下輸出的功率也低，如此效率便遠低於 PA 了。PA 的基本特性列表如
表 6。 
表 6  功率放大器基本特性 
 
   
目前 PA 的分類以輸出輸入電壓的關係來看的話可分為線性 PA 跟非線性
PA。線性 PA 包含在電子學中所學過的 A 類、B 類及 AB 類三種，而非線性放大
器則有 C 類、D 類、E 類及 F 類。而在本次計畫中，預計採用 E 類 PA，故以下
將對其簡短的介紹。如圖 20，包含一個並聯 NMOS 的電容 Cs，及一組串聯的諧
振電感 Ldc、Ls，還有一個負載電阻 RL。至於 NMOS 則是拿來當做開關(Switch)
使用。首先當 NMOS 導通時，電流流過 NMOS，電晶體上的電壓降到最低。而
當 NMOS 關閉時，電流轉流向其負載。注意我們須盡量使 NMOS 在導通期間，
跨於其汲極(Drain)與源極(Source)之間的電壓達到最低，因為在 NMOS 切換過程
 27 
此時訊號能量的值即稱作靈敏度，訂定其靈敏度標準時，會考慮到(1)
系統要求的通訊距離、(2)傳遞介質的環境、(3)傳輸端的功率，靈敏度
愈低，愈能在吵雜的天空接收到小訊號。 
 交互調變失真(Intermodulation)：理想接收機所含的放大器或是混波器
操作應該都是線性的，但受限於主動元件的線性操作區間有限，使得所
組成的接收機產生非線性的效應，一般交互調變失真產生多是發生於接
收機同時收到相同射頻帶但不同頻道的信號時，通過接收機的非線性效
應而產生許多諧波，萬一不幸有諧波的頻率與所接收的頻道相同，則會
干擾到收到的信號，要解決此問題，除了提高接收機電路的線性度，規
劃接收機中頻頻率，避免產生的諧波落到接收的頻帶中也是很重要的。 
 選擇性(Selectivity)：需能從強烈干擾性雜訊中偵測需要的低電位訊號，
有關的干擾可能是同頻道、頻帶內或頻帶外的雜訊。許多訊號會同時進
入接收器的前端，但只有一種訊號是需要的，因此其他訊號必須全部加
以抑制，令其減弱不會影響或損害所需的訊號強度，否則位元錯誤率便
會上升，強烈的干擾也會減低 LNA 的靈敏度。 
 接收機架架構 
目前在射頻接收機的設計架構上，我們採用低中頻接收機的架構，因超外差
式接收機結構較複雜且適合較高的頻帶，如此內部設計的方式越有助於降低鏡像
頻率的干擾。而直接轉換式雖然結構簡單，但是容易有直流補償(DC offset)及 LO
洩漏的問題。低中頻的做法是將接收到的訊號降至很低的中頻位置，多為訊號頻
道寬的數倍，如此一來，就可以利用帶通濾波器將頻道內的信號取出，且移除掉
直流電壓的漂移。另外為了克服鏡像頻率，乃透過電路技巧使其鏡像頻率混波後
的訊號相位旋轉，進而產生相消的效果。其架構如圖 22 所示： 
 
圖 22.  低中頻接收機架構 
圖是接收器的類比和混合訊號零件，類比前端包含射頻自動增益控制器（RF 
 29 
RFV
SL
gL
dL
LC
SR
outV
BC
1M
2M
1GV
2GV
1GR
2GR
DDV
GL
1C D
L
inZ
 
圖 23.  低雜訊放大器 
( )
s
gs
m
gs
gsin LC
g
sC
LLsZ 11 +++=  
Ω=≈ 50
sT Lω     其中
gs
m
T C
g 1
=ω  為電晶體電流的單位增益頻寬 
    操作頻率 MHz
CLL
f
gsgs
o
925)(2
1
≈
+
=
pi
 
 混波器 
接收的 RF 訊號，經過 LNA 的放大後，需再經由混波器降至基頻。混波器
的電路如下圖 24，其中 BIASV 提供此電路的偏壓電流，RF 訊號透過一個 DC 
blocking 電容 BC 被接在電晶體 1M 的閘極。首先電晶體 1M 將 RF 訊號的電壓訊
號轉換成電流訊號，然後在電流 domain 做相乘的動作。在這個混波器中， LOV 必
須被選的夠大，使得電晶體
32 MM、 能夠完全地交互切換流經 1M 的電流，因此，
流經 1M 的電流，等效上來說被乘上一個方波，而此方波的頻率就是等於共振頻
率 OL :  [ ]{ }tIItti RFRFBIASLOout ωω coscossgn)( +=  
因為一個方波由 fundamental 的奇數個 harmonics 所組成，所以此方波乘上
( )tII RFRFBIAS ωcos+ 會在輸出端的頻譜上產生許多不想要的頻譜部份，因此我們
會在混波器的下ㄧ級接上濾波器，以過濾掉不想要的頻譜。 
 
 31 
玻纖環氧基板即可達到所需的技術要求，其材質為環氧樹酯及玻璃纖維，介電系
數 Er =4.1~4.6。 
在佈局之前，先了解所謂的電磁干擾(Electromagnetic Interference，EMI)，
其來源包括微處理器、開關電路、靜電放電、發射器、暫態電源元件、電源以及
閃電。在一個微處理器為基礎的電路板內，數位時序電路通常是寬頻帶雜訊的最
大產生者，這所謂的寬頻帶即指分佈於整個頻譜的雜訊。隨著快速半導體以及更
快的邊緣變化率的增加，這些電路可能產生高達 300 MHz 的諧波干擾，這些高
頻諧波應予以遮蔽或濾除。我們需要了解雜訊如何傳輸有助於辨識電路內部的電
磁干擾問題，雜訊的發生必需要有來源(source)、耦合路徑(coupling path)以及易
感染的接收器(susceptible receptor)，若是三者之一被排除於系統之外或被減少，
干擾才會消失或降低。 
基本上所有的電子電路都會發射 EMI 同時又受到 EMI 的干擾，因此電子裝
置的設計，應該既不受外在 EMI 干擾源的影響，本身也不應成為 EMI 的干擾源，
此一設計理念即為電磁相容性(Electromagnetic Compatibility, EMC)。大多數電子
設備的 EMI 是藉由傳導性方式接收，少數則來自無線電頻率之輻射接收。在數
位電路中，最臨限(most critical)的信號通常最易受到 EMI 的干擾，例如重置、中
斷以及控制線路信號。在類比電路中，類比低階放大器、信號轉換器、補償電路
等，則對雜訊干擾最為敏感。電磁干擾的防治主要可歸納為兩種不同的型式：降
低電磁干擾的散佈與提高電磁干擾的免疫能力。經由適當的系統設計可以抑制電
磁干擾的散佈；如果問題仍然持續，就得研究不同方式的遮蔽去包住發射體。電
路對雜訊的敏感性可藉由電路設計的加強以及使用遮蔽物來降低電路對電磁干
擾敏感性。 
 元件佈局 
PCB 佈局之前應先注意將元件放置在適當的位置，一方面需考慮電路板外
部接線端子的位置，另一方面也需考慮不同性質的電路應予以適當的區隔。不良
的元件擺置將使得 EMI 雜訊很高。所以較佳的設計中，低階類比、高速數位以
及雜訊電路(繼電器、高電流開關等等) 應加以分隔以降低子系統間的耦合。當
放置元件時，應同時考慮子系統電路間的內部電路繞線，元件間的擺置影響元件
間相連接的線路問題，若放的不好，會將彼此間的走線拉的很長，而使得雜訊更
有可能經由線路進路系統，若能夠將走線設計的很短，EMI 的影響將會減少，此
在數位電路中的時序及震盪電路特別重要。為了去除 EMI 的潛在問題，應該系
統化的檢查元件放置與線路佈局，返覆檢視及修正佈線一直到確定所有的 EMI
風險降低到最低為止，簡而言之，事先的防範是降低 EMI 干擾問題的首要原則。 
 地線佈局 
 33 
 電源線佈局 
PCB 的地線佈局完成之後，接下來就是電源線的佈局。若空間許可，電源
線應與地線平行，但從實際觀點而言，此點未必可行。電源線的雜訊通常可藉由
適當的電源濾波電容與解耦電容將之濾除，所以應先考慮地線的佈局，再考慮電
源線的佈局，在佈完接地線及電源線後，就是訊號線的佈局，訊號線的佈局以最
敏感的系統線路最先考慮，並去除電路間的耦合路徑，此外還要注意到在印刷電
路板的正面與反面的電源線與接地線盡量避免有重疉的現象，以免產生電源線與
接地線之間有電容的產生。如圖 28 所示： 
 
圖 28.  佈線差異造成的電容效應 
 PCB 的解耦電容可分為兩類，一類是置於 IC 旁的削尖電容(despiking 
capacitor)，另一類則是置於電源端的大型解耦電容(bulk decoupling capacitor)。 IC
旁的削尖電容其特質為容量小、頻寬高，目的在於提供 IC 開關時的瞬間脈衝電
流。另一類為電源端的大型解耦電容，其數值雖然不是非常關鍵，但至少應 10
倍於所有 IC 削尖電容的總和，也應放置於 PCB 的電源輸入端。小的 0.l F 電
容也可應用於電源端與之並聯以去除高頻雜訊，這些電容應該儘量靠近電源端。 
 
 
 
 
 
 
 35 
 網路層(Network Layer) 
此層處理整個網路中封包的移動，如封包的路由 (Routing) 、定址
(Addressing)。通常網路依其涵蓋範圍的大小可分為區域網路(LAN)、都會網路
(MAN)及廣域網路(WAN)，若發送封包與接受封包的網路不屬於同一個區域網路
(LAN)時，就需要網路層協助封包做傳送路徑的選擇。而最佳路徑的選擇除了考
慮兩點間參與路由節點數之外，還需要考慮線路品質、可靠度、使用率、頻寬、
成本等因素。此外每個網路裝置需有其獨立的位址或名稱，以便每個裝置彼此間
能互相搜尋以發送資料，至於位址與名稱的分配及定義就是由網路層所決定的。 
網路層對應到 OSI 七層模型為同名的「網路層」，由 IP(Internet Protocol)、
ICMP(Internet Protocol Message Protocol)以及 IGMP(Internet Group Management 
Protoco)所組成。 
 傳輸層(Transport Layer) 
傳輸層的主要工作是為其上的應用層提供兩端(End-to-End)的資料傳輸功
能，其中有兩個不同的傳輸協定。一者為UDP，僅負責將資料段(datagram)由一
端主機送到另一端主機，但不保證資料收送一定成功，其可靠度需由應用層加
入；另一者協定為TCP，提供兩主機間可靠的資料流傳輸，其傳輸方式是先將資
料切割成多段適當大小的資料，給予編號，以利接收端重組。此協定同時包含了
流量控制、偵錯處理的機制。因此採用TCP協定通訊的資料在收發上較為可靠。 
網路層對應到 OSI七層模型為同名的「傳輸層」，主要負責兩個應用程式之
間的通訊，包括  TCP(Transmission Control Protocol)與  UDP(UserDatagram 
Protocol)通訊協定，TCP 屬於連接導向(Connection oriented)的通訊協定，提供可
靠性 (Reliable)的傳輸服務，UDP 屬於非連接導向(Connectionless)的通訊協定，
提供非可靠性 (Unreliable)的傳輸服務。 
 應用層(Application Layer) 
 應用層負責處理應用程式的命令，是最接近使用者的層級，通常都是可直接
操作的應用軟體。目前此層發展出相當多的通訊協定。如Ftp(File Transfer 
Protocol)、Http(Hypertext Transfer Protocol)、Telnet(Terminal Emulation)外，
SNMP(Simple Network Management Protocol)與  SMTP(Simple Mail Transfer 
Protocol)等。 
 應用層對應到OSI七層模型為「會議層」、「表達層」及「應用層」。溝通
的雙方如何建立起傳輸的規則；資料在電腦中的內碼轉換、壓縮與解壓縮、加密
與解密，以及使用者操作的應用程式界面(API)都是應用層的工作。 
 
 TCP/IP 的協定 
 37 
儲存空間，目前通用的IP都是以IPv4(48位元)為標準。由於網路的發達，所以
現有的IP數量將面臨不足的問題，IPv6將是解決這個問題的下一代協定。 
 封包的切割(Fragmentation)和再組合(Reassamble)：由於在封包傳送過程中可
能會跨越不同架構的實體網路，而每一實體網路都有定義的最大封包大小的
限制(Maximum Transfer Unit, 簡稱 MTU)，所以在傳送的過程中有時必需將
封包切割成數個較小的個體才能將它繼續往目的地傳送。所有封包的切割與
再組合是屬於連線服務中 IP 的工作。 
 路由(Routing)：IP可以幫助資料封包尋找、解決傳送的路徑，負責決定一個
封包要經由怎麼樣的路線才能到達目地的。 
下表9是一個IP標頭的規格，除非有特別的選項存在，一般正常的標頭大小
是20個位元組。 
 
表 9. IP 標頭欄位規格 
版本 
(4-bit) 
標頭長度 
(4-bit) 
服務類型 
(8-bit) 
總長度 
(16-bit) 
認證碼 
(16-bit) 
旗標 
(3-bit) 
區段位移點 
(13-bit) 
存活時間 
(8-bit) 
協定 
(8-bit) 
標頭錯誤檢查碼 
(16-bit) 
來源 IP 位址(32-bit) 
目的 IP 位址(32-bit) 
選項 
(Variable Length) 
資料 
(Variable Length) 
 
IP 主要具有下列特性：  
 非連接導向(Connectionless)：每個資料封包都視為是互相獨立毫無關連的，
所走的路徑可能完全不相同，也不保證先送的一定會先到達。 
 不可信賴性(Unreliable)：送出去的 IP 封包並不保證一定會送到對方的手
中，即資料送出之後，就不再理會資料的下落。若送出的封包若在途中被損
毀或遺失，接收端也無法得知。 
 盡力傳送(Best-Effort Delivery)：由於每個發送者並不管資料以後的下場，為
避免資料找不到接收者，而在網路中流浪形成負擔，每個封包的傳送皆有設
定一個存活時間 (Finite Packet Lifetime)，即計算一定時間之後，若還未找到
接收者，封包將會自動丟棄。 
 ICMP(Internet Control Message Protocol) 網路控制訊息協定： 
ICMP 為補助 IP 功能的協定，其主要目的是用來發出網路問題或錯誤狀態
之報告，並轉送特定的網路資訊。I P封包在傳送時若偵測到錯誤，便會將它傳
給ICMP， ICMP 封包是嵌在IP封包中的資料區部分，當網際網路上的某一個閘
 39 
 傳輸服務 
運作於網路中間層，可增強上述的連線服務，以提供完整可靠的通訊品質。
TCP/IP在傳輸服務中，有TCP及UDP兩種協定，各具有連接導向與非連接導向性
質，分述如下： 
 
 UDP(User Datagram Protocol) 使用者資料段協定： 
UDP是一個簡易、資料段導向的傳輸層協定，UDP從應用程式接收訊息之
後，加上來源及目的埠號、檢查碼後，把此UDP的資料段送到IP封裝，IP會盡可
能的遞送UDP資料段，但不保證會到達目的地  
UDP在運作時採用了一個重要的概念—通訊端點位址(Port)。雖然 IP是識別
不同主機的唯一標記，但我們若僅使用一個 IP位址，在某些環境下並不足以明
確地指定資料接收端的身分，這是因為每個主機可能有多個使用者同時使用，而
每個使用者又可能會同時產生好幾個作業程序(Process)。因此若在每一使用者啟
動一個網路應用軟體時便指定一個 Port號碼給它，如此就可以真正明確地區分發
送端和接收端的角色。因此，「IP 位址+port 號碼」便是網路上一個通訊端點的
明確定義，這樣的組合也稱為Socket Address(簡稱Socket) 
但是IP中並沒有定義 Port 的欄位，為了使資料的傳輸能有 Port 的概念，
TCP/IP便在 IP 層上面架構了 UDP： IP負責將封包經由網際網路傳至對方主
機，UDP則將收到的封包分發給不同的應用程式或作業程序。UDP不提供錯誤檢
查，也不執行封包的排序，亦不會在資料發生錯誤時重新傳送資料，不過使用 
UDP的應用程式可以自行設計將上述的功能加入程式中。由上述可知，UDP 具
有無連接導向(Connectless)及不可信賴性(Unreliable)的特點。下表11是UDP的封
包格式。 
表 11. UDP 欄位規格 
來源端埠號 
(16-bit) 
目的端埠號 
(16-bit) 
UDP 長度 
(16-bit) 
檢查碼 
(16-bit) 
UDP 資料內容 
 
 TCP(Transmission Control Protocol)傳輸控制協定： 
 TCP為擴展IP的功能，提供終端主機間可靠的通信能力。TCP為連接指引的
協定，確立在開始通信時的連接與結束通信時切斷連接，其主要任務是負責發送
端及接收端的協定建立，建立超越通信子網之間的傳送。它使用IP來傳送封包給
上一層的應用程式，並保證資料在網路上的流動安全可靠。所以TCP具有循序編
號 (Sequence Number) 、確 認 (Acknowledgement) 、 檢查 (Checksum) 、 重 送
(Retransmission)等主要的 功能，提供了可靠的資料傳輸。 
 41 
檢查碼 
(16-bit) 
緊急指標 
(16-bit) 
選項 
(Variable Length) 
資料 
(Variable Length) 
來源端埠號： 16 位的來源埠號欄位包含了來源端應用連接的埠值。來源埠號與來
源 IP 位址一起用於標識資料段的返回位址。 
目的端埠號：16 位元的目的埠號欄位定義了傳輸目的的應用連接的埠，這實際上
是資料接收端主機上的應用程式的位址。 
發送序號： 32 位元的發送序號指出段中首位元組資料的序號，該序號值由接收端
主機使用，用於重組段中的資料，以獲取一個完整的資料。該序號能夠解決 TCP
所要求的有序接收遇到的問題。 
確認序號： 32 位元的接收序號僅當 ACK 旗標設置時有意義。其中的值表示下一
個期望接收的第一個資料位元組的序號。這個欄位用於對所收到的資料段的確
認。  
標頭長度： 這個 4 位元欄位指出段中資料相對於頭部起始處的偏移位置，以 32
位元長度為邊界。實際上指的是 TCP 標頭的大小，若無選項的話，通常為 20 個
位元組。保留： 6 位保留欄位應該設置為 0，是為將來增加新的功能而保留。 
旗標：有 6 個位元旗標欄位用於指定段的性質。6 個旗標分別為(見上表)：緊急旗
標（URG）、確認（ACK）旗標、推（PSH）旗標、連接重定（RST）旗標、同
步（SYN）旗標和終止（FIN）旗標。這 6 個旗標並非完全獨立，但是在很多情
況下可以同時設置其中的多個旗標。 
窗口長度：接收端主機使用 16 位元的視窗欄位通告本地可用緩衝區的空間，這也
是對方能夠發送的最大資料量，單位為位元組。 
檢查碼： TCP 標頭也包括 16 位的校驗和欄位。計算的過程與 UDP 相似。也要求
在計算中包含一個相關的 TCP 偽標頭。偽頭部共有 12 位元組。 
緊急指標：該欄位的長度為 16 位，指向資料段所包含的緊急資料的最後一個位元
組的位置，該欄位只有在 URG 旗標為 1 時才有意義。緊急資料的發送與視窗大
小無關。 
選項： TCP 定義了幾種選項，其中最有用的是 MSS（最大區段長）。這個選項在
兩個主機建立連接時交換，分別告訴對方自己可以接受的最大資料段的長度。為
了提高網路的利用效率，在允許的情況下應選擇一個盡可能大的 MSS 值。 
TCP相當於是 UDP的功能再加上可靠性傳輸的控制。因為 TCP需要有控制
傳輸可靠性的額外負擔，因此對於某些較不重要的資料傳輸(如E-MAIL)，一般
利用 UDP來做就可以了，而對FTP、TELNET等對傳輸內容要求絕對正確的應用
層協定，則非用 TCP來做不可。 
 應用服務 
位於網路最高層，可讓一台電腦上的應用程式與另一台電腦上類似的程式交
談，執行如檔案拷貝、上傳下載等工作。應用服務必須靠連線服務和傳輸服務來
 43 
伺服器接著會送出格式類似於請求標頭的選用標頭資訊。下面的回應來自於
廣泛使用的Apache伺服器。 
HTTP/1.0 200 OK 
Last-modified：Mon, 10 Apr 2000 09：01：53 GMT 
Server：Apache/1.1.1 
Context-type：text/html 
Context-length：1783 
一行空白行結束標頭欄，後面就接著實體內容(文字或圖形資料)，即使是回
報錯誤，伺服器仍會提供一些文字資料，讓瀏覽器可以顯示。 
 
 韌體與網路程式設計 
本計畫所使用的網路控制晶片是 RTL8019AS，對於 RTL8019AS 的驅動程式
編輯主要為初始化、發送資料、接收資料 3 部分功能，初始化主要是設定所需要
的暫存器狀態，建立網路接口收發資料的條件，在 2.2 節有大略介紹過。初始化
結束後，RTL8019AS 處於接收狀態，若網路上傳來可接受的資料封包，
RTL8019AS 會自動將資料存入接收緩衝區，並在收完資料後，向控制器請求中
斷。圖 31 是一個中斷處理程序的流程，當主程式回應 RTL8019AS 的中斷時，在
中斷處理程序入口根據中斷狀態暫存器(ISR)來決定程式的走向。 
 
圖 31.  RTL8019AS 中斷流程圖 
 45 
 
圖 33. 乙太網路訊框解析流程 
下表 13 列出的函數是以 C 巨集命令實現，用於測試在不同的事件發生時，
函數返回值將為零或非零值。 
表 13.  uIP 應用事件和對應的測試參數 
一個資料包到達，確應先前發送到資料 uip_acked() 
應用程式的新資料包已經到達 uip_newdata() 
一個遠端主機連接到監聽埠 uip_connected() 
一個到達遠端主機的連接成功建立 uip_connected() 
計時時間滿重發 uip_rexmit() 
計時時間滿週期性輪詢 uip_poll() 
遠端主機關閉連接 uip_closed() 
遠端主機中斷連接 uip_aborted() 
由於太多重傳，連接中斷 uip_timedout() 
 
 47 
應用程式通過呼叫uip_close()關閉當前連接。這會導致連接乾淨地關閉。為了指
出致命的錯誤，應用程式可以中止連接和呼叫uip_abort()函數完成這個工作。如
果連接已經被遠端關閉，測試函數uip_closed()為真。應用程式接著可以做一些必
要的清理工作。  
 報告錯誤 
有兩個致命的錯誤可以發生在連接中，一者是連接由遠端主機中止，一者就是連
接多次重發上一筆資料。應用程式使用兩個測試函數 uip_aborted()和 uip 
_timedout()去測試那些錯誤情況。 
 輪詢 
當連接空閒時，uIP 在每一個時候週期性地輪詢應用程式。應用程式使用測試函
數 uip_poll()去檢查它是否被輪詢過。 
 監聽埠 
uIP維持一個監聽TCP埠列表。通過uip_listen()函數，一個新的監聽埠打開。當一
個連接請求在一個監聽埠到達，uIP產生一個新的連接和呼叫應用程式函數。如
果一個新連接產生，應用程式被呼叫，測試函數uip_connected()為真。 
 打開連接 
透過使用uip_connect()函數打開一個新連接。這個函數打開一個新連接到指定的
IP位址和埠口，返回一個新連接的指標到uip_conn結構。如果沒有空餘的連接
槽，函數返回空值。為了方便，函數uip_ipaddr()可以用於將IP位址封裝進兩個16
位元陣列裏，通過uIP去代表IP地址。 
 資料流程控制 
通過函數uip_stop()和uip_restart()，uIP提供存取TCP資料流程的控制途徑。
函數uip_stop()可以用於維護流控制和停止遠端主機發送資料。當應用程式準備
好接收更多資料，函數uip_restart()用於告知遠端終端再次發送資料。函數
uip_stopped()可以用於檢查當前連接是否停止。 
 下表 14 整理了系統主要使用的函式： 
 
表 14  uIP 主要函式整理 
系統介面 
 
uip_init() 
uip_input() 
uip_periodic() 
初始化uIP 
處理輸入封包 
處理週期計時事件 
應用程式介面 
 
uip_listen() 
uip_connect() 
uip_send() 
uip_datalen() 
開始監聽埠 
連接到遠端主機 
在當前連接發送資料 
輸入資料的大小 
 49 
在uIP裏，只有實現ICMP回應訊息。ICMP回應資訊常常用於ping的程式，以檢查
主機是否在線上。在uIP裏，ICMP回應處理只單純處理類型的欄位，從改變echo
類型到echo reply類型，從而 ICMP調整校驗和。其次，IP地址裏的IP標頭交換，
封包送回到原先的發送者。 
 傳輸控制協定(TCP) 
為了減少儲存空間的使用，uIP裏的TCP沒有實現發送和接收資料的調整視窗。
輸入的TCP資料段不會通過uIP緩衝區，但必須立即由應用程式處理。注意這不
能避免應用程式自己緩衝資料。輸出資料時，uIP不能在每個連接有超過一個未
解決的TCP段。 
(1) TCP的連接與終止： 
TCP的連接是通過三線交握協議來完成的。採用三次交握的方法建立連接的
目的是為了避免錯誤地建立一條連接。首先，發送方發送一個SYN標誌位元為1
的TCP段給目的主機，其中帶有所選擇的初始序號。接收端收到該資料段後，以
一個帶有SYN標誌的段作為應答，其中也給出根據本身情況選擇的初始序號，並
包含對發送端的確認。而發送端收到接收端的應答後，再次送回一個報文段，其
中帶有對接收端SYN的確認。這樣雙方的連接就建立了，以後就能開始傳送資料。 
TCP終止連線上也是三線交握。只是在實際中，連接釋放分為兩個方向上
的獨立過程，因此其中可能會涉及到4個資料段的交換，但是，可以將其中的第2
與第3個資料段理解為一個，而且事實上當目的端也無任何資料傳遞時這兩個段
是合二為一的。由於TCP連接是全雙工，因此每個方向必須單獨地進行關閉。當
一方完成它的資料發送任務後就能發送一個FIN來終止這個方向連接。當一端收
到一個FIN，它必須通知應用層另一端幾經終止了那個方向的資料傳送。發送FIN
通常是應用層進行關閉的結果。收到一個FIN只意味著在這一方向上沒有資料流
程動。其TCP的連線與終止進行如圖34及35所示： 
 
圖 34.  TCP 連線示意圖 
 51 
(最大段大小)選擇，它會分析，再次檢查當前最大段大小MSS去決定當前連接的
MSS，前後者的最小值會被選擇。最後，一個回應封包被發送去確認回應以開啟
連接。 
應該將輸入封包送去一個已經活躍的連接，封包的序列號和從遠端主機來的
期望的下一個序列號一起被檢查。如果序列號不是期望得到的下一個，封包會被
丟掉並發一個ACK去指出期望得到的下一個序列號。緊接著，檢查輸入包裏的
確認回應序號，看看是否確認回應連接的所有輸出資料。它做了後，應用程式會
知道這個事實的。 
當序列號和確認回應號被檢測過，依靠當前TCP狀態，封包將會被不同地處
理。如果連接在SYN-RCVD狀態和輸入封包確應先前發送的SYNACK包，連接
將會輸入ESTABLISHED狀態，呼叫應用函數去通知已經完全連接。在連接的建
立狀態，如果有新資料由遠端主機發送或者遠端主機確應之前發送的資料，就呼
叫應用函數。 
當應用函數返回，TCP檢查應用程式是否還有資料要發。如果有，一個TCP/IP
封包會形成在封包緩衝區裡。 
(3)輸出處理： 
輸出處理過程比輸入處理較直接簡單得多。基本上，所有TCP和IP頭欄位由
uip_conn 結構裏的值充滿，計算TCP和IP的校驗和。當uip_process()函數返回，
封包通過網路設備驅動發送出去。 
(5)重新發送： 
當uIP通過periodic_timer被呼叫時，重新發送就開始進入運作(周期計時介
面 )。連接裡有些特殊的資料 (如資料發送出去但仍沒有確認回應的 )通過
UIP_OUTSTANDING位元在uip_conn 結構裏的TCP狀態標誌變數旗標。那個連
接，時間變數減少。當時間到達零，上一段必須重發和呼叫應用函數去做真正的
重發。如果一個特殊段重發編號超出一個可設置的界限，連接會結束和發一個
RST段到遠端連接結束，呼叫應用函數去通知它連接超時。 
(6)重置TCP 
TCP規格要求如果TCP頭裏的序號和確認回應序號在當前連接的接收視窗
失去了，有RST (重置)旗標設置的封包必須斷開連接。為了減少代碼的大小，本
論文不嚴格遵守這個規定。相反，如果一個有RST標誌設置的封包在連接裏到
達，連接會消滅那些不重要的序號和確認回應號值。 
下圖 36 是 TCP 可能具有的狀態。狀態之間的箭頭表示可能發生的狀態變
遷，箭頭旁邊寫上的文字是引起這種變遷的原因以及發生狀態變遷後又出現什麼
動作。粗箭頭表示客戶進程的正常變遷，虛線粗箭頭表示伺服器進程的正常變
遷，細線箭頭表示非典型變遷。主要觀察的是兩種粗箭頭表示的狀態變化過程。 
 
 53 
五、參考文獻 
[1] http://pemclab.cn.nctu.edu.tw/ 
[2] Gregory Wright. “The Lucent Technologies RF Tag”. 
[3] Auto-id center. “Technology Guide”.  
[4] Simon Haykin. Communication systems. 4th Edition, 2001. 
[5] Klaus Finkenzeller. RFID handbook：fundamentals and applications in 
contactless smart cards and identification. Second Edition, 2002. 
[6] AIM Frequency Forums. “Draft Paper on the Characteristics of RFID－
Systems”. 2000-07. 
[7] Motorola,inc. “Electro- Magnetic RFID : Everything You Need to Know About 
Inductively coupled RFID”. 1997. 
[8] Mario Chiesa, Ryan Genz, Franziska Heubler, Kim Mingo, Chris Noessel,  
Natasha Sopieva, Dave Slocombe, Jason Tester. “RFID : a week long survey on 
the technology and its potential Radio Frequency Identification”. March 04, 
2002. 
[9] Savi Technology. “Active and Passive RFID : Two Distinct, But Complementary, 
Technologies for Real-Time Supply Chain Visibility”. January, 2002. 
[10] Savi Technology. “Active RFID : Selecting the Optimal Frequency for  Global 
Applications”. February, 2002. 
[11] Pete Sorrells. ”Passive RFID Basics”. 1998 Microchip Technology Inc. 
[12] Hind, D.J. “Radio Frequency Identification and tracking systems in Hazardous 
areas”, Electrical Safety in Hazardous Environments, 1994., Fifth International 
Conference on , 19-21 Apr 1994, Page(s): 215 –227. 
[13] Raza, N. and Bradshaw, V. and Hague, M. “Applications of RFID technology “, 
RFID Technology (Ref. No. 1999/123), IEE Colloquium on , 25 Oct. 1999 
Page(s): 1/1 -1/5. 
[14] Engels, D.W. and Sarma, S.E. ”The reader collision problem “, Systems, Man 
and Cybernetics, 2002 IEEE International Conference on , Volume: 3 , 6-9 Oct. 
2002 ,Page(s): 6 pp. vol.3. 
[15] Rao, K.V.S. “An overview of backscattered radio frequency identification system 
(RFID)“, Microwave Conference, 1999 Asia Pacific , Volume: 3 , 30 Nov.-3 Dec. 
1999 ,Page(s): 746 -749 vol.3 
[16] Kossel, M. and Benedickter, H. and Baechtold, W. “An active tagging system 
using circular polarization modulation”, Microwave Symposium Digest, 1999 
IEEE MTT-S International , Volume: 4 , 13-19 June 1999, Page(s): 1595 -1598 
vol.4. 
[17] Robertson, I.D. and Blewett, M. and Amin, J. and Butt, I. and Donnelly, F. and 
