I 
摘要 
本計畫預計分成三年完成，第三年的研究目的是建立製程錯誤偵測與分類系統，以偵測製程狀態，
並在製程錯誤發生時，辨認錯誤形式，提早將訊息回饋於控制器，以提早調整製程，使製程能長時間
維持在穩定狀態。因此，本計畫將進一步建立製程資料庫與製程錯誤知識庫以便分析與執行錯誤偵測
與辨識，藉由收集到的資料進行分析，將較重要的製程資料由大量的資料中萃取出來，並且偵測是否
有製程錯誤的情況發生，若有製程錯誤的情況發生時，則進行錯誤型態分類，依照不同的錯誤型態進
行不同的製程修正方法，使製程能長時間運作。 
Abstract 
This paper applies the partial least squares (PLS) technique to the multiple-input multiple-output (MIMO) 
semiconductor processes in the Advanced Process Control (APC). Due to the property of batch processing, the 
semiconductor manufacturing processes frequently exhibit high multicollinearity among input variables and 
dependency among output variables. These two effects will typically cause variance inflation of the regression 
coefficient estimates which are utilized in triggering or updating the run-to run (R2R) controller. Furthermore, 
the metrology delays pose a great challenge for the existing R2R controllers. It is often the case that a 
significant delay exists between a process run and the process measurements from that run; inevitably, 
metrology delay leads to close-loop instabilities. To rectify the aforementioned difficulties that might 
realistically take place in practice, the PLS method is considered in this thesis a potential estimation 
alternative to the standard regression method. First, the thesis proposed a controller call PLS-MIMO double 
exponentially weighted moving average (PLS-MIMO DEWMA) controller. It used the PLS method as the 
model-building technique to help the EWMA controller to yield more consistent and robust control outputs 
than purely using the conventional EWMA controller. Then, it used the pre-process metrology data to build up 
a Virtual Metrology (VM) system that can provide the estimation process outputs for PLS-MIMO DEWMA 
controller. Finally, add a Fault Detection system based on the principal components of PLS which can provide 
the process state for VM and PLS-MIMO DEWMA controller. 
 
Key Words: advanced process control, Run-to-Run, partial least squares; exponentially weighted moving 
average, multicollinearity, virtual metrology, fault detection. 
 
 
 
 
 
 
 
 
 
 
 
 
1 
1. INTRODUCTION 
1.1 Background 
Advanced process control (APC) has evolved rapidly in the semiconductor industry during the 1980s and 
1990s, with Run-to-Run control emerging as the first technologically viable product of that evolution. APC 
includes both R2R control and fault detection and classification (FDC) systems [Edgar et. al. (2000), Moyne 
et. al. (2001) and Khan et al. (2007)]. The R2R control scheme integrates the techniques from both statistical 
process control (SPC) and engineering process control (EPC) in an attempt to update the input variables at 
each run that can compensate for the process changes and the system disturbances. The R2R controller is one 
kind of feedback controller but still maintains the advantages of SPC and EPC.  
SPC methods provide a group of statistical tests of general hypothesis that the mean value of the quality 
characteristic of a process (e.g., the process mean) is consistently on its target level. A variety of graphical 
tools have been developed for monitoring a process mean, e.g., Shewhart charts, cumulative sum (CUSUM) 
charts, and exponentially weighted moving average (EWMA) charts. For the quality control of a 
manufacturing process, one essential task is to detect and remove any possible abnormalities from the process. 
However, control charting alone does not explicitly provide an immediate process adjustment even when the 
process mean is clearly off-target. The lack of an adjustment scheme in SPC applications may cause a 
considerable process off-target cost, a critical concern in short-run manufacturing. Therefore, it is of 
importance to design adequate on-line process adjustment methods that are able to reduce various types of 
process errors quickly and keep the process mean right on a desirable level with relatively small effort. 
Suppose that a shift in the process mean has been detected using an SPC scheme. The next task is to adjust the 
process. There are two generic steps in process adjustment: one is to estimate the shift size in the process 
mean and the other one is to take an action on the manufacturing process to reduce the error. Since the shift 
size is an unknown parameter due to the inherent process variation and measurement variation, it has to be 
estimated base on the data collected on-line. Therefore, an adequate process adjustment strategy must take the 
uncertainty in model parameters into account. It seems reasonable to apply a sequence of adjustments, which 
periodically fine-tune the estimation of the shift size or update the model parameters as the system change 
takes place.  
One of the most popular R2R controllers is the EWMA controller. Some simple yet powerful feedback 
control schemes are becoming a relevant part of the toolkit for process control engineers. Among, the R2R 
control scheme has been a successful application in semiconductor manufacturing. The EWMA feedback 
controller is a popular R2R control group which primarily updates the process recipe based on the process 
deviations from target of the previous runs. Ingolfsson and Sachs (1993) proposed the single EWMA control 
scheme and studied the stability and sensitivity of the process output under a variety of process models. Later, 
Butler and Stefani (1994) presented the predictor-corrector controller (PCC) which was developed based on a 
double EWMA (termed DEWMA) scheme for compensating for drifted processes. Del Castillo and Hurwitz 
(1997) provided a literature review of R2R control methods from a statistical and control engineering point of 
view. The stability conditions and the transient performance of the DEWMA controlled process were 
examined by Del Castillo (1999) and Tseng et al. (2002, a) independently using different analytical 
approaches. These studies are restricted to the single-input single-output (SISO) framework. More recently, 
the application of the EWMA controller for the multiple-input multiple-output (MIMO) process has gained 
popularity in the R2R practice. Tseng et al. (2002, b) developed an MIMO extension of a single EWMA 
3 
 
1.2.2 On-line Tuning for the Process Model  
Another important facet of R2R processes is that the metrology data (input variables X  and output 
variables Y ) resemble each other. Since the input variables X  and output variables Y  are already coupled 
in the controller, the input variables X , generated by the controller for run to run, very likely yield the input 
variables with multicollinearity and the output variables with high dependency. If the processes model needs 
to be periodically updated on-line, this kind of metrology data will lead to poor estimation of the regression 
coefficients by using the MLR method, i.e., the estimation precision will be dramatically reduced as 
multicollinearity increases. In the R2R practice, the process model update is necessary since the predicted 
model can not be always accurate enough to the true system, or sometimes, the process changes due to the 
process disturbances. Under such circumstances, the PLS method is well suited to the on-line update for the 
process model.  
 
1.2.3 Process Nonlinearity  
In some particular situations, the nonlinearity should be considered in the model building phase, such as 
the chemical mechanical planarization (CMP) and photolithography processes. The EWMA-based controllers 
might not perform satisfactorily as the process nonlinearity is present. The reason is that the EWMA-based 
controllers are designed primarily based on the linear relationship between the input variables and the output 
variables. In this paper, a standard MIMO process will be simulated with two-factor interaction and/or 
quadratic terms, as an example, to address the process nonlinearity issue. The proposed PLS-MIMO DEWMA 
controller will be tested against the three process configurations aforementioned for the performance 
evaluation purpose.  
 
1.2.4 Metrology Delay  
Abrasive Pad
Platen
Wafer
Slurry Feed Pad Conditioner
Carrier
Wafer
Wafer
Wafer
Wafer
 
Figure 1. Metrology delay. 
 
Most semiconductor manufacturing process experience metrology delays. This delay occurs due to the 
time needed to measure wafers, and the tie spent in the wafer queue between the processing tool and the 
5 
number of output variables, Eq. (2.2) is not applicable in that the matrix TB B  is not invertible. It means that 
the matrix TB B  is not a positive definite matrix. This may cause oscillation and also instability as 
demonstrated in Song et al. (2002). Later, Rajagopal and Del Castillo (2003) proposed a modified control 
equation. The improved control scheme is the so-called Ridge-Solution double EWMA (RS-DEWMA) 
controller and expressed as follows:  
                       
1( ) ( )T Ti i iµ −= − − −X B B I B A Dτ                           (2.5) 
where I  is the identity matrix and 0µ ≠ . The value of µ  is often chosen a non-negative value. It adds a 
µI  term to the matrix TB B , ensuring its invertibility. In this thesis, the proposed controller will be 
compared to the RS-DEWMA controller for the calibration purpose.  
 
2.2 Partial Least Squares  
The PLS method can extract the state of the system from the stored data through the utilization of a series 
of mathematical and statistical procedures. The PLS method, originated by Herman Wold (1966), became 
popular first in chemometrics due in part to Herman’s son, Svante Wold. Unlike multiple linear regression 
(MLR), the PLS method is of particular interest as it is an enabling tool to analyze data with strongly collinear, 
noisy, and numerous process input variables, denoted by X  in this thesis, and can also simultaneously model 
several output variables, denoted by Y  in this thesis [Wang et al. (2009)].  
The PLS method is to maximize the squared covariance between a linear combination of the input 
variables X  and linear combination of the output variablesY . The PLS models for linear space are given by  
1 1 2 2
1
R
T T T T T
r r r r
r=
= + + + = + = +∑t t t tX p p p p E TP E            (2.6) 
1 1 2 2
1
R
T T T T T
r r r r
r =
= + + + = + = +∑u q u q u q u qY E UQ F               (2.7) 
where E  and F  are error term matrices; the score vectors 
r
t  and 
r
u  comprise the columns of T  and 
U . In addition, P  and Q  are loading matrices and R is the number of the latent variables.  
The main idea is to calculate the principal component scores of input variables X  and output variables 
Y  and then to set up a regression model between the scores. The PLS method can extract a set of latent 
variables that explain the high variation in the input variables, which is most predictive of the output variables. 
Thus, the matrix X  is decomposed into a matrix T  (the score matrix) and a matrix TP  (the transpose of 
the loading matrix) plus an error matrix E . The matrix Y  is decomposed into U and TQ  plus the error 
matrix F . These two equations are called outer relations. The goal of the PLS method is to minimize the 
norm of F  while keeping the correlation between X  and Y  by the inner relation as given by 
= +U TB G                           (2.8) 
where B  is a diagonal matrix containing the regression coefficients of the score model and G  is the 
residual. From Equations (2.6) and (2.7), the predicted value of Y  can be obtained according to:  
ˆ
.
TY = TBQ                        (2.9) 
In this thesis, the algorithm for calculating the PLS model is the called Nonlinear Iterative Partial Least 
Squares (NIPALS). The NIPALS algorithm has been developed by Wold (1966). It is one of the commonly 
used methods for calculating the principal components of a data set. Interested readers are referred to 
Appendix I for the formal procedure of NIPALS.   
7 
scheme:  
               
, ,1 , , 1 ,1 , 1( ) (1 )r i r r i r r i i r ia u b t aλ λ− −= − + − ,                         (2.13) 
                   
, ,2 , , 1 , 1 ,2 , 1( ) (1 )r i r r i r r i r i i r iu b t aη λ λ η− − −= − − + − ,                     (2.14) 
where 
,1rλ  and ,2iλ  are the discount factors.  
 
2.4 Virtual Metrology  
Most of the practical processes in the semiconductor manufacturing practice involve several 
quality-related parameters that cannot be measured in situ. That is called Metrology delay and they adversely 
affect R2R control performance. Recently, many approaches have been studied on the influence of metrology 
delay on the R2R control. Good and Qin (2006) and Wang et al. (2005) pointed out that the metrology delay 
coupled with inaccurate process models could lead to closed-loop systems instabilities. Zhang et al. (2010) is 
presented a novel R2R control methodology for semiconductor process with metrology delay which is 
developed by combining the minimum error entropy and the optimal control strategy.  
Virtual metrology (VM) is the prediction of metrology variables using process state and product 
information [khan et al. (2007)]. In the past few years VM has been proposed as a method to sew up the 
influence of metrology delay on R2R control schemes and improve the controller in terms of both accuracy 
and speed. Khan et al. (2007) provided a factory-wide control approach for semiconductor manufacturing that 
utilizes VM data generated from fault detection data and upstream metrology for R2R control at the wafer 
level. Also in 2008, Khan et al. (2008) have underlined the importance of VM and its potential use in 
feedback control for semiconductor manufacturing processes. Cheng et al. (2008) propose a novel method for 
evaluating the reliability of a VM system. Their proposed method calculates a reliance index value between 
zero and one by analyzing the process data of production equipment to determine the reliability of the VM 
results. 
 
2.5 Fault Detection 
A fault is defined as an unpermitted deviation of at least one characteristic property of a variable form an 
acceptable behavior. Therefore, the fault is a state that may lead to a malfunction or failure of the system 
[Isermann (2005)]. For the improvement of reliability, safety and efficiency of APC system, fault detection 
become increasingly important for semiconductor processes. Different approaches for fault detection fusing 
mathematical models have been developed in the last 20 years, e.g., Willsky (1976); Isermann (1984, 1993); 
Frank (1990).The task consists of the detection of faults in the processes, their approaches by using the 
dependencies between different measurable signals. These dependencies are expressed by mathematical 
process models.  
While the APC has been investigate, the use of multivariate statistics for abnormal situation detection has 
been studied intensively in the area of statistical process monitoring. Qin (2003) provides an overview and 
analysis of statistical process monitoring methods for fault detection, identification and reconstruction. Chu et 
al. (2004) is proposed a novel method for fault detection and operation mode identification in process. Their 
proposed method employs the support vector machine as a classification tool together with an entropy-based 
9 
modeling technique. Form the figure, the first block is the R2R control scheme based on PLS-MIMO 
DEWMA controller. Due to the metrology delay, the second block is VM system which can augment existing 
metrology data and has the potential to be used in R2R control schemes for improved process control in terms 
of both accuracy and speed. In this thesis, the VM is for predicting the metrology data. It can enable the 
PLS-MIMO DEWMA controller update the recipe immediately for executing the next run. The last block is 
FD system which is provided the current state of the process for VM system and PLS-MIMO DEWMA 
controller. The purpose of the FD system is monitoring the all variations and abnormal situations of input 
variables. When alarm occurs, the PLS-MIMO DEWMA controller will decrease the value of discount factors 
for reduce the variation of process in the proposed APC system.  
 
3.1 The PLS-MIMO DEWMA Controller  
In this thesis, the PLS multi-SISO EWMA controller is further enhanced from the multiple SISO R2R 
control scheme to the MIMO R2R control scheme, thus termed the PLS-MIMO DEWMA controller. The 
rationale behind the PLS-MIMO DEWMA controller is that the scores of PLS are not completely independent 
with each other, so direct decoupling of the MIMO system appears to be unrealistic in practice. In addition, if 
only the first important component with highest loading is used to control the MIMO semiconductor process, 
the process is liable to be out of control. The reason is that the first component may not be sufficient to 
explain the majority of the process variability. In section 4, the simulation results of purely employing the first 
component for the MIMO process will be shown to verify this claim.  
PLS Modeling
ˆ
= + +U a TB d
PLS-MIMO DEWMA Controller
1( ) '( )seti R i iτ−= − −T B'B B a d
Transform
i R=X T P
Transform
i i R=U Y H
i = i +1
i = 0
Start
MIMO Process
i i ii= + + +Y Xα β δ ε
1 1 1 1
2 1 1 2 1
( ) ( )
( ) ( )
i i i i
i i i i i
− −
− − −
= − + −
= − − + −
a U T B I a
d U T B a I d
Λ Λ
Λ Λ
 
Figure 4.  The variable transformation procedure of the PLS-MIMO DEWMA controller. 
 
In essence, the PLS-MIMO DEWMA controller resembles the MIMO DEWMA controller. The major 
difference between them is the transformation of input and output variables. Figure 4 shows the variable 
11 
                   1 1 1 1( ) ( )i i i i− −= − + −a U BT I aΛ Λ                            (3.8) 
                  2 1 1 2 1( ) ( )i i i i i− − −= − − + −d U BT a I dΛ Λ                        (3.9) 
where I  is the identity matrix, 1Λ  and 2Λ  are the weight matrices.  
For clarity of presentation, the formal R2R procedure of the proposed PLS-MIMO DEWMA controller is 
summarized as below: 
Step 1. Collect the data of the input variables X  and the output variables Y . The original data 
X and Y  are both scaled to zero mean with unit variance.  
Step 2. Use the scaled data to construct the PLS model.  
Step 3. Choose a suitable number of components ( R ) to control the process. In this paper, the 
percentage of the variance explained by the principal components of input variables X  is 
judged significant if greater than 75%.  
Step 4. Project the target τ  onto new subspace and derive setτ . 
Step 5. Estimate B  in Equation (3.5) by using linear regression. 
Step 6. Perform the PLS-MIMO DEWMA controller. 
Step 7. Transform the scores iT  to the input variables 1i+X  and feed it back to the process.  
Step 8. Project the process output iY  onto the subspace of components and feed it to the PLS-MIMO 
DEWMA controller.  
Step 9. Return to step 6. 
 
3.2 Virtual Metrology System 
The virtual metrology system is developed for predicting the response data without actual measurements. 
To obtain the VM module, we define 1[1 ]i i−V = X , 
 
 
 
  
B =
α
β
δ
, and let s = −Y Y Y , and = −V V V , 
where Y and V  are the mean values of the columns of Y  and V . Thus, the process in Equation (2.2) can 
be written as 
 
1
1[1 ]
i i
i i
i
s i
i
η
η
η
−
−
= + + +
 
 
= + 
  
= +
Y X
X
VB
α β δ
α
β
δ
                              (3.10) 
Then, using PLS modeling on the centered mean data matrices, the regression coefficients matrix Β  in 
Equation (3.10) can be estimated by ˆ PLSB . Thus, the Equation (3.10) is modeled as  
ˆ ˆ
PLS PLSY = VB                                     (3.11) 
where ˆ PLSY  is the PLS estimate of the sY . Since the PLS model is built upon the centered data, sY  and V , 
it means that the process output is predictable by using PLS methods as given by: 
ˆ ˆ
PLS
= +Y Y Y                                     (3.12) 
For clarity of presentation, the block diagram of the PLS-VM module in an R2R control scheme is 
shown in Figure 5. 
13 
and R  is the number of PLS components.  
If 2T  is within the control limit, the process is normal. If 2T  exceeds the control limit, it is though that 
there is a fault related to output variable Y  in the process. In this thesis, when a fault is detected, the 
PLS-MIMO DEWMA controller will reduce the value of discount factor automatic. 
 
4. SIMULATION RESULTS 
 The simulation results will be demonstrated in this chapter. Section 4.1 is presented the PLS-MIMO 
DEWMA controller is assessed by comparing its performance to those of the RS-DEWMA and the PLS 
multi-SISO DEWMA controllers.  
 
4.1 The performance of PLS-MIMO DEWMA controller 
To investigate the PLS-MIMO DEWMA controller, three scenarios in line with the process configuration 
discussed in chapter 1.2 are studied. In the first scenario, high multicollinearity among the input variables is 
designed in a linear model. The second scenario considers the processes model needs to be periodically 
updated on line. The final scenario involves nonlinearity in the model. In each example, the simulation results 
report two statistics: the averages of the output variables and the standard deviations of outputs variables.  
 
4.1.1 Scenario 1: Multicollinearity  
An MIMO model having four input variables and two output variables is considered as follows: 
                1 1 2 3 4 1300 30 20 60 45 0.001Y x x x x i ε= + − + − + +                 (4.1) 
               2 1 2 3 4 2700 50 15 100 20 0.002Y x x x x i ε= − − + − + + +                  (4.2) 
where  i  denotes the run number of the deterministic drift. The disturbance term 1ε  is assumed a white 
noise to obey 2(0,20 )N , and the disturbance term 2ε  follows 2(0,25 )N . In Equations (4.1) and (4.2), there 
is linear relationship between input variables; that is, 3 12x x= , and 4 1 20.5 3x x x= + . The objective is to keep 
the process outputs as close to its target as possible.  
In scenario 1, a data set of 100 independent runs based on Equation (4.1) and (4.2) is simulated. The 
simulated data set is used to construct the initial process model by using the MLR and PLS methods for the 
RS-DEWMA, PLS multi-SISO DEWMA and PLS-MIMO DEWMA controllers, respectively. Then, these 
three controllers are used to control the process outputs produced by Equations (4.1) and (4.2). Under each 
controller, 100 runs are collected for the calculation of the means and standard deviations of the output 
variables. It is termed a simulation cycle. For the assessment purpose, 10 independent simulation cycles are 
conducted for each controller, indicating that 10 different initial process models need to be fitted. In every 
controllers, the controller parameters are set to [400, 800]−=τ , 1 0.15= IΛ  and 2 0.35= IΛ . For further 
details, please refer to Del Castillo and Rajagopal (2003).  
Table 1.  Cumulative percentage of the variance explained for scenario 1 
Number of PLS components Percent 
1 0.5349 
2 0.9999 
3 0.9999 
4 1 
 
15 
Table 2. The simulation results of 10 simulation cycles in scenario 1 
Target τ  400 800−
 
Method  1Y  2Y  
Y  354.56 -730.07 
RS-DEWMA ( 1µ = ) S  27.25 37.66 
Y  385.00 -783.31 
RS-DEWMA ( 100µ = ) S  31.19 41.5780 
Y  387.28 -815.02 PLS multi-SISO DEWMA( 1R = ) 
S  21.76 32.69 
Y  398.72 -805.27 PLS multi-SISO DEWMA ( 2R = ) 
S  23.43 33.82 
Y  389.66 -812.3273 PLS-MIMO DEWMA ( 1R = ) 
S  20.00 26.18 
Y  400.04 -799.97 PLS-MIMO DEWMA ( 2R = ) 
S  22.32 28.43 
 
4.1.2 Scenario 2: On-line Tuning for the Process Model 
In this example, it is truly believed that the process model update is necessary in that the predicted model 
cannot always provide a reasonably well approximation to the true system, or sometimes, the process changes 
due to the disturbance. Under such circumstances, multicollinearity among the input variables and 
dependency among the output variables can realistically occur in practice. This situation will erratically affect 
the MLR parameter estimates, possibly leading to some import parameter that is artificially judged statically 
non-significant. This effect is, mathematically, due to the inherent instability of inverting a near singular 
matrix. The second example is another MIMO model with six input variables and two output variables. The 
assumed-true model is given by: 
1 1 2 3 4 5 6 1300 30 90 40 60 40 10 0.05Y x x x x x x i ε= + + + + − − + +              (4.3) 
2 1 2 3 4 5 6 2100 10 20 30 20 30 5 0.25Y x x x x x x i ε= + − + − + − − +            (4.4) 
As before, the disturbance term 1ε  is assumed a white noise to obey 
2(0,20 )N , and the disturbance 
term 2ε  follows 
2(0,25 )N . First, the data set of 100 runs is generated from Equations (4.3) and (4.4) to 
construct initial models. Then, the PLS-MIMO DEWMA controller, the PLS multi-SISO DEWMA controller 
and the RS-DEWMA controllers are executed to control 100 runs and then the metrology data are recorded, 
respectively. For the moment, the process continues to work on the second batch of 100 runs, and the 
previously obtained metrology data are used to construct the latest, initial process model for processing the 
second batch. Then, the metrology data of the second batch of 100 runs obtained by using these three 
controllers are gathered for evaluation. Likewise, the foregoing simulation cycle of the second batch of 100 
runs is repeated 10 times, and the means and standard deviations of the output variables are recorded. The 
controller parameter are set to [350,150]=τ , 1 0.15= IΛ  and 2 0.35= IΛ .  
For the two PLS-based controllers, PLS multi-SISO DEWMA and PLS-MIMO DEWMA, the 
cumulative percentage of the variance explained by the number of components is displayed in Table 3. It 
reveals that the first two components capture over 75% of the explained variance. Thus, the first two 
components are selected for running the PLS-MIMO DEWMA and the PLS multi-SISO DEWMA controllers 
17 
this paper as a calibration/comparison purpose.  
 
Table 4.  The simulation results of scenario 2 
Target τ  350 150 
Method  1Y  2Y  
Y  302.54 127.8615 
RS-DEWMA ( 1µ = ) S  29.20 26.52 
Y  281.20 123.42 
RS-DEWMA ( 100µ = ) S  27.78 25.82 
Y  348.22 80.13 PLS multi-SISO DEWMA ( 1R = ) 
S  23.41 25.71 
Y  347.97 149.87 PLS multi-SISO DEWMA ( 2R = ) 
S  23.44 29.28 
Y  353.51 80.59 PLS-MIMO DEWMA ( 1R = ) 
S  22.57 25.92 
Y  350.02 150.06 PLS-MIMO DEWMA ( 2R = ) 
S  22.56 26.21 
 
Table 4 shows the computational results of 10 independent simulation cycles for two versions of these 
three controllers each. As can be clearly seen from the table, the PLS-MIMO DEWMA controller ( 2R = ) 
produces more consistent (close-to-target) and more robust control outputs than those of the RS-DEWMA and 
the PLS multi-SISO DEWMA controllers. Likewise, the proposed controller is still ranked first in generating 
the most robust control outputs (see S  in the table). In number, the improvement seems not very significant, 
but even small improvement in the performance measure like standard deviation can possibly result in large 
savings in manufacturing cost.  
 
4.1.3 Scenario 3: Process Nonlinearity 
4.1.3.1 Case 1 
The process nonlinearity takes place frequently in the typical R2R practice, especially the interaction 
terms between input variables. The standard DEWMA controller is essentially devised on the process linearity 
assumption. Therefore, when the interaction exists between input variables, the EWMA or DEWMA 
controller is frequently not a suitable choice since their control performance might not be stable. Here, an 
experiment on a plasma etching process is considered where two input variables are investigated to study their 
effect on the etch rate in a semiconductor water etching application in Montgomery (2005). The MIMO 
process models are given by:  
1 1 2 1 2 185.79 4.681 4.352 4.375Y x x x x ε= + + + +                 (4.5) 
2 1 2 1 2 2115.7 57.1 149.7 89Y x x x x ε= + + + +                 (4.6) 
The disturbance term 1ε  is assumed a white noise to obey 2(0,3.36 )N , and the disturbance term 2ε  
follows 2(0,34.35 )N . The controller parameter are set to [70,1125]=τ , 1 0.15= IΛ  and 2 0.35= IΛ . The 
cumulative percentage of the variance explained by the number of components is given in Table 5. In this case, 
it has only two components. The first component does not suffice to capture over 75% of the explained 
19 
grand average for 2y  is 1124.57 ( 2 1125τ = ). Furthermore, it is shown that the PLS multi-SISO DEWMA 
controller does not work well as the proposed controller. The reason may be due partly to the infrastructure of 
the PLS multi-SISO controller. An MIMO model is decomposed into several pairs of the scores, so the 
information of the decomposed models will not be sufficient to provide an adequate manipulation among 
input variables as the interaction term is present. Thus, it leads to poor performance on standard deviation. 
Again, based on an overall evaluation, the proposed controller can deliver satisfactory performance for every 
statistics of both control outputs in this case.   
 
Table 6.  The simulation results of case 1 in scenario 3. 
Target τ  70 1125 
Method  1Y  2Y  
Y  70.57 1189.00 RS-DEWMA ( 1µ = ) 
S  10.38 191.07 
Y  83.79 1124.57 RS-DEWMA ( 100µ = ) 
S  3.42 38.30 
Y  79.23 979.42 PLS multi-SISO DEWMA ( 1R = ) 
S  3.7177 40.3731 
Y  75.56 1128.79 PLS multi-SISO DEWMA ( 2R = ) 
S  4.6921 66.0946 
Y  79.13 982.58 PLS-MIMO DEWMA ( 1R = ) 
S  3.4226 37.6814 
Y  70.03 1125.14 PLS-MIMO DEWMA ( 2R = ) 
S  4.0892 52.7569 
 
4.1.3.2 Case 2 
 
The second case of scenario 3 is a CMP process. It is based on the equipment models provided by Del 
Castillo and Yeh (1998). The input variables are platen speed( 1x ), back pressure ( 2x ), polishing downforce 
( 3x ), and the profile of the conditioning system ( 4x ). Each input variable is constrained inside the range [-1, 
1]. The two output variables of interest are removal rate (RR) and within-wafer non-uniformity (WIWNU) on 
the wafer surface after polishing. The first process model of interest is WIWNU, denoted by 1Y ; the second 
process model of interest is RR, denoted by 2Y . The MIMO system is expressed by: 
1 1 2 3 4 1 2 4 1254 32.6 113.2 32.6 37.1 36.8 57.3 ' 2.42 'Y x x x x x x x i i ε= + + + + − + − +           (4.7) 
2
2 1 2 3 4 1 2 1
2 2 '2
2 3 1 4 2
1563.5 159.3 38.2 178.9 24.9 67.2 46.2
19.2 28.9 12 ' 116 ' 50.4 ' 20.4
Y x x x x x x x
x x x t x i i i ε
= + − + + − −
− − − + − + +
                (4.8) 
where i  denotes the run number and ' ( 53) / 52 [ 1, 1]i i= − ∈ − , implying that the age of the polishing pad 
ranges from 1 to 105, and afterwards a new pad is switched on. It is noteworthy that the quadratic terms are 
considered in this case. The disturbance term 1ε  is assumed a white noise to obey 2(0,30 )N , and the 
disturbance term 2ε  follows 2(0,60 )N . In this CMP application, the process specification needs to achieve 
1 200Y <  and 2 1700Y > . For a testing purpose, the targets are set to [100, 2000]=τ . The remaining 
21 
controllers. 
 
Table 8.  The simulation results of case 2 in scenario 3 
Target τ  100 2000 
Method  1Y  2Y  
Y  225.66 1904.15 RS-DEWMA ( 1µ = ) 
S  31.44 75.17 
Y  225.89 1898.31 RS-DEWMA ( 100µ = ) 
S  31.01 75.16 
Y  237.37 1679.33 PLS multi-SISO DEWMA ( 1R = ) 
S  38.21 86.65 
Y  170.44 1832.03 PLS multi-SISO DEWMA ( 2R = ) 
S  43.91 110.46 
Y  177.23 1829.12 PLS multi-SISO DEWMA ( 3R = ) 
S  42.05 97.02 
Y  257.83 1644.52 PLS-MIMO DEWMA ( 1R = ) 
S  34.93 71.69 
Y  188.36 1835.42 PLS-MIMO DEWMA ( 2R = ) 
S  39.69 90.43 
Y  186.26 1784.62 PLS-MIMO DEWMA ( 3R = ) 
S  38.43 82.59 
 
In Table 8, three groups of the control outputs are shown: PLS-MIMO DEWMA, PLS multi-SISO 
DEWMA, and RS-DEWMA controllers. For each group, the average of 1Y , 2Y , 1S , 2S  are computed over 
10 independent cycles. It is obvious from the table that the PLS-MIMO DEWMA controller produces more 
stable control outputs of 1Y  and 2Y  than the PLS multi-SISO DEWMA. Surprisingly, the RS-DEWMA 
controller still cannot produce the control outputs that meet the process requirement, 1 200Y < , even though 
the smallest standard deviations on both output variables are obtained. To sum, the proposed controller can 
deliver satisfactory and competitive performance for every statistics of both control outputs for this case. Note 
that the simulation result of an individual simulation cycle of 100 runs for case 2 is suppressed due to the 
conciseness purpose.   
 
4.2 The PLS-MIMO DEWMA controller with Virtual Metrology System 
 This section gives the simulation results for PLS-MIMO DEWMA with VM system. In these two 
scenarios, a data set of 100 independent runs based on the linear term of Equations (4.7) and (4.8) is simulated. 
The MIMO process is follows: 
1 1 2 3 4 1254 32.6 113.2 32.6 37.1 0.05Y x x x x i η= + + + + + +                (4.9) 
2 1 2 3 4 21563.5 159.3 38.2 178.9 24.9 0.9Y x x x x i η= + − + + − +          (4.10) 
The simulated data is used to construct the initial process model and VM system. For a testing purpose, 
the targets are set to [100, 2000]=τ . The remaining parameters are set to 1 0.15= IΛ  and 2 0.35= IΛ .  
23 
It can be clearly seen from Table 10 that when the delay is greater than 2, the VM module returns smaller 
standard deviations than the RS-DEWMA controller, stressing its stability to yield more robust control outputs. 
However, it still not well as the performance of DT model.  
 
4.3 Fault Detection System for PLS-MIMO DEWMA controller with Virtual Metrology system 
The simulation results of chapter 4.2 show that the PLS-MIMO DEWMA controller with VM system 
performs well in the disturbance follows DT model with metrology delay. Although, the PLS-MIMO 
DEWMA with VM system still provides smaller standard deviations than the other controller in the 
disturbance follows IMA model with metrology delay greater than 2. However, it is not suitable for work in 
practice. To address this situation, we use FD system to provide the process state for PLS-MIMO DEWMA 
controller with VM system. When a fault has been detect, the PLS-MIMO DEWMA controller will reduce the 
value of discount factor automatic. 
The table 11 shows the FD system can help the PLS-MIMO DEWMA controller with VM system to 
reduce the variance of the process in IMA model with metrology delay. However, the effective extent is very 
low. 
Table 11. Simulation results for the IMA model. 
APC by PLS PLS-MIMO DEWMA +VM PLS-MIMO DEWMA  Delay 
Y  S  Y  S  Y  S  
1Y  96.32 67.86 78.88 78.18 99.94 44.93 1 
2Y  2026.21 135.73 2037.51 153.00 1999.05 91.92 
1Y  94.75 70.17 95.74 75.65 100.00 115.73 2 
2Y  2016.10 149.59 2027.36 159.96 1998.52 228.65 
1Y  97.14 79.84 99.62 83.59 253.94 1.47E+04 3 
2Y  2042.43 155.11 2022.54 166.24 2.77E+03 3.22E+04 
1Y  99.30 75.62 94.78 84.30 -1.25E+04 2.05E+05 4 
2Y  2022.21 160.93 2024.98 150.89 -4.19E+04 3.68E+05 
1Y  95.28 86.13 105.28 92.62 2.78E+04 8.02E+05 5 
2Y  2022.33 174.32 2034.60 195.19 4.16E+04 1.17E+06 
 
5. CONCLUSIONS AND FUTURE RESEARCHES 
5.1 Conclusions 
In this thesis, an enhanced APC system, combine the PLS-MIMO DEWMA controller, VM system and 
FD system is proposed to address several crucial issues that can realistically occur in semiconductor 
manufacturing. The experimental results show that the proposed PLS-MIMO EWMA controller is proved to 
be a flexible, effective and viable R2R solution as compared to standard MIMO DEWMA controllers. 
Furthermore, the proposed APC system that use VM generated from FD system and metrology data for the 
PLS-MIMO DEWMA controller can reduce the variation of process, improve quality, and increase yield.  
In chapter 4.1, the performance of the PLS-MIMO DEWMA controller is shown to be more reliable than 
the RS-DEWMA controller and the PLS multi-SISO DEWMA controller. In scenario 3 of chapter 4.1, the 
proposed controller also shows potential to deal with a nonlinear MIMO process. The simulation results of 10 
independent cycles confirm that using the PLS method as the model building and updating technique 
25 
APPENDIX 
A.1 the formal procedure of NIPALS  
Step 1. Given a starting vector of 1u , usually one of the columns in Y .  
Step 2. Calculate the X-weights, W , by 
1
1
1
T
T
X u
w =
X u
          (A1) 
Step 3. Calculate X-scores, T , by 
1 1=t Xw            (A2) 
Step 4. Calculate the Y-weights, Q , by 
1 1
1
1 1
T
T
u tq =
u t
          (A3) 
Step 5. Update the Y-scores, U , by 
1 1u = Yq            (A4) 
Step 6. Check for convergence by comparing t  to previous t . If convergence has not been reached, return 
to step 2, otherwise continue with next step. 
Step 7. Update P  based on t  by 
1 1 1 1/ ( )T Tp = X t t t          (A5) 
←
pp
p
           (A6) 
←
t
t
p
           (A7) 
←
w
w
p
           (A8) 
Step 8. Find the regression coefficient for the inner relation:  
1 1
1
1 1
T
T
b = u t
t t
           (A9) 
Step 9. The residuals, E  and F , are calculated by:  
1 1
T
−E = X t p           (A10) 
1 1
T
−F = Y u q           (A11) 
Step 10. Continue with next component until there is no more significant information in X  about Y .  
 
27 
Khan, A.A., Moyne, J., and Tibury, D.M.  “An approach for factory-wide control utilizing virtual 
metrology.” IEEE Trans. Semicond. Manuf. 20 (4) (2007) 364-374 
Khan, A.A., Moyne, J., and Tibury, D.M. “Virtual metrology and feedback control for semiconductor 
manufacturing processes using recursive partial least squares.” J. Process Control, 18 (2008) 961-974. 
Lee, S.P., Chou, R.J., and Tseng, S.T. “Stability and performance of a double MEWMA controller for drifted 
MIMO systems.” IIE Trans. 40 (2008) 690-708. 
Moyne, J., Del Castillo, E., and Hurwitz, A.M. “Run-to-Run control in semiconductor manufacturing” Boca 
Ration, FL: CRC, 2001. 
Montgomery, D. C. “Introduction to statistical quality control” fifth ed., Wiley, New York, 2005. 
Nelson, P.R.C., MacGregor, J.F. and Taylor, P.A. “The impactoof missing measureents on PCA and PLS 
prediction and monitoring applications” Chemom. Intell. Lab. Syst. 80 (2006) 1-12. 
Qin, S.J. “Statistical process monitoring: basic and beyond.” J. Chemometrics, 17 (2003) 480-502. 
Rajagopal, R., and Del Castillo, E. “An analysis and MIMO extension of a double EWMA run-to-run 
controller for non-squared systems.” Int. J. Relia. Qual. Saf. Eng., 10 (2003) 417-428. 
Sachs, E., Guo, R., Ha, S., and Hu, A. “Process control system for VLSI fabrication.” IEEE Trans. Semicond. 
Manuf. 4 (1991) 134-144. 
Song, K., Jang, P.Y., Cho, H., and Jun, C.H. “Partial least square-based model predictive control for 
large-scale manufacturing processes.” IIE Trans. 34 (2002) 881-890. 
Tracy, N.D., Young, J.C., and Mason R.L. “Multivariate control charts for individual observations.” J. Qual. 
Technol. 24 (1992) 88-95. 
Tseng, S.T., Chou, R.J., and Lee, S.P. “Statistical design of double EWMA controller.” Appl. Stoch. Models 
Bus. Ind. 18 (2002, a) 313-322. 
Tseng, S.T., Chou, R.J., and Lee, S.P. “A study of a multivariate EWMA controller.” IIE Trans. 34 (2002, b) 
541-549. 
Good, R.P., and Qin S.J. “On the stability of MIMO EWMA Run-to-Run controller with metrology delay” 
IEEE Trans. Semicond. Manuf. 19(1) (2006) 78-86. 
Wang, J., He, H.P., Qin, S.J., and Bode, C.A. “Recursive least squares estimation for run-to-run control with 
metrology delay and its application to STI etch process.” IEEE Trans. Semicond. Manuf. 18(2) (2005) 
309-319. 
Wang, H., Zhang, X., Kumar, A., and Haung, Q. “Nonlinear dynamics modeling of correlated functional 
process variables for condition monitoring in Chemical Mechanical Planarization.” IEEE Trans. 
Semicond. Manuf. 22(1) (2009) 188-195. 
Willsky, A.S. “A survey of design methods for failure detection systems.” Automatica 12 (1976) 601-611. 
Wold, H. “Estimation of principal components and related models by iterative least squares” in P.R. 
Krishnaiaah (ed.), Multivariate Analysis, Academic Press, 1966, pp. 391-420. 
Wold, S. “Personal memories of the early PLS development.” Chemom. Intell. Lab. Syst. 58 (2001) 83-84. 
Zeng, D., and Spanos, C.J. “Virtual Metrology modeling for plasma etch operations” IEEE Trans. Semicond. 
Manuf. 22(4) (2009) 419-431. 
 
 
國科會補助計畫衍生研發成果推廣資料表
日期:2011/07/04
國科會補助計畫
計畫名稱: 整合型先進製程控制系統之研究：量測延遲、虛擬量測、錯誤偵測與分類
計畫主持人: 范書愷
計畫編號: 97-2221-E-155-045-MY3 學門領域: 生產系統規劃與管制
無研發成果推廣資料
其他成果 
(無法以量化表達之成
果如辦理學術活動、獲
得獎項、重要國際合
作、研究成果國際影響
力及其他協助產業技
術發展之具體效益事
項等，請以文字敘述填
列。) 
無 
 成果項目 量化 名稱或內容性質簡述 
測驗工具(含質性與量性) 0  
課程/模組 0  
電腦及網路系統或工具 0  
教材 0  
舉辦之活動/競賽 0  
研討會/工作坊 0  
電子報、網站 0  
科 
教 
處 
計 
畫 
加 
填 
項 
目 計畫成果推廣之參與（閱聽）人數 0  
