 I
 
 
摘要 
 
本研究主旨在發展一套有效的、快速的、自動化物體摘除系統，搭配現今主
流市場上最多人使用的視訊剪輯軟體 VirtualDub，設計成一個專門給自由軟體使
用的外掛模組，不但可強化應用系統之附加價值，更可滿足一般使用者對於物體
摘除工具的迫切需求。我們利用材質合成技術來做為物體摘除的解決工具。首先
我們採用以區塊為基礎的材質合成法，根據一張較小的範本材質，將每一塊被挑
選出的來源區塊以予部份覆疊，進而產生出較大張且具有相同紋理特性的新材
質。然後我們擴大材質合成的用途實施到限制性材質合成，在我們所設計的雛型
系統裡，使用者只需提供來源與遮罩輸入影像，然後系統便可自動利用相鄰的有
效紋理進行填補遮罩所指示的空洞。 
 
關鍵詞：範本為基礎的、限制性材質合成、視訊剪輯與處理。 
 
 1
 
 
1. 前言與研究目的 
 
在影像處理的編輯工具裡或是影片的後製剪輯作業中，想辦法去摘除影像的
部份缺陷是一項非常重要的工作，例如：老舊的相片可能會有刮痕或斑駁的現
象；掃描進來的影像可能會有摺痕出現；拍攝的照片也可能會出現其他遊客。一
般人會藉由影像處理軟體所提供的編輯工具，如雲彩筆(clone brush)，先選擇相
近的色塊，再去不斷的塗抹於要移除的區域。這種擾人、重覆性與容易出錯的工
作，通常需要經驗老道有技巧的設計師，不斷操作才能達成令人滿意的修正效果。 
材質影像一般都可由真實世界中透過數位化方式擷取出來，然而從真實世界中所
擷取到的材質影像往往具有若干缺陷，例如被前景物體所遮掩或陽光投射後，所
產生之高亮點與陰影等瑕疵。材質合成演算法[6, 9]已將這些缺陷予以消除或使
之視覺上很難察覺。因此我們將利用材質合成技術來自動填補移除前景物體時所
遺留下之空隙。 
綜觀國內外當前視訊剪輯或影像處理軟體的主要功能，當下之急似乎需要一
套能有效提供物體摘除或雜訊修復方面的工具。雖然現今相關影像修補的技術已
被廣泛的研究，但通常還停留在影像(image)而非影片(video)，同時開放源碼做為
免費使用且效果令人滿意的系統，似乎付之闕如，於是興起我們去設計發展一套
簡單、好用又有效的物體摘除應用軟體之念頭。我們的實作系統將設計成一個專
門給 VirtualDub [14]使用的外掛工具，如此可發揮此實作系統的最大成效，並擴
充自由軟體 VirtualDub的強大附加價值。 
影像補繪(Image Inpainting)[2, 3]技術能夠還原裂痕，修復小塊的缺陷，就像
是被劃傷的舊相片或沾有污漬等瑕疵；材質合成(Texture Synthesis)[4, 6, 9]技術能
夠填補較大塊的缺陷，適合內容為一致性、規律性與結構性的材質紋理。通常被
前景物體所遮掩的未知背景，其影像內容千變萬化，任何情況都有可能[8]，只
能利用有限的已知線索來臆測未知背景，所以物體摘除技術的發展仍是一個值得
深入研究的挑戰課題。 
 
 
2. 文獻探討 
 
電腦圖學應用領域中，將一張材質影像貼附於三度空間物體的表面，是一項
被廣泛採用的技巧，此種技術被統稱為材質貼圖(Texture Mapping)。材質貼圖不
僅可提升成圖後圖像之視覺效果，亦可降低成圖所需之龐大計算時間。然而，由
於場景中各物體表面大小不一，但材質影像卻為固定大小，故雖然我們可以利用
 3
者皆使用以區塊為基礎的合成取樣法，其為將每一塊被挑選出的來源區塊以予部
份覆疊，以形成另一個新的大張輸出材質，如此作法浮現出兩個問題，一個是如
何挑選下一區塊，另一個是如何處理覆疊(overlap)邊界之問題。與他們方法較大
不同點在於我們提出一個整合的覆疊技術，此新技術整合動態規化(dynamic 
programming)與加權羽化融合(weighted feathering)的優點來處理覆疊邊界，促使
達成平滑過渡。 
首先，輸入的範本材質本身成就了一系列的候選區塊 sB ，我們的演算方法
係採用下到上、左到右的掃描線處理方式，對於每一個要被合成的目的區塊
)(iBt ，它的覆疊邊界區域其像素值早已得知，會被拿來跟所有的候選區塊 sB 的
相同位置像素進行比對，通常 L2 norm距離會被採用以作為評估兩個相互比較區
塊的相似度，如方程式(1)所示為計算兩重疊邊界區域 S與 T的距離，然後一個(或
多個)最佳配對(best-matched)的來源區塊 )( jBs ，其擁有最短距離因而被挑選中，
會被貼附於目的區塊 的原始位置，其中中心區域直接複製，而邊界區域因有重
疊需要進一步處理。 
 
∑
∈
−+−+−=
Ok
2
TS
2
TS
2
TS ] (k))b(k)(b(k))g(k)(g(k))r(k)(r [T) D(S,       (1) 
 
從上述的演算流程中得知其最主要的步驟為覆疊邊界的比較搜尋，於是我們
必需在所有的來源候選區塊中找出與目的區塊擁有最小差距的區塊，我們將此動
作歸類為高維度(high-dimensional)的最接近鄰居搜尋(nearest neighbors search)問
題。當有 n 個要被比對的來源候選區塊，且每一個含有 m 個向量成份，其暴力
(brute force)搜尋法的複雜度將高達 )(mnΟ ，假若改由 kd-tree的技術輔助，其平
均搜尋與最差搜尋時間之複雜度將可有效降低到 )(lognΟ  [1]，但是建構 kd-tree
的前處理時間與空間是必需花費的成本。所以在進行合成的搜尋前，我們會將所
有來源候選區塊的邊界區域組成一個個特徵向量，依此特徵向量建築一個
kd-tree，以利後續的最佳配對搜尋操作。 
要是只針對材質擴張的訴求而言，使用 L-shaped 重疊邊界也就足夠，然而
對於較特定的應用如可貼磚材質 (tiling texture)與限制性合成 (constrained 
synthesis)等，就要再進一步的設計，在 Liang [7]的系統中其建立了四種不同型的
kd-tree以合乎各種邊界情況要求，而我們是採用如下圖 1所示的區塊架構，其包
含一個中心區域與包圍它的四個邊界區域，對於一般的材質合成採用簡化的
L-shaped 即可，而針對具有限制性的材質合成我們將採用 O-shaped 區塊，而去
避免建置多棵 kd-tree。 
 
 5
一旦求出最短路徑我們接著套用混合(blending)的技術，也就是線性內插的
方式融合重疊在一起的兩像素點，讓 0C 與 1 C 表示兩個重疊在一起即將要被混合
的兩像素點，其線性內插所求得的輸出 C，式子為 01 )1( CCC αα −+= 。對於最短
路徑通過的位置其權重α 是 0.5，並且兩左右邊界端點分別為最低 0 與最高 1，
其權重計算函數如方程式(4)所示，其中 p表於該列最短路徑所經過位置。 
 
     



>+
≤
−=
=
=
pk  if    1/2p)-1-p)/2(n-(k
pk  if                             k/(2p)
1np  if                                    0
0p  if                                     1
α
:row  samethe in 1-0..n column in k pixel eachfor 
                (4) 
 
3.2 物體摘除 
 
材質合成技術也可被用來成為解決某些特定問題的工具，舉例來說，老舊的
相片可能會有刮痕或斑駁的現象；掃描進來的影像可能會有摺痕出現；拍攝的照
片也可能會出現其他遊客，因此我們提出的技術能用來掩蓋回復這些另人不悅的
缺陷。 
在我們所設計的系統裡，使用者只需事前準備好四張輸入影像，其分別為：
來源(source)影像、來源遮罩(source mask)影像、目的(target)影像與目的遮罩(target 
mask)影像。然後系統即可自動利用相鄰的有效材質進行填補遮罩所指示的空
洞，並可在極短的時間內計算合成完畢。在來源遮罩影像的白色像素區域代表了
可作為使用的有效候選區塊，而在目的遮罩影像的黑色像素區域則指示了那些區
塊需要進一步被重新合成，所以兩者放在相同一張並不起衝突。利用來源與目的
遮罩影像，我們雛型系統將可快速的合成限制性材質(constrained texture)，而完
全不需要藉助任何的人工干涉。 
 
3.3 軟體之外掛工具設計 
 
VirtualDub在 Free Software與 Open Source社群是一套享有盛名的專業等級
軟體，簡單來說它是一個高效能、高品質的非線性剪輯軟體工具。其支援現今所
有主流影片與圖片的壓縮格式(如 MPEG-2、MPEG-4)，於是它常被用為不同壓
縮格式影片的轉換工具。此外它也提供各式各樣的影像處理濾鏡功能(如色彩、
亮度、對比調整、平滑、銳化、浮雕等)，當添加濾鏡效果輸出後可視為一般的
影像處理軟體之用，而且就算是影像處理濾鏡用途不符合需求，更可自行發展或
修改外掛濾鏡程式，可說是直逼商業化高價位影片剪輯軟體水準。 
 7
4. 結果與討論 
 
4.1 實驗結果 
 
如圖 5所示為我們的實驗結果，從圖中可以顯示出系統有不錯的初步成效，
的確可成功的實現物體摘除。系統是執行在 Pentium 4 - 2.6 GHz及 512M RAM
的個人電腦上，其總共合成時間包含訓練與合成階段如表 1所示都能夠在很短的
時間內完成，結果堪稱理想，但是虛擬記憶體的需求用量較大，這是未來可加以
改進之處。 
 
 來源影像 合成結果影像 遮罩影像 
Hollywood 
   
Pigeon 
Railroad 
Caption 
   
Lincon 
   
圖 5  物體摘除之執行結果 
 9
5. 結論 
 
本研究主旨在發展一套有效的、快速的、自動化物體摘除系統，實用上可作
為影片上商標與字幕的摘除工具，我們的實作系統被設計成一個專門給自由軟體
VirtualDub使用的外掛模組，可當成影像濾鏡來用，主要功能為摘除任何不要的
物體，例如在影片中隨手可見的電臺標誌、字幕、跑馬燈與時間郵戳等。 
對於靜態影像由於沒有任何資訊，所以不知道這些不透明物件背後所隱藏的
真正影像內容為何，我們只好根據材質合成的技術原理來重繪物體被拿掉後所遺
留的空缺。為了達成自動化合成，我們用可見的部份當成訓練資料集合去填補未
知的區域，產生出一個完整、效果佳與一致性的填補結果，例如利用周圍相鄰的
區域像素值與紋理內容。 
系統設計目標為半自動化工具，不需要煩人的操作過程，只要簡單的幾個步
驟就能自動完成物體摘除與填補修復。例如，給定一張輸入來源影像與其對應的
填補遮罩，其用於定義摘除區域，系統會根據現有的已知區域去完成填補未知區
域。 
 
 
參考文獻 
 
[1] S. Arya, D. M. Mount, N. S. Netanyahu, R. Silverman, and A. Y. Wu, “An 
Optimal Algorithm for Approximate Nearest Neighbor Searching in Fixed 
Dimensions,” Journal of the ACM, 45(6), pp. 891-923, 1998. 
[2] M. Bertalmio, G. Sapiro, V. Caselles, and C. Ballester, “Image Inpainting,” in 
Proceedings of SIGGRAPH 2000, pp. 417-424, 2000. 
[3] M. Bertalmio, L. Vese, G. Sapiro, and S. Osher, “Simultaneous Structure and 
Texture Image Inpainting,” IEEE Transactions on Image Processing, 12(8), pp. 
882-889, 2003. 
[4] A. Criminisi, P. Perez, and K. Toyama, “Object Removal by Exemplar-Based 
Inpainting,” in Proceedings of International Conference on Computer Vision and 
Pattern Recognition, pp. 721-728, 2003. 
[5] I. Drori, D. Cohen-Or, and H. Yeshurun, “Fragment-Based Image Completion,” 
in Proceedings of SIGGRAPH 2003, pp. 303-312, 2003. 
[6] A. Efros and T. Leung, “Texture Synthesis by Non-Parametric Sampling,” in 
Proceedings of International Conference on Computer Vision, pp. 1033-1038, 
1999. 
[7] A. Efros and W. T. Freeman, “Image Quilting for Texture Synthesis and 
