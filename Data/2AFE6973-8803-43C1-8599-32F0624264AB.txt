 - 2 -
行政院國家科學委員會補助專題研究計畫第一年成果報告 
計畫編號：NSC－94－2213－E－194－030 
中文摘要 
在第一年的計劃中，我們主要是在無線
感測網路 sensor network 上設計出全新的行
動群播繞徑(mobicast)協定，探討如何有效
率的偵測與收集資料，並且同時減少電量的
浪費，讓整體網路的生命週期更為長久。在
理論研究方面，我們提出一個變形蛋行動群
播繞徑(variant-egg-based mobicast)協定，使
得具有移動性的感測區域在收集資料時，能
夠更精確的預測出需要喚醒的 sensor 
node，以減少電量的浪費，延長 sensor 
network 的生命週期。而針對提高省電效率
的表現，其次我們進一步提出一個具有群聚
性質的變形蛋行動群播繞徑協定，稱為
hierarchical-variant-egg-based mobicast 協
定，省電的表現更加良好。另一方面，我們
在 Bluetooth 上 提 出 overlapping 
communication protocol 以解決 transmission 
holding 的問題，提昇傳效率。在實作成果
方面，我們實作出具備有迴避障礙物能力的
感測自走車，使得感測自走車可以在存在有
障礙物的環境中，進行感測環境的任務，並
且將我們的行動群播繞徑協定實現於自走
車上，以印證我們的理論。 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
Abstract (英文摘要) 
The main goal of the first-year project is 
to design and implement new mobicast 
protocols in sensornets. To consider how to 
more efficiently sense information and save 
energy to extend the network lifetime, we 
propose a variant–egg–based mobicast 
(VE-mobicast). We focus on efficient sensing 
and energy-efficient under the path of a 
mobile entity which includes turns and 
different speed. Further, we propose a 
hierarchical – variant – egg – based mobicast 
routing protocol (HVE-mobiast) for 
sensornets to improve the power consumption 
to extend the network lifetime. Also, an 
overlapping communication protocol on 
Bluetooth WPANs we proposed to solve 
transmission holding problem. In addition, we 
implement the obstacle-free sensing automatic 
car to collect sensing information under an 
obstacle environment. Finally, we implement 
our mobicast protocols on the MICA2 sensor 
nodes to obtain the real experimental results. 
 - 4 -
(a) 變形蛋行動群播繞徑協定 
(VE-mobicast: variant-egg-based 
mobicast) (此研究成果發表 1. 國際期刊
ACM Wireless Networks, 2008. 2. IEEE ICC 
2005 會議) 
在無線感測網路的不具規則性拓樸架構
分佈下，如何有效率的即時預測那些正在 
sleep mode 的感測節點要叫醒並進入 
active mode，準備開始進行資料感測的動作
與資料運算的動作含  data aggregation/ 
diffusion/fusion/compression 和資料傳輸的
動作。要叫醒感測節點的區域範圍稱之為 
forwarding zone，但是真正在某一個時間 ti 
內行動資料收集者(mobile sink node)所有興
趣的感測範圍稱之為 delivery zone，一般
delivery zone 要被包含在 forwarding zone 
內，使的前一個時間 ti 的 delivery zone 與
時間 ti+1 的 delivery zone 能夠在 forwarding 
zone 內形成一個滿足於需求的 connected 
graph，因此在第一年計劃中，我們提出
VE-Mobicast 可以在不具規則性無線感測網
路的拓樸架構下，成功預測出 ti+1 的
forwarding zone，使得可以喚醒正確的感測
節點進入 active mode，以減少感測節點不必
要的電量消耗，進而增加整體網路的 life 
time。目前的文獻上的 mobicast 協定的預測
行徑演算方法只有固定速度和固定方向的
delivery zone，我們提出的 VE-Mobicast 以
variant-egg-based、移動的 pattern 與移動的
角度機率來做進一步的分析與研究。如果
forwarding zone 為圓形的話，假設 sensing 
zone 移動的方向不是預期的路徑，則可能會
造成在 t+1 時間時，sensing zone 會有部份
移動到 forwarding zone 不在的範圍內，也就
是有些無線感測點 forwarding zone 還未叫
醒，而無法立即進行感測的工作。所以，我
們在叫醒相同的無線感測點的原則下，將
forwarding zone 改成 variant-egg-based，如
果 sensing zone 比預期的路徑方向稍微偏 ө
角度，在 t+1 時間時，整個 sensing zone 仍
然會在 forwaing zone 的範圍內，則可立即
進行感測。variant-egg-based 的 forwarding 
zone 可做動態的調整，以適應不同的無線感
測點的分佈，如圖一所示。 
 
 
圖一：Different forwarding zone FVE[t+1] 
 
接著因為我們希望藉由delivery zone的無線
感測點去叫醒 t+1 時間的 forwarding zone 的
無線感測點，所以，兩著之間會有重疊的部
份。接著就是如何由重疊部份的無線感測點
去叫醒整個 forwarding zone 的無線感測
點，如圖 3-4 所示，FVE[t]為 delivery zone，
FVE[t+1]為 forwarding zone，每個 hop 傳送
的 packet 為
11 12 1( , ... ) xVE i t
hP N N N
H
， h
H
則是要將
此 packet forward 的次數， 11 12 1... iN N N 則是
這個 packet 已經到過的 hop。首先，packet
每經過一個 hop，h 和 H 會同時加 1，但如
果一個 hop 同時收到不同路徑送來的
packet，則是要根據不同的位置做不同的
merge。如下列規則:  
1. Let 
1
imerge i i m
merge i
i m
Min hh
H MaxH
≤ ≤
≤ ≤
=  if node is in region 1  
2. Let 
1
imerge i i m
merge i
i m
Min hh
H MinH
≤ ≤
≤ ≤
=  if node is in region 2 
3. Let 
1
imerge i i m
merge i
i m
Max hh
H MinH
≤ ≤
≤ ≤
=  if node is in region 3    
當 merge
merge
h
H
 < 1 則繼續 forward packet，但如果
1merge
merge
h
H
≥ 則不需要再 forward packet。 
而此規則在有 hole 的情況下，也將達
到相當程度的預測成果，利用此值從水平方
向算出偏移的角度，並定此為中心線，也就
是未來物體可能會移動的方向，而我們也將
利用此角度算出 variant-egg-based 的遞送區
域 ， 因 為 使 用 分 散 式 的 方 法 來 設 計
variant-egg-based 的遞送區域，可達到具有
高預測成功率之省電行動繞徑協定。 
針對我們所提出的變形蛋行動群播繞
徑協定，我們亦使用數學分析以深入探討。
我們針對預測精準度、電量使用效率、傳遞
訊息的數量與執行時間，使用數學分析的方
式，算出上述項目的邊界值，以下，我們將
逐一討論： 
 - 6 -
 
圖四：Performance of power consumption vs. 
network density 
 
由於我們的 VE-mobicast 應用變形蛋的概念
於 forwarding zone 上面，因此有著良好的預
測精準度與低耗電量的特性，但是由於精確
的喚醒真正有需要進入偵測的感測節點，是
以依然只會使用少量的 packet overhaed，如
圖五所示，在不同的網路密度下，我們的所
提出來的 VE-mobicast 方法，使用最少量的
packet overhead，進而減少對網路的負擔。 
 
 
圖五：Performance of packet overhead vs. 
network density 
 
(b) 具有群聚性質的變形蛋行動群播 
繞徑協定  ( HVE – mobicast : a 
hierarchical – variant – egg – based 
mobicast) (此研究成果發表 1. 國際期刊
Telecommunication Systems (2008 年接受). 
2. IEEE WCNC 2006 會議) 
 
我們的第二個研究成果，主要針對會移
動的感測區域會有不同的移動速度與角度
會變換的考量，提出了一個改善的行動群播
繞徑(mobicast)協定，使用 cluster-based 的方
法來達成偵測與資料的收集，如圖(六)所
示，我們提出的 HVE-mobicast 繞徑協定使
用 cluster-based 的架構。在 forwarding zone
中，喚醒訊息的傳遞，共分成兩個 phase，
分別是 cluster-to-cluster 與 cluster-to-node 
phases。 
 
圖六：Example of HVE-mobicast 
 
在 cluster-to-cluster phase 中，cluster-head 與
relay node 分別負責傳送喚醒通知，cluster
中的 member nodes 則不需要醒過來傳遞資
料，如圖七所示，在 forwarding zone 中，喚
醒通知只會由 cluster-head與 relay node進行
傳送，而不需要喚醒 member node，因而減
少電量的消耗。 
 
圖七：Waking up process 
然而，在 cluster-head 與 relay node 進行傳送
喚醒訊息前，需要先預估出 forwarding zone
的範圍，我們使用蛋型方程式，當作我們決
定 forwarding zone 的範圍，之後 cluster-head
與 relay node 即可進行傳送喚醒訊息。而在
喚醒訊息的傳遞，我們將一個簡單的控制訊
息 PHVE( h
H
,N11 N12…N1i)放置在喚醒訊息
中，其中 H 為預估要走的步數，而 h 為已
經走過的步數，N1i則是訊息通過的 node 編
號，利用這個編號，我們使 PHVE 的 H 進行
更新，更新程序如圖八 所示。而當 h
H
等於
1 時，則停止喚醒訊息傳送，即到達
forwarding zone 的範圍。 
 - 8 -
 
如圖十三所示，在電量消耗方面，由於
喚醒封包主要是透過 cluster-head 與 relay 進
行傳送，而 member node 只有在 delivery 
zone 接近時，才會被喚醒進行偵測，所以在
大大減少不必要的電量消耗，因此我們所提
出的 HVE-mobicast 有著最少量的電量消
耗。 
 
圖十三：Performance of power consumption 
 
如 圖 十 四 所 示 ， 我 們 所 提 出 的
HVE-mobicast，cluster 中的 member node 只
有在 delivery zone 接近時才會被喚醒，所以
當 delivery zone 的 rotation angle 變化不大
時，即 delivery zone 為依據原估計路線前
進，所以 member node 只有在需要進行偵測
時 才 會 被 喚 醒 ， 所 以 我 們 所 提 的
HVE-mobicast 有著最少量的不需要被喚醒
的感測節點，但是當 delivery zone 的 rotation 
angle 變化極大時，由於 HHVE部分的會預先
通知前方的感測節點 delivery zone發生方向
變化，所以不需要喚醒 member node，因此
大大降低不需要被喚醒的感測節點數量，由
此 可 以 明 顯 看 出 我 們 所 提 出 的
HVE-mobicast 優異之處。 
 
圖十四：Performance of needless wake-up 
nodes 
 
如圖十四所示，在成功喚醒比率上，因
為 cluster中的member node是由 cluster-head
根據 delivery zone 前進狀態而喚醒的，所以
member node 可以更正確的再需要被喚醒時
被喚醒以進行感測工作，所以 HVE-mobicast
有著相當良好的成功喚醒的比率，讓
mobicast 的執行能夠更精準的收集感測的
資料。 
 
圖十五： Performance of the successfully 
woken-up ratio 
 
(c) Overlapping Communication 
Protocol (此研究成果發表 1. 國際期刊
Journal of Network and Computer 
Applications, 2008. 2. Int'l Conf. on Mobile 
Ad-hoc and Sensor Networks, (MSN05), 
2005) 
在第三個研究成果中，我們提出一個
overlapping communication protocol來改善
藍芽中的transmission holding problem。藍芽
在一個Piconet網路中通常會有一個或多個
slave-master-slave通訊存在，當在同一時間
內有多個slave–master–slave通訊要進行
時，在master節點會產生很嚴重的通訊瓶
頸，為了降低這個問題的發生，可以使用通
訊 重 疊 (overlapping communication) 的 設
計，它允許兩個slave節點間可以同時直接通
訊，取代傳統在piconet中需要使用slave–
master–slave的方式。通訊重疊方法是從
time-slot leasing(TSL)方法改善而來，傳統的
TSL方法只提供slave-to-slave通訊的能力，
而我們的方法主要的供獻在於改進TSL，使
他能提供通訊重疊的能力。為了達到通訊重
疊，我們在藍芽WPANs中開發了overlapping 
communication protocol，經由模擬證實我們
開發的protocol可以改善頻寬的使用狀況、
傳輸的延遲時間、網路的壅塞和達到省電的
目 的 。 為 了 克 服 ”transmission holding 
problem” ， 提 出 intra-piconet overlapping 
 - 10 -
1600
1600)()MAX(Q,
450
2250)()MAX(Q 342211 ==== SSpriSSpri
，如圖十七(c)所示。 
 
 Overlapping Time-slot Assignment 
Phase 
 在上一個階段透過記錄的佇列順序可
以決定傳送的次序，而這個佇列順序用這
Overlapping time-slot assignment中來給每個
傳送只一個穩定的時槽。在這個階段有兩種
考量情況，免競爭和競爭時槽階段，以下將
介紹免競至爭和競爭的偵測。在免競爭的條
件下，Overlapping time-slot assignment階段
指派穩定的時槽給傳送者 ij ，在佇列中Qq
比Qq+1更先被處理。 每個Qq在2k時槽時開
始處理(q≦k≦n)，為了利用更高的頻寬，
DH5封包優先選擇傳送資料。由藍芽1.2規格
中，如果master使用DH5封包連續五個時槽
必須使用相同通道，因此，在DH5封包中有
四個空的頻道就有四個空時槽，DH1封包沒
有空的頻道代表有任意空的時槽。因此DH1
無助於使用重疊通訊排程，但master節點只
使用DH3和DH5封包片斷來傳送資料總共
的封包大小無法在沒有使用DH1情況下和
總傳送的資料大小相符，有一些超過的bytes
需要傳送。重疊通訊排程計算適當的封包型
態，讓額外的bytes數最小，並且指派封包到
空的時槽傳送資料，用來改善TSL，傳送者
選擇適合的封包型態可以改善頻寬和減少
能源消耗，我們設n_DH5和n_DH3來各自表
示DH5和DH3各自的總封包量，Dij表示從Ni
傳送Nj的資料量，Excess代表額外的傳送，
針對每一個傳送者，master根據封包型態分
散規則來安排適合的封包型態，表示如下： 
)min(1833_3395_ ExcessDDHnDHn ij +=×+×
DH5數量為339，DH3數量為183bytes，封包
型 態 分 佈{ }
pijijsijij
pdpdpdpdPDij ,,,,,
10
……= ，使用
記錄p+1封包型態從Ni傳送Nj。 ijspd 代從Ni
傳送Nj的第t個傳送型態，0≦s≦p，p的值是
n_DH5+n_DH3，其中  n_DH5 和  n_DH3 
和 ijspd 有 關 。 如 圖 十 七 (c) ， Ds1s2 是
1350bytes 由 4 個 DH5 組 成 ，
PDs1s2={5,5,5,5}，而Ds1s2=900由三個DH5
組成，PDs1s2={5,5,5}，master節點從規則
中取得 ij 的 ijPD 。透過封包型態分佈，重疊
時槽指派階段指派穩定的時槽來改善TSL
的資料傳送，時槽WSij定義在 ij 中第i個醒
來 的 時 槽 ， 時 槽 表 示 為{ }
pijijsijij
sosososoSOij ,,,,,
10
……= 用來記錄
q+1個時槽從Ni傳送到Nj，其中0≦t≦q，
SOij 定義第 t個時槽從 i傳到 j， SOij 累積 
PDij到PDji。使用改善的TSL，master節點宣
布每個slave節點的WSij和SOij，而slaves節點
在指定的時槽WSij中醒來，並且服從在SOij
時槽傳送資料。 
使用改善的 TSL，要使用一個暫存的
piconet ， 在 這 個 temp-piconet 中 要 有
temp-master 節點和原始 slave 節點兩個角
色，當改善的 TSL 執行後，temp-piconet 中
的一個 slave 節點會轉成 temp-master 節點，
關於重疊通訊的排程，master 節點在 BTIM
時指派角色、WSij 和 SOij 給傳送者，如果
Dij>Dji，Ni 是 temp-master 節點而 Nj是 slave
節點，如果傳送是從 master Ni傳送到 slave 
Nj，則 master 節點指派時槽給 ij 如下： 
⎩⎨
⎧
+=
+=
+ sjitjitijij
sijtijtjiji
pdsosoSO
pdsosoSO
1
:
:
， 0jiso  
初始為零。在計算 ijSO 時，如果 master 節點
設完 ijPD ，則 tpijpd + 的 ACK 回應設成 1，
master 節點指派最近的空時槽 WSij 和
WSji=WSij+pdij1。WSij+ WSji 是真實的時
槽 ， 例 如 在 圖 十 七 (c) 的 21SS ，
bytesD SS 135021 = ，  { }30,20,10,021 =SSSO ，
bytesD SS 90012 = ， { }35,1525,512 =SSSO ，
0
21
=SSWS ， 512 =SSWS ，而所有 21SS 間傳送
的處理狀況如圖十八(a)所示。 
 
S3
S4
S1
ACK
0      1     2     3      4      5     6     7      8     9     10   11    12   13   14    15   16    17   18    19    20   21  22    23
S1, temporary master sending
S2, slave sending
24   25    26   27    28   29   30    31    32   33   34    35  36   37   38   39
C(0) C(5) C(10) C(10) C(20)
C(25) C(30) C(35) Slot
(a)
S4, temporary master sending
S3, slave ACK sending
24   25   26    27   28   29    30    31   32   33   34     35  36    37   38   39
USED USED USED
USED USED USED Slot
USED USED
USED
…
USED USED USEDUSED USED
ACK ACK
ACK ACK ACK ACK
ACK ACK
Block slot
(b)
(c)
0     1      2     3      4     5      6      7     8     9     10   11    12    13   14   15    16   17   18    19    20   21  22   23
0     1      2     3      4     5      6      7     8     9     10   11    12    13   14   15    16   17   18    19    20   21  22   23
S1 → S2 (DH5) S2 → S1 (DH5)
S2 → S1 (DH1)
S1 → S2 (DH5) S1 → S2 (DH5)
S1 → S2 (DH5)
S2 → S1 (DH5)
S2 → S1 (DH5)
S4 → S3 (DH5) S4 → S3 (DH5) S4 → S3 (DH5)
S4 → S3 (DH5) S4 → S3 (DH5) S4 → S3 (DH3) S4 → S3 (DH3)
slot collision prediction
S4 → S3 (DH5)
S4 → S3 (DH5)
slot collision avoidance
M
S2
S3
S4
S1
M
S2
temp -master
temp -master
 
圖十八：Packet type changing 
 - 12 -
回顧前面 queuing scheduling階段和
overlapping time-slot assignment階段，
relay節點計算時槽令WSiR，SOiR，
WSRi，SORi為接收資料，WSRj，SORj，
WSjR，SOjR為接收資料。Relay節點替
piconet Pi維護一個計數器Ci，其中0≦
Ci≦Cmax，為了避免starvation，我們讓
Cmax為常數，如果relay節點在piconet Pi
的傳送窗格中將資料傳送完，則Ci = 
Ci-1，否則Ci = Ci+1。Relay節點基於計
數器Ci來指派 twi傳送時槽給piconet 
Pi，其中TW為relay節點傳送傳送窗格
的大小，relay節點透過下列方程式指
派 twi 傳送時槽給每個 piconet Pi ，
∑ =×= TPi i
i
C
CTWtwi
1
，TP為relay節點參
與的piconet的數量，為了piconet Pi所
設 的 時 槽 大 小 滿 足 於
WindowSize{ } { }{ } { } ijRjRRjRj RiRiiRiR twSOWSSOWS
SOWSSOWS
≤++
++
)
(
∪
∪∪
 
(S2)在ST2，relay節點傳送計算結果給master
節點，master節點增加WSiR+SOiR和
WSjR+SOjR到US集合。 
(S3) 在ST3，master節點廣播排程給所有的
slaves節點，slave節點遵照排程進行通
訊。 
relay節點R參與 piconet1 和 piconet2 的
BTIM的三個特別的時槽，R與M1、M2交換
通訊的資訊，和接收他們兩個的排程，透過
我們的方法，relay節點傳送接收資料如圖十
九(b)所示，與現行的藍芽傳輸方式圖十九(a)
做比較，我們的方法可以減少延遲時間和改
善scatternet throughput。 
 
S1
M1
S4
M2
R
Other  Piconet
Other  Piconet S2
S3 S1
M1
S4
M2
R
Other  Piconet
Other  Piconet S2
S3
(a) (b)
Piconet  2
Piconet  1
Piconet  2
Piconet  1
 
圖十九：Inter-piconet communication 
 
實際模擬傳輸延遲的情況，在一個
piconet中，如圖二十，master節點用RR方式
輪詢讓slaves和slaves經由master節點通訊到
其他的 slaves，但TSL、DSA、OCP使用
slave-to-slave直接通訊，使的傳輸的延遲時
間是RR方式的一半，除此之外，DSA和OCP
使用的主要方法和TSL接近，因此TSL、
DSA、OCP有相同的傳輸延遲時間。 
 
 
圖二十：Transmission delay vs. device 
number 
 
觀查scatternet通訊使用RR方法，relay
節點傳送和接收封包透過master輪詢方式，
如果master節點傳送封包給relay節點，但
relay節點沒有立即的傳送給另一個master節
點，那傳送delay時間便會增加許多。在OCP
中，relay節點有高的優先權決定哪個時槽要
傳送或接收，relay節點透過計算自己有空的
時槽來決定一個穩定的時槽來傳送和接
收，當relay節點關畢時槽，relay節點改用重
疊通訊排程來傳送和接收封包，所有傳送的
slaves節點不能因為要傳送給piconet中的
relay節點而停止，如圖二十一，OCP減少在
scatternet中的傳送延遲時間。在RR、TSL、
DSA方法中，同一個piconet內同一時間只能
有一對裝置在通訊，當一對裝置已經在通
訊，所有的其他裝置會保留封包並等待下一
次的通訊，在RR中，封包透過master節點
relay資料，而TSL建立slave-to-slave直接通
訊，RR平均等待傳送的評估如下，一個
piconet有k個節點，每個slaves花Ui時間上傳
(slave送至master)，花Di時間下載(master送
至slave)，其中1≦ i ≦m。平均等待時間為： 
m
UiDi
RR
m
n
n
i∑ ∑= −= += 1 11 )(  
 
 - 14 -
 
圖二十四：感測自走車隊迴避障礙物追蹤光
源 
 
 
圖二十五：具有避障礙物能力的感測自走車 
SRF04 的 Timing 藉由一個 10uS 脈衝
來驅動 SRF04 發射超音波。SRF04 會發出 8 
cycle 頻率 40KHz 的超音波並且使迴響線
（echo line）拉高，當偵測到超音波的迴響
時會再次將迴響線（echo line）降低。如果
沒有偵測到超音波的迴響，SRF04 還是會再
36ms 後將迴響線（echo line）降低，代表沒
有接收到超音波的迴響。SRF04 提供一個迴
響的脈衝，此脈衝與距離成比例。如果脈衝
的寬度測量出來的單位是 uS，那麼將此測
量出來的值除以 58 即是到障礙物的距離
(cm)；除以 148 是（inches）。 
 
圖二十六：SRF04超音波發射器 
 
使用 SRF04 模組進行迴避障礙物，我
們主要考量的是方形與ㄇ形障礙物。方行障
礙物為我們演算法中基本考慮的障礙物，當
自走車馬達運轉後，程式便不斷的去觸發超
音波。當超音波偵測到障礙物，自走車即左
轉後直行，直行兩秒後再次觸發超音波，如
果沒有偵測到障礙物則右轉，回到一開始直
行的狀態，斷觸發超音波，如果此時前方已
沒有偵測到障礙物，代表已經避開了方行障
礙物，則繼續直行，回到一開始直行偵測的
模式。如果超音波還有偵測到障礙物則代表
還沒避開方形障礙物，則再次左轉，繼續避
障程序，如此不斷偵測，即可避開方型障礙
物。ㄇ行障礙物一開始為方行障礙物，當左
轉後又偵測到前方又有障礙物，即回 L 型或
是ㄇ型障礙物，因為自走車只再前方裝在一
個超音波，因此無法判斷前方障礙物靠左或
靠右，只能預設往左轉。因此專題中，我們
把 L 型及ㄇ型障礙物歸類為同一類。承上，
在左轉後前方又偵測到障礙物，變數 T 則記
為 1，我們知道為ㄇ型障礙物，跟方型障礙
物不同是當超音波未偵測到障礙物右轉直
行後，還會在一次右轉，因為自走車先前已
經左轉兩次，需要再右轉兩次才能回到原方
向。障礙物迴避的流程。 
 
三、第一年結論 
在第一年的計劃中，我們針對當 sensor 
network 實際應用時，感測區域可能會以不
定速度、不定方向發生位置上的移動，而提 
出 VE-mobicast 與 HVE-mobicast 行動群播
繞徑協定，達到精確的感測與有效率的收集
資料，同時又兼具省電的表現，目前兩個研
究成果均具體發表在國際重要的 IEEE 會議
和 ACM 期刊。而在實作方面，我們亦利用
SRF04 超音波模組，搭配我們自行開發出的
感測自走車，結合出能夠迴避障礙物的感測
自走車，使感測自走車能夠在現實環境中使
用，同時也將我們所提出的 mobicast 理論，
實作於其上，以印證我們的 mobicast 理論與
實現 sensor network 的運作 
根據上述結果，本子計畫已具體完成第
一年的研究與實作工作。 
 
 
 
 16
一、前言 
在第二年的計劃中，我們主要是在無線
感測網路 sensor network 上設計出能夠使感
測網路的 life-time更維持久的省電協定以及
在隨建即連 ad-hoc 網路上利用 MIMO 技術
進而提高 throughput 的 QoS 協定與利用
ring-based 概念而能夠自動化取得與設定
ad-hoc 網路位置的協定。 在理論研究方
面，我們先提出一個利用中國餘數定理而達
到省電目的的 C-MAC 協定，探討如何有效
率的喚醒感測節點進行資料收集，同時減少
電量的浪費，讓整體網路的 life-time 更為長
久。我們亦提出了在 ad-hoc 網路上面使用
MIMO 技術而達到提高 throughput 的
Bow-Based QoS 路由繞徑協定，利用 MIMO
通訊中的 range-link 的通訊技術，克服網路
中傳輸 bottle-neck 的地方，而使得能夠提供
QoS 的保證，使整體網路的傳輸效益更好。 
我們同時也在 ad-hoc 網路上提出利用
ring-based 概念的網路位址自動化設定的協
定，使 ad-hoc 網路上的節點可以自己取得網
路位址，同時避免位址不足與位址重複的問
題，讓位址設定的效率提高。 在實作成果
方面，我們實作出具備有自動控制得飛行直
昇機 UAV (Unmanned Aerial Vehicles)，讓直
昇機可以根據感測到的資訊，自動飛往事件
發生地點進行感測任務，使事件現場可以立
刻在控制之下，減少災害造成的損失。 
 
二、研究目的 
在第二年的計劃中，我們針對感測網路
的省電效率的提昇、ad-hoc 網路中 QoS 傳
輸保證與網路位置自動設定，而分別三個理
論研究結果，分別是： 
1. 在 感 測 網 路 上 利 用 中 國 餘 數
(Chinese-Remainder-Theorem)定理而達
到 在 MAC 層 的 有 效 省 電 協 定
(C-MAC)[3] 
2. 在 ad-hoc 網路上使用 MIMO 技術的
Bow-Based QoS 路由繞徑協定[4] 
3. 在 ad-hoc 網路上利用 ring-based 的網路
位址自動化設定 DRAA 協定[5] 
在第一個研究成果中，我們在無線感測
網路上利用中國餘數定理的特性，研究出在
網路 MAC 層的省電協定，稱之為 C-MAC。
我們利用中國餘數定理中，質數之間必定互
質的特性，使感測節點可以互相自動避開彼
此之間醒過來的時槽，因而避免彼此之間會
發生通訊 collision 的現象，更者，因為質數
有無限個的特性，是以我們可以讓感測節點
根據所被設定的感測工作的不同，由感測節
點自行挑選最適當的甦醒時槽，使事件通知
的延遲縮短到最小。我們使用模擬程式去驗
證實驗結果，證明達到了兼具 low power 
consumption 與 low latency 的特性。 在第二
個研究成果中，我們在 ad-hoc 網路上，利用
MIMO 的技術，提出了 Bow-based QoS 路由
繞徑協定，我們稱之為 BowQR。 在網路傳
輸中，常常會發生因為某些路徑上的節點是
唯一，導致網路傳輸都必須通過該網路節
點，該網路節點即形成了網路效率的
bottle-neck。我們利用 MIMO 技術中的
diversity gain (range-link)的方式，建立出
multi-path structure 以進行傳輸，我們稱之為
bow，藉由 bow 的建立，克服了網路效率的
bottle-neck。同時，因 range-link 具備了長距
離傳輸的特性，更可以使傳輸路徑整體縮
短，所以利用 bow 所建立的傳輸路徑，因
整體的 hop 數更少，而達到更快傳輸完成的
現象。根據這兩個特性，讓我們可以在
ad-hoc 網路上利用 MIMO 技術而提出網路
傳輸品質服務的保證，Bow-based QoS 
routing protocol，實驗結果證明在提高
throughput 與提供 QoS 服務的成功率，皆有
明顯的改進。在第三個研究成果中，我們在
ad-hoc 網路上，利用 ring-based 開發出能夠
自 動 取 得 並 設 定 網 路 位 址 的 address 
autoconfiguration protocol。本研究針對分散
式 的 ring-based 位 址 自 動 設 定 協 定
(DRAA)，使網路位置設定上可以避免使用
大量的廣播封包與位置發生重複的問題，而
且提高位址取得的速度，達到低 latency 與
低 communication overhead。DRAA 協定使
用邏輯上的 ring 去分配位址，利用少量的控
制訊息去分散位址資源，此外以可以快速判
定無效位址，因而回收該位址，減少資源浪
費，實驗結果說明能夠有效快速的取得位址
與維持位址資源的平均分布。除了三個理論
成果之外，在第二年計劃中，我們亦實作出
可以自動飛行前往事件發生地點進行感測
任務的 UAV (Unmanned Aerial Vehicles)，透
過整合 UAV、sensor network 與 Sensor 等設
備之後，使得直昇機能夠在無人控制飛行的
狀態下執行空中監測的任務，並將拍攝到的
畫面回傳給監控者，如此可以快速發現，立
 18
Li的值： 
,
1
min( )
k
i i s
s
L p
=
= ∏ , where ( )i i iL Nβ≥ +  
Coordinator node Ci會將 Li、pi與剩餘可使用
的餘數序列 r_seti 宣佈給所有 cluster 內的
sensor node。 
Step 4: Sensor node Ni,j 將會從 r_seti挑選一
餘數數列 ri,j={i-1, r2,…, rs, …, rk}，並且通知
coordinator node Ci 其所選的餘數數列，之
後，coordinator node Ci再次宣佈 r_seti給所
有 cluster 內的 sensor node，直到 cluster 內
所有的 sensor node 都選好為止。 
Step 5: 每一個 sensor node Ni,j 根據其所選
擇的餘數數列 ri,j 開根據始自行計算喚醒時
槽 ,
^
, , ,
1
( ) modi j
x k
s th
i s i s iN i j
s
S t P r L−
=
= ∑ ，其中， ,s thi jr − 為
餘數數列中，第 s 個餘數，Pi= {Pi,1, Pi,2, …, 
Pi,s, …, Pi,k} 代 表 CLi 的 結 合 數 列 ，
, ,
1,
k
i s i u
u u s
P p
= ≠
= ∏ 。 ti={ ti,1, ti,2, …ti,s, …, ti,k}為
CLi 的基底數列，ti,s 是一最小正整數滿足於
, , ,1(mod )i s i s i st P p≡ 。 為了要節省電源，當
時槽不是 ,
^
i j
x
NS 時，sensor node 就保持睡眠狀
態以節省電力，每一個 sensor node 遵照其
所計算出的 ,
^
i j
x
NS 進行 regular data 的傳送。 
Step 6: Coordinator node Ci需要甦醒過來接
收資料的時槽 ,
^ ^
1
i
i i j
x xN
C N
j
R S
=
=∪ 。 
C-MAC 的 regular data 傳輸機制的運作
方式如圖(一)所示。 
 
圖(一)、Example of C-MAC 
 Burst data transmission mechanism 
針對突發事件需要緊急傳送的資料，我
們亦提供 burst data transmission mechanism
機制來進行針對 burst data 傳送，減少傳輸
時的 latency。給予一 coordinator node Ci與
sensor node Ni,k, Ni,k+1, …, Ni,k+n。運作方式描
述如下： 
Step 1: Sensor node Ni,k, Ni,k+1, …, Ni,k+n 傳送
burst data requests , , 1 ,, ,...,i k i k i k n
x x x
N N NB B B+ + 給
coordinator node Ci 在時槽 ,
^
i j
x
NR 中的 TR 
section。若是 coordinator node Ci 偵測到
collision 的發生，就表示有多個 sensor node
欲傳送 burst data，或是成功接收，則表示只
有一個 sensor node 欲傳送 burst data。 
Step 2: Coordinator node Ci宣佈兩個臨時指
定的時槽
^
1
i
st
CB 與
^
2
i
nd
CB 給欲傳送 burst data 的
sensor node。
^
1
i
st
CB 與
^
2
i
nd
CB 計算方式如下列式
子所示： 
,
^ ^
1
1
( min( ))mod ( _ )modi ji
x k
st
i s s used iNC
s
B R q L t Pr set L
=
= + ≠ ∑
,
1^ ^
2
1
( min( ))mod ( _ )modi ji
st k
nd
i s s used iNC
s
B B q L t Pr set L
=
= + ≠ ∑
其中 q 為一正整數，r_setused 為被使用過的
餘數數列的紀錄。Sensor node 可以利用臨時
指定的時槽
^
1
i
st
CB 與
^
2
i
nd
CB 進行 burst data 的傳
送。 
Step 3: 在臨時時槽
^
2
i
nd
CB 中有包含著 TR 
section 與 B section，其中 TR section 一樣是
coordinator node Ci用以接收 sensor node 的
burst request 用的，之後 coordinator node Ci
在 B section 宣佈下兩個臨時時槽，在 TR 
section 中，若是還是偵測到 collision 的發
生，則回到第二步繼續執行。Burst data 
transmission mechanism 運作情形如圖(二)所
示。 
 
圖(二)、Burst data transmission mechanism 
 
利用模擬程式去預測 C-MAC 的執行效果，
其在省電的部分，有著優異的表現，如圖(三)
 20
node。當 bow 路徑成功建立時，destination 
node 會回傳一 BowQ_REP，以告知路徑上
的點與 source node 該路徑已經建立完成。 
Phase 3: 由於 ad-hoc 網路舉有拓樸不定
性，所以可能會因為移動性而造成所建立的
連線中斷，此時就會觸發 source node 要求
維護路徑到 destination node 的訊息，中斷的
node 會自動根據 local information 去尋找是
否有其他適合的代替點以繞過中斷的地
方，以進行再次連結。圖(六)為 BowRQ 協
定運作的情形。 
 
圖(六)、Example of BowQR 
實驗結果方面，我們測試 BowRQ 在特定要
求的頻寬下，QoS 提供的成功率為何，如圖
(七)所示，即時當頻寬要求達到連續 8 個
time slot 時，依然可以保有 60%成功率的良
好表現，證實 BowQR 可以應付絕大多數的
頻寬要求。 
 
圖(七)、Performance of success rate vs. 
bandwidth requirement 
接著我們要探討 throughput 與 range-link 之
間的關係，如圖(八)所示，我們發現，就算
路徑上全部皆由 range-link 所建立，其
latency 增加並不會很多，而且在網路密度
低、移動速度快時，大量的使用 range-link
更可以降低 latency 而使 throughput 提高，
證實了使用 range-link 的使用，在減少 hop
數時亦不會造成 latency 增加太多，甚至可
以降低 latency。 
 
圖(八)、Performance of throughput vs. ratio of 
the range-link period 
 
(c) RAA: Ring-based Address 
Autoconfiguration Protocol 
(此研究成果發表 1. 國際期刊 Wireless 
Personal Communications, 2007. 2. Int'l 
Conf. on Mobile Ad-hoc and Sensor 
Networks, (MSN05), 2005) 
 
在行動隨意網路中，IP 位址指派是一個
很重要的問題，尤其在第四代行動網路系
統，以全 IP 為基礎的異質型網路中更顯的
重要。現存的解決方法大多採用分散式演算
法，因此在(1)維護可用的 IP 位址與(2)確保
沒有位址衝突時，導致大量的廣播(broadcast)
訊息發生。在本篇論文中，我們提出了一個
以環為基礎的位址自動組態協定來設定節
點的位址。我們主要的工作鎖定在分散式的
以環為基礎之位址自動組態協定(DRAA)，
它具有低延遲時間、低通訊負載與高不中斷
連線的優點。DRAA 協定是一個低延遲時間
的解決方法，因為每個節點獨立地指派 IP
位址並且在新節點加入網路時，不需要做位
址衝突偵測(DAD)。通訊負載也因邏輯環的
應用而明顯的減低，因為邏輯環可使用少量
的單一傳播(uni-cast)來分配與取回無效的
位址資源。此外，DRAA 協定在網路聚合
(network merging)時，同時檢查了 TCP 連線
與網路節點的數量，使位址衝突的節點能盡
量選擇在較小的網路中重新加入網路，使得
節點能以較快的速度重新建立連線並繼續
傳輸資料。為了能降低更多的網路負載並提
供位址資源能平均分配在每個節點，我們進
一步討論一個集中式的以環為基礎之位址
自動組態協定(CRAA)。CRAA 協定可使位
址資源平均分配給每個節點，並且在網路聚
合時減少大量的廣播訊息。基於以上的理
由，我們的解決方法適合在大型的行動隨意
 22
最 後 的 比 較 為 breaking on going 
connection，在此可以明顯看出我們所提出
的方法具有高度的可靠性，當 node 數越多
時，其他方法造成 connection fail 的數量隨
之增加，可是在採用我們的方法後，fail 
connection 的數量控制在一定的比例之下，
顯示出我們的方法能快速的得到 IP 位址並
進行網路的封包傳送。本篇論文提出以 ring
為邏輯架構的 protocol 去解決 IP 分配與管
理的問題，此架構能讓 IP 的分配不需要
DAD 的檢查，在與現有的其他方法比較，
我們提出的兩種變形之一的 DRAA 有較低
的 latency 與 overhead，並在 uninterruptible 
connections 中有更為出色的表現，此
protocol 適用在較小型的無線行動隨意網路
中。另一變形 CRAA 則有更低的 message 
overhead，在位址分配上有更好的效率，因
為為集中式，使得在容錯方面的能力大增，
適合較大型的網路架構。由於兩種變形的
protocol 以分散與集中兩種不同的基礎，因
此在優缺點上閉不能兼顧兩種情況，必須依
照當時的網路情況決定使用哪一種位址分
配最有利。 
 
圖(十)、The number of broadcast messages 
with the varied number of nodes 
 
圖(十一)、Resource consumption times with 
the varied number of nodes 
四、實作研究成果 
現代生活環境越來越複雜，諸多事件快
速發生，唯有快速發現，立刻查明事件並回
報監控者才能快速提出應對，以減少事件所
帶來的影響。空中監控感測飛機(UAV)就是
其中的應用。本研究的目的在於研究設計具
有自主飛行能力的無人飛行載具(UAV)，其
中飛機機種以旋翼機為主，透過整合
UAV、sensor network 與 Sensor 等設備之
後，使得旋翼機能夠在無人控制飛行的狀態
下執行空中監測的任務，並將拍攝到的畫面
回傳給監控者。如圖(十二)所示，當 sensor
感應到火災時，立刻利用由 MICA2 所建立
的 wireless sensor network，將火災事件通知
傳送到感測飛機 Sensor Flight。感測飛機立
刻起飛，並根據由 MICA2 所指示的路徑，
飛到火災現場進行感測，當感測飛機感測到
火災位置後，立即開啟 CCD 進行影像拍
攝。將經由 CCD 拍攝的影像交給 Stargate
處理後，利用無線網卡將影像透過 AP 傳送
到監視者端，監視者收到警告後，可以即時
的看到火災事件現場影像，得知最新的情
況；讓監視者即使身在遠方，並且在沒有人
員傷亡的風險下，依然能夠掌握第一手的資
訊，因而能夠決定如何處理以降低損失。 
 
我們的系統架構如圖(十三)所示，我們將
mica2、8051 飛行控制元件、超音波感測原
件與 CCD 搭在於直昇機 T-REX 450SE 上
面，使其在 8051 的指示下，可以自行飛行，
再配合 mica2 與地面上的 nica2 通訊，獲得
所要前往的位置，使直昇機能夠飛往事件發
生地點進行資料的感測。其中，我們利用
SRF04 偵測與地面的高度，以控制直昇機飛
行時的飛行高度及利用三軸陀螺儀控制直
昇機的飛行水平，使機身可以正確修正飛行
角度。 
圖(十二)、情景模擬流程圖
 24
 
圖(十九)、空中監控感測飛機(UAV)完成圖 
 
四、第二年結論 
在第二年的計劃中，(1)我們提出了具有
高效率省電的 C-MAC protocol (此研究成果
已發表在 IEEE ICC 2007 會議與 Journal of 
Information Science and Engineering, July 
2007)，使 sensor network 運作的 life time 更
長，同時又可以具有 low latency 的特性。(2)
我們在 ad-hoc 網路上利用 MIMO 技術提出
了 BowQR 協定(此研究成果發表在 ACM 
International Wireless Communications and 
Mobile Computing Conference, Hawaii, 
August 2007)，提昇 ad-hoc 網路在傳輸方面
的效率，克服 bottleneck 的問題，使整體網
路傳輸表現變好。(3)我們提出了解決 ad-hoc
網路位址取得的問題(此成果發表在國際期
刊 Wireless Personal Communications, 
2007)，DRAA 協定使 ad-hoc 網路上的節點
可以有效率的自動取得與設定網路位址，使
網路位址分配效率提高。 
在實作的工作推動，我們自行開發出能
夠自動飛行的 UAV，使直昇機可以自動根
據感測資料前往事件發生地點進行資料詳
細感測，快速找出問題點，減少災害的損
失。 
根據上述成果，所以本子計畫具體完成
第二年的研究工作 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 - 26 -
一、研究目的 
在第三年的計劃中，我們針對路由傳輸
品質保證(QoS routing)問題，提出三個理論
研究結果，分別是： 
1. 合作式路由傳輸品質保證協定 [6] 
2. 多重交錯聯結式路由傳輸品質保證協定
[7] 
3. Time-slot leasing-based QoS routing 
protocol [10] 
在第一個研究成果，我們在 MANET 的
網路中使用有向性天線，提出一個新的 QoS
路由協定。QoS Routing Protocol 需要更高的
頻寬和穩固的連線。在無線網路中，路由的
路徑是透過無線連接的 multi-hop 所建立，
而連線又是建立在不穩定的訊號強度上，因
此連線的品質和穩固的連線是非常重要
的。Cooperative QoS Routing Protocol 可以
完成 QoS 的要求，以往當連線中斷或者訊
號品質很差時，結點就必需重新尋找路由，
而使用具有多個天線的 Cooperative QoS 
Routing Protocol 可以改善通訊的品質和頻
寬問題。在同一時間內不同天線可以各別處
理傳送和接收的事件，因此可以減少頻寬的
需求。更有效率的使用保留的 time slot 和空
間，且多個連線能讓路徑更加穩固。
Cooperative QoS Routing Protocol 增加頻寬
來實現 QoS 且提供更高的成功率建立多條
路由路徑。當連線有問題時，Cooperative 
QoS Routing Protocol 可以立即尋找另一條
路徑提供安全的頻寬需求。有多個天線的
Cooperative QoS Routing Protocol 可以在同
一時間內傳送多個訊息給周遭的鄰居，可以
改善 throughput。在 Cooperative Routing 
Protocol 中，要保留 time slot 並且不同的傳
送者傳遞給同一個節點是個很複雜的瓶
頸，在全向或指向天線模型中，不同的發送
者有不同的目的地，而在同一個方向裡只能
保留一個 time slot 給一個目的地，因此增加
了點到點之間的延遲和壅塞的發生。使用多
根天線，可以在不壅塞的情況下在同一個
time slot 傳送不同的訊號。在第二個研究成
果中，我們在 MANET 的網路中使用有向性
天線，提出一個新的 QoS 路由協定，此方
法在 bandwidth-based 的 QoS 路由機制中提
出 multi-path 的觀念。在 MAC 層中，我們
採用 CDMA-over-TDMA 模式，此 QoS 路由
協定決定點對點的頻寬計算和頻寬蒐集來
自來源節點到目的節點，當網路頻寬被嚴重
限制時，此路徑結合多重交叉連結，稱為
shoelace。因為使用有向性天線的特性，交
叉連結可以同時傳輸資料不會互相干擾。研
究發展一個 shoelace-based QoS 路由協定去
定義一個 shoelace 在 MANET 網路，更容易
滿足頻寬需求去建構一個 QoS 路由。
shoelace-based 路由從來源節點到目的節點
會建構出 shoelace 結構的子通道。經由定義
出 shoelace，shoelace-based 方法可以提供很
高的成功率建構出符合 QoS 要求的路由。 
二、研究方法 
在第三年的計劃中，我們主要探討路由
傳輸品質保證協定(QoS routing protocol)，針
對 MANET 上經常會遭遇到的頻寬傳輸瓶
頸問題，我們共提兩個方法，合作式路由傳
輸品質保證協定(Cooperative QoS routing 
protocol)與多重交錯聯結式路由傳輸品質保
證 協 定 (Shoelace-based QoS routing 
protocol) 。 在 Cooperative QoS routing 
protocol 中，我們採用多組天線同時合作的
概念來提昇傳輸頻寬，因而達到頻寬保證的
要求，另一方面，我們更使用多重交錯聯結
的 概 念 (Shoelace-based) 而 提 出
Shoelace-based QoS routing protocol，利用
multi-path 的方式，提昇網路傳輸頻寬，與
突破網路傳輸瓶頸，以達到傳輸品質保證的
目的。以下，我們將分別說明合作式路由傳
輸品質保證協定(Cooperative QoS routing 
protocol)與多重交錯聯結式路由傳輸品質保
證 協 定 (Shoelace-based QoS routing 
protocol)。 
 - 28 -
在Cooperative Routing Protocol中，每個
節點內的鄰居表格和路由表格所記錄的資
料不同，下列敘述鄰居表格、路由表格、和
其他操做方式： 
◆Rt table(ri): node ri的路由表，天線的方位
被加進路由表以記錄下一個hop的位置。 
◆nei table(ri): ri 的鄰居表格 ，用來記錄一
個hop或兩個hop的鄰居資訊。 
◆RREQ list(ri): 從node ri 接收到鄰居的 
RREQ訊息。 
◆nei list(S, ri): 透過一個hop ri接收到S的兩
個hop鄰居訊息。 
◆cooperative list(ri): node ri 的合作連線。 
◆intersection(S, ri): Node S 找到在他自和
和鄰居ri 之間的所有有空time slot的交會
點。而鄰居ri 必需為於不同的天線方向。 
根據交通流量和網路拓僕，有空time slot的
節點也會不同。假設有一S來源節點要傳給
目的節點D，其他的中繼節點是ri。下面有
兩種不同的RREQ初始方式： 
Case1：S所擁有的time slot多於頻寬的要求。 
Setp1 ： S 從 nei table(S) 尋 找 ri ，
i=1,2,3…,k，S選擇包含有空的time slots
和 bean degree透過 intersection(S, r1), 
intersection(S, r2),intersection(S, r3), · · ·, 
intersection(S, rk)。S從表格中取得有相
同空的time slots的節點。 
Setp2：如果ri是另人滿意的intersection 
function，ri就被記錄到RREQ list中。
RREQ列表被建成
⎥⎥
⎥⎥
⎥⎥
⎦
⎤
⎢⎢
⎢⎢
⎢⎢
⎣
⎡
kr
rS
r
r
#
3
2
1
。RREQ訊息
只被傳送給在列表中有的節點，以減少
控制訊息的數量。如果nei_table(S)是空
的就代表附近沒有鄰居資訊。RREQ會
透過每一個bean廣播出去。RREQ列表
記錄透過記錄每一個bean sector取代ip 
address。 
Setp3：在RREQ初始完之後，S和D被
設定ip位址，cooperative_flag被設為0。
Merge_node=null。Hop=0。Bw為上層
所要求的值，bid設為唯一的一個數字。 
Case2：當S所擁有的time slot多於頻寬的要
求，但S尋找nei_table(S)找不到可以提供可
靠頻寬的ri。 
 Setp1：S找不到有有可以提供足夠頻寬
的鄰居，合作連線就會被啟動，並且S從鄰
居表格中計算所有鄰居總共有的 time 
slots，S使用intersection(S,ri)，i=1,2,3…,k，
來取得每個節點的有空的time slots，S在將
最後的結果由大到小排序，先選擇最大的
time slots，盡可能滿足頻寬的需求，而選到
的節點 ri會被記錄在 cooperative_list中，
cooperative_list則是記錄鄰居的ip位址和他
的可用time slots，總共的time slots會大於會
等於節點S的bw值。選擇節點的方法可以表
示為：T(r)- = T(r)+ ≧ t  and  S(r)- ∩ S(r)+ = 
φ 
 Setp2：S節點必需去尋找一個mi節點來
進 行 合 併 的 請 求 ， 首 先 S 查 所 有 在
cooperative_list內的ri節點，並且從鄰居表格
中找尋所有距離ri兩個hop的鄰居，S使用下
列式子選出mi ：nei_list(S, r1) ∩ nei_list(S, r2) 
∩nei_list(S, r3) ∩· · ·∩nei_list(S, rk)，合併的
結點mi必需位在能使用不同的beams接收
r1,r2,r3,…,rk的置。 
 Setp3：合併的結點mi選擇要被合併的
訊息。Cooperative list表示成
⎥⎥
⎥⎥
⎥⎥
⎦
⎤
⎢⎢
⎢⎢
⎢⎢
⎣
⎡
k
i
r
mrS
r
r
#
3
2
1
，
所有的鄰居都將cooperative flag設定成需要
轉傳資料。Merge_node欄位記錄mi，而
separate_node設成S，cooperative_flag記錄k
個連線。 
當relay node收到 RREQ，則有四種狀態表
示如下： 
Case1： 
Relay節點ri檢查RREQ訊息中目的節點的IP
位址，如果ri就是目的位置，ri則回傳一個
RREP給來源端。否則節點ri就再將訊息轉送
到目的節點而且他的頻寬會大於需要的頻
寬，ri之後一樣要轉傳RREP訊息回給來源
端。 
Case2： 
relay節點ri不是目的節點，而且他沒辦法
route到目的節點。ri檢查來源的IP位址，如
果 ri=s，則丟掉RREQ訊息，否則 ri檢查
cooperative_flag，假設cooperative_flag=0，
則 ri 從複本中檢查廣播 ID 來識別新的
RREQ，如果發現之前收過了或是hop count
 - 30 -
設成和RREQ中的separate_node相同，Node 
ri確定保留time slots做為之後通訊用。 
Case3： 
當節點ri不是目的位置、cooperative_flag = 
k、merge_node≠ ri。節點 ri回覆RREP給
merge_node，並且確定保留time slots做為之
後通訊用。 
Case4： 
當節點ri不是目的位置、
cooperative_flag=k、merge_node=ri。節點ri
等到k個RREP訊息都收到，然後合併這些訊
息並且把頻寬保留下來。如果ri不是之前
cooperative links中的merge node，node ri便
傳送RREP給先前的hop，反之則照Case2的
描述進行。 
 
圖三：Route reply. 
如圖三所示，目的節點D傳送RREP給
節點J，節點J保留time slots用來回覆資料，J
查 看 cooperative_flag =0 ， merge_node 
=null，則 J轉送RREP給 I節點。當 I收到
RREP，且I是合併節點，所以I在RREP中設
定cooperative_flag =3和merge_node =A，再
傳送三個RREPs，分別給C、E、F，當C、E、
F收到RREP後，三個節點再傳送RREP給A
節點，節點A在將RREP訊息傳給來源端S節
點，S便卻定了路由的路徑。 
 
Phase 3：維護路由路徑 
在ad hoc網路中，節點壞掉或者離開傳送範
圍造成連線中斷，以下定義幾個變數： 
‧ ri: 離開傳送範圍或壞掉的Relay node。 
‧ ri−1: 在ri之前的Relay node。 
‧ rj: ri−1 的鄰居節點並且要和節點ri有相同
的頻寬。 
當routing路徑中有連線斷掉，節點ri無
法在轉送資料給下一個hop，節點ri-1無法連
接到relay node，因此將ri從cooperative_list
中刪除，ri-1發送RREQ尋找其他的鄰居節點
當合併的節點。 
Case1： 
如 果 連 線 是 在 ri 和 ri-1 間 的 其 中 一 條
cooperative links，則ri-1要從nei_talbe(ri-1)中
尋找能滿足需求的其他的rj節點。ri-1傳送
RREQ給rj並且等到RREP，relay node rj傳遞
RREQ給合併節點，並等待它傳回RREP給
ri-1，節點rj透過收到RREP和傳遞RREP給ri-1
來確定可用的time slot，當ri-1接收到RREP，
ri-1持續傳送。如果找不到一個rj的節點，ri-1
會將含有封包資料的RRER廣播出去，
RRER訊息會傳遞給來源節點並起讓他重新
進行route。 
Case2： 
如果連線是在ri和ri-1間的唯一一條連線，節
點ri-1檢查nei_table(ri-1)並尋找其他的節點來
轉傳資料，如果rj能符合需求，在傳送完
RREQ和接受到RREP後ri-1繼續傳送，如果rj
不存在，則ri-1建立cooperative links到下兩個
hop。最壞的情況是無法建立cooperative 
links，RRER訊息將被廣播並且傳遞回給來
源節點。 
 
圖四：Link repair. 
如圖四所示，節點E發生錯誤或者離開
了傳送範圍，會使的節點A無法傳送資料給
下一個hop，所以從nei_talbe(A)中尋找另一
個L節點，A傳送RREQ給L並且等待RREP。
如果連線有建立，A便可以持續的傳送資
料，如果不存在L節點，A便傳送RRER給S
節點，請他重新route。 
模擬在 cooperative protocol下的成功
率，在cooperative protocol中成功率會相依
於 保 留 的 time slots 。 在 AODV routing 
protocol中，沒有參數可以被使用，如圖四
所示，說明了頻寬的需求和成功率的關係，
在頻寬需求小於3之前，cooperative和single 
link的成功率是一樣的，但當頻寬需求為3
時， single link 的成功率降為 46% ，但
cooperative link的成功率還是80%，當頻寬
需求等於4時，single link已經無法連線，而
cooperative link還是可以滿足要求，因為使
用cooperative links建立多條連來滿足頻寬
的需求，頻寬要求持續增加，成功率也會一
直降低，因為更高的頻寬需求，要建立連線
就更困難。 
 - 32 -
證協定 (Shoelace-based QoS Routing 
Protocol) (此研究成果 1. 正在 Wireless 
Personal Communications 期 刊 修 改 中 
(under revision). 2. 發表在 IEEE TENCON 
2007 會議) 
 
在第二個研究成果中，我們將介紹多重
交錯聯結式路由傳輸品質保證協定。一個
QoS 的路徑滿足從來源點到目的點的頻寬
需求，本研究主要提出一個特殊多路徑結
構，滿足從來源點到目的點所需的頻寬需
求。使用有向性天線有需多的好處，例如，
空間的重複使用、增強傳輸範圍和節省電
力。此方法利用這些好處來達到 QoS 路由
機制。在圖八(a)，考慮一對 two-hop 鄰居節
點 b 和 g，QoS 路由機制在 b 和 g 之間的頻
寬需求 Br 必須被滿足。在圖八(a)中只使用
了單一路徑路由當頻關足夠時。如果真實網
路中頻寬 BGB 在點b和g之間小於Br ( BGB ≦
Br)，給予一對 two-hop 鄰居節點在 b 和 g 之
間，一個或多個子路徑存在在 b 和 g 之間，
且一個或多個子路徑的頻寬總和等於 Br。
QoS 路由用多路徑可以增加成功機路和提
供強健且可靠的機制。這就是主要的觀念，
使用有向性天線從 shoelace路徑去找出多路
徑到 QoS 需求。在圖八(b)，描述結果使用
有向性天線可以取得較多的成功機率在確
認的 QoS 路由，因為有向性天線增強傳輸
距離可以找出更多節點。 
 
圖八：Example of different QoS situation. 
 
Definition 1：shoelace：提出一群 one-hop
鄰居節點
⎥⎥
⎥⎥
⎦
⎤
⎢⎢
⎢⎢
⎣
⎡
nm kh
kh
kh
##
22
11
，m, n > 1，點 hi連結
ki 。經由使用有向性天線連結 1+jikh 和
ji kh 1+ ，i = 1, …, m 和 j = 1, …, n 形成一個
交 叉 連 結 且 可 以 使 用 相 同 的 時 槽
{t1,t2, …,tn}，n≧1，來傳輸資料避免干擾。
所有連結的頻寬總和在 hi 和 ki 之間等同於
Br。一個或多個連結看起來像 shoelace。圖
八(c)是一個 shoelace 的例子。每一個子路徑
會負責子頻寬的需求。子路徑的數目相依於
網路頻寬。當網路頻寬被嚴格限制時，提出
一個 shoelace 路徑項圖八(c)。 BcB 和 BHB 的
頻寬總合等於 Br。這個技巧發現其他節點 E
使得點 C 和 H 連結點 E，這個例子中連結
⎥⎦
⎤⎢⎣
⎡
GH
EC 出現交叉，因為使用有向性天線，
交叉的路徑不會互相干擾當同時傳送封包
時，因此點對點延遲會減少。此外，建議採
用較少的節點並可再找到更多路徑達到 
QoS 路徑。 這可讓更多其他節點被其他
QoS 路徑使用加強無線網路使用率且保留
其他點等待節省能量。考慮要求滿足頻寬
Br從節點 D 到節點 S 的 QoS 路徑，如圖九
(a)所示。 
 
Definition 2：Shoelace-path：提供一個路徑
從來源到目的地，如果有一個或多個 
shoelace 在路徑中存在，路徑代表 shoelace- 
path。圖九(b) 顯示，只有一個 shoelace 存
在於路徑，四個 shoelace 或 multi-paths 在
路徑中出現如圖九(c)中所示。如果不能找到
單一路徑從 S 到 D，QoS 路徑與更多的
shoelace 或多路徑被識別。一個 QoS 路徑使
用少數的 shoelace或multi-paths被確認當網
路頻寬足夠時，如果網路 
頻寬是嚴格限制，將建構 QoS 路徑與更多
的 shoelace- path。 
 
 - 34 -
RSF[G, F] - RSF[E, H] - RSF[H, K] = {2, 4, 6, 
7, 8, 9, 12, 14} - {2, 5} -{6} - {6, 7, 12} - {2, 
3, 10, 13, 14, 15}= {4, 8, 9}. RSF為ASF的子
集合。RSF[F, H]可以為{4},{8}, {9}, {4,8}, 
{4,9}, {8,9}, or {4, 8, 9}。經過計算後，交叉
連結CF 和GE 傳送資料用相同time slot{2,5}
不會互相干擾。 
Phase II: Shoelace-path discovery 
每個節點利用 hello message 來尋找鄰
居位置和鄰居空閒 time slot 使用有向性天
線且計算連結的被保留 time slot。每個節點
維持 two-hop 鄰居資訊經由交換 hello 
message。來源節點初始頻寬需求 SL_REQ 
封包和廣播這個封包至相鄰節點。 
每個封包紀錄頻寬需求 Br 連接狀態資訊。
為了每個頻寬需求，來源節點會設定一個數
目 SL_REQ，SL_REQ 封包格式表示為
SL_REQ (S, D, NH, TH NEI, NL, RSF,Br, 
B)。封包的每個欄位定義如下。 
z S：來源節點位址。 
z D：目的地節點位址 
z NH：來源的鄰居節點且街收到
SL_REQ 封包。 
z TH_NEI：一般鄰居節點在下個跳躍。 
z NL：節點清單，代表經過節點從來源
點到現在節點。 
z RSF：保留 time slot 的清單，這個欄位
紀錄保留 time slot 在現在節點和下個
跳躍點之間。 
z Br：頻寬需求在來源和目地點之間。 
z B：所有頻寬從現在節點到他的鄰居。 
基於網路環境，網路拓樸有不同的型態，在
此提出三種可能。 
Case I：當網路頻寬足夠，每個節點偵測頻
寬在自己和鄰居之間是滿足的，路由路徑產
生單一路徑結果。 
Case II：當網路頻寬不足，單一路徑無法符
合。節點尋找更多子路徑，例如總頻寬是等
於 Br。結果使用多重路徑。提供路徑 [ n1 n2 
n3 n4 ]， 21nnB 等於 Br， 32nnB 小於 Br。程
序描述如下： 
Step 1：如果 32nnB 小於 Br，n2 找到其他點
n’i，i = 1,2, …,m，如此在
⎥⎥
⎥
⎦
⎤
⎢⎢
⎢
⎣
⎡
'
'
1
2
mn
n
n # 頻寬總
和等於 Br，且計算 RSF[n2, n3], RSF[n2, 
n1],RSF[n2, n’2], ..., and RSF[n2, n’m]。然後點
n2紀錄區域 ID 被 n2用來連接點 n’2和 n3，更
新 SL_REQ (S, D, n’i(n3), n4, {[n1 n2]}, 
RSF[n2, n’i], Br, B)且發送路由封包來通知點
n3和 n’i保留 time slot 和 two-hop 鄰居 n4 資
訊。 
Step 2：當點 n3和 n’i收到路由封包來自 n2，
他們自計算 RSF＝{ t1, t2, t3, ..., tk }，k≧1，
當 n2通知他們共有的鄰居 n4，然後點 n3和 n’i
更新 SL_REQ (S, D, n4, TH NEI = {two hop 
neighbors of node n’i (n3), {[n1, n2, n’i (n3)]}, 
RSF[n’i, n4], Br, B = |RSF[n’i, n4]| )，然後傳
送路由封包給下一個節點。點 n3和 n’i 紀錄
ID 被用來連接下個節點和接收從上的節點
的區域 ID。 
 
圖十一：Example of that uni-path is 
unsuitable. 
Step 3：n4 收道路由封包來自 n3和 n’i 頻寬
⎥⎥
⎥⎥
⎦
⎤
⎢⎢
⎢⎢
⎣
⎡
4
'
'
1
3
n
n
n
n
m
# 相 同 於 Br 。 現 在 多 重 路 徑
⎥⎥
⎥⎥
⎦
⎤
⎢⎢
⎢⎢
⎣
⎡
4
'
'
1
3
2 n
n
n
n
n
m
# 被建構，m≧1。圖十一描述這
個狀況，在圖十一(a)，頻寬需求 Br 被設定
為 6，和單一路徑[A , B, C, F]不滿足在 BCB
連結 QoS 需求，為了滿足頻寬需求，開始
增強方法。首先，點 B 找到其他點 G 像是
頻寬 ⎥⎦
⎤⎢⎣
⎡
G
C
B 等於 Br，且計算 RSF[B, C] ={3, 
4, 6, 11} and RSF[B, G]= {1,13}。點 B 送出
路由封包通知點 C 和 G 保留共享空閒 time 
slot 和點 F 資訊。第二，當點 C 和 G 收到六
由封包來自點 B，點C計算RSF[C, F] ={2, 7, 
8, 9}和點 G 計算 RSF[G, F] = {5, 6}。點 C
和 G 向前傳送路由封包給點 F，最後，點 F
收到路由封包來自點 C 和 G 和頻寬[C F]等
於 Br。多路徑 ⎥⎦
⎤⎢⎣
⎡ F
G
C
B 被建構如圖十一
(b)。 
Case III：在先前多路徑網路拓樸，有時某些
 - 36 -
≧1。所有頻寬在
⎥⎥
⎥⎥
⎥⎥
⎥⎥
⎦
⎤
⎢⎢
⎢⎢
⎢⎢
⎢⎢
⎣
⎡
p
x
h
h
h
h
n
#
#
1
'
'
1
2 等同於 Br且計算
RSF[n2, h’1], RSF[n2, h’2], . . . , RSF[n2, 
h’x]。之後，點 n2 更新 SL_REQ (S, D, hi, TH 
_NEI = {two hop neighbors of node n2}, {[n1 
n2]},RSF[n2, h’i], Br, B = {|RSF[n2, h’i]|)。且
送出路由封包通知保留共享空閒 time slot
和 two hop 鄰居資訊且紀錄 ID 被點 n2 使用
連接點 h’i。 
Step 2:當點 h’i 收到封包來自點 n2，點 h’i
計算 RSF[h’i, n5] = {t1, t2,… tm}, m ≥1。點
h1 找到其他點 ki，i ＝ 1,2,…, m m≧1。所
有頻寬在
⎥⎥
⎥
⎦
⎤
⎢⎢
⎢
⎣
⎡
mk
k
h #
1
1 等同於 [n2 h1]且計算
RSF[h1, ki] = {t1, t2,… tm}, m ≥1。點 h1 和 h’i
更新 SL_REQ (S, D, kj, TH_NEI ={two 
neighbors of node h’i (h1)}, RSF[h’i (h1), kj], 
Br, B=|RSF[h’i (h1)|)，且向前傳送路由封包
給下一節點且紀錄區域 ID 被 h1 和 h’i 使用
來連接下一節點和接收前一節點。 
Step 3:當點 n5和 ki收到路由封包來自點 h1
和 h’i，點 n5 和 ki各自計算 RSF[n5, n6] and 
RSF[ki, n6]，點 n5和 ki更新 SL_REQ(S, D, n6, 
TH NEI = {two neighbors of node kj (n5)}, 
RSF[kj (n5), n6], Br, B = | RSF[kj (n5), n6]|)。且
向前傳送路由封包給下一節點且紀錄區域
ID 被 n5 和 ki使用來連接下一節點和接收前
一節點。 
Step 4：節點 n6 收到路由封包來自點 n5 和
ki 且所有頻寬在
⎥⎥
⎥⎥
⎦
⎤
⎢⎢
⎢⎢
⎣
⎡
6
5
1
n
n
k
k
m
# 等同於 Br 。
shoelace
⎥⎥
⎥⎥
⎥⎥
⎥⎥
⎦
⎤
⎢⎢
⎢⎢
⎢⎢
⎢⎢
⎣
⎡
6
5
1
1
'
'
1
2 n
n
k
k
h
h
h
h
n
m
p
p #
#
#
被建構出來。 
 
圖十三：Example of shoelace-path with 
insufficient of all bandwidth 
圖十三描述這個例子。在前面和後面的所有
的多重路徑頻寬不滿足頻寬需求，在圖十三
(a)，所有頻寬在 ⎥⎦
⎤⎢⎣
⎡ F
G
C
B 小於 Br，且有
更多的頻寬在連接 BG ，為了滿足頻寬需
求，使用增強方法。首先，節點 B 找到其他
節點 E 且計算 RSF[B, E] = {4, 12}。 
點B送出路由封包通知點E接收共享空閒
time slot和點F資訊。第二，當點E收到路由
封包來在點B，點E計算RSF[E,F] = {8, 10}。
點G找到其他點K且計算RSF[E,F] = {8, 
10}。點E和G各自向前傳送路由封包給點F
和K。第三，點F和K收到路由封包來自點E
和G且各自計算RSF[K, H] = {6, 13} and 
RSF[F, H] = {4,7, 9, 12}。然後，點K和F送
出路由封包給點H。最後，點H收到路由封
包來自點K和F且所有頻寬在 ⎥⎦
⎤⎢⎣
⎡ H
F
K 等同
於Br。shoelace
⎥⎥
⎥
⎦
⎤
⎢⎢
⎢
⎣
⎡
H
F
K
G
C
E
B 被建構出來
如圖十三(b)。觀察上述各種情況下，在此提
出的各種情況下建議正式的程序。提出
shoelace-base通訊協定的詳細資料如下： 
Step 1：來源節點 S 計算 RSF[S, j]，j 為 S
的鄰居 ID。S 選擇一個或多個節點可以在 S
和他的鄰居間的所有連結頻寬總合等於
Br。此來源節點初始且傳送封包 SL_REQ (S, 
D, NH, TH_NEI, NL={[S]}, RSF, Br, B)給下
一個跳躍節點直到目的點 D 如果頻寬需求
為 Br時。來源節點紀錄區域 ID 被使用來連
接點 j。 
Step 2：如果點 e 接收到一串 SL_REQ 封包
來自點 Ni , i=1,2,…,n。點 e 增加他自己的 ID
到 NL 且四種情況需要被考慮。(1)假如ΣB
＝Br 且 ekB ，k 為 e 的下一節點，小於 Br，
然後執行 procedure I 。(2)假如 B＜Br 且頻
寬在 ek ，k 為 e 的下一節點，小於 B，然後
執行 procedure II-A。(3)假如ΣB＝Br 且
iek
B ，ki為 e 的下一節點，小於 Br 且連結 iek
 - 38 -
 
圖十五：Performance of success rate vs. 
bandwidth requirement. 
方法的結果比其他的高很多。這是因為
shoelace 方法使用多重路徑結構使所有子路
徑 頻 寬 總 和 等 於 頻 寬 需 求 。 然 而 ，
zone-disjoint、flow-control 只使用單路徑，
難以找到好的 QoS route，特別是當 average 
usable network bandwidth 被嚴重限制時。 
 
圖十六：Performance of success rate vs. 
average network usable bandwidth. 
圖十七表示結果在 success rate v.s. 
mobility，當 0 ≤ Mo ≤ 50 km/h，Br 固定在 4 
time slots，Bn 固定在 25%，and Se 固定在 
8。所有的協定產生低的 success rate 在 high 
mobility 時，高 success rate 指出好的方法被
達成，由此觀點來看，shoelace 方法比其他
的方法好。 
 
圖十七：Performance of success rate vs. 
mobility. 
圖十八表示結果在 throughput v.s. 
bandwidth requirement，當 1 ≤ Br ≤ 8 time 
slots，with Mo 固定在 30 km/h，Bn 固定
在 25%，and Se 固定在 8。當頻寬需求漸
漸增加，shoelace-based 協定明顯的比其他
的好。這是因為較高的頻寬需求容易導致低
優 先 權 的 流 量 降 低 和 堵 塞 流 量 在
flow-control scheme and zone-disjoint。然
而，頻寬需求可以被分享在 multi-path 之間
在 shoelace 方法。 
 
圖十八：Performance of throughput vs. 
bandwidth requirement. 
 
(c) Time-slot Leasing-based QoS 
Routing Protocol (此研究成果發表 1. 國
際期刊 Ad Hoc and Ubiquitous Computing, 
2007. 2.  IASTED Conf. on Wireless 
Networks and Emerging Technologies, 
(WNET 2005), 2005) 
在第三個研究成果中，我們研究一個新
的有效的Bluetooth個人無線區域網路QOS
路由，使用time-slot leasing機制來達成。在
Bluetooth中的”transmission holding”問題的
 - 40 -
 
圖十九：單一跳躍 CTQ 方法 
 
圖二十：保留時間槽設定使用單一跳躍 
CTQ 方法 
為了增加系統效能，Time-slot leasing-based
機制設定當傳統的路由路徑收集空閒時間
槽資訊失敗。在我們的TQ路由協定，
time-slot leasing-based slave-to-slave 架構置
換傳統的slave-master-slave架構來增加產能
且減少系統延遲時間。這個演算法關於
time-slot leasing-based重找路徑步驟被描述
如下。 
C1. 如果失敗連結是 'CC NN ，然後所有的
slave-to-slave資訊被收集在以下步驟， 
D1. 如果NC為master點，然後連接所有
的資訊被收集來自其他所有的
slave點到 slave點NC’，在相同的
piconet對於master點NC，舉例來說
被表示在圖十九(b)和6，如果失敗
連結是 Mb ，然後首先收集資訊
},,),,(),,(,{ fbefaefbafebaeab 。 
D2. 如果NC’是master點，所有的連結資
訊被收集來自slave點NC’，到其他
slave點在想同的piconet和master點
NC’。 舉例來說被表示在圖十九(b)
和圖二十，如果失敗連結是 aM 然
後資訊 }),,(),,(,{ afefaeebaeab 被
收集。 
C2. 如果所有的連結失敗，然後QoS_REQ
被丟棄且演算法被破壞經由失敗qos連
結需求傳回的訊息。 
C3. 少一點跳躍優先策略將會優先採取一
個 time-slot leasing-based交換路徑選
擇。如果多餘一個可能連結存在，然
後團體計算最少個數跳躍被選擇。 
C4. 當最少個數跳躍團體被選擇，最大的
空閒封包優先策略持續選擇time-slot 
leasing-based交換路徑。如果多餘一個
可能連結存在選擇的團體，然後挑選
最大空閒封包。圖二十一顯示例子策
略在two-hop time-slot leasing-based qos
路由交換。新的 qos連結需求是 51 
bytes/cycle 時間，一個完整 two-hop 
CTQ方法被顯示在圖二十二和圖二十
三。 
當交換的連結被選擇，然後傳回先前有效的 
QoS routing-path 搜尋步驟。 
 
 
圖二十一：Two-hop time-slot leasing-based 
索取 QoS 路由交換 
 
 
 - 42 -
 
圖二十四：計算優先權借貸值的例子 
 
當每個規格Bluetooth scatternets的能力定義
DM5, DM3和DM1封包型態是224, 121, and 
17 bytes。如果qos連結需求是200 bytes/cycle 
time和不平等(1 × 224 = 224 > 200 > 0 × 224 
= 0), (2 × 121 = 242 > 200 > 1 × 121 = 121) 
and (12 × 17 = 204 > 200 > 11 × 17 = 187)被
建立，然後我們可以使用一個封包是DM5
型態，兩個封包是DM3型態，或12個封包是
DM1封包型態來滿足qos需求在三個不平等
中。尤其在DM1和DM3封包型態對於所有
的例子在此論文，只有一個型態被選擇來調
整支持qos連接需求。如果新的qos連結需求
是51bytes/cycle time，然後一個DM3封包息
型態和三個DM1封包型態對於要求是可用
的。現在一條路徑(M0, s0, M1, s1, ...,W, X, Y, 
Z, ..., Mi),被命名PA和一個優先權清單，
PL(i)L(W,X,Y,Z)被給予。PA是接收經由目的
點，然後time-slot保留步驟演算法被描述如
下。 
F1. 隨機選擇一個連結L(X, Y)和最小共享
自由時間槽s來自PA然後分開PA成兩
個子路徑，PA1 = (M0, ..., X) and PA2 = 
(Y, ..., Mi), PA = PA1 + PA2。例子表示
在圖6(d)，L(a, b) and L(c, D)是連結在
分享最小個數的空閒時間槽。然後我們
可以隨機地選擇一個連結來自這兩個
連結，連結L(a, b)被選擇在這個例子。 
F2. 為 了 qos 連 結 需 要 ， 優 先 權 清 單
PL(i)L(W,X,Y,Z)被使用且DM5封包型態是
第一個採取去試試qos連結需求如果空
閒時間槽的數量s足夠。繼續下去，DM3
封包格式被測試看是否可以滿足qos需
求如果DM5封包型態失敗。如果還是無
法滿足qos需求，DM1封包型態被是看
是否滿足qos需求。 
F3. 遞迴的執行time-slot保留操作步驟F1和
F2直到所有的子路徑被計算且所有的
路徑就收到經由計算的目的點。 
當time-slot保留步驟是遞迴執行且時間槽和
qos連接需求被保留。此目的點送出回應封
包回去到來源點為了保留時間槽在選擇的
路徑之間。所有沒被選擇的時間槽在所有存
在的路徑是有收到目的點送出的被釋放。為
了不失去普遍性，一條路徑徑(M0, s0, M1, 
s1, ...,W, X, Y, Z, ..., Mi),被命名PA和一個優
先權清單，PL(i)L(W,X,Y,Z)被給予且修改規則
被表示如下。 
G1. 隨機選擇連結L(X, Y)和最小共享空閒
時間槽s來自PA然後切開PA成兩個子
路徑，PA1 = (M0, ..., X) and PA2 = (Y, ..., 
Mi),where PA = PA1 + PA2。 
G2. 賦予表明的一個不同的優先級值與鄰
居連接的受影響的程度的每個連接收
集 在 之 前 的 二 個 階 段 ， time-slot 
leasing-based重找路徑步驟和有效的 
QoS routing-path 搜尋步驟。 
G3. 應用優先權基礎機制來保留時間槽在連結
L(X, Y)。 
G4. 遞迴的執行time-slot保留操作步驟G1
和G2在所有路徑接收來自目的點直到
所有的連結被time-slot保留選擇。 
圖二十五顯示一個歷程樹，也被叫做
time-slot reservation tree (TSR-tree)，用來表
示 所 有 的 遞 迴 操 作 不 用 使 用 time-slot 
leasing-based方法。圖二十六(a)顯示一個跳
躍time-slot 
leasing-based TSR tree 和路由圖來表現所有
的 遞 迴 操 作 當 一 個 跳 躍 time-slot 
leasing-based 方法被採用。圖二十六(b)顯示
兩個跳躍遞 time-slot leasing-based TSR tree
和他的路由圖。 
 
圖二十五：time-slot 保留和一般最佳演算法
的情況 
 
 - 44 -
有slave-to-slave的資訊經由下面子
步驟。 
C'1. 如果為mater節點，然後收集
所有連結來自其他 slave到
slave NC’在相同的piconet跟
master Nc的連結資訊。 
C'2. 如果為mater節點，然後收集
所有連結來自slave Nc到其他
的 slave 在相同的 piconet 跟
master NC’的連結資訊。 
B'7. ＇如果所有的連結失敗然後丟棄
QoS_REQ封包且中斷演算法經
由傳回QOS連結需求失敗訊息。 
B'8. ＇少量跳躍點優先策略將會手首
先 採 用 來 選 擇 time-slot 
leasing-based交換路徑，如果多餘
一個可用連結存在然後選擇群組
計算較少跳躍點個數。 
B'9. 當群組和較少跳躍點被選擇，最多
空閒封包優先策略降會繼續選擇
time-slot leasing-based 交 換 路
徑。如果多餘一個可用連結存在
被選擇的群組然後選擇最大個數
空閒封包。 
B'10. 當交換連結被選擇後跳到B'1。 
A'3. 當使用QoS_REQ的Free_TS_Link，所有
空閒時槽資訊在每一回合被目前點取
得Cur_DHC，time-slot 保留操作在每
回合中描述如下。 
D'1. ＇隨機選擇一個連結L(X, Y)來自
PA和最小個數共享空閒時間槽且
然後分開PA成兩個子路徑PA1、
PA2，PA = PA1 + PA2。因為DHN
被設定為3，此方程式PA = L(W, X) 
+ L(X, Y) + L(Y, Z)，因此，這三個
連結L(S, a), L(a, M) 和 L(M, b)來
自三個跳躍連結的其中一個在第
一個回合的時間槽保留，如圖13(a)
所示。其他例子描述也要圖13(a)，
在此處三個連結L(S, e), L(e, M) 
和 L(M, f)仍然來自三個跳躍連結
的其中一個在在第一個回合的時
間槽保留。 
D'2. 優 先 權 借 貸 值 PL(i)L(W,X,Y,Z) = 
CN(i)L(W,X,Y) + CN(i)L(X,Y,Z)仍然重
複地計算去執行time-slot保留。 
A'4. 在TSR步驟之後成功被保留，以下的步
驟繼續執行且重複直到所有的資訊都
被計算過後。 
E'1. 目前節點NC遞迴地更新值(S, D, 
QR, {the free time slots of current 
node Nc}, Cur_PL  ∪
{Nc},Cur_FTL ∪ },,{ 21 nααα " , 
Cur_HN-1, new updated MinPK, 
Cur_DHC + 1)到QoS_REQ封包且
廣播此封包到下一個節點直到目
的點收到最後的QoS_REQ，當
Time_to_Live等於0時，停止遞迴地
更新。 
E'2. 目前節點NC回應給TSRP封包回到
先前的節點，在此篇文章是三個
點，去確認time-slot保留。 
這完整的處理步驟關於 one-hop DTQ 演算
法用圖片表示且列表顯示在圖二十七和二
十八， DHC 被設定為 3 且最後路由路徑為
S → a → b → c → D。 
 
 
圖二十七：One-hop DTQ 方法 
我們研究各種不同的 QOS 要求的影響在成
功比率上，顯示在圖 15(a)-(d)中，四種 QOS
需求情境為 DM1:DM3:DM5 = 1:1:1, 3:1:1, 
1:3:1 and 1:1:3。相同的比較結果 CCQ，
DCQ，和 KIM 被描述在 Chen et al. (2004)’s
的模擬。CCQ 和 DCQ 比 KIM 有高的成功
比率，成功比率在 KIM 快速的降低。這是
因為 KIM 浪費太多 POLL time-slot S 經由
使用 DM1，耗盡大多數的時間槽。一般來
說，成功比率在我們的 CTQ 大於 CCQ。相
同地，成功比率在我們的 DTQ 大於 DCQ。
這是因為我們的 CTQ 路由協定額外請求
slave-master-slave 網路建構 QOS 路由路
徑。在連結要求失敗的情況中，路由立即的
 - 46 -
更精確位置資訊的環境來說根本不是一個
可用的定位技術，並且 GPS 也不適用於室
內定位，因為訊號會受到建築物遮蔽，而無
法有效的傳輸訊號，所以在室內使用 GPS
是不可實行的。由於人們能在任一空間自由
地移動，與使用無線網路相關服務，若是我
們可以精準定出使用者的位置，將位置資訊
應用在相關系統上，就可提供使用者更多便
利的服務。位置資訊的相關服務應用相當廣
泛，例如，可以應用於各類展覽館的導覽服
務、醫療業、零售業、保全業、公眾區域等。
但前提是使用者身上必須配戴有無線傳輸
設備。所使用的 sensor device 為 Tmote sky，
如下圖所示: 
 
Tmote sky 正面 
  
 
Tmote sky 反面 
此裝置為 250kbps 2.4GHz IEEE 802.15.4 
Chipcon Wireless Transceiver，並且能和其他
IEEE 802.15.4 devices 進行溝通。其具備有
50m range indoors / 125m range outdoors 的
能力，以及直接由 USB 來 program 和 data 
collection，也能藉著 TinyOS support 來 mesh 
networking and communication。 我們預期
將以此種 device 散佈於室內，而我們使用
TinyOS此種嵌入式的OS來執行 sensor的基
本操控，配合 Visual Basic.Net 所寫的介面來
呈現使用者的移動情形。使用者將一顆
sensor 置放於識別證件配戴於身上，在使用
者移動的時候，傳送訊息給各個感測點，再
將使用者位置顯現於電腦的介面上。最終期
盼能夠在介面上展現出多個使用者的在同
時間移動位置。 
 
本計畫的樣本比對定位法，利用訊號強度
來達到定位目的的方法稱為樣本比對
(pattern matching)定位法，比對目標物體所
蒐集到的訊號強度特徵與定位資料庫中各
個訓練位置的特徵。定位過程分為兩階段： 
Step1：訓練階段：這個階段主要的目的在
於蒐集環境下所有參考點所發   出的訊號
到各個訓練位置的訊號特徵，並且輸入到定
位資料庫。 
Step2：定位階段：比對待定位的目標物所
接收到的訊號樣本最有可能出現在哪個訓
練位置上。 
 
 
我們同時利用三角定位法(Trilateration)為
最常被使用於定位系統中，需要 3 個以上參
考點且運用距離測量技術估算被定位點到
其他參考點的距離所估算之距離最後依據
最小σx,y 來判定目標體位置:   
σx ,y = 
∣ √(x-xA)^2 + (y-yA)^2-rA   ∣+   
∣ √(x-xB)^2 + (y-yB)^2-rB   ∣+ 
∣ √(x-xC)^2 + (y-yC)^2-rC   ∣          
也可藉由 AOA 達到定位的目的，(C)表可
藉由參考點 ABC 的位置與入射角判斷其可
能位置。 
 
本計畫實際採用多點定位法，sensor 常
常隨機放置，在參考點不足的情況下，多點
定位法(Multilateration)則可以減少此情況發
生機會。 
樣本資料庫 
篩選模組 
位置感知系統 
 - 48 -
 
由 port 收進來的資料顯示在 txt 上，但卻包
含許多我們不需要的值，如溫度、光等值。 
 
 
 
經過修改 tinyOS 的程式之後，可將讀
取紀錄下來的資料顯示出所設定的 sensor 
ID 和僅僅記錄下 RSSI 值。 
去除異常值方法步驟改進: 
<法一> 雙向收發，比對 Rssi 值；此種收發
方式更增加了干擾，擺放多顆實際測量時，
rssi 值不穩定。再調整接收的程式，看不穩
定的情況是否改善。 
<法二> 改變 tmote power 強弱；實際量測
power 值設定範圍，讓 mobile 有效分辨哪些
node 離其較近；並觀察其 Rssi 是否隨之變
化，進而偵測哪些 node 有異常。 
<法三> 改變 channel Channel 調變方式； 
1.MobileNode 使用 channel 12~26 發送給各
個 AnchorNode。 
2.AnchorNode使用 channel 11將資料轉送回
Sink 
 
實測場地之平面圖 
MobileNode 在各區域之間傳送給各個
AnchorNode的訊號強度Rssi值（縱軸表Rssi
值，由 0~140 ）： 
119 119
106 101 105
89 89
0
20
40
60
80
100
120
140
T1
12
13
14
15
16
18
19
 
MobileNode 在 T1 時各 AnchorNode 所收到的 RSSI 值 
106 111
120 115
103 97 95 90
0
20
40
60
80
100
120
140
T2
12
13
14
15
16
17
18
19
 
MobileNode 在 T2 時各 AnchorNode 所收到的 RSSI 值 
89
110
122 118
100 100
87
0
20
40
60
80
100
120
140
T3
13
14
15
16
17
18
19
 
MobileNode 在 T3 時各 AnchorNode 所收到的 RSSI 值 
sensorID 
RSSI value 
 - 50 -
 
三、第三年結論 
在第三年的計劃中，我們針對當 ad hoc
網路實際應用時，將會遭遇的頻寬不足與傳
輸瓶頸的問題，而提出合作式路由傳輸品質
保證協定(Cooperative QoS routing protocol)
與多重交錯聯結式路由傳輸品質保證協定
(Shoelace-based QoS routing protocol)，達到
提昇網路傳輸頻寬，同時也克服了網路傳輸
瓶頸的問題，目前兩個研究成果已具體發表
在國際重要的 IEEE 會議和被 Wireless 
Personal Communications 期刊通知修改
(under revision)。而在實作方面，我們亦利
用感測網路實踐出室內定位系統，可以定位
室內移動的物體，以偵測活動行為或是異常
入侵，可以應用於多方面，提昇環境安全，
實踐感測網路於真實現實環境中使用。 
 
四、計劃成果自評 
本子計畫提出合作式路由傳輸品質保
證協定(Cooperative QoS routing protocol)與
多重交錯聯結式路由傳輸品質保證協定
(Shoelace-based QoS routing protocol)，亦將
所設計的路由傳輸品質保證協定實現於
MICA2 節點上，以獲得實際測試數據。論
文皆被 Wireless Personal Communications 期
刊通知修改中 (under revision)與分別被
WASN 2007 以及 IEEE TENCON2007 會議
所接受。 
根據上述研究成果，本子計畫具體完成
第三年的研究實作工作。我們自評本子計劃
(子計劃三)之設計與實作結果已符合計畫的
預期結果。 
 
