可供推廣之研發成果資料表 
□ 可申請專利  █ 可技術移轉                                      日期：96 年 10 月 15 日 
國科會補助計畫 
計畫名稱：高效能微步進控制技術之 IP 設計(II) 
計畫主持人：林浤偉 
計畫編號：NSC 95-2221-E-234-002 學門領域：精密動態控制 
技術/創作名稱 速度隨耦微步進控制 IP 晶片 
發明人/創作人 林浤偉 
中文： 
模糊控制晶片中包含模糊化電路、規則庫電路、推論引擎電路
及解模糊化電路等主要電路模組，結合馬達特性提供一最佳化速度
控制曲線。 
技術說明 英文： 
The major modules included in the FLC chip are fuzzifier circuit, 
rule-based circuit, inference engine circuit, and defuzzifier circuit. This 
combined with the motor effect to get the optimization of acceleration 
curve. 
可利用之產業 
及 
可開發之產品 
可利用之產業：半導體產業、機械加工業、紡織業 
可開發之產品：CNC 工具機、辦公室自動化、半導體精度定位 
技術特點 
簡化控制命令 
易與微控系統結合 
最佳化速度控制曲線 
推廣及運用的價值 
價格低、體積小、穩定性高、省能 
※ 1.每項研發成果請填寫一式二份，一份隨成果報告送繳本會，一份送 貴單位
研發成果推廣單位（如技術移轉中心）。 
※ 2.本項研發成果若尚未申請專利，請勿揭露可申請專利之主要內容。 
※ 3.本表若不敷使用，請自行影印使用。 
 2
機」（Perceptron）的神經元模型，這是最簡單也是最早
的類神經模型，感知機通常被拿來做分類器（Classifier）
使用[2,3]。但是在 1980 年之前，由於專家系統（Expert 
System）則是當時最流行的人工智慧基礎，加上類神經
網路的理論仍不成熟，因此類神經網路並沒有受到很大
的重視，一直到 1980 年代之後，由於霍普菲爾（Hopfield）
神經網路 1982 年被提出，而此時專家系統開始遇到了
瓶頸，類神經網路理論才逐漸受到重視。直到今日為
止，類神經網路仍然有新的架構及理論不斷的被提出，
配合電腦運算速度的增加，使得類神經網路的功能更為
強大，運用層面也更為廣泛。 
2. 模糊控制系統 
Zadch 教授所提出的模糊理論即是建立一套語言
分析的數學模式，將那些模糊不清的事物，給予明確
化、數據化，進而轉成機器所能接受的運算語言。模糊
控制系統利用模糊邏輯的思考方式，設計控制器的工作
原理，與一般的傳統控制器不同之處，在於它是一組以
語意描述的定性控制法則。整個模糊邏輯控制系統的基
本結構，如圖 3.3 所示，包含模糊化介面（Fuzzification）、
決策邏輯（Decision Making Logic）、模糊知識庫（Fuzzy 
Knowledge Base, FKB ） 以 及 解 模 糊 化 介 面
（Defuzzification）[4-8]。 
 
Fuzzy Controller Block
Fuzzification
Decision Making 
Logic
Defuzzification
Fuzzy Knowledge Base
Data 
Base
Rule 
Base
outie
圖 1. 模糊邏輯控制系統基本架構 
 
以下是對上述的四個基本單元進行簡單的陳述。 
 
模糊化介面（Fuzzification） 
模糊化介面是將外界所量測的數值，進行量化
（Quantization）工作，以便將觀測量的範圍轉換到語言
變數量對等的論域，再利用模糊化函數（Fuzzification 
Function）將輸入的資料轉換成適當的語意值。 
 
決策邏輯（Decision Making Logic） 
這是模糊推論機構，它具有模擬人類做決策判斷的
能力。根據人類特有的近似推理方式，延伸的模糊推論
技術實作出來的計算機構。 
 
模糊知識庫（Fuzzy Knowledge Base, FKB） 
模糊知識庫包含資料庫（Data Base）和控制規則庫
（Rule Base） 
(a)資料庫（Data Base） 
提供建立模糊界面時所需要的定義。所謂的模糊界
面包括狀態論域以及歸屬函數，以方便提供給控制規則
庫和決策邏輯中的模糊資料管理。 
(b)控制規則庫（Rule Base） 
利用各種方法定義出來的一組語言控制規則，用來
描述控制目標和專家的控制策略。 
 
解模糊介面（Defuzzification） 
解模糊界面是將模糊運算所得的模糊輸出轉成實
際的物理量以供外界系統使用，而整個工作細節是將推
理引擎所得到的結果，經由解模糊函數轉成一適當的非
模糊數（Nonfuzzy Value），再經由比例映射傳出，而
得一實際的物理量，供被控系統操作使用。 
 
2.1 模糊控制器之設計步驟 
模糊控制器（Fuzzy Logic Controller）是結合專家經
驗與操控人員之直覺，設計時不需要使用數學模型完整
的描述受控系統，所以沒有一定的方法可以遵循。雖然
如此，我們仍然可以整理出幾個原則性的設計步驟，以
便設計實有方向可遵循[9-11]。 
（1）定義輸入及輸出變數 
首先需定義適當的輸出及輸入變數，以確定系統那
些訊號為輸入及輸出變數。通常輸數入變數可以是擷取
自受控系統的操作量；輸出變數則為操控受控系統的操
作量。本文為一個二輸入一輸出的架構。兩個輸入分別
是誤差（ e ）和誤差的變量（ eΔ ），輸出為力矩的變
化 量 （ *eTΔ ） 接 著 定 義 各 變 數 的 範 圍 值 ，( )srade /]1,1[−∈ ， ( )srade ]1,1[−∈Δ ，
)](1,1[* mNTe −−∈Δ 。 
（2）定義各語言變數的資料庫 
模糊邏輯控制器非數值變數來描述系統的特性，設
計時須考慮輸出入變數的量測及操作範圍、系統特性等
因素，決定語言變數的論域、輸出入空間的模糊分割方
式以及模糊語言項的歸屬函數。而常見的歸屬函數有高
斯形、三角形、梯形、單值型、S 函數型等，以下對本
文所用之的歸屬函數做說明: 
 
高斯形歸屬函數  
採常態分配為主的歸屬函數，如圖 2 所示，其數學
式如（1）所示。在輸入採用高斯形歸屬函數，其中c為
歸屬函數之中心點，σ 為歸屬函數之寬度，其優點為調
整參數方便。 
 
2)(
2
1
)( σμ
cx
A ex
−−=   （1） 
 
σ
c
x
Aμ
1
 
圖 2. 高斯形歸屬函數 
 
單值型歸屬函數  
為模糊集合的一個特例，當模糊集合在論域中，只
有一點其歸屬函數程度為 1，其他皆為 0 的歸屬函數就
稱為單值型歸屬函數。其數學式如（2）所示，在輸出
歸屬函數採用單值型歸屬函數其優點為解模糊方便。 
 
 4
其中 ijc 為高斯型歸屬函數中心點， ijσ 為高斯型歸
屬函數寬度，下標 j 代表第 j 個類神經元，下標 i代表第
i個輸入變數。 
第三層：負責模糊規則的啟動強度運算，將相關之
歸屬含數值用模糊交集（AND）的運算整合成啟動強
度，每條規則的函數計算如下： ( ))3()3(2)3(1)3( ,,,min pi uuunet L=  （8） 
)3()3(
ii netO =  （9） 
第四層：第四層的鍵結值負責模糊聯集（OR）之運
算，以便將所有具有相同後鑑部之模糊規則整合起來計
算: 
∑=
i
ii unet
)4()4(  （10） 
 ),1min( )4()4( ii netO =  （11） 
第五層：負責解模糊化之工作，採用單值式之歸屬
函數、 ijm 代表單值之中心點，下標 i 代表第 i 個輸出語
意變數，下標 j 代表第 j 項單值式之中心點。 
 
∑=
j
ijiji umnet
)5()5()5(  （12） 
∑=
j
ij
i
u
net
O )5(
)5(
)5(  （13） 
 
其中模糊類神經控制器之輸出（ )5(O ）為位置之變
化量（ *PΔ ）。 
 
3. 模糊晶片電路設計 
模糊晶片分為四個主要單元。分別為模糊化部分、
規則庫部分、推論部分、解模糊化部分。模糊晶片整體
的架構圖如圖1所示： 
(a) 模糊化電路設計 
本文採用動態產生歸屬函數的方法來產生歸屬函
數，用高斯形歸屬函數來建構輸入變數的歸屬函數，其
中五個語意變數為 },,,,{ PBPSZENSNB ，歸屬度0～1對
應到0～15的數位化歸屬度，而輸入值則從論域2到62，
在2和62之外的值我們設為固定的值，五個歸屬度分別
存於兩個區域中，其中NB、ZE、PB存在M_o中，NS、
PS則存在M_e中。當一輸入值進到模糊化電路時，會觸
發相鄰兩個歸屬函數，產生兩個歸屬度值M_v11、M_v12
與兩個歸屬函數MF11、MF12，如圖6所示，所以兩個輸
入總共會產生四個歸屬度值與四個歸屬函數。 
x
1fM 2fM
12VM
11VM
Input
Grade
 
圖 6. 輸入值觸發歸屬函數與歸屬度示意圖 
而歸屬函數我們一樣以3-Bit數位化的值加以代
表，以便於接下來的模糊規則推論，如表2所示： 
表 2. 歸屬函數儲存表 
歸屬函數 NB NS ZE PS PB 
儲存值 000 001 010 011 100
 
所以模糊化電路的架構示意圖如圖 7 所示： 
11vM
21vM
12vM
22vM
11fM
21fM
12fM
22fM
e
de
dee
NB NS ZE PS PB
 
圖 7. 模糊化電路架構示意圖 
(b) 規則庫電路設計 
規則庫電路設計是以查表法（look up table）為基礎
所設計而成，系統設定的模糊規則總共有25條，如前述
所有輸入變數的歸屬函數都以3-Bit的數位值所儲存，而
輸出變數部分因為用模糊單值歸屬函數的形式表示，所
以後鑑部部分直接以6-Bit的數值當作輸出，當一輸入訊
號進到模糊化電路時，會觸發相鄰兩個歸屬函數，所以
兩個輸入訊號總共觸發四個歸屬函數，即會觸發四條模
糊規則。經查表則可對應出推論結果。 
(c) 推論引擎電路設計 
當模糊化電路模組將輸入資料進行模糊化處理
後，則會送到推論引擎電路進行模糊推論的動作，推論
引擎電路整體架構如圖8所示。 
Out
11vM
21vM
12vM
22vM
11fM
21fM
12fM
22fM  
圖 8. 推論引擎電路架構圖 
 6
表 3. 模糊規則調整前後對照表 
模糊規則 3 7 11 15 19 23
調整前 NB NB NB PB PB PB
調整後 NS NS NS PS PS PS
表 4. 模糊規則調整前後誤差比較表 
 型式 rms 值 
定電流 0.0120 模糊規則調整前 正弦波 0.0152 
定電流 0.0081 模糊規則調整後 正弦波 0.0070 
 
圖 14. 模糊電流控制器電路時序圖 
Phase A
Phase B
 
圖 15. 相電流 PWM 切換實測圖 
Phase A
Phase B
 
圖 16. 相激磁相差 90 度電流實測圖 
 
 
圖 17. d-q 軸電流波形圖 
  2
  4
  6
  8
30
210
60
240
90
270
120
300
150
330
180 0
  0.1
  0.2
  0.3
  0.4
30
210
60
240
90
270
120
300
150
330
180 0
 
圖 18. 微步進位置實測量測圖 
5. 結論 
模糊控制具有許多傳統控制所沒有的優點，本文也
成功地將它實現在 FPGA 晶片上，使其成為一全數位化
的模糊控制器晶片，FPGA 晶片的功能可以很容易被驗
證且可以修改內部程式以達到所需的功能。所以控制器
電路也將整合到一片晶片中，以達到產品小而速度快的
要求。由於模糊控制器內部許多設定都是依據使用者的
經驗所訂定，例如歸屬函數的選取、模糊規則的數量、
模糊推論及解模糊化的方法，都會影響系統的控制特
性，如今加入類神經模糊控制架構使模糊控制晶片具自
我學習的特性，在硬體方面也可多方嘗試其他的驗證平
台，使其功能性更加完全。 
