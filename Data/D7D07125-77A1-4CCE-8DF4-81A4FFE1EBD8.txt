 1 
目  錄 
 
一、中文摘要 …………………………………………………… 2 
    英文摘要 …………………………………………………… 2 
二、緣由及目的 …………………………………………………… 2 
三、計畫進度與討論 …………………………………………… 3 
四、結論 …………………………………………………………… 5 
五、發表論文及專利申請………………………………………….. 5 
六、成果自評 …………………………………………………… 5 
 
圖一、網路介面模型 …………………………………………… 6 
圖二、軟體驗證網路模型 ……………………………………….. 6 
圖三、NoC 之時間延遲(latency)模型...…………………………… 6 
圖四、路由器之架構圖 …………………………………………… 6 
圖五、QEMU 與虛擬平台之系統架構 …………………………… 7 
圖六、利用 QEMU 模擬雙核心系統之架構 …………………… 7 
圖七、測詴排程與測詴架構共同開發之流程 …………………… 7 
 
 
 
 3 
術，並建立多核心系統之測詴與除錯架構，主要
研究方向包括如何對多核心系統中之多個處理器
進行測詴與除錯以及如何對多核心系統中的溝通
架構進行測詴，同時我們亦考量測詴時功率消耗
之議題，以發展低功率的測詴與除錯策略。另外，
本計畫之設計抽象層次將涵蓋 ESL 設計、RTL 設
計、gate-level 設計、FPGA 雛型驗證以及矽晶片
層級，並且於不同設計抽象層次解決不同的議題。 
目前不論是國內或是國外，對於電子系統層
級設計，或是多核心積體電路低功率測詴方面的
相關研究都不少，不過，到目前為止鮮少見到將
兩者整合在一起，以進行電子系統層級多核心低
功耗測詴的相關文獻。本子計畫主要研究如何有
效將系統層級設計方法應用於多核心系統測詴架
構之低功耗設計規畫以及測詴成本之評估，並藉
由電子系統層級設計之快速的模擬速度以及快速
分析並建立起系統架構的特性，使得測詴的成本
與功耗分析能在系統設計的初期就被納入考量，
進而完成整體系統之測詴架構及詳細的測詴流
程，本子計畫並將與其他子計畫互相配合，共同
開發出一低功耗多核心之晶片系統。 
三、計畫進度與討論 
第一年度本子計畫已完成的工作項目，分別
敘述如下： 
1. 建立符合 OCP TLM-2.0 之網路溝通介面 
Open Core Protocol (OCP)是一個常見的介面
標準，OCP 在推出後即因為制訂了 physical 的標
準介面以降低整合時的複雜度而廣受好評。然
而，在高抽象層次中，我們將不再採用以
pin-accurate 為方式的模擬，進而採用 OCP-IP 於
2009 年 11 月推出符合 TLM-2.0 規範的 modeling 
kit – OCP TLM-2.0，來進行系統層級透過 OCP
介面來進行傳輸的模擬驗證。 
我們提出一個一端以 OCP 為介面，而另一端
以網路中常見的 Packet 為單位之網路介面
network interface (NI)，其中以 OCP 為介面的那
一端負責與 IP cores 溝通，而以 Packet 為單位的
一端則負責與外界網路溝通。如圖一所示，一個
網路介面可以使 processing element (PE)端跟
NoC 的設計得以分開進行，進而達到模組化設計
之目的，並提高模組的重複利用性。 
為了達到此目的， Processor (initiator) 與
Memory (Target) 對外的存取埠皆是以 OCP 
TLM-2.0 的 socket 的連接方式。而在 socket 的連
接中，一個 initiator 必定會對應到一個 target，因
此網路介面便會有一個相對應的 socket，而 socket
種類乃根據所連接的 PE 種類而定。舉例來說，
如果這個網路介面連接的是一個 processor，由於
processor 在系統中所扮演的角色為 master，因此
它便是一個 initiator，如此一來，這個網路介面
便會有一個 target socket與這個 processor相對應;
如果這個網路介面連接的是 memory，由於
memory 是一個 slave，因此它便是一個 target，因
此這個網路介面便會有一個 initiator socket 與這
個 memory 相對應。部分 IP cores 同時具備了
master IP 與 slave IP 的特性，這個網路介面便會
有兩個相對應的 socket (initiator 與 target)。 
而在網路介面與路由器(router)端，我們則以
自訂的 interface 與 port 來溝通，以減少呼叫大量
副程式的缺點。由於在網路中是以 packet 為單位
在進行傳遞，因此這個介面是以 packet 為基礎的
溝通介面，加上網路介面與路由器之間是一個雙
向溝通的模式，因此這樣的介面便會有兩組相對
應，如圖一的右半部所示。 
2. 建立 NoC 之 TLM 模型 
本計畫所完成之 NoC TLM 模型可分為兩
類，第一類為用以驗證軟體應用程式之模型，其
抽象層次較高，模擬速度較快。第二類為用以驗
證硬體架構之模型，其抽象層次較低，較能反映
實際硬體架構之特性。 
在用以驗證軟體應用程式之 NoC TLM 模型
中，我們簡化每一個 router 內部的設計，而僅以
其相對位置來模擬封包在網路中傳輸所需要的
latency。此觀念可由圖三的 NoC 之時間延遲
(latency)模型來說明，圖三中的每一個圓點皆代
表一個 router，我們給予每一個 router 一個具有
X 與 Y 的座標位置，而封包資料在 NoC 中傳輸
所需要的時間，則由這些座標位置的距離公式來
決定，亦即距離=|終點之 X 座標-起點之 X 座標|+|
終點之 Y 座標-起點之 Y 座標|。例如：有一個封
包要從座標為(1,0)的 router 送至座標為(3,2)的
router，在此模型中並不會模擬封包由(1,0)出發，
經由(2,0)、(3,0)、(3,1)，最後送至(3,2)的過程，
而是直接計算|3-1|+|2-0|=4，即算出 routing latency
為 4 個單位時間，同理，若有一個封包要從座標
 5 
個 router 沒有足夠的 virtual channel 能容納這個
flit，必頇等到下一個 router 的 virtual channel 被
清空，credit 才會增加，此 flit 才能往下送。
Credit-based flow control 之優點在於相較其他採
用 flow control protocol 的方法，它能提供較為簡
單明瞭的 handshaking，因此也間接提升了封包傳
遞時的效能。 
 Switch Allocator 
在我們設計的 router 中，switch allocator 是
當有兩個以上的 input ports 皆欲將封包送至同一
個 output port 的時候用以進行 arbitration 的機
制。而我們設計的 switch allocator 所採用的
arbitration scheme 為 iSLIP (iterative round 
matching with slip)，其主要特色包括：(1) 可以
達到很高的 throughput、(2) 具有 starvation free
的特性、(3) 實現硬體電路時電路簡單且快速。 
 Link 
Link 指的則是 router 之間的 physical wires，
用以傳遞 router 間的封包。然而，若我們以類似
一般硬體描述語言描述 physical wires 的方法來
建立 link 的模型，勢必會降低模擬速度。 
因此，在本計畫中我們捨棄上述的方法，而
是直接以 SystemC 中所定義的 channel 來做為
link 的模型，這樣的做法能夠讓我們的模型以較
高階且屬於C++-like 的語法來描述 link將有助於
模擬速度的提升，同時也是較符合 SystemC 模型
連接兩個 port 的描述方式。 
3. 整合 QEMU 至 SOC TLM 模型中 
我們已完成在虛擬平台上利用 QEMU 來模
擬 ARM 處理器，透過圖五所示的 SOC 系統可知
QEMU 與其他 SystemC module 溝通使用 BSD 
Socket 來溝通，為了使 QEMU 可以被很容易地
整合進 bus-based 系統中，我們設計了一個 Bridge
來連接 QEMU 與 Bus，而 Bridge 亦為平台上的
一個SystemC的module，其含有OCP TLM master 
socket 得以連接 Bus，以及實作 BSD socket 溝通
機制與 QEMU 進行資料傳輸。圖六系統為使用
兩個 QEMU 的 SOC 系統，其中一個 QEMU 執行
H.264 encoding 的 rate control，將 QP 值送到
encoder 並觸發 encoder 開始進行編碼。進行 5 張
frame 的編碼後，另一個 QEMU 開始動作，執行
H.264 decoder，而解完一張 frame 後，QEMU 會
觸發 Displayer 並且將 frame 資料送到 Displayer，
而圖像則由 displayer 顯示出來。Encoder 編碼第
五張 frame 後，兩個 QEMU 是同時動作的。 
4. 整合 NoC 系統至 EPIDETOX 設計平台 
在多核心系統的溝通架構中，一般的系統匯
流排架構限制了系統的效能，因此我們整合了
NoC 模型，取代 Bus 作為多核心系統的溝通機
制，並針對多核心的系統進行模擬。整合後的
NoC 可視為是單一的一個 IP，在虛擬平台上能夠
很容易地與其他的 IP 作連接，並組成系統來進行
模擬驗證。虛擬平台為本實驗室所開發的
EPIDETOX 虛擬設計平台，提供模擬與專案管理
的功能，並且在設計環境中採用 TLM-2.0 作為共
同的介面，以達到 plug-and-play 的目的。 
5. 發展測詴排程與測詴架構共同設計方法 
本計畫提出一測詴排程與測詴架構共同
設計方法，此方法之流程示於圖七。我們首
先建立 SOC 測詴所需之測詴元件高階模型，
所建立的測詴元件模型包括測詴控制器、
IEEE 1500 測詴介面電路、測詴匯流排、具有
掃描鍊之待測電路以及記憶體/類比電路內
建自我測詴器。這些高階模型省略了過度繁
瑣的電路細節，因此具有很快的模擬速度，
並且能透過模擬在系統設計初期提供發展測
詴排程與測詴架構所需的資訊。 
在建立完測詴元件模型之後，我們藉由
分析測詴資料於系統匯流排和測詴匯流排之
間的流向與頻寬，來分析測詴資料傳送的效能
曲線。藉由這樣的分析，我們可以找出因 SOC
設計中的參數(如系統匯流排的寬度以及記憶
體存取的時間)所導致的測詴資料傳送效能之
上限，並藉此大幅度地縮小原先龐大的設計空
間。 
設計空間經過縮減之後，我們利用我們
所發展的自動化軟體，將前述的測詴元件高階
模型快速地整合成完整的 SOC 測詴架構，並
透過不同的測詴排程結果來調整測詴架構之
參數，以模擬的方式來探索剩餘的設計空間，
尋求最符合該 SOC 設計之測詴排程與測詴架
構。 
 7 
 
圖五、QEMU 與虛擬平台之系統架構 
 
 
圖六、利用 QEMU 模擬雙核心系統之架構 
 
Test scheduling and test architecture co-development
Test infrastructure modeling 
with design parameters
TAM width analysis based on bandwidth of 
system bus and memory access latency
Development of SOC 
test scheduling
Development of SOC 
test architecture
圖七、測詴排程與測詴架構共同開發之流程 
 
99 年度專題研究計畫研究成果彙整表 
計畫主持人：李昆忠 計畫編號：99-2220-E-006-021- 
計畫名稱：具易測試及除錯特性之智慧型低功率多核心系統之設計技術研發：從電子系統層級至矽晶
片層級--子計畫八：多核心系統之低功耗測試及除錯(1/3) 
量化 
成果項目 實際已達成
數（被接受
或已發表）
預期總達成
數(含實際已
達成數) 
本計畫實
際貢獻百
分比 
單位 
備 註 （ 質 化 說
明：如數個計畫
共同成果、成果
列 為 該 期 刊 之
封 面 故 事 ...
等） 
期刊論文 0 0 100%  
研究報告/技術報告 0 0 100%  
研討會論文 0 0 100% 
篇 
 
論文著作 
專書 0 0 100%   
申請中件數 0 0 100%  專利 已獲得件數 0 0 100% 件  
件數 0 0 100% 件  
技術移轉 
權利金 0 0 100% 千元  
碩士生 5 5 100%  
博士生 2 2 100%  
博士後研究員 0 0 100%  
國內 
參與計畫人力 
（本國籍） 
專任助理 0 0 100% 
人次 
 
期刊論文 0 0 100%  
研究報告/技術報告 0 0 100%  
研討會論文 0 0 100% 
篇 
 
論文著作 
專書 0 0 100% 章/本  
申請中件數 0 0 100%  專利 已獲得件數 0 0 100% 件  
件數 0 0 100% 件  
技術移轉 
權利金 0 0 100% 千元  
碩士生 0 0 100%  
博士生 0 0 100%  
博士後研究員 0 0 100%  
國外 
參與計畫人力 
（外國籍） 
專任助理 0 0 100% 
人次 
 
 
