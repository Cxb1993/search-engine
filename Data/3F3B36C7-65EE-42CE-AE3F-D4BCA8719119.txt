 2
??????????ebay?? Skype???????? SIP ???????? 3PCC
????????????????????????? SIP ???????????
???????????? 3PCC ??????????? 3PCC ??????????
??????????????????????? 
 
II. ???? 
 
????????????????????? SIP ?????????????
VoIP gateway????????????????????? 3PCC ????????
1?????????? 
 
? 1?SIP??? VoIP gateway????? 
 
? SIP ????? FxsEventThread?????????? LED ????????
caller (433925)???????????pickup()?caller?????????
call_out()?????? SDP ??????? INVITE ? SIP Server???????
callee(433941)?Callee?? INVITE ???call_new()????????180 
Ringing??????????????????caller???180 Ringing????
call_ringing()?????dialtone??callee????pickup()???????SDP
????????200 OK??caller???caller??call_answered()?????
?ACK????????????socket?? RTP ????????callee????
?????callee???????call_terminate()???BYE??caller?caller
?eXosip2 library?eXosip_process_bye()?????200 OK??callee?caller
?????? ?EXOSIP_CALL_CLOSED??????caller????????????
 4
VoIP ???? 3PCC Controller?? Gateway?????udpserver???udpclient
???????????? 3pcc.txt?Gateway?sip????????? SIP ???
?????sip??????? 3PCC Call?????AutoDialThread??????
?????????(INVITE)?????????????? REFER ?? INVITE ???
??????? RTP ????? 
 
? 3?????? 
 
??????? Embedded VoIP Gateway??????? 3PCC Controller????
????????? RFC-3725 ???????????? REFER ??????? 3PCC
???????????????????? SIP UA??????????????
SIP????????????????????SIP????????????Gateway
??????????????????????????????????????
?????????????? SIP UA??????????? Embedded VoIP 
Gateway? 
 
3PCC ? REFER 
 
? 1??? SIP ??? Gateway????????????? 1????????
??? 3PCC ?????? 4???? 
 
 6
??? Channel A?? Channel B????????? Channel??call_terminate()
????????refer_to->hvalue????????(433902)???call_out()?
???????? 1????? 
 
UDP server 
?udpserver.c????????udpserv_watchdog???udpserver????
????udpserv_watchdog?????socket?????????????????
??select()???????????recvfrom()???????? 3PCC ?????
fopen()?? 3pcc.txt????fputs???????sip.c?AutoDialThread??
??? 3PCC ??? 
 
 
? 5?udpserver.c 
 
???sip.c???????AutoDialThread??????? 3PCC Controller
????????while(1)?????????????????while(1)????
??fopen()?? 3pcc.txt????????strstr()??????????? 
? | ???????flag?? 1(????? 3PCC Call)?????flag?? 0(??
?? 3PCC Call)? 
 
??flag? 1(????? 3PCC Call)???????????(1)??
AutoDialVinfdInit()?????vinfd???(2)?? ParseNumber()???????
? VOIP ???(3)??call_out()? Controller?????? 3PCC Call?????
???(4)?????fopen??w+???? 3pcc.txt??? 
 
vinfd??????? 
 8
?????(REGISTER)?????(INVITE)???? 
 
? 7. Challenge-based 
 
 ????(Registration Authentication) 
?? SIP UA??? SIP Proxy?????????????? Proxy??????
?? SIP UA????UA? Server??????SIP?? 401(Unauthorized)??????
Server????????????????? 401(Unauthorized)????
WWW-Authenticate????UA??? 401(Unauthorized)????????????
MD5?????WWW-Authenticate????????? Authorization???????
?????????Server??????? Register????????? 
 
? 8. Registration Authentication 
 
 ????(INVITE Authentication) 
 10
BYE????????????????????SIP Proxy Server?? BYE????
?????? 
 
? 10. BYE Authentication 
?? ?? 
relam ??????????? SIP Proxy?
URI????? UA???? 
nonce ?????????????
TIMESTAMP???MD5?????? 
opague ???????client???????
????????(optional) 
algorithm ?????????MD5(optional) 
Qop ??? auth??????????
auth-int??????(optional) 
? 1. WWW-Authenticate Header?? 
?? ?? 
 12
 
? 12.UAS??? 
 
z 492 Authentication Required ?????? 
 
492 Authentication Required???? subject???subject??? Timestamp?
Random String???? 
Subject  =  Timestamp “?”  Random String 
Timestamp???????????? UTC??????????(reply attack)?Random 
Sting? 16 bytes????????? A~Z?a~z??? 0~9??????? 
 
 UAS??? 
UAS??? Request????? subject????????? Request??? subject
?????? Request??????? Request?????? 492 Authentication Required
???????? UAS???????????????????????????
??? 
? Request?? subject???????????????? timestamp?????
???????????????????????????(reply attack)?????
??????????????????????????????????????
?? Request????????????????? Request????? 
 14
 
 
? 14.UAC??? 
 
 INVITE Request?? 492?? 
??? 492????? INVITE Request??UAC?????? call_out????
SDP??? INVITE??? UAS?UAS??? INVITE??????
EXOSIP_CALL_INVITE???(event)?josua_event_get()??????????
call_subject???call_subject???????????? INVITE???? subject???
????? 492 Authentication Required?????? UAC??? UAC? INVITE??
???????UAC??? 492 Authentication Required ????????
EXOSIP_CALL_REQUESTFAILURE???????????????? call_mutual
???? 492 Authentication Required??????????? INVITE Request???
???? INVITE?UAS????? subject??? INVITE???? call_subject???
?? subject???????????????????????????? IVNITE?
???? Request???? call_new???????? 
 16
 
? 16. BYE?? 492?? 
 
??P2P ???? 
 
z ?????????? 
 
?????? SIP ??????????????????? SIP server????
??????????????????????????????????????
?????????????????????????????????SIP Server
???????????????????????? SIP Server????????
????????? SIP Server?????? SIP Server????? SIP P2P ???
??????? SIP P2P ????? ? DHT(Distributed Hash Table)??????
? SIP Server??????? Client?????????????????????
? Client?????????? DHT ???????????? Embedded System?
??????????? DHT ? Client???????? Client?????????
??? SIP Server?????????????????????????????
??????????Cache?????????Page???page replacement?LRU
??????????????????????????????? WEB ?????
????? Friend list??? Friend list??????????????????
??????????????????????? SIP Server???????? SIP 
Server??????????????????????????????????
????????????????? 17 ????????? Friend list????
??????????? VoIP Gateway?????????????? SIP Server?
 18
200 ok? SIP????????????????1????????????????
???????????? P2P Cache???????(?? LRU???)?????
?????????????? Find_P2Pcache?????????? P2P Cache??
???????????????????????? INVITE??????2????
???????????? SIP Server? 
 
? 18??????????? 
Incoming Calls? 
 
????????????????????????????????????
???????? P2P Cache?????? P2P Cache??????????????
??????????? 4-3 ??????????????? Find_P2Pcache???
??????????? P2P Cache??????? P2P Cache??????????
____________________________________ 
1 ?????????????????????????? 
2 P2P Cache????????????????????????????? 
 20
? CacheData???????????????? 
2. lutex_lock ? P2P Cache ??????????????? mutex_lock ?? ON
????? P2P Cache??????????? P2P Cache??????????
???? P2P Cache???????? 
3. size? P2P Cache?????????????? P2P Cache??????? 
 
P2P Cache???? 
 
P2P Cache????????? LRU ?????????mutual exclusion????
??? P2P Cache??????????????????????????????
????? 
 
P2P Cache???????????????????????????????
???????? P2P Cache??????????? Find_P2Pcache???????
P2P Cache????????? Finf_P2Pcache?????????????????
???? P2P Cache?????????????(??muteex_lock?? ON)????
???????????mutex_lock??? OFF?????????????????
???????????????? P2P Cache?????????????????
???????????P2P Cache????????????10??????code size
????????????????????????????? P2P Cache????
???? LRU ???????????????????? 0??????? P2P Cache
?????????????????????-1??????????? 
 
? 20??? P2P Cache????? 
 
 22
 
? 22??? P2P Cache????? 
 
z ?? Friend List 
 
?????????????? P2P Cache?????????????????
????????????????????????? P2P Cache????????
VoIP Gateway?????????? Web? Web Server????????? Web??
?? VoIP Gateway??????SIP ??????????????????????
???????????? Speed Dial??3?? ??????????????
?????????????????? Quick Dial??????????????
??????????????????????????????? Friend list?
??????????????????? Web???????????????? P2P 
Cache???????????? Friend list?????????????????
?????? LRU ??????????????????????????????
???? Friend list?? P2P Cache????? P2P Cache?????????? SIP 
Server?????????????P2PCache?????????????Friend list
????????? P2P Cache????????? Friend list????????
Friend list?????????????????????????? P2P Cache?
??????????????code size??????? 
____________________________________ 
3 Speed-Dial???????????????????? VoIP Gateway?????????????
??? 0~9??????????????? 3(????)??????? 433931??????????
3?????????????? 433931??? 
 24
 
? 24?Speed Dial???? 
 
? 25????????? 
 26
? IP address???? port number?? STUN Server???????? port number??
??? SIP ???? NAT???????????????? SIP ?????????
?????? P2P Cache?????? SIP ??????? IP ??????????
????? IP address????????????????? P2P Cache??????
????????????????? STUN???? NAT? SIP ???contact??
?? IP ???????port?????????????IP address??? NAT??
? port number??????????contact??? port number???? 5060 port??
?????????? contact??? port number????????????????
??????? P2P Cache??? 
 
? 27?STUN ? NAT ???? 
 
? 28??? STUN?? NAT? 200 ok?? 
 28
 
? 30???????????????? 
 
??????????????? 
 
z ?? 
 
? SIP???????????? SIP UAC ???Invite? Proxy Server??? Proxy 
Server? Invite??? SIP UAS???? Register Server?????????????
??????????????????????????????????????
??????????????????????????????????????
??????????????????????????????????????
??????????????????????? 31?????? SIP UAS???
??????????? Proxy Server??? Invite????????? VoIP Gateway
?????????????????????????????????? SIP UAS
??????????????????????????????????? SIP 
UAC?????????????????VoIP Gateway????SIP????486 Busy 
Here?????????????????? SIP Express Media Server??? SIP UAS
????????????? 32 ??? 
 30
?????????? josua_event_get()???method? INVITE ? SIP Message??
??????????????? INVITE ? SIP Message?????????
osip_from_get_url()???osip2????function???? From????parsing?
??From???????SIP URI?From???????? 
char* scheme        // ??? sip 
char* username      //caller account 
char* password      //caller password ??? null 
char* host          //Domain?? proxy server????? proxy ip address 
char* port 
osip_list_t* url_params 
osip_list_t* url_headers 
char* string         // other scheme 
 
? VoIP Gateway?? username???????? whitelist_lookup()?? function???
????????????? VoIP Gateway???? white list??????? INVITE
? username???????? white list??????? username?????????
???? SIP Message?? call_new()4?????????????? VoIP Gateway?
??? INVITE SIP Message?VoIP Gateway??eXosip2????function 
eXosip_call_send_answer()???? 486 ???????caller??caller?????
?????????? SIP Express Media Server??????????? 33? 
 
??????webs?webs???????web server?????GoAhead
? VoIP Gateway?? web server?????????????VoIP Gateway ?
??? VoIP Gateway????? whitelist????????webs?????????
?????????????????????webs????????whitelist.cfg?
?????????????????????????????????????
rawaccess –d ?????? flash memory????????????????????
rawaccess –s???????????????????? 34? 
 
???webs?????????whitelist?????????????????
??????????????? websAspDefine()? get_whitelist???ASP5?
function??????????ASP ??????????????????????
??????????????? Save????????????????????
??????????????????????????????????????
???????????????webs????websGetVar(?)???? Save?
function?websFormDefine()??????? form action????post??????
____________________________________ 
4 call_new()? VoIP Gateway??????? RTP Media? function? 
5 Active Server Pages? 
 32
          
? 35???????? 
 
? 36?Filter On / Off 
??(Speed Dial)?? VoIP Gateway?????????????VoIP Gateway
???????????????? VoIP Gateway????? SIP Message????
?? Proxy Server?????????? Proxy Server??? OpenSER ?? Proxy 
Server?OpenSER ???? C?????project???????? SIP message??
OpenSER ??????????????????module?? Proxy Server????
???????? OpenSER ??????module???????? SPEEDDIAL ?
module???module??????????????? SIP addresses???????
????????????????????? SIP addresses??? OpenSER ???
?????????????????????????????? SIP message??
OpenSER?OpenSER ???sd_lookup()????????sip addresses? 
 
???????????????????????????? SIP Message??
 34
[1] “ADM-5120 Data Sheet Rev. 1.1”, Infineon Technologies., March 2005. 
[2] A Network Protocol Analyzer: WIRESHARK (http://www.wireshark.org/) 
[3] Chrootstrap's Hacking Articles: Writing sysctl Drivers on Linux 
(http://www.geocities.com/chrootstrap/index.html) 
[4] Daniel P. Bovet, Marco Cesati, “Understanding the Linux Kernel, 3/e”, O’Relly,  
November 2005. 
[5] Anat Bremler-Barr , Ronit Halachmi-Bekel , Jussi Kangasharju , “Unregister Attacks in 
SIP”, 2006 IEEE. 
[6] B. Campbell,J. Rosenberg,H. Schulzrinne,C. Huitema,D. Gurle,” Session Initiation 
Protocol (SIP) Extension for Instant Messaging”, RFC-3428, December 2002. 
[7] Tasos Dagiuklas, Dimitris Geneiatakis, George Kambourakis, Dorgham Sisalem, Sven 
Ehlert, Jens Fiedler, Jiří Markl, Michal Rokos, Olivier Botron, Jesus Rodriguez, Juntong 
Liu, “Low Cost Tools for Secure and Highly Available VoIP Communication Services”. 
[8] Dealing Effectively with Spam, 
(http://www.windowsecurity.com/whitepapers/Dealing_Effectively_with_Spam_.html) 
[9] Samer ELSAWDA, Pascal URIEN ,“SIP Security Attacks and Solutions: A 
state-of-the-art review”, 2006 IEEE. 
[10] J. Franks, P. Hallam-Baker, J. Hostetler, S. Lawrence, P. Leach, A. Luotonen, L. Stewart, 
“HTTP Authentication: Basic and Digest Access Authentication”, RFC-2617, June 1999. 
[11] Dimitris Geneiatakis, Georgios Kambourakis, Tasos Dagiuklas,Costas Lambrinoudakis 
and Stefanos Gritzalis, “SIP Security Mechanisms: A state-of-the-art review”. 
[12] M. Handley, V. Jacobson, “SDP: Session Description Protocol”, RFC-2327, April 1998. 
[13] San Jose, CA, David A. Bryan, “Peer-to-Peer SIP”, Invited Talk at Cisco Systems, July 
2005. 
[14] Linux ???? (http://www.lslnet.com/linux/f/docs1/i53/big5355970.htm) 
[15] Matthew Mintz-Habib, Anshuman Rawat, Henning Schulzrinne, and Xiaotao Wu, “A 
VoIP Emergency Services Architecture and Prototype”, in IEEE International 
Conference on Computer Communications and Networks (ICCCN 2005), San Diego, 
October 2005. 
[16] MySQL (http://www.mysql.com/) 
[17] PHP (http://www.php.net/) 
[18] Qi Qiu, “Study of Digest Authentication for Session Initiation Protocol (SIP)”, 
December 2003. 
[19] Y. Rebahi, D. Dorgham, T. Magedanz, "SIP Spam Detection", Digital 
Telecommunications, 2006. ICDT '06. International Conference on 2006 Page(s):68 - 68. 
[20] Y. Rebahi, D. Sisalem, "SIP Service Providers and the Spam Problem", in the Voice 
over IP Security Workshop (June1- 2 , 2005) Proceedings, Washington, USA 
[21] J. Rosenberg and C. Jennings, "The Session Initiation Protocol (SIP) and Spam" , 
RFC-5039, January 2008. 
[22] J. Rosenberg, H. Schulzrinne, “An Extension to the Session Initiation Protocol (SIP) for 
Symmetric Response Routing”, RFC-3581, August 2003. 
[23] J. Rosenberg, H. Schulzrinne, G. Camarillo, A. Johnston, J. Peterson, R. Sparks, M. 
Handley, E. Schooler, “SIP: Session Initiation Protocol”, RFC-3261, June 2002. 
[24] J. Rosenberg, H. Schulzrinne, G. Camarillo, J. Peterson, “Best Current Practices for 
Third Party Call Control (3pcc) in the Session Initiation Protocol (SIP)”, RFC-3725, 
April 2004. 
[25] J. Rosenberg, J. Weinberger, C. Huitema, and R. Mahy. “STUN - simple traversal of 
user datagram protocol (UDP) through network address translators (nats)”, RFC-3489, 
Mar 2003. 
[26] Stefano Salsano, Luca Veltri, Donald Papalilo, “SIP Security Issues: The SIP 
Authentication Procedure and its Processing Load”, December 2002. 
[27] Dorgham Sisalem, Jiri Kuthan ,“DENIAL OF SERVICE ATTACKS AND SIP 
2008?????????? (ICST GridNets 2008) 
???? 
 
??? ??? 
???????????? 
 
1.????? 
 
??????????????????????????????????
????????????????????????????????????
?????????????????? Internet???????????????
????????Grid networking?????????????????????
????????????????????????????????????
????????????????????????????????????
???????????????????? 
??? ICST?? ACM??? GridNets 2008??????????????
????????????????????????????????????
????????????????????????????????????
????????????????????????????????????
????????????????????????????????????
????????????????????????????????????
????????????????????????????????????
????? 
 
2. ?????? 
 
???????? Grid??????????? Pascale Vicat-Blanc Primet 
(INRIA, France), Joe Mambretti (Northwestern University, USA), ? Francis Lee Bu 
Sung (NTU, Singapore)??????????????????????????
??????????? 30????? 60?????????????????
????????????????????????????????????
???结????????????????????????????????
 Data replication and multicasting strategies and novel data transport protocols 
 Fault-tolerance, self healing networks 
 Security and scalability issues when connecting a large number of sites within a 
virtual organization VPN 
 Simulations 
 New concepts and requirements that may fundamentally reshape the network 
evolution 
??????????????????????????????/??????
??????????????????????? 
? Conference Day 1?????????????? Gala Dinner??????
????????????????????????????????????
????????????????????????????????????
??????????????????????????????? 
 
3. ?????? 
 
?????????????????????????????Session 3 :  
GridNets, Peer-to-Peer Network Enhancements, and Distributed Data Management???
?????? GridNets? P2P????????Modeling????????????
??????Mobile Streaming Media?????? Proxy Caching Algorithm???
????????????????????????????????????
??????????Mobile P2P????????? 
??????? QoS????????????????????????
?????????Session 4 : Advanced GridNets Research Topics and Methods??
???? QoS?????????????????????????/????
???????????????? QoS??????? QoS??????? 
??Session 6: GridNets Management, Traffic Analysis, Monitoring, Analysis, 
Reliability?????????? Grid Networks???????????????
?????????????????????????????????????
???????????????????? Internet????????????
???????????????????Ad Hoc?????????WiMAX?
????????????????????????????????????
