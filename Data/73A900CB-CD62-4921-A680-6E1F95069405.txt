 2
芽技術聯盟)所推出的新一代藍牙傳輸標準
(Bluetooth 3.0)，或是 WiMedia 與 USB-IF 聯
合推出的 Certified Wireless USB 傳輸標準
等，皆顯示 UWB 與現有數位資料傳輸標準
(如 Bluetooth、USB 與 IEEE1394 等)之間的
緊密結合，國防電子產品、工業、電腦、通
訊和消費性電子產品等相關應用，使得 UWB 
MB-OFDM 無線通訊系統的前景十分被看
好。 
此系統的核心架構是以 OFDM 為基礎，
具有支援高資料傳輸速率、簡化等化器
(Equalizer)設計等 OFDM 系統的優點，但也
因此對於接收訊號之同步的效能非常敏感，
圖 1 顯示規格書中的發射系統方塊圖。其中
接收機的同步設計對系統效能具關鍵性影
響。本計畫依照 ECMA-368 規格針對 UWB 
MB-OFDM 無線通訊系統的同步技術作深入
的研究，並將之以 Xilinx FPGA 晶片設計並
實現。 
    
 
圖 1 UWB MB-OFDM 無線通訊系統方塊圖 
二、 同步方法之研究與模擬結果 
2.1 UWB 接收系統之同步方法研究 
在一般無線通訊系統中，採用同調解調
或是相關性偵測技術時同步佔了非常重要的
地位。所謂同調解調是指接收機需要一個與
發射端相同頻率與相位的載波。因此一般的
無線通訊系統通常須克服以下 3 種同步問
題： 
1. 發射端與接收端的載波頻率不同 
2. 發射端與接收端的取樣頻率不同 
3. 接收端不知道訊號的起始位置 
ECMA-368 規範採用 Multi-band OFDM
技術傳送數位資料，其中 OFDM 是最重要的
關鍵技術。OFDM 訊號是由多個子載波
(Sub-carrier)疊加所組成的，每個子載波之間
具有正交性。子載波之間的正交性對於
OFDM 系統來說是十分重要的，因此對於
OFDM 系統的載波同步要求也相對地更加嚴
格。OFDM 系統的同步包含下列 3 項議題： 
1. 頻率同步 
2. 取樣同步 
3. 符元同步 
圖 2 說明 OFDM 系統的同步要求，並顯
示上述 3 種同步在系統中的位置。 
IFFT
FFT
D/A
A/D
載波調變
載波解調變
通道符元同步 取樣同步 頻率同步
圖 2 OFDM 系統內的同步示意圖 
OFDM 系統若以解決同步型式來區分，
可分成時域和頻域兩種解決方式： 
1. 時域－能解決時間與相位偏移 
2. 頻域－能解決頻率偏移 
OFDM 系統若在進行同步時，以是否有輔助
資料來區分，可分成以下兩種方式： 
1. 無資料輔助(non-data-aided)－盲蔽
式估測(blind estimation)。 
2. 有資料輔助(data-aided)－傳送端提
供訓練符元(training symbols)或循
環字首(cyclic prefix)、領航訊號等
輔助資料協助接收端進行同步。 
 4
步架構如下： 
1. 接 收 訊 號 能 量 偵 測 (received signal 
energy detection)： 
以計算接收訊號能量偵測封包起始邊緣
之方式是最簡單的一種封包同步方法。接收
訊號未含封包時，接收到訊號 nr 只包含雜
訊，此情況接收訊號可表示成 nn wr = 。當接
收訊號開始內有封包出現時，接收訊號可表
示成 nnn wsr += 。檢視這兩種情況之接收訊
號，顯然可以用接收訊號的能量變化來偵測
封包的起始時間。封包起始時間的偵測問題
所對應假設命題之決定變量可定義為接收訊
號的能量 nm ，此決定變量(累計接收訊號的能
量)表示成 
∑ ∑−
=
−
=
−−− ==
1
0
1
0
2*
L
k
L
k
knknknn rrrm
 
以上 nm 計算式可以簡單看成一個接收訊號
能量的移動和(moving sum)，也就是說將一滑
動窗口(sliding window)內之接收訊號能量做
加總運算。依此觀念， nm 計算式可改寫成 
2
1
2
11 +−++ −+= Lnnnn rrmm  
因為採用滑動窗口技巧，上式說明依時序以
新增一個接收訊號能量值並丟棄一個舊的接
收訊號能量值達到計算決定變量之目的。此
方式在硬體實現上可以降低乘法的複雜度，
但需要較多的記憶空間來儲存 2|| nr 。 
接收訊號能量偵測封包演算法之模擬結
果如圖 4~6 所示，其中訊雜比分別為設定為
SNR = 0 dB、3 dB、10 dB。 
 
圖 4 SNR = 0dB 時的能量偵測結果 
 
圖 5 SNR = 3dB 時的能量偵測結果 
 
圖 6 SNR = 10dB 時的能量偵測結果 
2. 雙滑動窗口封包偵測 (double sliding 
window packet detection) 
雙滑動窗口封包偵測演算法基本上與前
述訊號能量偵測演算法同樣採取計算接收訊
號能量的方式來偵測封包，雙滑動窗口封包
偵測演算法的示意圖如圖 7 所示，其中箭號
表示封包相對於滑動窗口之移動方向。分別
計算兩個相連的滑動窗口內之訊號能量： 
 6
 
圖 10 雙滑動窗口封包偵測結果(SNR=10dB) 
3. 延遲相關器(delay correlator)[23]： 
由 ECMA-368 UWB 規範可知封包起始
資料是 preamble，圖 11 顯示規範訂定的一種
封包形式，此 preamble 依序包含 21 個相同
的序列 0PS ~ 20PS (用來做封包同步)、3 個與
前面 21 個異號的序列 0FS ~ 2FS (用來做符元
同步 )以及 6 個用來做通道估測之序列
0CE ~ 5CE 。其中每個序列 0PS ~ 20PS 起始都是
32 個零，接著 128 個大小不一的實數，再來
是 5 個零。有關序列中間的 128 個實數，在
ECMA-368 UWB 規格書中定義有五種不同
的序列。以下說明如何利用序列 0PS ~ 20PS 並
以延遲相關器來做封包偵測。 
 
圖 11 UWB 系統其中一種的封包形式 
考量前述系統所設計的封包起始
preamble 內之重複符元，我們可以利用延遲
相關器架構計算前後兩個符元在時間軸上的
相關性，一般而言，當兩個符元時間內收到
的信號都是雜訊或一個是雜訊另一個是訊號
時，前後兩個符元之相關性接近 0，當兩個
都是相同訊號時，相關性就很大。計算前後
兩個符元的延遲相關器架構如圖 12 所示，其
中 Z-D 是一個延遲器，延遲時間等於一個符
元時間；( )*是取共軛複數； 2|   | 表示信號大
小， 2)  ( 平方運算。 
圖 12 說明收到的訊號分由兩路的滑動
窗口來偵測，分別為 C 窗口與 P 窗口。其中
C 窗口是計算延遲一個符元時間後，延遲的
符元與未延遲的符元之相關性計算 
∑−
=
+++=
1
0
*
L
k
Dknknn rrc  
原則上此相關性可以當做封包偵測之決定變
量，為了將決定變量限制在於 0 到 1 之間，
因此將決定變量做正規化處理，透過 P 窗口
計算延遲符元的功率 
∑ ∑−
=
−
=
++++++ ==
1
0
1
0
2*
L
k
L
k
DknDknDknn rrrp  
在此封包偵測之決定變量 nm 定義成 
( )2
2
n
n
n p
c
m =
 
得到決定變量 nm 後便可完成封包偵測。 
( )*
( )2
| |2C
PZ-D
÷
cn
pn
rn mn
 
圖 12 延遲相關器 
設定訊雜比分別 SNR = 0 dB、3 dB、10 
dB 等三種情況模擬延遲相關器演算法，其模
擬結果如圖 13~15 所示。 
 8
 
圖 18 符元同步估測結果(SNR = 10 dB) 
2.3 UWB 接收系統之頻率同步研究與軟體模
擬 
 頻率同步 
頻率同步主要是補償頻率偏移所造成的
影響，一般形成頻率偏移的因素有兩項，第
一項為傳送端和接收端之間的本地振盪器不
匹配所造成，第二項則是由都卜勒效應
(Doppler Effect)所造成，由於 UWB 是在室內
的靜態環境中使用，因此可把第二項因素忽
略。關於振盪器不匹配的部分，UWB 標準在
中提到最大中心頻率偏移( fΔ )為±20 ppm，假
設在最大的頻率偏移下，即傳送端是+20 
ppm，接收端是−20 ppm 時，此時就會有 40 
ppm 的頻率偏移，因此我們可以推算出 UWB
其中的一個中心頻 3.432 GHz 時，最大頻率
偏移下的相位旋轉(θ )為： 
kHz 280.137
)10432.3)(1040(
GHz 432.3ppm 40
96
=
××=
×=
−
Δf
 
雖然在此只須考慮振盪器不匹配所造成
的影響，但是頻率稍微不同步，就會造成系
統中子載波與子載波之間的相互干擾，因而
對系統傳輸效能造成嚴重的傷害。其中頻率
同步包含兩個部份，粗略頻率同步(Coarse 
Frequency Synchronization)與相位追蹤(Phase 
Tracking)。 
1. 粗略頻率同步 
粗略頻率同步為接收端一開始的頻率估
測，主要是為了校準接收的訊號與接收端本
地震盪器之間的頻率誤差。由於標準中提供
了 21個相同的封包同步序列與 3個符元同步
序列，因此非常適合使用延遲相關（Delay 
Correlation）的方式來處理頻率同步的問題。 
首先定義頻率偏移如何產生，接收端的
第 n 個取樣點可表示為： 
*exp( 2 ) *exp( 2 )
*exp( 2 )
n n tx s rx s
n s
r x j f nT j f nT
x j f nT
π π
π Δ
= −
=  
其中 nx 為傳送訊號， txf 為傳送端震盪器
頻率， rxf 為接收端震盪器頻率， Δf 為頻率偏
移量。頻率偏移的估測可以藉由計算相關值
z 求得，數學式為： 
( )( )
( )
1
*
0
1 *22
0
1
22*
0
1
22
0
ss
ss
s
L
n n D
n
L
j f n D Tj f nT
n n D
n
L
j f n D Tj f nT
n n D
n
L
j f DT
n
n
z r r
x e x e
x x e e
e x
ππ
ππ
π
ΔΔ
ΔΔ
Δ
−
+
=
− +
+
=
− − +
+
=
−−
=
=
=
=
=
∑
∑
∑
∑
 
其中 L 為每個符元內包含的取樣點數，
D 為前後兩個符元取樣點間的延遲。圖 19 為
UWB 接收端於 TFC(Time Frequency Code)等
於 1 或 2 時接收訊號的方式，每個符元內包
含有 165 個取樣點，由於每次接收都會依第
一個頻帶(Band)、第二個頻帶與第三個頻帶
等順序接收，因此每個頻帶中的符元彼此會
相距三個符元的長度 495 個取樣點。最後只
需求出相關值 z 數學式中的角度，再經由代
換後即可得到估測出的頻率偏移量，表示為： 
1ˆ
2 s
f z
DTπΔ = − ∠  
 10
作介面進行測試資料之建立與 FPGA 程式燒
錄；所建立之同步演算法程式經由 VeriComm
以 USB 傳輸線燒錄至 FGPA 發展板(控制/運
算核心晶片為 XC4VLX60-FF1148)進行硬體
平台之模擬；硬體模擬結果再藉由 USB 傳輸
線傳回至 PC 端之 VeriComm 進行顯示，並由
模擬結果確認同步演算法之正確性及可靠
性。VeriLite 之開發驗證流程及 FPGA 發展板
如圖 23~24 所示。 
 
圖 23 VeriLite 驗證流程示意圖 
 
圖 24 VeriLite FPGA 發展版 
 時間同步演算法 
    目前設計的封包同步演算法乃採用延遲
相關器來進行設計，其硬體架構圖如圖 25 所
示。
Register(length=8)
Code Register(length=8)
.....
Register(length=120)
Code Register(length=16)
.....
∑
∑
Data In
Compare
Threshold
Data out
 
圖 25 封包同步演算法之架構圖 
時間同步演算法的 ModelSim 模擬結果
如圖 26~28 所示，並與 FPGA 之輸出結果(圖
29)進行比對。圖 26~28 為 ModelSim 的模擬
結果，當 valid 由 0 轉換為 1 時，表示已偵測
到封包並完成其同步，結果由晶片之輸出埠
觀察可得到確認。完成時間同步後，晶片的
輸入埠(inr1~3、ini1~3)資料會傳送到輸出埠
(outr、outi)，圖 26 為完成同步後輸出子頻帶
1(inr1、ini1)的資料，經過 165 個 clk 後，圖
27 為輸出資料由子頻帶 1 到子頻帶 2(inr2、
ini2)之切換。圖 28 將輸入埠與輸入埠以十六
進制表示以便於觀察。 
完成 ModelSim 驗證後，將程式載入
Xilinx 核心晶片中，由數位資料產生器建立
測試訊號(inr1~3、ini1~3、rst、clk、enable)，
並與發展板輸入埠連接，由發展板之輸出埠
(outr、outi、valid)觀察硬體輸出結果，以驗
證其功能之正確性。經比對後，得以驗證本
計畫所採用之封包同步演算法的正確性及其
可行性。如圖 29 所示，經過封包同步演算法
後，將訊號分為 5 bits 的實部與虛部兩部
分，而 valid 等於 1 時表示開始封包同步演算
法已開始進行動作。 
 
 
圖 26 時間同步之 ModelSim 模擬結果-1 
 
圖 27 時間同步之 ModelSim 模擬結果-2 
 12
 
圖 33  頻率同步之 FPGA 執行實測結果 
 
由模擬結果可知，我們所採用的時間/頻
率同步演算法，可適用於 ECMA-368 的 UWB
接收機系統規範。經由模擬以及 Xilinx FPGA
進行硬體設計與實現，並藉由北瀚科技公司
之 VeriLite 開發驗證平台與 MATLAB 軟體模
擬結果比對驗證本計畫中所使用的同步方法
是可實際應用於 UWB 接收機硬體同步電路
設計。 
配合總計劃將同步演算法整合成一
UWB 接收機基頻系統，並完成 TSMC0.13um
製程 CMOS 晶片佈線(layout)，原型晶片尺寸
為 2.37 mm x 2.37 mm，圖 34 顯示晶片佈線
圖。詳細規格如表 1 所示。 
 
  
 
 
 
圖 34 UWB 基頻接收晶片之佈線圖 
 
表 1 UWB 同步演算法之晶片規格表 
Technology 
0.13 mμ  CMOS process 
1P8M 
Power supply 1.2 V 
Core size 2.37 mm × 2.37 mm 
Clock rate 132 MHz 
Power consumption 132 mW @ 132MHz 
Gate-count 0.133M 
 
三、 計劃成果自評 
    本計畫第一年主要研究 ECMA-368 
UWB 規格書，以及蒐集並研究 UWB 
MB-OFDM 相關技術資料，尋找適當的同步
演算法並建立 UWB MB-OFDM 接收機系統
時序同步模擬模型，進行模擬。第二年度以
硬體描述語言將之實現，經由 Xilinx FPGA
進行硬體模擬，並與軟體模擬結果相互比
對，驗證所設計的同步電路可應用於實際的
UWB 接收機，此部份成果已發表於 2006 年
民生電子暨信號處理研討會以及二○○七年
消息理論及通訊春季研討會暨國科會成果發
表會[24, 25]，相關成果申請中華民國發明專
利中[26]。本年度將經過 FPGA 功能驗證後
的同步演算法，以 TSMC 的 0.13 mm CMOS
晶片製程完成 VLSI 架構及下線流程。所完
成的晶片原型預計可提供準確且快速的資料
同步，並達到 ECMA 的高速傳輸需求。本年
度部份成果發表如[27]-[29]所示。 
 另外，配合總計畫之執行，共同建立一
個 UWB 接收機基頻硬體電路系統平台，其
中使用區塊化的設計方式，因此可以獨立更
換各個區塊的演算法的方式進行系統設計與
實現。相信所建立之 UWB MB-OFDM 基頻
系統性能分析平台及硬體平台可提供系統設
計工程師在 UWB MB-OFDM 系統中快速驗
證各種演算法及接收機硬體設計上的參考以
及演算法的性能分析。 
 
2.37 m
m
2.37 mm 
