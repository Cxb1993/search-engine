communication network of vehicle electronics and 
advance the extending control among various control 
platform and instrumental interface.   
Thus, the study increases the application that 
benefits the communication network technology of 
vehicle electronics and fulfills more needs in the 
related field. 
 
英文關鍵詞： USB, LIN, CAN, FlexRay, Analyzer 
 
  
中文摘要 
 
本計畫的主要目的即是發展一 FlexRay/CAN/LIN 三合一協定分析儀，並以此來檢測目前
常用的車載通訊電子網路介面-FlexRay、CAN 與 LIN。 
此分析儀具備高速的 USB 2.0 介面，用來即時傳送剖析後的 FlexRay、CAN 與 LIN 等各
種車載訊號的封包至 PC 主機端觀看。其中，運用一 USB 2.0 晶片組連接 CAN 控制器與 CAN
收發器，及 LIN 收發器分別來實現 CAN 與 LIN 匯流排協定的剖析。另外，再連接一 CPLD
元件來實現 FlexRay 網路協定的剖析。而此分析儀不僅低成本及友善的 GUI 人機介面外，並
符合 FlexRay 2.1、CAN2.0 A/B 與 LIN 2.0 等三種協定規格。 
相較於國內外的相關儀器，本計畫所要實現的三合一協定分析儀不僅可以提供隨插即用
與快速量測的功能，亦可達到搜尋目前匯流排節點的功能。透過此計畫的實現，可提供了在
車載通訊電子網路的訊號解析與連接功能外，並可實現在諸多車載控制平台或儀器介面的延
伸診斷功能。如此，更可加速車載通訊電子網路的應用利基，並提高相關產業的需求。 
 
 
 
 
關鍵詞：FlexRay、CAN、LIN、USB、分析儀 
 
  III
目錄 
中文摘要 ………………………………………………………………………………………… I 
英文摘要 ………………………………………………………………………………………… II 
一、前言 ………………………………………………………………………………………… 1 
二、研究目的 …………………………………………………………………………………… 3 
三、文獻探討與相關研究 ………………………………………………………………………3 
四、研究方法 …………………………………………………………………………………… 4 
五、結果與討論 ………………………………………………………………………………… 7 
六、參考文獻 …………………………………………………………………………………… 10 
七、附錄 ………………………………………………………………………………………… 10 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
  2
料傳輸）環境也格外重要。電子元件之間資料傳輸量越來越大，過去的線纜串聯技術已不敷
使用，過多的線纜連接只會增加安裝的困難，也讓車內電子控制單元（ECU）變得更加複雜。 
其中，在 20 多年前德國汽車廠，便提出了匯流排 CAN 通訊協定（Controller Area 
Network；控制器區域網路），這也是目前車用網路領域中被最常用到的技術。簡言之，CAN
是一項多工串列通訊協定，串聯起分散在車內電子模組資訊，是一種多主控、多重播送的車
內通訊協定，主要控制車內各電子系統裝置及 ECU 之間交換資訊，構成一道緊密的汽車電子
控制網路。 
以一般的汽車來說，車內骨幹網路系統，大致上可以分為動力系統網路（power-train 
network）、防鎖死煞車系統（Anti-Lock Braking System；ABS），兩種不同的系統網路，超
過 90％的廠商都會使用到 CAN 匯流排技術，有點類似網路分享器的概念，藉此減少線路的
安裝費用，可靠度也比較高，以車內較短的傳輸距離，CAN 能提供快速的傳輸速率。相較於
其它匯流排系統，CAN 通訊匯流排的這些特性，很自然地在汽車電控傳輸系統中受到廣泛應
用。可想而知，CAN 匯流排的相關應用與設計可以適時地切入到汽車電子中[1-2]。 
CAN 是區域控制型網路的其中一種協定，是＂多主對等＂式系統，與一般的＂一主多
從＂式系統不同(如，RS-485)。基本設計規範要求有高的位元速率，高抗電磁干擾性，而且
能夠檢測出產生的任何錯誤。隨著汽車上的電子裝置越來越多，各裝置間訊號傳遞也跟著複
雜話起來。 
在低成本考量下，LIN（Local Interconnect Network；互連式區域網路）次匯流排也成為
汽車網路系統中的串列通訊系統。這套系統是由歐洲汽車製造協會所開發出來，其具備短距
離、低速網路通訊、低成本的特色，被應用在汽車上各式電子系統的低速通訊協定[3-4]。而
CAN 與 LIN 等兩種車內 LAN 網路的布建方式與其應用的 ECU 示意圖，如圖 2 所示。 
由圖 2 得知，CAN 匯流排連接傳動裝置控制單元、燈控單元、門控單元、座椅控制單元
以及儀錶板控制單元等。由 LIN 匯流排所構成的 LIN 網路，為 CAN 網路的輔助網路，它連
接車窗控制單元、雨刷控制單元、天窗控制單元等低速傳輸設備。 
但是 CAN 的功能並不足以應付汽車電子的進展，因為無法配合＂X-by-Wire＂的快速進
展，例如，方向盤，煞車與動力系統等汽車的主要機能電子化。原因之一是 CAN 傳送速度不
夠快。未來汽車底盤系統預計的訊號傳輸的實際速度必須在 5Mbps 左右。但是 CAN 的實際
速度極限是 500Kpbs。相較之下，FlexRay 的最大傳輸速度是 10Mbps[5-6]，足以應付汽車底
盤系統的訊號傳輸。 
此外，若要以車內網路來確保汽車安全的機能（例如，煞車），則必須思考解決訊號延
遲的有效方法。CAN 採用的是事件驅動（event driven）的多工通訊系統，配合連接到網路的
裝置的必要性來執行傳輸。因此，若某一個裝置長時間佔用網路，就可能影響其他裝置造成
信號延遲。但是，FlexRay 採用的則是時間觸發（time triggered）的多工通訊系統，各個裝置
在預定時間傳送訊號，所以不會友訊號延遲的問題，適合需要高時效性的訊號傳輸。 
因此，本計畫研究將建置出符合目前車內網路需求的 FlexRay/CAN/LIN 三合一協定分
析儀。其中，以三通訊協定的剖析為主，並透過 USB 介面轉換 FlexRay/CAN/LIN 訊號，並
將其連接至稍前計畫所建置的車載通訊電子網路之 ECU 節點上。而在 PC 主機中，我們將研
製相關的 LIN/CAN/FlexRay 之 USB 驅動程式與應用程式。 
簡言之，透過本計畫所要實現的分析儀不僅可提供符合目前車輛產業需求，亦可提升相
關產業的技術瓶頸。而綜合上述的計畫背景，本計畫的執行重點，將根據力摩科技公司的技
  4
（計畫書編號：95-EC-17-A-16-S1-051-A1，連續三年 95~97）是整合國內各個相關車輛系所所
執行的大型計畫，並將相關技術移轉給業界科專的機構，如漢翔，車輛測試中心等。該計畫以
建構先進車輛通訊與導航研究中心與車輛產業智庫為基礎，並以車輛電子通訊網路技術為研發
主軸，整合現有 LIN，CAN-Bus 等車輛電子網路通訊協定，並就複合動力能源管理模組、Safety
與 AUTOSAR 等相關通訊協定進行先期研究，以期掌握市場趨勢。 
    而計畫申請人參與的是其車輛電子通訊網路技術分項計畫。該分項計畫之計畫成果已完成
各種 CAN 與 LIN 節點的設計。相關的技術已技轉給廠商。此外，在計畫申請人稍前的計畫中
已建置了嵌入式車輛通訊電子網路之電子平台（NSC 96-2628-E-150 -001 -MY3），成功地整合
了 LIN、CAN 與 FlexRay 等三種車輛電子通訊網路，並也已申請多項專利。但這些計畫都著
重在節點或是通訊網路的設計上，大部分都未切入到分析儀的設計與製作上。 
    目前國內類似的產品類似的有孕龍公司所推出的 LAP-C/B 系列的數位邏輯分析儀。其
中，透過各種串列模組，如 FlexRay，CAN 與 LIN 的引用進而分析其封包訊號。但這樣的產
品僅能抓取數位波形資料，無法提供進一步的分析與處理。因此，使用上甚為不便。而國外的
車載通訊網路儀器中，以 Vector 廠商所生產製作的最為熟悉，其推出 VN3600 及 9700 – FlexRay 
USB 介面卡，於 PC 主機實現 FlexRay 匯流排偵測。但其售價相當昂貴，一般業界或是研究單
位接受度不高。 
因此，本計畫所要自行開發的 FlexRay/CAN/LIN 三合一協定分析儀是國內自行開發的
分析儀，對於相關的車載通訊電子網路有著一定的產業貢獻與技術的提升。 
 
四、研究方法 
如圖 3 所示，為本計畫的整體系統架構示意圖。 
從圖 3 中，可以知道為了實現此應用於 FlexRay/CAN/LIN 三合一協定分析儀的架構，
包含圖 3(a)是以 CY7C68013A 韌體來剖析 CAN 與 LIN 匯流排的封包。而圖 3(b)所示，則是
透過USB 2.0- CY7C68013A (Cypress FX2系列)與MAX II CPLD(ALTERA-EPM570)元件結合
去剖析 FlexRay 匯流排的封包。從圖 3 中可知，因此只要一顆 USB 2.0 晶片組整合一顆 CPLD
元件即可實現本計畫所要實現的 FlexRay/CAN/LIN 三合一協定分析儀。但由於相關協定規
格相當複雜，且傳輸速度差異甚大，也造成本計畫的執行上，需整合並克服多種的剖析技術。   
此分析儀包含下列三種匯流排的主要工作原理，以及連接至 PC 主機的 USB 介面。 
以下，依序列出本計畫之進行步驟： 
 
 針對車載通訊電子網路之 LIN 匯流排，設計一 USB 異質轉換至 LIN 訊號剖析的分析儀 
本計畫的執行上，為了測試 LIN 訊號，我們將首先運用 LIN 匯流排的節點來測試。這部
份技術已於稍前所執行的嵌入式車輛通訊電子網路之電子平台（NSC 96-2628-E-150 -001 
-MY3）計畫中實現，並已技轉給廠商。因此，具有一定的技術研發的基礎。在此計畫中，針
對本計畫的需求，設計 LIN ECU 節點與 LIN 匯流排來驗證與測試。 
如圖 4 所示，為 LIN 匯流排測試的架構示意圖。其中，LIN ECU 採用了 P89C61X2BA 微
處理器與 LIN 收發器 TJA1020 所設計而成，使用 P89C61X2BA 的 I/O 模擬 LIN 的訊號格式，
並投過 LIN 收發器 TJA1020 來收發資料進而實現 LIN 的傳輸功能。TJA1020 支援普通斜率和
  6
 
 
圖 4、LIN ECU 匯流排測試架構示意圖 圖 5、LIN ECU 實體圖 
  
 
圖 6、CAN ECU 匯流排測試架構示意圖 圖 7、CAN ECU 實體圖 
 針對 FlexRay 匯流排，設計一 USB 異質轉換至 FlexRay 訊號剖析的分析儀。 
本計畫的執行上，為了測試 FlexRay 訊號，我們將首先運用 FlexRay 匯流排的節點來測試。
這部份技術已於稍前所執行的嵌入式車輛通訊電子網路之電子平台（NSC 96-2628-E-150 -001 
-MY3）計畫中實現，並已技轉給廠商。因此，具有一定的技術研發的基礎。在此計畫中，針
對本計畫的需求，設計 FlexRay ECU 節點與 FlexRay 網路來驗證與測試。 
如圖 8 所示，為 FlexRay 網路測試的架構示意圖。其中，對於 FlexRay 網路的應用上，
我們將 FlexRay ECU 分成底盤控制節點(Node2)與傳動控制節點(Node1)。FlexRay ECU 硬體
之設計，則利用 Freescale 半導體公司所開發的 S12XF STARTERKITE FlexRay 發展平台，設
計出一塊可以與 S12XF STARTERKITE 相互連接運用的 SK_S12XF512 平台。如圖 9 所示，
為 SK_S12XF512 平台實體圖，其為我們自行開發製作的硬體電路板，除了可與原廠板子結合
外，亦可單獨工作。 
有了上述的 FlexRay ECU 節點與 CAN 匯流排的測試架構後，我們即可運用圖 3(b)所示的
系統架構，運用 USB 2.0 晶片組連接一 CPLD 元件- EPM570 (ALTERA)來實現 FlexRay 協定
  8
在此，以 Altera 公司所推出的 CPLD(Complex Programmable Logic Device)電路晶片 MAX 
II ( EPM570T100C5N ) ，至於 FX2 則將其 MCU 功能架空，採用 Cypress 公司所推出的 Slave 
FIFO 模式。由 CPLD 控制 FX2 來取得 FIFO 中的資料輸出至 USB 通訊中。 
FX2 USB 仍採用巨量端點(EP6)，目的便是希望 MFC 應用軟體整合方便。端點資料方
面，在此使用一顆 FIFO ( IDT725L15J )來做為 FX2 與 CPLD 之間的資料傳輸緩衝區。 
 
圖 10、三合一電路板示意圖 
 
圖 11、模式一 CAN / LIN 監控模式支架構
方塊圖 
如圖 12 所示，為 CPLD 撰寫之內部硬體區塊圖，此電路中以 100MHz 為系統震盪頻率，
規畫出有各種不同的硬體電路，本計畫採用 Verilog 語言撰寫其 CPLD 之電路。在外部存取 IO
方面，主要有一 3 Pin 端子頭，用於接收 FlexRay 收發器之訊號，訊號包含 TXD 信號腳位與
TXEN 信號置能腳位。此外，系統中有兩個按鈕，一則用於重置 CPLD，另外一個按鈕則用
於 CPLD 與 FX2 同步(SYNC )存取 FIFO 。 
最後，如圖 13 所示，則是本系統 FlexRay/CAN/LIN 三合一智慧車用通訊網路分析儀的
實體 
5.3 、FlexRay/CAN/LIN 三合一智慧車用通訊網路分析儀測試－FlexRay 分析驗證 
如下圖 14 所示，為以 FlexRay/CAN/LIN 三合一智慧車用通訊網路分析儀測試
FlexRay/CAN/LIN 異質互連平台 FlexRay 網路。其中，針對其中的底盤控制節點做資料分析，
如系統設計部分所述，底盤控制資料主要為方向盤與踏板訊號，其中最前面的 Byte0 與 Byte 
1 為轉向資料，其後的 Byte 2 與 Byte 3 則為油門踏板的資訊。最後的 Byte 4 與 5 則為剎車
踏板的資訊。以及 Byte 6 則是方向盤上之按鍵資訊。 
5.4 、FlexRay/CAN/LIN 三合一智慧車用通訊網路分析儀測試－CAN 分析驗證 
如下圖 15 所示，為以 FlexRay/CAN/LIN 三合一智慧車用通訊網路分析儀測試
FlexRay/CAN/LIN 異質互連平台 FlexRay 網路，針對其中的底盤控制節點做資料分析，如系
統設計部分所述，底盤控制資料主要為方向盤與踏板訊號，其中最前面的 Byte0 與 Byte 1 為
轉向資料，其後的 Byte 2 與 Byte 3 則為油門踏板的資訊。最後的 Byte 4 與 5 則為剎車踏板
的資訊。以及 Byte 6 則是方向盤上之按鍵資訊。 
 
  10
網路分析儀，以簡單的模式切換，搭配易懂的 MFC GUI 軟體，達成三種不同通訊網路之分析。 
以下為本系統的特色以創新性與實用性依序介紹： 
 創新性如下所列： 
 除了被廣泛使用的 CAN 與 LIN 之外，加入了國內尚未有研發能力設計出產品
的高速線傳控制系統的 FlexRay 通訊網路。 
 三種不同車載通訊網路，以雙閘道器的方式做資料的轉換。 
 高速的 USB 2.0 訊號，達成 FlexRay 網路的循環資料接收。 
 實用性如下所列： 
 以低成本的建構方式達成高效能的資料分析。 
 完全符合標準的車載通訊協定。 
 以高速的 USB 2.0 訊號(480Mbps)傳輸以完成高速的 FlexRay(10Mbps)即時資料
顯示。 
     根據上述的測試結果與實際的應用測試，證明了本計畫在執行上完成符合原先預定達到
的目標。 
六、參考文獻 
[1]. 張孟俊，孫鴻航”汽車電子技術優勢探討”，零組件雜誌，2004 
[2]. 許永和，許源鏞，賴大溪，黃屹偉，郭仲宇，李宗穎，”應用於車輛電子通訊網路之
USB-CAN Dongle 設計” ，第十一屆車輛工程學術研討會 
[3]. LIN Specification Package,LIN Protocol Specification—Revision 1.2,LIN 
Consortium,Nov,2000 
[4]. 李旺軒，巫志倫，“車身網路整合實現於適路性頭燈照明系統”，智慧車輛與動力技術專
輯，2005，11 
[5]. FlexRay Communications System Electrical Physical Layer Specification Version 2.1 
[6]. FlexRay Communications System Electrical Physical Layer Application Notes Version 2.1 
七、附錄 
 論文與期刊成果 
1. 許永和、辜俊明、劉耀中、邱冠程， "具備 FlexRay 協定線傳控制之 Android 嵌入式車輛
通訊網路電子平台研製"，中華民國第十六屆車輛工程學術研討會，2011/11/11 
2. 許永和、辜俊明、邱冠程、詹力峰、劉耀中、陳仁宗，"車輛翻覆求救系統"，2011 民生
電子研討會，2011/11/11 
 專書 
1. 許永和，＂車載通訊電子網路之 CAN/LIN 匯流排設計與應用＂， 儒林圖書公司，ISBN：
978-957-499-909-5，2010/12 
 比賽成果 
1. 99 學年度全國大學校院嵌入式系統設計競賽，嵌入式系統軟體組，佳作 
2. 100 年度微電腦應用系統設計製作競賽（嵌入式軟體系統類），大專組，第二名 
 專利 
1.可模組化之車載通訊網路分析裝置，發明專利申請中。 
99 年度專題研究計畫研究成果彙整表 
計畫主持人：許永和 計畫編號：99-2622-E-150-028-CC3 
計畫名稱：FlexRay/CAN/LIN 三合一協定分析儀 
量化 
成果項目 實際已達成
數（被接受
或已發表）
預期總達成
數(含實際
已達成數)
本計畫實
際貢獻百
分比 
單位 
備註（質化說明：如
數 個 計 畫 共 同 成
果、成果列為該期
刊 之 封 面 故 事 ...
等） 
期刊論文 0 0 100%  
研究報告/技術報告 0 0 100%  
研討會論文 1 2 100% 
篇 
1.許永和、辜俊明、劉
耀 中 、 邱 冠
程， ’’’’具備
FlexRay 協定線傳控
制之 Android 嵌入式
車輛通訊網路電子平
台研製’’’’，中華
民國第十六屆車輛工
程 學 術 研 討 會 ，
2011/11/11 
2. 許永和、辜俊明、
邱冠程、詹力峰、劉耀
中、陳仁宗，’’’’
車 輛 翻 覆 求 救 系
統’’’’，2011 民
生 電 子 研 討 會 ，
2011/11/11 
 
論文著作 
專書 1 1 100%  
1. 許永和，’車載通
訊 電 子 網 路 之
CAN/LIN 匯流排設計
與應用’， 儒林圖書
公 司 ， ISBN ：
978-957-499-909-5，
2010/12 
申請中件數 1 1 100%  專利 已獲得件數 0 0 100% 件  
件數 0 0 100% 件  
技術移轉 
權利金 0 0 100% 千元  
碩士生 0 0 100%  
博士生 0 0 100%  
博士後研究員 0 0 100%  
國內 
參與計畫人力 
（本國籍） 
專任助理 0 0 100% 
人次 
 
期刊論文 0 0 100%  國外 論文著作 
研究報告/技術報告 0 0 100% 
篇 
 
