  
圖 1：典型隱形眼鏡結構和名稱[9] 
光學區（Optic Zone）： 
 光學區指的是鏡片的光學部分，含有矯正屈光力（The Refractive Power），
位於鏡片的中心區。 
鏡片直徑（Lens Diameter）： 
 隱形眼鏡的鏡片直徑即隱形眼鏡的尺寸，又稱弦直徑（Chord Diameter），是
從鏡片的一個邊緣到相對的一個邊緣的寬度。 
中心厚度（The Central Thickness）： 
 隱形眼鏡的中心厚度係指鏡片幾何中心處（The Geometric Center）的前表面
與後表面間的距離。 
前弧（Front Curve）：前弧是鏡片前面的曲線；它的範圍相對於基弧來的大。 
基弧（Base Curve）： 
  基弧是鏡片後面中央部分的弧度，又稱後中央弧（The Central Posterior 
Curve），或稱主基弧（The Primary Base Curve）。基弧以鏡片背面的曲率半徑代
表，在處方裝配隱形眼鏡時，如無特殊情況，它應和眼角膜前的曲率半徑一致。
在鏡片設計上，基弧是與眼角的光學區相合的。基弧可以用兩種不同的量度表示： 
（1） 曲率半徑（Radius of Curvature, R），單位為 mm。 
（2） 聚焦力 F（Focal Power），其單位為焦度（Diopters, D）。 
切邊區域（Cut Edge）： 
 鏡片會因邊緣尖銳而刺激眼角膜，故製鏡完後利用鑽石刀修邊將尖銳邊角去
除。 
周圍區（Peripheral Zone）：光學區至鏡切面。 
 
會黏在杯底，使一般消費者較容易從杯中夾取隱形眼鏡，但此突起物之影像也會
增加系統判別上的困難度。 
 
圖 3：塑膠容器杯 
    為了配合工廠生產線及隱形眼鏡乾片不透光的特性，本研究檢測系統如圖 4
所示，將使用白光（發光二極體）背照式光源（圖 5）。 
載具
LED背光箱
CCD
  
（a）硬體架構示意圖 （b）檢測系統原型 
圖 4：包裝機缺片檢測系統取像設計 
 
 （c）鋁合金載具上 8 個放置塑膠容杯的位置示意圖 
圖 5：LED 背照式燈源與子影像區域配置 
 
3.1.2. 軟體檢測演算法 
 包裝機缺片檢測演算法之流程可表示如圖 6 所示。本檢測方法主要以一灰階
臨界值將待測影像區分為目標物與背景，達到影像內涵容易區分的目的。此處隱
形眼鏡為乾片，透光度較低，背景為塑膠容器杯，透光度較高。灰階臨界值係經
由缺片塑膠容器杯訓練而設定。 
    針對影像中背景灰階度不均的現象，一般以自動閥值（auto-thresholding）方
法來處理會得到較佳的效果。而其中又以 Otsu[10]與固定百分率法(P-Tile)[11]最
常被使用。本研究將採用固定百分率法。 
灰階臨界值訓練步驟： 
Step 1. 自動調整 CCD 攝影機曝光時間，調整完畢後影像之最大灰階值（Global 
       maximum gray value）固定在 250 左右。 
Step 2. 在 Area 1、Area 2、Area 3、Area 4、Area 5、Area 6、Area 7、Area 8 放
置空塑膠容器杯，偵測出每個子區域的最大灰階值(Local maximum gray 
value.)。 
Step 3. 抓取 30 次，計算每個子區域內最大灰階值的平均值。 
Step 4. 將上述步驟取得的平均值×0.9 做為各子區域的灰階臨界值。 
    設定子區域影像灰階臨界值之後，針對每個子區域塑膠容器杯內的圓形區域
計算其亮點面積（灰階度為 255 的像素數目），作為判斷塑膠容器杯中有無隱形
眼鏡之依據，根據鋁合金載板上的塑膠容器杯可能之情形，訓練並計算以下三種
情況下之亮點面積： 
（a） 缺塑膠容器杯情況下，隨機擷取 30 次影像，計算二值化後每個子區域的亮
 圖 6：包裝機缺片檢測演算法流程圖 
 
 
 
 
 
 
（a）滅菌完存放於食鹽水中之鏡片 
 
（b）作業員在手掌中分離黏在一起的鏡片 
透明托盤
電子式高頻燈管
CCD CAMERA
背光板
 
 
（a）硬體架構示意圖 （b）檢測系統原型 
 
圖 12：人工填裝線缺片檢測演算法流程圖 
   
  
（a）有鏡片塑膠容器杯 
209  
（b）上圖（a）紅色圓形區域內 Histogram 分佈 
 
（c）灰階值 209 二值化之結果，亮點面積 4335 
圖 14：有鏡片塑膠容器杯二值化選取結果 
 
灰階臨界值訓練計算步驟： 
Step 1. 自動調整 CCD 攝影機曝光時間，調整完畢後影像之最大灰階值（Global 
       maximum gray value）固定在 250 左右。 
Step 2. 在 Area 1 到 Area 16 放置空塑膠容器杯，偵測出每個子區域的灰階值眾
數，並向左找到第四個波谷。  
Step 3. 抓取 30 次，取其平均值做為各子區域的灰階臨界值。 
 
 
  根據本計畫所找的第二個特徵，Blob 的周長，在缺鏡片情形下，二值化後
的塑膠容器杯是一個幾乎沒有雜點的圓形區域，所得到 Blob 周長會比較穩定；
而在有鏡片情形下，鏡片邊緣資訊在二值化後會被突顯出來，則 Blob Analysis
會得到很多 Blob 內部 holes 的邊長，故有鏡片的 Blob 周長會大上許多，如圖所
示。 
  
（a）缺鏡片 Blob 周長：318 （b）有鏡片 Blob 周長：1223 
圖 16：Blob Analysis 周長（紅色區域）特徵萃取結果（單位：pixel） 
3.2.4. Bayesian Classification for Normal Distributions 
 在特徵選取結束後，待測影像被抽象化為特徵與重要性數字的關係，於是就
可以套用到一般的機器學習與分類技術上，其中貝氏分類器（Bayesian Classifier, 
BC）是一個簡單且實用的分類方法[13]。貝氏分類器是使用機率理論的概念來分
類的方法，分別計算某一特徵出現在各個類別中的條件機率，從其中最高機率的
類別選定作為該物件的類別。其計算公式如下： 
( | ) ( )( | )
( )
i i
i
P x PP x
P x
ω ωω =
KK K      （1） 
其中： ( )iP ω 表示物件類別發生機率； 
   ( )P xK 表示某一物件出現的特徵值集合的機率； 
   ( | )iP x ωK 代表一條件機率，在類別 iω 情形下 xK發生的機率。 
    ( )iP ω 可從事前訓練資料估計而得；而在計算 ( | )iP xω K 時 ( )P xK 可被忽略，因
為在 xK中的各個特徵是彼此獨立。 ( | )iP x ωK 的估計有很多不同的方法，一般在實
務上最常碰到的機率密度函數為 Gaussian or normal density function. 
T -1
i i i i i i/ 2 1/2
i
1 1p( | )=N( , )= exp - ( - ) ( - )
(2 ) | | 2d
x x xω μ μ μπ
⎛ ⎞Σ Σ⎜ ⎟Σ ⎝ ⎠
K K K K K K
  （2） 
d：number of features 
imean:    =E[ ]xμK K  
T
i i icovariance matrix:    =E ( - )( - )x xμ μ⎡ ⎤Σ ⎣ ⎦K K K K  
for ix ω∈K  
Discriminant functions for normal density：對上式（2）取 log 簡化如下 
11 1( ) ( ) ( ) ln 2 | | ln ( )
2 2 2
T
i i i i i i
dg x x x Pμ μ π ω−−= − Σ − − − Σ +K K K K K   （3） 
If g1 > g2  then 1x ω∈K  Else 2x ω∈K  
  本研究利用上述 Bayes Classification Rule, 經事前訓練得到各類別之參數
4.1. 包裝機缺片檢測說明(8Cups，2x4 個塑膠容器杯) 
根據 3.1 節所提出之系統架構，建構本檢測系統之軟硬體。 
4.1.1. 系統架構 
z 個人電腦：使用 CPU 為 AMD 2.0 GHz 個人電腦、記憶體為 512MB SDRAM、
顯示卡為 ATI-X300 VGA Chip。 
z CCD 攝影機：Guppy F-033B ASG（8bit Monochrome，1/3" type Sony 
Progressive Scan CCD，7.4 µm × 7.4 µm Cell Size，IEEE 1394 interface）。輸
出的解析度為 640pixels × 480pixels。 
z 鏡頭：FUJINON HF25HA-1B 25mm 定焦。 
z 光源系統﹕白色 LED 背光箱。 
z 影像處理函式庫：MIL（Matrox Imaging Library）5.0、ActiveMIL 5.0 版     函
式庫。 
z 程式語言﹕Visual Basic 6.0，配合影像處理函式庫，撰寫檢測系統之程式。 
 
4.1.2. 包裝機缺片檢測系統整合實驗(8Cups，2x4 個塑膠容器杯) 
  以下實驗均以第三章之研究方法構成，利用所發展設計之（1）取像模組、（2）
灰階臨界值(其值如表 1)、（3）亮點面積門檻值，針對包裝機線上有無缺片做檢
測實驗。 
表 1：灰階臨界值 
1st Area 2nd Area 3rd Area 4th Area
206 219 223 206 
5th Area 6th Area 7th Area 8th Area
200 218 222 207 
  圖為利用本研究實驗訓練出之灰階臨界值對缺鏡片及有鏡片情形的二值化
結果。程式介面如圖所示。 
  
（a）缺鏡片塑膠容器杯 （b）有鏡片塑膠容器杯 
圖 18：利用所訓練之灰階臨界值二值化結果 
（1） 對缺鏡片塑膠容器杯做測試（表 4）：30 次，錯誤次數：0，錯誤率：0% 
表 4：缺鏡片塑膠容器杯測試結果 
Count Number 1st Area 2nd Area 3rd Area 4th Area 5th Area 6th Area 7th Area 8th Area Result 
1 1933 2145 2095 2059 2050 2149 2247 1969 12345678no lens
2 1897 2121 2079 2010 2022 2091 2196 1927 12345678no lens
3 1896 2101 2053 1994 2011 2097 2196 1939 12345678no lens
4 1934 2125 2113 2038 2011 2115 2237 1968 12345678no lens
5 1927 2135 2105 2022 2038 2108 2232 1988 12345678no lens
6 1896 2107 2054 1994 2015 2082 2179 1922 12345678no lens
7 1881 2090 2074 2004 2004 2117 2204 1950 12345678no lens
8 1922 2140 2101 2032 2052 2144 2233 1970 12345678no lens
9 1918 2121 2114 2045 2058 2129 2229 1962 12345678no lens
10 1928 2129 2109 2043 2066 2132 2229 1965 12345678no lens
11 1962 2140 2102 2053 2048 2153 2230 2001 12345678no lens
12 1912 2124 2101 2043 2003 2108 2219 1959 12345678no lens
13 1908 2135 2077 2009 2044 2126 2225 1946 12345678no lens
14 1915 2116 2094 2023 2033 2106 2215 1939 12345678no lens
15 1927 2153 2105 2043 2036 2139 2235 1965 12345678no lens
16 1915 2117 2045 1996 1994 2086 2204 1920 12345678no lens
17 1904 2107 2089 2041 2008 2136 2202 1972 12345678no lens
18 1951 2145 2099 2044 2038 2098 2235 1938 12345678no lens
19 1937 2163 2110 2051 2046 2125 2237 1985 12345678no lens
20 1926 2139 2087 2034 2004 2132 2219 1954 12345678no lens
21 1933 2128 2083 2013 2033 2099 2199 1943 12345678no lens
22 1932 2140 2101 2056 2032 2143 2243 1963 12345678no lens
23 1898 2103 2066 1991 1998 2099 2205 1930 12345678no lens
24 1939 2150 2089 2038 2049 2110 2227 1982 12345678no lens
25 1922 2131 2107 2032 2040 2124 2224 1953 12345678no lens
26 1916 2121 2090 2031 2005 2102 2215 1930 12345678no lens
27 1923 2114 2088 2041 2011 2128 2225 1943 12345678no lens
28 1886 2098 2051 1995 1999 2071 2200 1908 12345678no lens
29 1884 2109 2034 1993 1972 2078 2158 1905 12345678no lens
30 1876 2106 2079 2015 2028 2120 2214 1930 12345678no lens
Count 
Number 
1st Area 2nd Area 3rd Area 4th Area 5th Area 6th Area 7th Area 8th Area Result 
30 285 295 380 85 393 587 407 351 OK 
 
  以 Area 2 為例，如表 6 所示，可以看出經由實驗訓練所得之亮點面積閥值上、
下界，可以有效地將有鏡片和缺鏡片之情形區別出來。 
表 6：8 Cups 的 Area 2 面積閥值上、下界 
0
500
1000
1500
2000
2500
3000
1 3 5 7 9 11 13 15 17 19 21 23 25 27 29
次數
亮
點
面
積
(單
位
:P
ix
el
)
有鏡片塑膠容器杯
缺鏡片塑膠容器杯
面積閥值上界
面積閥值下界
 
 
4.2. 人工裝填線缺片檢測說明(32Cups，4x8 個塑膠容器杯) 
根據 3.2 節所提出之系統架構，建構本檢測系統之軟硬體。 
4.2.1. 系統架構 
z 個人電腦：使用 CPU 為 AMD 2.0GHz 個人電腦、記憶體為 512MB SDRAM、
顯示卡為 ATI-X300 VGA Chip。 
z CCD 攝影機：Guppy F-080B ASG × 2（8bit Monochrome，1/3" type Sony 
Progressive Scan CCD，4.65 µm × 4.65 µm Cell Size，IEEE 1394 interface）。輸出
的解析度為 1024pixels × 768pixels。 
z 鏡頭：FUJINON HF25HA-1B 25mm 定焦。 
z 光源系統﹕電子式高頻背光板。 
z 影像處理函式庫：MIL（Matrox Imaging Library）5.0、ActiveMIL 5.0 版       函
式庫。 
z 程式語言﹕Visual Basic 6.0，配合影像處理函式庫，撰寫檢測系統之程式。 
 
0500
1000
1500
2000
2500
2500 3000 3500 4000 4500 5000 5500 6000 6500 7000 7500
有鏡片塑膠容器杯
無鏡片塑膠容器杯
2ω有鏡片區
1ω
缺片區
 
圖 20：貝氏分類器樣本訓練分佈圖 
 
圖 21：人工裝填線缺片檢測程式介面 
 
Film Magnetic Storage Disks,” IEEE transactions on Magnetics, Vol. 26, Issue 1, 
pp.138-140, 1990. 
[13] R. O. Duda, P. E. Hart and D. G. Stork, Pattern Classification, Wiley 
Interscience, pp.21-44, 2001. 
