 2
利用「時域有限差分法」配合等效原理之相關
積分公式，來計算出對遠方觀察區之貢獻，進而達
到區域間交互影響的概念，在[1]、[6]中等文獻已有
提到，但其中所展示的例子，只是將場源區之貢獻
算至觀察區，在觀察區中並沒有特殊的物體或激發
源，也沒有展示出多區域交互影響的情況。所以在
本篇論文中，除了實現「時域有限差分法」與選用
的兩種演算法進行結合外，也實現多區域中，若區
域相連或相鄰，其相連區域之間使用「時域有限差
分法」的交互作用該如何得到和更新，還有對於鄰
近但不相連的區域且內部有連續物體的情況，該如
何使用「柯西荷夫積分公式」和「時域平面波展開
法」來進行區域之間對外的入射場計算，這樣利用
「時域有限差分法」跟「柯西荷夫積分公式」以及
「時域平面波展開法」的結合，進而模擬出區域中
若存有連續介質區塊或是薄金屬片導體等連續物
體的情況，並有其準確度的探討以及時間和記憶體
的統計與分析。 
 
2 利用等效原理（柯西荷夫積分公式）計
算各個子區域之交互貢獻 
進行「多區域時域有限差分法」計算時，我們
必須先將各個子區域之間的交互貢獻計算出來，所
以我們將每個子區域用一封閉面包住，再利用等效
原理的概念，計算該封閉面上的等效電、磁流，進
而將該子區域對其他子區域的貢獻計算出來。而等
效原理相關的積分公式很多，在此我們使用的是
「柯西荷夫積分公式」其型式如下： 
( ) ( ) ( ) ( ) ( )
( )
, , ,
/
 ,  
4
S
t d t G G t
t R c
G R
R
δ
π
⎡ ⎤′ ′ ′ ′ ′= ∗ •∇ − ∗ •∇⎣ ⎦
− ′= = −
∫∫E r s E r n n E r
r r
w     (1) 
在這邊 ′r 為電場在封閉面上的所在位置， nˆ 為
封閉面的法線向量。由「柯西荷夫積分公式」我們
的確可以利用封閉面的積分將每個子區域對外的 
貢獻準確的計算出來。 
 
3 利用兩階層「時域平面波展開法」加速
「柯西荷夫積分公式」 
我們先將「柯西荷夫積分公式」分為兩項的貢
獻，如下： 
( ) ( ) ( ), , ,a bt t t= +E r E r E r  (2) 
其中，   
( ) ( ) ( )
( ) ( ) ( )
, ,
, ,
a S
b S
t d t G
t d G t
⎡ ⎤′ ′ ′= ∗ •∇⎣ ⎦
⎡ ⎤′ ′ ′= − ∗ •∇⎣ ⎦
∫∫
∫∫
E r s E r n
E r s n E r
w
w
 
接著將上兩式當中的格林函數 ( ),G tr 改由展
開式 i ( ),G tr 代入並重新整理，將可得到「柯西荷夫
積分公式」經由平面波展開的數學型式，如下： 
i ( ) i ( ) i ( ), , ,a bt t t= +E r E r E r  (3) 
其中，
i ( )  ( ) ( ) ( )2 22 2,  / ,8 ta St d d k t k c tc δπ−∂ ⎡ ⎤′ ′= Ω • − • ∗⎣ ⎦∫ ∫∫E r s n R E rw  (4) 
i ( ) ( ) ( ) ( )22,   / ,8 tb St d d t k c tc δπ∂ ⎡ ⎤′ ′ ′= Ω − • ∗ •∇⎣ ⎦∫ ∫∫E r s R n E rw  (5) 
同樣地，可以藉由 Dirac 函數及向量分解的性
質，進一步整理出三階段摺積形式如下： 
i ( )  ( )( )
 ( )( )
 ( )  ( )( ) ( )
2
o.c.
2
o .c . s .c .2 2
sc
,  r r /
                 r - r /
8
             r r / ,
a
t
S
t d t c
t c
c
d k t c t
δ
δπ
δ
= Ω − • − ∗
−∂ − • ∗
⎡ ⎤′ ′ ′• + • − ∗⎣ ⎦
∫
∫∫
E r k
k
s n k E rw
  (6) 
i ( )  ( )( )
 ( )( )
 ( )( ) ( ) ( )
2
o.c.
o .c . s .c .2
s .c .
,  r r /
                 r - r /
8
              r r / ,
b
t
S
t d t c
t c
c
d t c t
δ
δπ
δ
= Ω − • − ∗
∂ − • ∗
⎡ ⎤′ ′ ′ ′+ • − ∗ •∇⎣ ⎦
∫
∫∫
E r k
k
s k n E rw
(7) 
其意義如同兩項同時進行的三階段時域平面
波展開法：其一，為(6)式，以下我們稱其為(a)項的
平面波展開式。其二，為(7)式，稱其為(b)項的平面
波展開式，茲將其三階段的型式，簡列如下： 
第一階段，收集： 
( )  ( )  ( )( ) ( )sc, r r / ,St d k t c tδ⎡ ⎤′ ′ ′= • + • − ∗⎣ ⎦∫∫outaq k s n k E rw     (8) 
( )  ( )( ) ( ) ( )s .c .,  r r / ,St d t c tδ⎡ ⎤′ ′ ′ ′= + • − ∗ •∇⎣ ⎦∫∫outbq k s k n E rw    (9) 
其中， ( ),toutaq k 及 ( ),toutbq k 分別表示經由上述
兩式所獲得的(a)項及(b)項的「傳送射線」，而其中
的 場 源 函 數 分 別 為  ( ) ( ),k t′•n E r 及
( ) ( ), t′ ′•∇n E r ，亦即主要來自封閉面上的電場及電
場的空間微分項。 
第二階段，轉換： 
 ( ) ( ) ( ), , , ,at t t= ∗in outa c aq k k R q kT ， ( ) ( )22 2 ˆ, , 8 ta t tc δπ−∂= −c ck R k RiT
 (10) 
( ) ( ) ( ), , , ,bt t t= ∗in outb c bq k k R q kT ， ( ) ( )2 ˆ, , 8 tb t tcδπ∂= −c ck R k RiT
 (11) 
其中， ( )c oc scR = r - r 代表場源球中心指向觀察
球中心的位置向量， ( ), ,a t ck RT 及 ( ), ,b t ck RT 分別
為 (a)項及 (b)項的「轉換函數」，而  ( )ˆ,tinaq k 及
( )ˆ,tinbq k 分別表示經由第二階段的「轉換」後，所
獲得的(a)項及(b)項的「接收射線」。 
 4
 
 
 
 
 
 
 
 
 
 
 
 
圖 2 內外兩層封閉面及總場散射場之劃分 
區域，使用「時域有限差分法」將兩個區域整個包
成一個區域，較遠的區域則使用「柯西荷夫積分公
式」或是「時域平面波展開法」去計算使用於內層
及外層的入射場值，所耗費的時間將會少於使用
「柯西荷夫積分公式」去計算每個各別區域的入射
場，且其準確度也不會太差。所以當區域間相距不
是很遠的時候，我們可以將兩個區域之間的入射
場，使用「時域有限差分法」來計算。不過使用「時
域有限差分法」有時會比使用「柯西荷夫積分公式」
或「時域平面波展開法」計算，耗費的記憶體更多
一些。所以該選擇使用哪一種方法來計算，記憶體
耗費與計算時間是需要加以斟酌以及取捨的。 
4.2 連續介質於「多區域時域有限差分法」 
當我們要計算一個 L 形狀的連續物體的時候，
在原本單純的「時域有限差分法」，我們必須把 L
形連續物體所包含的一大塊區域(如圖 3 所示)，整
個使用「時域有限差分法」去包覆模擬計算，但這
樣其實不是很經濟的做法，因為這樣的計算，會算
到很多我們所不感興趣的場量，在文獻[1]稱之為空
白區域(White space)，而且這部分的計算將會花費
甚大的記憶體及計算量。所以我們希望能使用「多
區域時域有限差分法」將介質區分成多個區域，相
鄰的區域，我們使用「時域有限差分法」去計算需
要的入射場，不相鄰的區域，我們則使用「柯西荷
夫積分公式」或是「時域平面波展開法」來提供所
需的入射場。 
 
 
 
 
 
 
 
 
 
 
 
 
圖 3 L 形狀連續物體所需包覆的 FDTD 區域 
當要計算相鄰區域的時候如圖 4，我們選擇將
兩個區域的影響交由「時域有限差分法」來計算，
將兩區域使用同樣大小的「時域有限差分法」的網
格包覆起來，為了得到第一區對第二區的入射場貢
獻，將圖 5 虛線部份的第二區先拿掉，取出虛線位
置的「時域有限差分法」算出的場值，當成第一區
對第二區的入射場，同理，計算第二區對第一區的
入射場，如圖 6，先將第一區的部分拿掉，取出虛
線部份使用「時域有限差分法」算出的場值，當作
第二區對第一區的貢獻。而為了讓「時域有限差分
法」所計算出的入射場可以入射到區域中正確的位
置，如圖 6，區域二中「時域有限差分法」得到的
入射場要入射到區域一的封閉面上 x 處，就需要經
過 origin_s.x 平移之後，才是真正區域二要入射到
區域一的正確位置「時域有限差分法」入射場。 
 
 
 
 
 
 
 
圖 4 相鄰兩區域與使用「時域有限差分法」所包覆區域
的示意圖 
 
 
 
 
 
 
圖 5 區域一對區域二的入射場計算 
 
 
 
 
 
 
 
圖 6 區域二對區域一的入射場計算，平 origin_s.x，使「時
域有限差分法」入射場到正確位置上 
5  數值結果與討論 
5.1 五個區域的「多區域時域有限差分法」
計算連續介質 
總場 散射場 
封閉面一
封閉面二 
PML 
PML 
PML 
空白區域 
(White space) 
連續物
區域一 
總場 
區域二  
總場 
使用「時域有限差分法」包覆的區域
區域一 
總場 
區域二  
總場 
使用「時域有限差分法」包覆的區域
x
區域一  
總場 
區域二 
總場 
使用「時域有限差分法」包覆的區域
x
origin_s.x 
X
Z
origin.x 
原點(0,0,0) 
 6
「多區域時域有限差分法」使用「時域
平面波展開法」三階段時間以及記憶
體花費 
 
使用
方法 
 
 
單一「時域
有限差分
法」 
STAGE 1 STAGE 2 STAGE 2 FDTD
時間
花費 
4456.44 
sec 
6.20675 
hr 
3.04799 
hr 
4.86476 
hr 
42228.3 
sec 
記憶
體 
238 MB 1538 MB 
表 2計算時間與記憶體的比較 
      方法 
時間 
單一「時域有限差
分法」 
「多區域時域有
限差分法」 
L 型介質區塊（分
五區域） 2278.58 sec 14 hr 
扁長立體介質區
塊（分七區域） 4456.44 sec 25.849 hr 
時間增加率 1.9559 1.846 
表 3 不同模擬物體花費時間比較 
5.3 使用「多區域時域有限差分法」計算鄰
近區域內含金屬片 
本小節將 5.1 節所討論的介質區塊替換成一個
連續的 L 形狀的薄金屬片，其「時域平面波展開法」
子區域設定與 5.1 節相同，而金屬片的設定，可以
由電磁理論可以得知，金屬表面的切線電場為零，
由此來設定金屬片在區域內的位置以及大小。圖 11
為此 L 型金屬片結構第二區域的模擬結果，與單一
「時域有限差分法」將整個金屬片包在一個區域內
來相比，這兩種方法得出的結果相當相近，所以薄
金屬片使用「多區域時域有限差分法」也可以得到
不錯的準確度。 
 
圖 11 第二區的 x y zE E E， ，  
比較 5.1 節的五區域內有介質區塊，跟本節區
域裡面包含的是薄金屬片，得到的結果，區域裡面
有介質區塊的圖 8 會有震盪的現象，這是因為電磁
波打進介質裡面有多重反射疊加造成的結果，而區
域裡面含有金屬薄片，則是因為電磁波無法穿透金
屬片，而造成電磁波的全反射，所以其顯示出的圖
11 會比較平滑而不太有震盪的情況，而在金屬片的
例子中，有結果顯示在模擬時間的末端會有一些突
波的發生，這是因為我們模擬的金屬片在區域的兩
端不連續，造成電磁波沿著金屬片傳送到末端，發
生反射而返回觀測點，所以我們才會觀察到有突波
的產生。 
表 4 是使用這兩種方法所耗費的記憶體跟時
間，內含物由介質變為金屬片，基本上不影響計算
的過程，計算量也差不多，所以表 4 的結果很接近
表 1，「多區域時域有限差分法」還是花費了比單一
「時域有限差分法」多的記憶體與時間，造成的原
因如同 5.1 節所述。 
「多區域時域有限差分法」使用「時域
平面波展開法」三階段時間以及記憶
體花費 
 
使用
方法
 
 
單一「時域
有限差分
法」 
STAGE 1 STAGE 2 STAGE 3 FDTD
時間
花費
2271.36
sec 
4.56889 
hr 
1.16147 
hr 
3.37836 
hr 
17537.2 
sec 
記憶
體 
124 MB 1584 MB 
表 4 計算時間與記憶體的比較 
6  數值結果與討論 
本篇論文主要討論的方向是將區域相鄰，並討
論其中的電磁場散射的問題，使用的方法是相鄰的
區域運用「時域有限差分法」計算彼此的交互作
用，不相鄰的區域則使用「柯西荷夫積分公式」和
「時域平面波展開法」來計算，就結果來說，其準
確度還不錯，但是耗費的資源與時間實在太龐大，
主要是因為我們在做相鄰區域間的「時域有限差分
法」計算入射場時，所需要包裹的區域太大，尤其
是在區域排列不是同方向的時候，其轉角部份的區
域需要包裹的部份相當大，以至於計算量也隨之增
加。再來就是為了取得正確的運算場值，我們將取
值的源面往外擴大兩個晶格，這樣雖然可以保證取
得正確的運算場值，但是也造成所取用的場值點數
增多，讓「柯西荷夫積分公式」和「時域平面波展
開法」的計算量隨之增加。 
對比之後的改進，可以從相鄰區域包裹方式，
希望可以找到一個相較比較好的包覆方式，比如
說，如圖 12，一個不規則的線型物體，目前使用「多
區域時域有限差分法」時各個區域都是一樣大，如
果可以讓區域的尺寸隨著物體的走向跟形狀，做出
相對應的變化，而且這樣的包覆方式也比單一「時
域有限差分法」所包覆的區域小得多，這樣就可以
使在計算鄰近區域的「時域有限差分法」不需花費
