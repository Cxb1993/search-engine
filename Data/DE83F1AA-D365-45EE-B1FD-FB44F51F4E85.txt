 ii
於設計方式容易及設計時間短，所以非常適合
用來實現模糊控制器，在設計完成後並將其燒
錄至FPGA（Field Programmable Gate Array）實
現，使其成為可攜性高且可獨立作業的晶片，
最後將模糊控制器與步進馬達驅動電路相結
合，以達到良好的微步進馬達驅動效果。 
2. 模糊電流控制器設計 
步進馬達模糊電流控制器電路硬體架構
如圖1所示： 
驅
動
模
組
電流控制模組
相序控制模組
驅動級控制模組 Vm
Vm
Phase A
Phase B
B相電流
命令模組
A相電流
命令模組
A相電流迴授
B相電流迴授
A/D
A/D
Fuzzy 
Controller
FPGA  
圖 1. 步進馬達模糊電流控制器硬體架構圖 
控制器的目標是要求實際電流與命令電
流一樣，因此輸入變數部分以實際電流與命令
電流的誤差（current error）及其誤差變化量
（change of current error）作為控制器的輸入變
數，分別以符號“e”和“de”來表示。而輸入的命
令電流（command current）以符號“ *i ”表示，
在一取樣時間 t裡面，e和de的表示式如下： 
 
)()()( * titite −=  (1) 
)1()()( −−= tetetde  (2) 
 
其中 )(* ti 為命令電流， )(ti 為實際電流。控
制器的輸出變數為電晶體的責任週期（duty 
cycle），以符號 )(tD 表示。 
在語意變數（linguistic variables）的設計
上，輸入變數 )(te 和 )(tde 及輸出變數 )(tD 皆用五
個語意變數來描述： 
{ }( ) , , , ,e t NB NS ZE PS PB= ， { }( ) , , , ,de t NB NS ZE PS PB=  
{ }( ) , , , ,D t NB NS ZE PS PB= 。其中各語意變數分別
為： 
NB（Negative Big）“負大”，NS（Negative Small）
“負小”，ZE（Zero）“零”，PS（Positive Small）
“正小”，PB（Positive Big）“正大”，而針對輸
入變數我們選擇等腰三角型為其歸屬函數如
圖2、圖3所示，輸出變數方面則使用模糊單值
型的歸屬函數，如圖4所示： 
 
圖 2. )(te 歸屬函數分佈圖 
 
圖 3. )(tde 歸屬函數分佈圖 
 
圖 4. )(tD 歸屬函數分佈圖 
在模糊規則庫的部分，我們以 )(te 和 )(tde 為輸入
變數， )(tD 為輸出變數，則可用語言形式來表
示模糊規則，其中 )(te 和 )(tde 各用五個語意變數
來描述狀態，所以相互間總共會產生25條模糊
規則如表1。 
表 1. 模糊控制規則表 
PBPBPSPSZEPB
PBPSPSZENSPS
PSPSZENSNSZE
PSZENSNSNBNS
ZENSNSNBNBNB
PBPSZENSNB
( )de t
( )e t
1 2 3 4 5
11
6 8 9 10
22 23
18 19
24 25
20
13 14 15
7
12
16 17
21
 
而模糊推論部分，在考慮晶片的面積及速
度因素下，採用簡化模糊單值推論方式
（simplified fuzzy-singleton）做為模糊推論的
方法[5]，它是最大-最小推論法的一個特例，
其推論方法簡化了後鑑部的推論方式，直接以
 iv
論的動作，推論引擎電路整體架構如圖9所示。 
4
4
M _ v 1 1
M _ v 2 1
M F 1 1
M F 2 1
4
6
m in
r u le
iα
im
m in
m in
m in
M _ v 1 1
M _ v 2 2
M _ v 1 2
M _ v 2 1
M _ v 1 2
M _ v 2 2
r u le
r u le
r u le
3
3
M F 1 1
M F 2 2
M F 1 2
M F 2 1
M F 1 2
M F 2 2
D e fu z z if ie r
 
圖 9. 推論引擎電路架構圖 
電路工作原理是將前面模糊化所產生的
四個歸屬函數跟四個歸屬函數值分別送入模
糊規則庫與比較電路中，得到四個 iα 輸出與四
個 im 輸出，最後再送入解模糊化電路裡進行解
模糊化的動作，其中為 iα 啟動強度， im 則為模
糊規則推論的結果。 
(d) 解模糊化電路設計 
解模糊化電路主要功能是將推論引擎電
路送來的資料經由解模糊化的公式加以處
理，以得到一明確值輸出，也就是實現式(3)，
由前述可知兩輸入共會有四條模糊規則會被
觸動，因此 4=n 。 
4x6bit乘法器
加法器
除法器
4x6bit乘法器
4x6bit乘法器
4x6bit乘法器
4
1α
1m
加法器
6
2α
2m
3α
3m
4α
4m
10
out
4
 
圖 10. 解模糊化電路架構示意圖 
解模糊化電路是個模糊電路中最耗邏輯
閘數與處理時間的部分，因為整個電路包含加
法器、乘法器及除法器等數值運算電路。整個
電路工作原理是先將 iα 與 im 相乘送進加法器
中成為分子，再將 iα 送至另一個加法器成為分
母，兩個結果再送至除法器所得到的商數就是
最後的解模糊化結果。其電路架構如圖10所
示。 
最後圖11顯示了模糊晶片推論的結果，驗
證電路設計之正確性。 
e: ZE, PS
de: NB, NS output: NS  
圖 11. 模糊晶片推論模擬結果 
(e) 誤差電流訊號與積分器電路設計 
本計畫所採用的是Altera 公司所生產的
Stratix 系列晶片[17,10]，此類晶片包括DSP IP 
Core、NIOS CPU IP Core，並且尚餘許多FPGA 
閘數，以便根據使用者需要。而系統取樣時間
設定為1ms，因此我們設定一訊號cnt為上數計
數器，當cnt數到25175時，就送出一en1的觸發
訊號，並將cnt訊號清除為0，而en2、en3分別
為en1延遲一個、兩個CLK的觸發訊號，其相關
時序圖如圖12所示。 
1 m s
e n 1
e n 2
e n 3  
圖 12. 觸發訊號時序圖 
電流誤差的含意即是命令電流減去迴授
電流，而誤差變化為這一刻的誤差值減去上一
刻的誤差值，在硬體實現上我們利用拴鎖器電
路（Latch）將前一刻相減的值存在拴鎖器裡，
再與這一刻的訊號作相減，減完再一起與誤差
訊號做輸出，所以時序的控制就變的非常重
要，程式的流程圖如圖13所示。 
開始
En1↑,e = c - r
En2↑,de = e - f
En3↑,f <= e , o_e <= e , o_de <= de
CLK計數除頻 , 25.175 Mhz
When Cnt = 25175
結束  
圖 13. 程式流程圖 
 vi
 
圖 17. 控制器追蹤電流 0.2A 的電流誤差 
 
圖 18. 控制器追蹤正弦波的電流情形 
 
圖 19. 控制器追蹤正弦波的電流誤差 
Phase A
Phase B
 
圖 20. 相電流 PWM 切換實測圖 
Phase A
Phase B
 
圖 21. 相激磁電流實測圖 
 
圖 22 d-q 軸電流波形圖 
5. 結論 
模糊控制具有許多傳統控制所沒有的優
點，本計畫也成功地將它實現在 FPGA 晶片
上，使其成為一全數位化的模糊控制器晶片，
FPGA 晶片的功能可以很容易被驗證且可以修
改內部程式以達到所需的功能。而未來的晶片
是朝向 SOC（System On Chip）的趨勢，所以
控制器電路也將整合到一片晶片中，以達到產
品小而速度快的要求。由於模糊控制器內部許
多設定都是依據使用者的經驗所訂定，例如歸
屬函數的選取、模糊規則的數量、模糊推論及
解模糊化的方法，都會影響系統的控制特性，
因此未來可嘗試用不一樣的設定方法來調整
控制器晶片的效能，並且可以加入傳統的 PID
控制器以改善系統的響應，或是搭配類神經網
路、基因演算法等理論，使模糊控制晶片具自
我學習的特性，在硬體方面也可多方嘗試其他
的驗證平台，使其功能性更加完全。 
 行政院國家科學委員會補助專題研究計畫 ■ 成 果 報 告   □期中進度報告 
 
高效能微步進控制技術之 IP 設計 
 
 
計畫類別：■ 個別型計畫  □ 整合型計畫 
計畫編號：NSC 94－2213－E－234－002 
執行期間： 94 年 8 月 1 日至 94 年 7 月 31 日 
 
計畫主持人：林浤偉 
共同主持人： 
計畫參與人員： 林再旺 
 
 
成果報告類型(依經費核定清單規定繳交)：■精簡報告  □完整報告 
 
本成果報告包括以下應繳交之附件： 
□赴國外出差或研習心得報告一份 
□赴大陸地區出差或研習心得報告一份 
□出席國際學術會議心得報告及發表之論文各一份 
□國際合作研究計畫國外研究報告書一份 
 
 
處理方式：除產學合作研究計畫、提升產業技術及人才培育研究計畫、
列管計畫及下列情形者外，得立即公開查詢 
          □涉及專利或其他智慧財產權，□一年■二年後可公開查詢 
          
執行單位：黎明技術學院電機工程系 
 
中 華 民 國 九 十 五 年 十 月 四 日 
