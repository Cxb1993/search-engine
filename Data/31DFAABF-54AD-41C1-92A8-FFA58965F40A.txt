合作企業簡介 
合作企業名稱：探騚科技公司 
計畫聯絡人：蔣建銘 
資本額：800萬 
產品簡介：產業包括有，PCB 空板測試設備含軟板雷射實裝板 ICT，ATE，
壓床，真空治具與測試設備，手機通訊產品，CCD 模組，LCD 模組，背光
板，touch panel，光學鏡片，電子產線自動化設備，傳統產業檢測設備，涵
蓋電子業、光電業、傳統產業。PCB空板測試設備含軟板雷射實裝板 ICT，
ATE，壓床，真空治具與測試設備等。 
網址：              電話：02-2672-2905 
 
 
研究摘要(500字以內)： 
本計畫中我們與國內廠商合作，嘗試自行研發一套視覺檢測系統，研發之
重點在於建構 AOI 的嵌入式系統平台。 
我們規劃採用 ARM 處理器與影像信號處理器雙核心(dual core)之架構，以
高效率進行影像量測與分析並兼具彈性便利之人機作業界面。系統組成包括
ARM 處理器、影像信號處理器(CPLD/FPGA)、CCD 攝影機控制介面、NTSC 影
像編碼器、記憶體儲存元件與使用者操作介面，並研發影像量測、分析軟體與
使用者介面軟體等。 
本計畫本年度在硬體方面已完成 CCD 攝影機控制介面、NTSC 影像解碼器
介面與 VGA顯示介面、影像擷取電路、記憶體儲存介面與 FPGA影像處理模組
等功能，軟體方面則實作計算灰階平均值、二值化、邊緣偵測工具、BLOB等分
析功能。未來將致力於移植影像處理程式至 ARM處理器或 Altera NIOS處理器，
希望經由實際研發一套完整的嵌入式 AOI 系統，培養參與人員於嵌入式系統硬
體設計、嵌入式作業系統移植、影像處理系統硬體設計、影像處理與分析軟體
設計、各項週邊與系統整合、檢測技術等方面之技術能力。 
 
 
國科會補助提升產業技術及人才培育研究計畫成果精簡報告 
以 ARM與 DSP雙核心實現應用於自動化光學檢測之嵌入式系統平台 
計畫編號：NSC 94-2622-E-129-006-CC3 
執行期限：94年 11月 1日至 95年 10月 31日 
主持人：簡忠漢 聖約翰科技大學 電機工程系 
計畫參與人員：黃耀璋、苗延浩、邱順旗、何寬彥、林綉莉 
 
一、摘要 
 
本計畫中我們與國內廠商合作，嘗試自
行研發一套視覺檢測系統，研發之重點在
於建構 AOI 的嵌入式系統平台。 
我們規劃採用 ARM 處理器與影像信
號處理器雙核心(dual core)之架構，以高效
率進行影像量測與分析並兼具彈性便利之
人機作業界面。系統組成包括 ARM 處理
器、影像信號處理器(CPLD/FPGA)、CCD 
攝影機控制介面、NTSC 影像編碼器、記
憶體儲存元件與使用者操作介面，並研發
影像量測、分析軟體與使用者介面軟體等。 
本計畫本年度在硬體方面已完成 CCD 
攝影機控制介面、NTSC 影像解碼器介面
與 VGA 顯示介面、影像擷取電路、記憶
體儲存介面與 FPGA 影像處理模組等功
能。軟體方面則實作計算灰階平均值、二
值化、邊緣偵測工具、BLOB等分析功能。 
關鍵詞：自動化光學檢測、嵌入式系統、
FPGA影像處理 
 
二、緣由與目的 
 
機器視覺檢測技術亦稱為自動化光學
檢測( Automatic Optical Inspection, AOI)最
早是於 1980年代被引進，主要用於工廠作
業生產線上針對零件與產品品質良竄的檢
視。其具有降低人工檢測的成本，增進品
質和生產力之優點。因此機器視覺檢測技
術被廣泛應用於各種產業，例如半導體、
電子、電腦通訊、製藥、汽車、航太、金
屬製造、食品處理與印刷等產業。 
近年來由於半導體與電腦、通訊、電子
業的蓬勃發展，造成自動化光學檢測技術
之需求大幅擴張[1-3]。尤其當半導體晶片
與電子通信產品內部之線路愈見細微，且
零件已較頭髮微細之際，已無法倚賴人類
肉眼檢驗產品品質之良竄與否。此外因應
技術生命週期的縮短與全球化進程加速之
嚴苛競爭趨勢，製造業者深刻瞭解產業存
活與成功的關鍵是降低成本、提升生產力
和品質，因此必須重新檢視、設計製造程
序。其中 AOI檢測系統成為重視品質管理
的高科技產品生產環境中不可缺少的設
備。 
根據工研院經資中心 ITIS 計畫分析資
料顯示[4]，2002 年國內 AOI 設備市場約
為 56 億台幣，預估 2006 年將成長至 165
億，主要將應用在 IC 封裝、IC 製造，以
及 PCB、電腦、LCD產業。而根據美國最
著名產業市調公司 Frost&Sullivan 之分
析，2002年全球 AOI設備市場為 23億美
元，2006 年預估將達 65 億美元。其市場
潛力可見一般。 
分析目前 AOI 市場上之系統組成中，
可區分 PC Based 之 AOI 系統與嵌入式
(Embedded) AOI系統兩大主流。傳統的 PC 
Based 系統目前居市場主導地位，其價格
相當昂貴，但其具有高速性能、高精度與
使用者介面客製化等優勢，較適用於一些
高階應用及實驗室級別應用，或某些特殊
行業(如半導體、LCD 產業)的應用中。而
嵌入式 AOI系統，以其物美價廉、靈活小
巧、簡單易用、高可靠性、高抗干擾能力
備受青睞。適用於廣大中低階工廠生產線
檢測的應用，因此發展快速。未來隨著嵌
入式處理器技術的不斷發展，嵌入式 AOI
系統的性能將可大幅提升，並逐步取代傳
統 PC Based系統的市場領域。 
根據工研院經資中心 ITIS 計畫資料顯
示，目前國內 AOI儀器主要由國外大廠主
宰，國內廠商大都以代理為主，尚未建立
自有品牌。有鑑於此，本計畫中我們與國
內廠商合作，嘗試研發一套視覺檢測系
統，希望提昇國內廠商於國際 AOI市場的
競爭力。研發之重點在於建構 AOI的嵌入
式系統平台。為達成能與 PC Based的 AOI
系統匹敵之高速檢測性能，我們規劃採用
ARM 處理器與影像信號處理器雙核心
 
圖 3. 包含 CCD鏡頭三軸調整架之檢測機構平台 
 
 
圖 4. Altera DE 2 FPGA嵌入式開發平台 
 
User Interface
(Keypad, Mouse, DI/
DO)
NIOS II core
(FPGA IP core)
D/A Converter
(Video Encoder, 
OSD)
Flash ROM
(Template 
Database)
SD RAM
(Frame Buffer)
Video Output
(TV)
A/D Converter
( Video 
Decoder)
CCD 
Camera
 
圖 5. 影像擷取、顯示介面與影像處理核心設計方
塊圖。 
 
3.1 驗證 Video DAC-ADV7123 顯示介
面：首先，為了驗證影像數位/類比轉
換 IC 的使用方式及確認 VGA 顯示時
序，我們使用VGA時序產生電路(VGA 
Timing Generator)來產生一個測試圖
樣(Test Pattern)，使此測試圖樣能透過
支援 VGA輸入的 LCD或 CRT螢幕顯
示出來，驗證電路設計如圖 6所示。 
圖中 PLL 功能是將外部輸入的時
脈轉換成 VGA 的像素時脈 (Pixel 
Clock)，做為水平同步訊號產生器
(H-Sync Generator)及VGA測試圖樣資
料輸出的基準時脈。H-Sync Generator 
(水平同步訊號產生器)功能是以像素
時脈為基礎，對像素時脈計數來產生
水平同步訊號，並做為垂直同步訊號
產生器 (V-Sync Generator)的基準時
脈。V-Sync Generator (垂直同步訊號產
生器)以水平同步訊號為基礎，對水平
同步訊號計數來產生垂直同步訊號。
而 VGA Data Controller以參考像素時
脈、水平同步訊號及垂直同步訊號來
產生測試圖樣資料輸出。 
 
3.2 驗證 Video Decoder-ADV7181 影像信
號解碼功能：接下來我們由 NTSC 攝
影機輸入影像，並實作 ITU-R BT.656
影像格式的解碼模組，並驗證
ADV7181 影像解碼 IC 的用法。驗證
電路設計及架構如圖 7所示。 
由於ADV7181需要透過 I2C介面
對其內部暫存器做初始設定，因此我
們首先實作一 I2C Controller模組，以
產生 I2C格式傳送ADV7181的設定參
數。其次 ITU-R BT.656 Decoder電路
功能則是從 ADV7181 的資料流中解
出水平同步訊號、垂直同步訊號、圖
場資訊及影像資料，並將 4:2:2的資料
取樣格式轉為 4:4:4 的格式。Line 
Buffer 電路功能為 de-interlace 用，其
作法為將每條掃瞄線重複顯示一次以
補不足的掃瞄線。此 de-interlace 方法
所耗資源最少，設計方法也最簡單，
但卻犧牲了解析度，因此對於講求影
像品質的應用則不適用。YCbCr to 
RGB電路功能是將 ITU-R BT.656輸出
影像訊號由 YCbCr 色彩空間轉換成
VGA介面顯示所需的 RGB色彩空間。 
 
 
圖 6. VGA時序產生電路 
 
圖 7. 驗證影像輸入/輸出電路 
 
3.5 連結影像信號處理器：完成影像擷取
電路後，我們開始設計與影像信號處
理器結合的方式。同時我們亦考慮以
硬體模組做前置的影像處理，以節省
處理影像的時間，希望藉由軟、硬體
共同設計的方式，可以提升影像處理
平台的效能與速度。 
我們設計的前置影像處理電路為
一空間濾波器(Spatial Filter)，可實現高
通濾波器、低通濾波器、中值濾波器，
或是一些常用的影像邊緣偵測器，例
如 Sobel、Laplacian等。我們首先實作
一個 3×3 的空間濾波器，其架構如圖
12 所示。其中透過改變參數 W1~W9
之值，即可改變濾波器的類型。 
至於影像信號處理器之設計，為
能快速驗證，我們初步採用 Altera 所
提供的軟核心 (Soft Core)處理器
---NIOS II處理器。整體設計架構如圖
13所示。受限於 DE2平台上之記憶體
容量，因此我們考慮使用 NIOS II讀取
SRAM 內灰階影像，經處理後回寫至
SDRAM未使用之記憶體區塊，再由此
區塊輸出影像顯示。圖 14顯示我們實
作 3種濾波器影像處理結果。 
在影像量測與分析軟體方面，初
期我們先於 PC平台開發測試，未來將
移植到 ARM平台。我們首先參考市場
上 AOI 檢測機之三個主要進口品牌
(NAIS, SHARP, KEYENCE)之功能。經
分析三種領導品牌產品功能之優劣與
優先重要順序，我們規劃與實現如圖
15之視覺檢測流程圖。 
 
 
圖 12.含 3×3空間濾波器的影像擷取電路 
 
 
圖 13. 影像擷取電路結合 NIOS II處理器 
 
(a) 
 
(b) 
 
(c) 
 
(d) 
圖 14. (a)含 3×3空間濾波器的影像擷取電路實際應
用場景，(b)Laplacian濾波器處理後之影像 (c)Sobel
濾波器處理後之影像 (d)二值化濾波器處理後之影
像 
 
接著我們採用視窗程式介面開發工具
(C++ Builder)設計搭配之使用者介面，如
圖 16所示，主要可分為以下三大部分： 
1. 來源影像/影像處理結果區：本區主要為
顯示透過影像擷取卡擷取之輸入來源影
像，並可切換顯示經檢測工具處理後之
結果影像。因此具有可提供使用者依據
結果調整檢測工具參數之功用。 
2. 檢測工具區：本區以下拉式選單方式提
供使用者選擇檢測工具。目前已實現計
算灰階平均值、二值化工具、定位工具、
邊緣偵測工具、BLOB 工具等 5 類檢測
工具。 
3. 檢測結果輸出區：選定檢測工具並設定
參數後，點按 Run button 開始執行檢
測，檢測之結果則於本區顯示。 
以下我們依據圖 15 之檢測流程，說明
目前完成之影像量測與分析軟體功能。 
以圖 17 之待測影像為例，經定位工
具選定水平掃描區域 (0, 240)~(639, 
260)，掃描正向邊緣(黑到白)、邊緣強
度 40、最小邊緣寬度 10。經執行後偵
測到物體水平位置座標為 139。 
3. 影像特徵定位與邊緣檢測：自動光學檢
測中經常使用物體特徵做為簡單檢測判
斷的標準，例如影像中物體的個數、每
個物體的面積、周長、質量中心位置都
是常用來檢測待測物是否有瑕疵所常採
用的特徵。此外物體邊緣的個數與間距
也是常用的檢測特徵，例如應用在印刷
電路板上 IC 腳距與焊點的良劣判斷
等。為此我們設計三類檢測特徵之工
具，即計算灰階平均值工具、邊緣偵測
工具與 BLOB工具。 
本計畫實現之計算灰階平均值工具
在進行計算平均值前可先對影像前置
過濾(prefiltering)，濾除太亮或太暗之像
素。接著可選定待處理區域(region of 
interest, ROI)，若配合前一步驟之定位
工具則可找到物體確切之區域。最後計
算區域內像素灰階值的平均。以圖 17
之待測影像為例，經計算灰階平均值工
具偵測，所得灰階平均值為 25。 
邊緣偵測工具的運作原理與前述之
定位工具雷同。但定位工具僅輸出 ROI
內第一個偵測到像素值有大幅起伏(邊
緣)之位置；而邊緣偵測工具則會輸出
ROI內所有符合條件的邊緣位置。 
以圖 20 之待測影像為例，經定位工
具偵測水平區域(0, 240)~(639, 260)，掃
描正向邊緣(黑到白)、邊緣強度 45、最
小邊緣寬度 15。經執行後偵測到物體邊
緣共 32處，其水平位置座標為 103, 129, 
142, 155, 167, 180, 193, 206, 219, 231, 
244, 257, 270, 283, 295, 308, 321, 334, 
347, 359, 372, 385, 398, 411, 424, 436, 
449, 462, 475, 500, 513, 526。對照圖 20
可輕易發現偵測到之邊緣恰好與圖像
上半部之條紋一一對應，其間隔約 13
像素，且不難發現在像素垂直位置
240~260，水平位置 475~500 之間有一
斷裂之處，因此在 475~500之間未偵測
到邊緣。由此可見邊緣檢測工具對於物
體邊緣的個數與間距的檢驗，提供一種
判定物體瑕疵之簡易判斷依據。 
 
圖 20. 檢測系統採用之樣本圖像 2 
 
BLOB為 binary large object的縮寫，
其運作原理[7]為首先透過二值化區分
背景(黑)與前景的物體(白)，接著透過標
籤化技術(labeling)將同一區域(region)
的像素歸類為同一物體並給予唯一之
標籤(label)，透過標籤值我們可進一步
計算每個物體的面積與質量中心，再透
過尋找輪廓之演算法[7]，可以計算每個
物體的周長。本計畫實作之 BLOB工具
可選定 ROI區域，並可過濾太小的物體
與太大的物體。 
為展示本計畫實現之 BLOB工具，以
圖 21 之樣本圖像為例，其主要可區分
成 6大區塊。影像上方有一塊小區域為
雜訊部份。經使用 BLOB工具偵測處理
共偵測到 7 個區域，如圖 22 所示，各
區域特徵值如表 1所列。 
 
表 1. 圖 21中BLOB工具偵測到 7個區塊的特徵值 
物體 
標籤值
質量中心 
位置 
面積 周長 
0 (220, 3) 122 44.83 
1 (338,162) 2745   268.97 
2 (398,254) 16086   833.74 
3   (272,183) 6667 356.38 
4 (500,240) 13377 574.43 
5 (173,242) 12841   506.43 
6 (255,301) 4679   303.21 
 
 
圖 21. 檢測系統採用之樣本圖像 3 
 
