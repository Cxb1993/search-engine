1.簡介 
本計畫係國科會整合型計畫 「水下感
測元件及系統之研發與應用於水下作業」
之子計畫，其任務主要係將模組三輸出成
像的超音波影像進行影像強化、邊緣偵
測、(圖.1 所示之模組四) 、目標物定位及
辨識，隨後傳送夾取座標予模組五，以達
成機械臂夾取物體之目的(如圖.2 所示)。
吾人利用水下超音波之特性應用於影像處
理之能力，用以發展適用水下超音波影像
之快速影像分割(segmentation)與物件定位
之技術。根據輸入影像雜訊特性及考慮水
下特殊環境條件，提出一適應性邊緣偵測
器，期能快速有效地擷取目標物之輪廓，
並達到物件定位以利機械臂進行水下施工
及物件打撈動作。圖.3 為本模組流程圖。 
 
 
圖.1 整合系統(總計畫) 
       之各模組任務架構圖 
 
 
圖.2 整合系統之作業示意圖 
 
 
 
圖.3 超音波影像處理流程 
 
2.原理及方法 
 
2.1 水下超音波影像分割 
於本計劃中為能有效的擷取出超音波
影像邊緣輪廓，吾人將利用改良式蛇型輪
廓模型（Improved Snake Model）偵測超音
波影像之邊界[1]。 
 
2.1.1 主動輪廓模型（ Active Contour 
Model）
最原始的蛇型輪廓模型（ Snake 
Model）[3]原名為主動輪廓模型（Active 
Contour Model），它是藉由給予起始控制
點，其所連結出來的輪廓線具有雲型線
（spline）及連續的特性（此特性即為內
力），外加影像力（外力）之交互作用，
經由最小能量極值求解以得到符合影像特
徵之最終輪廓線，亦即物件擷取完畢。
Snake Model之總能量可以表示為內力、外
力之總和，如式（1）所示： 
 
)()(
1
iEiEE img
n
i
intsnake += ∑
=
           (1) 
其中n表示起始控制點的總數目，i表示為
第i個控制點，Eint為內力，Eing為影像力(外
力)，而Snake Model擁有許多後續研究方
法，例如Balloon Model [4]、Gradient Vector 
Flow(GVF) [5] 與 其 衍 生 的 Generalized 
Gradient Vector Flow(GGVF) [6]，其中
Balloon Model為追加一個正向推力於外力
上，其外力能量方程式如式(2)所示: 
 
img
img
1balloon F
F
ksnkF += )(ˆ             (2) 
imgimg EyxFF −∇== ),(             (3) 
 
其中k1表示推力為向內收縮或是向外擴
 2
 
圖.5 影像辨識之流程圖 
 
 
2.2 水下超音波影像辨識 
為了確定輸入之超音波影像是否為目
標物件，首先利用從影像分割所得之影像
進行區域特徵值擷取，爾後利用這些特徵
值 與 資 料 庫 中 之 資 料 進 行 匹 配
(matching)，以達到辨識之效果，圖.5 為
影像辨識之流程圖。 
 4
 
 
2.2.1 區域特徵擷取 (Feature Extraction) 
 
由先前計畫中進行影像分割後將可得
到一邊緣影像，且於成像過程中超音波影
像將會呈現在整張影像中間位置，故吾人
僅只考慮其物件的縮放與旋轉狀態。因
此，本計畫將藉由使用 Kovesi Detector [7]
結合 Laplacian of Gaussians [8]作為擷取特
徵值之方法，以符合特徵之縮放及旋轉不
變。吾人利用 Phase congruency[9]將取得
之邊緣影像轉換至頻率域進行特徵擷取，
其所擷取出來之特徵點並不會因影像本身
之旋轉及視點改變而有所影響。而 Harris 
Detector [10]其原理為進行區域影像強度
偵測，並針對各區域中所包含的像素點利
用式(12)進行計算以得到變化量 
 
 
( ) ( ) ( ) ( )[∑ −++=
yx
yxIvyuxIyxwvuE
,
2,,,, ]    (12) 
I(x+u ,y+v)表示位移(u,v)位置以後的區域
之強度，I(x ,y)則為該區域中的中心點。
w(x,y) 實 為 一 視 窗 方 程 式 (window 
function)，吾人以圖.6 來表示其定義。 
由 於 影 像 強 度 之 變 化 量 利 用 Phase 
congruency 函數轉換至頻率域，可將影像
強度變化量寫成式(13) 
 
∑=
n
n vuAvuPCvuE ),(),(),(           (13) 
 
∑=
n
n vuA
vuEvuPC
),(
),(),(                (14) 
 
),(),(),( 22 vuHvuFvuE +=         (15) 
而 F(u,v)為針對影像灰階值進行傅利葉
轉換後之影像強度平均值，H(u,v)則為利
用 Hilbrt 轉換[11][12]之後的 F(u,v)。再
者，式(14)可透過圖.7 改寫成式(16) 
 
∑
∑ −
=
n
n
n
nn
vuA
vuvuA
vuPC
),(
)),(),(cos(
),(
ϕϕ
 (16) 
因此，區域影像強度之變化量即等於在每
is Detector 針對各區域影
像強
 
個比例範圍下之相位適合函數，其中
An(u,v)則表示在傅立葉轉換下每個尺度下
之振幅總和。 
而利用 Harr
度之變化量，經位移[u ,v]，吾人依據
[10]可將式(16)改寫成以式(17)來表示: 
 
( ) [ ] ⎥⎦
⎤⎢⎣
⎡≅ ∑ v
u
vuA
MvuvuPC
n
n
  
),(
  ,,      (17) 
其中矩陣 M 為: 
 
∑
⎥⎥
⎥⎥
⎥
⎦
⎤
⎢⎢
⎢⎢
⎢
⎣
⎡
∂
∂
∂
∂
∂
∂
∂
∂
∂
∂
∂
∂
= 2
2
y
I
y
I
x
I
y
I
x
I
x
I
yxw ),(M        (18) 
 
 
圖.6  視窗方程式之定義 
Window function 
w(x,y) = 
1 in window, 0 
當影像本身或所擷取出之特徵數目很
大時，因需兩兩比對相似度，其計算複雜
度將會大大提高，進而影響整體計算效
能。標準化互相關法之計算公式如式(22)
所示： 
 
( )( ) ( )( )
( )( ) ( )( )∑∑ ∑∑
∑∑
= = = =
= =
−−
−−
=
1
1
2
1
1
1
2
1
22
1
1
2
1
,,
,,
n
i
n
j
n
i
n
j
sstt
n
i
n
j
sstt
GjiGGjiG
GjiGGjiG
r  (22) 
 
其 中 ， n1,n2 為 目 標 視 窗 大 小 。
分 別 為 目 標 窗 （ Target 
Window）與遮罩窗（Mask Window）內各
像素之影像強度值。
( ) ( jiGjiG st ,,,
 6
)
st GG , 分別為目標窗
與遮罩窗內所有像素之影像強度平均值。
視窗內像元所在的行、列值。r 為互相
關係數。利用目標窗與遮罩窗，可求得一
相關係數，將所有相關係數排序並選取最
大值，當此值大於所設定之門檻值，則視
該視窗對為匹配成功之對應對。 
ji,
吾人透過式(22)循序計算輸入影像與
資料庫中每一張參考影像之 r 是否大於
一個定值，如果判斷結果為真，則可確定
其為正確之對應點。若符合條件之對應點
數達到所有特徵點總數50%以上即判斷其
與資料庫中之參考影像相符合而完成辨
識。 
 
2.3 影像處理實現於 FPGA 
 
針對於超音波影像，吾人將前期所提
出之影像處理演算法運用硬體描述語言並
搭配 FPGA，將演算法實現於硬體。FPGA
之 開 發 平 台 為 Altera-NIOSⅡ 
EP2S60F672C5ES 開發版，所搭配之硬體
描述語言為 VHDL。 
 
2.3.1 影像特徵擷取實現於 FPGA 上 
 
於許多電腦視覺運算中，吾人所注意
之焦點係找出重要的特徵點－更準確的
說，係找出不變的特徵點(invariant feature 
point)。這些不變特徵點的重要性在於當超
音波影像中一連串畫面中特徵點間的變化
時，吾人即可回復環境中的結構與畫面上
動作的影像資訊。 
一般於空間域所擷取出之特徵點通常
會顯示兩個方向（x 與 y）灰階值的明顯變
化。這些座標點係重要之依據，可作為於
比對與追蹤一連串影像時之基準點，影像
中輪廓邊緣的座標點可與第二格影像輪廓
上任何數量的其他座標點進行比對。 
吾人將實現步驟分成以下四項： 
 
1. 資料擷取－取兩個x與y軸的灰階值，計
算特性多項式中每個像素的三個係數。
為了儲存與讀取灰階值，吾人使用一個
緩衝區（運用NIOSⅡ區塊記憶體建
置）。 
2. 特徵多項值的計算－此數值能研判與特
定像素有關的特徵。吾人運用NIOSⅡ元
件中內建之乘法器執行特徵矩陣的微積
分運算[14]。 
3. 特徵分類－吾人將計算出之特徵值儲存
於區塊記憶體，隨後運用連續比較法，
逐步進行排序。 
4. 強制最小距離－此步驟係維持特徵之間
之最小距離；如不執行此一步驟，即會
得到累積於最重要座標點上之眾多特
徵。此步驟使用區塊記憶體，於每個最
重要的特徵週圍建立一個非偵測區域，
其他的特徵則不會被選取。 
 
吾人利用Quartus編寫成硬體描述語言並
轉換成模組式，藉由模組化能夠更快速實
現演算法之硬體架構。圖.9為將特徵擷取
演算法由模組化實現，其中(a)為微分器之
電路模組，(b)為將微分器運算後之結果進
行後續的矩陣運算與比較之電路模組。 
 
 
圖.9 (a)利用 RTL VIEW 將微分器電路轉
換成區塊 
