 1
 
中文摘要 
 
本研究計畫第二年的目標為製作具有影像功能的人形步行機器人步行控制
系統，並以能夠步行未知階梯地形為目標。本計畫製作具有影像功能的人形步行
機器人，機器人由日本 KONDO公司的人形步行機器人 KHR-1為主體改裝而成。
它具有 17個伺服機馬達，頭部加裝有 1組 CCD網路攝影機，腳部加裝有 2組紅
外線感測器以及 4組壓力感測器，另外腳底加裝塑膠軟墊用來增加與地面接觸並
的摩擦力。最後，實驗結果證明所設計的小型二足步行機器人可以辨識未知階梯
地形並且以靜態平衡穩定的行走。 
 
關鍵字：二足步行機器人、靜態平衡、階梯步行、運動控制 
 
 
Abstract 
 
The objective of this second year project is to develop a humanoid walking robot 
with image processing functions, so that it can detect an unknown stairs and then can 
climb up the stairs.  The developed humanoid robot is build up from the KONDO’s 
KHR-1 (17 RC servos) with additional one CCD WEBCAM, two infra-red sensors, 
and four pressure sensors, and a rubber plant is installed under the foot to increase the 
friction force with the floor.  Finally, the experimental results show that the designed 
biped robot can identify a stairs terrain and statically stable climbing up stairs. 
 
Keywords: biped walking robot, statically stable, stair climbing, motion control  
 
 3
法(image optical flow method)[7]、移動邊緣檢測法(moving edges detection)、顏色
追蹤(color tracking)[14]、人臉追蹤(face tracking)等等研究方法或技術陸續被提出
討論與應用。若將影像追蹤系統與人型步行機器人結合，可以讓人型機步行器人
感測周圍環境、避開障礙物、跟隨移動目標物行動及完成指定任務。 
 
平面影像中的景深資訊，在影像追蹤研究的領域中是非常重要的線索，早期
許多影像追蹤研究是從單一攝影機開始，藉由改變攝影機旋轉的角度使目標物保
持於視野中，而目標物與攝影機的深度資訊，是從目標物在畫面中的面積、大小…
等參數來估測相對的距離，其中仍存有誤差及精確度不足的問題。在過去的研究
中，主要是以立體視覺的方式來進行相關的研究，立體視覺的作法如圖 1.1(b)所
示，是將兩部攝影機以左、右擺置的方式同步擷取成對影像(stereo image pair)，
利用物體於兩幅影像中所在位置的不同，計算兩幅影像特徵點的差異量
(disparity)，再由三角測量即可求得景深資訊[10]。但在真實環境下，由於特徵點
的取得不易，且特徵點與特徵點之間的對應問題(correspondence problem)尤為複
雜，因此造成此方法在實用上具有相當的困難度。 
 
不過近年來已有相關研究，使用一部架設在車上的攝影機擷取前方道路影
像，並有效地估測出前車距離[8]。這是由於攝影機跟目標物都有共同的基準平
面如圖 1.1(a)所示，因此可藉由攝影機裝設的高度、攝影機的視角中心線和地面
之間的角度以及目標物與攝影機之間的角度[9]，估算出攝影機與目標物之間的
距離。使用單攝影機的景深評估方法演算法簡單，而且只需要單眼拍攝之影像，
避開了目前尚未有效解決的立體視覺特徵點對應性問題，因此較立體視覺之實用
性相對為高。 
 
lx rx
rplp
p
d
(b)
圖 1.1 立體視覺示意圖(a)單 CCD、(b)雙 CCD 
 
 
1.3  內容架構 
 
本報告共分為六章。第一章為緒論，簡要說明有關於本報告的研究動機、研
究回顧以及內容架構。第二章為人形步行機器人構造與步行軌跡規劃，其中包含
了對人形步行機器人的構造描述，以及人形步行機器人於平面步行、階梯步行時
之軌跡規劃。第三章為立體視覺與影像處理，說明立體視覺的方法，其中包含透
視成像原理及目標角度的估算，最後利用目標物的距離評估，計算出目標物與攝
影機之間的距離。接著介紹影像處理的部份，包含影像的擷取、彩色空間轉換、
θ
h
1θ
1δ
d1
d
中心
線
(a)
 5
第二章 人形步行機器人構造與步行軌跡規劃 
 
    本章節描述人形步行機器人的構造，並說明人形步行機器人的運動方式，並
對平面步行、階梯步行以及原地旋轉的週期規劃加以說明。為了模擬人形步行機
器人的步行狀況且觀察分析其行走模式，必須產生一組可供人形步行機器人行走
的參考軌跡，讓人型機器人穩定的步行，其中包括人形步行機器人於平面步行、
階梯步行時之軌跡規劃。 
 
2.1 人形步行機器人構造描述 
     
報告中使用的人形步行機器人為日本 KONDO 公司所生產的 KHR-1，實體
圖如圖 2.1(a)所示，它是由 17 個伺服馬達所構成的小型化人形機器人，具備有
10個自由度的雙足、6的自由度的雙手及 1自由度的頭部，尺寸為 340 x 180mm，
重量約為 1.2 公斤。人形步行機器人的示意圖如圖 2.1(b)所示，採用卡氏座標系
統，以正 x軸為前進方向， y軸為左右方向， z軸為上下方向。人形步行機器人
的左右腳各有五個自由度，其中腰部 2個、膝關節 1個、踝關節 2個。而身體的
部份，由七顆馬達所組成，一個自由度做為頭部的旋轉，左右手各三個自由度，
可以做類似機械臂的動作。 
 
X
Y
Z
(a) (b)  
圖 2.1 人形步行機器人(a)實體圖(b)示意圖 
 
 為方便軌跡的計算，首先定義兩平面如圖2.2所示，在 zx − 平面上定義為 
sagittal plane， zy − 平面定義為 frontal plane。在 zy − 平面上為繞 x旋轉的自由
度，將原本的運動分解為擺動腳與支撐腳的動態方程式，這種分割方式可以使系
統在控制時，讓參數有效的減少，以達到解耦合的要求。 
 7
( fff ZX θ,, )的運動軌跡，運動軌跡其規劃有許多方法，例如三次多項式曲線、
指數型速度-時間曲線及擺線輪廓曲線等方法。本報告使用擺線輪廓曲線來規
劃，因為它提供一個簡單函數來近似人類正常步行時腳底的運動軌跡，而且使用
擺線輪廓曲線在參數的規劃上，具有步行高度與步行距離均可自由更改的優點。 
      
在步行週期的規劃上，利用 sT 參數訂出步行週期的長度，可藉由 sT 修正腰
部與足部軌跡的關係。足部移動為平起平落的方式，步行時足部與地面保持平
行，與地面接觸時，為整個足部接觸地面所以足部角度 fθ 設定皆為 π5.0 。為了
達到較穩定的步行，希望 hθ 在行走的過程中能保持在一定的角度，所以將腰部
角度 hθ 設定為 π5.0 。 
腰部軌跡(Xh , Zh ,θh)
足部軌跡(Xf , Zf ,θf)
 
圖 2.3 平面步行軌跡規劃 
 
足部與腰部之軌跡可表示如下： 
⎥⎦
⎤⎢⎣
⎡ −= )2(sin2
2
)(
ss
f
f T
t
T
tXtX πππ        (2.1)  
⎥⎦
⎤⎢⎣
⎡ −= )2(cos1
2
)(
s
f
f T
tHtZ π         (2.2) 
以及 
⎥⎦
⎤⎢⎣
⎡ −= )2(sin2
2
)(
sh
h
h T
t
T
tXtX πππ        (2.3) 
hh HtZ =)(            (2.4) 
 
其中 hX 為腰部前進的距離、 fX 為足部步行的距離、 hH 為腰部高度、 fH 為足
部步行的高度、 sT 為跨步的週期。 
 
2.4 平面步行週期規劃 
     
 9
對 )(' tX h 及 )(' tZh 做以下的修改： 
)()(' tXtX hh =            (2.5) 
φtan)()()(' tXtZtZ hhh +=         (2.6) 
其中 
S
H=φtan 。           (2.7) 
 
2.6 階梯步行週期規劃 
     
階梯步行週期如圖2.6所示，階梯步行過程與平面步行相似，整個靜態步行
週期同樣可以分成五個部份。開始時為雙腳支撐，重心落在雙腳之間（如圖
2.6(a)）。考慮考慮 zy − 平面上4個自由度，調整人形步行機器人的姿態，使系統
重心落於支撐腳足部範圍內（如圖2.6(b)）。接下來考慮 zx − 平面上6個自由度，
階梯步行時游移腳提供向前及向上行走的步行姿態，游移腳在落地時為雙腳支
撐，系統重心落於兩腳之間（如圖2.6(c)、(d)），在完成 zx − 平面步行週期後回
復至之前的設定姿態，將雙腳所有馬達設為初始的狀態（如圖2.6(e)），再次進
行下個循環動作。根據左右腳行走為對稱的狀態，所以左右腳皆依循此種步行方
式反覆行走。 
 
(a) (b) (c) (d) (e)
 
圖2.6 階梯步行週期 
 
2.7 旋轉步行週期規劃 
 
本報告中使用的人形步行機器人(KHR-1)中雙足部份沒有繞著Z軸旋轉的自
由度，無法產生旋轉並改變方位，所以在平面步行時也只能朝著固定的方向前進
或後退。為了讓人形步行機器人有旋轉的運動模式，使用地面與足底板之間的摩
擦力改變行進的方向。旋轉步行週期的整體流程如圖2.7所示。開始時為雙腳支
撐，重心落在雙腳之間（如圖2.7(a)），考慮考慮 zy − 平面上4個自由度，將人形
步行機器人作小角度的偏移，使系統重心落於支撐腳的足部範圍內，同時讓游移
腳向前跨出（如圖2.7(b)）。游移腳在落地時回復為雙腳支撐，並將重心偏移回雙
 11
第三章 立體視覺與影像處理 
 
本章節說明立體視覺的方法，其中包含透視成像原理及目標角度的估算，最
後利用目標物的距離評估，計算出目標物與攝影機之間的距離。接著介紹影像處
理的部份，包含影像的擷取、彩色空間轉換、中值濾波器、形態學、邊緣偵測、
圓形偵測及影像分割等。 
     
3.1  立體視覺 
 
計算物體在影像中的深度是電腦視覺的重要課題之一，具備深度感知（depth 
perception）能力的電腦視覺系統即稱為立體視覺系統。攝影機對目標物擷取影
像，將影像經過影像處理步驟，最後可框選出目標物的中心位置，藉由目標物角
度估算與目標物距離評估的方法，可求出目標物在空間中與攝影機的相對位置。 
 
3.1.1  透視成像原理 
 
首先說明將物體三維的點投影到影像平面，用以觀察三維世界成像在影像平
面上的情況。其成像的基本模型如圖 3.1所示，圖中 ),,( zyx 為影像感測器座標系
統，而 ),,( ZYX 為實體世界座標系統。假設感測器座標系統與實體世界座標系統
重合。在影像感測器座標系統 ),,( zyx 中，假設成像平面在 ),( yx 上，而光軸沿 z
軸，且設成像平面的中心在原點處，透鏡的焦點在座標 ),0,0( f 處， f 是透鏡的
焦距。p ),,( 111 ZYX 是世界座標中的任一點，並假設此點所在位置在透鏡前方
)( 1 fZ > 。實體座標上的點 p ),,( 111 ZYX 與投影到成像平面上的點 ),( 11 yx 所呈現
的關係如下： 
 
1
1
1
11
Zf
X
fZ
X
f
x
−=−−=          (3.1) 
 
1
1
1
11
Zf
Y
fZ
Y
f
y
−=−−=          (3.2) 
 
上兩式中的 X和 Y前的負號表示影像點實際上是倒置的。 
 13
心點的距離為 b。已知視野的角度為ϕ，假設 'BB 與影像中心線的夾角為δ ，由
於 L是定值，因此： 
2
cotϕaL =            (3.3) 
δcotbL =            (3.4) 
將(3.3)式代入(3.4)式，可得 
⎟⎠
⎞⎜⎝
⎛= −
2
cotcot 1 ϕδ
b
a           (3.5) 
其中 a與 b皆以像素為單位。由(3.5)式可估算出目標物在 X與 Y方向距離中心
線的夾角。 
 
視野的基準點
CCD感測器
中心線
L
a
b
B
B
’
A
A’
2
ϕ
δ
 
圖 3.3 角度估算示意圖 
 
3.1.3  目標物距離評估 
 
在現實的場景中，單靠一個攝影機雖然可以經由影像處理的方法將特定目標
物找出來，但是將一個三維場景映射到一個影像平面是一個多對一的轉換，也就
是由一個影像點可能對應到多個世界點的位置，無法實際估測到目標物中心點離
攝影機的實際位置。但由於攝影機跟目標物都有共同的基準平面（地面）如圖
3.4所示。可藉由攝影機裝設的高度（H）、攝影機的視角中心線和地平面間的角
度（θ）以及目標物與攝影機之間的角度(δ )，就能估算攝影機與目標物之間的
相對關係( YX , )，其關係式如下： 
θcotHd =            (3.6) 
dX =             (3.7) 
δtandY =            (3.8) 
 
 15
θ
h
d
X
Z
h1
中心
線
 
圖 3.6 目標物距離評估(目標物具有特定高度時) 
 
3.2  影像處理 
 
本報告透過 USB 串列傳輸介面，將經由攝影機拍攝後的影像傳送到電腦主
機處理。影像處理是利用電腦對影像做計算，使經過處理後的影像能夠提供必要
的資訊，以便我們能利用這些資訊來解決問題。本文採用的影像處理步驟如圖
3.7所示，可以分為三個階段：影像前處理、目標物偵測、框選目標物。 
影像擷取 彩色空間轉換 中值濾波器 形態學
邊緣偵測圓形偵測或影像分割框選目標物
影像前處理
目標物偵測
目標物
位置
影像
擷取
圖 3.7 影像處理流程圖 
 
3.2.1  影像擷取 
 
影像擷取流程圖如圖 3.8所示，電腦視訊攝影機為整個系統的視覺感知器，
將所拍攝的動態彩色影像資訊，透過 USB串列傳輸介面，轉換成一張659X494個
像素點大小，每個像素點有 R（Red）、G（Green）、B（Blue）三原色所組成。
其中每個像素點的資訊大小為 24位元，最後將影像資訊傳送到電腦主機處理。 
 17
色調(H)：「全彩」的屬性（紅、綠、藍、橘、黃等）。 
飽和度(S)：彩色被白色稀釋的程度。色彩中含有的白色越多，飽和度便越低。 
明暗度(V)：明暗的程度。亮的顏色明暗度高，暗的顏色明暗度低。 
 
這是一種較直覺的的色彩描述方法，由於明暗度從色彩資訊中獨立出來，因
此很適合用於影像處理。這個色彩模型畫起來是一個錐形如圖 3.10所示。表面
上的任何一點都代表一種完全飽和的顏色。因此飽和度便是由中心軸至表面的相
對距離。 
紅
黑
白
黃綠
青綠
藍 紫紅
飽和度
??
度
 
圖 3.10 HSV彩色空間 
 
RGB和 HSV的關係如下所示： 
⎩⎨
⎧
>−°
≤=
GBifH
GBifH
H
1
1
360
       (3.14) 
其中 
( ) ( )[ ]
( ) ( )( )⎪⎭
⎪⎬
⎫
⎪⎩
⎪⎨
⎧
−−+−
−+−= −
BGBRGR
BRGRH
2
1
1
5.0cos      (3.15) 
( ) ( )
( )BGRMax
BGRMinBGRMaxS
,,
,,,, −=        (3.16) 
( )
255
,, BGRMaxV =           (3.17) 
 19
A B
1 2 3 4 5
1
2
3
4
5
6
7
1
1
0
0
-1
-1
 
圖 3.12 像素集合 A與 B(膨脹) 
膨脹的結果如圖 3.13 所示，膨脹後有放大的效果。在平移圖示中，灰色方
塊代表物體的原始位置。在這個範例中， { })1,1(),1,1(),1,1(),1,1(),0,0( −−−−=B ，這
些是用來平移 A的座標。 
 
1 2 3 4 5
1
2
3
4
5
6
7
1 2 3 4 5
1
2
3
4
5
6
7
1 2 3 4 5
1
2
3
4
5
6
7
1 2 3 4 5
1
2
3
4
5
6
7
1 2 3 4 5
1
2
3
4
5
6
7
1 2 3 4 5
1
2
3
4
5
6
7
A(0,0) A(1,1) A(-1,1)
A(1,-1) A(-1,-1) BA⊕
 
圖 3.13 膨脹 
 
(2) 侵蝕 
 
假設有兩個像素集合 A 與 B 如圖 3.14，使用 B 來侵蝕（erosion）A，可表
示為 AΘB，定義為： { }ABwBA w ⊆=Θ : 。表示說使用 B 侵蝕 A的結果，是由像
素點 ),( yxw = 構成，w要滿足 wB 在 A 之中。進行侵蝕時，首先將 B 置於 A 之
內，找到所有契合的地方，然後標記相對應的 B 原點 )0,0( 所在位置的像素。這
些像素點的集合便形成侵蝕如圖 3.15所示。 
 21
ffj
y
fi
x
ff yx ∇+∇=∂
∂+∂
∂=∇        (3.18) 
此梯度向量的大小： 
( ) ( ) fffff yxyx ∇+∇≅∇+∇=∇ 22       (3.19) 
 
(1) Sobel 
 
用 Sobel測邊算子的面罩（Mask）以迴積的方式作用在影像上完成測邊的工
作時，其對應的面罩有兩個。一個為 x方向（圖 3.16a），另一個為 y方向（圖
3.16b）。最後對梯度向量的大小取一個閥值進行比較，大於閥值之像素設為 1，
成為影像中物體的邊緣像素。反之，小於閥值之像素設為 0，成為影像中背景的
像素。 
 
-1 -2 -1
0 0 0
1 2 1
-1
-2
-1
0
0
0
1
1
2
(a)測x方向的灰階變化 (b)測y方向的灰階變化
 
圖 3.16 Sobel測邊算子 
 
(2) Prewitt 
 
另一個很類似 Sobel測邊算子的測邊方法叫 Prewitt算子，其對應的 x方向的
面罩如圖 3.17 (a)所示，而其對應的 y方向面罩如圖 3.17(b)所示。 
 
-1 -1 -1
0 0 0
1 1 1
-1
-1
-1
0
0
0
1
1
1
(a)測x方向的灰階變化 (b)測y方向的灰階變化
 
圖 3.17 Prewitt測邊算子 
 
(3) 影像相減 
 
 介紹完 Sobel、Prewitt的邊緣偵測法後，接著說明一種較簡單的方法，可對
於經過二值化後且背景較單純的影像來做邊緣偵測。架構流程如圖 3.18所示，
先將二質化後的影像（Image1）經過侵蝕的處理得到 Image2，再將 Image1與
Image2進行影像相減，可得到物體明顯的輪廓，如圖 3.19中 Image3所示。 
 23
圓形是否存在。如果候選圓的得票率過低，則需要找新的候選圓重新計算。得票
率超過預設的門檻值，此時的候選圓即為影像中真正的圓，用投票的機制可以有
效的找出可能存在的圓形，減少執行時間。 
 
在邊點集中誰機
選擇四個邊點
輸入影像的
邊點集
找出由3個邊點所
構成的的圓(稱為
候選圓)
 若大多數的邊點都在
候選圓上
是
找到真正的圓
隨機抽取邊點判斷
是否在候選圓上
計算第4個邊點是否
在候選圓上
否
否
是
 
圖 3.20 圓形偵測的架構流程圖 
 
 25
1 1
1
2
3
3 3 3
3
4 4 5
 
圖 3.22影像分割 
 
 
 
 27
     
說明實現人形步行機器人步行軌跡控制器，主要的控制器為Microchip公司生產
製造 dsPIC30F4012微控制器，以及最多可同時控制 24組伺服馬達的 RCB-1控
制器。 
 
4.2.1  dsPIC30F4012微控制器 
 
dsPIC30F4012微控制器實體圖如圖 4.2所示，此微控制器為整體控制系統的
核心，利用微控制器本身具備完善的周邊架構，例如：類比轉數位模組、UART
串列傳輸介面、RS-232 串列傳輸介面、外部中斷模組…等，實現整個人形機器
人的追蹤控制架構。dsPIC30F4012 微控制器周邊控制模組的方塊圖如圖 4.3 所
示，微控制器的系統架構圖及其功能在下列逐一介紹。 
 
 
圖 4.2 dsPIC30F4012 控制板實體圖 
dsPIC30F4012 
控制器
類比轉數位
模組
外部中斷
模組
LED顯示模組
ICD2資料
傳輸介面
RS-232資料
傳輸介面
UART資料
傳輸介面
 
圖 4.3 dsPIC30F4012 控制板周邊控制模組方塊圖 
 
    dsPIC30F4012微控制器是由美國Microchip公司所生產具備數位信號控制器
功能 16位元微控制器，dsPIC30F4012微控制器的系統架構如圖 4.4所示為，主
要的特點有： 
z 採用改良式的哈佛式架構，程式執行速度可達 30MIPS。 
 29
 
圖 4.4 dsPIC30F4012微控制器系統架構圖 
 
 
圖 4.5 dsPIC30F4012微控制器的接腳圖 
 
 
4.2.2   RBC-1控制器 
 31
常用的控制命命如下： 
(1) Send RCB-1 Servo Position To Robot（人形步行機器人各馬達位置的寫入） 
可直接控制各馬達至指定位置，伺服馬達的轉動速度有 0到 7八個等級可供
選擇。 
(2) Set RCB-1 Home Position（人形步行機器人初始姿態的設定） 
Home Position為 RCB-1電源開啟時人形步行機器人的初始姿態。 
(3) Set RCB-1 Motion Position Count（設定各個Motion中       Position的數目） 
1個Motion最多可儲存 100個 Position，共有 40個Motion可使用。 
(4) Set an RCB-1 Motion Position（設定Motion內 Position中各馬達的位置） 
使用 Motion規劃時，依序寫入各個 Position中每個馬達的位置，此命令是
將資料寫入 EEPROM，對於目前的輸出沒有影響。Position的值是需要從 0
開始連續使用下去的，不可有空格(未寫入)的情況，若有未寫入的 Position
時，會發生動作異常的情形。 
(5) Play an RCB-1 Motion（執行所選擇的Motion） 
使用此命令後，會將所選擇的Motion內所有 Position依序執行完畢。 
 
4.3   感測器 
 
機器人為了適應不同環境及從事各種工作時，例如：如追蹤鎖定特定目標
物，避開障礙物到達指定位置，步行上下階梯或斜坡...等，需要用到許多的感測
系統接受外部的資訊，以避免碰觸到障礙物而使機器人跌倒。感測器有如人的感
覺器官，包括視覺、觸覺、聽覺，機器人有了這些感測器就能將接收到的資訊（如
物理量、化學量、生物量等）轉換成便於利用的各種電訊號（如電壓、電流、頻
率、脈衝等）。以滿足訊息傳輸、處理、顯示、控制的要求。 
 
4.3.1  影像感測器 
影像感測器目前在機械人視覺和自動化生產線上得到了廣泛的應用，影像感
測器是採用光電轉換原理，獲取檢測對象的平面光學影像，並將其轉換為電子影
像訊號成為電腦能接收和分析的數據，從而達到對操作對象進行識別的目的。所
使用的影像感測器是由 Panasonic公司出產，型號為 GP-KR651US的 CCD網路
攝影機，影像感測器的實體圖如圖 4.8所示。表 1為 GP-KR651US之主要規格。 
 
Focus View angle Image device Pixels 
Manual 100mm to infinity 51度(H),38度(V) 1/4-inch CCD 659X494 
表 1 CCD影像感測器 GP-KR651US之主要規格 
 33
4.3.3  壓力感測器 
 
壓力感測器實體圖如圖 4.10所示，是利用半球型橡膠凸起部分來感測壓力，
那是一種曲面形狀橡膠材質(NBR)，可連續檢測壓力強弱並檢出微小的壓力接
觸。藉由感測壓力的大小來改變導線接觸端子兩端的電阻值，所偵測到的壓力越
大其端子兩端的電阻值越小，反之，端子兩端的電阻值越大。將壓力感感測器放
在人形機器人的足底，可作為人形機器人兩足底部的壓力接觸感測器，可計算足
部著地時檢出及 ZMP 。壓力感測器其特性如下： 
（1）最大荷重 3.0kgf。 
（2）推薦荷重 2.0Kgf。 
（3）無負荷抵抗值 40MΩ以上。 
（4）最大負荷抵抗值 500Ω以下。 
 
(a) (b)
 
圖 4.10 壓力感測器實體圖與示意圖 
 
 35
 
圖 5.2 BCB之操作介面 
 
5.2  人形步行機器人的步行控制流程 
 
說明在影像追蹤系統和階梯步行時的人形步行機器人控制流程，並以連續動
作圖的方式呈現實驗結果。 
 
 
5.2.1  影像追蹤系統 
 
影像追蹤系統為利用安裝在人形步行機器人頭部上的攝影機擷取影像至 PC
端，藉由影像處理將移動目標物從複雜背景中分離出來，並找出目標物的中心
點，最後利用立體視覺理論及時計算目標物的深度，藉由 PC端送出控制訊號讓
機器人與目標物保持固定距離。 
 
圖 5.3 影像追蹤系統 
 
本系統所使用的目標物為黃色的圓球，將圓球放置在遙控移動機器人頂端，
成為可移動的目標物，遙控移動機器人的正視圖與側視圖如圖 5.4所示。 
 37
軌跡設定： 
人型步行機器人之平面步行是沿著已規劃好的軌跡前進，而軌跡規劃之前則
須先輸入步行的跨距及步行的週期，然後再進行軌跡規劃。有了步行的跨距，便
可得知在單腳支撐時腳掌的初始位置及終點位置，以及腰部的起始位置與終點位
置，再將起始位置及終點位置分成數段區間，並在每段區間的結束點給一適當的
位置作為軌跡點。而馬達的運動量便是從各個軌跡點利用反運動方程式求得，在
每段區間馬達的運動軌跡是沿著已計算好的擺線輪廓曲線前進。 
 
步行軌跡設定的流程圖如圖 5.6所示，設定的步驟依序如下。首先設定步行
軌跡的相關參數，包括腰部前進的距離( hX )、足部步行的距離( fX )以及步行的
週期（Ts）。接著產生腰部的步行軌跡以及足部的步行軌跡，藉由給定的腰部
與足部軌跡利用解反運動學求出 zx − 平面上 6 個馬達的旋轉位置。接著改變
zy − 平面上 4個馬達的旋轉位置如圖 5.7所示，調整姿態讓系統重心落於支撐腳
足部範圍 (單腳支撐相模式)或落於兩腳之間(双腳支撐相模式)。 
 
設 定 步 行 距 離 及
步 行 週 期
解 反 運 動 學
產 生 腰 部 的 軌 跡
產 生 足 部 的 軌 跡
座 標 轉 換
重 心 偏 移
  
圖 5.6 產生步行軌跡的程式控制流程 
 
 39
(a) (b) (c) (d) (e)
(f) (g) (h) (i) (j)
 
圖 5.9 人形步行機器人於平面步行時之實驗結果(側視圖) 
 
2. 原地旋轉 
人形步行機器人實際於原地旋轉之結果如圖 5.10 及圖 5.11。(a)～(e)為一個
完整的旋轉週期，(f)～(j)為另一個旋轉週期，每次的旋轉週期會讓人型步行機器
人旋轉 10度，每個旋轉週期約費時 5秒。 
 
(a) (b) (c) (d) (e)
(f) (g) (h) (i) (j)
圖 5.10 人形步行機器人原地旋轉之實驗結果(正視圖) 
 41
中距離示意圖如圖 5.13 所示，人形步行機器人雙腳距離階梯一段特定距離
(d)，並使用人形步行機器人腳底的紅外線反射器，先以紅外線發射器以固定頻
率發送紅外線不可見光，所發射的不可見光經由階梯反射至紅外線感測器。依據
階梯與感測器距離的遠近會得到不同的類比電壓值，再將輸出電壓傳回至
dsPIC30F4012 端，根據所設定的電壓門檻值來偵測階梯位置，並讓人形步行機
器人靠近至階梯邊緣，並進入下個階段。 
d  
圖 5.13 中距離示意圗 
 
近距離示意圖如圖 5.14 所示，當機器人步行至階梯邊緣前，開始送出階梯
步行軌跡給人形步行機器人，利用裝在腳底的壓力感測器來偵測腳底的受力變
化。由於壓力感測器會受外力影響而改變其電阻值，搭配分壓電路來改變輸出的
電壓值，再將電壓傳回至 dsPIC30F4012 端，根據電壓值的變化來判斷出階梯的
實際高度。 
 
d  
圖 5.14 近距離示意圗 
 43
藉由紅外線感測器偵
測是否到達階梯
系統初始化
送出平面步行軌跡給
人形機器人
程式開始
軌跡設定
讀取PC端送來的
控制訊號
機器人初始姿態
送出階梯步行軌跡給
人形機器人
程式結束
 
圖 5.16 階梯步行之控制流程 
 
 
實驗結果： 
人形步行機器人實際於階梯步行之實驗結果如圖 5.17。(a)～(h)為完整的階
梯步行週期，階梯高度 1.7cm，每階梯寬度 11cm，每次的步行週期約費時 14秒。 
 45
 
圖 5.18 影像追蹤系統的影像處理操作視窗介面 
 
影像追蹤系統的影像處理流程圖如圖 5.19所示。將一張未處理過彩色的原
始影像，透過彩色空間轉換並限制其顏色閥值，同時進行顏色的篩選使其成為二
值化的影像，這樣可濾除多餘的背景留下特定顏色的目標物。再經由中值濾波器
濾除大部分的雜訊。靈活運用形態學中的膨脹及侵蝕可讓影像中的目標物更加完
整，並偵測出目標物的外表輪廓。由於透過色彩空間轉換後的二值化影像，會被
環境中的光線所影響，會讓目標物所在的區塊顯得有些破碎，故先進行 N次擴
張運算，讓區塊中破碎的地方被合併。在進行 )1( +N 次的侵蝕運算，將所得到
的影像與先前經由中值濾波器的影像相減，便可得到目標物的輪廓。最後利用圓
形偵測的方法，求出圓形目標物的半徑與圓心。 
 47
(a) (b)
圖 5.20 (a)原始影像(b)彩色空間轉換後的影像 
 
 
但轉換後的影像會受光線強度的影響，使得目標物所在的區塊顯的有些破
碎，我們可將區塊中破碎的部分視為雜訊，接著利用中値濾波器的特性，可以明
顯的改善雜訊的部分，改善後的結果如圖 5.21(c)所示。雖然中值濾波器可以改
善大部分雜訊，但還是有部份的破碎無法消除，剩下的部分就可以利用型態學中
的擴張算子來改善，其結果如圖 5.21(d)所示。進行了 N次的擴張運算，最後將
目標物區塊內的破碎填滿。 
(c) (d)
 
圖 5.21 (c)中値濾波器後的影像(d)擴張 N次後的影像 
 
將目標物擴張 N次後的影像明顯與原始目標物大小不合，故需再將影像侵
蝕 N次才能滿足原始大小。接下來要進行目標物輪廓的偵測。由於我們先前有
經過色彩空間去除複雜背景，並改善目標物的雜訊，所得到是張目標物很明顯的
二值化影像。故只要經過 1次侵蝕運算，便可得到一張目標物區塊比原始目標物
區塊還小的影像，其結果如圖 5.22(e)所示。將侵蝕後得到的影像與先前經由中
值濾波器的影像相減，便可得到目標物的輪廓，其結果如圖 5.22(f)所示。 
 
 
 49
 
圖 5.24 階梯步行的影像處理操作視窗介面 
 
階梯步行的影像處理流程圖如圖5.25所示。首先擷取階梯的影像，透過彩色
空間轉換並限制其顏色閥值，同時進行顏色的篩選使其成為二值化的影像。再經
由中值濾波器濾除雜訊。運用形態學中的擴張運算進行N次，讓階梯區塊中破碎
的地方被合併，使影像中的目標物更加完整。利用影像分離的方法為每一塊的階
梯做上標記，藉由判斷影像中的標記數來找出階梯的階數。進行 )1( +N 次的侵
蝕運算，將所得到的影像與先前經由中值濾波器的影像相減，得到階梯的輪廓。
最後找出最下面一階的階梯邊緣，利用目標距離評估的方法找出人形機器人與階
梯的距離。 
 51
(a) (b)
 
圖 5.26 (a)階梯實體影像(b) 彩色空間轉換後的階梯影像 
 
但經由彩色空間轉換後的影像會受光線強度的影響，使得階梯所在區塊顯的
有些破碎，將區塊中破碎的部分視為雜訊，利用中値濾波器的特性可以明顯的改
善雜訊的部分，改善後的影像如圖 5.27(c)所示。利用型態學中的擴張算子將樓
梯區塊內的破碎填滿，進行了 N 次擴張運算後的結果如圖 5.27(d)所示。利用影
像分離的方法為每一塊的階梯做上標記，藉由判斷影像中的標記數來找出階梯的
階數。 
 
(c) (d)
 
圖 5.27 (c)中値濾波器後的階梯影像(d) 擴張 N次後的階梯影像 
 
接著使用型態學中的侵蝕算子進行了N+1次的侵蝕運算，其結果如圖5.28(e)
所示。將得到的影像與先前經由中值濾波器的影像相減，便可得到階梯中每一階
的階梯輪廓，結果如圖5.28(f)所示。最後找出最下面一階的階梯邊緣，利用目標
距離評估的的方法找出人形機器人與階梯的距離。 
 
 53
第六章 結論與建議 
 
6.1 結論 
 
本報告主要的研究在發展具有影像控制之小型人形步行機器人，其主要的研
究成果與貢獻概述如下： 
(1) 使用 dsPIC30F4012微控制器備完善的周邊架構，例如：UART串列傳輸介面、
RS-232串列傳輸介面、外部中斷模組等等，實現人形步行機器人的軌跡控制，
其中包含平面步行週期規劃、階梯步行週期規劃與旋轉週期規劃。 
(2) 利用安裝在人形機器人頭部上的攝影機擷取影像，使用影像處理與立體視覺來
計算目標物的距離，藉由所設定的平面步行軌跡規劃，讓人形步行機器人達到
影像追蹤的效果。 
(3) 完成人形步行機器人之階梯步行軌跡規劃，利用壓力與紅外線感測器的輔助，
使人形步行機器人感測到階梯的實際高度與深度資訊，讓人形步行機器人順利
登上階梯。 
 
 
6.2 建議 
 
本研究完成了小型人形步行機器人的靜態步行軌跡規畫，仍有許多發展空
間，在此提出幾項改進建議： 
(1) 可在各軸加裝電位計(potentiometer)，作為角度及位置的回授裝置，可修正人
形步行機器人行走時的即時狀態，更準確地控制人形機器人。 
(2) 當人形步行機器人行走速度加快時，需要考慮到轉動慣量的作用，人形步行
機器人動態步行的穩定度可以使用零力矩點(zero moment point)為判斷準則。 
(3) 報告中使用的圓球目標物是屬於易於偵測的物體，未來希望能改善報告中的
演算法，藉由搜尋不同目標物的特徵值，預期達到能追蹤各種的特定目標物。 
 
 
 
 
 
