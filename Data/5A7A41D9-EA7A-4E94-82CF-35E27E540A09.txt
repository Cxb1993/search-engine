制器採用的核心處理器，改變傳統常用的控制晶片，選用美國德州儀器(TI)的 OMAP 晶片，
該晶片由兩部分組成，一個為 DSP(TMS320C5409)，其具有高速運算能力的 CPU，另一個
為適用於週邊控制的 ARM7(ARM7TMDI)，此控制器不僅功能完善且擴充性佳，對未來產
品若要進行擴充以配合市場上的須求，系統無須做太大的變動，便可達到市場上的訴求。 
 
人才培育成果說明： 
一、電子電路暨電路板的設計概念及測試，達到理論與實務的結合。 
二、機電整合/精密控制理論與實務之結合。 
三、學會嵌入式系統設計及一個完整系統的開發流程。 
四、學會如何測試一台機器是否有問題，並尋找出錯誤為何並加以修正。 
五、學會如何看懂晶片之使用規格書或資料手冊。 
六、藉由電子零件的備料過程須與電子公司接洽，學習到一些業務上的基本概念。 
七、研發記錄及程式的撰寫能力，英文的閱讀能力。 
八、了解業界之處事態度及方法。 
 
技術研發成果說明： 
圖一為本計畫研製出的打刻機控制器實體圖，現階段已可藉由並列埠傳送打刻參數至
控制器而驅動打刻機，相關動作如針頭回原點、原點校正、連續打刻或緊急停機都可達到
預期的目標。圖二為電腦端透過並列埠傳送 A 字相關線段參數至控制器令機台刻出 A 字的
成果圖。圖三為利用圖 A 的控制器刻出的 B 字。圖四為綜合應用的實刻圖。 
 
 
圖一 打刻機控制器 
 
 
圖二 實刻 A 字圖 
 
 
圖三 實刻 B 字圖 
 
 
 
圖四 綜合實刻圖 
 
 國科會補助提升產業技術及人才培育研究計畫成果精簡報告 
高速打刻機核心技術開發 
The development of kernel techniques for high-speed marking machine 
計畫編號：NSC 94-2622-E-035 -013 -CC3 
計畫主持人：逢甲大學 自動控制工程學系 主持人 林育德
摘要 
本計畫主要為研發一個打刻機控制
器，在控制器的設計上參考市面上既有的性
能，製作一個全新的打刻機控制器，此控制
器不僅可應用於電腦式打刻機，在核心系統
不變下，只要更改控制器的 I/O 界面電路，
作業系統與其相關參數設定，便可操作於單
機式的機型。本控制器採用的核心處理器，
改變傳統常用的控制晶片，選用美國德州儀
器(TI)的 OMAP 晶片，該晶片由兩部分組
成，一個為 DSP(TMS320C5409)，其為具有
高速運算能力的 CPU，另一個為適用於週邊
控制的 ARM7(ARM7TMDI)，此控制器不僅
功能完善且擴充性佳，對未來產品若要進行
擴充以配合市場上的須求，系統無須做太大
的變動，便可達到市場上的訴求。 
Abstract 
This project is to design the controller of 
a marking machine. Such controller can be 
applied to not only the computer-based 
marking machine but also the embedded 
marking machine with the corresponding I/O 
interfacing circuit and the operation system 
being replaced. Contrary to the conventional 
design, the OMAP(Open Multimedia 
Application Platform) chip manufactured by 
Texas Instrument Inc. is adopted for the 
controller design in this project. The OMAP 
chip consists of two subsystems, one is 
ARM7(ARM7TMDI) and the other one is a 
DSP(TMS320C5409) system. 
Besides, it also supports bountiful 
peripheral interfaces (e.g. RS232, USB and 
Internet) and miscellaneous functions (e.g. 
CCD and TFT display). Such characteristics 
make the marking machine more flexible and 
extensible with the benefit of much high 
marking speed. The related products using 
such controller would also be more 
competitive in the market. 
1、前言 
 打刻機(Marking Machine)[1]如圖 1 所
示，即用來將某些特定或重要產品刻上識別
字、編號或圖形，其優點為產品上的文字或
圖樣不僅不易更動，也不會因時間悠久而模
糊或消失，國內外的產品舉凡引擎編號、汽
車零件編號、金屬製品、金飾、半導體零件、
陶瓷及電子零件等均可看到其應用的例
子。關於打刻機種類不勝枚舉，但大致上可
分類為雷射雕刻機、CNC 電腦式打刻機及
CNC 單機式打刻機三種。 
 在國際市場上的 CNC 打刻機，現階段
的技術已達到單機之作業模式，但是由表 1
中所列之目前市面上 CNC 打刻機存在的缺
點，並為配合目前的技術主流，希望達成之
目標，研發出一種全新的控制器，研發示意
如圖 2 所示，除了改善舊有問題外，更希望
在控制器之核心架構固定下，更改控制器的
I/O 界面電路及其操作系統，便能應用於
CNC 電腦式或單機式的打刻機，因此本計
畫若能實現，在現今市場上將具備相當強大
的競爭力。 
版作業的依據，多加這兩項輸出信號能讓新
開發的控制器功能更加完善。 
圖6為控制器輸出電路圖示意圖，信號
源有XYR三軸及其它控制信號。為了能順利
驅動XYR軸的步進馬達，在週邊電路上串接
一顆型號為SN74LVC4245A[5]將3.3V的信
號轉換為5V的電壓轉換IC，便可以排除可
能因電位不同而造成的誤動作。而在
SN74LVC4245A輸出端上，並無融入光耦合
器的概念，因為在驅動器(EXD2020M-N)[6]
內部迴路上就有光耦合器的設計，故在輸出
電路上，無須再串接光耦合器來免除誤動作
的可能性。電磁閥的信號相較於XYR三軸的
信號，它須要長時間的ON/OFF切換及較大
的驅動電流，故在電路中加入達林頓電路
(ULN2003A)[7]來提高OMAP的輸出電流，
但因ULN2003A為反向元件，所以在
ULN2003A前級加入反向器(74LS04)[8]。 
圖6中的電晶體(BU406)[9]是用來控制
氣閥ON/OFF的開關電路，而在BU406基極
端與光耦合器之間的可變電阻是調節氣閥
的氣流大小，打刻結束與打刻暫停的輸出信
號，採用乾接點的型式，常態下為光耦合器
關閉，當OMAP輸出這兩種信號時，光耦合
器便會導通而輸出打刻結束與打刻暫停的
信號。 
2.1.3 並列埠電路設計 
本控制器擁有的USB及RS232傳輸界
面，若對單機式機型而言，這兩種傳輸方式
即適合也夠快，但若以電腦式的機型來說，
機台常操作於即時的作業環境之下，電腦與
控制器之間勢必會有大量的資料流動，此刻
的USB或RS232傳輸方式勢必不敷使用，為
了達到高速打刻訴求，在控制器上加入並列
埠的傳輸界面是有其必要性。以圖1的機型
來看，機台系統架構如圖7，在電腦上利用
如圖8[10][11]所示的編輯軟體將欲打刻的
內容編輯完成後透過並列埠傳送到控制器
做輸出。 
當控制器操作於電腦式打刻機，所有關
於打刻機的輸出信號，都是由電腦端傳送至
控制器上，因此機台能否順利作業，電腦與
控制器之間溝通成功與否成為關鍵，若控制
器無法正確接收電腦端的信號，即所謂的交
握(Handshaking)出了問題，連帶XYR運動三
軸的信號都會出錯。本研究改變舊型控制器
上由HD74LS373[12]與HD74LS138[13]的組
合來做為通訊界面，選用本身既具有交握能
力的82C55A[14][15]做為控制器與電腦端
資料傳輸界面，圖9為並列埠電路示意圖。 
2.2 軟體設計 
2.2.1 控制器之通訊協定 
當控制器操作於電腦式打刻機時，機台
能否正常工作，電腦與控制器之間溝通成功
與否甚為關鍵，即所謂的交握。為了能使電
腦與控制器之間能做有效的交握，本研究採
用可規劃週邊介面元件INTEL82C55A，並
規劃82C55A操作於MODE 1下，使控制器與
電腦之間做有效的交握，在這種情況下，
82C55A的I/O可規劃為輸入或輸出埠且均
具有鎖定功能，以確保電腦與控制器之間資
料傳送時不會出錯或遺落。 
2.2.2 控制器通訊協定時序圖 
本計畫所研發的打刻機控制器主要應
用於電腦式打刻機上，故電腦端與控制器之
間的資料傳輸速度與穩定度格外重要，因此
本研究利用並列埠搭配 82C55A與控制器來
做通訊，圖 10 為 82C55A 被設定工作在
MODE1 下，控制器接收電腦端資料的時序
圖。在接收電腦端所送過資料的之前，首先
控制器須將 OMAP 做 I/O、記憶體、時脈等
做初始化工作，其次規劃 82C55A 工作於
MODE1，最後再送出令埠 A 之 為 H
的動作給 82C55A，這三個動為控制器與電
腦端做通訊前的必要過程。 
INTE
在圖 10 中， STB為電腦端傳送出給
82C55A 信號線，當 STB由 H 降為 L 時，表
示電腦端已將打刻相關參數備妥在 82C55A
埠 A 的輸入緩衝器內，在 82C55A 收到 STB
為 L 時，經一小段足夠令 82C55A 埠 A 輸
入緩衝器由空至滿的時間後，此時 82C55A
自己藉由 IBF 送出 H 的信號至電腦端，告
知電腦端現於 82C55A 埠 A 內的緩衝器已
滿，請勿再送資料。 
當電腦端測知 82C55A 的 IBF 接腳為 H
時，電腦端就強制令 STB的 L 降回 H，資料
隨即被栓鎖於 82C55A埠A輸入緩衝器裡等
待控制器的讀取。此刻的 STB與 IBF 正處於
別在即時的作業環境下，針頭回原點這種功
能更顯重要，故每當打刻機重置或每完成一
次的作業時，系統就該有回原點或預設原點
的功能，僅管機台被設定為連續打刻的模
式，即使換上不同的打刻銘牌，打刻後的圖
樣或文字其位置或大小都不會出現誤差。 
3、結果 
本計畫已成功研製出新型之打刻機控
制器，圖 18 為該控制器實體圖，現階段已
可藉由新型控制器透過並列埠傳送打刻參
數至控制器而驅動打刻機，相關動作如針頭
回原點、原點校正、連續打刻或緊急停機都 
可達到預期的目標。圖 19 為電腦端透過並
列埠傳送 A 字相關線段參數至控制器令機
台刻出 A 字的成果圖，圖中共有 9 個 A 字，
每個字 A 字都是由固定的線段函式組成，
但在圖中會造成每個 A 字的大小都不一
樣，差別僅在於每個 A 字的線段函式所須
脈波量都不同如此而以，在圖中很明顯看出
不論 A 字放大或縮小，因其組成的線段函
式都是直線及斜線，所以不會有失真的情況
發生。 
圖 20 為舊型控制器實體圖，圖 21 為利
用舊型控制器刻出三個大小不同的 B 字，當
B 字愈大時弧線就會失真，這是因為舊型機
台對每個字所選取的線段都是固定的，並不
會因為字型的放大或縮小後而改變選取的
線段，才會造成弧線的失真。圖 22 為利用
新型控制器刻出八個半徑不同大小的圓，圖
中可很明顯的看出，愈大的圓由於所取的控
制點沒有相對增加，故當圓愈大時，弧線失
真的情況就愈明顯。 
圖 23為新型控制器刻出由 24個控制點
所組成字高 1 公分字寬 0.8 公分的 B 字實體
圖。圖 24 為圖 23 放大 2 倍後的 B 字，但選
取了 50 個控制點，故圖形沒有失真。圖 25
為圖 23 放大 4 倍後選取 80 點控制點的 B
字，因此相較於圖 23 的結果，圖 25 所刻出
來的 B 字也沒有失真的情況出現，論證了本
計畫採用的線段函式法確實可改解決舊型
控制器在做圖形放大或縮小造成的失真。 
4、結論 
本計畫主要是在研發一個全新的打刻
機控制器，現階段已可透過並列埠的傳輸方
式來驅動打刻機，且都可達到預期的成果，
除了打刻速度也比舊型機種快上許多，論文
最大的價值在於無論打刻字型的放大或縮
小，絕不會有失真的情況出現，未來若將此
控制器應用於單機模式下，只要適當的更改
控制器之作業系統及相關設定，便適用於任
何的 WINDOWS 系列的環境，再者透過
OMAP 內建的 DSP 功能便能做出更好的弧
線打刻，此外還有 CCD 的打刻識別功能、
LCD 與 KEYBOARD 的結合、網路監控系
統、RS232 與 USB 的連線模式，待這些功
能完全開發成功，相信此全新的打刻機在市
面上必定會具備相當強的競爭力。 
5、參考文獻 
[1] http://www.sooma.com.tw/ (順茂股份有
限公司，台中，台灣) 
[2] Anonymous, ”OMAP-cpu and peripherals”, 
Texas Instruments Inc., 2003. 
[3] Anonymous, ”TLP521-1、TLP521-2、 
TLP521-4-GaAs Ired&Photo−Transistor”,  
TOSHIBA Photocoupler Inc., 2002. 
[4] Anonymous, ”SN74CBTD3384C-10 BIT  
FET BUS SWITCH WITH LEVEL  
SHIFTING”, Texas Instruments Inc.,  
2003. 
[5] Anonymous, “SN74LVC4245A-10-BIT  
FET BUS SWITCH”, Texas Instruments  
Inc., 2004. 
[6]無名氏, “EXD2020M-N 二相步進馬達 
小型驅動器”, 大圖科技有限公司, 2002. 
[7] Anonymous, “ULN2001A-ULN2002A、 
ULN2003A-ULN2004A- SEVEN  
DARLINGTON ARRAYS”,  
STMicroelectronics Inc.,1998. 
[8] Anonymous, ”HD74LS04 /  
HD74LS05-Hex Inverters / Hex Inverters  
(with Open Collector Outputs)”,  
RENESAS Inc., 2005. 
[9] Anonymous, “BU406/406H/408- High 
Voltage Switching”, FAIRCHILD Inc., 
2000. 
[10]無名氏，打刻機軟體中文操作說明，天
圖 3 OMAP 架構 
 
 
圖 4 新型控制器核心架構 
 
R83
100
VCC5_A
R79 220
R77 1.5k
U15
SN74CBTD3384C
1
13
12
24
3
4
7
8
11
14
17
18
21
22
2
5
6
9
10
15
16
19
20
23
/1OE
/2OE
GND
VCC
1A1
1A2
1A3
1A4
1A5
2A1
2A2
2A3
2A4
2A5
1B1
1B2
1B3
1B4
1B5
2B1
2B2
2B3
2B4
2B5
Y0
C74
0.1uF
R0
R78 0
U14
TLP521
A
K
C
E
VCC5_A R113 1K To OMAP
X0
CONTINUE
VCC30
5V ==> 3.3VENABLE
C75
1uF
 
圖 5 輸入信號電路示意圖 
 
 
END
Y_DR
VCC5_A
R99 3K
1 3
2
R98
100
TO XYR Axis  Driver
C79
0.1uF
VCC30
VCC5_A
R_PU
R97
220
U24TLP521
A
K
C
E
PAUSE
X_PU
END
VCC5_A
D21N4004
R102 220
U22
ULN2003A
1
2
3
4
5
6
7
16
15
14
13
12
11
10
9
1B
2B
3B
4B
5B
6B
7B
1C
2C
3C
4C
5C
6C
7C
COM
EV_2
R_DR
EV_1
Q3 BU406
B
E
C
U19
SN74LVC4245A
1
3
4
7
8
11
13
14
17
18
21
22
12
2
5
6
9
10
15
16
19
20
23
24/1OE
1A1
1A2
1A3
1A4
1A5
/2OE
2A1
2A2
2A3
2A4
2A5
GND
1B1
1B2
1B3
1B4
1B5
2B1
2B2
2B3
2B4
2B5
VCC
VCC5_A
EV
U20 TLP521
A
K
C
E
R100 220
R91 0
X_DR
Y_PU
U23TLP521
A
K
C
E
U28A
7404
1 2
PAUSE
3.3V ==>5V
 
圖 6 輸出信號電路示意圖 
 
 
 
 
圖 7 電腦式打刻機架構圖 
 
圖 8 打刻機編輯軟體視窗圖 
 
VCC5_A
U26
82C55A
34
33
32
31
30
29
28
27
5
36
9
8
35
6
4
3
2
1
40
39
38
37
18
19
20
21
22
23
24
25
14
15
16
17
13
12
11
10
D0
D1
D2
D3
D4
D5
D6
D7
RD
WR
A0
A1
RESET
CS
PA0
PA1
PA2
PA3
PA4
PA5
PA6
PA7
PB0
PB1
PB2
PB3
PB4
PB5
PB6
PB7
PC0
PC1
PC2
PC3
PC4
PC5
PC6
PC7
8255_INTR
82C55A
SW2控制讀寫控制線
J27
CON3
123
VCC5_A
VCC5_A
C83
0.1uF
3.3V <== 5V
R105 100
R107
10K
C84
4.7uF
VCC5_A
R108
10K
U27
SN74LVC4245A
1
3
4
7
8
11
13
14
17
18
21
22
12
2
5
6
9
10
15
16
19
20
23
24
/1OE
1A1
1A2
1A3
1A4
1A5
/2OE
2A1
2A2
2A3
2A4
2A5
GND
1B1
1B2
1B3
1B4
1B5
2B1
2B2
2B3
2B4
2B5
VCC
R109 0
BUSY
R112
100
3.3V ==> 5V
其它控制線
8255_INTR
U25
SN74CBTD3384C
1
13
12
24
3
4
7
8
11
14
17
18
21
22
2
5
6
9
10
15
16
19
20
23
/1OE
/2OE
GND
VCC
1A1
1A2
1A3
1A4
1A5
2A1
2A2
2A3
2A4
2A5
1B1
1B2
1B3
1B4
1B5
2B1
2B2
2B3
2B4
2B5
C82
0.1uF
D0~D7資料線
BUSY
STROBE
INTR中斷線
P1
PRINT PORT
13
25
12
24
11
23
10
22
9
21
8
20
7
19
6
18
5
17
4
16
3
15
2
14
1
R110 0
並列埠
R111
10K
STROBE
 
圖 9 並列埠電路示意圖 
 
 
 
圖 10 控制器與電腦端傳輸時序圖 
 
 
 
圖 11 控制器與電腦端通訊協定時序流程圖 
 
