 2 
摘要 
本研究以 GPU 加速計算時空守恆法求解一維非定常淺水波方程式與尤拉方程式，該方法無論在概念上或方
法上皆與傳統數值方法不同；因此避免傳統數值方法的限制並且具更高的適用性及精確性。本文討論時空守恆
法分別以 CPU 及 GPU 計算進行淺水方程式對水壩潰堤問題及尤拉方程式震波管問題進行模擬。本文研究中可
看出，時空守恆法模擬分析之結果與理論解析結果相當吻合，且利用 GPU 計算可提升計算之效率。 
關鍵字：時空守恆法、圖形晶片計算、尤拉方程式、淺水波方程式 
Abstract 
    A numerical technique for the modeling of shallow water flow in one-dimensional by the conservation element and 
solution element (CE/SE) method on GPU computing is presented in this work along with the results obtained in 
different applications involving unsteady flows.  The CE/SE method, an accurate and efficient explicit numerical 
method for solving moving discontinuities in fluid mechanics problems, is used to solve the shallow water flows and 
Euler equations both CPU and GPU are presented.  Several dam break problems and Sod’s (shock tube) problem with 
bed slope source terms are studied and comparisons are made to existing analytical solutions.  The GPU version 
CE/SE method not only an efficiency gain of about 10 times with respective to the CPU performance but also an 
accurate and robust for the numerical modeling of the shallow water flows. 
Keywords：CE/SE method, GPU, Euler equations, Shallow water equations 
 
前言 
    網格是偏微分方程數值解法的基礎，網格系統的
好壞將直接影響計算結果的精度，進而影響計算的成
敗。網格的分佈為求解問題中重要的一環，也是不可
分割的部分。在雙曲線問題中對數值方法來說，最主
要的挑戰便是如何捕捉到不連續波，通常不連續波均
會隨時間改變位置；因此為了節省計算網格而採用較
少的固定網格點將導致計算結果不佳。或是針對求解
區域較大，但對其中小部分解的細節信息要求很高的
情況下，在均勻網格上求解是不切實際的；尤其是在
高維度問題中將浪費不少的網格點及計算的時間。若
能以一個適應性網格在流場變化較大的地方設置較多
的網格點以增進流場的精確性；而在流場變化較小處
以較少的網格用以提昇計算效率。近二十年來，適應
性網格方法已成為計算科學領域中一熱門研究方向，
其主要方法有： 
(1) 局部細 /粗化適應性網格 (Adaptive mesh 
refinement)：在流場變化較大(小)處局部細(粗)
化網格來達到適應性的需求。 
(2) 重 新 分 佈 適 應 性 網 格 (Adaptive mesh 
redistribution)：即為一般所稱的移動網格
(Moving mesh)，此種方法為在固定的網格數目
下，網格隨著流場變化而改變位置以提升特定區
域之解析度。 
無論是細/粗化網格或重新分佈網格均可以達到提升
計算結果的精度及計算效率，但後者在程式撰寫上並
不會破壞所建構的流場資訊結構。因此優點本文將利
用網格移動方式來改善時空守恆法。移動網格主要是
由下列要件所組成： 
(1)網格方程式(Mesh equation)：在移動網格方法中，
引入一邏輯區域(Logical domain)作為參考，利
用網格方程式來提供物理區域及邏輯區域的對應。
在求解此網格方程式中可利用有限元素法或有限
差分法等，但是選擇一適當的數值方法才能提昇
移動網格的效率。 
(2)監控函數(Monitor function)：在網格移動時將藉
由監控函數來提供資訊使網格能在局部加密或變
疏。通常此函數可以曲率(Curvature)或是誤差來
表示之；以曲率為例，當曲率較大時代表流場變
化大則網格加密，反之則變疏。 
(3)內差(Interpolation)：當網格移動後，在新網格
點上流場資訊必頇由舊網格點提供。通常利用內
差技術將流場更新到新網格點，但隨著內差方法
的精度將會影響到最後計算的結果。 
 4 
有驚人的處理浮點運算能力。 
4. 正由於 GPU 在並行處理和計算高密度型問題求解
等方面所具有相當多的優勢，GPU 已成為目前很容易
就能建置擁有的高效能計算資源。從系統架構上看，
GPU是針對向量計算進行了最佳化的高度並行數據資
料流處理器。這種以數據資料流作為處理單元的處理
器，在對數據資料流的處理上可以獲得很高的效率。 
GPU 的發展速度與計算處理能力等，已遠遠超過一般
CPU 這種通用處理器，特別是隨著可編程程式化能力、
並行處理能力和應用範圍方面，可以得到不斷發展和
提升，使得 GPU 已成為當前高速計算系統中具備高效
能處理能力的硬體元件。因此，在 GPU 與 CPU 的協
同處理模式、GPU 通用計算的計算模式以及性能最佳
化等方面，如何充分利用現有計算資源，發揮 GPU 的
高性能計算能力，將是目前一個很重要的研究課題。
將對進一步拓展目前高速計算硬體架構，為科學計算
和工程應用提供新型的計算資源將具有重要的意義。 
 
研究方法 
網格重新配置 
   移動網格法中引入一邏輯區域 )( l 作為參考，利
用網格方程式來提供物理區域 )( p 與邏輯區域間的
對應。令 x

與

分別表示為物理區域及邏輯區域之座
標，二者間之之關係如下式所列： 
)(),.....,,(
)(),.....,,(
21
21
x
xxxxx
d
d






 
其中 d 為維度。移動網格的基本概念是當流場變化大
時加密網格以提昇精確度，而變化小時則粗化網格以
提高計算效率。因此引入一監控函數(ω，該函數用來
描述流場變化)，當監控函數大時網格間距頇變小如此
可列出： 
1,.....,1,0,)),((
1
)),((
1
 

JMJdxtxu
JM
dxtxu
R
L
j
j
x
x
x
x
  
上式即為等分佈準則。由等分佈準則可看出監控函數
與網格間距的乘積為一常數，當監控函數較大時(即流
場變化較大)網格間距變小，反之變大；如此則可滿足
當初移動網格的概念。Andrew 與 White[10]將一維等
分佈準則於物理區域及邏輯區域間列出： 
)(),(),(
0
),(
0
tdxtxdxtx
Mxtx


   
吾人對(3.2)式對 作二次微分則等分佈準則可改寫
成： 
0)( x  
上式即為網格方程式，由於上式中並無直接包含網格
速度項 )),(( txt  因此 Huang 等人[7]將此網格方程式
歸 類 成 一 類 靜 止 型 等 分 佈 準 則 (Quasi-Static 
equidistribution principles;QSEPs)。監控函數為描述流
場之變化，因此吾人選擇流場變數對空間之一階導數
表示之： 
2
2/1
2
2/1 )(1   jxj u  
上式中  為一尺度參數(scaling parameter)可用來控制
網格加密的程度且該參數必頇大於零。舉例來說當
1 時大部分的網格會聚集在流場對空間一階導
數大的地方，反之當 0 時則為等距網格。而
2/1)( jxu 為網格中之平均斜率： 
)(
)(
1
2/1
1
jj
x
x
x
jx
xx
dxu
u
j
j






 
以一震波為例，由於波前波後為均勻流場故監控函數
處僅在震波處為非零。因此若監控函數其聚集網格的
效果並不佳。所以本研究在重新配置網格前先將監控
函數平順化 (Smoothing)。本文之平順化過程採用
Drury[11]所提出： 











pj
pjk
jk
pj
pjk
jk
k
r
r
r
r
tx
)
1
(
)
1
(
),(~

  
其中 r 為平順化參數且 r 必頇大於零，而 p 為局部區域
平順化參數。通常局部區域平順化參數取 2 或 3 可得
最佳之平順效果，即網格之適應性(adaptivity)。 
    圖 1 為移動網格時空守恆法之守恆元及解元示意
圖。在移動網格時空守恆法中，保留網格在時空中交
錯配置的特性。新時間步階之位置 2/1njx 由舊時間步
階下之位置 )( njx 透過網格方程式求得，為保持交錯網
 6 
的網格密度大於未影響區域的密度，本研究採用之監
控函數如下式所示： 
2
max
2 ])/()[(1 xx    
其中 max)( x 為流場中最大密度變化。因密度為計算過
程中之流場變數，且在時空守恆法中流場變數對空間
之一階導數也設為一變數無頇採用差分技巧來求得，
因此直接可計算出監控函數。 
圖 2 為當時間 2.0t 流場中之密度、速度及壓力
之分佈圖，其中計算參數設定如下：所使用的計算網
格(JM)為 101、監控函數中之尺度參數為 10、高斯-塞
德歐疊帶法疊帶次數為 5 次，而時空守恆法中權重函
數係數(α)為 2。圖中實線代表當計算網格為 201 時原
時空守恆法之結果，而圓點符號分別代表數值模擬解。
由圖中可看出本研究所發展的移動網格時空守恆法以
較少的網格點所得之流場解析度與原時空守恆法在較
密網格時幾乎相同。而圖 3 中展示每一網格點隨時間
之軌跡圖；由於初始網格以等間距安排，所以當隔膜
爆開時不連續波由原點產生，所以可看出在爆開後網
格迅速地往座標原點移動。本研究所提出利用密度變
化之監控函數除了有效的同時在震波及接觸介面上細
化網格外，而且也細化了膨脹波處的網格，使該處之
網格密度大於尚未受影響區域之網格密度。 
為突顯移動網格時空守恆法的優點，以較少的網
格數來進行原時空守恆法及移動網格時空守恆法來比
較數值解與解析解。在此例子中吾人僅採用 50 個計算
網格點，移動網格時空守恆法計算參數設定如前一算
例所列；計算結果之密度分佈圖如圖 4 所示，其中實
線代表解析解，方塊及圓點符號分別代表移動網格時
空守恆法及原時空守恆法之計算結果。移動網格時空
守恆法可以將網格移動到流場變化大的地方，所以在
震波附近可以看到震波解析度比原時空守恆法來的高。
且吾人將接觸介面及震波附近放大來看，移動時空守
恆法確實將該處網格細化因此可得較高之解析度。另
外針對移動網格時空守恆法及原時空守恆法在計算時
間上作比較，表 3-1 列出不同計算網格下移動時空守
恆法及原時空守恆法分別在不同階段所花費的計算時
間。移動時空守恆法中吾人以網格點分別為 50 及 101
點時，計算時間花在輸出檔案時佔絕大部分，而真正
花在網格重新分佈及算子上佔不到整體的一半；在網
格重新分佈上，每一時間步階下以高斯-塞德歐疊帶法
求得新網格位置，因此所花時間會大於算子所花的時
間。另外在相同解析度下原時空守恆法需要 201 個網
格點，其計算時間雖花在算子比輸出檔案來的小，但
卻比以 51 點移動時空守恆法中算子加網格重新分佈
之時間總合來的長。由表中之比較顯出，移動時空守
恆法除了可以以較少的網格數得到較佳之不連續波解
析度外還可節省計算時間；因此移動網格時空守恆法
可增進解的解析度及節省計算成本。 
 
潰壩問題 
    考慮一無摩擦且無限寬之水平管流，在管道中設
置一水壩，並在水壩上下游處給訂不同的水深；當水
壩在瞬間完全潰壩，造成上由較深的水向下游傳遞，
此問題可藉由淺水波方程式來模擬。本研究考慮一計
算區間為2000公尺長的水道，在水道中央設定為水壩；
水壩區分水道上下游水深分別為100公尺及1公尺深。
計算上水道分割成200個計算網格，計算時間步階採用
0.1秒。當水壩潰壩後9.9秒之模擬結果與解析解[13]之
比較如圖5所示。由圖中可得知本研究所得之數值解與
解析解相當穩合。 
    利用GPU計算時，首先將計算資料由記憶體傳送
至顯卡記憶體中；在顯卡記憶體中區分成constant記憶
體、shared記憶體、register記憶體及global記憶體四種。
該四種記憶體各有其特性與存取速度差異：constant
記憶體區便是快取記憶體，讀取速度極快，但是該記
憶體僅能讀取無法在計算過程中作寫入動作；因此寄
計算過程中頇使用道之常數(如：計算時間步階、重力
場強度…等)可先宣告放入該記憶體中。Shared記憶體
是在Block中每一計算單元可以相互分享的記憶體，換
言之，每一計算單元可以存取該記憶體中的資料；因
此當同一Block中計算所需之資料可先寫入該記憶體
中，隨著計算可同時讀寫該記憶體之資料，此部分讀
取資料速度較快，因此將計算所需使用之資料放置該
記憶體中將是主要之工作。Registers記憶體室在每一
直行序中可以存取使用，因此該記憶體之資料只能提
供單一執行序來存取，該記憶體存取速度也很但是在
硬體設計時其容量並不大，因此僅能放置每一執行序
中較常用之資料。最後，global記憶體便是顯卡中主要
之記憶體，其容量大小取決與使用者購置顯卡時之要
求；該記憶體可提供GPU與CPU來存取，因此，計所
需之資料會先傳送至該區域，雖然該區域記憶體容量
 8 
Boundary-Value Problems,” SIAM J. Numer. 
Anal., Vol. 16, pp. 472-502, 1979. 
[11] Dorif, E. A. and Drury L. O’c., “Simple Adaptive 
Grids for 1-D Initial Value Problems,” J. Comp. 
Phys., Vol. 69, pp. 175-195, 1987. 
[12] Sod, G. A., “A Survey of Several Finite 
Difference Methods for System of Nonlinear 
Hyperbolic Conservation Laws,” J. Comp. Phys., 
Vol. 27, pp. 1-31, 1978. 
[13] Stoker JJ, “Water Waves,” Interscience 
Publications, Wiley, New York. 
 
 Grids Solver Re-mesh Plot Total 
MMCESE 
JM=50 3 4 8 15 
JM=101 5 6 19 30 
CESE JM=201 11 0 25 36 
*CPU Time (10-2 Sec.) 
計算設備為 Pentium 4 2.4G 
表 1、移動時空守恆法與原時空守恆法所花費計算時
間之比較。 
 
表 2、tpb(thread per block)對計算效率之影響。 
 
 
圖1、移動網格時空守恆法之時空交錯網格示意圖。 
 
圖2、移動時空守恆法當t = 0.2時震波管中之密度、
速度及壓力分佈圖。 
 
圖 3、移動網格解震波管問題之網格軌跡圖。 
 
圖4、當網格點為50點時移動網格時空守恆法、原時空
守恆法之尤拉解與震波管問題之解析解之比較。 
 
圖5、水壩潰壩問題當t = 9.9秒時數值解與解析解之
比較。 
X
-0.5 -0.25 0 0.25 0.5
0
0.3
0.6
0.9
1.2
Fig. 3. Solutions of Sod problem at t = 0.2. (a) trajectory of mesh. (b) flow variables distribution
(dots and solid lines denote the moving and fixed grid solutions).
density
velocity
pressure
X
T
im
e
-0.5 -0.25 0 0.25 0.5
0
0.05
0.1
0.15
0.2
X
-0.4 -0.2 0 0.2 0.4
-0.2
0
0.2
0.4
0.6
0.8
1
1.2
D
e
n
s
it
y
0.1 0.15 0.2 0.25 0.3 0.35 0.4
0.1
0.2
0.3
0.4
0.5
X
DD
Analytical solution
MMCESE solution
Original CE/SE solution
X
H
-1000 -500 0 500 1000
0
20
40
60
80
100
Analytical solution
Numerical result
98年度專題研究計畫研究成果彙整表 
計畫主持人：曾子彝 計畫編號：98-2221-E-492-014- 
計畫名稱：適應性時空守恆法在圖形晶片計算之發展與應用 
量化 
成果項目 實際已達成
數（被接受
或已發表）
預期總達成
數(含實際已
達成數) 
本計畫實
際貢獻百
分比 
單位 
備 註 （ 質 化 說
明：如數個計畫
共同成果、成果
列 為 該 期 刊 之
封 面 故 事 ...
等） 
期刊論文 0 0 100%  
研究報告/技術報告 0 0 100%  
研討會論文 1 0 100% 
篇 
 
論文著作 
專書 0 0 100%   
申請中件數 0 0 100%  專利 已獲得件數 0 0 100% 件  
件數 0 0 100% 件  
技術移轉 
權利金 0 0 100% 千元  
碩士生 2 2 100%  
博士生 0 0 100%  
博士後研究員 0 0 100%  
國內 
參與計畫人力 
（本國籍） 
專任助理 0 0 100% 
人次 
 
期刊論文 0 0 100%  
研究報告/技術報告 0 0 100%  
研討會論文 0 0 100% 
篇 
 
論文著作 
專書 0 0 100% 章/本  
申請中件數 0 0 100%  專利 已獲得件數 0 0 100% 件  
件數 0 0 100% 件  
技術移轉 
權利金 0 0 100% 千元  
碩士生 0 0 100%  
博士生 0 0 100%  
博士後研究員 0 0 100%  
國外 
參與計畫人力 
（外國籍） 
專任助理 0 0 100% 
人次 
 
 
