 i
Abstract 
This report is devoted to developing two temperature controllers- a fuzzy supervised 
generalized predictive PID controller with a feedforward controller, and a stochastic 
adaptive model reference predictive controller with a TRFNN adaptive inverse model 
feedforward controller, for PET molding production processes. Three important parts 
are done in this report. First, the overall temperature control system for a PET 
molding production process is designed and described in details. Second, the first kind 
of temperature controller is synthesized by combining a gain scheduling feedforward 
controller and a closed-loop feedback fuzzy supervised generalized predictive PID 
controller. The design procedure for the closed-loop feedback controller assumes a 
second-order system model with time delay for the PET molding heating process, and, 
in particularly, presents a fuzzy supervisor to on-line tune the three-term parameters 
of generalized predictive PID control. Third, the second controller is aimed to 
construct a two-degrees-of-freedom temperature controller which improves the 
previous one by combining a TRFNN adaptive inverse model feedforward controller 
with a stochastic adaptive model reference predictive controller. Computer 
simulations are performed to illustrate the effectiveness of the both proposed 
temperature methods. The performance and merits of the proposed controllers are 
exemplified by conducting several experiments on a physical DSP-based PET 
temperature control system. 
 
 iii
Contents 
 
ABSTRACT...................................................................................................................i 
CONTENTS................................................................................................................ iii 
LIST OF FIGURES ....................................................................................................vi 
LIST OF TABLES.......................................................................................................ix 
CHAPTER 1  INTRODUCTION.............................................................................1 
1.1  INTRODUCTION ...................................................................................................1 
1.2  LITERATURE REVIEW ..........................................................................................7 
1.3  MOTIVATION AND OBJECTIVE .............................................................................9 
1.4  CONTRIBUTIONS OF THE REPORT ......................................................................11 
1.5  ORGANIZATION OF THE REPORT ........................................................................13 
CHAPTER 2  CONTROL SYSTEM DESIGN AND IMPLEMENTATION .....14 
2.1  INTRODUCTION .................................................................................................14 
2.2  SYSTEM DESCRIPTION OF WHOLE PET STRETCH BLOW MOLDING MACHINE 
AND MATERIAL PROPERTIES......................................................................................14 
2.3  SYSTEM DESCRIPTION OF THE EXPERIMENTAL PET MOLDING HEATING 
MACHINE ..................................................................................................................16 
2.3.1  Experimental PET Molding Heating Machine Structure.........................16 
2.3.2  Infrared Heater and Blower.....................................................................19 
2.3.3  Infrared Temperature Sensor ...................................................................22 
2.4  PRECISE PET TEMPERATURE CONTROL SYSTEM ARCHITECTURE .....................22 
2.4.1  Precise PET Temperature Control ...........................................................22 
2.4.2  DSPACE DS1104 Precise Temperature Controller..................................24 
 v
4.3.1  Recurrent Fuzzy Neural Network Learning Algorithm............................56 
4.3.2  TRFNN Inverse Modeling Control Configuration ...................................59 
4.4  INTEGRAL SAMRPC TEMPARTURE CONTROL ..................................................60 
4.5  SIMULATE RESULTS AND DISCUSSION...............................................................62 
4.5.1  SAMRPC Simulation Results ...................................................................62 
4.5.2  TRFNN Inverse Modeling Control Simulation Results............................66 
4.5.3  Integral SAMRPC Simulation Results .....................................................68 
4.6  EXPERIMENTAL RESULTS AND DISCUSSION.......................................................71 
4.7  CONCLUDING REMARKS ...................................................................................72 
CHAPTER 5  CONCLUSIONS AND FUTURE WORK.....................................74 
5.1  CONCLUSIONS...................................................................................................74 
5.2  FUTURE WORK .................................................................................................75 
REFERENCES...........................................................................................................76 
附錄一 計畫成果自評                                               84
 vii
Figure 2.13. Overall PET temperature control system experiment constitution..........24 
Figure 2.14. Internal structure of the DS1104 R&D Controller Board........................25 
Figure 2.15. Overall controller PC surface structure and safeguard circuit.................25 
Figure 2.16. A graphical user managing interface feature of the dSPACE software. ..26 
Figure 3.1. Structure of the adaptive temperature control system for stretch PET 
molding machines. .......................................................................................................32 
Figure 3.2. Block diagram of a feedback PID temperature controller structure..........33 
Figure 3.3. The structure of a gain scheduling feedforward controller........................39 
Figure 3.4. Simulated behavior of five temperature control estimated parameters. ....42 
Figure 3.5. Simulated behavior of the three estimated PID controller parameter. ......43 
Figure 3.6. Simulated behavior of the energy weighting function of the fuzzy 
supervisory controller, q0. ............................................................................................43 
Figure 3.7. Simulated temperature control in PET blow molding system...................44 
Figure 4.1. Block diagram of the SMRA predictive control system............................54 
Figure 4.2. TRFNN structure. ......................................................................................56 
Figure 4.3. Direct inverse configuration of TRFNN controller. ..................................59 
Figure 4.4. Direct inverse configuration with online training of TRFNN controller...60 
Figure 4.5. SAMRPC structure with dual degrees of freedom. ...................................62 
Figure 4.6. SAMRPC simulated behavior of the estimated parameters.. ....................64 
Figure 4.7. SAMRPC simulated temperature control in PET blow molding system. .65 
Figure 4.8. SAMRPC simulated temperature control tracking response with the step 
disturbance with amplitude of 20.................................................................................65 
Figure 4.9. A static nonlinear mapping between input u and output y for the system. 67 
Figure 4.10. Steady state input-output relation diagram (TRFNN). ............................67 
Figure 4.11. Set-point tracking response with a disturbance (TRFNN). .....................68 
Figure 4.12. Integral SAMRPC simulated temperature control in PET blow molding 
 ix
List of Tables 
 
Table 3.1. Fuzzy Rules.................................................................................................38 
 
  
 
2
materials which are used to produce bottles for soda-waters and drinks. 
 
 
 
Figure 1.1.  The system structure and produced goods of the PET temperature 
control system for PET blow molding machines. 
 
PET is an abbreviation of its full name, polyethylene-terephthalate. The first 
applications for blow molding were for cellulose nitrate and then for cellulose acetate 
in 1930. Blow moulding is known after the introduction of Low Density Polyethylene 
(LDPE) in 1940. With LDPE, the plastic industry grew s rapidly. In 1950, the demand 
for blow moulding increased by the mass production of High Density Polyethylene 
(HDPE) and Polypropylene (PP) for various applications. The lightweight HDPE 
gallon milk container revolutionized the dairy industry; thus, glass bottles and 
paperboard were quickly replaced. The first polyethylene bottle was manufactured 
using the blow molding process in December of 1942. This was the real beginning of 
a huge industry which currently produces 30 to 40 billion plastic bottles per year in 
U.S.A alone. 
To date, blow molding technique has been considered as one of the most useful 
and practical techniques to manufacture PET containers and bottles. Fig. 1.1 shows 
the system structure and produced goods of the PET blow molding machines. There 
are three types of typical PET blow molding process, which includes extrusion blow 
molding, injection blow molding and stretch blow molding. In Figure 1.2, extrusion 
  
 
4
 
Figure 1.3.  Injection blow molding: (1) parison is injection molded around a 
blowing rod; (2) injection mold is opened and parison is transferred to a 
blow mold; (3) soft polymer is inflated to conform to a blow mold; and 
(4) blow mold is opened and blown product is removed. 
 
 
Figure 1.4.  Stretch blow molding: (1) injection molding of the parison; (2) 
stretching; and (3) blowing. 
 
Blow molding machines are usually constructed by a synthesis of mechatronics, 
control and software. For example, the proposed molding machine is equipped with 
an auto-infeed mechanism for uploading PET bottle preforms, a cyclic conveyor 
moving at a constant speed, two groups of rotational mechanisms for PET tubes, two 
or more heating ovens, one blower, a stretch blow molding unit, and a unit for 
outputting final products, a temperature sensor and a motion and temperature 
  
 
6
The controlled temperature variables in the PET blow molding machines are the 
temperatures of bottle preforms at the outlet of the second heating oven. These control 
variables are the heating power of 16 infrared lamps inside two heating ovens (each 
oven is with 8 lamps), and the heating power of each infrared lamp can be set one by 
one. The wind flow of the ventilating blower would affect the cooling convection rate 
for the preforms except the heating power of the infrared lamps. Hence, the influence 
of the ventilating blower flow control on the PET blow molding products is 
remarkable.  
Conventional PET bottle preforms temperature control techniques are classed 
roughly as two schemes: open-loop and closed-loop. In accordance with the empirical 
engineer’s experience, the open-loop temperature control can easily set the heating 
power of each infrared lamp in different operating circumstances and can be operated 
effectively. Note that an infrared temperature sensor is applied to confirm the 
capabilities of the open-loop temperature control. In closed-loop temperature control, 
the infrared temperature sensor measures the temperatures of performs after heating, 
and the measured values are compared with desired temperatures. The feedback 
controller realizes a compensation rule via negative feedback, and enables the 
preforms’ temperature to maintain constant with allowable errors. In general, the 
open-loop temperature controller brings its control function to reach a low cost benefit 
in a constant operating ambient temperature for the machine, but the changes of 
external operating environments (such as the ambient temperature/humidity change 
for machine, the power voltage variation and etc.) will influence noticeably the 
precision of performs’ temperatures. In order to overcome this difficulty, closed-loop 
temperature control is adopted to reduce external ambient effects upon performs 
temperatures and to improve the temperature precision of the blow molding process 
for possible changes of ambient temperatures. Therefore, production of high-quality 
  
 
8
approaches principles of such self tuning or auto-tuning PID controllers, they can 
roughly be classified into four categories [25] : they can be synthesized based on (ii) 
auto step test method [25]; (i) mathematical modeling method [7-8, 26-37]; (iii) limit 
cycling method [38-39] ; (iv) intelligent approaches based on neural networks , fuzzy 
control and genetic algorithm [40-56]. Each type of self tuning or auto-tuning PID 
controller has its own transient performance, robustness, design complexity and 
performance limitations. 
In addition to PID control, generalized predictive control (GPC) has been regarded 
have been extensively used for temperature processes with time-delays [57-70].  
Since the temperature control processes of PET manufacture suffer from the time 
delay problem, GPC method could be an effective controller to achieve control goals 
under time-delay. Most GPCs are presently operated under linear models [9-10], but 
some nonlinear GPC strategies are also popular if nonlinear models are available.  
Many design approaches for adaptive GPC controllers have been proposed for some 
classes of nonlinear systems; in particular, some useful schemes are adaptive 
predictive controllers with fuzzy modeling or neural networks [11-15]. However, the 
use of predictive control with feedforward neural and neural networks to address the 
above-mentioned predictive control problem must know usually the plant order and 
the suitable controller input variables. To know the order of industrial processes, the 
trial and error method is used mostly to determine the scheme until a best set of input 
variables is chosen. The method is obviously of low efficiency, and too many input 
variables in the networks increase the network size as well as decrease the learning 
rate.  
Aside from PID control and GPC method for the temperature control problems, 
Juang [13] proposed another control approach, called a TSK-type recurrent fuzzy 
neural network (TRFNN) method.  This method has been proved as a better choice 
  
 
10
develops two temperature controllers- a fuzzy supervised generalized predictive PID 
controller with a feedforward controller, and a stochastic adaptive model reference 
predictive controller with a TRFNN adaptive inverse model feedforward controller, 
for PET molding production processes. Both controllers take the advantages of the 
self-tuning PID, the generalized predictive temperature control techniques ands neural 
networks control, in order to address the PET temperature control effectively. The 
control performance is described in the following specifications: (i) the overshoot of 
the step response is less than 3o C and the steady-state error is less than C
o2± ;(ii) 
the controller’s parameters can be automatically tuned under setpoint changes; (iii) the 
disturbance reject capability is achieved in the presence of ambient temperature 
variations in the working environments of PET machines; (iv) the controller works in 
the energy0saving mode.  
This report has been done for two years. In the first year, a fuzzy supervised 
generalized predictive PID temperature controller with a feedforward control has been 
proposed; such as controller consists of a gain scheduling feedforward controller and 
a closed-loop feedback fuzzy supervised generalized predictive PID controller. The 
gain scheduling feedforward controller is employed to deal with room temperature 
variations, while the feedback adaptive predictive PID controller is used to improve 
temperature tracking accuracy. This proposed technique has four features, including 
(i) it retains the operating experience of a traditional temperature control engineer and 
keeps the good properties, such as simple structure, easy tuning and robustness of a 
PID controller; (ii) self- tuning PID controller can achieve good control performance 
for various setpoints; (iii) the controller can adapt to different operating conditions 
because of the gain scheduling feedforward control; (iv) it can be applicable to 
systems with having variable time-delay, non-minimum phase or open-loop unstable. 
  
 
12
controller is composed of a gain scheduling feed forward controller and a 
closed-loop feedback fuzzy supervised generalized predictive PID controller. The 
design procedure for the closed-loop feedback controller takes a second-order 
time-delay system model, obtains a generalized predictive PID controller, and uses 
a fuzzy supervisor to on-line tune the three-term parameters of the PID controller. 
Computer simulations and experimental results are performed to illustrate the 
effectiveness of the proposed method. 
3. A stochastic adaptive model reference predictive control (SMRPC) approach is 
presented to achieve accurate temperature control for a polyethylene-terephthalate 
(PET) blow molding machine, which is experimentally modeled as a simple 
second-order system model with given long time delay. Based on this model, the 
adaptive model reference predictive controller with control weighting is derived 
based on the minimization of an expected generalized predictive control (GPC) 
performance criteria. A real-time adaptive SMRPC algorithm is proposed. 
Computer simulations and experimental results show that the proposed control 
method is capable of giving accurate and satisfactory control performance under 
set-point changes and exogenous disturbances.  
4. A recurrent fuzzy neural network adaptive inverse modeling control method is 
proposed to achieve feedforward control by applying a TRFNN to learn the 
changes of ambient temperature effectively.  
5. A stochastic adaptive model reference predictive controller with a TRFNN 
adaptive inverse model feedforward controller is proposed to improve the control 
overall performance, avoid selection of complicated weighting factors, and 
accomplish more intelligent temperature controller.  
 
 
  
 
14
Chapter 2 
Control System Design and Implementation 
 
2.1  Introduction 
This chapter aims to explain the experimental PET molding heating mechanism 
and to derive the mechanism model for controller development later. Furthermore, 
whole PET stretch blow molding machine system structure as well as PET blow 
molding material properties are illustrated, too. 
The rest of the chapter is organized as follows. Section 2.2 describes whole PET 
stretch blow molding machine structure and the material properties. In Section 2.3, 
system description of the experimental PET molding heating machine is presented. 
Precise PET temperature control system architecture is illustrated in Section 2.4. 
Section 2.5 derives the experimental PET molding heating processes model. Finally, 
the conclusions of the chapter are stated in Section 2.6. 
 
2.2  System Description of Whole PET Stretch Blow Molding 
Machine and Material Properties 
PET material provides many significant advantages, such as durability, high 
transparency, heat-proof, good isolation, non-poison, recycling, lightness, enduring 
pound, non-fragility and easy manufacturing, and so on. Consequently, PET has 
become one of the most familiar materials which are utilized to produce bottles for 
soda-waters and drinks. Figure 2.1 shows the bottle performs surface and the crystal 
property curve graph of PET blow molding material. In accordance with the 
crystallization rate curve graph and engineers experiences, optimal PET blow molding 
temperature is 90℃~120℃. 
  
 
16
 
Figure 2.2.  Whole PET stretch blow molding machine system; (a) structure; 
(b) mechanism surface. 
 
2.3  System Description of the Experimental PET Molding Heating 
Machine 
2.3.1  Experimental PET Molding Heating Machine Structure 
In Figure 2.3, the experimental PET molding heating mechanism consists of a 
cyclic conveyor, two groups of rotational mechanisms, two heating ovens (each oven 
is with 8 infrared lamps in Figure 2.7), one blower, a infrared temperature sensor and 
a motion and temperature controller. The components will be specified in later 
subsections. The purpose of the experiment is to control the PET bottle performs blow 
molding temperature which is desired between 90℃ and 120℃, and the temperature 
errors must remain ±2℃. The controlled temperature variables of the PET blow 
molding machines are the bottle preforms temperature of the second heating oven. 
These controlled variables are the heating power of 16 infrared lamps inside two 
heating ovens (each oven is with 8 lamps), and the heating power of each infrared 
lamp is able to set alone. The wind flow of the ventilating blower affects the cooled 
convection rate for the preforms except the heating power of the infrared lamps. 
Hence, the influence of the ventilating blower flow control on the PET blow molding 
stretch blow 
molding unit 
unit holding 
final products 
heating oven
heating 
oven I
conveyor
auto-infeed mechanism 
(a) (b)
  
 
18
the experimental PET blow molding heating machines.  
 
Figure 2.4.  System surface structure of the experimental PET blow molding heating 
machine. 
 
no. item no. item 
1 Turntable 3
Drived motor of PET bottle 
performs rotation 
2 Heating 4 Drived motor of turntable
  5 decelerator 
Figure 2.5.  System internal part structure of the experimental PET blow molding 
heating machine. 
  
 
20
     
  
Figure 2.7.  Two heating ovens (each oven is with 8 infrared lamps) 
 
Figure 2.8.  Spectral distribution of a short-wave IR lamp at several temperatures. 
  
 
22
2.3.3 Infrared Temperature Sensor 
In Figure 2.11, the infrared temperature sensor detected the bottle preforms 
temperature of the second heating oven, and then sent a feedback current signal with 
4~20mA. The feedback current signal was transformed into a voltage signal with 
1~5V by a 1kΩ resistance. The voltage signal was sent into computer via A/D 
converter, and then computed an optimal control value. 
 
 
 
Figure 2.11.  A infrared temperature sensor. 
 
2.4  Precise PET Temperature Control System Architecture 
2.4.1  Precise PET Temperature Control 
In this report, the precise temperature control experiment system of the PET 
blow molding machine includes a bottle preforms temperature control system, a 
infrared temperature sensor and a dSPACE DS1104 temperature controller. The 
infrared temperature sensor of the bottle preforms temperature control system will 
transform temperature measured values into digital signals, and then A/D converter 
conveys the signals to temperature controller. The temperature controller copes with 
the digital signals, and uses a real-time fuzzy supervised generalized predictive PID 
controller with dual degrees of freedom in Figure 2.12 (a) as well as a real-time 
SPECIFICATIONS 
Model No. 
Temperature Range
Optical Resolution
Emissivity 
Outputs / Analog 
Accuracy 
Temp. Resolution
Repeatability 
Response Time 
Spectral Range 
Ambient Temp. 
Relative Humidity
Dimensions/Weight
Power Supply 
Vibration 
Shock 
Digital Interface 
IRS-22 
–40℃ ~ +900℃ 
D:S = 22:1 
0.100 ~ 1.100 (adjustable) 
J. K. 0~5/10V, 4~20mA 
±1% or ±1℃ 
0.1℃ 
±0.5% or ±0.5℃ 
150ms (95%) 
8~14 μm 
-20℃ ~ 180℃ (head) 
10%~95% 
120mm×70mm×30mm; 420g(box), 40g(head)
8 VDC ~ 36 VDC 
IEC 68-2-6: any axis, 11~200Hz, 3G 
IEC 68-2-27: any axis, 11ms, 50G 
USB, RS232, RS485 (optional modules) 
  
 
24
 
Figure 2.13.  Overall PET temperature control system experiment constitution. 
 
2.4.2  DSPACE DS1104 Precise Temperature Controller  
This report uses a DS1104 R&D Controller Board, Figure 2.14, which is made by 
the dSPACE GmbH company in Germany. The controller board is the main handling 
unit in the control system. The DS1104 R&D Controller Board is a single-board 
system. The hardware package contains one PCI-slot board with a bracket including a 
100-pin I/O connector and one adapter cable with two 50-pin female Sub-D 
connectors. The DS1104 R&D Controller Board is a standard board that can be 
plugged into a PCI slot of a PC in Figure 2.15. The DS1104 R&D Controller Board is 
specifically designed for the development of high-speed multivariable digital 
controllers and real-time simulations in various fields. It is a complete real-time 
control system based on a 603 PowerPC floating-point processor running at 250 MHz. 
For advanced I/O purposes, the board includes a slave-DSP subsystem based on the 
TMS320F240 DSP microcontroller. For purposes of rapid control prototyping (RPC), 
specific interface connectors and connector panels provide easy access to all input and 
output signals of the board. Thus, the DS1104 R&D Controller Board is the ideal 
hardware for the dSPACE Prototyper development system for cost-sensitive RPC 
applications. Consequently, the complex control methods with dual degrees of 
freedom can be real-time accomplished. The relative technical information in the 
IR temperature 
sensor 
DSP 
Controller 
SCR 
SCR 
Second IR 
heating oven 
First IR heating 
oven Heat 
exchange 
processes 
TemperatureD/A 
Converter 
(a) 
A/D 
Converter
Temperature 
setpoint 
  
 
26
  
Figure 2.16.  A graphical user managing interface feature of the dSPACE software. 
 
2.5 Processes Model and Parameter Estimation 
This section is devoted to exhaustively introducing plant model, parameter 
estimation, model matching, and so on. 
 
2.5.1  Plant Model 
For this stretch PET molding production process, its dynamic behavior of the 
heating process can be reasonably approximated as the following second-order system 
ARMAX models with time-delay: 
 )()()()()( 11 kkuzbkyza ξ+= −−  (2.1) 
where 22
1
1
1 1)( −−− −−= zazaza  and )1(101)( +−−− += dd zbzbzb  , z is the shifting 
operator, d is the delay time, y(k) and u(k) denote the system output and input in time 
k, respectively; )(kξ  means the unpredictable external disturbance or the modeling 
error, and it’s represented by white Gaussian stochastic noise. In (2.1), we assume that 
(i) system parameters ai and bi are unknown. 
(ii) the system delay d is unknown, but satisfies the inequality, Md ≤≤1 ，where M is 
the possible largest time delay of the system model (2.1). 
  
 
28
1ˆb , dˆ  will be determined from the model matching method at zero frequency. In 
doing so, it is necessary to obtain their frequency responses via 
 
0
1
0
1 )(~ˆ)(~ˆ)(ˆ)(ˆ
==
−
==
− ===
ωω
ωω
ωω
jbzbjbzb
hjhj ezez
 
and then rallies to obtain 
 ∑∑
==
−=
M
i
i
M
i
i bdbib
11
1
~ˆˆ~ˆˆ  (2.5) 
 ∑∑
==
++−=
M
i
i
M
i
i bdbib
11
0
~ˆ)1ˆ(~ˆˆ  (2.6) 
 
∑
∑∑∑∑∑∑
=
======
−++−
= M
i
i
M
i
i
M
i
i
M
i
i
M
i
i
M
i
i
M
i
i
b
bibbibbbi
d
1
1
2
1
2
1
2
111
~ˆ2
)~ˆ)(~ˆ(4)~ˆ(4)~ˆ(~ˆ~ˆ2
ˆ  (2.7) 
Since dˆ  must be a positive integer. Thus 
 )ˆ(ˆ dINTd =  (2.8) 
where INT denotes the integer function. Therefore, the parameters dbb ˆ ,ˆ ,ˆ 10  in (2.1) 
are obtained from (2.5), (2.6) and (2.8). 
 
2.6 Concluding Remarks 
This chapter has described systematically the experimental PET molding heating 
mechanism and derived the mechanism model for controller development later. 
Furthermore, whole PET stretch blow molding machine system structure as well as 
PET blow molding material properties are illustrated, too. 
  
 
30
and Tsai in [24,25]. In [1,2], the authors developed a fuzzy supervised generalized 
predictive PID control and a model reference adaptive predictive control for the 
first-order system with time-delay, and applied it efficiently in an oil-cooling machine. 
Two-degrees-of-freedom control has been widely used in industry. This method 
integrates a feedback controller with a feedforward controller. The latter provides a 
demanded value for plant at a certain operating point, and the former is used to 
eliminate errors from an incorrect model, a model with parameter varying and 
external disturbance. Kuo [7] proposed a classic design method for controllers with 
dual degrees of freedom [7]. Another study in [26] used a two degree-of-freedom 
control for constant continuous positive airway pressure of an obstructive sleep apnea 
treatment system, and got good performances. 
For most PET temperature control processes, exact derivation of their nonlinear 
mathematical models is not possible, and their system parameters are difficult to 
obtain accurately. Hence, an empirical approach will be used in the paper to obtain an 
approximate mathematical model of a PET temperature control process. Based on the 
second-order approximate model, we propose a fuzzy supervised generalized 
predictive PID temperature control with a gain scheduling feedforward control. The 
gain scheduling feedforward controller is employed to deal with room temperature 
variations, while the adaptive predictive PID controller is used to improve 
temperature tracking errors. This proposed technique has four features, including (i) it 
retains the operating experience of a traditional temperature control engineer and 
keeps the good properties, such as simple structure, easy tuning  and robustness of a  
PID controller; (ii) self- tuning PID controller can achieve good control performance 
for various setpoints; (iii) the controller can adapt to different operating conditions 
because of the gain scheduling feedforward control; (iv) it can be applicable to  
systems with having variable time-delay, non-minimum phase or open-loop unstable. 
  
 
32
 
Figure 3.1.  Structure of the adaptive temperature control system for stretch PET 
molding machines. 
 
3.3  Adaptive Fuzzy Predictive PID Control 
This section aims to develop an adaptive fuzzy supervised generalized predictive 
PID temperature controller for PET molding production processes. Figure 3.2 shows 
the block diagram of a feedback PID temperature controller structure. This controller 
is synthesized as the following steps. First, the dynamic model of the PET molding 
production processes can be approximated to the second-order system models with 
time-delay. Furthermore, according to parameters estimation and model matching in 
Section 2.2 obtain the system’s parameters of the process, and then the generalized 
predictive control in Section 3.3 is utilized to derive the parameters of the PID 
controller. Last, a fuzzy supervisory controller is employed to find a suitable control 
weighting factor, and to find the optimal PID gains in order to achieve the satisfactory 
control performance under changes of setpoints and ambient temperatures. 
+ 
desired 
temperature
Gain  
Scheduling 
Temperature 
sensor
Feed forward 
controller 
PID Heaters 
Adaptive 
Mechanism
sensor
Blow 
molding 
processes 
uff
ufd +
+
- 
out 
temperature 
disturbance 
  
 
34
required polynomials )( 1−zE j , )(
1−zFj , )(
1−zG j , and it can get the predictive output 
y(k+j). 
 )()(ˆ)(1 111 −−−− +Δ= zFzzazE jjj  (3.3) 
 L,2,1),(ˆ)()( 111 == −−− jzbzEzG jj  (3.4) 
where 
 )1(1,
2
2,
1
1,
1 1)( −−−
−−− ++++= jjjjjj zezezezE L  
 22,
1
1,0,
1)( −−− ++= zfzffzF jjjj  
 jjjjjjj zgzgzggzG
−−−− ++++= ,22,11,0,1)( L  
Multiplying (3.1) by )( 1−Δ zEz jj , and  combining Eq. (3.3) with Eq. (3.4), one 
obtains 
 )(ˆ)()()()()(ˆ 11 kdjkuzGkyzFjky jj ξ+−+Δ+=+ −−  (3.5) 
where )()()(ˆ 1 kzEzk j
j ξξ −= . Therefore, the jth step predictive value )(ˆ jky +  can 
be expressed by  
 )()()(ˆ)()(ˆ 11 djkuzGkyzFjky jj −+Δ+=+ −−  (3.6) 
Substituting Eq. (3.6) into Eq. (3.2), it can generate the following new cost function 
J’. 
 
2 2
1 1
22 1
1 1
ˆ( ) ( ) ( ) ( )
( ) ( ) ( ) ( )
N N
j
j N j N
T T T
J y k j r k j q z u k j d
F GU R F GU R U Q z Q z U
−
= =
− −
′ = + − + + Δ + −
= + +Ω− + +Ω− +
∑ ∑
 (3.7) 
where 
 [ ]TdNkukukukU )()1()()( 2 −+Δ+ΔΔ= L  
 [ ]TNdd kyzFkyzFkyzFF )()()()()()( 1111 2 −−+−= L  
  
 
36
If the control horizon Nu is set by one and the set-points are fixed, the vector G 
need to be modified as 
 
⎥⎥
⎥⎥
⎥
⎦
⎤
⎢⎢
⎢⎢
⎢
⎣
⎡
=
⎥⎥
⎥⎥
⎥
⎦
⎤
⎢⎢
⎢⎢
⎢
⎣
⎡
=
−
++
1,
1,1
0,
1
22 NN
d
d
N
d
d
g
g
g
g
g
g
G MM  (3.12) 
Thus, rearranging Eq. (3.11) can obtain the predictive control error )(kuΔ . Finally, 
the optimal control law at time instant k is given by  
 
⎥⎥⎦
⎤
⎟⎟⎠
⎞
⎜⎜⎝
⎛
⎟⎟⎠
⎞
⎜⎜⎝
⎛−⎟⎟⎠
⎞
⎜⎜⎝
⎛−⎟⎟⎠
⎞
⎜⎜⎝
⎛
−
⎢⎢⎣
⎡
⎟⎟⎠
⎞
⎜⎜⎝
⎛
⎟⎟⎠
⎞
⎜⎜⎝
⎛ ++−=
−
=
−
==
=
−
=
∑∑∑
∑∑
)(
)()1()(
2
2,
1
1,0,
1
0
2
2
1
2
1
2
1
2
1
2
1
kyzfgzfgfg
krgqgkuku
N
Nj
jj
N
Nj
jj
N
Nj
jj
N
Nj
j
N
Nj
j
 (3.13) 
where 
 10,10,00,10,2 1,1,0,0 affff +==== −−  
 20,3120,210,10, )()1( afaafaff jjjj ⋅−−⋅++⋅= −−−  
 20,2120,11, )( afaaff jjj ⋅−−⋅= −−  
 20,12, aff jj ⋅−= − , 10,100, 11 bfbfg NjNjj ⋅+⋅= −−−  
 q0 is the energy weighting function, Qq ∈0 。 
 
3.3.2  Generalized Predictive PID Control 
To calculate the three-term parameters, DIP kkk ,, , of the PID control law, one 
finds about the relationship between GPC and the rate PID control. The expression of 
the discrete rate PID controller is given by 
 
[ ] )()2( )()()1()( 21 kyzkzkk kkkkrkkuku DDP DPII −− ++
−++−+−=
 (3.14) 
Compare Eq. (3.13) with Eq. (3.14), and it will know the discrete rate PID controller 
  
 
38
Table 3.1.  Fuzzy Rules. 
)(kyΔ
e(k) NL NM NS ZE PS PM PL
NL PL PL PL PL PM PM PS
NM PL PL PM PM PS PS ZE
NS PS PS ZE ZE ZE NS NS
ZE PS PS ZE ZE ZE NS NS
PS PS PS ZE ZE ZE NS NS
PM NS NS NS NM NM NL NL
PL NS NM NM NL NL NL NL
 
3.3.4  Real-Time Adaptive Fuzzy Supervisory Predictive PID Control 
This subsection blends the foregoing techniques which include parameters 
estimation, generalized predictive PID control and fuzzy supervisory control so as to 
generate an effective and practical real-time fuzzy supervisory predictive PID control. 
 
3.4  Gain Scheduling Feedforward Control 
Since the temperature control system of PET blow molding machine fall into the 
category of multi-input single-output system, it is inappropriate to adopt a 
conventional self-tuning regulator or a model reference adaptive control, but it can be 
done by a gain-scheduling control scheme. Figure 3.3 depicts the structure of a gain 
scheduling controller that uses the present room temperature to directly change 
feedforward controller gain. The purpose of this strategy is to reduce the influence of 
output feedback signal, and to achieve quick responses. This gain scheduling feed 
forward controller needs to find an easy measuring variable which can respond to the 
operating situation in the blow molding machine, and it can immediately alter 
controller parameters. The input variable of the gain scheduling feed forward 
controller is the room temperature, and the aim of the controller is to adjust the 
heating power of each infrared lamp to generate different temperature control property, 
thereby establishing relationships between the controller and the variables. In 
  
 
40
suitable heating power of each infrared lamp inside each temperature region. In Figure 
3.3, 16 controller parameters will be simultaneously adjusted according to the region 
of the present room temperatures. Notice that the heating power of each infrared lamp 
can be fixed inside each temperature region. 
 
3.5  Integral Real-Time Temperature Control Algorithm 
Precise temperature control outputs in the PET blow machine are the sums of 
outputs from the adaptive feed-forward controller and the adaptive predictive PID 
controller, namely that the overall control outputs are u(k)=uff(k)+ ufd(k). To reduce the 
computational load in temperature sensor and controller, this section uses the 
proposed adaptive control structure by Åström and Wittenmark [8], and then develops 
a following real-time control algorithm. 
Step 1 : Set the reference signal r(k), the predictive horizon N, the sampling period T 
and an integral M. 
Step 2 : Generate the pseudo random binary signal (PRBS) control sequence in the 
first 60 sampling instants, k<60, for parameter estimation . 
Step 3 : Measure the present output y(k) and compute error e(k). 
Step 4 : Calculate the adaptive feed-forward controller output, uff(k) if k>60. 
Step 5 : Compute the control signal ufd(k) in accordance with the computed gains kP, kI, 
kD from Eq. (3.14) if k>60. 
Step 6 : Calculate )()()( kukuku fdff += , and convert u(k) into physical control signals 
if k>60; otherwise, set u(k) as the  PRBS generated in Step 2. 
Step 7 : Estimate the system parameters d, a1, a2, b0 and b1 from Eqs. (2.3), (2.4), 
(2.5), (2.6) and (2.8); and compute the PID parameters kP, kI and kD from Eqs. 
(3.15), (3.16), (3.17) and the fuzzy supervisory weighting value q0. 
  
 
42
the estimation process. Figure 3.4 and Figure 3.5 depict the time histories of the 
estimated parameters and the estimated PID controller parameters. Figure 3.6 shows 
the simulated behavior of the energy weighting function of the fuzzy supervisory 
controller, q0. Figure 3.7 shows the temperature tracking response, it includes 
disturbance with 20 magnitudes in the 700th sampling point. The results indicate that 
the proposed method is feasible and effective in tracking reference temperature 
trajectories and disturbance rejection.  
0 200 400 600 800 1000 1200 1400 1600 1800 2000
-0.5
0
0.5
time
a1
Parameter Estimation
0 200 400 600 800 1000 1200 1400 1600 1800 2000
-0.5
0
0.5
time
a2
 
0 200 400 600 800 1000 1200 1400 1600 1800 2000
-2
0
2
time
b0
0 200 400 600 800 1000 1200 1400 1600 1800 2000
-1
0
1
time
b1
0 200 400 600 800 1000 1200 1400 1600 1800 2000
0
10
20
time
d
 
Figure 3.4.  Simulated behavior of five temperature control estimated parameters. 
[includes the model parameter a1, a2, b0, b1 and d.] 
 
  
 
44
0 200 400 600 800 1000 1200 1400 1600 1800 2000
-50
0
50
100
150
output y (red), reference r (blue,type:--) & input u (blue)
time
y
0 200 400 600 800 1000 1200 1400 1600 1800 2000
0
50
100
150
200
time
u
 
Figure 3.7.  Simulated temperature control in PET blow molding system; (a) setpoint 
tracking response y; [includes disturbance with 10 magnitudes at the 700th sampling 
point.] (b) control signal u. 
 
3.7  Concluding Remarks 
This chapter presented a systematic approach for design of a fuzzy supervised 
generalized predictive PID controller with a feedforward controller for a PET blow 
molding machine. The standard generalized predictive control method was then 
applied to compute the optimal PID gains, and the control weighting term q0 was 
tuned by the fuzzy supervisory level. The real-time algorithm was also successfully 
applied to achieve control performance specifications for the PET blow molding 
machine. It is expected that the proposed method is useful for most single-loop 
industrial control systems which can be modeled as second-order systems with 
minimum-phase, nonminimum-phase, open-loop unstable, having variable time-delay 
and integrating models. Through Computer simulations, the proposed control the 
method is shown capable of giving satisfactory temperature set-point tracking 
(a) 
(b) 
  
 
46
Chapter 4  A Stochastic Adaptive Model Reference 
Predictive Controller with Dual Degrees of Freedom 
 
4.1  Introduction 
This chapter develops a stochastic adaptive model reference predictive control 
with dual degrees of freedom. The controller combines a TRFNN adaptive inverse 
model feedforward controller with a stochastic adaptive model reference predictive 
controller. The controller can improve control performances of the previous fuzzy 
supervised generalized predictive PID controller with a feedforward controller in 
variable environments. 
The rest of the chapter is organized as follows. Section 4.2 describes the stochastic 
adaptive model reference predictive control. In Section 4.3 the TRFNN adaptive 
inverse modeling feedforward controller design is presented. The integral SAMRPC 
temparture controller is designed in Section 4.4 for to combine the SAMRPC 
feedback controller with the TRFNN adaptive inverse modeling feedforward 
controller. Section 4.5 presents some simulations and discussion. Section 4.6 presents 
some experimental results and discussion for PET molding production processes. 
Finally, the conclusions of the chapter are stated in Section 4.7. 
 
4.2  Stochastic Adaptive Model Reference Predictive Control 
4.2.1  Stochastic Model Reference Predictive Control with Integral Action 
This section aims to develop a systematic way of combining generalized 
predictive control (GPC) and model reference control (MRC) for obtaining a new type 
of stochastic model reference predictive control (SMRPC) with control weighting and 
integral action for the PET blow molding process. This new control method is based 
  
 
48
which has the transfer function )(/)()( 111 −−−− = zDzNzzG dm  with the setpoint uc(k) , 
where N(z-1) = n0 and 11
1 1)( −− += zdzD 3322 −− ++ zdzd . Notice that the denominator 
polynomial D(z-1) is asymptotically stable, namely that all the roots of the polynomial 
D(z-1) lie within the unit circle in the z plane. 
[Assumption 2] The DC gain of the transfer function Gm(z-1) is unity, i.e., Gm(1)=1 
and n0=1+d1+d2+d3∈R. 
Remark 1: A practical rule or guideline for choosing the model parameters d1, d2 and 
d3 is simply described as follows. The model parameter n0 in the numerator is 
determined such that the DC gain of the reference model equals unity, i.e., 
n0=1+d1+d2+d3. The model parameters d1, d2 and d3 are chosen such that the three 
closed-loop poles have desired corresponding analog damping ratio and natural 
frequency. The method relating the two closed-loop conjugate poles to the 
corresponding analog damping ratio and natural frequency can be found in [25]. 
In what follows the proposed model reference predictive control law with integral 
action is derived to minimize the expectation of the following GPC-like quadratic 
function with control weighting. 
 ⎪⎭
⎪⎬⎫⎪⎩
⎪⎨⎧ +Δ++−+= ∑∑ −
==
−
1
0
22*1 ))()(()]()()[(
up H
j
w
H
dj
jkujjkyjkyzDEJ λ  (4.4) 
where Hp means the maximum prediction horizon, Hu denotes the control horizon, and 
λw(i), i=0,…,Hu-1, represents the control weighting. Note that p uH H≥ . In order to 
establish the control law, the following Diophantine equation in (4.5) is used to solve 
for the polynomials )( 1−zFj , )(
1−zGj and )(
1−zPj  so that the optimal j step-ahead 
predictor of y(k) can be found.  
  
 
50
Since the second term in J is independent of the future control vector U, the 
minimum of J with respect to the future control vector U is completely identical to the 
minimum of J  with respect to the future control vector U, i.e., the finding of the 
optimal control vector U so as to minimize J . Moreover, the new cost function J  
can be rewritten in a quadratic form  
 UURkyGWPURkyGWPUJ TT Λ+−++−++= ))(())((  (4.11) 
where 
 
,0
1,1 1,0 ( 1)
, , 1 , 1
0 0
0
p u
p p p p p p u
d
d d H d H
H H d H H d H H d H
p
p p
P
p p p
+ + − + ×
− − + − − +
⎡ ⎤⎢ ⎥⎢ ⎥= ∈⎢ ⎥⎢ ⎥⎢ ⎥⎣ ⎦
L
L
M O
L
R
 
 [ ] 1( ) ( 1) ( 1) uT HuU u k u k u k H ×= Δ Δ + Δ + − ∈RL  
 
,
1
1
1, ( 1) 1
2
,
1
( )
( 1)
( )
p
P
p
p
d
d j
j
d
d j H d
j
H
H j p
j H d
p u k j
p u k j
W
p u k j H d
=
+
+ − + ×
=
= − +
⎡ ⎤Δ −⎢ ⎥⎢ ⎥⎢ ⎥Δ − +⎢ ⎥= ∈⎢ ⎥⎢ ⎥⎢ ⎥⎢ ⎥Δ − + −⎢ ⎥⎣ ⎦
∑
∑
∑
R
M
 
 
1)1(
2
2,
1
1,0,
2
2,1
1
1,10,1
2
2,
1
1,0,
×+−
−−
−
+
−
++
−−
∈
⎥⎥
⎥⎥
⎦
⎤
⎢⎢
⎢⎢
⎣
⎡
++
++
++
= dH
HHH
ddd
ddd
p
ppp
zgzgg
zgzgg
zgzgg
G RM  
 [ ] 1)1(111 )()()1()()()( ×+−−−− ∈−++= dHTpccc pdHkuzNkuzNkuzNR RL  
 
(0) 0 0
0 (1) 0 0
0 0 0 ( 1)
u u
w
w H H
w uH
×
⎡ ⎤⎢ ⎥⎢ ⎥Λ = ∈⎢ ⎥⎢ ⎥−⎣ ⎦
R
λ
λ
λ
L
M M O M  
Because the cost function J  is quadratic in U, an optimal solution for U with 
  
 
52
 3,22,121,1, )()1( −−− −−++= mjmjmjmj fafaafaf , 
                         4for 1,,4 ≠−= jjm L  (4.17) 
 3,22,121,10, )()1( −−− −−++= jjjjjjj fafaafag  
 2,21,121, )( −− −−= jjjjj fafaag , 1,22, −−= jjj fag  
Hence, the parameters of the polynomials, )( 1−zPj , j≧2, are recursively calculated as 
follows; 
 00, bp j = , 11,01, bfbp jj += , 1,1, −= jjjj fbp , 
 1,1,0, −+= njnjnj fbfbp , 2for 1,,2 ≥−= jjn L  (4.18) 
Before closing this section, the stability of the proposed predictive control with 
integral action and control weighting must be considered. According to (4.13) one 
obtains the following equation, 
  
1,1 1,2 1, 1
2,1 2,2 2, 11
,1 ,2 , 1
( )
p
p
u u u p
H d
H dT T
H H H H d
c c c
c c c
C P P P
c c c
− +
− +−
− +
⎡ ⎤⎢ ⎥⎢ ⎥= + Λ = ⎢ ⎥⎢ ⎥⎢ ⎥⎣ ⎦
L
L
M M O M
L
 (4.19) 
The present control signal u(k) can be calculated from (4.14) and then expressed 
as below;  
  
∑∑
∑∑ ∑
∑
−
=
++
−
=
++
−
=
++
−
=
+
+=
+
−
+
−
=
−
+
−−−−
−Δ−
++−=
dH
i
idi
dH
i
idi
dH
i
idi
dH
i
di
ij
jid
ji
i
dH
i
ci
pp
pp
p
kygckygc
kygckupzc
ikuzNckuku
0
2,1,1
0
1,1,1
0
0,1,1
0 1
,1,1
0
1
1,1
)2()1(
)()(
)()()1()(
 (4.20) 
which can be rewritten as the following general linear control form  
  )()()()()()( 111 kyzSkuzTkuz c
−−− −=ΔR  (4.21) 
where 
  
 
54
 ))1(ˆ)()()(()1(ˆ)(ˆ −−+−= kkkykKkk T θϕθθ  
 1))()1()()(()1()( −−Σ+−Σ= kkkkkkK T ϕϕλϕ  (4.24) 
 λϕ /)1())()(()( 4 −Σ−=Σ kkkKk TI  
where Taabbk ]ˆˆˆˆ[)1(ˆ 2110=−θ  ; [ ]Tkykydkudkuk )2()1(  )1()()( −−−−−=ϕ ; I4 is 
the fourth-order identity matrix, Σ(k) is a 4×4 symmetric matrix, and Σ(0)=αI4, α>>1;
λis the forgetting factor. In order to speed up convergence of the parameters in the 
startup phase of the algorithm, a pseudo random binary signal (PRBS) sequence 
designed in [22], [24] can be used as the best testing signal. However, the RLS 
method usually takes more data to achieve successful parameter estimation. 
 
 
Figure 4.1  Block diagram of the stochastic model reference adaptive (SMRA) 
predictive control system. 
 
To reduce the computational delay, the proposed real-time algorithm employs the 
adaptive algorithm skeleton proposed in [18]. Figure 4.1 shows the block diagram of 
the proposed stochastic model reference adaptive predictive control system. The 
proposed real-time adaptive control algorithm is detailed in the following steps. 
Step 1: Select sampling period T and measure the initial temperature y0. 
Step 2: Set the time delay d, prediction horizon Hp, control horizon Hu and the control 
Input u
Process  
Output y  
Real-Time 
Parameter 
Estimator 
Command 
set-point uc 
Model Reference 
Predictive 
Controller 
Reference Model
Model Output y*
PET blow 
molding 
machine
Estimated 
Parameters 
  
 
56
4.3.1  Recurrent Fuzzy Neural Network Learning Algorithm 
Figure 4.2 shows the TRFNN structure. Suppose the structure has r rules and n 
external inputs, x1, x2 , … , xn , and then each recurrent fuzzy rule can be expressed by 
 
irrii
iin
n
j jiji
iinnii
i
wthwthwth
thatxaaty
GthAtxAtxAtxR
 
 is )1( and ,..., is )1( , is )1(      
),()()1(  then and      
, is )( and , is )( ,..., is )( , is )( if :
2211
110
2211
+++
++=+ +=∑  (4.25) 
where Aij is the membership function of the fuzzy system input xj(t) to the fuzzy set 
defined by a Gaussian membership function  ))(exp()( 22 σxmxM A --=  with the 
center m and the width σ. The variable G represents a sigmoid fuzzy set with 
membership function ))exp(1(1)( xxMG -+=  ; else w and a are the consequent 
parameters of the inference output h and y, respectively. 
The recurrent reasoning implies that the internal variable hi(t) is able to affect the 
inference output y(t+1), and the internal variable hi(t) itself forms a recurrent 
reasoning, that is, the current internal output is a function of previous output value 
hi(t). Each rule has its own corresponding internal variable hi, which is used to 
memorize the firing history of the rule. The firing history memorizes the effect of the 
past control input. 
 
Figure 4.2.  TRFNN structure. 
h1(t) 
x1
R1
Σ 
z-1
...... ... ......
...
...
R2 Rr ...z
-1z-1
Σ Σ
...
x2 xn 
h2(t) hr(t) 
...
hr(t+1)h2(t+1) h1(t+1) 
y1
...
(1, xv ,h1)
(1, xv ,h2)
(1, xv ,hr) 
a1
w11
a2 ar 
w12 w1r 
w21 w22
w2r 
wr1 wr2 wrr
  
 
58
 ))()()()1()(()()()()1( tatttytttPtata i
T
iiiiiiii
rrr ϕββϕ −++=+  (4.29) 
 ⎥⎦
⎤⎢⎣
⎡
+−=+ )()()()()(
)()()()()()(
)(1)1(
tttPtt
tPtttttP
tPtP
iii
T
ii
i
T
iiiii
ii βϕϕβλ
ϕββϕ
λ  (4.30) 
where [ ]Tininiiii aaaaata 1210)( += Lr ; Tini thtxtxtxt )]()()()(1[)( 21 L=ϕ ;
∑== ri i
i
i t
1
)( μ
μβ ; )1()()1( +=+ tytty ii β ; λ is a forgetting factor, and 10 ≤< λ ; Pi is 
the covariance matrix, and its initial value is set as Pi(0)=13I. In addition, , if the 
gradient descent algorithm is adopted, and then the parameter aij is updated by 
 1,...,0,,...,1for   ,)(
)1()()1( +==∂
+∂−=+ njrita
tEtata
ij
ijij η  (4.31) 
where  1,))1()1(()(
)1(
0
1
=+−+=∂
+∂
∑ = x
x
tytyta
tE
r
k k
jid
ij μ
μ
 
For other free parameters, including m, σ, and w, they are tuned only by 
real-time recurrent learning algorithm during off-line learning as in [4], and these 
parameters use the same way to derive updated rules. This will manifest only the 
update rule of m. For each mpq, it is updated by 
 )(
)1()()1( tm
tEtmtm
pq
pqpq ∂
+∂−=+ η  (4.32) 
and ⎟⎟⎠
⎞
∂
∂+∂
∂⋅⎜⎜⎝
⎛ +−+−+=∂
+∂ ∑∑∑ == +=
r
i i
pq
ir
i ini
pq
p
r
k k
pd
pq
tm
hatmt
tytf
tytytm
tE
11 1
1
)()(
)(
)1()(
))1()1(()(
)1( μμμμ
   (4.33) 
where 2
11
)(
2)()()(
pq
pqq
n
j
jAp
n
j
jA
pq
p
pq
p mtxxMhxMm
h
tm pjpj σ
μ −⋅⎟⎟⎠
⎞
⎜⎜⎝
⎛⋅+⎟⎟⎠
⎞
⎜⎜⎝
⎛⋅∂
∂=∂
∂ ∏∏
==
 
and     
( )
⎪⎭
⎪⎬
⎫
⎥⎥⎦
⎤−−⋅−⋅−⎟⎟⎠
⎞
⎜⎜⎝
⎛+
⎪⎩
⎪⎨
⎧
⎢⎢⎣
⎡ −⎟⎟⎠
⎞
⎜⎜⎝
⎛⋅−∂
∂−=∂
∂
∏
∑ ∏
=
= =
2
1
1
1
)1(
2)1()1()(
)1()()1()(1)()(
pq
pqp
q
n
j
jA
r
l
n
j
jA
pq
l
plpp
pq
p
mtx
thtxM
txMtm
hwththtm
h
qj
lj
σ
 
  
 
60
a good controller is obtained by the powerful learning ability of the 
least-squared-error after off-line learning. 
The objective of online learning is to deal with unpredictable changes in the 
control environment. For online learning, the direct inverse-modeling learning scheme 
is used, as shown in Figure 4.4. In the tth sampling instant, TRFNN produces a control 
signal u(t) in accordance with yp(t) and yref(t), and gets a new output yp(t+1). Then, we 
can define a set of input [yp(t), yp(t+1)] and the desired output u(t) as a training pattern, 
so as to find the difference between the TRFNN output )(ˆ tu  and the desired output 
u(t), and this difference is defined as E(t). Last, using the gradient descent algorithm 
minimizes E(t) and obtains an optimal control in each sampling time. 
 
 
Figure 4.4.  Direct inverse configuration with online training of TRFNN controller. 
 
4.4  Integral SAMRPC Temperature Control 
Figure 4.5 shows the block diagram of the proposed stochastic adaptive model 
reference predictive controller structure with the TRFNN inverse-modeling 
feedforward controller. The actual output of the proposed controller is a combination 
of both outputs from the stochastic adaptive model reference predictive controller and 
the TRFNN inverse-modeling feedforward controller, i.e., )()()( kukuku fdff += . In 
order to reduce the computational delay caused by the temperature sensors and 
＋
TRFNN
－
TRFNN
Plant 1−z
yref (t) 
yp(t) 
yp(t)
yp(t+1)u(t)
E(t)
û(t)copy 
  
 
62
 
 
Figure 4.5.  SAMRPC structure with dual degrees of freedom. 
 
 
4.5  Simulate Results and Discussion 
4.5.1  SAMRPC Simulation Results 
This subsection will emphasize on examining the performance of the proposed 
stochastic model reference adaptive predictive temperature control with control 
weighting and integral action for a PET blow molding machine. In doing so, particular 
efforts are paid to illustrate the feasibility and effectiveness of the proposed control 
method by computer simulations. 
In the simulations, the reference temperature trajectory was set to the most proper 
blow molding temperatures from 90℃ to 110℃. Based on the data, the time delay of 
the system and the four parameters of the overall system were recursively estimated 
by the RLS method, and given by the following the second-order system model with 
time-delay d. 
+ 
+ ufd Process   Output y  
Real-Time 
Parameter 
Estimator 
Command 
set-point uc 
Model Reference 
Predictive 
Controller 
Reference Model
Model Output y*
PET blow 
molding 
machine
Estimated 
Parameters 
+ 
TRFNN
-
TRFNN
yp(k) 
yp(k)
uff(k)
E(k)
û(k)
copy
yp(k+1)
yref(k) 
z -1 
  
 
64
 
 
0 200 400 600 800 1000 1200 1400 1600 1800 2000
-0.6
-0.4
-0.2
0
0.2
time
a1
Parameter Estimation
0 200 400 600 800 1000 1200 1400 1600 1800 2000
-0.2
0
0.2
0.4
time
a2
 
0 200 400 600 800 1000 1200 1400 1600 1800 2000
0
0.2
0.4
0.6
0.8
time
b0
0 200 400 600 800 1000 1200 1400 1600 1800 2000
-0.1
0
0.1
0.2
0.3
time
b1
 
Figure 4.6.  SAMRPC simulated behavior of the estimated parameters. 
 
  
 
66
4.5.2  TRFNN Inverse Modeling Control Simulation Results 
This subsection will emphasize on examining the effectiveness and performance 
of the presented the TRFNN adaptive inverse modeling control on a highly nonlinear 
system. The system whose mathematical model is described as follows; 
)1()(
))(1(
))()1()(()1( 22 −−+−++
−+−=+ dtudtu
ty
dtutytyty  
where d=2. To estimate the parameters of TRFNN inverse model, this example needs 
first to get a static nonlinear mapping between input and output variables for this 
system, as Figure 4.9. For the TRFNN inverse model network, the two plant input 
variables yp(t), yp(t-1) are fed as the inputs. In the sequel, the key parameters in 
TRFNN inverse modeling and parameter estimation are set as follows; the number of 
rules is 4, the forgetting factor λ is 0.9, the learning constants η and ηw are 0.4 
and 0.8, respectively. Figure 4.10 compares the TRFNN inverse modeling output ym 
with the actual system input u in the steady-state input-output relationship. The key 
parameters of the proposed control law are set as follows; the learning constant η of 
aij is 0.0003, the simulation time is 400 samples. After performing simulations of the 
TRFNN adaptive inverse modeling control, Figure 4.11 depicts the time history of the 
set-point tracking response with a amplitude 3 of an external disturbance in the 130th 
sampling instant. The results indicate that the proposed method is feasible and 
effective in tracking reference trajectory and achieving excellent disturbance rejection. 
 
 
  
 
68
0 50 100 150 200 250 300 350 400 450
0
10
20
30
SETPOINT -- sp (green...)  &  PLANT OUTPUT -- yp (red)
time
sp
 &
 y
p
0 50 100 150 200 250 300 350 400 450
0
2
4
6
time
u
 
Figure 4.11.  Set-point tracking response of the TRFNN adaptive inverse modeling 
control law with a disturbance: (a) set-point sp (dot) and tracking response yp (solid); 
(b) control signal u (dot) 
 
4.5.3  Simulation Results on Integral SAMRPC 
This subsection will emphasize on examining the performance of the proposed 
integral SAMRPC temperature control for a PET blow molding machine. The integral 
SAMRPC controller is a combination of both outputs from the stochastic adaptive 
model reference predictive controller and the TRFNN inverse-modeling feedforward 
controller, i.e., )()()( kukuku fdff += . The integral SAMRPC controller block diagram 
shows in Figure 4.5. In doing so, particular efforts are paid to illustrate the feasibility 
and effectiveness of the proposed control method by computer simulations. 
In the simulations, the reference temperature trajectory was set to the most proper 
blow molding temperatures from 90℃ to 110℃. Based on the data, the time delay of 
the system and the four parameters of the overall system were recursively estimated 
by the RLS method, and given by the following the second-order system model with 
(a) 
(b) 
  
 
70
0 200 400 600 800 1000 1200 1400 1600 1800 2000
-50
0
50
100
150
output ybar (red), reference r (blue,type:--) & input u (blue)
time
y b
ar
0 200 400 600 800 1000 1200 1400 1600 1800 2000
0
50
100
150
200
time
u
 
Figure 4.12.  Integral SAMRPC simulated temperature control in PET blow molding 
system; (a) setpoint tracking response ; (b) control signal u. 
 
 
0 200 400 600 800 1000 1200 1400 1600 1800 2000
-50
0
50
100
150
output ybar (red), reference r (blue,type:--) & input u (blue)
time
y b
ar
0 200 400 600 800 1000 1200 1400 1600 1800 2000
0
50
100
150
200
time
u
 
Figure 4.13.  Integral SAMRPC simulated temperature control tracking response 
with the step disturbance with amplitude of 20. 
 
(a) 
(b) 
(a) 
(b) 
  
 
72
8 9 10 11 12 13 14 15 16
2
2.2
2.4
2.6
2.8
3
3.2
3.4
loop(mA)
A
D
(V
)
 
Figure 4.15.  The actual system steady-state I/O (loop current-A/D voltage) 
relationship measurement for the experimental PET blow molding heating machine. 
 
4.7  Concluding Remarks 
This chapter presented a systematic approach for design of a stochastic adaptive 
model reference predictive control together with a feedforward controller for a PET 
blow molding machine. The controller combines a TRFNN adaptive inverse model 
feedforward controller with a stochastic adaptive model reference predictive controller. 
The controller can improve control performances of the previous fuzzy supervised 
generalized predictive PID controller with a feedforward controller in time-varying  
environments. The real-time algorithm was also successfully applied to achieve 
control performance specifications for the PET blow molding machine. It is expected 
that the proposed method is useful for most single-loop industrial control systems 
which can be modeled as second-order systems with minimum-phase, 
nonminimum-phase, open-loop unstable, having variable time-delay and integrating 
models. Through Computer simulations, the proposed control the method is shown 
  
 
74
Chapter 5  Conclusions and Future Work 
5.1  Conclusions  
This report has developed methodologies and techniques for system design, 
modeling and both adaptive predictive temperature control of a PET temperature 
control system. The report is written based on the two assumptions: two heating ovens 
are controlled via the same control signals, and the speed of the conveyer is set 
constant. The five main contributions of the report are highlighted as below.  
1. The control architecture of the PET temperature control system have been 
presented and described in details. In particularly, its key components, including a 
digital signal processor (DSP)-based temperature controller, heating ovens and the 
motion platform, have been designed and implemented to verify the effectiveness 
of the proposed controller. 
2. A fuzzy supervised generalized predictive PID temperature controller with a 
feedforward controller has been successfully proposed for the PET blow molding 
machine. The controller is composed of a gain scheduling feed forward controller 
and a closed-loop feedback fuzzy supervised generalized predictive PID 
controller. Through computer simulations and experimental results, the controller 
has been shown capable of give excellent performance of the proposed method..  
3. A stochastic adaptive model reference predictive control (SMRPC) approach has 
been proposed to achieve accurate temperature control for a polyethylene- 
terephthalate (PET) blow molding machine, which is experimentally modeled as a 
simple second-order system model with given long time delay. The adaptive 
model reference predictive controller with control weighting is derived based on 
the minimization of an expected generalized predictive control (GPC) 
performance criteria, and a real-time adaptive SMRPC algorithm is proposed. 
  
 
76
References 
[1] http://big5.chinabgao.com/gate/big5/www.chinabgao.com/reports/29246.html 
[2] R. Yusof, and S. Omatu, "A Multivariable Self-Tuning PID Controllers," 
International Journal of Control, vol.57, no.6, pp.1387-1403 (1993). 
[3] R. Yusof, S. Omatu, and M. Khalid," Self-Tuning PID Control: a Multivariable 
Derivation and Application," Automatica, vol.30, no.12, pp.1975-1981 (1994). 
[4] C. C. Tsai, and C. H. Lu, "Adaptive Generalized Predictive Control of Plastic 
Extrusion Heating Process," Proc. of 1996 Automatic Control Conference, 
Taipei, Taiwan, pp.550-557, April (1996). 
[5] M. Khalid, S. Omatu, and R. Yuof, "MIMO Furnace Control with Neural 
Networks," IEEE Transaction Control System Technology, vol.1, no.4, 
pp.238-245, December (1993). 
[6] J. S. Taur, and C. C. Tsai, "Temperature Control of a Plastic Extrusion Barrel 
Using PID Fuzzy Control, "Proc. of 1995 International IEEE/IAS Confernce on 
Industrial automation and Emerging Technologies, Taipei, Taiwan, pp.370-375, 
May (1995). 
[7] S. Omatu, R. Yusof, K Sinohara and M. Hotta, "Temperature Control for 
Heating Cylinder by Multivariable STC," IEEE Transaction System Control 
Information Engeering (in Japanese), vol.5, no.3, pp.102-110 (1992). 
[8] C. C. Tsai, and C. H. Lu, “Multivariable Self-Tuning Temperature Control for 
Plastic Injection Molding Process," IEEE Transaction on Industry Applications, 
vol.34, no. 2, pp.310-318, March/April 1998. 
[9] C. C. Tsai and Chih-Hung Huang " Model Reference Adaptive Predictive 
Control for a Variable-Frequency Oil-Cooling Machine,” IEEE Transactions on 
Industrial Electronics, vol.51, no.2, pp.330-338, 2004. (SCI)  
  
 
78
[18] J. P. Gerry, "A Comparison of PID Control Algorithm," Control Engineering, 
pp.102-105, March 1987. 
[19] J. G. Ziegler, and N. B. Nichols, "Optimal Settings For Automatic Controllers," 
Trans, ASME, pp.759-768, Nov. 1942. 
[20] C. C. Hang, K. J. Astrom, and W. K. Ho, "Refinements of the Ziegler-Nichols 
Tuning Formula,"IEE Proc.-D, vol.138, No.2, March 1991. 
[21] G. H. Cohen, And G. A. Coon, "Theoretical Considerations Of Retarded 
Control," Trans,. ASME, vol.75, pp.827-836, 1953. 
[22] A. Kaya and T. J. Scheib, "Tuning of PID Controls of Different Structures, 
"Control Engineering, pp.62-65, July 1988. 
[23] Minta Yuwana, and Dale E. Seborg, "A New Method for On-Line Controller 
Tuning," AIchE Journal, vol.28, No.3, May 1982. 
[24] J. N. Koivo, and J. Sorvari, "On-Line Tuning of A Multivariable PID Controller 
for Robot Manipulators," Proc, 24th IEEE Conf. on Decision & Control, Ft. 
Lauderdale, FL. pp.1502-504, Dec. 1985. 
[25] V. J. Vandoren, "Inside Self-Tuning PID Controllers," Control Engineering, pp. 
67-70, August 1993.  
[26] P. J. Grawthrop, and P. E. Nomikos, "Automatic Tuning of Commercial PID 
Controllers for Single-Loop and Multiloop Applications," IEEE Control 
Systems Magazine, pp.34-42, Jan. 1990. 
[27] F. Cameron, and D. E. Seborg, " A self tuning Controller with a PID Structure," 
Int. J. Cont., vol. 30, pp. 401-417, 1981.  
[28] R. Ortega, and R. Kelly, "PID Self-Tuner: Some Theoretical and Practical 
Aspects," IEEE Trans. Industrial Electronics, vol. 31, no. 4, pp. 332-337, Nov. 
1984. 
[29] P. J. Gawthrop, "Self-Tuning PID Controllers : Algorithms and 
  
 
80
Maryland, pp. 2465-2469, June 1994.  
[40] R. Doraiswami, and J. Jiang, "Performance Monitoring in Expert Control 
Systems,"Automatica, vol.25, No.6, pp.799-811, 1989. 
[41] K. J. Amstrom, C. C. Hang, P. Persson, And W. K.Ho," Towards Intelligent PID 
Control," Automatica, vol. 28, no. 1, pp. 1-9, 1992. 
[42] B. Porter, A. H. Jones, and C. B. Mcheown, "Real-Time Expert Tuners for PI 
Controllers,"IEE Proc.-D, vol.134, No.4, July 1987. 
[43] T. W. Kraus, T. J. Myron, and The Foxboro CO., "Self-Tuning PID Controller 
Uses Pattern Recognition Approach," Control Engineering, pp.106-111, June 
1984. 
[44] J. Litt,"An Expert  System  To Perform On-Line Controller Tuning," IEEE  
Control Syst. Mag.,pp. 18-23,April, 1991. 
[45] A. E. B. Rnano, P. J. Fleming, And D. I. Jones ,"Connectionist Approach To PID 
Autotuning," IEE Proceedings-D, vol. 139, no. 3, pp. 279-285, May,1992. 
[46] S. Tzafestas, and N. P. Papanikolopoulos, "Incremental Fuzzy Expert PID 
Control," IEEE Tran. Industrial Electronics, vol.37, No.5, pp.365-371, Oct. 
1990. 
[47] G. M Abdelnour, C. H. Chang, F. H. Huang, And Y.Cheung," Design Of Fuzzy 
Controller Using Input And Outpou Mapping Factors," IEEE Trans. On Systems, 
Man, And Cybernetics, vol. 21,no. 5, pp. 952-959, Sept./Oct., 1991. 
[48] T. H. Lee, C. C. Hang , W. K. Ho, and P. K. Yue, "Implementation of a 
Knowledge-based PID Auto-tuner," Automatica, vol. 29, no. 4, pp. 1107-1113, 
1993. 
[49] I. Y. Zhao, M. Tomizuka, and S. Isaka, "Fuzzy Gain Scheduling of PID 
Controllers," IEEE Tran. on System, Man, and Crbernetics, vol.23, No.5, 
Sep/Oct. 1993. 
  
 
82
pp.3263-3267, June (1994). 
[61] R. M. Miller, K. E. Kwok, S. L. Shan, and R. K. Wood, "Development of a 
Stochastic Predictive PID Controller," Proc. of 1995 American Control 
Conference, Seattle, Washington, pp.4204-4208, June (1995). 
[62] J. H. Liao, C. C. Tsai and H. C. Chang, "Adaptive Generalized Predictive PI 
Control of Injection Molding Processes," Proc. of the 4th International 
Conference on Automation Technology, Hsinchu, Taiwan, pp.711-718, July 
(1996). 
[63] A. Ollero, A. Garcia-Cerezo, and J. L. Martinez, “Fuzzy Supervisory Path 
Tracking of Mobile Robots,” in Proc. IFAC Intelligent Autonomous Vehicles, 
Southampton, U.K., pp. 275-280, 1993. 
[64] C. C. Tsai, and C. H. Lu, “Fuzzy Supervisory Predictive PID Control of a 
Plastics Extruder Barrel," Journal of Chinese Institute of Engineers, vol.21, no. 
5, pp. 619-624, 1998. 
[65] T. Yamamoto, S. Omatu, and M. Haneda, "A Design of Self-Tuning PID 
Controllers, " Proc. of 1994 American Control Conference, Baltimore, Mayland, 
pp.3263-3267, June (1994). 
[66] P. R. Banerjee, and S. L. Shan, "Robust Stability of GPC as Applied to a First 
Order Model with Delay ," Proc. of 1995 American Control Conference, Seattle, 
Washington, pp.2884-2889, June (1995). 
[67] T. C. Hsia, System Identification, Lexington Books (1979). 
[68] C. H. Lu, and C. C. Tsai, "Adaptive decoupling predictive temperature control 
for an extrusion barrel in a plastic injection molding process,” IEEE 
Transactions on Industrial Electronics, vol. 48, no.5, pp. 968-975, October 
2001. 
[69] W. S. Su, and C. C. Tsai, "Discrete-time VSS Temperature Control for a Plastic 
  
 
84
附錄一、計畫成果自評 
(1)與原計劃相符程度與達成預期目標情況：本計畫的目標是針對PET吹瓶機瓶胚
之溫度控制問題，發展可省能的兩種精密溫控法則-雙自由度模糊監控廣義化預
估PID溫度控制與雙自由度適應模型參考預估溫度控制-之設計與實現製作技
術。在兩年計畫期現內，本報告先後完成以下的三個關鍵技術項目: 其一是建置
PET吹瓶機瓶胚之溫度控制系統，含DSP溫度控制技術，溫度量測模組以及PET
吹瓶機瓶胚測試平台；其二是發展雙自由度模糊監控廣義化預估PID控制器，該
控制器由一可隨室溫變化的增益排程前饋控制器，以及一隨改善溫度誤差之閉迴
路反饋模糊監控廣義化預估PID控制器所構成；其閉迴路反饋器之設計策略是針
對PET吹瓶機瓶胚之溫度控制問題，考慮其各溫度區的動態特性可以兩階帶延遲
的動態數學模型近似之，接著以參數辨識與模型匹配技術可得受控體的系統參
數，再運用廣義化預估調整法則來推導可節能的PID控制參數值公式，最後在經
由模糊監控器估算出適當的控制性能術權重因素，求取可使受控體輸出達到滿意
控制性能的最佳PID控制參數值，並獲得符合規格的設定點追蹤響應；其三是建
構雙自由度適應模型參考預估溫度控制，是以TRFNN (Takagi–Sugeno–Kang 
(TSK)-type recurrent fuzzy neural network)與適應逆向模型 (adaptive inverse 
modeling) 技術，發展可隨室溫變化的前饋控制器，並以可節能的隨機模型參考
適應預估控制方法，發展閉迴路反饋器，用以消除其誤差，達成精密溫度控制的
目的。三個關鍵技術已依計畫逐項完成，並提出一創新，有效實用的工程設計方
法，發展軟硬體的實作技術，並建置完成可進行實驗展示與實驗測試的PET吹瓶
機瓶胚之溫度控制系統。因此，本計畫已完成兩年計劃中之既定項目，但仍有兩
個實驗項目正在積極從事中，預計將於10月底結束時完成。 
 
(2) 研究成果之學術或應用價值：本計畫已建立PET吹瓶機瓶胚之溫度控制系統
所需的關鍵核心技術以及研製一台適用於工業界的PET吹瓶機瓶胚之溫度控制
國科會補助計畫衍生研發成果推廣資料表
日期:2011/10/23
國科會補助計畫
計畫名稱: PET吹瓶機之精密溫度控制器之研製
計畫主持人: 蔡清池
計畫編號: 98-2221-E-005-045-MY2 學門領域: 系統整合與工業應用
無研發成果推廣資料
碩士生 0 0 0%  
博士生 0 0 0%  
博士後研究員 0 0 0%  
參與計畫人力 
（外國籍） 
專任助理 0 0 0% 
人次 
 
其他成果 
(無法以量化表達之成
果如辦理學術活動、獲
得獎項、重要國際合
作、研究成果國際影響
力及其他協助產業技
術發展之具體效益事
項等，請以文字敘述填
列。) 
1.參與舉辦 WCICA 2011, ASCC 2011, FIRA 2011, 2011 National Symposium on 
system science and engineering (2011 NSSSE), 2011 International 
Conference on System Science and Engineering (2011 ICSSE), SIRCon 2011 
(International Conference on Sevice robots and Interactive robots). 
2. 擔任 Chair, IEEE SMC TC on Intellignet learning in control systems, 
積極推動智慧學習控制系統與其工業應用。 
3. 擔任經濟部技審會審查委員。 
 成果項目 量化 名稱或內容性質簡述 
測驗工具(含質性與量性) 0  
課程/模組 0  
電腦及網路系統或工具 0  
教材 0  
舉辦之活動/競賽 0  
研討會/工作坊 0  
電子報、網站 0  
科 
教 
處 
計 
畫 
加 
填 
項 
目 計畫成果推廣之參與（閱聽）人數 0  
 
