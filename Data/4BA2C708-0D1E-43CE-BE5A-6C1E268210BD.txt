行政院國家科學委員會補助專題研究計畫 ■成果報告   □期中進度報告 
 
基於 FPGA 之自行車自動變檔控制器設計 
Development of a FPGA Based Aotomatic Bicycle Derailleur Shifiting Controller 
 
計畫類別：■個別型計畫   □整合型計畫 
計畫編號：NSC   100－2221－E－309－008－ 
執行期間： 2011 年 08 月 01 日至 2012 年 07 月 31 日 
 
執行機構及系所：長榮大學科技工程管理學系 
 
計畫主持人：陳宗正 
共同主持人：陳宗禧 
計畫參與人員： 
 
 
 
成果報告類型(依經費核定清單規定繳交)：■精簡報告  □完整報告 
 
本計畫除繳交成果報告外，另須繳交以下出國心得報告： 
□赴國外出差或研習心得報告 
□赴大陸地區出差或研習心得報告 
■出席國際學術會議心得報告 
□國際合作研究計畫國外研究報告 
 
 
處理方式：除列管計畫及下列情形者外，得立即公開查詢 
            □涉及專利或其他智慧財產權，□一年□二年後可公開查詢 
 
中   華   民   國  101 年 09 月 30 日 
 
 
系統等更為適用。其缺點在於需建立一套系統性設
計，以及有效度(Validity)之規則。 
2.3. 研究主題 
 本研究主要是設計一個模糊邏輯控制器，根據
由霍爾感測器接收計算的二個輸入變數車速、踏速，
以及自行車目前的檔位(Gear)，預測下一個檔位
(Next Gear)， 利用控制直流馬達(Direct-current 
Motor)正反轉動，驅使拉動收線裝置進而達到自行
車自動變速之功能，並以閉迴路系統控制方式不斷
的進行檔位推論及變換。 
 以下章節，依序為第三章系統架構，提出主要
的架構分析及模糊控制器設計、第四章實驗模擬，
實驗模糊控制器各部分硬體電路模擬波形圖、第五
章結論。 
3. 系統架構 
 本研究以模糊控制系統設計一個自動化自行
車變速控制器。以感測器接收車輪轉動及踏板轉動
量來計算車速與踏速，將車速與踏速及目前檔位導
入模糊控制器中藉以推論下一檔位的值，接著將下
一檔位告知馬達控制器，驅使馬達拉動變速裝置進
行變速。 
 如圖 2，架構流程主要分為兩部分，由持續進
行資料擷取並暫存的車速、踏速部分及模糊控制器
推論與檔位變換部分所構成。由於車速與踏速為持
續變動量，因此必須持續進行運算且暫存才可給予
控制器做推論運算。而控制器部分由於為一連串運
算控制流程故而必須週期性的運作以確保推論正
確。 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
圖 2. 架構流程 
3.1. 模糊控制器設計規劃 
 在[1]文中提到，固定大盤以單純調變飛輪方
式來做變速對一般使用者而言，可在舒適、與競速
的模式中快速切換，提供一個簡易的選擇。在車速
及踏速的模糊化過程，分別各以七種模糊語意作為
描述。而模糊推論與解模糊化介面的方式有許多種，
由於本研究是以純硬體描述語言在硬體電路上實
現控制系統，因此為了得到系統設計上的簡化，本
研究採用以中心平均解模糊化法(Center Average 
Defuzzification)來作為解模糊化介面，並以
Min-Product-Max 推論方式來作為推論機制。 
 運算流程首先進行將車速與踏速感測訊號轉
成車速與踏速值(式 1,2)，接著進行模糊化轉換為所
設定的各種模糊語意(式 3,4)。 
 
                                      (1) 
)()(
)()(
1000T
3600
公尺轉動週期
秒輪胎周長
×
×= PSpeed
 
 
 
                                      (2) 
)(
)(
T
60
Cadence
轉動週期
秒=
 
 
 
 
 
 
                                      (3) 
 
 ⎪
⎪⎪
⎪⎪
⎩
⎪⎪
⎪⎪
⎪
⎨
⎧
≤≤≡
≤≤≡
≤≤≡
≤≤≡
≤≤≡
≤≤≡
≤≤≡
=
45x36VF
40x26F
31x18AM
28x15M
27x14BM
20x10S
13x0VS
  (x)u
Speed
Speed
Speed
Speed
Speed
Speed
Speed
Speed
 
 
 
 
 
                                      (4) 
 
 
 
⎪⎪
⎪⎪
⎩
⎪⎪
⎪⎪
⎨
⎧
≤≤≡
≤≤≡
≤≤≡
≤≤≡
≤≤≡
≤≤≡
≤≤≡
=
100y80VF
91y72F
85y53AM
80y38M
65y31BM
45y18S
25y0VS
  (y)u
Cadence
Cadence
Cadence
Cadence
Cadence
Cadence
Cadence
Cadence
接著對各語意進行 Min-Product-Max 推論，首先進
行各個語意的取小運算，由於有 7 種車速與 7 種踏
速，因此總共會得出 49 種權重值(式 5)。 
{ }
49,...,3,2,17,...,3,2,17,...,3,2,1
)(),(min)()(
===
=∧=
kji
yuxuyuxuW iCadenceiSpeediCadenceiSpeedk (5) 
再來對於檔位的輸入，本研究將其單純為選擇每種
規則平面的選擇。再將所選中的規則平面上的 49
種規則與 49 種權重進行 dot product 運算，得到 49
種輸出權重(式 6)。 
           (6) 49,,...3,2,1)()( =⋅= izRwzR iii
最後將其全部合成為最後之輸出權重結果。(式 7) 
           (7) { }{ 49,,...3,2,1)(max)( == izRzR i
再以中心平均法求得最終推論輸出 z 之結果，作為
最終結論。(式 8) 
∑
=
= 49
1
)(
i
wi
zRz             (8) 
在圖 7 中，系統一開始會由上層載入本輪推算
的四個規則點 PointA~D，接著會劃分為四個區域分
別為： 
Point A ≤ Goal < Point B :=區域1 
Point B ≤ Goal ≤ Point C :=區域2 
Point C < Goal ≤ Point D :=區域3 
       Otherwise      :=區域4 
當目標點坐落於區域 1 時，可由式 9 求得隸屬
度；當坐落於區域 2 時則隸屬度為 1(100%)；當坐
落於區域 3 時可由式 10 求得隸屬度；當坐落於區
域 4 時則隸屬度為 0。 
 
 
 
 
 
 
 
 
 
圖 8. 三角隸屬函數運算流程 
APoint  -BPoint 
APoint -Goal =ans
    
  (9) 
CPoint  -DPoint 
Goal -DPoint =ans       (10) 
 當規則點如圖 8 所示，B 與 C 點坐落於同一
點時，則可推得為三角隸屬函數。因此同樣當區域
2 與區域 4 隸屬度分別為 1 與 0，而另外兩區域同
以式 9、式 10 算得。 
 而在硬體電路設計方面，在載入各個規則點與
目標點後，必須先經由加減控制器來進行運算，其
後再以暫存器作為儲存。控制單元部份會由計數器
來了解目前狀況，接著給予各個應當進行的運算，
其中當判斷結果為區域 2 與區域 4 時，由於可直接
由多工選擇器進行輸出選擇，因此可以在一個
Clock 內完成，其餘皆須經過數個 Clock 才可運算
完。 
 
圖 10. 隸屬函數硬體電路架構 
 Gear Membership 區部分則將其作為選擇規則
所使用之選擇訊號，由於擁有三種輸入集合之規則
排列組合，因此取其中的離散之輸入訊號-檔位為選
擇關鍵。當有檔位訊號載入後便會判斷其值來選擇
應該輸出的 49 個規則之規則表。 
 
圖 11. 檔位隸屬函數硬體電路架構 
 
3.2.3. 模糊推論區(Fuzzy Inference) 
 模糊推論部分使用Min-Product-Max推論的運
算，以比較器來進行取小值計算。如圖 12 所示，
以比較器將比較結果作為輸出。 
 
圖 12. 模糊推論硬體電路架構 
 
 
 
 
 
圖 13. Min-Product-Max 中心平均解模糊化法 
3.2.4. 解模糊化區(Defuzzification) 
 解模糊化處理部分使用中心平均法來進行。因
此在下層中如加法、乘法、除法等運算皆由各自所
屬之處理器進行。加法部分負責將所有數值最總合，
乘法則將各數值相乘，除法則是最後進行。各部分
皆由計數器來對控制單元控制時脈並且了解各部
分是否運算完成才進行下一步運算。 
 
 
 
 
 
 
圖 14. 解模糊化硬體電路架構 
4. 實驗模擬 
 為了確認各部分系統運算結果，本文以 Altera
模擬軟體 Quartus II 內 Simulation 功能模擬輸入、
輸出值，確認各部分系統皆可正常搭配應用。 
4.1. 車速、踏速模糊化區模擬 
 在訊號模擬部份，本文以 50MHz 的 Clock 為
時脈，CKE 為輸入致能訊號。本次模擬假設車速
(Speed)為 9 km/hr、踏速(Cadence)為 57 rpm 時，當
收到 Done 訊號為 1 表示輸出值已是推論結果，結
果得到 Speed_VS 隸屬度為 30%、Cadence_BM 隸
屬度為 34%、 Cadence _M 隸屬度為 86%、
Cadence_AM 隸屬度為 18%、其餘隸屬度皆為 0%。
各個腳位功用如下表列。 
  
 
 
 
 
 
 
 
 
 
 
 
圖 18. 解模糊化區波形模擬圖 
4.5. 模糊控制器主層級模擬 
 本次模擬當目前檔位(Gear)為 4 檔、車速
(Speed)為 23.85 km/hr(45 53%)、踏速(Cadence)為 76 
rpm 時，再經過約略 4us 的時間運算後，收到 Done
訊號為 1 表示輸出值已是推論結果。推論結果(Next 
Gear)為 5 表示應從原本 4 檔升為 5 檔，與車速為
23.85 km/hr、踏速為 76 rpm 所應採取之變速策略升
檔相同，因此模擬結果正常。 
表 5. 模糊控制器主層級腳位說明 
PIN 用途 
Fuzzy_Controller_CKE Clock 致能 
CLK Clock 
Speed 目前車速 
Cadence 目前踏速 
Gear 目前檔位 
Next_Gear 推論檔位 
Done 完成訊號 
 
 
 
 
 
 
 
 
 
 
 
圖 19. 模糊控制器主層級波形模擬圖 
5. 結論 
 最後以實體進行模擬時，將使用者介面設計於
DE2板上。由右而數依序為踏速值(三個七段顯示器
表示)、車速值(兩個七段顯示器表示)、檔位值(一個
七段顯示器表示)、應換檔位值(一個七段顯示器)。
在運作上可正常依模糊控制器推論結果來進檔與
退檔。 
 
圖 20. 實體使用者介面 
 本研究以現有多功能實驗平台 DE2來進行實
驗測試，此平台於功能上較為多樣但缺點再於體積
過大未適合實際應用，未來可將其功能移植於較小
之晶片來進行控制運作，以節省實際所佔用之面積。
再者，本研究主題為休閒騎乘，但是實際自行車運
用上並不止於此項。因此未來可針對各式各樣騎乘
主題如復健、競速、健身等，將其分類設定。並可
透過類神經網路來對於規則進行訓練，予其最佳化
並給於使用者可適性之調整，令其可屬於個人化之
自動變速。 
 
本研究主要目的是從人性化的角度、創新的思維設
計變更已固有的人力腳踏的輕便運輸工具、及休閒
娛樂設備為主。為達到滿足省力、輕便、效能、健
康等多方面的訴求，腳踏車自動變速控制器儼然為
主要的關鍵系統。此自動變速系統除了智慧型控制
單元外，其控制前後齒輪比之機電單元及動力傳遞
單元，決定此系統執行的效率與人性互動的主要觀
感。因此，提供更多參數之智慧型控制單元及、設
計更具效率之齒輪比控制單元、及動力傳遞單元簡
化騎乘自行車的操作模式，改變使用者的使用意願，
除了是研究的主要課題外，在未來產學推廣中唯一
主要決定因素。 
6. 參考文獻 
[1] 陳宗正、郭桓孝、林穎宏(2010 年)，＂模糊邏
輯控制於自行車變速策略之研究＂，中華民國
第十八屆模糊理論及其應用研討會，國立東華
大學電機工程學系。 
[2] C. Stone and M. L. Hull (1995), “The Effect of 
Rider Weight on Rider-Induced Loads during 
Common Cycling Situations”, Journal of 
Biomechanics, Vol. 28, No. 4, pp.365-375. 
[3] C. K. Cho, M. H. Yun, C. S. Yoon and M. W. Lee 
(1999),“An Ergonomic Study on the Optimal 
Gear Ratio for a Multi-speed Bicycle”, 
International Journal of Industrial Ergonomics, 
No. 23, pp.95-100. 
[4] E. H. Mamdani and S. Assilian (1975), “An 
experiment in linguistic synthesis with a fuzzy 
國科會補助專題研究計畫項下出席國際學術會議心得報告 
                                     日期：100年9月20日 
計畫編號 NSC  100 － 2221 － E － 309 － 008 － 
計畫名稱 基於 FPGA 之自行車自動變檔控制器設計 
出國人員
姓名 
陳宗正 
服務機構
及職稱 
長榮大學科技工程與管理學系 
助理教授 
會議時間 100 年 8 月 21 日至  100 年 8 月 25 日 會議地點 新加坡 
會議名稱 
(中文) 第八屆 IEEE 亞太無線通訊研討會 
(英文) 8th IEEE Asia Pacific Wireless Communication Symposium 
發表論文
題目 
(中文) 用於車載隨意行動網路之交通資訊模型建構  應
(英文) An Approach to Modeling Traffic Information in Vehicular Ad 
Hoc Networks 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
1 
 
 
3 
 
 
二、與會心得 
1. 行程規劃與參觀團體 
此次新加坡 APWCS 2011 研討會，因台灣此領域相關學者參與踴躍。有鑑於此，台北
科技大學電子工程學系林丁丙教授抱持台灣學者服務的精神，組成新加 APWCS2011 研討
會參訪團，並由桃園雄獅旅行社負責行程規劃，不僅簡化旅程的繁複，更使得來自各大學
及研究單位的學者前輩能齊聚一堂，在新加坡五天滯留的時間能彼此分享教學、研究經驗、
及成果分享。在此旅行中，有幸得與台北科大林丁丙教授、及南台科大余兆棠教授相處，
在短暫的幾天中，對嵌入式系統及通訊的進代台灣發展趨勢能更進一層的認識。 
 
  2. 大會議程與參與研究方向 
 此次大會議程安排十分緊湊，且與會學者、專家在通訊相關領域均有傑出的研究。雖
然只是亞太地區的研討會，但因亞太地區的獨特性，由別於美國、歐洲，亞太地區亦發展
地域相關的通訊技術。例如新加坡本島的公路完善，擁有 10 多條高速公路貫穿全島，為了
控管高峰時段進入市中心的車輛流量，新加坡是全球第一個採用電子道路收費系統(ERP)
的國家，此 ERP 系統亦是各國模仿的對象。因此，科技應用的相似性，亦是大會討論的要
點，其熱絡程度可想而知，除了會議進行時的討論外，Coffee Break 時間，亦可看到來自
各地的學者互相討論、或對發表作者進行交流。這些現象是在國內研討會中不易多見的現
象，值得國內研討會主辦單位省思。另外，在國際研討會中，可常見老師與學生共同參與，
而使得在互相交流中，所提出的問題與回答能夠適切與主題關聯，而達到研討會的目的。
但在國內研討會中，常見學生單獨赴會，在報告完後即離開會場，而失去了互相研習的機
會，對主辦國內研討會的單位亦是一個難以掌控的議題。 
 
3. 大會專題演講與心得 
此次口頭報告論題目為”An Approach to Modeling Traffic Information in Vehicular Ad 
Hoc Networks”，發表論文主要是針對在車載系統中交通資訊的擷取與萃取的技術，得以使
駕駛在短時間掌握區域性的交通流量，進而避免交通壅擠所伴隨而來的時間、金錢、油耗
5 
 
前教育政策與方針，不再有，卓越大學與名校情節，而該針對卓越研究型大學與卓越教學
型大學分隔，研究型大學致力於研究，教學型大學致力於教學，才不至於浪費更多教育資
源。 
   
三、建議 
我對此新加坡 APWCS 2011 研討會的感覺是學術交流與國際視野開拓的重要性。身處
於國際間各種專業領域多位知名學者的交流的過程中，從提問與答辯間，不僅解答許多的
疑惑，更學習到對問題深入、廣度的探討；亦在私下討論時，了解各領域學者間所關注的
焦點，使我們對整體研究趨勢脈動有些許的了解，有助我們掌握新的研究方向。因此，期
盼教育部或國科會往後能繼續大力支持補助國內研究學者、年輕老師、博士生，甚至碩士
生，參與國際學術會議，開拓其國際視野；同時，也希望能多多補助支持國內大專院校，
承辦一些大型國際會議，藉由參與見習國際會議，製造研究熱忱的氛圍，增加與國外學者
進行交流的機會，亦可提升台灣在國際上的知名度。另外，新加坡此行參訪行程觀察中，
亦發現新加坡研究學者與大學生在實作方面能力很強，且與課程緊密結合，且學校與業界
互動熱絡與頻繁亦是我們不及之處。在以前，新加坡以台灣為借鏡，發展出自己的特色。
如今這些都是我們可以學習之處。 
四、攜回資料名稱及內容 
與會後攜回的主要資料，除了本次會議的詳細議程外，以及 VCD 及一本大會論文摘要集。 
五、其他 
 本次經費支出係由國科會專題計劃(NSC100－2221－E－309－008－ )出國經費補
助。感謝訪問團團長台北科技大學電子工程學系林丁丙教授的組織安排，促進了本次
APWCS 研討會的交流。 
 
 
 
 
 
 
 
 
 
 
 
Invited Talk I, Mr. Seizo 
 
 
 
 
Invited Talk II, Dr. Hyun Kyu Chung 
 
 
 
 
 
7 
 
 
 
 
 
 
 
APWCS 2011 研討會團員合影 
9 
 
100年度專題研究計畫研究成果彙整表 
計畫主持人：陳宗正 計畫編號：100-2221-E-309-008- 
計畫名稱：基於 FPGA 之自行車自動變檔控制器設計 
量化 
成果項目 實際已達成
數（被接受
或已發表）
預期總達成
數(含實際已
達成數) 
本計畫實
際貢獻百
分比 
單位 
備 註 （ 質 化 說
明：如數個計畫
共同成果、成果
列 為 該 期 刊 之
封 面 故 事 ...
等） 
期刊論文 0 0 100%  
研究報告/技術報告 0 0 100%  
研討會論文 1 1 100% 
篇 
 
論文著作 
專書 0 0 100%   
申請中件數 0 0 100%  專利 已獲得件數 0 0 100% 件  
件數 0 0 100% 件  
技術移轉 
權利金 0 0 100% 千元  
碩士生 1 1 100%  
博士生 0 0 100%  
博士後研究員 0 0 100%  
國內 
參與計畫人力 
（本國籍） 
專任助理 0 0 100% 
人次 
 
期刊論文 0 1 100%  
研究報告/技術報告 0 0 100%  
研討會論文 0 1 100% 
篇 
 
論文著作 
專書 0 0 100% 章/本  
申請中件數 0 0 100%  專利 已獲得件數 0 0 100% 件  
件數 0 0 100% 件  
技術移轉 
權利金 0 0 100% 千元  
碩士生 0 0 100%  
博士生 0 0 100%  
博士後研究員 0 0 100%  
國外 
參與計畫人力 
（外國籍） 
專任助理 0 0 100% 
人次 
 
