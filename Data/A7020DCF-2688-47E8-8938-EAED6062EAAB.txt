 2
 
(b) 
圖 1、(a)X-Y stage; (b)驅動器介面[3] 
2.1 Type 3系統簡介 
在精密製造工業中，CNC 工具機一直扮演著很重要的角色，隨著電腦科技的演進，
CAD/CAM 軟體已經被廣泛的應用在不同的工業技術上。本研究是藉由 Type3 軟體中的 CAD 
(Computer-Aided Design)功能規劃設計出輪廓與刀具路徑，再利用 CAM (Computer-Aided 
Manufacture)的功能以直線或圓弧近似的方式產生 NC加工碼，來設計加工路徑。圖 2為設計加
工流程中的 Type 3軟體系統畫面。 
 
2.2 GM Code簡介 
吾人為了使所開發的程式接近實際工業需求，因此不直接撰寫 GM Code，而是使用 Type 3
系統軟體來產生 G Code (Graph Code)和M Code (Machine Code)之 NC (Numerical Control)加工
碼，這種方式可以避免撰寫 GM Code時發生錯誤，並能使所有的圖型都能以 NC加工碼呈現。
其中 G Code是加工圖形碼，又稱為準備機能碼，M Code 則為輔助機能碼。G Code從 G00至
G99 共有一百多個程式指令，但真正直接影響加工運動軌跡的只有表 1 所列的幾個 G Code 指
令。其他的加工碼大多是機台的控制碼，如刀具補正、座標系統選擇等[6]。 
 
2.3 人機介面與 Data Type 
吾人所設計的人機介面應用程式之主要目的在於提供使用者一個友善的人性化操作介面，
透過該介面可以使原本複雜且難懂的 NC 加工碼轉換成容易閱讀的十六進制碼，並儲至隨身碟
內，進而傳送至控制機台上的運動控制器以模擬進行加工動作。而為了達到簡化操作面板使用
上的複雜性，卻又不失其強大功能，因此吾人選用 Borland C++ Builder（BCB）作為設計與開
發系統的軟體工具[8-9]。 
 
 4
 
 
1 
2 3 4 5 6 
   
             圖 3、轉檔程式人機介面              圖 4、Binary檔 
 
 
5) Save 
    吾人將經過上述步驟轉換完畢的加工碼轉換成十六進制碼，並以 Binary 檔的形式儲存至指
定的位置，在此吾人將把資料儲存至 USB上，進而傳輸至控制機台上，進行模擬加工的動作。
圖 4為轉換完成的 Binary Code檔。 
 
三、資料傳遞及實現 
    線性馬達由馬達驅動器所驅動，馬達驅動器介面如圖 1(b)所示[3]。驅動器設計可以接受
V-command的類比信號命令，也可以接受 Pulse Command的數位脈波信號命令。驅動器的信號
形式採用差動 Line Driver形式，吾人在介面的設計上採用 75174及 75175兩顆 Line Driver IC
處理信號準位與轉換問題。在控制器端由 DDA (Digital Differential Analyzer)系統輸出的單端信
號被轉換成差動的信號；而作為脈波回授，由驅動器輸出的差動 Encoder Feedback信號也被轉
成單端信號後送至控制板。 
 
                表 2、控制器各元件說明 
A. Power G. FPGA configuration connector 
B. LCM connector H. EEPROM 
C. Keypad connector I. FLASH 
D. GPIO J. FPGA 
E GPIO K. USB host chip 
F. GPIO L. USB connector  
 6
3.1 DDA 
XY 定位平台接受運動控制器的脈波信號，由輸入馬達驅動器的脈波信號數量與疏密則可
以用來控制馬達移動的距離及速度。控制輸入脈波信號的疏密可由 DDA 插值技術來實現；使
用 DDA 插值技術可使馬達達到多軸同動的目標。 
DDA插值器接收到控制器的定位命令(馬達移動或轉動的脈波數)及執行時間後，經過 DDA
解算後即可將所需的脈波均勻送出，使馬達在此時間內等速度移動或轉動。以 DDA 來控制梯
形運動形式的馬達轉速與命令週期關係可以由圖 6來說明。在圖 6中， t∆ 為命令週期，我們需
要在每一週期內將設定的步數以脈波均勻送出，在同一命令週期步數越多馬達移動或轉動越
快；相反的命令週期越短，步數若是相同則馬達運轉仍是越快。圖 7 說明 DDA 插值器的原理
架構圖，Iteration clock f 可決定命令週期。其演算法的實現步驟說明如下： 
步驟 1. 設定 clock 的觸發次數。 
步驟 2. 將欲移動脈波數載入至 p register。 
步驟 3. 未觸發前的 q初始值為 0，及 q(k=0)=0，即 q(0)=0。 
步驟 4. 每次觸發時做下面的動作： 
    IF 12)1( −>+− npkq              (1) 
       npkqkqkz 2)1()(,1)( −+−==∆            (2) 
    ELSE 
 pkqkqkz +−==∆ )1()(,1)(                         (3) 
 
以 3bits DDA為例，開始時 q register 設為 0，將需要輸出脈波數載入 p register，在 clock
觸發信號送來時，q register 和 p register 相加，若發生溢位，則 z∆ 為 1，再將運算結果經過
mask回存至 q register，若是沒有溢位發生，則直接將運算結果回存 q register。 
圖 8 為模擬 DDA 脈波輸出情形，吾人將欲輸出的脈波數設定為 5 個脈波，所以在相同的
時間內，輸入為 8 個脈波，輸出為 5 個脈波；圖 8 中 DDA 的輸出結果並非很均勻的分配，原
因在於所設定的 bit 數為 3，如果提高此 bit數則可改善分配不均勻的問題。在此是為了能夠較
明顯的表現出輸入為 8個脈波而輸出為 5個脈波，所以才將控制 bit數設為 3。圖 9為模擬 X與
Y兩軸同步情況，模擬在 8個脈波周期內，X軸位移 5個脈波單位，而 Y軸位移 4個脈波單位。 
 
 
圖 8、DDA脈波輸出 
 
 8
進馬達，實現定位平台系統，應用實現的定位控制成果如圖 12所示。 
 
五、結論 
本研究成功利用 FPGA執行即時多軸運動控制系統設計，利用 Altera Cyclone II FPGA所設
計的多軸 DDA接受利用 Type 3系統所規劃的 NC碼，並均勻的將控制脈波信號送到馬達驅動
器。不論原本的 XY 兩軸線性馬達定位平台，或者為應用而設計的步進馬達驅動滾珠導螺桿三
軸 XYZ系統，運動控制器皆能準確的完成所規劃的路徑軌跡。 
 
六、參考文獻 
[1] Quartus II Version 6.1 Handbook Volume 1: Design & Synthesis, http://www.altera.com/. 
[2] http://www.altera.com/, Cyclone II FPGA data sheet. 
[3] HIWIN linear motor series data sheet. 
[4] http://www.itri.org.tw/index.jsp, Industrial Technology Research Institute 
[5] 鍾國峰，NURBS與DDA差值器在運動控制上的整合設計，碩士論文，中山大學機械與機電
學系，93年7月。  
[6] 何昆霖，架構在嵌入式XP作業系統與FPGA的運動控制器系統設計，碩士論文，勤益技術學
院資訊與電能研究所，94年7月。  
[7] 鍾華玉、陳添鎮，”MasterCam 2D繪圖與加工教學手冊”， 修訂版，全華科技圖書公司，民
國89年。  
[8] 洪國勝、江國軍、龍國忠、洪月裡，C++ Builder6程式設計，旗標出版股份有限公司，民國
93年。  
[9] 蔡孟凱，雷穎傑，黃昭維，陳錦輝，陳正凱，“C++ Builder 6完全攻略”，初版， 金禾資訊
股份有限公司，2004。 
 
七、計畫成果自評 
    本研究計畫設計同動運動控制器，利用 FPGA所設計的 DDA系統，接受來自於 USB的位
置命令信號，並反應在 XY平台上。所設計的系統經實際製作成電路板，並利用 CAD/CAM軟
體實際設計加工圖形，並獲得所相對應的 NC加工碼；為了配合控制器的設計格式，NC加工碼
並進一步的被轉換成為二進碼的型式加以儲存。所設計的系統並實際以另一個具有第三軸的彫
刻機系統加以應用，實際驗證的成果顯示所設計的系統，具有精簡而且小型化的體積，在功能
上並符合多軸快速暨同動運動的目標。 
