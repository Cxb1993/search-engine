2原因，許多相關研究[3][4][5]探討了關於內
容的管理和儲存分派問題。但是以上文獻
所提出的儲存分派機制對於網路業者來說
似乎是不可行的，因為許多用於最佳化的
參數並不容易估測或取得。所以在本計劃
中，我們提出一個精準簡單的方法來達成
最佳的資源配置。在本計畫中，我們擬對
整個內容網路從網路效能與營運者的成本
(Cost)兩大因子來考量，以規劃出一個好的
內容網路及其管理策略。
另一方面，數位內容的保護(Protection)
與版權的管理(Rights Management)也是刻
不容緩的事，一般把有關數位內容的保護
(Protection)與版權管理的機制統稱為數位
版權管理 (Digital Rights Management，
DRM)。在數位版權管理方面，相關的文
獻是不少，如[6][7][8][9][10]等。在這些有
關數位版權管理的文獻中，主要探討的問
題包括數位內容的架構、加解密演算法以
及金鑰的管理等。但有關金鑰傳送協定的
部分卻相當稀少，如[8][10]。而金鑰的傳
送成功與否永遠與網路的品質好壞有關，
故截至目前為止，尚未有十全十美的金鑰
傳送協定存在，試想當客戶訂閱了加密影
片，卻因金鑰的遺失而無法收視該訂閱影
片時會產生什麼樣的後果呢?當然會讓使
用者降低收視加密影片的意願，這便又會
對加密的優質影片製造商產生打擊。所以
本計畫擬針對金鑰傳送的技術做一深入的
探討與研究，期能提出一套有效的方法來
解決金鑰傳送的問題。
雖然在網路的封包傳送方法中，有可
靠的連接導向之TCP協定，但在DRM系統
中，基於反應時間(通常要小於3 秒)與伺
服器支援容量(必須能提供10%用戶同時
存取)的考量，TCP是有其致命的缺點的。
於是只好採用不可靠的UDP協定，但為了
達到低遺失率的目標，便必須設計一些認
可(Acknowledgement)機制，對於這方面的
文獻探討似乎少了點，然UDP被用在網路
時間協定(Network Time Protocol，NTP)[11]
的觀念與作法，似乎值得參考，本計畫將
依此提出一套方法來解決金鑰傳送的問
題。
二、內容網路之架構設計
為了達成節省內容網路成本與提高效
能的目的，本計畫提出一種新的內容網路
架構，在此架構中，視訊伺服器被分成許
多對等服務區，所有的區域視訊伺服器都
透過骨幹網路來互連。每個服務區包含一
群視訊伺服器，如圖 1 所示。而為了達到
最小成本內容網路 (Least-Cost Content
Network)的目的，我們將所有的視訊伺服
器分成二種類別：第一類(Type 1)和第二類
(Type 2)。第一類視訊伺服器負責儲存點閱
率較高的數位內容，第二類視訊伺服器負
責儲存其他點閱率較低的數位內容。譬如
點閱率排名前 60%的數位內容儲存在第一
類視訊伺服器，而其他 40%的數位內容則
儲存在第二類視訊伺服器。
圖 1：內容網路架構與視訊伺服器配置圖。
如果有些區域沒有第二類視訊伺服
器，如圖 1 所示，則所有位於在第二類視
訊伺服器的數位內容之請求便會被重導向
(Redirect)到鄰近擁有第二類視訊伺服器的
服務區。在這個情況下，上述的架構在邏
輯上便相當於階層式架構，此時第二類視
訊伺服器為高階(High Tier)，而第一類視訊
伺服器則是低階(Low Tier)。當然，重導向
服務會導致頻寬消耗增加與服務品質(QoS)
的降低。因此，在進行內容網路成本最佳
化時，我們必須同時考慮到整體內容網路
的儲存空間與頻寬成本。
4{ minimum_cost = f(n);
update N1 = n ;
}
}
compute V1 using (2);
return N1 and V1 as the optimal solutions;
}
當解出最佳解 N1 和 V1 後，我們便可計算
出在此架構所能節省的儲存空間之比率，
其計算式如下：
 
.1
1
1
1
1
1
1
1





 N
i
i
N
Ni
i
N
i
i
mV
mVVmV
S (5)
在方程式(5)中，S 的值越大，節省的儲存
空間就越多。
(二)內容管理策略與演算法
數位內容管理者可以很容易地統計出
在一個管理週期內所有數位內容的點閱次
數，進而分析各自的點閱率。因為數位內
容管理包含上傳和發佈新內容、搬移數位
內容、刪除數位內容，以及更新重導向路
徑(Redirecting Paths)等機制，所以統計點
閱率的管理週期不能太短，否則會造成視
訊 伺 服 器 和 骨 幹 網 路 負 載 過 重
(Overload)。然而，因為大部分人每星期的
作息習慣還算規律，因此我們認為以一星
期為管理週期是蠻適當的。當數位內容網
路管理者獲得點閱率的資訊後，便可利用
上一小節的最佳化演算法，去算出每部視
訊伺服器所需儲存的數位內容之最佳數
量，以及配置第一類和第二類視訊伺服器
的數量。接下來，對於編號 i 的數位內容，
我們可以定義一個狀態變數 iX 如下



.,0
,,1
訊伺服器個影片儲存在第二類視若第
訊伺服器個影片儲存在第一類視若第
i
i
X i
並令 iX 和

iX 分別為編號 i 的數位內容的
目前狀態 (Current State)和新狀態 (New
State)，要注意的是此處的 i 是指該數位內
容的媒體編號(Media ID)，而非其點閱率的
排序編號。接著，再定義  iii XXX ，
並以其作為內容管理動作的依據，則包含
更新與刪除動作的內容管理行為就可以輕
易地根據 iX 來達成。首先，我們考慮在
每部視訊伺服器的類別不改變的情況下之
運作方式：
(a) 所有新上片的數位內容必須儲存在第
一類視訊伺服器，並且設定其狀態值
iX 為 1。
(b) 如果編號 i 的數位內容的 1 iX ，則把
該數位內容上傳到所有的第二類視訊
伺服器，且更新其網址(URL)至適當的
第二類視訊伺服器。接下來，把 iX 值
設為 0，並且將此影片從所有的第一類
視訊伺服器中刪除。
(c) 如果編號 i 的數位內容的 1 iX ，則
把該數位內容上傳到所有的第一類視
訊伺服器，且更新其網址(URL)至適當
的第一類視訊伺服器。接下來，把 iX 值
設為 1，並將此數位內容從所有的第二
類視訊伺服器中刪除。
(d) 如果編號 i 的數位內容的 0 iX ，則
無需做任何動作。
當一部視訊伺服器從第一類變成第二
類時，則刪除所有 0 iX 的數位內容，並
且從最近的第二類視訊伺服器上傳其他的
數位內容。如果視訊伺服器從第二類轉變
成第一類，則刪除所有 0 iX 的數位內
容，並且從最近的第一類視訊伺服器上傳
其他的數位內容。
(三)數值結果
我們採用模擬方法去產生數位內容的
大小(Content Size)，我們考慮三種數位內
容大小可能的分佈，包括常態分佈(Normal
6過某一臨界值時，V1 會突然下降到某一個
特定的值。因為當 p 值大到某一程度時，
為了減少因重導向服務所需付出的巨大成
本，所以只好在每個服務區配置至少 1 部
第二類視訊伺服器，以避免重導向的情況
發生而省去了額外的巨大成本。在圖 4
中，當 V0 為 5 時，也就是代表有 100 個服
務區，如果要免去重導向服務的發生，就
至少要配置 100 部第二類視訊伺服器(V2
=100)，所以 V1 = V V2 必須小於或等於
400。
基於上面的數值結果，我們已大致得
知 p 對內容配置的影響。我們在這裡將說
明一下如何決定出適當的 p 值。我們以企
業常用的磁碟陣列設備和租用專線為例，2
Tbytes 磁碟陣列的價格大約為新台幣
26000 元(假設使用期限為三年)，租用 622
Mbps 的線路的月租費為 419100 元，若考
慮三年的時間所需花費的成本，則根據(3)
式我們可得出 p = 3638.5。以此數據來說，
我們發現頻寬的成本遠遠大於硬碟成本，
因此，為了避免重導向服務而增加成本，
就必須在各服務區至少配置一部以上的第
二類視訊伺服器。
綜合以上的結果，我們認為在頻寬成
本遠大於硬碟的情況下，應儘可能避免重
導向服務，所以各服務區均需配置第二類
視訊伺服器。換言之，每一服務區都含有
第一類與第二類視訊伺服器，在此情況
下，我們便可針對各個服務區利用本計畫
所提出的方法獨立地去進行最佳化。此時
可將(4)式的成本函數中的第三項拿掉，並
將 V 改成 V0，如下所示：



N
Ni
i
N
i
i mVVmVNf
1
10
1
11
1
1
)()( (7)
在(7)式中的 V1 是各區的第一類視訊伺服
器數目，而不是全區的第一類視訊伺服器
數目。獨立地對各服務區進行最佳化具有
以下幾點優點：
(a) 可適用在各服務區用戶數不同的環
境中。
(b) 可適用在各區點閱率分佈不同的環
境下，因為當各服務區的用戶屬性
不同時，常會有不同的點閱行為，
因而造成點閱率分佈也不相似。
(c) 最佳化與懲罰參數 p 無關。
四、數位版權管理系統之金鑰傳送技術
(一)金鑰傳送協定設計與分析
本計畫在DRM 部分擬研究的課題主
要在於金鑰傳送的可靠度(Reliability)上，
由於網路可能會有瞬斷或中繼節點緩衝器
溢位(Buffer Overflow)的現象發生，所以可
能造成傳送的金鑰遺失，使得用戶端機上
盒無法對加密影片解密，產生用戶無法收
視的問題，所以必須針對網路遺失問題設
計一種可靠的傳送協定來遞送金鑰。雖然
連接導向的 TCP 可達成可靠的金鑰傳送，
但是 TCP 需要事先建立連線，所以會耗費
一些連線建立時間。其次，對伺服器而言，
如果每傳送一筆金鑰便要建立一條連線並
且維持該連線至金鑰傳送完成，此種方式
會佔去很多伺服器的資源，對授權伺服器
而言，是很難達到同時支援大量用戶需求
的。如果無法即時迅速的將金鑰傳送到機
上盒，同時又無法支援大量用戶同時使
用，那便不是一個好的數位版權管理系
統。因此，為了克服上述兩項缺失，我們
只好採用非連接導向的 UDP 傳送方式來
遞送金鑰，由於 UDP 能夠縮短金鑰抵達的
時間，同時也不會耗費太多伺服器資源，
所以可以支援大量用戶同時使用的需求。
但採用 UDP 的唯一缺點便是當資料遺失
時，無法像 TCP 一樣自動重送， 不過卻
可透過用戶端機上盒的回覆認可與伺服器
的 Timeout 機制來達成。
基於上述的說明，本計畫提出一種可
行的機制並加以分析。此方式是授權伺服
器每次會將金鑰以相同的 UDP 封包送出
M 個，同時對這 M 個封包啟動一相同的
Timeout 計時器，而這 M 個 UDP 封包儘
可能經由不同的 port 輸出，以達到多路徑
8到達率(Arrival Rate)則假設為每秒 2000
個，於是從DRM Server每秒便會送出 2000
個金鑰到該服務區的客戶端機上盒；金鑰
的長度設為 188 bytes。
我們以 Traffic generator 1 產生背景資
料流(Cross Traffic)，並以群播(Multicast)
方式傳送到 Traffic sink 1 及 Traffic sink
2，以模擬從頭端機房傳送群播的數位內容
到各個客戶端的行為，如圖 5 所示。Traffic
generator 2 則模擬在客戶端所在區域的隨
選單播背景資料流(On-Demand Traffic)，
我 們 假 設 背 景 資 料 流 均 為 MPEG-2
Transport Stream，並以 CBR(Constant Bit
Rate)方式傳輸，封包大小亦為 188 bytes。
在頻寬設定方面，主要骨幹網路的
GSR 部份假設是以接近 STM-4 的頻寬來
連接，其頻寬設為 600 Mbps。其餘像是機
房(DRM Server)到路由器(HPER)之間的頻
寬則設為 1 Gbps，至於每個 GSR 路由器
間的連線(Link)之輸入埠(Input Port)緩衝
器大小(Buffer Size)則設為 5(以封包為單
位)，其他的連線緩衝器大小(Buffer Size)
則設為 50，其他相關模擬參數如表1所示。
表 1：模擬參數表
Arrival Pattern Poisson
Packet Size 188
bytes
Mean Arrival Rate 2000
Key
Offered Traffic load 3 Mbps
Traffic Pattern CBR
Packet Size 188
bytes
Cross
Traffic
Offered Traffic load 480Mbps
圖 6 為我們所模擬的金鑰傳送遺失率
(Key Loss Probability)與重複次數K之關係
圖。從圖 6 我們可看出當固定 K 值時，M
值越大，則金鑰遺失的機率就越低。但根
據方程式(8)，只要 KM 值相同，則金鑰傳
送遺失的機率就相同，M 值越大，K 值就
越小，但 K 值越小到底會有何好處呢? 圖
7 說明 K 值與金鑰傳送成功所需的平均延
遲之關係，結果顯示 K 值越大，其延遲也
遞增，特別是從 K = 1 增加至 K = 2 時變
化最明顯，之後在 3K 後逐漸進入穩定的
飽和狀態(Saturation)。理論上，在相同的
金鑰遺失率要求下，即 KM 固定，則 K 值
越小或 M 值越大，則傳送成功的金鑰平均
延遲就會越低，效能自然越好。但是 M 值
越大時，網路的交通流量也會輕微增加，
所以排隊延遲也會稍微增加，這也是為什
麼 M = 3 的曲線會在 M = 2 的曲線之上的
原因。
綜合以上的結果，我們認為重複授權
多路徑法 DEDPP 可在適當的 K 與 M 值下
得到令人滿意的效能，通常可取較小的 K
值與較大的 M 值，即可同時達到低金鑰遺
失率與低延遲的要求，證明重複授權多路
徑法 DEDPP 是一種優良的金鑰傳送方法。
圖 6：金鑰遺失率與 K 值的關係圖。
圖 7：金鑰平均傳送延遲與 K 值的關係圖。
