 2 
 
目錄 
 
 報告內容……………………………………………………………………3 
 前言…………………………………………………………………………3 
 研究目的……………………………………………………………………3 
 文獻探討……………………………………………………………………3 
 研究方法……………………………………………………………………4 
 結果與討論…………………………………………………………………8 
 參考文獻……………………………………………………………………9 
 計畫結果自評………………………………………………………………10 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 4 
 
的集成影像值是 A+B+C+D 的畫素和，而 3 的位置
的集成影像值是 A+C 的畫素和，如果想要 D 區域
的畫素和，可以簡單的從( I(1) + I(4) ) – ( I(2) + I(3) )
而得，這樣只需要讀取 4 個值。 
(2) 串接分類器: 藉由合併多個弱分類器而得
到高精準度的方法稱為 Boost [8]。Ada-Boost 演算
法是其中效能最好的方法 [9]。產生出來的結果有
兩種分類器，一種是弱分類器，一種是強分類器，
弱的分類器包含一個臉特徵的門檻值，數個類似的
臉特徵的弱分類器結合成一個強分類器。 
 
 
圖 2 強分類器的串接架構。 
 
圖 2 強分類器的串接架構在 Viola-Jones 臉部辨
識演算法中是很重要的部分，這架構可以迅速且有
效的刪除不通過臉特徵的掃描視窗區域，輸入掃描
視窗區域內的影像進入強分類器的串接架構，每個
強分類器將根據它本身的數個弱分類器的結果決
定是否讓該影像進入下一個強分類器，越後面的強
分類器包含更多的弱分類器以提供更精準確認是
否為臉。 
 
 
圖 3 Viola-Jones臉部辨識演算法的簡易程式碼 
 
圖3是Viola-Jones臉部辨識演算法的簡易程式
碼，整個演算法可以分為三個部分，第一部分是調
整圖片大小，藉由調整圖片大小，用固定的掃描視
窗去找出不同大小的臉。第二部分是集成影像生
成，生成集成影像使得後面在串接分類器運算量降
低。第三部分是偵測，藉由移動掃描視窗把掃描視
窗內的影像輸入到強分類器的串接架構找出臉的
位置。 
硬體模組—週期精準的分享記憶體式多核心
多執行緒的模擬器 [10]，模擬器是使用多執行緒的
軟體庫與 cycle-accurate 的多核心硬體模型互相合
作模擬，模擬器可以回報精準的系統的參數與效
能。 
圖 4 是這個模擬器的架構，使用的處理器模型
是 ARMv5 沒有浮點數運算單元的架構，多執行緒
的軟體庫是使用 QuickThread [11]。他提供簡單的
創造執行緒、中斷執行緒、把執行緒取消回去等
待，執行緒的 queue是使用FIFO的架構，這個 queue
是實作在共享式的記憶體空間中，而存取他是使用
spin-lock synchronization mechanism 保護不會讀取
錯誤，快取參數可調整一個 line 的大小、一個 block
的大小以及 associativity，cache coherence 是使用簡
單的 snooping-based protocol，所有的處理器都是使
用相同的記憶體空間，其他設定預設值列在圖 4 右
手邊。 
 
圖 4 週期精準的分享記憶體式多核心多執行
緒的模擬器的軟硬體架構圖。而系統參數顯示在右
手邊。 
 
研究方法 
1. Viola-Jones 臉部辨識演算法平行度層級 
臉部辨識演算法的平行度存在於不同的計算
流程中，我們將介紹不同的計算流程中如何實現平
行度。程式碼是採用並修改於 OpenCV library [12]
中的臉部辨識演算法，他所採用的是 Viola-Jones
臉部辨識演算法，圖 5 的演算法流程可以分為三個
部分，調整圖片大小、集成影像生成、偵測。 
 
1:  for all WZ  // WZ: window size 
2:    Resize image; 
3:    Integral image; 
4:    for all WP  // WP: window position 
5:      Detect { 
6:        for all SC  // SC: strong classifier 
7:          for all WC // WC: weak classifier 
8:            If failed, label the position as negative; jump to the 
next WP; 
9:        If passed all the SCs, label the position as positive; 
10:     } // end of Detect 
 6 
 
 
圖 8 各個層級的平行度效能比較 
 
3. 混和式平行架構達到高效能 
經由前面的經驗，我們發表一個混合式的平行
架構可達到高效能的改善。 
 
 
圖 9 混合是平行架構的執行結果 
 
第一個架構是兩個階段的架構，第二階段式等
第一階段執行完成之後才開始執行。第一階段是創
造多個執行緒，每個執行緒同時執行調整圖片大小
還有建立集成影像，而第二階段是與 divide 
detection level 的層級做同樣的事情，如圖 9 所示，
到 16 顆核心時，與一顆核心比較可以達到 16 倍的
加速。然而它仍在 16 顆核心以後效能進步趨緩。 
第二個架構是三個階段的架構(如圖 10 所
示)，更加改進了效能。第一階段現在是多個執行
緒同時執行，每個執行緒調整圖片大小，第二階段
建立集成影像，第三階段是與 divide detection level
的層級做同樣的事情，與第一個架構不同的是，每
個階段不用執行完成所有的執行緒再進入下一階
段，這個架構有更好的平衡使得每個核心閒置的時
間少，達到最好的效能延展，如圖 9 所示，這個架
構在 32 核心可以達到 27.8 倍的加速，在 64 核心可
以達到 64 核心的加速。 
 
 
圖 10 三階段混和式平行架構之Viola-Jones臉
部辨識演算法 
 
4. 區域性分析 
由前面提到的，偵測的部分佔整個演算法的運
算 70%的執行時間，且這個部分也有高的資料區域
性，因此我們將針對這個部分做區域性分析，並由
三階段混合式平行架構出發，發展出新的架構可改
善在快取的資料區域性。 
(1) 偵測區塊的記憶體存取行為 
調整影像大小、計算集成影像這兩個部分都沒
有高的資料區域性，調整影像大小部分所用的資料
僅僅只有一開始讀取進來的影像資料，且在每個執
行緒當中只會用到一次，而計算集成影像的部分，
所用的資料僅僅只有一開始讀取每個調整影像大
小後的影像資料，每個執行緒當中只會用到一次這
筆資料，這兩個部分最大的效能改善就是利用高的
資料平行度，而偵測區塊不只有高的資料平行度，
且有兩種資料擁有高的資料區域性，一種是分類器
資料，另一種是影像資料，分類器資料包含了一組
串接的強分類器，每個強分類器內包含一組弱分類
器。當移動掃描視窗去新的位置時，影像的資料會
被送進這些分類器中判斷，如果影像通過所有的分
類器，則代表臉存在於這個位置。每個弱分類器代
表一個臉的特徵，每個弱分類器包含一些有關於這
個特徵的資訊，如: 分類器的分類、在掃描視窗中
的位置、權重、還有決定是否通過該特徵的界限
值，當第一次使用完這個弱分類器後，這個特徵的
資訊會被記錄在本地的快取中，當處理器下一次又
要使用同樣的弱分類器時，因為這處理器可在本地
的快取中找到這筆資訊，這將幫助改善系統效能。 
而影像資料在每個分類器檢查時都會重複的使用
到。但當我們選擇其中一種資料最佳化資料區域
性，會影響另一種資料的資料再用性。 
舉例來說，如果我們先選擇一個掃描視窗位置
固定下來，影像資料會被儲存在本地的快取，通過
每一級的強分類器，但因為快取大小限制的關係，
 8 
 
的增進資料區域性，發表了一個新的架構—群組分
類器架構(如圖 12)。 
我們先選定一個分類器計算所有的視窗位
置，，然後送進前三級的強分類器中，並記錄起來
通過前三級的視窗位置，等到算完全部的偵測視窗
後，接下來的程序與交換迴圈架構一樣的實作方
式。 
 
 
圖 13 群組分類器架構的效能改善 
 
圖 13 是群組分類器架構與交換迴圈架構、三
階段的混合是平行架構效能比較，可以看到群組分
類器架構更進一步的改善效能，這都是由於前三級
更充分利用分類器的資料區域性的關係。 
但是在使用這個群組分類器架構的時候有兩
個需要注意的地方，第一個是圖 12 的 5-8 行需要
記錄通過每個強分類器的視窗位置，當執行每個強
分類器前，這個記錄需要被讀回來，這會增加額外
的記憶體存取與資料交換。 
第二個是群組分類器的強分類器數量是需要
注意的，如果群組過少的強分類器沒有辦法展現最
大的資料再用性，但如果群組過多的強分類器，則
又會增加快取失誤，而且當快取大小改變的時候，
這數量也會跟著不同。為了達到最好的效能，設計
者必須關心這個架構下群組分類器的數量，決定出
適當的群組分類器數量。 
 
結果與討論 
經由前面的介紹，我們首先展示如何分析
Viola-Jones 臉部辨識演算法的平行度，每一層級的
平行度都有它們改善效能的方法，但也都有不同的
限制在，不平衡的執行工作量也是限制效能的因素
之一。基於上述的分析結果和設計經驗，我們發表
了多階段混合式平行架構，而這個架構在 64 核心
下最大可展現 37.5 倍的加速。 
接著我們觀察到整個系統的瓶頸在於記憶體
系統中，關鍵的設計在資料區域性的重要和快取的
優點，我們分析三階段混合式平行架構記憶體行
為，藉由實驗數據觀察與分析後，提出一個新的交
換迴圈架構，這個交換迴圈架構與三階段混合式平
行架構比較可以達到 58%的效能改進。 
最後我們再進一步的觀察記憶體的行為，發現
仍有一些資料區域性的部分可以使用，於是我們提
出了群組分類器架構，這個群組分類器架構與三階
段混合式平行架構比較可以達到 58%的效能改進。 
我們已發展一套多核心多執行緒系統模型，包
含 軟 體 及 硬 體 模 組 。 此 模 型 提 供 了 準 確
(Cycle-Accurate)的系統行為及特性，以支援接下來
的計畫中對於整體系統效能的分析及驗證。此外，
此多核心系統模型也能支援探討在不同設計層中
的傳輸資源之元件特性及設計參數對於整體效能
的影響。 
本計畫之研究結果已發表於兩篇 IEEE 國際會
議論文。未來我們將朝著發展設計方法與架構，使
我們可以有系統選擇適當的設計參數 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 1
國科會補助專題研究計畫項下出席國際學術會議心得報告 
                                     日期：100 年 9 月 30 日 
一、參加會議經過 
此次會議於中國大陸北京附近的萬商花園酒店舉辦。總共兩天的會議中包含了
數十篇的研究論文報告以及討論。會議本身的規模並不大，大部分參加的是中國
大學的教授與研究生，不過也有許多來自其他國家的研究人員來發表他們的研究
成果。 
 
在論文報告與研討的部分，所有的研究論文被分成數個群組，分別於兩天的議
程中進行報告與研討。此次會議的研討議題著重在網路應用以及實現雲端服務上
的挑戰。如何在網路規模以及使用者人數持續快速成長的過程中，還可以提供穩
定、持續、且安全的網路服務，這個議題仍舊是非常困難且具有挑戰性。除了網
路與雲端服務的議題之外，本次會議也由軟體設計的角度，對於許多嵌入式應用
以及設計的方法進行了廣泛的討論。 
計畫編號 NSC 99－ 2221 －E －009  － 190 － 
計畫名稱 針對特殊應用之多處理器系統中可重置化傳輸資源之設計及最佳化 
出國人員
姓名 賴伯承 
服務機構
及職稱 交通大學電子工程系助理教授 
會議時間 
100 年 7 月 15 日
至 
100 年 7 月 17 日 
會議地點 北京，中國 
會議名稱 
(中文) 2011 軟件工程與服務科學國際學術會議 
(英文)  2011 2nd IEEE International Conference on Software 
Engineering and Service Sciences 
發表論文
題目 
(中文) 在嵌入式多核心系統中平行物件辨識應用的資料區域化之最
佳化設計 
(英文)  Data Locality Optimization for A Parallel Object 
Detection on Embedded Multi-Core Systems 
國科會補助計畫衍生研發成果推廣資料表
日期:2011/09/07
國科會補助計畫
計畫名稱: 子計畫一：針對特殊應用之多處理器系統中可重置化傳輸資源之設計及最佳化
(I)
計畫主持人: 賴伯承
計畫編號: 99-2221-E-009-190- 學門領域: 積體電路及系統設計
無研發成果推廣資料
其他成果 
(無法以量化表達之成
果如辦理學術活動、獲
得獎項、重要國際合
作、研究成果國際影響
力及其他協助產業技
術發展之具體效益事
項等，請以文字敘述填
列。) 
無 
 成果項目 量化 名稱或內容性質簡述 
測驗工具(含質性與量性) 0  
課程/模組 0  
電腦及網路系統或工具 0  
教材 0  
舉辦之活動/競賽 0  
研討會/工作坊 0  
電子報、網站 0  
科 
教 
處 
計 
畫 
加 
填 
項 
目 計畫成果推廣之參與（閱聽）人數 0  
 
