 2
研究計畫中英文摘要 
 
(一) 計畫中文摘要 
隨著資訊科技不斷進步，網路安全威脅已由單一檔案型病毒、巨集病毒、木馬或蠕蟲，
逐漸發展為透過網路／電子郵件散佈的各式變種病毒，近年來更演變為混合式威脅(blended 
threat attack)、垃圾郵件(spam mail)、網釣攻擊(Phishing)或網址嫁接(pharming)，讓使用者實
在是不堪其擾，威脅也愈見提升。也正因為網路應用的蓬勃發展，衍生出許多應用安全的
問題。國際產業研究公司 Gartner Group 也提到在所有攻擊事件中，有百分之七十五是發生
在應用層 (OSI Application layer)，所以傳統的網路安全設備例如入侵偵測系統以及防火牆
並不能有效的防止應用層的攻擊。 
本計劃將研發出一套應用入侵防禦系統  APIPS(Application Protocol Intrusion 
Prevention System) 架構來解決重要應用服務的安全問題，並針對電子郵件入侵部分做一個
經典案例研究。應用入侵防禦系統結合正面表列 (positive approach)與負面表列 (negative 
approach)的優點防止應用攻擊的產生，能進行 bi-direction 的 deep packet content and stateful 
inspection。藉由網路處理器的實作將可驗證 APIPS 之實際效能與正確性。 
 
關鍵詞:入侵保護系統、有限狀態機、網路安全、郵件服務、應用安全 
 
(二) 計畫英文摘要 
With the rapid improvement and popular demand of network technology, network threat has 
developed from simple virus, Trojan and worm to complex forms of blended threat attack, spam 
mail, phishing, and pharming. This evolution in network malicious code has caused significant 
threat and raised many network security concerns. According to Gartner Group, 75% of network 
attacking occurs in the OSI Application layer, and the traditional security equipment such as 
Intrusion Prevention System (IPS) and Firewall are unable to prevent OSI Application layer from 
being attack.  
 
This project is intended to develop an Application Protocol Intrusion Prevention System 
(APIPS) to solve security issues mentioned above and to do the case study on email attacks and 
spam. combining with positive approach and negative approach, APIPS can successfully prevent 
attacks from hackers; it can run bi-directional deep packet content and stateful inspection. Finally, 
the accuracy and actual application of APIPS will be implemented on IXP425 and be verified 
through our network testbed experiment. 
 
Key word: Intrusion Detection System, Finite stat machine, Network security, Mail service, 
Application security 
 4
圾郵件傳送者(spammer)的 IP 位址，若是郵件伺服器接收到傳送郵件的連線，它會用
簡單的 DNS 查詢，來判斷這些 IP 位址是否為垃圾郵件者常用的 IP 位址。 
z Whitelist services: 顧名思義和 Blacklist services 屬於相反詞，也就是在建立 SMTP 連線
的時候，會檢查 client 端的 IP 位址是否為名單上的位址，如果是才能讓他建立連線。 
 
2.  在郵件伺服器也接收到垃圾郵件的預防機制 
z Heuristic engines:由於單純的字串比對容易將合法的郵件阻擋掉，且較無彈性，此方法
可以建構一個對於郵件訊息的內容和結構的評估方法，不僅僅只是單純的字串比對。 
z Network vigilance – Vipul’s Razor 是一種線上的垃圾郵件比對資料庫，郵件伺服器會在
它接收到郵件訊息時，利用一些計算方法，並將結果送至 VR 查詢。 
 
3. 垃圾郵件已被送至郵件者信箱 
z Bayesian filtering:此方法是利用郵件訊息裡的字元做統計分析，並利用機率權重的觀念
來判斷此郵件是否為垃圾郵件。  
 
由於現今國內外的研究，對於應用層的攻擊和垃圾郵件和攻擊的預防機制上，並沒有
一個整合型的研究，而且沒有一個友善的介面可以讓使用者自訂什麼是一個正常的行為，
這也是我們所提出的計畫最想解決的問題。 
 
 
(四) 研究方法 
現存在市面上的 IDS 或 IPS 大部分都是屬於負面表列(negative approach)，對於異常協
定偵測(protocol anomaly detection)和封包深度檢測大部分也只到達 TCP/IP 通訊協定的第四
層，無法更進一步防禦一般新型的攻擊，而且對於垃圾郵件的防禦也無法有效的涵蓋到。
故在此計畫裡我們提出了一個可以廣泛深層防禦應用層攻擊的 APIPS(Application Intrusion 
Prevention System)，並將我們所開發出來的系統實做在 Intel 所提供的 IXP425 網路處理器
上，做為網路拓樸上的安全閘道器，可以對 client 和 server 之間的訊息做即時性的檢測防禦。 
在 IDS 或 IPS 最著名的開放原始碼就屬於 Snort，故我們所提出的系統是以 Snort 為基
礎，並整合有限狀態機(finite state machine)和 stateful session 檢測機制，並提供一個客製化
的介面，讓使用者可以將自己所開發的應用程式，使用我們指定的語言描述出自己的狀態
圖(state diagram)。此系統不僅可以防禦 mail 或 web 的攻擊以及垃圾郵件的防禦，也可以對
於任何應用層協定的攻擊做防禦。詳細內容請參閱我們在 Network and Parallel Computing, 
LNCS 4672 發表之文章(附件一)[8] 
 
(五) 結果與討論 
由以上我們所提出的研究方法，可以將我們所提出的系統歸納出幾個最顯著的優點:
一、由於 Snort 本身為負面表象，我們所提出的方法為正面表象，故可以將 Snort 帶來更堅
強的防禦功能。二、提供了一個可以讓使用者彈性設計自己的有限狀態機的介面，並可將
 6
 
(七) 參考文獻 
1. Gunter Ollmann, “Paper: Web Based Session Management”, at: 
http://www.technicalinfo.net/papers/WebBasedSessionManagement.html 
2. B. Violino, "Decoding Application Security", at: 
http://www.csoonline.com/read/050104/application.html 
3. Finite state machine From Wikipedia  , http://en.wikipedia.org/wiki/Finite_state_machine 
4. P. Resnick, "SIMPLE MAIL TRANSPORT PROTOCOL" , RFC2822, April 2001 
5. Cipher Trust, "What E-mail Hackers Know that You Don’t", November 2005 
6. Qiu Xiaofeng, Hao Kihong, Chen Ming. "Flow-Based Anti-Spam", IP Operations and 
Management, 2004. Proceedings IEEE Workshop on 11-13 Oct. 2004 Page(s):99 – 103 
7. David Harris, "Drowning in Sewage", at: http://www.ictlex.net/wp-content/spamwp.pdf 
8. Bo-Chao Cheng, Ming-Jen Chen, Yuan-Sun Chu, Andrew Chen, Sujadi Yap, Kuo-Pao Fan, 
“SIPS: A Stateful and Flow-Based Intrusion Prevention System for Email Applications”, 
Network and Parallel Computing, LNCS 4672, p.334-p.343. (SCI) 
9. Bo-Chao Cheng, Huan Chen, Ryh-Yuh Tseng, “Context-Aware Gateway for Ubiquitous 
SIP-Based Services in Smart Homes’, 2006 International Conference on Hybrid 
Information Technology - Vol2 (ICHIT'06). Nov. 2006, Page(s): 374-381 
 
 
 
 
 
 
 
 
 
附件一: Bo-Chao Cheng, Ming-Jen Chen, Yuan-Sun Chu, Andrew Chen, Sujadi Yap, 
Kuo-Pao Fan, “SIPS: A Stateful and Flow-Based Intrusion Prevention System for 
Email Applications”, Network and Parallel Computing, LNCS 4672, p.334-p.343.  
 
 SIPS: A Stateful and Flow-Based Intrusion Prevention System 335 
In order to effectively prevent both SMTP attacks and spam, we propose an 
integrated approach called SMTP Intrusion Prevention System (SIPS) which bases on 
the concept of Protocol Anomaly Detection (PAD) [2][3] and integrated with flow-
based inspection to examine whether the email flows deviate from normal behavior. 
The remaining of this paper is organized as following. Section 2 introduces the 
conventional anti-spam solutions and compares these solutions. Section 3 and section 
4 describe the design concept and system architecture. In section 5, a test environment 
is built to evaluate the SIPS approach. And conclusion is given in section 6. 
2   Background and Related Work 
SMTP attacks and spam have become one of the most serious problems. In this 
section, we will introduce conventional anti-spam approaches and conventional 
prevention approaches of SMTP attacks. 
2.1   Conventional Prevention Approaches of SMTP Attacks 
Most of mail systems are vulnerable due to the openness of email standards and wide 
security holes. The attacks are including DoS (Denial of Service), buffer flow and so 
on. Many techniques have been developed in order to prevent such attacks. These 
techniques can be classified into two kinds of approaches: 
A Signature-based Detection is commonly referred to the negative approach 
because it aims at the behavior known as “abnormal behavior” and assumes 
everything else as “normal behavior”. 
B Protocol Anomaly Detection is commonly referred to the positive approach 
because it detects “normal behavior” of the specific protocol. Protocol Anomaly 
Detection aims at protocol misusage. 
2.2   Conventional Anti-spam Approaches 
Conventional anti-spam approaches can be classified into three approaches [1]: 
A Content-scanning approach Saito[6] identifies email messages by analyzing mail 
headers and contents using keyword matching or statistical analysis of the words 
to determine whether an email is spam. This technique could also be called spam 
filtering, such as Bayesian filtering and heuristic engines. 
B List-based approach [8] determines a spam by inspecting the particular IP 
address or email address during mail transaction before the mail server receives 
the email. It requires DNS to lookup the database of IP addresses that are known 
to be a spam source. 
C Flow-based approach Qiu[7] detects spam and abnormal email behaviors in the 
network according to the type of email flows and their characteristics. 
Qiu’s[7] flow-based concept is effective for email flows with small mail body or 
large amount of recipient, but it is unable to differentiate exterior and interior email 
behavior. Saito[6] sets a threshold according to IP address, Mail header and Mail 
 
 SIPS: A Stateful and Flow-Based Intrusion Prevention System 337 
3.2   Normal Email Behavior 
Firstly we observe the behavior of a normal email by monitoring more than 300 
emails transferred to a SMTP server. We specify that a normal email flow should 
have the following characteristics: 
y In general, there are many differences between some MTA software, but a normal 
mail behavior usually follows RFC formats such as minimum implementation, 
general syntax principles and transaction model. 
y A transmission of normal mail should not spoof the domain of SMTP client and 
make a guess on username. 
y The same IP address of SMTP client sending emails should be in the regular 
cycle. 
y The variation of the email flow size depends on the behavior of email flow 
mentioned above, the location of SMTP client and the media type of emails. 
y An email flow that contains a mail transaction must be initialized by using EHLO 
command. A mail transaction includes several SMTP commands, which are 
MAIL, RCPT, DATA and QUIT. The SMTP client should send these commands 
to the SMTP server in order to expect QUIT command. 
y By RFC2821 [5], the NOOP, HELP and VRFY commands can be used at any 
time during an email flow, but a normal mail mostly does not contain these SMTP 
commands. 
Based on the normal email behavior, we can now design the SMTP Intrusion 
Prevention System based on stateful and flow-based inspection. 
4   SMTP Intrusion Prevention System (SIPS) 
Intrusion Detection System (IDS) has become an important part of network security 
system on most of business enterprises. Its function is like security alarm or 
surveillance system in our houses. If an intrusion is detected, it will alert the network 
administrator for further process. IDS could only passively detect an intrusion, but 
could not prevent it. It is insufficient for enterprises network requirement. Therefore a 
new generation of improved system is proposed, Intrusion Prevention System (IPS) 
with a feature to prevent an intrusion. In this paper we proposed a SMTP Intrusion 
Prevention System (SIPS) which can protect email servers from attacks. 
4.1   System Architectures 
We integrated SIPS with Snort[4] (Snort is an open source Network-based IDS), to 
aim at email attacks based on SMTP behaviors of practice and study of RFCs. 
As shown Fig.1, a new preprocessor called “SMTP Inspection Preprocessor (SIP)” is 
implemented and integrated with Snort to realize our approach. The decoder resolves 
the protocol which is used by the given packet and matches the data against allowable 
behavior for packet of their protocol. After the packets are matched, the preprocessor 
will redirect the email flow to SIP, inspecting whether they are email attacks. And then 
the email flow will be taken into Detection Engine and compare it against the rules in 
Snort without verdict in SIP. It is the core part on signature-based NIDS. 
 SIPS: A Stateful and Flow-Based Intrusion Prevention System 339 
 
Fig. 3. The State Machine of Preventing Email Attacks 
Fig. 3 shows the finite state machine of SIPS, the state transitions and prevention 
approach are described as following: 
y Initial State: As SMTP connection is established, the system enters this state and 
checks whether the IP address is on blacklist and mail bomb list. The connection 
is categorized as normal if it is not on the list. The flow information will be stored 
and updated to flow records which are used to determine SMTP attack and spam. 
y Ready State: After TCP 3-way handshake, the system enters this state that is 
waiting for HELO or EHLO command sent by SMTP Client. On this state the 
system sets a period of time Ta. The email flow is considered as normal if the 
number of connection is below the threshold N during Ta. Otherwise it is likely to 
be an email bomb, the system discard the email flow and record the source IP 
address in the mail bomb list for a dynamic and real-time prevention. 
y EHLO State: According to RFC2821, the variable of HELO command must be a 
Full Qualified Domain Name (FQDN). In this state the SMTP client must send 
HELO/EHLO command with variable which follows FQDN. The length is limited 
under MaxCommandLength to prevent buffer overflow. 
y MAIL State: The sender address must follow “<sender@domain>” format. And 
this domain must follow FQDN and checked for its existence. Attacker and 
spammer usually use false domain name to deceive SMTP server. 
y RCPT State: The recipient address must follow “<recipients@domain>” format. 
The SMTP server will authenticate whether the sender or recipients is a legal user. 
If it is an illegal user, SMTP flow will be delayed 20 seconds, and if another 
illegal user is received, it will be delayed for another 30 seconds. If it keeps 
receiving illegal users, then this SMTP flow is considered to be abnormal. 
y RESET State: The system enters this state if the previous mail transaction is 
canceled and the sender and recipients will be deleted. This flow is considered to 
be abnormal if the command is larger than 6 byte. 
y VRFY State: If the number of failed user verification or VRFY command is sent 
more than the threshold, this SMTP flow is considered to be abnormal. 
 SIPS: A Stateful and Flow-Based Intrusion Prevention System 341 
Test of Mail Bomb 
As shown in Table 2, we send 50, 100, 150, 200, 250, 300, 350 mail bombs with two 
IP addresses and 100 normal mails as the background traffic. 
(100,50) denotes 100 normal mails and 50 mail bombs. As shown in Fig. 5, the 
ratio of FP is always below 5%. It is affected with a main factor: normal users might 
send a large number of mails and cause SIPS producing a false alarm. SIPS is still 
better than the existing security technology and the original Snort which can not 
detect and prevent any attacks of mail bombs. The ratio of FN is always below 10%.  
In “INIT state” and “Ready state”, the FSM can detect and prevent the email bombs. 
FN of our approach is converged as the email bombs grow. 
Table 2. Mail Bomb Test Traffic 
Case Normal Mails Mail Bombs Total 
A 100 50 150 
B 100 100 200 
C 100 150 250 
D 100 200 300 
E 100 250 350 
F 100 300 400 
G 100 350 450 
 
0
0.01
0.02
0.03
0.04
0.05
0.06
0.07
0.08
0.09
0.1
(100,50) (100,100) (100,150) (100,200) (100,250) (100,300) (100,350)
T est Traffic
Fa
lse
 
Po
sit
iv
e 
an
d 
Fa
lse
 
N
eg
at
iv
e 
(ra
tio
) FP
FN
 
Fig. 5. SIPS Results on Mail Bombs Prevention 
Test of Spam Mails 
Our proposed approach can prevent spam according to normal behavior constructed 
by finite state machine. The results are shown in Table 3, Fig. 6, and Fig. 7. 
As shown in Fig. 6, the FP of the approach proposed by Qiu[7] is worse than our 
approach, because it only determines spam by the flow size, there is no difference 
regarding interior or exterior email server. The same inspection for interior and 
exterior server makes the FP increasing. Qiu[7] approach also can not detect spoofing 
and defrauding during mail transactions. 
 SIPS: A Stateful and Flow-Based Intrusion Prevention System 343 
As shown in Fig. 7 FN of the approach proposed by Qiu[7] is worse than our 
approach. It is because this approach does not record the state information. It only 
detects spam by quantity of the flow. Spammers usually change their identification 
within mail transaction so that their real identification will not be discovered. 
Saito[6] approach is also insufficient to prevent spam because it uses IP header 
information. Nowadays, spammer usually sends spam by changing IP (SMTP client), 
header and body randomly. If spam has these characteristics, this approach will have 
worse FN. 
SIPS uses stateful deep inspection on each email flow targeting various type of 
spam. The results show that SIPS is better than booth Saito[6] and Qiu[7] for the test 
traffic. The average ratio of FP in SIPS is 6.3% and 11.5% for the FN. 
6   Conclusions 
Since 1982 SMTP has become one of the most important internet applications, it has 
also become attacker’s target. This paper proposes an approach to prevent spam on 
mail transactions using stateful and flow-based inspection on email flows. To blend a 
series of security solutions we also integrate Snort into IPS for email application. We 
evaluate our approach with real email environment. The average results are 3.2% for 
FP, 6% FN on mail bomb test and 6.3% for FP, 11.5% FN on spam mail test. 
References 
[1] Harris, D.: Drowning in Sewage: SPAM, the course of the new millennium: an overview 
and white paper. In: Spam Help, Available: http://www.spamhelp.org/articles/Drowning-
in-sewage.pdf 
[2] Das, K.: Protocol Anomaly Detection for Network-based Intrusion Detection. In: SANS, 
(August 13, 2001) 
[3] CERT, State of the Practice of Intrusion Detection Technologies. Available: 
http://www.cert.org/archive/pdf/99tr028.pdf 
[4] Snort, Available: http://www.snort.org 
[5] Klensin, J.: Simple Mail Transport Protocol, RFC2821 (April 2001) 
[6] Saito, T.: Anti-SPAM System: Another Way of Preventing SPAM. In: Proceedings. 
Sixteenth International Workshop on Database and Expert System Application. 22-66 
August 2005, pp. 57–61 (2005) 
[7] Qiu, X., Hao, J., Chen, M.: Flow-based anti-spam. In: Proceedings IEEE Workshop on IP 
Operations and Management, 11-13 October, 2004, pp. 99–103. IEEE Computer Society 
Press, Los Alamitos (2004) 
[8] Park, J.S., Deshpande, A.: Spam Detection: Increasing Accuracy with a Hybrid Solution. 
Information System Management (2006) 
[9] Brownlee, N.: Traffic Flow Measurement: Architecture, RFC2722 (October 1999) 
[10] Bass, T., Freyre, A.: E-mail bombs and countermeasures: cyber attacks on availability 
and brand integrity, Network IEEE (1998) 
出席國際學術會議心得報告 
                                                             
計畫編號 NSC 95-2221-E-194-016 
計畫名稱 APIPS：適用各式網路應用之全能狀態檢視入侵保護系統 
出國人員姓名 
服務機關及職稱 
鄭伯炤 
國立中正大學通訊系   助理教授 
會議時間地點 
11/09/2006~11/11/2006 
Jeju Island, Korea 
會議名稱 
(中文) 第一屆複合資訊科技國際研討會 
 (英文) ICHIT －International Conference on Hybrid Information Technology, 
2006 
發表論文題目 
1. Bo-Chao Cheng, Huan Chen, Ryh-Yuh Tseng, “Context-Aware Gateway for 
Ubiquitous SIP-Based Services in Smart Homes’, 2006 International 
Conference on Hybrid Information Technology - Vol2 (ICHIT'06). Nov. 2006, 
Page(s): 374-381 
2. Huan Chen, Bo-Chao Cheng, Chih-Chuan Cheng, Li-Kuang Tsai, “Smart 
Home Sensor Networks Pose Goal-Driven Solutions to Wireless Vacuum 
Systems”, 2006 International Conference on Hybrid Information Technology -
Vol2 (ICHIT'06). Nov. 2006, Page(s): 364-373 
 
一、參加會議經過 
 
ICHIT －International Conference on Hybrid Information Technology, 2006, 今年是第一屆
舉辦。此會議主要是由韓國政府單位與機關所主辦，主辦單位計有:IEEE Computer Society 
與韓國的 Science and Engineering Research Council (SERC) 與 Science & Engineering 
Research Support Center (SERC)。 
 
近來的電腦網路應用有結合三項科技領域(電腦運算、電子通訊以及視聽技術)的趨勢。
如何在各領域之間達到互動以及相容的目標，甚至與網路世界相結合，使得應用得以更
為廣闊且更為便利，並提供更合適的服務。此次會議之範疇正如會議名稱，利用「Hybrid 
Information Technology」智慧地解決現實世界中的硬件和軟件問題，以組合和開發一系
此會議是一個 EI 的會議，所以發表之文章也有一定程度。我們共發表的兩篇文章如下(論
文請參閱附件): 其中第一篇文章內容與成果深受大會審議委員欣賞，因此此篇入選- 
International Journal of Smart Home (IJSH)，將在 IJSH-Vol.2-No.1-01 刊登。 
1. Bo-Chao Cheng, Huan Chen, Ryh-Yuh Tseng, “Context-Aware Gateway for Ubiquitous 
SIP-Based Services in Smart Homes’, 2006 International Conference on Hybrid Information 
Technology - Vol2 (ICHIT'06). Nov. 2006, Page(s): 374-381 
2. Huan Chen, Bo-Chao Cheng, Chih-Chuan Cheng, Li-Kuang Tsai, “Smart Home Sensor 
Networks Pose Goal-Driven Solutions to Wireless Vacuum Systems”, 2006 International 
Conference on Hybrid Information Technology - Vol2 (ICHIT'06). Nov. 2006, Page(s): 
364-373  
 
 
二、與會心得 
 
這次會議為期三天(11/09~11/11)在風光明媚的濟州島舉行，假 International Convention 
Center (ICC)舉行。ICC 建築新穎規劃完善，與濟州島風光搭配，不愧舉辦研討會勝地。
在會議期間，每一時段分別以 4~5session 同時進行，一共有 34 場次，並發表了 250 多篇
研究論文。議題包羅萬象，涵蓋當今一些熱門題材(如智慧型家庭的應用、服務及安全性
等)，我們也從一些演講內容受益不少。 
這次參加研討會，隨行者還有博班學生「鄭志川」，為了讓學生能增廣見聞與拓展視野，
該生也申請學校獎助金一起前往。我們於 11 月 10 日中午抵達會場，並於當日下午三點
由「鄭志川」報告我們的研究成果。看到下一代之成長與茁壯，相信是每位老師共同的
期望與欣慰之處。 
 
這次參加會議收穫良多，雖然國內也舉辦許多研討會，但大多是以國內徵文為主。希望
將來能看到台灣有機會多舉辦國際會議，以期更能與國際交流。 
 
三、攜回資料名稱及內容 
 
順利完成既定目標，並攜回下列 proceeding 一本。 
 
 
to illustrate the information flow for the presence 
information posts and connection service requests. 
Section 4 presents the performance experimental 
results of SCAG prototype implemented on IXP425 
network processor. Finally, Section 5 makes a brief 
conclusion. 
 
2. System architecture and components 
 
In practice, a home inhabitant could have many SIP 
UA devices and he/she wants to treat the incoming 
service requests and the outgoing presence information 
posts on an “as needed” basis (based on pre-defined 
context-aware service criteria such as entity-to-entity 
relationships and current situations). An effective way 
to do this is to deploy an intelligent gateway to 
select/control communication sessions between home 
networks and the Internet. SIP Context Aware 
Gateway (SCAG), serving as a SIP-based home 
application secretary, provides tremendous flexibility 
and capability in adapting to diverse environment 
situations. SCAG supports the SIP-based context 
aware applications based on the inhabitant’s 
motivations, behaviors and needs. Figure 1 shows the 
architecture of the proposed SCAG. Besides the SIP 
Server and Presence Server, SCAG comprises several 
major components: Stateful Inspection Layer (SIL), 
Content Filter (CF), SIP Application NAT (SAN), 
Feature Selector (FS),   Policy of Context (PoC), 
SCAG Management Agent (SMA). Each component is 
collaborated with each other to perform the task of 
context management. We will discuss each component 
in detail as follows. 
SIP Application 
NAT Content Filter
SIP Server
Feature 
Selector
Policy of Context
(PoC)
SCAG Mgnt. Agent
Stateful Inspection Layer
Presence Server
SIP Context Aware Gateway (SCAG)
SCAG ManagerSIP UA SIP UA
Internal
Network
External
Network
Figure 1.  SCAG architecture 
2.1 Stateful Inspection Layer (SIL) 
 
Providing the firewall functionality (such as IP 
address and TCP port filtering), stateful inspection 
layer is designed to defense the low-level exposure 
protocol attacks (e.g., IP spoofing and vulnerabilities 
associated with the TCP/UDP ports). Further, this layer 
also deals with the SIP firewall traversal issues. By 
default, firewalls would block all traffics originated 
from outside networks, but permit all originating 
traffics inside. After a connection is established, the 
firewall allows all data stream for this approved 
connection. For the SIP-based communication model, 
the media connections are setup dynamically. Media 
Transport Address (MTA), declared in the “c=” and 
the “m=” lines in the Session Description Protocol 
(SDP), specifies the IP address and port number at 
which RTP/RTCP packets can be received. SCAG is a 
SIP awareness device; it sets TCP/UDP ports open 
dynamically and accept the legal incoming data traffic. 
 
2.2 Content Filter (CF) 
 
Like many services posing serious security threats, 
SIP applications (e.g., file sharing) increase the 
potential security risks with viruses/worm infection 
and copyrights/intellectual property infringements 
[13]. Unfortunately, current commercial products of 
firewall and Intrusion Detection System (IDS) could 
not block or detect this kind of vulnerability. Content 
Filter (CF) provides an efficient solution which 
scrutinizes the incoming data traffic with deep content 
inspection in SDP payload based on security policies. 
Figure 2 shows an example where the contact point (a 
specific URL http://insa.comm.ccu.edu.tw/process) in 
the SDP payload is illegal and shall be blocked. CF 
module will then tear down the communications 
between SIP UA and this specific website. The CF 
module uses signature/pattern to recognize illegal 
contents in the SDP payload. As such, CF module can 
reject malicious or illegal requests. 
v=0 
o= 289024 289024 IN IP4 comm.ccu.edu.tw 
s= 
t=0 0 
c=IN IP4 0.0.0.0 
m=data 8080 HTTP application/soap+xml 
a=contact: http://insa.comm.ccu.edu.tw/process 
a=directionassive 
a=wsdl:http://ant.comm.ccu.edu.tw/Guest.wsdl 
Figure 2. SDP payload for contact negotiation 
2.3 SIP Application NAT (SAN) 
 
The traditional network address translation (NAT) 
only operates at layer 3 and layer 4 [11] and does not 
modify the IP addresses/port information embedded 
within the SDP payload. To be interoperable with 
2006 International Conference on Hybrid Information Technology (ICHIT'06)
0-7695-2674-8/06 $20.00  © 2006
communicate with the professor when his/her presence 
status becomes “Away” and location is “Home”. An 
alert message will be generated when this session is 
finished. All the connections are limited to be 
conducted over port 6000. 
 
 
2.6 SCAG Management Agent (SMA) 
 
SCAG manager is used to control the SCAG via the 
communication with SMA. Though SCAG manager, 
the home owner can post his/her communication 
preferences and the policy of context on SCAG. As 
referencing the statistical data of packet and log 
collection from SMA, SCAG Manager analyzes this 
information to validate the context settings and 
pinpoint the security threats. 
 
 
3. Presence information and service 
requests 
 
In this section, we show a case study to outline the 
steps of how the SCAG can achieve the presence 
management. As shown in Figure 4, there are three 
major components implemented in SCAG: SIP Server, 
Presence Server and Feature Selector. Here the SIP 
Server in SCAG is a general SIP function module with 
integrated functions of SIP Proxy Server, Redirect 
Server and Registrar Server and Location Server. 
These servers can be either co-located in the same 
place or distributed in different places. Presence Server 
complies with the SIP/SIMPLE protocol to perform 
presence information management tasks. Feature 
Selector (FS) selects the best communication feature 
and determines appropriate presence information to 
post for Alice based on her current context and 
preferences. The decision can be made either based on 
different profiles of the incoming request from Bob or 
based on the policy of context (PoC) defined by Alice. 
 
3.1 Customized presence information 
 
The presence information flow present below shows 
a simple scenario for a presence user agent (PUA) of 
“Bob” to subscribe the presence information. For the 
sake of clarity, the complete verbose texts of the 
exchanged messages are not shown. The steps are 
discussed as below. 
PUA (caller)PUA (caller)PUA (caller)
PUA (caller)PUAPUA
PUA: Presence User Agent
SCAG: SIP Context Aware Gateway
: r s c  s r t
: I  t t r  t
3. Query
4. Response
SIP      
Server
SIP      
Server
Presence 
Server
Pres nce 
Server
SCAG (callee)
Feature  
Selector
Feature 
Selector
SIP      
Server
SIP      
ServerPUA (caller)PUA (caller)PUA (caller)
PUA (caller)PUAPUA
Presence 
Server
Pr s nce 
Server
SCAG (caller)
Feature  
Selector
Fe ture 
Selector
Policy of Context Data Base (PoC-DB)Policy of Context Data Base (PoC-DB)
Bob
(Watcher)
Alice
(Presentity)
1. SUBSCRIBE
2. 200 OK
6. 200 OK
8. NOTIFY
9. 200 OK
5. NOTIFY 
7. Presence Update
Figure 4. Presence information flow 
 
Step 1: Bob sends a SUBSCRIBE request to 
obtain the presence information of Alice. 
This request is captured and processed by 
the Presence Server module in the Alice’s 
SCAG.  
Step 2: The Presence Server acknowledges the 
request by sending the SIP/2.0 200 OK 
message to Bob. 
Step 3: Presence Server also sends out a Query 
message to the Feature Selector to learn 
the appropriate way for posting presence 
information.  
Step 4: Feature Selector responds the Query with 
appropriate presence document for posting 
(containing the presence information of 
Alice). The appropriate presence 
document is chosen based on Bob-Alice 
trust relationships and desired presence 
information. 
Step 5: The Presence Server sends the NOTIFY 
message (containing the context presence 
information of Alice) to Bob. Unlike the 
conventional design, Alice’s presence 
information is allowed to be different 
according to the policy of context (PoC). 
For example, The location information of 
Alice shows “school” on Bob’s PUA but 
displays “library” on Alex’s PUA because 
Alice has a closer trust relationship 
defined in PoC. 
Step 6: The Bob’s PUA acknowledges the 
message by sending a 200 OK response. 
Step 7: When Alice changes her status, the PUA 
of Alice sends to the Presence Server to 
update the presence information of Alice. 
Step 8: The Presence Server sends Bob the 
NOTIFY message to refresh presence 
information of Alice. 
2006 International Conference on Hybrid Information Technology (ICHIT'06)
0-7695-2674-8/06 $20.00  © 2006
 
4. Implement and experiment results 
 
Every network system is unique and has special 
capabilities. Network processor (NP) becomes a cost-
effective core technology to implement network 
systems. NP technology tries to optimize the trade-off 
between the advantages from both hardware and 
software design paradigms. NP is advantageous over 
ASIC-based solutions due to its programmable 
capability, which provides great design flexibility. On 
the other hand, NP is considered advantageous over the 
software-based solutions because it provides 
mW/MIPS performance and wired line speeds. NP 
delivers all the flavors with programmability, 
flexibility and performance as well as with the added 
benefits of low cost such that it helps network 
engineers intelligently and efficiently designing and 
implementing their network systems.  
 
As the Tolly Group [14] reported on the 
performance analysis for home gateways, Intel IXP425 
based solutions outperform other vender processors 
consistently in terms of the throughput and latency. 
The emphasis of the evaluation conducted here is on 
the feasibility assessment of the practical IXP425 
based implementation for the proposed SCAG. The 
ADI's Coyote Gateway Reference Design Board, an 
Intel IXP425 based platform, is chosen to be the 
implementation platform. The following paragraph 
describes the implementation of SCAG on Coyote 
reference platforms, which is followed by the 
experimental results. 
  
We set up the testing environment to examine the 
performance of the SCAG. We perform the following 
tasks to interconnect the SmartBits 2000 (SIP traffic 
generator) and SCAG/Coyote (SCAG is implemented 
on Coyote). Under such testing setup, SIP traffic 
generated by the Smart Bits 2000 (traffic comes out of 
the Tx port) and is fed in to the SCAG/Coyote target 
board via the WAN port. The network connections 
between the SmartBits and SCAG are described as 
follows. 
 
z The Transmitting port (Tx) on SmartBits 2000 
is connected to the SCAG/Coyote target 
board’s WAN port. 
 
z The Receiving port (Rx) on SmartBits 2000 is 
connected to the SCAG/Coyote target board’s 
LAN port. 
 
The following two benchmarks are evaluated for the 
performance of SCAG implemented on the Coyote 
target board.  
 
z Benchmark for data traffic: To evaluate the 
performance for data traffic, the SCAG 
functionality is disabled (denoted as “Disable 
SIP”) to test the bridge function of the 
SCAG/Coyote target board (data traffic 
conveys from WAN port to LAN port).  
z Benchmark for signaling traffic: For signaling 
traffic, the SCAG functionality on the Coyote 
target board is enabled (denoted as “Enable 
SIP”).  
 
For both benchmarks, packets of different sizes and 
with various contents are generated to test the 
performance of the SCAG. The SCAG performs all of 
necessary functions including (1) capturing the 
packets, (2) extracting SIP fields (such as From, To, 
and Call-ID) and (3) comparing extracted fields with 
the rules of the PoC and (4) modifying presence 
information. There are three context policy entries in 
the PoC.  
 
Performance evaluation on throughput 
 
Figure 7 presents the throughput evaluation results. 
The vertical axis represents the values of throughput 
(in Kbps) and these values are expressed in the 
logarithm scale. The horizontal axis indicates the 
packet size (in bytes). We observed that the maximum 
throughput of SCAG is 4.99 (about 97 Mbps) and the 
minimum is 4.07 (11 Mbps) when SCAG is disabled 
(Benchmark for data traffic). The maximum 
throughput of SCAG is 3.2 (about 1640 Kbps) and the 
minimum is 2.5 (about 280 Kbps) when SCAG is 
enabled (Benchmark for signaling). Since SCAG 
processes the application layer information, the string 
matching operation needs a lot of computation power 
and thus degraded the throughput. For a general traffic 
distribution pattern (90% data traffic and 10% 
signaling traffic), experimental throughput results of 
our implementation range from 10 Mbps to 96 Mbps 
that satisfies the throughput requirement for the current 
Internet access speed on a Home Network (such as 
ADSL and T1). Notice that Figure 7 also shows that 
the throughput increases as the packet size increases 
and approaches to the wire-speed (100Mbps) when 
packet size reaches 700 bytes.  
2006 International Conference on Hybrid Information Technology (ICHIT'06)
0-7695-2674-8/06 $20.00  © 2006
[5] Ministry of Information and Communication (MIC) of 
Korea Seoul, Korea, “Smart Home Vision 2007”, http 
: //jco:co:kr/conference/data/5 th/53:pdf. 
[6] RFC3725 – J. Rosenberg, J. Peterson, H. Schulzrinne, 
G. Camarillo, Best Current Practices for Third Party 
Call Control (3pcc) in the Session Initiation Protocol 
(SIP), URL= http://rfc.net/rfc3725.html 
[7] RFC 3856 - J. Rosenberg, on A Presence Event 
Package for the Session Initiation Protocol (SIP), 
URL= ftp://ftp.rfc-editor.org/in-notes/rfc3842.txt 
[8] J. Rosenberg, A.B Roach and B. Campbell, "A 
Session Initiation Protocol (SIP) Event Notification 
Extension for Resource Lists", Work in Progress, June 
2003. 
[9] J. Rosenberg, H. Schulzrinne, G. Camarillo, A. 
Johnston, J. Peterson, R. Sparks, M. Hand-ley, E. 
Schooler, "SIP: Session Initiation Protocol", IETF 
RFC 3261, June 2002. 
[10] Simone Leggio, “SIP for Instant Messaging and 
Presence Leveraging Extensions”, 
URL=http://www.cs.helsinki.fi/u/kraatika/Courses/IPs
em04s/ SIMPLE_Leggio.pdf 
[11] P. Srisureseptember 2003, http://securityresph and K. 
Egevang, Traditional IP Network Address Translator 
(Traditional NAT), IETF RFC 3022, January 2001 
[12] H. Sugano, S. Fujimoto, G. Klyne, A. Bateman, W. 
Carr, J. Peterson, “Presence Information Data Format 
(PIDF)”, INTERNET-DRAFT May 2003, 
http://www.ietf.org/internet-drafts/draft-ietf-impp-
cpim-pidf-08.txt. 
[13] Symantec, “Symantec Internet Security Threat 
Report”, Sonse.symantec.com/avcenter. 
[14] Tolly Group, “Intel IXP425/IXP422/IXP420 Network 
Processors Performance Analysis of 802.11 
Broadband Routers and Access Points”, Tolly Group,  
June, 2004 
[15] M. Weiser, “A Computer for the 21st Century”, 
Scientific American (265): pp. 94-104, 1991. 
 
Appendix BAM syntax 
 
BAM＝*[action response 1*[ protocol filter direction filter 
| SSID | IP_range ] policy_list]  
filter＝content "：" port | "：" port 
action＝"accept" | "reject" | "drop" | "encrypt" | "update" 
response＝"none" | "alert" | "log" 
protocol＝"sip" | "tcp" | "udp" | "ip" | "icmp" 
content＝enum | sip_url | string | hostnumber 
enum＝digits 
sip_url＝user "@" host 
string =*[uchar] 
SSID= string 
IP_range= hostnumber"/" digits 
user＝*[ uchar | ";" | "?" | "&" | "=" ] 
uchar＝alpha | digit | safe | extra 
safe＝"$" | "-" | "_" | "." | "+" 
extra＝"!" | "*" | "'" | "(" | ")" | "," 
host＝hostname | hostnumber 
hostname＝*[ domainlabel "." ] toplabel 
toplabel＝alpha | alpha *[ alphadigit | "-" ]alphadigit 
alphadigit＝alpha | digit 
alpha＝lowalpha | hialpha 
lowalpha＝"a" | "b" | "c" | "d" | "e" | "f" | "g" | "h" | "i" | "j" | 
"k" | "l" | "m" | "n" | "o" | "p" | "q" | "r" | "s" | "t" | "u" | "v" | 
"w" | "x" | "y" | "z" 
hialpha＝"A" | "B" | "C" | "D" | "E" | "F" | "G" | "H" | "I" | 
"J" | "K" | "L" | "M" | "N" | "O" | "P" | "Q" | "R" | "S" | "T" | 
"U" | "V" | "W" | "X" | "Y" | "Z" 
hostnumber＝digits "." digits "." digits "." digits 
port＝digits "：" digits | digits "：" | "：" digits 
digit＝"0" | "1" | "2" | "3" | "4" | "5" | "6" | "7" | "8" | "9" 
digits = 1*digit 
direction＝"＜" | "＞" | "＜＞" 
policy_list＝*[cpl_tuple | "next"] 
cpl_tuple＝status | equipment | location | other_Manuscript 
status＝"online" | "offline" | userdefine 
userdefine＝1*[1*[alphadigit] " "] 1*[alphadigit] 
equipment＝"handset" | "phone" | userdefine location＝
"home" | "office" | userdefine other_Manuscript＝timestamp 
| 1*[alphadigit] 
domainlabel＝alphadigit | alphadigit *[ alphadigit | "-" ] 
alphadigit 
timestamp＝"times" digits 
 
2006 International Conference on Hybrid Information Technology (ICHIT'06)
0-7695-2674-8/06 $20.00  © 2006
[10] identified many novel smart home appliances and
intelligent artifacts as follows:
• Gate reminder: reminds you what you need be-
fore you leave your home.
• Smart wardrobe: tells you today’s weather fore-
cast.
• Smart dressing table, Smart pillow, Smart bed,
Smart mat and Smart picture frame: provide
comfortable and convenient housing lives.
In this paper, we design a smart home vacuum sys-
tem (SHV) where several smart units are operated co-
operatively and all of them are operated in a mobile
mode and powered by battery since it is more conve-
nient for them to move around for cleaning. The em-
phasis of this paper is on the design of SHV system
and the development of a goal driven task planning
(GDTP) engine which can be implemented in the wire-
less vacuum systems to maximize the network lifetime
as well as the cleaning efficiency.
The rest of this paper is organized as follows.
The SHV system architecture, components (includ-
ing GDTP engine) and operation information flow are
introduced in section 2. SHV energy consumption
model is discussed in section 3. Simulation results are
discussed in section 4. Finally, concluding remarks are
described in section 5.
2 Smart Home Vacuum System
A remote scheduler robotic vacuum system is re-
placing the old vacuum cleaner, but this robotic vac-
uum system is not able to clean tops of baseboards,
stairs, and underneath the furniture. A modern vac-
uum cleaning system should conquer the weak points
associated with the robotic vacuum system in the smart
home environment. We vision “Smart Home Vacuum
- SHV” as a leading system of the cooperative efforts
from several “mops units” to effectively sweep dirty
and dusty rooms (as shown in Fig. 1). This very mod-
ern vacuum system of cleaning is far superior to con-
ventional methods.
2.1 System Components and Architecture
SHV consists of two major components, Vacuum
Sensor Node (VSN) and Intelligent Cleaning Man-
Smart Home Vacuum
(SHV)
Cluster Head 1 Cluster Head 2 Cluster Head 3
Intelligent Cleaning 
Management Station
(ICMS)
Vacuum Sensor Node (VSN)                             
Cluster Head – ICMS Communication
Cluster Head – VSN Communication
 
Figure 1. Smart Home Vacuum System Com-
ponents
agement Station (ICMS). Each VSN is able to move,
sweep, sense “cleanness” in its responsible area and
report its status (such as energy residues, location and
sensed cleanness) back to ICMS. To reduce the energy
consumption, all VSNs are grouped in clusters, where
each cluster is managed by a cluster head (CH). Upon
receiving the information from supervised VSNs, clus-
ter head (CH) transmits the aggregated data to the
ICMS. The election of cluster-head can proceed using
whatever policy is suitable. In this paper, our proposed
goal driven task planning (GDTP) engine will choose
the best clustering algorithm to optimize the perfor-
mance matrices.
ICMS is the heart of the system by providing
the control and synchronization of the entire system.
Upon receiving the aggregation reports, ICMS chooses
the cluster head and conducts all VSNs participating
in their dedicated groups based on the room map and
the goal-oriented policy. Then, VSNs will move and
sweep cooperatively for the target clean areas.
The ICMS system architecture is shown at Fig. 2.
The functionality of ICMS is achieved by two dae-
mons (data collection daemon and management dae-
mon) with goal driven task planning (GDTP) engine
and DB where storing configuration parameters, room
maps, clean histories and VSN status. Working as vac-
uum system manager, management daemon provides
the various interfaces (e.g., Web GUI or LED panel)
2006 International Conference on Hybrid Information Technology (ICHIT'06)
0-7695-2674-8/06 $20.00  © 2006
the nodes; while the Jcvrg. is designed to maximize
the clearing area coverage by minimizing the total
energy consumption for all nodes. Proposed GDTP
engine can be easily extended to other design goals
and realized in the same framework.
A. Network Lifetime Goal-Jlife
Let’s consider a smart home environment with N
VSNs. Each VSN consumes energy at the following
dominant tasks: Moving, Working, Communication
and Sensing environments. Let’s denote the energy
consumption for the i-th node at round r for these four
terms as the EM(i, r),EW(i, r), EC(i, r) and ES(i, r),
respectively. As such, the total energy consumption at
round r, Q(r), for all VSNs can be expressed as fol-
lows,
Q(r) =
N∑
i=1
Q(i, r) (2)
=
N∑
i=1
{EM(i, r) + EW(i, r) + EC(i, r) + ES(i, r)}.
Supposed that our design goal is set to maximize the
network lifetime which is defined as the overall period
of time from the beginning of sensor network opera-
tion to the instance when the first node runs out of its
battery. The GDTP shall be able to find a task assign-
ing policy to minimize the total energy consumption
for each round and thus maximize the network life-
time.
Jlife = minQ(r), ∀ r. (3)
We further assume the following working paradigm for
our proposed smart home vacuum system: If a VSN is
chosen to be the cluster head, it needs to relay all in-
formation of the other non-cluster head motors in the
same cluster. To compensate the heavy energy con-
sumption on communications, CH is exempted from
the sweeping task at this specific round. As such, the
major design task for the GDTP is to provide a good
cluster head selection algorithm for
a given goal function. The pseudo-code of the
Cluster Head Selection Mechanism for Lifetime Goal
Driven GDTP is illustrated in Fig. 3. This algorithm
should be implemented in the GDTP engine on the
ICMS in order to achieve the goal of Jlife.
Cluster Head Selection Mechanism for Lifetime
Goal Driven GDTP
01 for (r=1; r <TotalRound; r++)
02 gets all node status (di(r), ci(r), Eri(r))
03 updates NodeStatusTable
04 Schecked=φ, continue=1, minQ=-1
/* Select m cluster heads for minimum Q(r) */
05 while (continue)
06 chooses one combination set b /∈ Schecked
nodes of b: ClusterHeadCandidateList
// each combination set comprises m nodes
// totally are C(N,m) combination sets
07 calculates energy consumption of all nodes
(EM(i, r), EW(i, r), EC(i, r), ES(i, r))
08 totalQ=0
09 for (i=1; i <N; i++)
10 NodeStatus[i].Q(r)=EM(i, r)+EW(i, r)
+EC(i, r)+ES(i, r)
11 totalQ+=NodeStatus[i].Q(r)
12 end for i
13 if (minQ>totalQ || minQ=-1)
14 minQ=totalQ
15 ClusterHeadList
=ClusterHeadCandidateList
16 end if
17 adds combination set b to Schecked
18 if (Schecked contains all combination sets)
19 continue=0
20 end while
21 end for r
Figure 3. Cluster Head Selection Mechanism
for Lifetime Goal Driven GDTP
At each round, the GDTP engine on the ICMS
will first get the all node status information. For each
node, say node i, the node status at round r includes
di(r): the location of node i, ci(r) : the cleanness of
the area where node i resides, and Eri(r): the energy
residue of node i. The GDTP engine also maintains
a Node Status Table which tracks all the node status
information and updates periodically. Next, in order
to select the appropriate cluster heads for a new
round, GDTP will compare the energy consumption
of all the combination sets, where a combination set
b comprises m nodes as cluster heads and there are
totally C(N,m) combination sets. For a combination
set b, the total energy consumption totalQ is calculated
and the elements in this combination set are saved
in the ClusterHeadCandidateList. After checking
2006 International Conference on Hybrid Information Technology (ICHIT'06)
0-7695-2674-8/06 $20.00  © 2006
For different objectives such as (3) and (6), the
GDTP engine will have different cluster head selection
mechanisms which choose the different set of the clus-
ter heads to achieve the desired goals. For the objective
Jlife, GDTP needs only to find the best cluster heads to
minimize the energy consumption for each round. On
the other hand, for the objective Jcvrg., GDTP needs to
find the best cluster heads for every round and arrange
them efficiently so as to maximize the overall cleaning
area coverage within the entire network lifetime. In
other words, the later needs to consider more schedul-
ing issues in order to reduce the unnecessary energy
wastes such as making vacuums moving around. This
can be achieved by many offline optimization schemes
or by dynamic programming algorithms. Here we use
the basic exhausted searching algorithm to find our
best cluster heads for all rounds. The detailed SHV
energy consumption models will be discussed in sec-
tion 3.
2.3 Information Flow
Figure 5 depicts the information flow of the Smart
Home Vacuum system. It comprises the following
three phases: Initialization Phase, Operation Phase
and Termination Phase. The interactions and detailed
operations between components are discussed as fol-
lows.
• Step 1: ICMS sends out the broadcast message to
initialize and synchronize a set of VSNs.
• Step 2: Each VSN performs the initialization
process and sends its status information back to
ICMS. The status information reveals the amount
of energy residue left, cleanness on the cleaned
surface and the VSNs’ location. For node i, they
are denoted as di, ci and Eri, respectively. The
mode is set to un-associated at this stage because
the association procedure is not completed yet.
• Step 3: ICMS chooses the cluster based on the
best interest of the home owner and VSNs’ status
information via the GDTP engine. Please note
that we present two goal-driven objective func-
tions, Jlife and Jcvrg., to drive the cluster head se-
lection algorithms in this paper.
ICMS
Cluster Head VSN
(3). Choose Cluster Head
(4). Setup
Initialization
Phase
(1). Initial & Synchronize
(2). Status Report
Operation
Phase
(5). Setup
(9). Status Report
(10). Aggregate & Report
Termination
Phase
(11). Shutdown 
(12). Acknowledge
(8). Move & Sweep
(7). Acknowledge
(6). Join
 
Figure 5. Information Flow of Smart Home
Vacuum System
• Step 4: ICMS sends out the “setup” message, in-
dicating cluster members and cluster head (CH)
for each participated group, to cluster head (CH)
of each cluster.
• Step 5: The cluster head broadcasts the “setup”
message to its group members.
• Step 6: After receiving the “setup” message at
this round, VSN sends “join” message to its cor-
responding CH to commit to associate the group.
• Step 7: Each CH acknowledges the commitment
of the VSN.
• Step 8: All VSNs move and sweep cooperatively
at this clock cycle (round).
• Step 9: VSN sends its status information to its
CH at the end of this clock cycle.
• Step 10: Upon collecting VSNs’ information at a
given period, CH gives the summative report to
ICMS.
• Step 11: If ICMS observes there is no more
floor needed to be cleaned, it would broadcast the
“shutdown” message to power off the system au-
tomatically. Otherwise, ICMS goes to step 3 to
continue the cleaning task.
2006 International Conference on Hybrid Information Technology (ICHIT'06)
0-7695-2674-8/06 $20.00  © 2006
have ERx = ETx−elec(L) to receive L-bit mes-
sage.
• The CH will perform data aggregation process-
ing on data collected from these Non-CH motors.
Each data aggregation processing consumes an
amount of EAgg. energy. Without loss of gener-
ality, EAgg. can be assumed to be α times of the
energy consumption of ERx.
• After aggregating the collected data, the CH
needs to transmit this information back to the
ICMS (Intelligent Cleaning Management Station)
with an amount of ETx energy.
We can express the total energy consumption for a
CH as in (9):
ECH (9)
= ECH−Setup + nNonCH · (ERx + EAgg.) + ETx
= ERx + nNonCH(1 + α)ETx−elec(L) + ETx
= {2 + nNonCH(1 + α)} · ETx−elec(L)
+ ETx−amp(L,d)
3.2 Energy Consumption Model for the
Non-Cluster Head (Non-CH)
The total energy consumption for a Non-CH motor com-
prises the following tasks it performs:
• In the beginning of each round, the VSNs who are
not chosen as a CH becomes a Non-CH. In the setup
stage of a Non-CH, it needs to perform two tasks:
(1) exchanging command messages with ICMS (in-
cluding setup, join, acknowledge), and (2) moving
to the target location. The former task consumes an
amount of ERx energy while the moving consumes
EMoving energy. With loss of generality, we assume
that EMoving = µ ·ERx.
• The Non-CHs also need to perform both the clean-
ing task and sensing task. The working (i.e. clean-
ing) and sensing will consume the amount of EWorking
and ESensing energy, respectively. We further assume
that these two terms can be expressed as multiple
times of the ETx−elec(L). To be more specific, we
have EWorking = ρ · ETx−elec(L) and ESensing =
σ · ETx−elec(L).
• At the end of each round, the NonCH needs to report
to its CH. As such, an amount of ETx energy is con-
sumed.
Table 1. Simulation parameters
Operation Energy Dissipated
Transmitter/Receiver
Electronics Eelec
50 nJ/bit
Data Aggregation EDA 50 pJ/bit/signal
Transmit Amplifier fs
(d< d0)
10 pj/bit/m2
Transmit Amplifier mp
(d> d0)
0.0013 pJ/bit/m2
Initial Node Energy E0 1.2 J
Data Length 825 bytes
Number of Nodes 100 nodes to 1000 nodes
Simulation Duration 5000 rounds
We can express the total energy consumption for a Non-
CH as in (10):
ENonCH (10)
= ESetup + EWorking + ESensing + EReport
= {ERx + ERx + ETx}
+ EWorking + ESensing + ETx
= (4 + µ+ ρ+ σ) · ETx−elec(L)
+ 2 ·ETx−amp(L,d)
4 Simulation Results
Simulation is conducted by the network simulator (ns-2)
[14]. It is assumed that the VSNs are distributed uniformly
in a field of 100 × 100 square meters. The ICMS (base
station) collecting all sensed data is located in (50, 50). All
VSNs are assumed to be homogeneous and each has initial
battery capacity of 2 Joules. Other parameters used in our
simulation are summarized in Table 1.
Two performance metrics are used to evaluate the pro-
posed GDTP engine: the network lifetime and the cleaning
coverage. Proposed GDTP is compared with other three
schemes: fixed clustering scheme (FCS), random clustering
scheme (RCS) and LEACH. The operation of LEACH has
been described in section 2.2. For FCS scheme, the test field
(100 x 100 m2) are divided into nine squares equally. The
sensor node closest to the center of each square is selected
as the cluster head for that square. Totally nine cluster heads
are selected in the test field, and these cluster heads are
not replaced thoughout the entire simulation. On the other
2006 International Conference on Hybrid Information Technology (ICHIT'06)
0-7695-2674-8/06 $20.00  © 2006
[2] Ramesh Govindan Chalermek Intanagonwiwat and
Deborah Estrin, “Directed diffusion: a scalable and
robust communication paradigm for sensor networks,”
pp. 56–67, 2000.
[3] D. Braginsky and D.Estrin, “Rumor Routing Algo-
rithm for Sensor Networks,” in the Proceedings of
the First Workshop on Sensor Networks and Applica-
tions(WSNA),Atlanta, GA, Oct 2002.
[4] C. Schurgers and M.B. Srivastava, “Energy effi-
cient routing in wireless sensor networks,” MILCOM
Proceedings on Communications for Network-Centric
Operations: Creating the Information Force, McLean,
VA, 2001.
[5] H. Haussecker M. Chu and F. Zhao, “Scalable
Information-Driven Sensro Querying and Routind for
ad hoc Heterogeneous Sensor Networks,” in the Pro-
ceedings of the International Journal of High Perfor-
mance Computing Applications, vol. 16, no. 3, August
2002.
[6] Ibrahim Matta Georgios Smaragdakis and Azer
Bestavros, “SEP:A Stable Election Protocol for clus-
tered heterogeneous wireless sensor networks,” Nov
2004.
[7] Joanna Kulik Wendi Rabiner Heinzelman and Hari
Balakrishnan., “Adaptive Protocol for Information
Dissemination in Wireless Sensor Networks,” in the
Proceedings of Mobicom’99, 1999.
[8] Wendi Rabiner Heinzelman Joanna Kulik and Hari
Balakrishnan, “Negotiation-based Protocols for
Disseminating Information in Wireless Sensor Net-
works,” in the Proceedings of ACM MOBICOM.
[9] Ministry of Inforamtion and Communication (MIC) of
Korea, Seoul, Korea, Smart Home Vision 2007, 2003,
http://jco.co.kr/conference/data/5th/5 3.pdf.
[10] Li Jiang, Da-You Liu, and Bo Yang, “Smart home
research,” in Third International Conference on Ma-
chine Learning and Cybernetics, Shanghai, August
2004, pp. 659–663.
[11] Kewei Sha, Junzhao Du, and Weisong Shi, “Wear:
A balanced, fault-tolerant, energy-aware rout-
ing protocol in wsns,” International Journal of
Sensor Networks (IJSNet), vol. 1, no. 2, 2006,
http://www.cs.wayne.edu/w˜eisong/papers/sha06-
wear.pdf.
[12] Ibrahim Abdul Rahim, “A fault-tolerant routing al-
gorithm for wireless sensor networks,,” Dissertation,
The University of Western Australia, 2004.
[13] Wendi B. Heinzelman, Anantha P.Chandrakasan, and
HariBalakrishnan, “An Application-Specific Proto-
col Architecture for Wireless Microsensor Networks,”
IEEE Trans. on Communications, vol. 1, no. 4, pp.
660–670, Oct 2002.
[14] Information Sciences Institute USC, The Network
Simulator: ns-2, 2006, http://www.isi.edu/nsnam/ns/.
2006 International Conference on Hybrid Information Technology (ICHIT'06)
0-7695-2674-8/06 $20.00  © 2006
列健全的方法，並尋求最適合於特定的電腦網路應用。徵稿方向如下:  
1. Bioinformatics and Computational Biology 
2. Communications and Networking 
3. Data Mining and Pattern Recognition 
4. E-Science and Web Intelligence 
5. Grid and Distributed Computing 
6. Hardware and Software Co-Design 
7. Health and Medical Informatics 
8. Hierarchical and Adaptive Learning Systems 
9. Human-Computer Interaction and Multimedia 
10. Image and Signal Processing 
11. Industrial and Environmental Engineering 
12. Intelligent Robotics and Autonomous Agents 
13. KDD and Data Warehousing 
14. Multi-Scale Modeling and Simulation 
15. Security and Safety Systems 
16. Smart Card and Chip Technologies 
17. Soft Computing and Rough Sets 
18. Ubiquitous Computing and Embedded Systems  
 
此次會議並以三個主要學術專題討論會進行: (1). International Workshop on Smart Home 
(IWSH) (2). International Workshop on Security Engineering and Information Technology on 
High Performance Network 和(3). International Workshop on Advanced Multimedia 
Technology and Applications。會議網址如下: http://www.sersc.org/ICHIT2006/page1.html。 
 
Context-Aware Gateway for Ubiquitous SIP-Based Services in Smart Homes 
 
Bo-Chao Cheng, Huan Chen and Ryh-Yuh Tseng 
 Department of Communications Engineering 
National Chung-Cheng University 
 bcheng@ccu.edu.tw, huan@ee.ccu.edu.tw, rytseng@insa.comm.ccu.edu.tw 
 
 
Abstract 
 
The smart home concept brings innovation and 
convenience to our every day's life style at home. 
Without context awareness, smart home applications 
cannot offer services that can adapt to users’ dynamic 
situations; they also fail to give preferential treatment 
for users’ various preferences. Such design paradigm 
forces human to live in the world of machines rather 
than a human oriented world. The use of SIP-protocol 
allows Smart Home devices and services to be 
connected compatibly and effectively. In this paper, we 
propose an adaptive SIP Context-Aware Gateway 
(SCAG) for the ubiquitous SIP-based services. With the 
SCAG solution, the home owner is able to use 
preferred devices for communication and to post 
his/her context information to home appliances or to 
people and civil society communities on an “as 
needed” basis.  
 
1. Introduction 
 
The general goal of the smart-home development is 
to integrate home devices, services and resources by 
the use of network and wireless technology so that 
home appliances would become more “intelligent” to 
adapt to user’s needs. As the sensor and wireless 
technologies become mature, more and more 
companies such as IBM, Microsoft, Simens and Cisco 
are conducting projects to work on this field. In 
particular, the Korea government has committed to 
develop on-going programs for promoting the 
applications of smart home environment [5]. In August 
2003, the Ministry of Commerce, Industry and Energy 
(MOCIE) of Korea government announced a ten year 
investment plan which includes the Smart Home to be 
one of the national development industries in Korea. In 
the same year, MIC proposed the “Smart Home Vision 
2007” to promote Korea to be the leading smart home 
country in the ubiquitous era.  
 
Mark Weiser pointed out that the ubiquitous 
computing era is coming soon to a life near you [6]. 
Context-awareness is a key technology in ubiquitous 
computing where context is defined as the information 
characterizing the situations of an entity [4] [15]. From 
the perspective of human, the semantic meaning of 
“smartness” for home appliances shall mean that they 
are adaptive to inhabitants according to their current 
environment situations (i.e., context). In the near future, 
smart home applications are expected to take more 
responsibility to cover home-care, security and 
personal assistance tasks.  
Most smart home applications focus on enhancing 
the functionality and capability. However, these 
applications do not provide services to adapt to the 
user’s dynamic situations and they do not provide 
preferential treatment to user’s preferences. Such 
design paradigm forces human to live in the world of 
machines rather than a human oriented world.  
Session Initiation Protocol (SIP) [1][7][8][9][10] is 
among the most important Internet protocols used 
today. It is designed to establish, modify, and terminate 
a session of the application services. The use of SIP-
protocol allows Smart Home devices and services to be 
connected compatibly and effectively. SIP has been 
used in many popular services such as Voice over IP 
(VoIP), Instant Message (IM), Presence Service, and 
File Transfer. It is expected that in the near future, SIP 
will also play an important role in the smart home 
environment. In this paper, we design and implement 
an adaptive SIP Context-Aware Gateway (SCAG) 
based on the IXP425 network processor technology. 
SCAG is an intelligent gateway to be deployed 
between home networks and the Internet.  
With the SCAG solution, the home owner is able to 
use SIP Use Agent (SIP UA) or Presence User Agent 
(PUA) to communicate with home appliances, people 
and civil society communities smoothly. As such, 
every participant can interact with each other 
adaptively and collaboratively.  
The remainder of this paper is organized as follows: 
Section 2 describes the system components and 
architecture of SCAG. Section 3 provides an example 
2006 International Conference on Hybrid Information Technology (ICHIT'06)
0-7695-2674-8/06 $20.00  © 2006
traditional NAT/PAT deployed at the front, SAN 
module replaces the following parameters in the SIP 
header and SDP payload (as shown in Table 1) [2]. 
Table 1. SCAG NAT actions 
Fields Description Modification 
via  
header 
A via header field value 
is added only after the 
transport that will be 
used to reach the next 
hop has been selected 
Yes 
contact 
header 
The contact header 
provides a SIP or SIPS 
URI where the client 
would to receive 
subsequent requests 
Yes 
Call-ID Call-ID contains a 
globally unique 
identifier for this call, 
generated by the 
combination of a 
random string and the 
softphone's host name or 
IP address 
No, in order to 
reflect the 
mapping 
o= The originator of the 
session 
No, in order to 
reflect the 
mapping 
c= The address is provided 
where media should be 
sent. 
Yes 
m= This indicates the 
transport port where 
media should be sent. 
Yes 
 
 In addition to revising above fields, SCAG also 
keeps the status of every session in order to map the 
internal IP addresses to public IP addresses until the 
session terminates. Finally, the content length is 
required to re-compute. 
 
 
2.4 Feature Selector (FS) 
 
In the ubiquitous smart home environment, proven 
context awareness is a must requirement. Constructing 
a SIP gateway with context awareness architecture 
involves more than just placing a few databases. FS 
module in SCAG is designed to direct incoming 
service requests to the right receiver and post outgoing 
presence information traffic with the best-appropriate 
context.  
 
2.5 Policy of Context (PoC) 
 
A flexible rules language, Behavior Access 
Manuscript (BAM), is designed to describe the context 
policy. The following is the format of BAM language:  
 
Action Response Protocol Filter Direction Filter Policy_List 
 
z Action: describes how the content filtering 
handles applications traffic, e.g., Accept, Reject, 
Encrypt and Drop. 
z Response: dictates how SCAG responses for a 
specified session, e.g., Nothing, Alert and Log. 
z Protocol: expresses traffic type, e.g., SIP, TCP 
and UDP.  
z Filter: states what specific content should be 
examined, e.g., SIP URL. 
z Direction: specifies the traffic direction, e.g., <, 
>, and <>.  
z Policy List: depicts the specification of 
communication preference such as content, 
presence settings and equipment.  
 
Context policy described by BAM language enables 
the CF module to scan for security check the specific 
SIP events (e.g., Invite, ACK, Cancel and Bye) and 
some explicit SIP message patterns (e.g., “m= data” or 
“a=*example.com”). The detailed BAM syntax is 
depicted in Appendix. 
In order to understand how Policy of Context works 
through the use of BAM language, we show a simple 
scenario as follows. In this case, we suppose that how a 
professor interacts with his/her student depends on his 
current location. Figure 3 shows an example of the 
context policy list used in this scenario. 
Accept  Log   SIP  Student@insa.ccu.edu.tw   6000:  <>   
Professor@ccu.edu.tw  5060  Available  Office  Office Phone   IM 
Accept  Alert  SIP  Student @insa.ccu.edu.tw   6000:  <>   
Professor @ccu.edu.tw  5060   Away    Home     Mobile    PDA  
Figure 3.  Examples of the PoC 
Policy 1 describes that the professor allows his/her 
student to get his presence status (Available) and 
location (Office). Policy 1 also indicates that the 
student could use office phone or instant message (via 
port 5060) to communicate with him/her. At the time 
this session terminates, the conversation history will be 
logged into the DB. 
 
Policy 2 describes that the mobile phone or the 
PDA (soft phone) is the allowed device to 
2006 International Conference on Hybrid Information Technology (ICHIT'06)
0-7695-2674-8/06 $20.00  © 2006
Step 9: The Bob’s PUA acknowledges the 
message by sending a 200 OK response. 
 
Please note that Presence Server can send the 
“Watcher” a NOTIFY message posting the context 
information of the Presentity at the step 5 and step 8. 
We use PIDF (Presence Information Data Format) [12] 
to encapsulate Presentity context information. PIDF 
consists of “Presentity URL”, “Presence Tuples” and 
“Presentity human readable comment” in the message 
format. After defining customized namespaces, the 
context of the Presentity can be conveyed in the format 
<prefix:element-name>value</prefix:element-name> 
(as shown in  Figure 5). 
 
NOTIFY sip:allen@watcherhost.ccu.edu SIP/2.0 
Via: SIP/2.0/TCP server.ccu.edu;branch=z9hG4b423 
From: <sip:ryan@ccu.edu>;tag=kiky45 
To: <sip:allen@ccu.edu>;tag=frgt23 
Call-ID: 6367@watcherhost.ccu.edu 
Event: presence 
Subscription-State: active;expires=599 
Max-Forwards: 70 
CSeq: 815 NOTIFY 
Contact: sip:server.example.com 
Content-Type: application/pidf+xml 
Content-Length: 302 
<?xml version="1.0" encoding="UTF-8"?>  
<presence xmlns="urn:ietf:params:xml:ns:pidf"  
        xmlns:lcs="urn:example-com:pidf-locationstatus "  
        entity="pres:ryan@example.com">  
    <tuple id="ub93s3">  
       <status>  
           <basic>open</basic>  
           <lcs:location>home</lcs:location>  
       </status>  
       <contact>im:ryan@example.com</contact>  
    </tuple>  
</presence>  
 
Figure 5. Embedded context information in 
NOTIFY message 
 
3.2. Customized SIP service request 
 
Next, we show in Figure 6 how the SCAG deals 
with the incoming SIP service requests. The Presence 
Server in SCAG does not participate in the interaction 
of the incoming SIP connection signaling handshake 
process. When an INVITE message sent by a SIP User 
Agent (SIP UA), the INVITE request routed in the SIP 
domain finally arrived at the SIP Server (resides in the 
SCAG) of the callee, Alice. How Alice is connected 
and at which device shall be determined by the Feature 
Selector. Following the same design concept of the 
Third Party Call Control (3PCC) defined in RFC 3725 
[6], SIP server leaves the decision of how Alice 
answers the request up to the Feature Selection. The 
detail process is illustrated as follows. 
 
SIP UA: SIP User Agent
SCAG: SIP Context Aware Gateway
I  : I  s r t
: I  t t re te y
SIP      
Server
SIP      
Server
Presence 
Server
Presence 
Server
SCAG (callee)
Feature  
Selector
Fe ture 
el ctor
SIP      
Server
SIP      
ServerSIP UA (caller)
SIP UA (caller)SIP UA (caller)SIP UA (caller)
SIP UA (caller)SIP UA (caller) Presence 
Server
Presence 
erver
SCAG (caller)
Feature  
Selector
Fe ture 
Selector
Policy of Context Data Base (PoC-DB)Policy of Context Data Base (PoC-DB)Bob
1. INVITE
2. INVITE 3. INVITE (w/o SDP)
8. 200 OK
9. 200 OK
10. ACK
5. ACK
6. INVITE
7. 200 OK
4. 200 OK w/SDP about PUA (callee)
Alice
SIP UA (caller)SIP UA (caller)SIP UA (caller)SIP UA (caller)
I   (c llee)SIP UA (callee)
 
Figure 6. Incoming service request flow 
 
Step 1: To contact Alice, Bob’s SIP UA sends 
an INVITE request to his local SIP 
Server.  
Step 2: The SIP INVITE request is routed in 
the SIP domain and arrives at the SIP 
Server on the callee side (Alice).  
Step 3: Since the SIP Server is not aware of 
which device Alice answers, SIP 
Server sends a query message to 
Feature Selector by sending an 
INVITE message without the SDP 
body. 
Step 4: Feature Selector then acknowledges 
the INVITE message by replying SIP 
Server with a 200 OK but with the 
Alice’s SIP UA (callee) information 
contained in the SDP message body. 
Step 5: The SIP Server thus obtained the 
appropriate communication method 
such as at which device and how Alice 
shall be connected. Then, it 
acknowledges FS by sending an ACK 
response. 
Step 6: The SIP Server next initiates a new 
INVITE request to the appropriate SIP 
UA of Alice.  
Step 7: The appropriate SIP UA of Alice 
acknowledges the INVITE message 
by sending a 200 OK to SIP Server. 
Step 8: The 200 OK message is routed back in 
the SIP domain and arrives at the SIP 
Server on the caller side (Bob). 
Step 9: The 200 OK message is forwarded to 
the SIP UA of caller (Bob). 
Step 10: The Caller (Bob) acknowledges the 
SIP communication negotiation 
process by sending an ACK response. 
2006 International Conference on Hybrid Information Technology (ICHIT'06)
0-7695-2674-8/06 $20.00  © 2006
01
2
3
4
5
6
64 350 500 650 800 950 110
0
125
0
140
0
151
8
Packet Size(byte)
Th
rou
gh
pu
t(K
bp
s)-
log
10
Disable SIP
Enable SIP
 
Figure 7. Throughput on different packet sizes 
Performance evaluation on latency 
 
Figure 8 presents the latency evaluation of the 
SCAG. The vertical axis shows the latency value in the 
logarithm scale (in µsec) and the horizontal axis 
indicates the packet sizes (in bytes). We compare the 
packet delay of two systems, one is with the SCAG 
function enabled for signaling traffic (solid line) and 
the other is with the SCAG function disabled for the 
data traffic (dotted line). When SCAG functionality is 
disabled (for data traffic), the maximum and minimum 
latency tested are 355µs and 55µs, respectively. After 
the SCAG functionality is enabled (for signaling 
traffic), the latency jumps up to about 45ms due to the 
increase of the computation time spent on pattern 
string matching. The time scale for setting up 
conversation is in seconds which is far larger than the 
observed experiment value scale for signaling (in 
millisecond scale). As such, the latency of SCAG for 
signaling is acceptable in the practical usage. 
Numerical results for both benchmarks show that our 
implementation meets the latency requirement. 
 
0
0.5
1
1.5
2
2.5
3
3.5
4
4.5
5
64 35
0
50
0
65
0
80
0
95
0
11
00
12
50
14
00
15
14
packet size(byte)
lat
en
cy
(us
ec
)-l
og
10
Disable SIP
Enble SIP
 
 
Figure 8. Latency on different packet sizes 
   
5. Conclusions 
 
In the ubiquitous computing era, small home 
networks are expected to integrate home devices, 
services and resources invisibly. Context awareness is 
the key technology for adaptations on an “as needed” 
basis. Smart home applications running on such 
networks need to recognize and accommodate users’ 
current contexts.  
The flexibility and extensibility of SIP contains 
endless possibility for the smart home environment, 
and is the protocol with which every application is 
created. In this paper, we propose SIP Context Aware 
Gateway (SCAG) to pose a solution for the ubiquitous 
sip-based services in smart homes. SCAG is deployed 
between home networks and the Internet, serves as a 
SIP-based home application secretary providing 
tremendous flexibility and capability in adapting to 
diverse environment situations according to the context 
of the inhabitants. A flexible rules language, Behavior 
Access Manuscript (BAM), is also designed to 
describe the context policy. The prototype of SCAG is 
implemented on IXP425 network processor technology 
and the experimental results and its implementation 
feasibility assessment is very promising. This study has 
confirmed that SCAG meets the context aware 
requirements in the smart home environment and 
network processor provides a practical implementation 
solution for the proposed SCAG. 
 
6. Acknowledgements 
 
This research was supported in part by the National 
Science Council (NSC) in Taiwan under the grant 
number NSC-95-2221-E-194-016 and NSC-95-2219-
E-194-007. 
References 
 
[1] J.E. Bardram "Applications of Context Aware 
Computing in Hospital Work -- Examples and Design 
principles" ACM, SAC '04, March 14-17, 2004, 
Nicosia, Cyprus. 
[2] B. Biggs, “A SIP Application Level Gateway for 
Network Address Translation”, IETF Internet Draft 
<draft-biggs-sip-nat-00> 
[3] B. Caswell and J. Beale, et al., "Snort 2.1 Intrusion 
Detection, 2nd Edition", Published by Syngress, ISBN 
1931836043 
[4] A.K. Dey, and G.D. Abowd, (1999). Toward a better 
understanding of context and context-awareness. GVU 
Technical Report GIT-GVU-99-22, College of 
Computing, Georgia Institute of Technology. 
ftp://ftp.cc.gatech.edu/pub/gvu/tr/1999/99-22.pdf 
2006 International Conference on Hybrid Information Technology (ICHIT'06)
0-7695-2674-8/06 $20.00  © 2006
Smart Home Sensor Networks Pose Goal-Driven Solutions to
Wireless Vacuum Systems
Huan Chen, Bo-Chao Cheng
Chih-Chuan Cheng and Li-Kuang Tsai
Electrical Engineering Department
National Chung Cheng University, Chiayi 62102, Taiwan
E-mail: huan@ee.ccu.edu.tw; bcheng@ccu.edu.tw
{m9288,m93126}@cn.ee.ccu.edu.tw
Abstract
Home sensor nodes are devices embedded in home
appliances and are designed to sense environments,
to process collected information, to perform a spe-
cific task, and to cooperate with other units. The ad-
vances of VLSI technologies and wireless sensor net-
works (WSN) turn the inspirational idea of intelligent
home appliances into reality. In this paper, we focus on
a category of home appliances, Smart Home Vacuum
(SHV), where mobility and battery are critical design
concerns. The emphasis of this paper is on the design
of SHV system and the development of a goal driven
task planning (GDTP) engine which can be imple-
mented in the wireless vacuum systems to maximize the
network lifetime as well as the cleaning efficiency. Un-
like LEACH, proposed GDTP engine is a goal-driven
approach to select the cluster heads to satisfy the de-
sign goals. Simulations are conducted by the network
simulator (ns-2) and the experiment results indicate
that GDTP performs better than other algorithms in
terms of the network lifetime and the cleaning area
coverage.
Keywords: Smart Home Applications, Wireless
Sensor Networks, Smart Home Appliance, LEACH,
Energy Awareness
1 Introduction
The smart home concept brings innovation and con-
venience to our every day’s life style at home. The
use of smart home appliances becomes a more civil
way of living for human beings. With the advances
of VLSI and wireless sensor networks (WSN) tech-
nologies [1–8], sensors can be made extremely small
and economically to be deployed in many home ap-
pliances. Smart home appliances are intelligent con-
sumer electronics used in home environments to make
home-life more convenient, secure and enjoyable. The
major difference between conventional appliances and
smart home appliances resides in the later products
usually embedded with intelligent control units that
can sense environments, communicate/cooperate with
other units, and response to environment changes.
As the sensor and wireless technologies become
mature, more and more companies and research
projects are working on this field such as IBM, Mi-
crosoft, Simens and Cisco. The Korea government has
also committed to develop on-going programs for pro-
moting the applications of smart home environments
[9]. In August 2003, the Ministry of Commerce, In-
dustry and Energy (MOCIE) of Korea government an-
nounced a ten year investment plan “Ten Future Grow-
ing Industries” in which the Smart Home became one
of the national development industries in Korea. In
the same year, MIC proposed the “Smart Home Vi-
sion 2007” to set goals of building a world-class dig-
ital home country and make Korea become the lead-
ing smart home country in the ubiquitous era. In May
2004, MIC also announced the policy of “Set up Digi-
tal Home, Enjoy Digital Life” and estimated that 61%
of the Korea families (about 10 million families) will
build up their digital homes. Jiang and his colleagues
2006 International Conference on Hybrid Information Technology (ICHIT'06)
0-7695-2674-8/06 $20.00  © 2006
ICMS
Data Collection
Daemon
GDTP
Engine
Management
Daemon
LED Panel
Web Browser
Goal
Room MAP
Clean Area
DB
VSNs/CHs
Aggregation
Reports
(Location, Cleanness, Energy)
 
Figure 2. ICMS System Architecture
allowing the home owner to input the room map, target
clean areas and goals (either maximizing clean cover-
age areas or achieving deep cleanness on the selected
areas). The following two assumptions are made for
the proposed SHV system.
• Inheriting from conventional wireless sensor net-
works, the proposed Smart Home Vacuum (SHV)
system also takes the fault-tolerant capability into
considerations. In other words, the SHV nodes
shall be considered as unattended nodes and the
entire system shall work correctly even operated
in the working scenario with a high node-failure
probability (either due to out of power or physi-
cal failure). Thanks to the fault-tolerant routing
protocols which enable wireless sensor networks
to resist node failures [11, 12].
• Since our application scope is on smart home
with small radio coverage areas, a simple two-
hop routing (i.e., VSN→ Cluster Head→ ICMS)
should be sufficient. When ICMS observes any
node failures, it will exclude fault nodes from any
working clusters and report the error status on the
SHV built-in screen.
Embedded with goal driven task planning (GDTP)
engine, ICMS collects VSN’s status and statistics dis-
tribution continuously. After collecting and analyzing
VSN status, ICMS will choose an appropriate CH for
each partition and issue the “setup” message to con-
duct next round cleaning job. In the following section,
several design goals as well as the problem formula-
tion for each goal are discussed.
2.2 GDTP Engine
The major task performed at the GDTP engine is to
periodically select a set of VSN(s) as cluster heads in
order to achieve the desired goals. Let’s define this pe-
riodic time interval to be a round. In literature, there
exists many cluster head election algorithms. The clus-
ter head election algorithm proposed in LEACH [13] is
one of the most widely known algorithm. Let’s briefly
describe it as follows. A sensor node i first determines
whether to become a cluster head by generating a ran-
dom number xi (0 ≤ xi ≤ 1) and compare this value
with a threshold T (i) described in Eq. (1). A node be-
comes a cluster head if the random number xi is less
than a threshold T (i); otherwise, it remains to be a
non-cluster head. The threshold T (i) is determined
for a sensor node i at round r and can be expressed by
the following equation:
T (i) =
{
P
1−P ·(rmod 1
P
)
if i ∈ SN (r)
0 otherwise.
(1)
where r denotes the number of current round and P
is a system parameter standing for an optimal percent-
age of cluster heads for a sensor network, which can
be determined by node numbers and the field dimen-
sion (P = 5% in LEACH). SN (r) denotes the set of
non-cluster head in the last 1P rounds. This means that
if a sensor node i has become a cluster head in the last
1
P rounds, it can not be a CH again. Otherwise, it be-
comes a cluster head if the generated random variable
x is greater than that threshold T (i). Finally, each CH
will broadcast its CH role to its neighboring area to in-
form others. Unlike LEACH, proposed GDTP engine
is a goal-driven approach to select the cluster heads to
satisfy the design goal.
In the design of ICMS, GDTP engine plays an
important role to drive the entire system to achieve
the target goals. These goals shall be described
quantitatively to allow GDTP engine to map the
“goals” from the semantic domain to the objective
domain. In this section two objective functions, Jlife
and Jcvrg., are formulated as examples. The objective
function Jlife is designed to maximize the network
life-time by maximizing the minimum life time of
2006 International Conference on Hybrid Information Technology (ICHIT'06)
0-7695-2674-8/06 $20.00  © 2006
the energy consumption of all combination sets,
the best combination set with the minimum energy
consumption can be found and the associated Cluster-
HeadCandidateList becomes the ClusterHeadList.
B. Cleaning Area Coverage-Jcvrg.
Given a total number of K cleaning areas (rooms),
let Ak denote the size of the k-th cleaning area. It is
further assumed that a value of the “cleaning freshness
requirement” (Fk) is associated with the k-th room.
The Fk is defined as the number of times need to be
cleaned. We can obtain the the total work load W
(units) to be
W =
K∑
k=1
Ak · Fk. (4)
Without loss of generality, we assume that the work
for each VSN can be done in one round is one unit
work. The total number of rounds R needed to clean
the entire area can be attained as follows,
R =
W
(N −G) =
∑K
k=1Ak · Fk
(N −G) (5)
where G is the total number of partition groups
and the cluster head for each group does not perform
the sweeping task. Therefore, if our design goal
is set to maximize the cleaning area coverage, the
proposed GDTP shall be able to find a task assigning
policy to maximize the overall cleaning area coverage
within the entire network lifetime. Alternatively,
this goal can be achieved by minimizing the overall
energy consumption (total energy consumption of all
nodes) for the entire network lifetime. Therefore, the
objective function Jcvrg. can be expressed as follows,
Jcvrg. = min
R∑
r=1
Q(r). (6)
For the Cleaning Area Coverage goal-driven GDTP,
the pseudo-code of the Cluster Head Selection Algo-
rithm is illustrated in Fig. 4.
Cluster Head Selection Mechanism for Cleaning
Area Coverage Goal Driven GDTP
01 MaxJCrvg() {
02 estimates the total round: R
03 gets all node status info. (di(r), ci(r), Eri(r))
04 updates NodeStatusTable
05 calculates the total number of
combination sets: mb
06 records all combination sets: Sb
07 MinQlist→Q=-1
08 DoRecursiveSearch(R,mb,Sb)
09 return MinQlist
10 }
11 DoRecursiveSearch() {
12 for (j=1;j <=R;j++)
13 for (k=1;k <= mb;k++)
14 CalculateNodeEnergy(j,k,Sb )
15 if (j =R)
16 DoRecursiveSearch(R,mb,Sb)
17 else
18 if (MinQlist→Q>Executionlist→Q
|| MinQlist→Q=-1)
19 MinQlist=Executionlist
20 MinQlist→Q=Executionlist→Q
21 end if
22 end if
23 end for k
24 end for j
25 }
26 CalculateNodeEnergy() {
27 updates Executionlist[j][k]
28 calculates energy consumption of all nodes
(EM(i, j, Sb(k)), EW(i, j, Sb(k)),
EC(i, j, Sb(k)), ES(i, j, Sb(k)))
29 for (i=1; i <N; i++)
30 NodeStatus[i].Q(j)
=EM(i, j, Sb(k))+EW(i, j, Sb(k))
+EC(i, j, Sb(k))+ES(i, j, Sb(k))
31 Executionlist[j][k]→Q+=NodeStatus[i].Q(j)
32 end for i
33 }
Figure 4. Cluster Head Selection Mecha-
nism for Cleaning Area Coverage Goal Driven
GDTP
2006 International Conference on Hybrid Information Technology (ICHIT'06)
0-7695-2674-8/06 $20.00  © 2006
 Figure 6. The path loss radio model de-
scribed in LEACH
• Step 12: VSN acknowledges the “shutdown”
message and turn itself off.
3 SHV Energy Consumption Model
Considering a typical home working environment,
we make some general assumptions for SHV energy
consumption model. The cleaning system comprises
one intelligent cleaning management station (ICMS)
and N vacuum sensor nodes (VSNs). The ICMS is as-
sumed to have unlimited power supper (i.e., plugged
into the power surge), but each VSN is assumed to be
operated on a limited battery capacity. Both the ICMS
and VSNs are equipped with transmitters and receivers
to perform the communication tasks. To compensate
the heavy energy consumption on communication, CH
is exempted from the sweeping task. Since the tasks
performed at CH and Non-CH cleaning motors are dif-
ferent, they have different energy consumption model.
Following the same notation and convention as in
LEACH [13], the radio propagation model (path loss)
for transmitter and receiver are illustrated in Fig. 6,
which can be expressed as following equations:
ETx(L,d) = ETx−elec(L) + ETx−amp(L,d) (7)
=
{
L ·Eelec + L · fs · d2 if d < d0
L ·Eelec + L · mp · d4 if d ≥ d0
In Eq. (7), the total energy consumption ETx(L, d)
for transmitting L-bit message over a distance d can
be expressed as a sum of two terms, ETx−elec(L)
and ETx−amp(L, d). ETx−elec is the electronics en-
ergy consumption, which is related to factors such as
the digital coding, modulation, filtering and spreading
schemes of the signal. ETx−amp is the amplifier en-
ergy consumption to transmit acceptable BER (bit er-
ror rate) for signals transmitted to a receiver. ETx−elec
can be further expressed in terms of energy consump-
tion for a single bit Eelec, while ETx−amp can be fur-
ther expressed in terms of fs or mp, depending on
the transmitter amplifier mode that applied. They are
power loss factors for free space (d2 loss) and multi-
path fading (d4 loss), respectively. The threshold d0
can be determined by equating the two expressions.
This radio model reflects the fact of using several im-
mediate short-range transmissions to send data is more
energy-efficient than using a single long-range trans-
mission. We will follow the same design rule as well.
By equating the two expressions, an empirical value of
d = d0 =
√
fs
mp
can be derived.
The total energy consumption ERx(L) for receiving
L-bit message equivalent to ETx−elec(L). Notice that,
the energy consumption for ERx(L) depends only on
how many bits it is receiving rather than the distance d
the message is transmitted from. , i.e.,
ERx(L,d) = ETx−elec(L) = L ·Eelec. (8)
The energy consumption models for the CH and Non-
CH VSNs are discussed in the following subsections.
3.1 Energy Consumption Model for the
Cluster Head (CH)
The total energy consumption for a cluster head
comes from the following tasks it performs:
• In the beginning of each round, the CHs are cho-
sen by the ICMS. If a VSN is chosen to be the
cluster head, it needs to relay all information of
the other non-cluster head motors in the same
cluster. To compensate the heavy energy con-
sumption on communication, CH is exempted
from the sweeping task at this round. Therefore,
the energy consumption spent will only be the
amount of receiving a setup command message,
ERx (step 4 in Fig. 5).
• The CH needs to receive some equipment reports
(containing energy residue, location, and envi-
ronment information) from its associated nNonCH
Non-CH VSNs. Each message receiving con-
sumes an amount of ERx energy. From (8), we
2006 International Conference on Hybrid Information Technology (ICHIT'06)
0-7695-2674-8/06 $20.00  © 2006
hand, RCS scheme randomly selects nine sensor nodes as
the cluster heads in the test field at each round.
4.1 Performance Comparisons on the Net-
work Lifetime
Network lifetime is defined to be the overall period of
time from the beginning of sensor network operation to the
instance when the first node runs out of its battery. Figure 7
shows how the network lifetime changes with the increases
of the value ρ. Remember that in (10), EWorking = ρ ·
ETx−elec(L).
When the value of ρ is small (such as ρ ≤ 40), the energy
consumption for each term is almost very competitive. Nei-
ther one of them becomes the dominate factor. In this op-
eration situation, GDTP will select those VSNs with maxi-
mum residue energy as cluster heads in order to maximize
the network lifetime. However, as the value of ρ becomes
large enough (ρ > 40), the EWorking becomes the dominate
factor of the entire energy consumption. Therefore, GDTP
should select those VSNs with minimum residue energy as
cluster heads and make them exempt from sweeping at that
round.
Results show that proposed GDTP can outperform other
three schemes and achieve the desired design objective the
maximum lifetime.
( )elecTxWorking EE −= ρ
40=ρ 50=ρ 60=ρ 70=ρ 80=ρ 90=ρ
 
Figure 7. Network Lifetime
4.2 Performance Comparisons on the
Cleaning Area Coverage
Next, we will evaluate the performance in terms of the
cleaning area coverage, which is defined in (6). In our sim-
ulation, the cleaning area coverage is expressed in terms
of the accumulated number of swept units. The simulation
 0
 500
 1000
 1500
 2000
 2500
 3000
 0  5  10  15  20  25  30
Ac
cu
m
ul
at
ed
 N
um
be
r o
f U
ni
t A
re
a 
Cl
ea
ne
d
Number of Rounds
GDTP
LEACH
RCS
FCS
 2000
 2200
 2400
 2600
 24  26  28  30
Figure 8. Cleaning Coverage
results for the FCS, RCS, LEACH and proposed GDTP al-
gorithm are shown in Fig. 8. From this figure, we observe
that as the simulation round increases, the cleaning area be-
comes larger and the proposed GDTP outperformed other
schemes after round 25.
5 Conclusions
The innovation of smart home appliances will surely
bring improvements to our home lives. We vision “Smart
Home Vacuum - SHV” as a leading system of the cooper-
ative efforts from several “mops units” to effectively clean
the house in the future smart home environment. This very
modern vacuum system present in this paper is far superior
to conventional methods. The architecture and operation
information flow are discussed in details. A goal-driven
approach GDTP engine was proposed to select the cluster
heads based on the desired goals. The simulation results
have confirmed the effectiveness of the GDTP in achieving
the optimal lifetime and in improving the coverage of clean-
ing areas. Proposed GDTP engine can be easily extended to
other design goals and be realized in the same framework.
6 Acknowledgements
This research was supported in part by the National Sci-
ence Council (NSC) in Taiwan under the grant number
NSC-95-2219-E-194-007 and NSC-95-2221-E-194-016.
References
[1] Alan Mainwaring, Joseph Polastre, Robert Szewczyk,
David Culler, and John Anderson, “Wireless Sensor
Networks for Habitat Monitoring,” in the Proceedings
of ACM, pp. 88–97, 2002.
2006 International Conference on Hybrid Information Technology (ICHIT'06)
0-7695-2674-8/06 $20.00  © 2006
